"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[46283],{126382:(e,t,r)=>{r.r(t),r.d(t,{AgentChatView:()=>ie,NewChatButton:()=>ce});r(16280),r(410838),r(944114),r(898992),r(823215),r(672577),r(737550);var o=r(296540),n=()=>r(484714),i=()=>r(847249),a=()=>r(401497),s=()=>r(460744),l=()=>r(428045),c=()=>r(803960),d=()=>r(626466),u=()=>r(952816),h=()=>r(996624),p=()=>r(689094),g=()=>r(340498),f=r(474848);const S={viewBox:"0 0 16 16",svg:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("path",{d:"M8.37.461a.55.55 0 0 0-.779 0l-2 2a.55.55 0 0 0 .778.778l1.081-1.08V8.8a.55.55 0 0 0 1.1 0V2.198l1.041 1.041a.55.55 0 0 0 .778-.778z"}),(0,f.jsx)("path",{d:"M6.4 4.05h-2A1.75 1.75 0 0 0 2.65 5.8v6c0 .966.783 1.75 1.75 1.75h7.2a1.75 1.75 0 0 0 1.75-1.75v-6a1.75 1.75 0 0 0-1.75-1.75h-2V8.8a1.6 1.6 0 0 1-3.2 0z"})]})},x=(0,g().wt)("squareAndArrowUpFillSmall",S),w={viewBox:"0 0 16 16",svg:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("path",{d:"M8.422.408a.625.625 0 0 0-.884 0l-2 2a.625.625 0 1 0 .884.884l.953-.953V8.8a.625.625 0 1 0 1.25 0V2.379l.913.913a.625.625 0 0 0 .884-.884z"}),(0,f.jsx)("path",{d:"M4.4 3.975A1.825 1.825 0 0 0 2.575 5.8v6c0 1.008.817 1.825 1.825 1.825h7.2a1.825 1.825 0 0 0 1.825-1.825v-6A1.825 1.825 0 0 0 11.6 3.975H9.525v1.25H11.6c.318 0 .575.257.575.575v6a.575.575 0 0 1-.575.575H4.4a.575.575 0 0 1-.575-.575v-6c0-.318.257-.575.575-.575h2.075v-1.25z"})]})},v=(0,g().wt)("squareAndArrowUpSmall",w);var m=()=>r(919709),C=()=>r(959013),b=()=>r(277942),j=()=>r(751156),y=()=>r(783793),T=()=>r(410930),k=()=>r(84817),I=()=>r(493823),M=()=>r(285790),B=()=>r(554509),A=()=>r(859428),W=()=>r(518598),V=()=>r(581495),N=()=>r(200562),E=()=>r(38337),D=()=>r(847743),F=()=>r(953418),z=()=>r(255063),K=()=>r(770906),L=()=>r(278105),H=()=>r(644914),R=()=>r(351360),P=()=>r(948914),Y=()=>r(847),_=()=>r(824544),U=()=>r(94522),O=()=>r(46986),q=()=>r(758417),Q=()=>r(317053),$=()=>r(182865),X=()=>r(65824),Z=()=>r(600434),G=()=>r(255299),J=()=>r(555102),ee=()=>r(907027),te=()=>r(810567),re=()=>r(201647),oe=()=>r(877531);const ne=(0,C().YK)({untitled_search:{id:"aiChatView.historyDropdown.untitledSearchTitle",defaultMessage:"Untitled Search"},new_chat_title:{id:"aiChatView.historyDropdown.newChatTitle",defaultMessage:"New chat"}});function ie(e){const{aiChatFeature:t,threadStore:r,config:c,onThreadChange:u,defaultUserMessage:h,clientStore:p,parentStore:g}=e,S=(0,Z().K)(t),[x,w]=(0,o.useState)(void 0),v=(0,n().v3)(),j=(0,i().K8)((()=>p.state.showDebug),[p]),{store:I,setValue:M}=(0,D().AI)({initialValue:(0,m().x9d)(h)});(0,L().i)({textStore:I,initialFocus:S.shouldHaveInitialFocusOnInput});const A=(0,o.useRef)(null),W=(0,o.useRef)(0),[V,N]=(0,o.useState)(!0),[E,K]=(0,o.useState)(!0),H=S.isInSidebarMode||Boolean(r),P=S.showWelcomeMessage&&!r,_=(0,i().K8)((()=>{if(!r)return;const e=r.getTranscript().reverse().find((e=>"config"===e.type));return null==e?void 0:e.value.type}),[r]),ne=(0,i().K8)((()=>(0,O().aj)()),[]),ie=(0,i().K8)((()=>((null==r?void 0:r.getTranscript())??[]).some((e=>"workflow-inference"===e.type))),[r]),se=(0,a().IS)((e=>({columnContainer:{minHeight:0,...!H&&{minHeight:void 0}},chatColumn:{flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",...!H&&{justifyContent:"center",minHeight:void 0}},contentWrapper:{flex:1,scrollbarGutter:"stable",overflowY:"auto",position:"relative",...!H&&{flex:"0 1 auto"}},contentContainer:{margin:"0 auto",width:"100%",maxWidth:800,padding:12,marginLeft:"auto"},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:e.surface.wash,padding:"0 0 12px",...!H&&{marginTop:24}},fullPageWelcomeContainer:{textAlign:"center",marginBottom:24,display:"flex",flexDirection:"column",alignItems:"center"},fullPageWelcomeTitle:{fontSize:30,fontWeight:600,color:e.text.primary,marginBottom:8,marginTop:26},scrollToBottomButton:{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:6,borderRadius:20,backgroundColor:"dark"===e.mode?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===e.mode?`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},inputContainer:{margin:"0 auto",width:"100%",maxWidth:S.chatInputWidth,padding:S.chatInputPadding,marginLeft:"auto"},gradientMask:{width:"100%",height:S.isInWorkflowEditor?32:44,pointerEvents:"none",position:"absolute",bottom:"100%",background:`linear-gradient(to bottom, rgba(248, 248, 247, 0), ${e.surface.wash})`},chevronDownIcon:{width:20,height:20,fill:"dark"===e.mode?"#000":e.white,transform:"translateY(1px)"},overflowContainer:{overflowY:"auto",...!H&&{overflowY:void 0}},lockedChatMessage:{padding:12,textAlign:"center"}})),[H,S]),le=(0,o.useCallback)((()=>{const e=A.current;if(!e)return;const t=e.scrollTop,r=t-W.current<0,o=e.scrollHeight-e.scrollTop-e.clientHeight<50;W.current=t,N(o),r&&!o&&E&&K(!1),"search"!==_&&o&&!E&&K(!0)}),[E,_]);(0,o.useEffect)((()=>{const e=A.current;if(!e)return;e.addEventListener("scroll",le);const t=new MutationObserver((()=>{E&&(e.scrollTop=e.scrollHeight),setTimeout(le,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(le,100),()=>{e.removeEventListener("scroll",le),t.disconnect()}}),[le,E]),(0,o.useEffect)((()=>{const e=A.current;if(!e)return;if("search"===_)return void K(!1);const t=setTimeout((()=>{e.scrollTop=e.scrollHeight,K(!0)}),100);return()=>clearTimeout(t)}),[_]);const ce=(0,o.useCallback)((()=>{const e=A.current;e&&F().VG({element:e,environment:v,options:{top:e.scrollHeight,behavior:"smooth"}})}),[v]),de=(0,o.useCallback)((()=>{ce(),K(!0)}),[ce]),ue=(0,i().O$)(R().AppStoreMainEditorCurrentBlockStore),he=(0,o.useCallback)((e=>{if(p.setState({...p.state,userSelectedConfig:!0}),!e||0===e.length)return;if(!g)throw new Error("No parent store");const t=R().default.state.currentSpaceStore;if(!t)throw new Error("No current space");const o=R().default.state.currentSpaceViewStore;if(!o)throw new Error("No current space view");const n=R().default.state.currentUserStore;if(!n)throw new Error("No current user");M(void 0);const i=((null==r?void 0:r.getTranscript())||[]).find((e=>"search"===e.type));r&&i&&void 0===i.showResults&&(0,X().V)({environment:v,threadStore:r,stepId:i.id,showResults:!1,traceId:i.traceId});const a=(0,J().Kf)({environment:v,spaceStore:t,userStore:n,value:e}),s=null==r?void 0:r.getTranscript().findLast((e=>"context"===e.type));if(r){const e=[];((null==s?void 0:s.value.collectionViewBlockId)??(null==s?void 0:s.value.blockId))!==(null==ue?void 0:ue.id)&&e.push((0,J().WM)({environment:v,userStore:n,spaceStore:t,spaceViewStore:o,blockStore:ue})),e.push(a),(0,Y().addStepsToExistingThreadAndRun)({environment:v,spaceStore:t,userStore:n,threadStore:r,clientStore:p,addSteps:e,waitForServerCommit:!0}),ce()}else{const r=c??p.state.configForNewTranscripts;if("workflow"===r.type&&null!=ue&&ue.isCollectionView()){const e=ue.getWorkflowStore();if(e){const r=(0,q().Y$)({environment:v,spaceStore:t,userStore:n,store:ue,workflowStore:e,addSteps:[a],spaceViewStore:o}),i=(0,Y().addTranscriptToNewThreadAndRun)({environment:v,clientStore:p,spaceStore:t,transcript:r,workflowStore:e});u(i)}else(0,Y().createEmptyWorkflowContainerAndBuild)({environment:v,parentStore:g,userStep:a,onThreadChange:u})}else if("setup-generator"===r.type)(0,Q().openSelectedTemplateOnboardingModalForInAppFlows)({parentStore:t,template:l().XK,environment:v,aiPrompt:e,origin:"ai_chat",version:"build_with_ai",autoSubmit:!0});else{const e=(0,J().Xd)({environment:v,spaceStore:t,userStore:n,config:r,addSteps:[a],blockStore:R().default.state.mainEditorCurrentBlockStore,spaceViewStore:o}),i=(0,Y().addTranscriptToNewThreadAndRun)({environment:v,clientStore:p,spaceStore:t,transcript:e});u(i)}}}),[g,M,r,v,p,c,u,ce,ue]),pe=(0,o.useCallback)((e=>{if(!e||0===e.length)return;const t=R().default.state.currentSpaceStore;if(!t)throw new Error("No current space");const r=R().default.state.currentUserStore;if(!r)throw new Error("No current user");const o=R().default.state.currentSpaceViewStore;if(!o)throw new Error("No current space view");if(!g)throw new Error("No parent store");const n=(0,J().Kf)({environment:v,spaceStore:t,userStore:r,value:e});(0,$().Wq)({clientStore:p,environment:v});const i=(0,J().Xd)({environment:v,spaceStore:t,userStore:r,config:{type:"search",scopeForNextSearch:{type:"everything"}},addSteps:[n],blockStore:R().default.state.mainEditorCurrentBlockStore,spaceViewStore:o}),a=(0,Y().addTranscriptToNewThreadAndRun)({environment:v,clientStore:p,spaceStore:t,transcript:i});u(a)}),[g,v,p,u]),ge=(0,i().K8)((()=>!e.config&&!r),[e.config,r]),fe=(0,o.useCallback)((e=>{const{transcript:t,threadId:r}=e;return(0,z().dC)(t)?j?(0,z().BI)({transcript:t,threadId:r}):(0,z().an)({transcript:t,threadId:r,preserveNonResearcherSteps:!0}):(0,G().fO)(t)&&!j?(0,G().nZ)(t):(0,s().q1)(t)&&!j?(0,U().SU)(t):t}),[j]),Se=(0,i().K8)((()=>(0,O().Ke)()),[]);return(0,f.jsxs)(f.Fragment,{children:[S.supportsChatHeader&&(0,f.jsx)(ae,{aiChatFeatureController:S,threadStore:r,clientStore:p,onThreadChange:u,initialQuery:x,parentStore:g}),(0,f.jsx)(k().Y1,{height:"fill",direction:"vertical",children:(0,f.jsxs)(k().Y1,{height:"fill",direction:"horizontal",style:se.columnContainer,children:[S.supportsCollapsiblePanel&&Se?(0,f.jsx)(T().z,{isOpen:j,width:{size:515,speed:"animate"},isResizable:!0,anchorToSide:"left",minSize:300,maxSize:900,children:(0,f.jsx)(re().m,{clientStore:p,threadStore:r})}):null,(0,f.jsx)(k().Y1,{height:"fill",direction:"vertical",style:se.overflowContainer,children:(0,f.jsx)("div",{style:se.chatColumn,children:H?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:se.contentWrapper,ref:A,children:(0,f.jsxs)("div",{style:se.contentContainer,children:[(0,f.jsx)(te().H,{handleNewSearch:pe,clientStore:p,threadStore:r,setInitialQuery:w,aiChatFeatureController:S}),(0,f.jsx)(ee().Lm,{clientStore:p,config:c,threadStore:r,preprocessTranscript:fe,aiChatFeatureController:S}),(0,f.jsx)(oe().Qd,{clientStore:p,threadStore:r})]})}),(0,f.jsxs)("div",{style:se.inputWrapper,children:[(0,f.jsx)("button",{onClick:de,style:{...se.scrollToBottomButton,...!V&&se.scrollToBottomButtonVisible},children:(0,d().arrowChevronSingleDownFillIcon)(se.chevronDownIcon)}),(0,f.jsx)("div",{style:se.gradientMask}),(0,f.jsx)("div",{style:se.inputContainer,children:ne?(0,f.jsx)("div",{children:ie?(0,f.jsx)(B().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",customStyles:se.lockedChatMessage,children:(0,f.jsx)(C().sA,{id:"agentChatView.lockedChatMessage",defaultMessage:"This thread was created using an older version of Notion AI. Please create a new thread to continue."})}):(0,f.jsx)(b().ev,{store:I,onSubmit:he,clientStore:p,threadStore:r,showInitialModePicker:ge,aiChatFeatureController:S,config:c})}):(0,f.jsx)(b().ev,{store:I,onSubmit:he,clientStore:p,threadStore:r,showInitialModePicker:ge,aiChatFeatureController:S,config:c})})]})]}):(0,f.jsxs)("div",{style:se.inputWrapper,children:[P&&(0,f.jsxs)("div",{style:se.fullPageWelcomeContainer,children:[(0,f.jsx)(y().o,{variant:"large"}),(0,f.jsx)("div",{style:se.fullPageWelcomeTitle,children:(0,f.jsx)(C().sA,{id:"aiInferenceTranscript.fullPageWelcomeTitle",defaultMessage:"How can I help you today?"})})]}),(0,f.jsx)("div",{style:se.inputContainer,children:(0,f.jsx)(b().ev,{store:I,onSubmit:he,clientStore:p,threadStore:r,showInitialModePicker:ge,aiChatFeatureController:S,config:c})})]})})})]})})]})}function ae(e){const{aiChatFeatureController:t,onThreadChange:r,clientStore:a,initialQuery:s,threadStore:l,parentStore:c}=e,d=(0,n().v3)(),u=(0,o.useContext)(V().eh),{isElectronWindows:h}=(0,n().Y0)(),{isShowingTabBar:p}=(0,i().O$)(P().A),g=(0,o.useCallback)((e=>{(0,$().Wq)({environment:d,clientStore:a}),r(e)}),[a,r,d]),S=(0,i().K8)((()=>!(0,H().KB)(d)),[d]),x=d.device.isElectron&&!p,w=t.supportsThreadHistoryPicker?(0,f.jsx)(_().X,{threadStore:l,onThreadChange:g,parentStore:c}):(0,f.jsx)(ue,{threadStore:l,initialQuery:s});return(0,f.jsx)(k().Y1,{direction:"vertical",width:"fill",children:(0,f.jsx)(k().Y1,{className:x?E().sbV:void 0,direction:"vertical",padding:"6px 12px 8px 8px",width:"fill",gap:4,children:(0,f.jsxs)(k().Y1,{direction:"horizontal",align:"center",gap:"auto",children:[S&&t.supportsNotionSidebarButton?(0,f.jsx)("div",{style:{margin:4},children:(0,f.jsx)(N().z,{})}):null,w,(0,f.jsxs)(k().Y1,{direction:"horizontal",align:"center-right",gap:2,style:{flexShrink:0},children:[(0,f.jsx)(se,{threadStore:l}),(0,f.jsx)(le,{clientStore:a}),(0,f.jsx)(ce,{onNewChat:()=>g(void 0)}),u?(0,f.jsx)(de,{onClick:u}):null]}),h&&(0,f.jsx)(W().K,{})]})})})}function se(e){const{threadStore:t}=e,r=(0,n().v3)(),l=(0,C().tz)(),c=(0,i().K8)((()=>{var e;return(null==t||null===(e=t.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[t]),d=(0,o.useCallback)((()=>{t&&j().createAndCommit({userAction:"AIChatHeader.toggleShareWithSpace",environment:r,canUndo:!0,perform:e=>{(0,$().g6)({threadStore:t,transaction:e})}})}),[t,r]),u=(0,a().IS)((e=>({iconButton:{width:28,height:28},iconButtonIcon:{width:16,height:16,fill:c?e.icon.uiBluePrimary:e.icon.primary}})),[c]),h=(0,i().K8)((()=>t&&!t.canEdit()),[t]);return(0,i().K8)((()=>(0,s().q1)((null==t?void 0:t.getTranscript())??[])),[t])?(0,f.jsx)(A().A,{renderTooltip:()=>(0,f.jsx)(C().sA,{id:"aiChatView.shareWithSpaceTooltip",defaultMessage:"Share with workspace"}),render:e=>(0,f.jsx)(M().A,{...e,icon:c?x:v,iconStyle:u.iconButtonIcon,style:u.iconButton,onClick:d,disabled:h,ariaLabel:l.formatMessage({id:"aiChatView.shareWithSpace",defaultMessage:"Share with workspace"})})}):null}function le(e){const t=(0,C().tz)(),{clientStore:r}=e,n=he(),a=(0,o.useCallback)((()=>{r.setState({...r.state,showDebug:!r.state.showDebug})}),[r]);return(0,i().K8)((()=>(0,O().Ke)()),[])?(0,f.jsx)(A().A,{renderTooltip:()=>(0,f.jsx)(C().sA,{id:"aiChatView.debugTooltip",defaultMessage:"Debug"}),render:e=>(0,f.jsx)(M().A,{...e,icon:u().E,iconStyle:n.iconButtonIcon,style:n.iconButton,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:a})}):null}function ce(e){let{onNewChat:t}=e;const r=(0,C().tz)(),o=he();return(0,f.jsx)(A().A,{renderTooltip:()=>(0,f.jsx)(C().sA,{id:"aiChatView.newChatTooltip",defaultMessage:"New chat"}),render:e=>(0,f.jsx)(M().A,{...e,icon:p().W,iconStyle:o.iconButtonIcon,style:o.iconButton,ariaLabel:r.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New chat"}),onClick:t})})}function de(e){const t=(0,C().tz)(),r=he();return(0,f.jsx)(A().A,{renderTooltip:()=>(0,f.jsx)(C().sA,{id:"chatSidebar.close",defaultMessage:"Close"}),render:o=>(0,f.jsx)(M().A,{...o,icon:h().a,iconStyle:r.iconButtonIcon,style:r.iconButton,ariaLabel:t.formatMessage({id:"chatSidebar.close",defaultMessage:"Close"}),onClick:e.onClick})})}function ue(e){const{threadStore:t,initialQuery:r}=e,s=(0,C().tz)(),l=(0,n().v3)(),d=(0,i().K8)((()=>{var e;const o=null==t||null===(e=t.getData())||void 0===e?void 0:e.title;if(o)return o;if(r){if(r.every((e=>(0,m().bHQ)(e))))return(0,m().q4_)(r)}return s.formatMessage(ne.untitled_search)}),[s,t,r]),u=Boolean(t),h=(0,o.useCallback)((()=>{(0,K().ZT)({environment:l,contentType:"assistant"})}),[l]),p=(0,a().IS)((e=>({chevronDownIcon:{width:16,marginLeft:6,fill:e.mediumIconColor,flexShrink:0},threadTitleInDropdown:{maxWidth:"250px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}})),[]);return(0,f.jsxs)(I().p,{"aria-label":"history",size:"lg",onClick:h,children:[(0,f.jsx)(B().D,{styleName:"UIRegular-14px/Medium",style:p.threadTitleInDropdown,children:u?d:s.formatMessage(ne.new_chat_title)}),(0,f.jsx)(f.Fragment,{children:(0,c().arrowChevronSingleDownIcon)(p.chevronDownIcon)})]})}function he(){return(0,a().IS)((e=>({iconButton:{width:28,height:28},iconButtonIcon:{width:16,height:16,fill:e.icon.primary}})),[])}},996624:(e,t,r)=>{r.d(t,{a:()=>n});r(296540);var o=r(474848);const n=(0,r(340498).wt)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})}}]);