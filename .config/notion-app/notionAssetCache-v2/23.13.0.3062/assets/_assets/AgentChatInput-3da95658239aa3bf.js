"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90068],{333470:(e,t,n)=>{n.r(t),n.d(t,{AgentChatInput:()=>$});var o=n(296540),a=()=>n(908006),i=()=>n(484714),s=()=>n(847249),r=()=>n(401497),l=()=>n(383286),c=()=>n(102777),d=()=>n(528782),p=()=>n(919709),u=()=>n(959013),g=()=>n(534177),f=()=>n(277942),h=()=>n(829300),m=()=>n(319975),x=()=>n(725614),S=()=>n(751156),b=()=>n(220331),I=()=>n(285790),C=()=>n(524702),A=()=>n(549500),y=()=>n(989423),w=()=>n(38337),v=()=>n(792540),M=()=>n(231722),k=()=>n(963589),j=()=>n(301421),T=()=>n(351360),K=()=>n(24157),_=()=>n(298182),G=()=>n(46986),P=()=>n(182865),B=()=>n(717375),E=()=>n(70128),F=()=>n(412039),R=()=>n(756219),D=()=>n(308903),O=n(474848);const N=(0,u().YK)({placeholder:{id:"aiInferenceTranscript.placeholder",defaultMessage:"Ask AI anything..."}});function $(e){const t=(0,u().tz)(),{store:n,onSubmit:$,clientStore:L,threadStore:U,showInitialModePicker:W,aiChatFeatureController:Y,config:z}=e,X=(0,i().v3)(),[J,Q]=o.useState(!1),Z=(0,s().K8)((()=>0===(0,p().AhH)(n.getValue()||[])),[n]),ee=(0,s().K8)((()=>n.getValue()),[n]),te=(0,s().K8)((()=>Boolean(void 0!==(null==U?void 0:U.getCurrentInferenceId())||(null==U?void 0:U.id)&&L.getClientAIChatThreadStore(U.id).state.loading)),[U,L]),ne=(0,o.useCallback)((()=>{if(!U)return;const{serverCommitResult:e}=S().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:X,canUndo:!0,perform:e=>{(0,P().GS)({threadStore:U,transaction:e,clientStore:L})}}),t=L.getClientAIChatThreadStore(U.id);t.setState({...t.state,stopInferencePromise:e})}),[X,U,L]),oe=(0,o.useCallback)((async()=>{const{dictationActions:e}=await A().$O.load(),t=(0,p().q4_)(n.getValue()||[]);await e.StreamingDictationManager.start({environment:X,onTranscription:e=>{const o=t?`${t}\n${e}`:e;S().createAndCommit({userAction:"AIChatInput.handleDictation",environment:X,canUndo:!0,perform:e=>{m().R9({environment:X,store:n,value:(0,p().x9d)(o),transaction:e})}})}}),Q(!0)}),[X,n]),ae=(0,o.useCallback)((async()=>{const{dictationActions:e}=await A().$O.load();await e.StreamingDictationManager.stop(),Q(!1)}),[]);(0,o.useEffect)((()=>()=>{ae()}),[ae]);const ie=(0,s().O$)(T().AppStoreCurrentSpaceStore),se=(0,s().K8)((()=>null==ie?void 0:ie.id),[ie]),re=(0,s().K8)((()=>{var e;return null===(e=X.currentUser)||void 0===e?void 0:e.id}),[X.currentUser]),le=(0,s().K8)((()=>(0,B().ak)({spaceStore:ie})),[ie]),ce=W&&Y.supportsModePicker,de=(0,k().X)("workflows_use_agent")&&z&&"workflow"===z.type;(0,E().M)({textValue:ee,isEnabled:Y.supportsAutoRouting,clientStore:L,configs:le});const pe=(0,r().IS)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1,borderRadius:12},wrap:{display:"flex",fontSize:12,alignItems:"center",flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.surface.elevated:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"8px 12px 12px 12px",minHeight:56,maxHeight:240,overflow:"auto",fontSize:14},placeholder:{opacity:1,cursor:"text",minHeight:56},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 10px",gap:4},leftGutter:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",padding:"0 0 6px 6px"},sendButtonIcon:{width:28,height:28,padding:"0 0 0 4px"},sendButton:{width:28,height:28},microphoneIcon:{width:28},stopIcon:{width:28,height:28},inputActionsRow:{display:"flex",width:"100%",justifyContent:"space-between",overflow:"hidden",height:40}})),[]),ue=(0,o.useCallback)((async()=>{const e=K().default.state;"editing"===e.mode&&(0,M().KP)(e.multiSelection)&&e.multiSelection.start.store===n||(x().setSelectionAtEnd({store:n}),await a().default.afterNextFlush())}),[n]),ge=(0,s().K8)((()=>!U||U.canEdit()),[U]),fe=(0,o.useCallback)((()=>{ge&&!te&&(null==$||$(n.getValue()),requestAnimationFrame((()=>{const e=j().n.findNodeFromStore(n);e&&e.focus()})))}),[$,n,te,ge]),he=(0,s().K8)((()=>L.state.configForNewTranscripts),[L]),me=(0,o.useMemo)((()=>function(e){const{config:t,threadStore:n,intl:o}=e;if(n){const e=H[t.type];if(e)return o.formatMessage(e);const n=q[t.type];return n?o.formatMessage(n):o.formatMessage(N.placeholder)}if("markdown-chat"===t.type){const e=t.model;if(e){const t=(0,g().O)(V,e)?V[e]:void 0;if(t)return o.formatMessage(t)}}const a=q[t.type];if(a)return o.formatMessage(a);return o.formatMessage(N.placeholder)}({config:he,threadStore:U,intl:t})),[he,U,t]),xe=(0,s().K8)((()=>(0,G().aj)()),[]),Se=Y.supportsTranscription;return(0,O.jsxs)("div",{style:pe.stagingAndInputWrap,tabIndex:0,className:w().CCX,children:[xe&&(0,O.jsx)(F()._,{clientStore:L}),(0,O.jsxs)("div",{style:pe.wrap,children:[(0,O.jsx)(C().A,{style:pe.textContainer,placeholder:me,disabled:!1,store:n,placeholderStyle:pe.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:fe,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:v().Os.none,usePopupForMentionOnMobile:!0,disableMentions:!Y.shouldAllowMentions,disabledMentionTypes:_().md}),(0,O.jsxs)("div",{style:pe.inputActionsRow,children:[ce&&(0,O.jsx)("div",{style:pe.leftGutter,children:(0,O.jsx)(f()._,{clientStore:L,configs:le,spaceId:se,userId:re})}),de&&(0,O.jsx)("div",{style:pe.leftGutter,children:(0,O.jsx)(f().rm,{clientStore:L})}),(0,O.jsx)("div",{style:{flexGrow:1}}),(0,O.jsxs)("div",{style:pe.rightGutter,children:[Y.supportsWebSearch(he.type)&&(0,O.jsx)(D().l,{clientStore:L}),Y.supportsSearchScopePopup(he.type)&&(0,O.jsx)(R().d,{clientStore:L,threadStore:U}),Y.shouldAllowMentions&&(0,O.jsx)(b().q,{onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){await ue(),await a().default.afterNextFlush(),h().Gf({environment:X,mentionTypes:_().Ap,usePopupOnMobile:!0}),(0,y().u4)({environment:X,event:{eventName:"clicked_ai_chat_at_mention_button",eventProperties:{mode:he.type}}})}()}}),J?(0,O.jsx)(I().A,{icon:d().m,onClick:ae,iconStyle:pe.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"})},"stop-recording"):te?(0,O.jsx)(I().A,{icon:d().m,onClick:ne,iconStyle:pe.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"})},"stop-inference"):(0,O.jsxs)(O.Fragment,{children:[!J&&Se&&(0,O.jsx)(I().A,{icon:l().E,onClick:oe,iconStyle:pe.microphoneIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"})},"start-recording"),(0,O.jsx)(I().A,{icon:c().b,onClick:fe,style:pe.sendButton,iconStyle:pe.sendButtonIcon,isDarkIconColor:!Z,disabled:Z,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.submitAiMessage",defaultMessage:"Submit AI message"})},"send-message")]})]})]})]})]})}const V=(0,u().YK)({"anthropic-sonnet-3.7":{id:"AIChatInput.placeholder.anthropicSonnet3Point7",defaultMessage:"Ask Claude…"},"openai-gpt-4.1":{id:"AIChatInput.placeholder.openaiGpt4o",defaultMessage:"Ask ChatGPT…"}}),q=(0,u().YK)({search:{id:"AIChatInput.placeholder.agent",defaultMessage:"Send a message…"}}),H=(0,u().YK)({researcher:{id:"aiInferenceTranscript.research_mode_placeholder",defaultMessage:"Ask a follow up question..."}})}}]);