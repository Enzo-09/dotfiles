"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11097,64165,90871],{33218:(e,t,o)=>{o.d(t,{UQ:()=>f,gL:()=>g});o(16280),o(898992),o(672577),o(803949);var n=()=>o(651124),r=()=>o(792071),i=()=>o(688728),a=()=>o(369186),s=()=>o(475140),c=()=>o(235692),l=()=>o(778781),d=()=>o(696706),u=()=>o(896628),p=()=>o(751156);function f(e){let{environment:t,transaction:o,layoutStore:n,position:c,updatedModule:l,sessionId:d}=e;const u=i().Zm[c.area],f=n.getRawModules();if("form_conditional_modules"===u){const e=null==f?void 0:f[u];if(!(null==e?void 0:e[c.moduleId]))throw new Error("Unable to find module being updated.");return void p().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){p().applyOperation({transaction:e,store:n,operation:r().N4X.updateModuleInArea({pointer:n.pointer,area:u,module:(0,a().Lv)(l)})})},userAction:"BuilderLayoutModules.updateModule"})}if(!f)throw new Error("Unable to find modules");const m=(0,s().LC)(f,(e=>e.id===c.moduleId));if(!m||m.area!==u)throw new Error("Unable to find module being updated.");p().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){p().applyOperation({transaction:e,store:n,operation:r().N4X.updateModuleInArea({pointer:n.pointer,module:(0,a().Lv)(l),..."views_main_tab_modules"===m.area?{area:m.area,viewId:m.viewId}:{area:m.area}})})},userAction:"BuilderLayoutModules.updateModule"})}function m(e){var t,o,n;let{collectionStore:r,layoutStore:i}=e;const a=new Map,s=r.getFormat(),c=[...null===(t=i.getModules())||void 0===t?void 0:t.page_main,...null===(o=i.getModules())||void 0===o?void 0:o.page_details],d=new Map;null===(n=s.property_visibility)||void 0===n||n.forEach((e=>{d.set(e.property,e)})),c.forEach((e=>{if(!(0,l()._Q)(e))return(0,l().gx)(e)?(a.set(e.propertyId,{property:e.propertyId}),void d.set(e.propertyId,{property:e.propertyId,visibility:"show"})):void 0;e.propertyIds.forEach((e=>{a.set(e,{property:e}),d.set(e,{property:e,visibility:"show"})}))}));const u=r.getNormalizedPropertyGroups();var p;u?u.forEach((e=>{var t;null===(t=e.propertyIds)||void 0===t||t.forEach((e=>{a.has(e)||a.set(e,{property:e})}))})):null===(p=s.collection_page_properties)||void 0===p||p.forEach((e=>{a.has(e.property)||a.set(e.property,e)}));return{propertiesFormat:Array.from(a.values()),propertyVisibility:Array.from(d.values())}}function g(e){let{environment:t,transaction:o,collectionStore:i,layoutStore:a}=e;const{propertiesFormat:s,propertyVisibility:f}=m({collectionStore:i,layoutStore:a});p().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){const t=a.getBlockChildrenPointers(),o=a.getFormat(),m=a.firstModuleOfType("viewsMain");m&&(0,l().y6)(m)&&t.find((e=>d().L3.isEqual(e,m.collection_view_block_pointer)))&&p().applyOperation({transaction:e,store:a,operation:r().N4X.removeBlockChild(a.pointer,m.collection_view_block_pointer.id)});const g=null==o?void 0:o.previousViewsMainCollectionViewBlockPointer,y=g&&t.find((e=>d().L3.isEqual(e,g)));y&&p().applyOperation({transaction:e,store:a,operation:r().N4X.removeBlockChild(a.pointer,y.id)}),p().applyOperation({transaction:e,store:a,operation:r().N4X.setModulesByAreas(a.pointer,(0,c().K5)())}),p().applyOperation({transaction:e,store:a,operation:r().N4X.deleteFormat(a.pointer)});const v=i.getFormat(),{page_section_visibility:w}=v;u().zA({stores:[i],update:{property_groups:void 0,collection_page_properties:s,property_visibility:f,...w?{page_section_visibility:n().Zi}:void 0},transaction:e})},userAction:"BuilderLayoutModules.resetLayoutToDefault"})}},105819:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineIcon:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},r=(0,o(340498).wt)("pencilLine",n)},120250:(e,t,o)=>{o.r(t),o.d(t,{CustomCollectionView:()=>P});o(16280),o(898992),o(354520),o(672577),o(430670),o(581454);var n=o(296540),r=()=>o(484714),i=()=>o(847249),a=()=>o(401497),s=()=>o(362750),c=()=>o(769607),l=()=>o(637433),d=()=>o(402390),u=()=>o(919709),p=()=>o(751735),f=()=>o(100622),m=()=>o(284371);const g={default:f().Tj.defaultText,defaultForeground:"rgb(255, 255, 255)",background:"rgb(255, 255, 255)",foreground:f().Tj.defaultText,primary:f().Tj.blue,primaryForeground:"rgb(255, 255, 255)",secondary:f().Tj.contentGrayBackground,secondaryForeground:f().Tj.defaultText,accent:f().XA.light.uiBlue[600],accentForeground:"rgb(255, 255, 255)",muted:(0,p().X4)(f().CM.light.lightgray,.5),mutedForeground:f().Tj.uiGray,border:(0,p().X4)(f().CM.light.darkgray,.16)},y={default:"rgb(255, 255, 255)",defaultForeground:"rgb(25, 25, 25)",background:"rgb(25, 25, 25)",foreground:"rgb(235, 235, 235)",primary:f().Tj.blue,primaryForeground:"rgb(255, 255, 255)",secondary:(0,p().X4)(f().CM.dark.darkgray,.8),secondaryForeground:"rgb(235, 235, 235)",accent:f().XA.light.uiBlue[600],accentForeground:"rgb(255, 255, 255)",muted:(0,p().X4)(f().CM.dark.darkgray,.8),mutedForeground:(0,p().X4)(f().CM.dark.lightgray,.6),border:(0,p().X4)("white",.13)},v=`\n:root {\n  --default: ${g.default};\n  --default-foreground: ${g.defaultForeground};\n  --primary: ${g.primary};\n  --primary-foreground: ${g.primaryForeground};\n  --secondary: ${g.secondary};\n  --secondary-foreground: ${g.secondaryForeground};\n  --accent: ${g.accent};\n  --accent-foreground: ${g.accentForeground};\n  --background: ${g.background};\n  --foreground: ${g.foreground};\n  --muted: ${g.muted};\n  --muted-foreground: ${g.mutedForeground};\n  --border: ${g.border};\n}\n\n.dark {\n  --default: ${y.default};\n  --default-foreground: ${y.defaultForeground};\n  --primary: ${y.primary};\n  --primary-foreground: ${y.primaryForeground};\n  --secondary: ${y.secondary};\n  --secondary-foreground: ${y.secondaryForeground};\n  --accent: ${y.accent};\n  --accent-foreground: ${y.accentForeground};\n  --background: ${y.background};\n  --foreground: ${y.foreground};\n  --muted: ${y.muted};\n  --muted-foreground: ${y.mutedForeground};\n  --border: ${y.border};\n}\n`;var w=()=>o(959013),_=()=>o(498212),h=()=>o(449506),S=()=>o(555102),M=()=>o(166442),k=()=>o(864943),b=()=>o(351360),I=()=>o(847),C=()=>o(691093),x=()=>o(94522),A=()=>o(538891),T=()=>o(46986),E=()=>o(758417),N=()=>o(324577),F=o(474848);function P(e){const{paddingLeft:t,paddingRight:o,collectionViewStore:c,collectionContextStore:l,store:d}=e,p=(0,r().v3)(),f=(0,i().K8)((()=>(0,T().sx)()),[]),m=(0,a().IS)((e=>({container:{paddingLeft:t??0,paddingRight:o??0,display:"flex",flexDirection:"column",height:"100%"}})),[t,o]),g=(0,i().K8)((()=>l.collectionViewBlockStore()),[l]),y=(0,N().Y)(g),v=(0,i().K8)((()=>null==y?void 0:y.getData()),[y]),w=(0,i().K8)((()=>(0,A().Bn)(v)),[v]),_=(0,i().K8)((()=>{if(!v||!w||0===w.length)return{result:void 0,error:void 0};try{const e=function(e){const{workflow:t,functions:o,collectionViewId:n}=e,r=(0,x().FY)({collectionViewId:n,workflow:t});if(!r)return;const i=R({functionKey:r,functions:o}),a=i.flatMap((e=>e.callsFunctions||[])),s=o.filter((e=>a.includes(e.key)&&"server_function"===e.type));return{functionKey:r,code:i.map((e=>e.value||"")).join("\n\n"),serverFunctionKeys:s.map((e=>e.key))}}({workflow:v,functions:w,collectionViewId:c.id});return{result:e,error:void 0}}catch(e){return{result:void 0,error:(0,s().OG)(e)}}}),[v,w,c]),{spaceStore:h,userStore:k,spaceId:P,spaceViewStore:O}=(0,i().K8)((()=>{const{currentSpaceStore:e,currentUserStore:t,currentSpaceViewStore:o}=b().default.state;return e&&t&&o?{spaceStore:e,userStore:t,spaceId:e.id,spaceViewStore:o}:{spaceStore:void 0,userStore:void 0,spaceId:void 0,spaceViewStore:void 0}}),[]),$=(0,n.useCallback)((()=>{if(!h||!y||!_.error)return;const e=y.getData();if(!e)return;const t=(0,x().FY)({collectionViewId:c.id,workflow:e});if(!t)return;const o=(0,S().XZ)({environment:p,spaceStore:h,functionKey:t,message:(0,u().x9d)(_.error)}),n=(0,E().Y$)({environment:p,spaceStore:h,userStore:k,store:d,spaceViewStore:O,workflowStore:y,addSteps:[o]}),r=(0,I().addTranscriptToNewThreadAndRun)({environment:p,spaceStore:h,clientStore:M().Kd,transcript:n,workflowStore:y});(0,C().showWorkflowEditor)({environment:p,chatSidebarState:{isOpen:!0,threadId:r.id},parentStore:d})}),[p,_.error,y,c,h,k,O,d]);return f&&P&&y&&d?_.error?(0,F.jsx)("div",{style:m.container,children:(0,F.jsx)(V,{error:_.error,workflowStore:y,store:d,collectionViewStore:c,onFixErrors:$})}):_.result?(0,F.jsx)("div",{style:m.container,children:(0,F.jsx)(D,{code:_.result.code,functionKey:_.result.functionKey,serverFunctionKeys:_.result.serverFunctionKeys,workflowId:y.id,spaceId:P,workflowStore:y,store:d,collectionViewStore:c})}):null:null}function R(e){const{functionKey:t,functions:o}=e,n=o.find((e=>e.key===t));if(!n)throw new Error(`Function ${t} not found`);return[n,...(n.callsFunctions||[]).map((e=>{const t=o.find((t=>t.key===e));if(!t)throw new Error(`Function ${e} not found`);return t})).filter((e=>"client_react_component"===e.type)).flatMap((e=>R({functionKey:e.key,functions:o})))]}function D(e){const{code:t,functionKey:o,serverFunctionKeys:a,workflowId:s,spaceId:c,workflowStore:l,store:p,collectionViewStore:f}=e,g=(0,r().v3)(),[y,k]=n.useState([]),[A,T]=n.useState([]),N=n.useRef(null),P=(0,w().tz)(),R=(0,d().H)(P),D=n.useMemo((()=>(0,_().lZ)()),[]);n.useEffect((()=>{const e=async e=>{var t;if(N.current&&e.source===N.current.contentWindow&&(null===(t=e.data)||void 0===t?void 0:t.securityToken)===D){const{type:t,functionKey:i,args:l,requestId:d,error:u,log:p}=e.data;if(u&&k((e=>[...e,u])),p&&T((e=>[...e,p])),"callServerFunction"===t&&a.includes(i))try{var o;const e=await h().callApi({eventName:"callWorkflowFunction",environment:g,data:{workflowId:s,spaceId:c,functionKey:i,functionArgs:l||{}}});null===(o=N.current.contentWindow)||void 0===o||o.postMessage({type:"serverFunctionResponse",requestId:d,securityToken:D,result:"failed"===e.type?null:e.data.returnValue,error:"failed"===e.type?e.error:null,success:"failed"!==e.type},"*")}catch(r){var n;null===(n=N.current.contentWindow)||void 0===n||n.postMessage({type:"serverFunctionResponse",requestId:d,securityToken:D,result:null,error:r instanceof Error?r.message:String(r),success:!1},"*")}}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[a,s,c,g,D]);const O=`\n\t\t// @ts-nocheck - Disable TypeScript type checking for this script\n\t\t// Isolated scope for the workflow code\n\t\t(function() {\n\t\t\t// Override console methods to capture logs\n\t\t\tconst originalConsole = { ...console };\n\t\t\tconst consoleTypes = ['log', 'info', 'warn', 'error', 'debug'];\n\n\t\t\tconsoleTypes.forEach(type => {\n\t\t\t\tconsole[type] = (...args) => {\n\t\t\t\t\toriginalConsole[type](...args);\n\t\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\t\ttype: 'consoleLog',\n\t\t\t\t\t\tlog: { type, args: JSON.parse(JSON.stringify(args)) },\n\t\t\t\t\t\tsecurityToken: "${D}"\n\t\t\t\t\t}, "*");\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// Set up global error handling\n\t\t\twindow.onerror = (message, source, lineno, colno, error) => {\n\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\terror: {\n\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\tstack: error?.stack,\n\t\t\t\t\t\tsource,\n\t\t\t\t\t\tlineno,\n\t\t\t\t\t\tcolno\n\t\t\t\t\t},\n\t\t\t\t\tsecurityToken: "${D}"\n\t\t\t\t}, "*");\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\twindow.addEventListener('unhandledrejection', (event) => {\n\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\terror: {\n\t\t\t\t\t\tmessage: event.reason?.message || 'Unhandled Promise Rejection',\n\t\t\t\t\t\tstack: event.reason?.stack\n\t\t\t\t\t},\n\t\t\t\t\tsecurityToken: "${D}"\n\t\t\t\t}, "*");\n\t\t\t});\n\n\t\t\t${t}\n\n\t\t\t// Setup bridge for server function calls\n\t\t\tconst pendingRequests = new Map();\n\t\t\tlet requestCounter = 0;\n\t\t\tconst securityToken = "${D}";\n\n\t\t\twindow.addEventListener('message', (event) => {\n\t\t\t\t// Validate the message has our security token\n\t\t\t\tif (event.source === window.parent &&\n\t\t\t\t    event.data &&\n\t\t\t\t    event.data.type === 'serverFunctionResponse' &&\n\t\t\t\t    event.data.securityToken === securityToken) {\n\n\t\t\t\t\tconst { requestId, result, error, success } = event.data;\n\t\t\t\t\tconst resolver = pendingRequests.get(requestId);\n\n\t\t\t\t\tif (resolver) {\n\t\t\t\t\t\tpendingRequests.delete(requestId);\n\t\t\t\t\t\tif (!success) {\n\t\t\t\t\t\t\tresolver.reject(new Error(error));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t// Always parse the result as JSON\n\t\t\t\t\t\t\t\tresolver.resolve(result ? JSON.parse(result) : null);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// If parsing fails, return the raw result\n\t\t\t\t\t\t\t\tresolver.resolve(result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t${a.map((e=>`\n\t\t\t\t\tasync function ${e}(args) {\n\t\t\t\t\t\tconst requestId = requestCounter++;\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\t\tpendingRequests.set(requestId, { resolve, reject });\n\n\t\t\t\t\t\t\t// Always stringify args\n\t\t\t\t\t\t\tconst safeArgs = args ? JSON.parse(JSON.stringify(args)) : {};\n\n\t\t\t\t\t\t\t// Use security token\n\t\t\t\t\t\t\twindow.parent.postMessage({\n\t\t\t\t\t\t\t\ttype: 'callServerFunction',\n\t\t\t\t\t\t\t\tfunctionKey: '${e}',\n\t\t\t\t\t\t\t\targs: safeArgs,\n\t\t\t\t\t\t\t\trequestId,\n\t\t\t\t\t\t\t\tsecurityToken\n\t\t\t\t\t\t\t}, "*");\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t`)).join("\n")}\n\n\t\t\t// Render the component\n\t\t\ttry {\n\t\t\t\tconst rootElement = document.getElementById('root');\n\t\t\t\tconst root = ReactDOM.createRoot(rootElement);\n\t\t\t\troot.render(React.createElement(${o}, {}));\n\t\t\t} catch (error) {\n\t\t\t\t// Error rendering component\n\t\t\t\tconsole.error("[Iframe] Error rendering component:", error);\n\t\t\t}\n\t\t})();\n\t`,$=(0,i().O$)(g.ThemeModeStore),B=`\n\t\t<!DOCTYPE html>\n\t\t<html class="${"dark"===$?"dark":""}">\n\t\t<head>\n\t\t\t<meta charset="utf-8">\n\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1">\n\t\t\t<meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src https://unpkg.com 'unsafe-inline'; style-src 'unsafe-inline'; connect-src 'none';">\n\t\t\t<script src="https://unpkg.com/react@18.2.0/umd/react.development.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/@babel/standalone@7.26.9/babel.min.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/dayjs-with-plugins@1.0.4/dist/dayjs-with-plugins.min.js" crossorigin defer><\/script>\n\t\t\t<script src="https://unpkg.com/@tailwindcss/browser@4" crossorigin><\/script>\n\t\t\t<style>\n\t\t\t\t#code {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t${v}\n\t\t\t\t${function(e){return`\n/* Base styles */\nbody {\n\tbackground-color: var(--background);\n\tcolor: var(--foreground);\n\tfont-family: ${(0,m().vc)(e).sans};\n\tline-height: 1.5;\n\t-webkit-font-smoothing: antialiased;\n}\n`}(R)}\n\t\t\t</style>\n\t\t</head>\n\t\t<body>\n\t\t\t<div id="root" class="p-4"></div>\n\t\t\t<div id="code">${encodeURIComponent(O)}</div>\n\t\t\t<script>\n\t\t\t\twindow.addEventListener('DOMContentLoaded', () => {\n\t\t\t\t\tconst code = decodeURIComponent(document.getElementById('code')?.textContent || '');\n\t\t\t\t\twindow.now = new Date().toISOString();\n\t\t\t\t\twindow.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\t\t\t\t\twindow.safeJSONParse = (str) => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn JSON.parse(str);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (code) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// Transpile TypeScript to JavaScript\n\t\t\t\t\t\t\tconst tsCode = code;\n\t\t\t\t\t\t\tconst jsCode = Babel.transform(tsCode, {\n\t\t\t\t\t\t\t\tpresets: ['typescript', 'react'],\n\t\t\t\t\t\t\t\tfilename: 'component.tsx'\n\t\t\t\t\t\t\t}).code;\n\t\t\t\t\t\t\tconst executeScript = document.createElement('script');\n\t\t\t\t\t\t\texecuteScript.textContent = jsCode;\n\t\t\t\t\t\t\tdocument.body.appendChild(executeScript);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error("[Iframe] Error transpiling or executing code:", error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t<\/script>\n\t\t</body>\n\t\t</html>\n\t`;(0,n.useEffect)((()=>{const e=document.querySelector("iframe");null!=e&&e.contentWindow&&e.contentWindow.postMessage({type:"themeChange",isDark:"dark"===$},"*")}),[$]);const j=(0,n.useCallback)((()=>{const e=b().default.state.currentSpaceStore;if(!e)throw new Error("No space store");const t=b().default.state.currentSpaceViewStore;if(!t)throw new Error("No space view store");const o=b().default.state.currentUserStore;if(!o)throw new Error("No space store or user store");const n=l.getData();if(!n)return;const r=(0,x().FY)({collectionViewId:f.id,workflow:n});if(!r)return;(0,C().showWorkflowEditor)({environment:g,parentStore:p});const i=`Found errors in custom view with key ${r}:\n${y.map((e=>`Error: ${e.message}${e.stack?`\nStack: ${e.stack}`:""}`)).join("\n")}\n\nConsole logs:\n${A.map((e=>`[${e.type}] ${JSON.stringify(e.args)}`)).join("\n")}`,a=(0,S().XZ)({environment:g,spaceStore:e,functionKey:r,message:(0,u().x9d)(i)}),s=(0,E().Y$)({environment:g,spaceStore:e,userStore:o,store:p,workflowStore:l,addSteps:[a],spaceViewStore:t}),c=(0,I().addTranscriptToNewThreadAndRun)({environment:g,spaceStore:e,clientStore:M().Kd,transcript:s,workflowStore:l});(0,C().showWorkflowEditor)({environment:g,chatSidebarState:{isOpen:!0,threadId:c.id},parentStore:p})}),[l,y,A,g,p,f.id]);return c?(0,F.jsxs)(F.Fragment,{children:[y.length>0&&(0,F.jsx)(V,{error:y[y.length-1].message,workflowStore:l,store:p,collectionViewStore:f,onFixErrors:j}),(0,F.jsx)("iframe",{ref:N,srcDoc:B,sandbox:"allow-scripts allow-forms allow-pointer-lock",referrerPolicy:"no-referrer",style:{border:"none",width:"100%",height:"100%",minHeight:"300px"},title:"Workflow Content"})]}):null}function V(e){const{error:t,onFixErrors:o}=e,n=(0,a().IS)((e=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,marginBottom:12,borderRadius:4,width:"100%"},errorContent:{display:"flex",alignItems:"center",flexGrow:1,marginRight:12,color:e.accentColors.red[400],fontSize:14},errorIcon:{width:16,height:16,fill:e.accentColors.red[400],marginRight:8}})),[]);return(0,F.jsxs)("div",{style:n.container,children:[(0,F.jsxs)("div",{style:n.errorContent,children:[(0,l().Y)(n.errorIcon),t]}),(0,F.jsx)(k().A,{icon:c().aiFaceFillIcon,size:"sm",onClick:o,children:(0,F.jsx)(w().sA,{defaultMessage:"Fix with AI",id:"WorkflowEditor.ErrorMessage.fixWithAI"})})]})}},155185:(e,t,o)=>{o.d(t,{I:()=>a,_:()=>i});const n={normalizedTitleWithIcon:!0,properties:!0,property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,views:!0,viewsMain:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,deleted_property:!1,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,recentActivity:!1,collaborators:!1,teamspaces:!1},r={properties:!0,property:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,titleWithIcon:!0,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,views:!0,viewsMain:!0,collectionView:!0,collectionViewV2:!0,recentActivity:!1,collaborators:!1,teamspaces:!1};function i(e){return n[e.type]}function a(e){return r[e.type]}},235692:(e,t,o)=>{o.d(t,{K5:()=>p,Vp:()=>d,_u:()=>l,oP:()=>f,wC:()=>c,xN:()=>u});o(898992),o(354520),o(581454);var n=()=>o(183558),r=()=>o(155185),i=()=>o(778781),a=()=>o(369186);const s={page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"properties",type:"properties"},{id:"discussions",type:"discussions"},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},c={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},l={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyLabels:"hide",propertyIds:[]},{id:"editor",type:"editor"},{id:"discussions",type:"discussions"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},d={page_main:[],page_details:[],form_layout_schema:[],person_profile_page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"recent_activity",type:"recentActivity"}],person_profile_page_details:[{id:"collaborators",type:"collaborators"},{id:"teamspaces",type:"teamspaces"}]};function u(e){return(0,a().jr)({modulesByArea:s,collectionSchema:null==e?void 0:e.collectionSchema,collectionFormat:null==e?void 0:e.collectionFormat})}function p(){return{page_layout_schema:(0,a().ke)(s.page_main).map((e=>{if(!(0,i().cn)(e))return(0,r().I)(e)?{...e,id:(0,n().Ay)()}:e})).filter((e=>void 0!==e)),page_info_layout_schema:(0,a().ke)(s.page_details).map((e=>{if(!(0,i().cn)(e))return(0,r().I)(e)?{...e,id:(0,n().Ay)()}:e})).filter((e=>void 0!==e)),form_layout_schema:void 0,person_profile_page_main:void 0,person_profile_page_details:void 0}}function f(e,t){const o=void 0===t?[{id:(0,n().Ay)(),type:"formQuestion",formQuestionId:e}]:[{id:(0,n().Ay)(),type:"formQuestion",formQuestionId:e},{id:(0,n().Ay)(),type:"formQuestion",formQuestionId:t}];return{page_layout_schema:void 0,page_info_layout_schema:void 0,person_profile_page_main:void 0,person_profile_page_details:void 0,form_layout_schema:[{id:(0,n().Ay)(),type:"cover"},{id:(0,n().Ay)(),type:"formTitle"},...o,{id:(0,n().Ay)(),type:"formSubmit"}]}}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().default{getInitialState(){return{}}}const r=new n;o(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},324577:(e,t,o)=>{o.d(t,{Y:()=>r});var n=()=>o(847249);function r(e){return(0,n().K8)((()=>null==e?void 0:e.getWorkflowStore()),[e])}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>N,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>k,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>M,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>w,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>I,areRecurrenceSchedulesEqual:()=>V,convertFromUnpersistedRecurrenceConfig:()=>D,convertToUnpersistedRecurrenceConfig:()=>F,getFormattedEndCondition:()=>E,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>P,getNextDateUtc:()=>A,getRecurrenceAfter:()=>C,isRunningBetweenMidnightAnd3AM:()=>x,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>b});o(898992),o(354520),o(581454);var n=()=>o(244641);o(944114);function r(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(o[0],...o.slice(1)).map((e=>[a,...e])));return i}var i=()=>o(496603),a=()=>o(534177),s=()=>o(720665),c=()=>o(597777),l=()=>o(869190),d=()=>o(416504),u=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var f=()=>o(912720);const m=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),g={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},y={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},v=99,w=999;function _(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function h(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=w}function S(e){const{start_date:t,frequency:o,interval:n,weekdays:i,timezone:s,hour:l,minute:d}=e,u="week"===o&&i?i.map((e=>y[e])):void 0,f={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return y[t].nth(o)})):(0,a().HB)(e.monthly_restriction)),new p({freq:g[o],dtstart:(0,c().eU)(t),interval:n,byweekday:u,tzid:s,byhour:l??0,byminute:d??0,bysecond:0,...f})}const M=1,k=1;function b(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=n>M,a=o.length>=k;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function I(e){var t;const{recurrence:o,afterDate:r}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=r)return o;let i=n().c9.fromMillis(o.start_date,{zone:"utc"});const a=n().c9.fromMillis(r,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/o.interval);i=i.plus({years:e*o.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/o.interval);i=i.plus({months:e*o.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/o.interval);i=i.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/o.interval);i=i.plus({days:e*o.interval});break}}return{...o,start_date:(0,c().DH)(i.toMillis())}}function C(e){const{recurrence:t,afterDate:o}=e;if((0,f().wt)(t)){const e=(0,c().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(I({recurrence:t,afterDate:o})).after((0,c().eU)(o));if(!e)return;return(0,c().h1)(e)}}function x(e){return 0===e.hour||1===e.hour||2===e.hour}function A(e){return S(e).after((0,c().eU)((0,c().Rz)()))||void 0}function T(e){const{recurrence:t,intl:o}=e,r=A(D(t));if(!r)return;const i=x(t),a=n().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(o)).setZone(t.timezone),s=(0,l().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(m.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(m.dateAtTime,{date:s,time:e})}}function E(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(m.noEndCondition)}const N=100;function F(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function P(e,t,o){return e.plus(o-t)}function R(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(o.toJSDate())}}function D(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?R(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function V(e,t){const o=i().fN(e,(e=>void 0!==e)),n=i().fN(t,(e=>void 0!==e));return i().n4(o,n)}},406533:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,questionMarkCircleIcon:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},i=(0,o(340498).wt)("questionMarkCircle",r)},422540:(e,t,o)=>{o.d(t,{$0:()=>y,Fx:()=>k,Ge:()=>f,I3:()=>u,Kj:()=>S,PP:()=>b,TK:()=>I,Yy:()=>d,aE:()=>C,cQ:()=>M,kH:()=>m,m7:()=>p,nq:()=>_,nv:()=>v,tj:()=>g});o(898992),o(354520),o(737550);var n=()=>o(496603),r=()=>o(534177),i=()=>o(970013),a=()=>o(651124),s=()=>o(349835),c=()=>o(390066);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const l={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(l[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:l,sourcePropertyIds:d}=e,p=(d??(0,r().uv)(o)).filter(((t,n,r)=>{const a=o[t];return!(!a||!u(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,a))&&(!s||s([t,a],n,o)))}));if(0===p.length)return[];if(!t||!1===l)return p;const f=(0,c().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>f.findIndex((t=>t.property===e))))}function f(e){const{collectionFormat:t,collectionSchema:o,sort:s}=e,l=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().JY)(r))}));if(0===l.length)return[];if(!t||!1===s)return l;const d=(0,c().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(l,(e=>d.findIndex((t=>t.property===e))))}function m(e){return e.type===s().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===s().M9.TokenExpected?{type:e.type,token:e.token}:e.type===s().uW.MissingSchemaPropertyOnThisRow||e.type===s().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===s().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===s().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===s().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===s().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===s().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===s().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===s().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===s().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===s().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===s().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const g={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function y(e){return Boolean(g[e.type])}function v(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:l}=e,d=(0,r().uv)(o).filter(((e,t,n)=>{var r;const a=o[e];return!(!a||!g[a.type])&&((!(0,i().$M)(a)||null===(r=(0,i().om)(a))||void 0===r||!r.auto_update_on_edit)&&(!s||s([e,a],t,o)))}));if(0===d.length)return[];if(!t||!1===l)return d;const u=(0,c().L)(t,o,void 0,a().jf.Page).collection_page_properties||[];return n().Ul(d,(e=>u.findIndex((t=>t.property===e))))}const w={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function _(e){return w[e.type]}const h={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function S(e){return h[e.type]}function M(e){return 0===e}function k(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function b(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function I(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!u(r):!g[r.type])}function C(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i,relativeDate:a}=t.event;if(void 0===i)return!1;const s="some"===n.type&&n.some,c="all"===n.type&&n.all;if((s||c||[]).some((e=>b({collectionSchema:o,property:e.property})||I({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const l="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),d="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||l||d)&&!a)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},447934:(e,t,o)=>{o.d(t,{$L:()=>C,Fv:()=>R,HD:()=>D,V_:()=>N,bV:()=>F,jP:()=>E,nh:()=>T,w8:()=>P});o(16280),o(18107),o(967357),o(898992),o(354520);var n=()=>o(206267),r=()=>o(792071),i=()=>o(688728),a=()=>o(475140),s=()=>o(235692),c=()=>o(924329),l=()=>o(778781),d=()=>o(144081),u=()=>o(334261),p=()=>o(661920),f=()=>o(435009),m=()=>o(751156),g=()=>o(799832),y=()=>o(492414),v=()=>o(594794),w=()=>o(869562),_=()=>o(351360),h=()=>o(712505),S=()=>o(630116),M=()=>o(263711),k=()=>o(640868),b=()=>o(204521),I=()=>o(33218);function C(e){let{environment:t,transaction:o,collectionStore:n,userId:i,modules:a}=e;const c=(0,v().zP)({environment:t,spaceId:n.getSpaceId(),table:d().zx}),l=S().sk.createChildStore(n,c),{model:u,operations:[p]}=r().wfN.create({pointer:c,parent:n.pointer,createdByUserId:i,modules:a??(0,s().K5)()});m().applyOperation({transaction:o,store:l,operation:p});const f=r().BnK.setLayout(n.pointer,c);return m().applyOperation({transaction:o,store:n,operation:f}),{model:u,store:l}}function x(e){let t;return e?t=e:h().default.state.open&&h().default.state.targetStore?t=h().default.state.targetStore:_().default.state.mainEditorCurrentBlockStore&&(t=_().default.state.mainEditorCurrentBlockStore),t}function A(e){w().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),p().VN({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function T(e){var t,o;let{environment:r,blockStore:i,collectionStore:a,collectionViewStore:s,from:c,initialSelectedModuleType:l}=e;const d=function(e){var t;let o=x(e);if(null!==(t=o)&&void 0!==t&&t.isCollectionView()){const e=(0,g().U)(o);o=e?e.resultsInViewOrder(1).at(0):void 0}return o}(i),u=window.location.href;A(r);const p=n().JW();M().g.setState({isOpen:!0,mode:"layout-editor",collectionStore:a,pageStore:d,siteRootBlockStore:void 0,sessionId:p,initialSelectedModuleId:null==d||null===(t=d.getAssociatedCollectionStore())||void 0===t||null===(t=t.getLayoutStore())||void 0===t||null===(t=t.getModel())||void 0===t||null===(t=t.firstRawModuleOfType(l??"titleWithIcon"))||void 0===t?void 0:t.id,urlOnOpen:u}),(0,b().Ko)({environment:r,from:c,context:"layout",sessionId:p,collectionId:null==a?void 0:a.id,existingLayoutId:null==a||null===(o=a.getLayoutStore())||void 0===o?void 0:o.id,collectionViewId:null==s?void 0:s.id})}function E(e){let{environment:t,store:o,siteRootBlockStore:r,from:i}=e;const a=x(o);A(t);const s=n().JW();M().g.setState({isOpen:!0,mode:"site-settings-editor",pageStore:a,siteRootBlockStore:r,sessionId:s}),(0,b().Ko)({environment:t,context:"site",from:i,sessionId:s,collectionId:void 0,existingLayoutId:void 0})}function N(e){let{slideBlockStore:t}=e;const o=t.getNavigableBlockStore(),r=n().JW();M().g.setState({isOpen:!0,mode:"presentation",pageStore:o,currentSlideStore:t,sessionId:r}),window.document.documentElement.requestFullscreen()}function F(e){let{environment:t,pageStore:o,slideBlockStore:n}=e;M().g.setState({isOpen:!1});const r=(0,y().Ay)({store:o,scrollToBlockId:n.id,pageVisitSource:void 0});f().oo({environment:t,url:r}),window.document.fullscreenElement&&window.document.exitFullscreen()}function P(e){M().g.getState().isOpen&&R(e)}function R(e){let{environment:t}=e;const o=M().g.getState();if(!o.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===o.mode&&o.urlOnOpen&&window.location.href!==o.urlOnOpen&&f().aX(t),M().g.setState({isOpen:!1})}function D(e){var t;let{environment:o,transaction:n,property:r,layoutStore:s}=e;const d=M().g.getSessionId(),p=null===(t=s.getModel())||void 0===t?void 0:t.getRawModules(),f=s.getCollectionModel();if(!p||!f)return;const m=S().md.createChildStore(s,f.pointer),g=(0,a().yn)(p,(e=>"titleWithIcon"===e.type));if(g&&(0,l().Mj)(g.module)){var y;const{module:e,position:t}=g,a={...e,type:"titleWithIcon",propertyIds:null===(y=e.propertyIds)||void 0===y?void 0:y.filter((e=>e!==r))};(0,I().UQ)({environment:o,sessionId:d,transaction:n,layoutStore:s,position:{area:(0,i().Fw)(t.area),moduleId:e.id},updatedModule:(0,c().X)(a)})}const v=(0,a().LP)(p,(e=>"property"===e.type&&e.propertyId===r));for(const{module:a,position:c}of v){const e=a.id,t=(0,i().Fw)(c.area);(0,k().U)({environment:o,sessionId:d,transaction:n,layoutStore:s,position:{area:t,moduleId:e}})}const w=f.getFormat().collection_page_sections;if(w){const e=w.filter((e=>e.section!==r));u().LK({store:m,pageSectionFormats:e,transaction:n,environment:o})}}},465364:(e,t,o)=>{o.d(t,{$N:()=>T,D5:()=>E,GB:()=>C,M9:()=>b,Pt:()=>A,eW:()=>x,jo:()=>N,v7:()=>I});o(944114),o(898992),o(803949),o(581454);var n=()=>o(244641),r=()=>o(787626),i=()=>o(713998),a=()=>o(597777),s=()=>o(604995),c=()=>o(416504),l=()=>o(519831),d=()=>o(496603),u=()=>o(534177),p=()=>o(299709),f=()=>o(317001),m=()=>o(520861),g=()=>o(878060),y=()=>o(44729),v=()=>o(246826),w=()=>o(319975),_=()=>o(519839),h=()=>o(695625),S=()=>o(397248),M=()=>o(630116),k=()=>o(747671);function b(e){const{environment:t,droppedStores:o,duplicate:i,calendarBy:d,transaction:u,collectionContextStore:g,duplicateActions:v}=e,w=n().c9.fromMillis(e.startOfDay);let h=!0;for(const n of o){const t=e.collectionStore?e.collectionStore:(0,_().Dj)({store:n,collectionContextStore:g});if(n.getParentTable()===l().Vl||!t){h=!1;break}y().X$({childStore:n,parentStore:t,transaction:u})||(h=!1)}const S=(0,m().T)({environment:t,droppedStores:o,duplicate:i,transaction:u,collectionStore:e.collectionStore,duplicateActions:v});for(const n of S){const o=e.collectionStore?e.collectionStore:(0,_().Dj)({store:n,collectionContextStore:g});if(!o)continue;const i=o.getMappedProperty(d),l=n.getPropertyStore(i),m=(0,r().b)(l.getValue())||s().Ec((0,c().P)()),y=s().kW(m,(0,c().P)()),v=w.toFormat(s().tr);let S;if("date"===y.type||"datetime"===y.type)S={...y,start_date:v};else{const e=s().AA(y,(0,c().P)());if(!e.end)return;const t={...y,start_date:v},o=s().AA(t,(0,c().P)()).start.diff(e.start,"days"),n=e.end.plus(o).toFormat(s().tr);S={...y,start_date:v,end_date:n}}const M=s().kW(S,a().$K(m)||(0,c().P)());(0,f().j)({environment:t,store:n,collectionStore:o,collectionContextStore:g,shouldCoerce:!0,groupsPointer:[],transaction:u,alreadyMovedToCollection:h}),E({environment:t,type:"dateValue",propertyId:i,store:n,transaction:u,dateValue:M}),(0,p().E)({environment:t,collectionContextStore:g,block_id:n.id,property:i,property_type:"date",from:"calendar"})}}function I(e){const{calendarStore:t,direction:o,targetStore:n}=e;t.setState({...t.state,isDragging:!0,targetStore:n,direction:o,temporaryValue:void 0})}function C(e){const{calendarStore:t,x:o,y:i,calendarBy:l}=e,u=t.state;if(u.isDragging){const e=(0,r().b)(u.targetStore.getPropertyStore(l).getValue());if(!e)return;const p=s().kW(e,(0,c().P)()),f=u.temporaryValue||e,m=s().kW(f,(0,c().P)()),g=[];u.dayStoreMap.forEach(((e,t)=>{g.push({store:e,timestamp:t})}));const y=g.find((e=>{let{store:t}=e;const n=h().T.getRectFromStore(t);return Boolean(n&&S().ux(n,o,i))}));let v;if(y){const e=n().c9.fromMillis(y.timestamp),t=e.endOf("day"),o=e.toFormat(s().tr);if(p){const r=s().AA(p,(0,c().P)());if(u.direction===k().Q.Left)if(n().IX.fromDateTimes(e,t).contains(r.start))v=p;else{let e;e="datetimerange"===p.type||"daterange"===p.type?{...p,start_date:o,end_date:p.end_date}:"datetime"===p.type?{type:"datetimerange",start_date:o,start_time:p.start_time,end_date:p.start_date,end_time:p.start_time,time_zone:p.time_zone,reminder:p.reminder}:{type:"daterange",start_date:o,end_date:p.start_date,reminder:p.reminder};const t=s().AA(e,(0,c().P)());v=!r.end&&t.start>r.start||r.end&&t.start>r.end?m:e}else if(r.end?n().IX.fromDateTimes(e,t).contains(r.end):n().IX.fromDateTimes(e,t).contains(r.start))v=p;else{let e;e="date"===p.type?{...p,type:"daterange",end_date:o}:"datetime"===p.type?{...p,type:"datetimerange",end_date:o,end_time:"00:00"}:{...p,end_date:o};const t=s().AA(e,(0,c().P)());v=t.end&&t.end<t.start?m:e}}}if(v&&!d().n4(m,v)){const e=s().kW(v,a().$K(f)||(0,c().P)());t.setState({...u,temporaryValue:e})}}}function x(e){const{environment:t,calendarStore:o,calendarBy:n,transaction:r}=e,i=o.state;i.isDragging&&i.temporaryValue&&(E({type:"dateValue",environment:t,dateValue:i.temporaryValue,propertyId:n,store:i.targetStore,transaction:r}),o.setState({...o.state,isDragging:!1}))}function A(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function T(e){const{environment:t,store:o,collectionStore:r,collectionContextStore:a,startDayOfWeek:l,transaction:d}=e,u=a.dateRangeStartStore.state,p=(0,c().P)(),m=a.normalizedQueryStore.state;if(!m||!m.calendar_by)return;const g=(null==r?void 0:r.getMappedProperty(m.calendar_by))??m.calendar_by,y=s().hp(u,l,p),w=y.startOf("month"),_=y.endOf("month"),h=n().c9.now().startOf("day");let S;return S=n().IX.fromDateTimes(w,_).contains(h)?s().p6(h.valueOf(),p):s().p6(s().iB(u,l,p).valueOf(),p),v().zv({store:o.getPropertiesStore(),data:{[g]:i().m5(S)},transaction:d}),(0,f().j)({environment:t,store:o,collectionStore:r,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:d}),o}function E(e){const{environment:t,store:o,propertyId:n,transaction:r}=e;let a;"timestamp"===e.type?a=s().p6(e.timestampMs.valueOf(),(0,c().P)()):"dateValue"===e.type?a=e.dateValue:(0,u().HB)(e);const l=o.getPropertyValue(n),d=i().m5(a);v().zv({store:o.getPropertiesStore(),data:{[n]:d},transaction:r}),g().O({environment:t,store:o,dateProperty:{id:n,oldValue:l,newValue:d}})}function N(e){const{environment:t,collectionStore:o,calendarBy:n,store:r,insertStores:i,collectionContextStore:a,transaction:s}=e,c=r.getPropertyStore(n).getValue();for(const l of i)(0,f().j)({environment:t,store:l,collectionStore:o,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:s}),w().R9({environment:t,store:l.getPropertyStore(n),value:c,transaction:s});return i.map((e=>M().Bv.createChildStore(o,e.pointer)))}},485285:(e,t,o)=>{o.d(t,{d:()=>a});var n=()=>o(496603);const r={getDescription:e=>e.formatMessage({defaultMessage:"This connection allows accessing and editing the connected Notion database.",id:"workflow.module.database.description"}),getName:(e,t)=>t.state?(0,n().ZH)(t.name||"Untitled"):e.formatMessage({defaultMessage:"Database",id:"workflow.module.database.title"}),getModuleConfigSection:()=>"databases"},i={agent:{getDescription:e=>e.formatMessage({defaultMessage:"This connection adds a chat interface that the workflow can interact with.",id:"workflow.module.agent.description"}),getName:(e,t)=>t.name?(0,n().ZH)(t.name):e.formatMessage({defaultMessage:"Agent",id:"workflow.module.agent.title"}),getModuleConfigSection:()=>"agent"},ai:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows the workflow to use AI when performing a run",id:"workflow.module.ai.description"}),getName:e=>e.formatMessage({defaultMessage:"AI",id:"workflow.module.ai.title"}),getModuleConfigSection:()=>"connections"},config:o(939140).Y,database:r,discussions:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows manipulating the comments on a Notion database",id:"workflow.module.discussions.description"}),getName:e=>e.formatMessage({defaultMessage:"Discussions",id:"workflow.module.discussions.title"}),getModuleConfigSection:()=>"system"},files:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows working with files in your Workflow.",id:"workflow.module.files.description"}),getName:e=>e.formatMessage({defaultMessage:"Files",id:"workflow.module.files.title"}),getModuleConfigSection:()=>"system"},github:{getDescription:e=>e.formatMessage({id:"workflows.modules.github.description",defaultMessage:"Fetch information about pull requests, issues, repositories, and more."}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.github.name",defaultMessage:"Github"}),getMessageIfNotValid:e=>e.formatMessage({id:"workflows.modules.github.notConnected",defaultMessage:"Please connect to Github"}),getModuleConfigSection:()=>"connections"},mcpServer:{getDescription:e=>e.formatMessage({id:"workflows.modules.mcpServer.description",defaultMessage:"Integration with MCP server for AI inference with tools"}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.mcpServer.name",defaultMessage:"MCP Server"}),getMessageIfNotValid:(e,t)=>e.formatMessage({id:"workflows.modules.mcpServer.notConnected",defaultMessage:"MCP Server is not configured in {workflowName}"},{workflowName:t}),getModuleConfigSection:()=>"connections"},notifications:{getDescription:e=>e.formatMessage({id:"workflows.modules.notifications.description",defaultMessage:"This module allows sending Notion notifications"}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.notifications.name",defaultMessage:"Notifications"}),getMessageIfNotValid:()=>"",getModuleConfigSection:()=>"system"},notionmail:{getDescription:e=>e.formatMessage({defaultMessage:"Integration with Notion Mail",id:"workflow.module.notionmail.description"}),getName:e=>e.formatMessage({defaultMessage:"Notion Mail",id:"workflow.module.notionmail.title"}),getMessageIfNotValid:(e,t)=>e.formatMessage({defaultMessage:"Notion Mail is not connected to {workflowName}",id:"workflow.module.notionmail.notConnected"},{workflowName:t}),getModuleConfigSection:()=>"connections"},page:{getDescription:e=>e.formatMessage({id:"workflows.modules.page.description",defaultMessage:"This connection allows accessing and editing the connected Notion pages."}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.page.name",defaultMessage:"Page"}),getModuleConfigSection:()=>"system"},recurrence:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows triggering an Automation on a schedule.",id:"workflow.module.recurrence.description"}),getName:e=>e.formatMessage({defaultMessage:"Recurrence",id:"workflow.module.recurrence.title"}),getModuleConfigSection:()=>"system"},search:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows the workflow to search for content in your Notion workspace.",id:"workflow.module.search.description"}),getName:e=>e.formatMessage({defaultMessage:"Search",id:"workflow.module.search.title"}),getModuleConfigSection:()=>"connections"},slack:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows sending messages and receiving triggers from a connected Slack workspace.",id:"workflow.module.slack.description"}),getName:(e,t)=>{var o;return null!==(o=t.state)&&void 0!==o&&o.name?e.formatMessage({defaultMessage:"Slack - {name}",id:"workflow.module.slack.titleWithName"},{name:t.state.name}):e.formatMessage({defaultMessage:"Slack",id:"workflow.module.slack.title"})},getMessageIfNotValid:(e,t)=>e.formatMessage({defaultMessage:"Slack is not connected to {workflowName}",id:"workflow.module.slack.notConnected"},{workflowName:t}),getModuleConfigSection:()=>"connections"},users:{getDescription:e=>e.formatMessage({defaultMessage:"This connection allows getting information about users in your Notion workspace.",id:"workflow.module.users.description"}),getName:e=>e.formatMessage({defaultMessage:"Users",id:"workflow.module.users.title"}),getModuleConfigSection:()=>"system"},web:{getDescription:e=>e.formatMessage({id:"workflows.modules.web.description",defaultMessage:"Integration with Web Search"}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.web.name",defaultMessage:"Web Search"}),getMessageIfNotValid:e=>"",getModuleConfigSection:()=>"connections"},zendesk:{getDescription:e=>e.formatMessage({id:"workflows.modules.zendesk.description",defaultMessage:"Integration with Zendesk Support"}),getName:(e,t)=>e.formatMessage({id:"workflows.modules.zendesk.name",defaultMessage:"Zendesk"}),getMessageIfNotValid:(e,t)=>e.formatMessage({id:"workflows.modules.zendesk.notConnected",defaultMessage:"Zendesk is not connected to {workflowName}"},{workflowName:t}),getModuleConfigSection:()=>"connections"}};const a={getName:(e,t)=>i[e.type].getName(t,e),getDescription:(e,t)=>i[e.type].getDescription(t),isValidAndConnected:(e,t)=>"ready"===o(185864).Nh[e.type].getModuleConfigurationStatus(e,t),getMessageIfNotValid:(e,t,o)=>{var n,r;return null===(n=i[e.type])||void 0===n||null===(r=n.getMessageIfNotValid)||void 0===r?void 0:r.call(n,t,o)},getModuleConfigSection:e=>{var t,o;return(null===(t=i[e.type])||void 0===t||null===(o=t.getModuleConfigSection)||void 0===o?void 0:o.call(t))??"system"}}},520861:(e,t,o)=>{o.d(t,{T:()=>r});o(944114),o(898992),o(908872);var n=()=>o(415651);function r(e){const{environment:t,collectionStore:o,duplicate:r,droppedStores:i,transaction:a,duplicateActions:s}=e,{movedStores:c,reparentedStores:l}=i.reduce(((e,t)=>(r||t.getAssociatedCollectionId()!==(null==o?void 0:o.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...c,...n().MS({environment:t,droppedStores:l,duplicate:r,transaction:a,resolveTemplateVariables:!1,duplicateActions:s})]}},538891:(e,t,o)=>{o.d(t,{Bn:()=>d,Dk:()=>f,My:()=>g,Rd:()=>u,_q:()=>h,bq:()=>_,gf:()=>m,gz:()=>p,nG:()=>v,wI:()=>w});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=()=>o(145820),r=()=>o(534177),i=()=>o(351360),a=()=>o(630116),s=()=>o(939140),c=()=>o(485285),l=()=>o(94522);function d(e){if(!e)return[];const{currentUserStore:t}=i().default.state;if(!t)throw new Error("No current user store");if(e.functions&&e.functions.length>0)return e.functions;if(!e.functionPointers||0===e.functionPointers.length)return[];const o=e.functionPointers.map((e=>a().je.createChildStore(t,e)));return(0,l().aY)(o)}function u(e){if(!e)return[];const{modules:t=[]}=e;return t.filter((t=>function(e){const{workflow:t,module:o}=e;if("connections"!==c().d.getModuleConfigSection(o))return!1;var n;if("ai"===o.type)return Object.keys((null===(n=o.state)||void 0===n?void 0:n.promptNamesToModel)??{}).length>0;if("config"===o.type)return t&&(0,s().a)(t);return!0}({workflow:e,module:t})))}function p(e){if(!e)return[];const{modules:t=[]}=e;return t.filter(y)}function f(e){const{workflow:t,previewStore:o,functionKey:n}=e;return function(e){const{workflow:t,previewStore:o}=e;return t.functionPointers?t.functionPointers.map((e=>a().je.createChildStore(o,e))).filter((e=>e.isFunction())):[]}({workflow:t,previewStore:o}).find((e=>{var t;return(null===(t=e.getData())||void 0===t?void 0:t.key)===n}))}function m(e){var t;const{runStore:o,userStore:n,workflow:r}=e;if(!r)return[];const i=(null===(t=o.getData())||void 0===t?void 0:t.function_artifact_pointers)||r.functionPointers;if(!i||0===i.length)return[];const s=i.map((e=>a().je.createChildStore(n,e)));return(0,l().aY)(s)}function g(e){const{workflowStore:t,resultIds:o}=e,i=d((0,l().dh)(t));return o.map((e=>function(e){const{workflowStore:t,runId:o,functions:i}=e,s=function(e){const{workflowStore:t,runId:o}=e,r=t.getSpaceId();if(!r)throw new Error("No space id");return a().ty.createChildStore(t,{table:n().QR,id:o,spaceId:r})}({workflowStore:t,runId:o}),c=function(e,t){const o=e.getScript();if(o)return o.name;const n=e.getTriggerKey();if(!n)return;const r=t.find((e=>e.key===n));return(null==r?void 0:r.name)||n}(s,i),l=function(e,t){const o=e.getWorkflowVersionPointer();if(!o)return;const n=a().je.createChildStore(t,o),i=null!=n&&n.isVersion()?n.getWorkflowVersion():void 0;return(0,r().O9)(i)?`v${i}`:void 0}(s,t),d=s.getStatus()??"pending",u=s.getFinishedAt();return{id:s.id,isClickable:!0,isLoading:!s.isReady(),runFinishedAt:u,runId:s.id,runName:c,runStatus:d,runTrigger:void 0,workflowVersion:l}}({workflowStore:t,runId:e,functions:i})))}function y(e){return"databases"===c().d.getModuleConfigSection(e)}function v(e){return e?e.triggers??[]:[]}function w(e){const{workflow:t,functionStore:o}=e;return t.functionPointers&&o?new Map(t.functionPointers.map((e=>a().je.createChildStore(o,e))).filter((e=>e.isFunction())).map((e=>{const t=e.getData();return t?[t.key,t]:null})).filter((e=>null!==e))):new Map}function _(e){var t;const{workflow:o,fn:n,functionStoreMap:r}=e;return null!==(t=n.callsFunctions)&&void 0!==t&&t.length?n.callsFunctions.map((e=>{var t;const n=r.get(e);return n||(null===(t=o.functions)||void 0===t?void 0:t.find((t=>t.key===e)))})).filter((e=>void 0!==e)):[]}function h(e){const{functionKey:t,allFunctions:o}=e,n=e.visitedKeys??new Set;if(n.has(t))return[];n.add(t);const r=o.find((e=>e.key===t));if(!r)return[];const i=[];if(r.callsFunctions)for(const a of r.callsFunctions){const e=o.find((e=>e.key===a));e&&i.push(e)}return[r,...i.flatMap((e=>h({functionKey:e.key,allFunctions:o,visitedKeys:n})))]}},546461:(e,t,o)=>{o.d(t,{EC:()=>M,To:()=>S,YC:()=>k,or:()=>h,u:()=>_});o(16280);var n=o(296540),r=()=>o(484714),i=()=>o(847249),a=()=>o(496506),s=()=>o(322867),c=()=>o(959013),l=()=>o(534177),d=()=>o(813297),u=()=>o(862292),p=()=>o(698331),f=()=>o(645873),m=()=>o(190019),g=()=>o(76190),y=o(474848);const v=new WeakMap,w=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});w.displayName="AutomationContext";function _(e){const{automationStore:t,children:o,contextType:n}=e,_=(0,r().v3)(),h=(0,c().tz)(),{value:S}=(0,f().fJ)(u().T.formulas),{value:M}=(0,f().fJ)(d().QV.automationTypecheck),k=(0,g().n)(t),b=(0,i().K8)((()=>{if(!S)return{error:new(s().N9)("Missing formulas dependency")};if(!M)return{error:new(s().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:s,isSubscribed:c}=e,d=v.get(o);if(d)return d;{const e=new(a().default)((()=>{const e=o.getTriggerType();let a=r;return(0,l().O9)(e)&&(0,p().x2)(e)&&(a=(0,p().H8)(e)),(0,m().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:a,formulasModule:i,intl:s,isSubscribed:c})}),{debugName:"automationContextTypecheckResultCachedStore"});return v.set(o,e),e}}({environment:_,automationStore:t,automationTypecheckModule:M,contextType:n,formulasModule:S,intl:h,isSubscribed:k});return e.state}),[_,t,M,n,S,h,k]);return(0,y.jsx)(w.Provider,{value:{automationStore:t,typecheckResult:b,contextType:n,defined:!0},children:o})}function h(e){const{automationStore:t,children:o}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,y.jsx)(_,{automationStore:t,contextType:(0,p().H8)(n??"event"),children:o})}function S(e){var t;return null===(t=v.get(e))||void 0===t?void 0:t.state}function M(){const e=n.useContext(w);if(!1===e.defined)throw new Error("No automation context found!");return e}function k(){return n.useContext(w)}},603815:(e,t,o)=>{o.d(t,{A$:()=>I,JQ:()=>C,Vn:()=>k,s4:()=>b});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949),o(581454);var n=()=>o(857639),r=()=>o(585515),i=()=>o(577449),a=()=>o(388821),s=()=>o(179034),c=()=>o(545285),l=()=>o(534177),d=()=>o(449506),u=()=>o(780054),p=()=>o(989423),f=()=>o(870618),m=()=>o(303626),g=()=>o(14307),y=()=>o(245865),v=()=>o(540758),w=()=>o(670631),_=()=>o(508496),h=()=>o(571963),S=()=>o(603815),M=()=>o(108944);async function k(e){const{environment:t,request:o,abortSignal:n,prefetchCacheKey:r,headers:i}=e;return(0,h().updateLoadCachedPageChunkCalledAt)(),g().isConnected()||g().isConnecting()?d().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:r,headers:i}):d().callApi({eventName:"loadPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:r,headers:i})}async function b(e){const{mode:t,environment:o,request:l,isFirstChunk:d,abortSignal:g}=e,y={...l,limit:30,cursor:l.cursor||{stack:[]},baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await S().A$(o,{id:l.page.id,table:s().ev}),null!=g&&g.aborted))throw new Error("Abort signal received");const _=a().RecordMapWithRole.create(),h=[];let M=!1;const k=new Set,b=await r().T(y,i().h.fromMonomorphicFunctionUnsafe((async e=>{const n=await f().h7({environment:o,pointer:e,abortSignal:g,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=g&&g.aborted)throw new Error("Abort signal received");if(n)return _.setModelAndRole(e,n.model,n.role),n.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,c().u)(e)&&!k.has(e.id)&&d){if(void 0===w().A.state.offlinePages)return h.push(e),void(M=!0);if(void 0===w().A.state.offlinePages||!v().Bd(l.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);h.push(e)}})),((e,t,o,n)=>{m().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${o})`),null!=n&&n.suppressErrorOnClient&&k.add(t.id)}));if(M&&(await w().A.waitUntil((()=>void 0!==w().A.state.offlinePages)),!v().Bd(l.page.id))){const[e]=h;throw new Error(`Record not found: ${e.table},${e.id}`)}if(h.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:o,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&n().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:l.page.id,missingRecords:h}})})),null!=g&&g.aborted)throw new Error("Abort signal received");return{recordMap:_.toJson(),cursor:b.cursorValue}}async function I(e,t){const o=e.currentUser.id;if(!o||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:o})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),y().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function C(e){if(!_().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=a().RecordMapPolymorphic.create();let o=0;const n=()=>o>=50,r=e=>{"space"!==(null==e?void 0:e.table)&&(n()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),o++))};if(e.isReady())for(const a of(0,M().E)(e))r(a);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);r(t.getModel({table:"notion_user",id:e.userId}));let o=0;for(const e of t.getPointersByTable("notion_user")){if(n()||o>=10)break;o++,r(t.getModel(e))}}const i=Array.from(t).map((e=>{let{pointer:t,value:o}=e;if(void 0!==o)return{pointer:t,version:o}})).filter(l().O9);return i.length?i:void 0}},637433:(e,t,o)=>{o.d(t,{Y:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25m2.817 4.808a.625.625 0 0 1 0 .884L10.884 10l1.933 1.933a.625.625 0 1 1-.884.884L10 10.884l-1.933 1.933a.625.625 0 1 1-.884-.884L9.116 10 7.183 8.067a.625.625 0 1 1 .884-.884L10 9.116l1.933-1.933a.625.625 0 0 1 .884 0"})},r=(0,o(340498).wt)("xMarkCircleFill",n)},640868:(e,t,o)=>{o.d(t,{U:()=>p});o(16280);var n=()=>o(31503),r=()=>o(454984),i=()=>o(688728),a=()=>o(475140),s=()=>o(789280),c=()=>o(778781),l=()=>o(751156),d=()=>o(204521),u=()=>o(658616);function p(e){let{environment:t,transaction:o,layoutStore:p,position:f,sessionId:m,beforePerformDeleteModule:g}=e;const y=p.getModules();if(!y)throw new Error("[deleteModuleAtPosition] modules by area not found for layout store");const v=(0,a().EX)(y,(e=>e.id===f.moduleId)),w=(0,n().Cg)({moduleId:null==v?void 0:v.module.id,modulesByArea:p.getModules()}).length;if(!v)return;const{module:_,position:h}=v;if(!(0,s().Fe)(_))throw new Error("[deleteModuleAtPosition] module to delete is not removeable");var S;(l().createAndCommitOrAppend({environment:t,transaction:o,canUndo:!0,perform(e){!function(e){const{transaction:t,layoutStore:o,moduleLocation:n,moduleToDelete:a,beforePerformDeleteModule:s}=e;s&&s(t);(0,c().V6)(a)&&(0,u().deleteViewsModuleDependencies)({layoutStore:o,viewsModule:a,transaction:t});if("form_conditional_modules"===n.area){const e=r().N4.removeChildModule({pointer:o.pointer,modulesByArea:o.getModules(),module:a});for(const n of e)l().applyOperation({transaction:t,store:o,operation:n})}else{const e="views_main_tab_modules"===n.area?{area:n.area,viewId:n.viewId}:{area:i().Zm[n.area]};l().applyOperation({transaction:t,store:o,operation:r().N4.deleteModuleInArea({...e,pointer:o.pointer,moduleId:a.id})})}}({environment:t,transaction:e,layoutStore:p,moduleLocation:h,moduleToDelete:_,beforePerformDeleteModule:g})},userAction:"pageLayout.deleteActions.deleteModuleAtPosition"}),m)&&d().PS({environment:t,module:_,sessionId:m,collectionId:null===(S=p.getCollectionModel())||void 0===S?void 0:S.id,layoutId:p.id,context:(0,i().We)(f.area),area:f.area,depth:w})}},658616:(e,t,o)=>{o.r(t),o.d(t,{deleteViewsModuleDependencies:()=>a});var n=()=>o(220719),r=()=>o(44729),i=()=>o(630116);function a(e){const{layoutStore:t,viewsModule:o,transaction:a}=e,s=(0,n().o9)(i().Bv.createChildStore(t,o.collection_view_block_pointer));r().zz({childStore:s,parentStore:t,transaction:a})}},698331:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>a,x2:()=>r});var n=()=>o(534177);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},725649:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>r,K$:()=>n,j6:()=>i})},747671:(e,t,o)=>{o.d(t,{Q:()=>n,a:()=>r});let n=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class r extends(()=>o(757695))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},769607:(e,t,o)=>{o.r(t),o.d(t,{aiFaceFillIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.112 2.863a4.17 4.17 0 0 0-4.92.468.875.875 0 0 0 1.167 1.304 2.42 2.42 0 0 1 3.44.22.875.875 0 0 0 1.322-1.146 4.2 4.2 0 0 0-1.01-.846m1.248 2.563a4.167 4.167 0 0 1 7.173.037.875.875 0 1 1-1.511.883 2.417 2.417 0 0 0-4.16-.02l-5.21 8.697 3.828.62a.875.875 0 0 1-.28 1.728l-5.102-.827a.875.875 0 0 1-.61-1.313zM6.51 9.204a1.416 1.416 0 1 0 .452-2.795 1.416 1.416 0 0 0-.453 2.795"}),(0,n.jsx)("path",{d:"M12.72 10.21a1.416 1.416 0 1 0 .453-2.795 1.416 1.416 0 0 0-.453 2.795"})]})},i=(0,o(340498).wt)("aiFaceFill",r)},789280:(e,t,o)=>{o.d(t,{Fe:()=>i,wm:()=>a});const n={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,relationsGroup:!0,formSubmit:!0,formQuestion:!0,formTitle:!0,placeholder:!0,transcript:!0,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,views:!0,viewsMain:!1,recentActivity:!1,collaborators:!1,teamspaces:!1},r={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,formSubmit:!1,formQuestion:!1,formTitle:!1,placeholder:!1,transcript:!1,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,relationsGroup:!0,editor:!1,views:!1,viewsMain:!1,recentActivity:!1,collaborators:!1,teamspaces:!1};function i(e){return n[e.type]}function a(e){return r[e.type]}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},939140:(e,t,o)=>{o.d(t,{Y:()=>r,a:()=>i});var n=()=>o(342967);const r={getDescription:e=>e.formatMessage({id:"workflows.modules.config.description",defaultMessage:"Access configuration values"}),getName:e=>e.formatMessage({id:"workflows.modules.config.name",defaultMessage:"Configuration variables"}),getMessageIfNotValid:void 0,getModuleConfigSection:()=>"connections"};function i(e){const{modules:t}=e;if(!t)return!1;for(const o of t){const t=(0,n().v)(e,o.key);if(Object.keys(t).length>0)return!0}return!1}}}]);