"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[74070,90871],{100594:(e,t,r)=>{r.d(t,{CN:()=>R,D0:()=>_,D5:()=>P,GL:()=>f,I9:()=>m,JQ:()=>v,JW:()=>x,PC:()=>h,Rb:()=>A,SK:()=>M,UK:()=>E,VY:()=>u,YU:()=>S,Yp:()=>b,_x:()=>w,bg:()=>p,fn:()=>D,i8:()=>F,kq:()=>d,q_:()=>T,sh:()=>g,tG:()=>y,xS:()=>k,zn:()=>B});var n=()=>r(534177),o=()=>r(708685),a=()=>r(921598),i=()=>r(970013),l=()=>r(713998),c=()=>r(499755),s=()=>r(901610);const u=["gray","blue","yellow","green","purple","teal","orange","pink","red"],d=["auto","colorful"];let p=function(e){return e.small="small",e.medium="medium",e.large="large",e.extra_large="extra_large",e}({});function g(e){switch(e){case p.small:return 300;case p.medium:return 400;case p.large:return 600;case p.extra_large:return 800;default:(0,n().HB)(e)}}function m(e){switch(e){case p.small:return 150;case p.medium:return 250;case p.large:return 300;case p.extra_large:return 400;default:(0,n().HB)(e)}}let f=function(e){return e.avatar="avatar",e.avatar_name="avatar_name",e.name="name",e}({}),y=function(e){return e.none="none",e.x_axis="x_axis",e.y_axis="y_axis",e.both="both",e}({}),v=function(e){return e.none="none",e.horizontal="horizontal",e.vertical="vertical",e.both="both",e}({}),h=function(e){return e.normal="normal",e.percent="percent",e.side_by_side="side_by_side",e}({}),_=function(e){return e.none="none",e.value="value",e.name="name",e.name_and_value="name_and_value",e}({});function C(e){if(!e)return!1;return a().BI.includes(e)}function b(e){const t=(0,o().getFormulaPropertySchemaBaseResultType)(e);return"text"===t||"number"===t||"checkbox"===t||"person"===t||"date"===t}function S(e,t){var r,o;let i,s=e.chartFormat;if("groups_reducer"===e.dataConfig.type){var u;const{chartFormat:r,chartGroupByFormat:n}=function(e,t,r,n){const o=(0,l()._g)({schema:n,property:e.property});if(o&&"donut"===r&&(0,c().e0)(o)){const r=(0,a().MP)(e);return{chartFormat:{...t,mainSort:c().S0.yDescending},chartGroupByFormat:r}}return{chartFormat:t,chartGroupByFormat:e}}(null==e||null===(u=e.dataConfig)||void 0===u?void 0:u.groupBy,null==e?void 0:e.chartFormat,"donut",t);s=r,i={...e.dataConfig,groupBy:n,aggregationConfig:{aggregation:e.dataConfig.aggregationConfig.aggregation}}}else"results_reducer"===e.dataConfig.type?(i=e.dataConfig,s={...s,mainSort:c().S0.yDescending}):(0,n().HB)(e.dataConfig);T(e)&&s&&(void 0===(null===(r=s)||void 0===r?void 0:r.donutDataLabels)||(null===(o=s)||void 0===o?void 0:o.donutDataLabels)===_.none)?s.donutDataLabels=_.value:!T(e)&&s&&(s.donutDataLabels=_.none);const d={...e,type:"donut",dataConfig:i};return s&&(d.chartFormat=s),d}function w(e,t){let r;"groups_reducer"===e.dataConfig.type?r={...e.dataConfig,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t},stackOptions:void 0}}:"results_reducer"===e.dataConfig.type?r={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,n().HB)(e.dataConfig);const o=e.chartFormat;return o&&o.donutDataLabels&&o.donutDataLabels!==_.none?o.axisShowDataLabels=!0:!o||o.donutDataLabels!==_.none&&void 0!==o.donutDataLabels||(o.axisShowDataLabels=!1),{...e,type:t,dataConfig:r}}function M(e,t){let r;if("groups_reducer"===e.dataConfig.type){var o;const n=null==e||null===(o=e.dataConfig)||void 0===o?void 0:o.groupBy;r={...e.dataConfig,groupBy:n,aggregationConfig:{...e.dataConfig.aggregationConfig,seriesFormat:{displayType:t}}}}else"results_reducer"===e.dataConfig.type?r={...e.dataConfig,valueSeriesFormat:{displayType:t}}:(0,n().HB)(e.dataConfig);return{...e,type:t,dataConfig:r}}const A={main:c().S0.xAscending,stacked:c().S0.manual};function R(e){let{chartConfig:t,xAxisPropertyId:r,newDataConfigType:o,groupBy:a,aggregation:i,valueProperty:l}=e;const s="groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.seriesFormat:t.dataConfig.valueSeriesFormat;"groups_reducer"===o?t.dataConfig={type:"groups_reducer",groupBy:a,aggregationConfig:{aggregation:i,seriesFormat:s,stackOptions:"groups_reducer"===t.dataConfig.type?t.dataConfig.aggregationConfig.stackOptions:void 0}}:"results_reducer"===o?t.dataConfig={type:"results_reducer",nameProperty:r,valueProperty:l,valueSeriesFormat:s}:(0,n().HB)(o);const u="formula"===a.type?a.groupBy.sort:a.sort;return t.chartFormat={...t.chartFormat,mainSort:(0,c().gN)(u)},t}function k(e){let{property:t,propertySchema:r,groupByOption:n,hideEmptyGroups:i}=e;const l=r.type;if((0,a().Eg)(r)){if((0,a()._o)(l)){if(n&&C(n))return{type:l,property:t,groupBy:n,sort:{type:"ascending"}}}else{if((0,a().KI)(l)||"select"===l||"multi_select"===l)return{type:l,property:t,sort:{type:"ascending"}};if((0,a().iF)(l)){if(n&&((c=n)&&a().PC.includes(c)))return{type:l,property:t,groupBy:n,sort:{type:"ascending"}}}else{if("number"===l)return{type:l,property:t,groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}};if("formula"===l){const e=(0,o().getFormulaPropertySchemaResultType)(r);if("number"===e)return{type:"formula",property:t,groupBy:{type:"number",groupBy:{type:"unique"},start:-1,end:-1,size:-1,sort:{type:"ascending"}}};if("date"===e&&C(n))return{type:"formula",property:t,groupBy:{type:"date",groupBy:n,sort:{type:"ascending"}}}}else if("person"===l)return{type:l,property:t,sort:{type:"manual"}}}}var c;return(0,a().V0)({property:t,propertySchema:r,hideEmptyGroups:i})}}function x(e){const t="formula"===e.type?(0,o().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().AM)(e)||"number"===t}function B(e){const t="formula"===e.type?(0,o().getFormulaPropertySchemaResultType)(e):void 0;return(0,a()._o)(e.type)||"date"===t}function D(e){const t="formula"===e.type?(0,o().getFormulaPropertySchemaResultType)(e):void 0;return(0,i().JY)(e)||"person"===t}function F(e){if("formula"===e.type){const t=(0,o().getFormulaPropertySchemaResultType)(e);return(0,a()._o)(t)}return(0,a()._o)(e.type)}function E(e){return"text"===e||"number"===e||"person"===e||"date"===e}function P(e){var t;return!(!e||!(0,s().m)(e))&&("groups_reducer"!==e.dataConfig.type||!e.dataConfig.aggregationConfig.stackOptions||"percent"!==(null===(t=e.chartFormat)||void 0===t?void 0:t.axisGroupStyle))}function T(e){return!!P(e)&&(!(!e||!(0,s().m)(e))&&(void 0===(null===(t=e.chartFormat)||void 0===t?void 0:t.axisShowDataLabels)||(null===(r=e.chartFormat)||void 0===r?void 0:r.axisShowDataLabels)));var t,r}},152236:(e,t,r)=>{r.d(t,{M:()=>d,h:()=>p});r(16280),r(898992),r(354520);var n=()=>r(700500),o=()=>r(363497),a=()=>r(179034),i=()=>r(869558),l=()=>r(750660),c=()=>r(246826),s=()=>r(183324),u=()=>r(351360);function d(e){const{environment:t,collectionViewStore:r,parentCollectionViewBlockStore:l,transaction:s,filter:d,inMemoryRecordCache:p,sort:g,semanticQuery:m,assistantChatSessionId:f}=e,y=u().default.state.currentSpaceStore,v=u().default.state.currentSpaceViewStore;if(!y||!v)throw new Error("No current space or space view.");const h=t.currentUser.id;if(!h)throw new Error("User is not logged in.");const _=c().Wv({environment:t,type:n().xd.collectionViewPage,inMemoryRecordCache:y.inMemoryRecordCache,transaction:s,spaceId:y.id,permissions:[{type:"user_permission",user_id:h,role:"editor"}]}),C={type:"table",parent_id:_.id,parent_table:a().ev,alive:!0,space_id:y.id,format:{table_properties:r.getFormat().table_properties,timeline_arrows_by:void 0,subitem_display_mode:"hidden",table_subitem_toggle_column:"title",is_unlisted:!0,collection_pointer:r.getFormat().collection_pointer??l.getCollectionPointer(),...m?{is_unlisted_from_semantic_query:{is_from_semantic_query:!0,query:m}}:{is_unlisted_from_semantic_query:{is_from_semantic_query:!1}}},query2:{filter:d,sort:g}},b=c().eC({environment:t,table:i().Gy,value:C,inMemoryRecordCache:p,transaction:s});return c().zv({store:_,data:{parent_id:f,parent_table:o().TF,alive:!0,view_ids:[b.id]},transaction:s}),{collectionViewStore:b,linkedDatabaseCollectionBlockStore:_}}async function p(e){const{environment:t,transaction:r,acceptMoveToArgs:n,linkedDatabaseBlockStore:o}=e,{blockStores:[a]}=s().duplicateBlock({environment:t,stores:[o],transaction:r,targetSpaceId:o.getSpaceId(),preferDuplicateLocation:"local",options:{resolveTemplateVariables:!1,addCopyName:!1,deepCopyTransclusionContainers:!0}});c().zv({store:a,data:{alive:!0},transaction:r});for(const i of a.getCollectionViewStores())c().zv({store:i.getFormatStore(),data:{is_unlisted:null,is_unlisted_from_semantic_query:null},transaction:r});return await l().Ju({...n,targets:[a],transaction:r}),a}},274375:(e,t,r)=>{r.d(t,{Q:()=>o});r(898992),r(354520),r(672577);var n=()=>r(970013);function o(e,t){const r={property:n().rn,visible:!0,width:276},o={property:t,visible:!0},a=[r,o],i=e.getCollectionViewStores().find((e=>"table"===e.getType())),l=null==i?void 0:i.getFormatStore().getKeyStore("table_properties").getValue();if(!i||!l||0===l.length)return a;const c=l.find((e=>e.property===n().rn))??r;return[c,l.find((e=>e.property===t))??o,...l.filter((e=>e.property!==n().rn&&e.property!==t))]}},374136:(e,t,r)=>{r.d(t,{_G:()=>L,$k:()=>x,w$:()=>U,H$:()=>P,l9:()=>q,NH:()=>I,jY:()=>E,JI:()=>T,ck:()=>F,i5:()=>V,EN:()=>O,gc:()=>B,wK:()=>D});var n=()=>r(244641),o=r(296540),a=()=>r(401497),i=()=>r(764880),l=()=>r(100594),c=()=>r(901610),s=()=>r(921598),u=()=>r(713998),d=()=>r(825237),p=()=>r(792071),g=r(474848);const m=o.memo((function(e){const{size:t,style:r,icon:n,baseUrl:o,getRecordModel:a}=e;return(0,g.jsx)("div",{style:{height:t,width:t,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,verticalAlign:"top",marginTop:1,...r},children:(0,g.jsx)(v,{icon:n,size:t,baseUrl:o,getRecordModel:a})})}));function f(e){return.9*e}function y(e){return.888*e}function v(e){let{icon:t,size:n,baseUrl:o,getRecordModel:a}=e;if(!t)return null;const i=(e,t)=>{const r=d().wY({url:e,baseUrl:o,fullyQualified:!0,permissionRecord:t,width:y(n),userId:void 0});return(0,g.jsx)("img",{alt:"icon",src:r,style:{width:y(n),height:y(n),objectFit:"cover",borderRadius:4,marginTop:1}})},l=(0,r(651124).WO)(t.icon);switch(l.type){case"unicode_emoji":return(0,g.jsx)("div",{style:{fontSize:f(n)},children:l.emoji.unicode});case"custom_emoji":const e=p().xm7.resolveCustomEmojiIcon(t,a);return e?i(e.icon,e.pointer):null;case"app_package_asset":case"notion_icon":case"url":return i(t.icon,t.pointer);default:(0,r(534177).HB)(l)}}var h=()=>r(216519);const _=function(e){const{botValue:t,avatarSize:n,baseUrl:o,theme:a,style:i}=e;if(null!=t&&t.icon){const l=r(522419).GM(t.icon)?d().x8({url:t.icon,width:e.avatarSize,fullyQualified:!0,stripGoogleIconQuery:!0,baseUrl:o,userId:void 0}):t.icon;return(0,g.jsx)("div",{style:{...(0,h().fo)({theme:a,avatarSize:n}),...i},children:(0,g.jsx)("img",{src:l,style:{display:"block",width:"100%",height:"100%",objectFit:"cover"}})})}if(null!=t&&t.name){const e=t.name[0];return(0,g.jsx)("div",{children:(0,g.jsx)("div",{style:{...(0,h().ws)({theme:a,avatarSize:n}),...i},children:(0,g.jsx)("div",{children:e})})})}return(0,g.jsx)("span",{children:"ðŸ¤–"})};var C=()=>r(597777),b=()=>r(869190),S=()=>r(72135),w=()=>r(379632),M=()=>r(100622),A=()=>r(284371),R=()=>r(780054),k=()=>r(10594);const x=(0,r(959013).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"chartLabelFormatHelpers.untitledBlock"}});function B(e,t,r){const n=(0,a().IS)((e=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},initialStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor},avatarStyle:{background:"none"},botStyle:{backgroundColor:e.chartAvatarBackgroundColor,border:`1px solid ${e.chartAvatarBorderColor}`,color:e.chartAvatarColor,fontSize:r?8:10},avatarWrapper:{flexShrink:0},nameWrapper:{minWidth:0,...A().RC}})),[r]);return(0,o.useCallback)(((o,a)=>{var l,c;if(!a)return o.toString();let s,u,d;if(a.actorPointer&&e){var m;const r=(0,i().xC)({pointer:a.actorPointer,getRecordModel:e});u=null==r?void 0:r.asActor,d=null===(m=u)||void 0===m?void 0:m.getDisplayName(t)}return d||(d=o||t.formatMessage(p().Fvx.messages.anonymousPlaceholder)),s=null!==(l=u)&&void 0!==l&&l.isUser()?(0,g.jsx)(h().Ay,{userValue:u,avatarSize:r?16:20,baseUrl:R().A.domainBaseUrl,theme:(0,M().x0)(),fontSize:r?8:10,initialStyle:n.initialStyle,avatarStyle:n.avatarStyle}):null!==(c=u)&&void 0!==c&&c.isBot()?(0,g.jsx)(_,{botValue:u,avatarSize:r?16:20,baseUrl:R().A.domainBaseUrl,theme:(0,M().x0)(),style:n.botStyle}):(0,g.jsx)(h().Ay,{userValue:{name:"?"},avatarSize:r?16:20,baseUrl:R().A.domainBaseUrl,theme:(0,M().x0)(),fontSize:r?8:10,initialStyle:n.initialStyle,avatarStyle:n.avatarStyle}),w().A.renderToStaticMarkup((0,g.jsxs)("div",{style:n.wrapper,children:[(0,g.jsx)("div",{style:n.avatarWrapper,children:s}),r?(0,g.jsx)("div",{style:n.nameWrapper,children:d}):null]}))}),[e,t,r,n])}function D(e,t,r){const n=(0,a().IS)((()=>({wrapper:{display:"flex",alignItems:"center",gap:6,minWidth:0},avatarWrapper:{flexShrink:0},titleWrapper:{minWidth:0,...A().RC}})),[]),i=t.formatMessage(x.titlePlaceholder);return(0,o.useCallback)(((o,a)=>{if(!a||!e)return o.toString()||i;let l;if(a.pagePointer&&e&&(l=e(a.pagePointer)),!l)return o.toString()||i;const c=l.getRenderTitleWithPlaceholder({getRecordModel:e,userTimeZone:r,intl:t}),s=l.getRenderIcon({getRecordModel:e});return w().A.renderToStaticMarkup((0,g.jsxs)("div",{style:n.wrapper,children:[s&&(0,g.jsx)("div",{style:n.avatarWrapper,children:(0,g.jsx)(m,{getRecordModel:e,icon:s,size:16,baseUrl:R().A.domainBaseUrl})}),(0,g.jsx)("div",{style:n.titleWrapper,children:c})]}))}),[e,r,t,i,n.wrapper,n.avatarWrapper,n.titleWrapper])}function F(e){var t,r,n,o;const a="count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator)?"number":T(e.propertySchema);let i;return i="count"===(null===(n=e.aggregation)||void 0===n?void 0:n.aggregator)||"unique"===(null===(o=e.aggregation)||void 0===o?void 0:o.aggregator)?"precision_0":"precision_from_number_property"===e.numberPrecisionOverride?V(e.propertySchema):e.numberPrecisionOverride,t=>"string"==typeof t?t:i&&"precision_uncapped"!==i?(0,S().ZV)(t,a,e.intl,"compact",i):(0,S().ZV)(O(t,2),a,e.intl,"compact",void 0)}function E(e){let{groupBy:t,dateFormat:r,intl:n}=e;return(e,o)=>{let a;return a=o?o.name:"string"==typeof e?e:e.toString(),P({dateString:a,dateFormat:r,groupBy:t,intl:n})}}function P(e){let{dateString:t,dateFormat:r,groupBy:o,intl:a}=e;const i=parseInt(t,10);if(isNaN(i))return t;switch(o){case"relative":default:return t;case"day":return(0,b().ZF)({value:{type:"date",start_date:n().c9.fromMillis(i).toISODate()},date_format:r||C().vz,allowRelativeDates:!0,intl:a});case"week":case"month":case"year":const e=n().c9.fromMillis(i),l={type:o,range:{type:"daterange",start_date:e.toISODate(),end_date:e.plus({[`${o}s`]:1}).minus({days:1}).toISODate()}};return(0,k().nc)({value:l,intl:a})}}function T(e){let t;return("number"===e.type||"formula"===e.type)&&(t=e.number_format),t}function V(e){return"number"===e.type||"formula"===e.type?e.number_precision:void 0}function I(e){let{chartConfig:t,schema:r,highChartsLabel:n,highChartsValue:o,isMultiSeries:a,intl:i,numberPrecisionOverride:s}=e,d=n,p=o;if(!t)return{label:d,value:p};const g=t.dataConfig;let m,f,y,v;if(a){if((0,c().m)(t)&&"groups_reducer"===t.dataConfig.type){var h;const e=t.dataConfig;if(m=null===(h=e.aggregationConfig.stackOptions)||void 0===h?void 0:h.groupBy,m){const e=(0,u()._g)({schema:r,property:m.property});e&&(0,l().zn)(e)&&(f=e)}v=e.aggregationConfig.aggregation,"count"!==v.aggregator&&(y=(0,u()._g)({schema:r,property:v.property}))}}else"groups_reducer"===g.type?(m=g.groupBy,f=(0,u()._g)({schema:r,property:g.groupBy.property}),v=g.aggregationConfig.aggregation,"count"!==v.aggregator&&(y=(0,u()._g)({schema:r,property:v.property}))):y=(0,u()._g)({schema:r,property:g.valueProperty});if(d=f?U({propertySchema:f,groupByFormat:m,aggregation:void 0,highChartsLabel:n,intl:i}):d,p&&"number"==typeof p&&y&&(0,l().JW)(y)){var _,C,b,w;const e="count"===(null===(_=v)||void 0===_?void 0:_.aggregator)||"unique"===(null===(C=v)||void 0===C?void 0:C.aggregator)?"number":T(y),t="count"===(null===(b=v)||void 0===b?void 0:b.aggregator)||"unique"===(null===(w=v)||void 0===w?void 0:w.aggregator)?"precision_0":s??V(y);p=t&&"precision_uncapped"!==t?(0,S().ZV)(p,e,i,"compact",t):(0,S().ZV)(O(p,2),e,i,"compact")}return{label:d,value:p}}function U(e){const{propertySchema:t,groupByFormat:r,aggregation:n,highChartsLabel:o,intl:a}=e;if(t&&(0,l().JW)(t)){const e="count"===(null==n?void 0:n.aggregator)||"unique"===(null==n?void 0:n.aggregator)?"number":T(t),r=parseInt(o,10);return isNaN(r)||"percent"===e?o:(0,S().ZV)(r,e,a,"compact")}const i="formula"===(null==r?void 0:r.type)?r.groupBy:r;return t&&(0,l().i8)(t)&&i&&(0,s().Ik)(i)?P({dateString:o,dateFormat:t.date_format,groupBy:i.groupBy,intl:a}):o}const N=1.2,z=2;function L(e){var t,r,n,o;if("count"===(null===(t=e.aggregation)||void 0===t?void 0:t.aggregator)||"unique"===(null===(r=e.aggregation)||void 0===r?void 0:r.aggregator))return!1;return"percent"===T(e.propertySchema)||(void 0!==e.userYAxisMax&&void 0!==e.userYAxisMin&&Math.abs(e.userYAxisMax-e.userYAxisMin)<z||(!!(null!==(n=e.userYAxisMax)&&void 0!==n&&n.toString().includes(".")||null!==(o=e.userYAxisMin)&&void 0!==o&&o.toString().includes("."))||Math.abs(e.dataYAxisMax)<N&&Math.abs(e.dataYAxisMin)<N))}function q(e){return e%1==0?e:e.toFixed(1)}function O(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}},384856:(e,t,r)=>{r.d(t,{B:()=>g,G:()=>p});var n=()=>r(584262),o=()=>r(650829),a=()=>r(152236),i=()=>r(681445),l=()=>r(492414),c=()=>r(732038),s=()=>r(750660),u=()=>r(435009),d=()=>r(751156);function p(e){const{collectionContextStore:t,environment:r,originRect:o,isChartDrilldown:i,intl:l}=e,u=null==t?void 0:t.collectionViewBlockStore(),p=null==t?void 0:t.collectionViewStore();u&&p&&s().ho({environment:r,blocks:[u],originRect:o,moveToContext:"ai_ephemeral_view",isAddTo:!0,isDefaultPrivateLocation:!0,forceShowPrivatePageOption:!0,dontCommitActions:!0,onAccept:async e=>{const{performResult:o}=await d().createAndCommitAsync({environment:r,userAction:"UnlistedCollectionViewMoreButton.handleAddViewToMenuClick",waitForServerCommit:!0,perform:n=>i?c().Iz({environment:r,collectionViewStore:p,collectionViewBlockStore:u,collectionContextStore:t,acceptMoveToArgs:e,transaction:n,intl:l}):(0,a().h)({environment:r,transaction:n,linkedDatabaseBlockStore:u,acceptMoveToArgs:e})});await g({environment:r,blockStore:o,pageVisitSource:i?n().y8.ChartsDrilldown:n().y8.AIEphemeralView})}})}async function g(e){const{environment:t,blockStore:r,pageVisitSource:n}=e;if(!r)return;const a=(0,l().Ay)({store:r,pageVisitSource:n});u().oo({environment:t,url:a});const{assistantMenuActions:c}=await o().assistantDependency.load();i().S.close(),await c.closeAssistantRightHandSideMenu({environment:t})}},390527:(e,t,r)=>{r.r(t),r.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>F,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>w,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>S,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>h,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>A,areRecurrenceSchedulesEqual:()=>I,convertFromUnpersistedRecurrenceConfig:()=>V,convertToUnpersistedRecurrenceConfig:()=>E,getFormattedEndCondition:()=>D,getFormattedNextRecurrenceTime:()=>B,getNewEndTimestamp:()=>P,getNextDateUtc:()=>x,getRecurrenceAfter:()=>R,isRunningBetweenMidnightAnd3AM:()=>k,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>C,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>M});r(898992),r(354520),r(581454);var n=()=>r(244641);r(944114);function o(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(0===r.length)return e.map((e=>[e]));const a=[];for(const i of e)a.push(...o(r[0],...r.slice(1)).map((e=>[i,...e])));return a}var a=()=>r(496603),i=()=>r(534177),l=()=>r(720665),c=()=>r(597777),s=()=>r(869190),u=()=>r(416504),d=()=>r(402390);class p extends(()=>r(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var g=()=>r(912720);const m=(0,r(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},y={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},v=99,h=999;function _(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function C(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function b(e){const{start_date:t,frequency:r,interval:n,weekdays:a,timezone:l,hour:s,minute:u}=e,d="week"===r&&a?a.map((e=>y[e])):void 0,g={};return(0,i().O9)(e.end_condition)&&("date"===e.end_condition.type?g.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?g.count=e.end_condition.number_of_occurrences:(0,i().HB)(e.end_condition)),"month"===e.frequency&&(0,i().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?g.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?g.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,r]=e;return y[t].nth(r)})):(0,i().HB)(e.monthly_restriction)),new p({freq:f[r],dtstart:(0,c().eU)(t),interval:n,byweekday:d,tzid:l,byhour:s??0,byminute:u??0,bysecond:0,...g})}const S=1,w=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const r=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=n>S,i=r.length>=w;return{violatesConstraint:a||i,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:o}}function A(e){var t;const{recurrence:r,afterDate:o}=e;if("number"===(null===(t=r.end_condition)||void 0===t?void 0:t.type)||r.start_date>=o)return r;let a=n().c9.fromMillis(r.start_date,{zone:"utc"});const i=n().c9.fromMillis(o,{zone:"utc"});switch(r.frequency){case"year":{const e=Math.floor(i.diff(a,"years").years/r.interval);a=a.plus({years:e*r.interval});break}case"month":{const e=Math.floor(i.diff(a,"months").months/r.interval);a=a.plus({months:e*r.interval});break}case"week":{const e=Math.floor(i.diff(a,"weeks").weeks/r.interval);a=a.plus({weeks:e*r.interval});break}case"day":{const e=Math.floor(i.diff(a,"days").days/r.interval);a=a.plus({days:e*r.interval});break}}return{...r,start_date:(0,c().DH)(a.toMillis())}}function R(e){const{recurrence:t,afterDate:r}=e;if((0,g().wt)(t)){const e=(0,c().l1)(r);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(A({recurrence:t,afterDate:r})).after((0,c().eU)(r));if(!e)return;return(0,c().h1)(e)}}function k(e){return 0===e.hour||1===e.hour||2===e.hour}function x(e){return b(e).after((0,c().eU)((0,c().Rz)()))||void 0}function B(e){const{recurrence:t,intl:r}=e,o=x(V(t));if(!o)return;const a=k(t),i=n().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(r)).setZone(t.timezone),l=(0,s().Yq)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:r,shortenDate:!0});if(a)return r.formatMessage(m.dateBetweenMidnightAnd3AM,{date:l});{let e=i.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,u().P)()&&(e+=` ${i.toFormat("ZZZZ")}`),r.formatMessage(m.dateAtTime,{date:l,time:e})}}function D(e,t){return(0,i().O9)(e)?"number"===e.type?t.formatMessage(m.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,s().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().HB)(e):t.formatMessage(m.noEndCondition)}const F=100;function E(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,i().HB)(e.end_condition):void 0}}function P(e,t,r){return e.plus(r-t)}function T(e,t){const r=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(r.toJSDate())}}function V(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?T(e,e.end_condition):(0,i().HB)(e.end_condition):void 0}}function I(e,t){const r=a().fN(e,(e=>void 0!==e)),n=a().fN(t,(e=>void 0!==e));return a().n4(r,n)}},603815:(e,t,r)=>{r.d(t,{A$:()=>A,JQ:()=>R,Vn:()=>w,s4:()=>M});r(16280),r(944114),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(803949),r(581454);var n=()=>r(857639),o=()=>r(585515),a=()=>r(577449),i=()=>r(388821),l=()=>r(179034),c=()=>r(545285),s=()=>r(534177),u=()=>r(449506),d=()=>r(780054),p=()=>r(989423),g=()=>r(870618),m=()=>r(303626),f=()=>r(14307),y=()=>r(245865),v=()=>r(540758),h=()=>r(670631),_=()=>r(508496),C=()=>r(571963),b=()=>r(603815),S=()=>r(108944);async function w(e){const{environment:t,request:r,abortSignal:n,prefetchCacheKey:o,headers:a}=e;return(0,C().updateLoadCachedPageChunkCalledAt)(),f().isConnected()||f().isConnecting()?u().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:r,abortSignal:n,prefetchCacheKey:o,headers:a}):u().callApi({eventName:"loadPageChunkV2",environment:t,data:r,abortSignal:n,prefetchCacheKey:o,headers:a})}async function M(e){const{mode:t,environment:r,request:s,isFirstChunk:u,abortSignal:f}=e,y={...s,limit:30,cursor:s.cursor||{stack:[]},baseUrl:d().A.domainBaseUrl,publicDomainName:d().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await b().A$(r,{id:s.page.id,table:l().ev}),null!=f&&f.aborted))throw new Error("Abort signal received");const _=i().RecordMapWithRole.create(),C=[];let S=!1;const w=new Set,M=await o().T(y,a().h.fromMonomorphicFunctionUnsafe((async e=>{const n=await g().h7({environment:r,pointer:e,abortSignal:f,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=f&&f.aborted)throw new Error("Abort signal received");if(n)return _.setModelAndRole(e,n.model,n.role),n.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,c().u)(e)&&!w.has(e.id)&&u){if(void 0===h().A.state.offlinePages)return C.push(e),void(S=!0);if(void 0===h().A.state.offlinePages||!v().Bd(s.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);C.push(e)}})),((e,t,r,n)=>{m().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${r})`),null!=n&&n.suppressErrorOnClient&&w.add(t.id)}));if(S&&(await h().A.waitUntil((()=>void 0!==h().A.state.offlinePages)),!v().Bd(s.page.id))){const[e]=C;throw new Error(`Record not found: ${e.table},${e.id}`)}if(C.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:r,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&n().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:s.page.id,missingRecords:C}})})),null!=f&&f.aborted)throw new Error("Abort signal received");return{recordMap:_.toJson(),cursor:M.cursorValue}}async function A(e,t){const r=e.currentUser.id;if(!r||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:r})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),y().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function R(e){if(!_().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=i().RecordMapPolymorphic.create();let r=0;const n=()=>r>=50,o=e=>{"space"!==(null==e?void 0:e.table)&&(n()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),r++))};if(e.isReady())for(const i of(0,S().E)(e))o(i);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);o(t.getModel({table:"notion_user",id:e.userId}));let r=0;for(const e of t.getPointersByTable("notion_user")){if(n()||r>=10)break;r++,o(t.getModel(e))}}const a=Array.from(t).map((e=>{let{pointer:t,value:r}=e;if(void 0!==r)return{pointer:t,version:r}})).filter(s().O9);return a.length?a:void 0}},725649:(e,t,r)=>{function n(e){return!(!e||"askUserToPick"in e)}function o(e){if(!e||!("askUserToPick"in e))return e}function a(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}r.d(t,{DK:()=>o,K$:()=>n,j6:()=>a})},732038:(e,t,r)=>{r.d(t,{Sp:()=>w,sw:()=>M,Iz:()=>A});var n=()=>r(584262),o=()=>r(713998),a=()=>r(750660),i=()=>r(467676),l=()=>r(681445),c=()=>r(989423),s=()=>r(476492),u=(r(898992),r(354520),()=>r(901610)),d=()=>r(592269),p=()=>r(289915),g=()=>r(857639),m=()=>r(416504),f=()=>r(498212),y=()=>r(274375);var v=()=>r(374136),h=()=>r(492414),_=()=>r(753199),C=()=>r(630116),b=()=>r(246826),S=()=>r(435009);function w(e){const{chartConfig:t,collectionViewBlockStore:r,format:n,dataPoint:a,clickEvent:i,schema:h,environment:C,collectionContextStore:b,intl:S,query2:w,temporaryViewState:M}=e;if(!r||"groups_reducer"!==(null==t?void 0:t.dataConfig.type))return;(0,_().SQ)({event:i,context:_().y$.EditorClick});const A=function(e){const{dataPoint:t,propertySchema:r,groupByFormat:n,aggregation:o,intl:a}=e,i=t.name??t.x.toString();if(!r)return i;return(0,v().w$)({propertySchema:r,groupByFormat:n,aggregation:o,highChartsLabel:i,intl:a})}({dataPoint:a,propertySchema:(0,o()._g)({schema:h,property:t.dataConfig.groupBy.property}),groupByFormat:null==t?void 0:t.dataConfig.groupBy,aggregation:null==t?void 0:t.dataConfig.aggregationConfig.aggregation,intl:S}),R=function(e){var t,r;const{chartConfig:n,dataPoint:o,format:a,schema:i,collectionViewBlockStore:l,query2:c,temporaryViewState:s}=e;if(!(n&&"placeholder"!==n.type&&"results_reducer"!==n.dataConfig.type&&n.dataConfig.groupBy&&o&&l&&l.pointer.spaceId))return void g().log({level:"error",from:"chartDrilldownHelpers",type:"chartDrilldownMissingRequiredData",error:{name:"chartDrilldownHelpers",message:"Unexpected error"},data:{miscDataToConvertToString:{chartConfig:n,dataPoint:o,collectionViewBlockStore:l}}});const v=n.dataConfig.groupBy.property,h=(0,y().Q)(l,v),_={type:"table",parent_id:l.pointer.id,parent_table:l.pointer.table,alive:!0,space_id:l.pointer.spaceId,format:{is_unlisted:!0,collection_pointer:null==a?void 0:a.collection_pointer,property_filters:(null==s||null===(t=s.propertyFilters)||void 0===t?void 0:t.value)??(null==a?void 0:a.property_filters),table_properties:h},query2:{...c,filter:(null==s||null===(r=s.combinatorFilter)||void 0===r?void 0:r.value)??(null==c?void 0:c.filter)}};let C;var b;return o.groupFormat&&(C=(0,d().K8)({schema:i,propertyMapping:void 0,groupBy:n.dataConfig.groupBy,group:o.groupFormat,timeZone:(0,m().P)()})),C&&((0,p().dU)(C)?null!==(b=_.query2)&&void 0!==b&&b.filter?_.query2.filter=(0,p().GV)([_.query2.filter,C]):_.query2.filter=C:(0,p().yX)(C)&&(_.format.property_filters=[..._.format.property_filters??[],{filter:C,id:(0,f().Ay)()}])),"groups_reducer"===n.dataConfig.type&&(0,u().m)(n)&&n.dataConfig.aggregationConfig.stackOptions&&(_.format.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;const r=e.aggregationConfig.stackOptions.groupBy;return r.hideEmptyGroups=!0,r}(n.dataConfig)),_}({chartConfig:t,format:n,dataPoint:a,schema:h,collectionViewBlockStore:r,query2:w,temporaryViewState:M});if(!R)return;const k=(0,s().sl)(b);(0,c().u4)({environment:C,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...k,drilldown_type:"grouped",from:"chart_data_point"}}}),l().S.openCollectionDrilldownView({collectionViewValue:R,collectionViewBlockStore:r,viewsModuleContext:b.viewsModuleContextStore.state,title:A})}function M(e){var t;const{collectionStore:r,dataPoint:o,clickEvent:a,environment:i,collectionContextStore:l}=e;if(null==o||null===(t=o.pagePointer)||void 0===t||!t.id||!r)return;(0,_().SQ)({event:a,context:_().y$.EditorClick});const u=C().Bv.createChildStore(r,o.pagePointer),d=(0,h().Ay)({store:u,fullyQualified:!1,pageVisitSource:n().y8.Expand,showMoveTo:!1,openInCenterPeek:!0});if(!d)return;const p=(0,s().sl)(l);(0,c().u4)({environment:i,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...p,drilldown_type:"results",from:"chart_data_point"}}}),S().oo({environment:i,url:d})}async function A(e){const{environment:t,collectionViewStore:r,collectionViewBlockStore:n,collectionContextStore:o,acceptMoveToArgs:l,transaction:u,intl:d}=e;if(!r)return;const p=n.getCollectionPointer(),g=b().Wv({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,type:"collection_view",transaction:u}),m=(0,i().t)({environment:t,transaction:u,collectionViewStore:r,collectionViewBlockStore:g,intl:d,copyNameExactly:!0});if(!m)return;m.getFormatStore().getKeyValue("collection_pointer")||b().zv({store:m.getFormatStore().getKeyStore("collection_pointer"),data:p,transaction:u}),b().zv({store:m.getFormatStore(),data:{is_unlisted:null},transaction:u}),await a().Ju({...l,targets:[g],transaction:u});const f=(0,s().sl)(o);return(0,c().u4)({environment:t,event:{eventName:"collection_chart_drilldown_save",eventProperties:{...f,new_collection_view_block_id:g.pointer.id}}}),g}}}]);