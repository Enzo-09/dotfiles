"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[55019],{609316:(e,o,t)=>{t.d(o,{V:()=>i});const i=(0,t(583835).Dv)("importFile")},727722:(e,o,t)=>{t.r(o),t.d(o,{createNewCollectionAndMergeCSV:()=>_,mergeWithCSV:()=>A});var i=()=>t(700500),n=()=>t(857639),r=()=>t(416504),a=()=>t(388821),c=()=>t(179034),l=()=>t(869558),s=()=>t(161479),d=()=>t(919709),p=()=>t(609316),m=()=>t(559926),u=()=>t(686526),g=()=>t(171718),f=()=>t(901389),C=()=>t(357625),S=()=>t(496414),v=()=>t(246826),V=()=>t(751156),T=()=>t(892632),w=()=>t(989423),y=()=>t(389658),h=()=>t(682146),k=()=>t(972435),b=()=>t(129522),M=()=>t(351360),I=()=>t(508496);const B=(0,t(959013).YK)({importingCSV:{id:"databaseViewActions.importingCSV.loadingMessage",defaultMessage:"Importing"},uploadingCSV:{id:"databaseViewActions.uploadingCSV.loadingMessage",defaultMessage:"Uploading"},importFailed:{id:"databaseViewActions.importFailedError.message",defaultMessage:"Import failed."}});async function _(e){var o,n;const{environment:r,collectionContextStore:s,collectionSettingsStore:p,baseViewType:m,input:f,from:C,collectionViewBlockStore:S}=e,T=s.collectionViewStore();if(!T||!S||!m)return;if(u().os({collectionSettingsStore:p}),"chart"===m)return;const w=(0,y().qP)({isInline:S.getType()===i().xd.collectionView,viewType:m,chartType:T.getChartPlaceholderType()}),k=S.getSpaceId()??T.getSpaceId()??(null===(o=M().default.state.currentSpaceStore)||void 0===o?void 0:o.id)??(null===(n=M().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getSpaceId()),b=k?r.idCreator.getSpaceIdCreatorSync(k):void 0,I=a().RecordMapPolymorphic.create();if(I.set({id:"block",table:c().ev},S.pointer),I.set({id:"view",table:l().Gy},T.pointer),V().createAndCommit({userAction:"useNewButtonMenuItem.handleNewButtonForViewType",environment:r,canUndo:!0,perform:e=>{g().j({environment:r,sourceBlockId:"root",targetBlockPointer:S.pointer,sourceBlockSubtree:(0,a().partialRecordMapToRecordMap)(w),targetRecordCache:S.inMemoryRecordCache,transaction:e,recordPointerMap:I,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0,spaceIdCreator:b})}}),!T||!S)return;const B=(0,d().x9d)(f),_=T,N=S,{addCollectionViewSourceToNewCollection:F}=await t.e(12071).then(t.bind(t,711996));V().createAndCommit({userAction:"CollectionSettingsCreateViewSourceNew.handleCreateDB",environment:r,canUndo:!0,perform:e=>{v().zv({store:_,data:{name:m?h().to[m]:void 0,query2:void 0,type:m??"table"},transaction:e}),F({environment:r,collectionViewStore:_,collectionViewBlockStore:N,name:B,transaction:e,targetCollectionRecordPointerMap:void 0});const o=N.getCollectionViewSourceCollectionStore();s.setContext({type:"collectionView",collectionViewBlockStore:N,collectionStore:o,collectionViewStore:_,pageVisitSourceOverride:void 0})}}),A({environment:r,store:N,from:C})}function A(e){const{store:o,environment:t,from:i}=e;let a;const c={},l=performance.now();T().Bz({environment:t,accept:".csv",bucket:"temporary",onStart:e=>{a=e,S().m({message:B.uploadingCSV})},onCompleteWithToken:e=>{m().eH(t,{from:i,import_source:"csv"}),c.uploadTimeTaken=performance.now()-l,c.firstTimeNavigateToCollection=c.uploadTimeTaken,(async(e,i,n)=>{S().m({message:B.importingCSV});const a=o.getCollectionStore();if(!a)return;if(!b().K.findCollectionViewBlockFromStore(o))return;const c=(0,r().P)(),l=C().UT(t,p().V,{importType:"MergeIntoCollection",fileURL:e,fileName:i,collection:{id:a.id,spaceId:(0,s().e)(a.pointer.spaceId)},spaceId:(0,s().e)(a.pointer.spaceId),userTimeZone:c,signedToken:n}),d=I().default.checkGate({gateName:"csvimport_faster_navigate_to_page_enabled"});let m=!1;for await(const o of l){if(o.error)throw f().f1(k().A.formatMessage(B.importFailed)),S().V(),o.error;!m&&d&&"status"in o.value&&"updated_collection"===o.value.status.message&&(m=!0,S().V())}S().V()})(e[0].fileUrl,a[0].name,e[0].signedToken),c.overallTimeTaken=performance.now()-l;for(const[o,i]of Object.entries(c))(0,w().u4)({environment:t,event:{eventName:"import_file_finished",eventProperties:{importUploadType:"csv",importType:"MergeIntoCollection",importLatency:i,importSource:"file",importLatencyType:o,importFileCount:1}}});n().log({level:"info",from:"mergeWithCSV",type:"mergeWithCSVFinished",data:{miscDataToConvertToString:{data:{uploadType:"csv",importType:"MergeIntoCollection",importLatencies:c,importSource:"file",fileNames:[a[0].name]}}}})},onError:e=>{S().V(),f().f1(k().A.formatMessage(B.importFailed))}})}}}]);