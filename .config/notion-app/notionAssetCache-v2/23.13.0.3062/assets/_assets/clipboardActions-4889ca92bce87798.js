"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[5834,22542,69184,90871,99171],{87017:(e,t,n)=>{n.r(t),n.d(t,{duplicateBlocks:()=>w,duplicateBlocksWithMaybeConfirmation:()=>M,insertBlockAbove:()=>A,insertBlockAndEdit:()=>R,insertBlockBelow:()=>_,insertTextAbove:()=>P,insertTextBelow:()=>D});n(18107),n(944114),n(967357);var o=()=>n(908006),r=()=>n(206267),i=()=>n(161479),a=()=>n(496603),s=()=>n(855801),l=()=>n(466614),c=()=>n(60867),d=()=>n(171718),u=()=>n(901389),p=()=>n(620689),m=()=>n(797265),f=()=>n(751156),g=()=>n(838256),b=()=>n(521358),v=()=>n(799832),k=()=>n(413962),y=()=>n(405417),h=()=>n(328732),S=()=>n(53664),I=()=>n(393255),x=()=>n(77246),T=()=>n(502438),C=()=>n(611371);async function M(e){const{environment:t,blocks:n,duplicateOnlyCollectionSchema:r,callback:i}=e;if(!(0,C().EF)(t))return;const a=await s().VI.duplicateActions.load();let l=n;if(1===n.length){const e=await b().rW({environment:t,block:n[0],action:"duplicate"});if("user_canceled"===e)return void(null==i||i());l=e}const d=l.at(0);if(!d)return;const u=(0,v().U)(d);if(u&&(0,y().ls)(d,u))await c().un({blocks:l,environment:t,analyticsFrom:"subitem_duplication",callback:i,collectionContextStore:u});else{const{serverCommitResult:e}=f().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{w({environment:t,blocks:l,transaction:e,preferDuplicateLocation:"local",duplicateOnlyCollectionSchema:r,duplicateActions:a})},transactionTooBigFallback:e=>{w({environment:t,blocks:l,transaction:e,preferDuplicateLocation:"server",duplicateOnlyCollectionSchema:r,duplicateActions:a})}});e.then(i)}o().default.afterNextFlush((()=>{p().BM({environment:t})}))}function w(e){const{environment:t,blocks:n,transaction:o,preferDuplicateLocation:r,lastTopLevelBlockStore:s,preventSetSelection:c,duplicateOnlyCollectionSchema:d,duplicateActions:p}=e,f=a().$z(n,(e=>e.getFormat().app_id??e.id)),g=[];return a().jJ(f,(e=>{const n=e[0],a=!n.isTransclusionType(),{blockStores:s,onComplete:c}=p.duplicateBlock({environment:t,stores:e,transaction:o,targetSpaceId:(0,i().e)(n.pointer.spaceId),preferDuplicateLocation:r,options:{addCopyName:(0,S().A)(n),deepCopyTransclusionContainers:a,resolveTemplateVariables:!(n.isInsideTemplate()||n.isInsideFactoryOrDuplicateBlocksAction()),duplicateOnlyCollectionSchema:d}});g.push(...s),c.then((e=>{if("error"===e.status){const n=e.error;l().Rk(n)?l().UK(t,{product:n.clientData.metadata.product}):u().f1(e.errorMessage)}}))})),m().LE({blocksToInsert:g,target:s?[s]:n,environment:t,transaction:o,replaceEmptyTextBlock:!1,preventSetSelection:c}),g}function _(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,s=T().default.getCurrentRecordCache(),l=new(g().UF)({environment:t,userFlow:"page"===(null==n?void 0:n.blockType)?"user_flow_create_page":"user_flow_create_block",succeedOnEnqueue:!0});let c;if((0,C().EF)(t)&&n&&s){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:s,from:i,selection:o});l.track(e.pointer,r),c=m().LE({environment:t,blocksToInsert:[e],target:o,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:a})[0]}else l.fail("invalid_state");return c}function A(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,s=T().default.getCurrentRecordCache();let l;if((0,C().EF)(t)&&n&&s){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:s,from:i,selection:o});l=m().t1({environment:t,blocks:[e],selection:o,transaction:r,preventSetSelection:a})[0]}return l}function R(e){const{environment:t,selection:n,transaction:o}=e,i=_({...e,preventSetSelection:!0});if(i){var a;m().x5({environment:t,insertedStores:[i],isCreated:!0});const e=x().Uv.getMode(i);if("suggest"===e){const e=k().RR(t,o,i);k().tM(o,i,{id:r().JW(),type:"insert",discussionId:e.id}),k().c3({environment:t,transaction:o,discussionStore:e,addModifiedBlockIdsAfter:[i.id]})}"suggest"===e&&null!==(a=i.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==a&&a.isCommentOnly()||m().um({transaction:o,blocks:n})}return i}function D(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",s=_({environment:r,selection:t,createBlockItem:h().ry.text,analyticsFrom:a,transaction:n});return s&&o().default.afterNextFlush((()=>{I().zz({environment:r,blockStore:s,insertedTextBlockLocation:"below"})})),s}function P(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",s=A({environment:r,selection:t,createBlockItem:h().ry.text,analyticsFrom:a,transaction:n});return s&&o().default.afterNextFlush((()=>{I().zz({environment:r,blockStore:s,insertedTextBlockLocation:"above"})})),s}},136833:(e,t,n)=>{function o(e){return Date.now()-parseInt(e.timestamp)}n.d(t,{S:()=>o})},375078:(e,t,n)=>{n.r(t),n.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>x,transformBlocks:()=>I,transformIntoColumnList:()=>T});n(581454);var o=()=>n(908006),r=()=>n(700500),i=()=>n(179034),a=()=>n(496603),s=()=>n(722101),l=()=>n(44729),c=()=>n(915457),d=()=>n(246826),u=()=>n(797265),p=()=>n(778417),m=()=>n(725614),f=()=>n(751156),g=()=>n(62287),b=()=>n(87017),v=()=>n(594794),k=()=>n(299545),y=()=>n(508496),h=()=>n(630116),S=()=>n(65269);function I(e){const{environment:t,blocks:n,blockType:S,transaction:I}=e;if(S!==r().xd.transclusionContainer)if(S===r().xd.callout&&y().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,k().iU)(s))return;const u=s.getRecordStoreUIParent();if(!(u&&u instanceof h().Bv))return;const f=(0,v().Z1)({environment:t,table:i().ev,spaceId:u.getSpaceId()}),g=d().Wv({environment:t,id:f,type:r().xd.callout,inMemoryRecordCache:s.inMemoryRecordCache,transaction:o,spaceId:u.getSpaceId(),format:{callout_version:2}});l().NI({parentStore:s,childStore:g,after:a.id,transaction:o});C({newParentStore:g.getContentStore(),blocks:n,transaction:o}),c().s4({store:g,transaction:o}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[g]})}({environment:t,blocks:n,transaction:I});else if(S!==r().xd.columnList)if(S!==r().xd.slide)if((0,r().ZK)(S)){const e=parseInt(S.replace("column","").replace("block","")),r=a().oE(a().Hn(e-1,(()=>b().insertTextBelow({environment:t,blocks:n,transaction:I})))),i=[...n,...r],s=T({environment:t,blocks:i,transaction:I});o().default.afterNextFlush((()=>{m().setSelectionAtStart({store:s[0].getBlockTitleStore()})}))}else for(const r of n)if(r.isCalloutV2()){const e=r.getParentBlockStore();if(e){const i=r.getContentStores();f().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:i.map((e=>e.id)),after:r.id}},transaction:I}),l().zz({parentStore:e.getContentStore(),childStore:r,transaction:I});for(const e of i)g().pd({environment:t,block:e,blockType:S,transaction:I,isMultiBlockTransformation:n.length>1});o().default.afterNextFlush((()=>{u().dL(t,i.map((e=>e.id)))}))}}else g().pd({environment:t,block:r,blockType:S,transaction:I,isMultiBlockTransformation:n.length>1});else!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,k().iU)(s))return;const c=s.getRecordStoreUIParent();if(!(c&&c instanceof h().Bv))return;const u=(0,v().Z1)({environment:t,table:i().ev,spaceId:c.getSpaceId()}),f=d().Wv({environment:t,id:u,type:r().xd.slide,inMemoryRecordCache:s.inMemoryRecordCache,transaction:o,spaceId:c.getSpaceId()});l().NI({parentStore:s,childStore:f,after:a.id,transaction:o});C({newParentStore:f.getContentStore(),blocks:n,transaction:o}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[f]})}({environment:t,blocks:n,transaction:I});else T({environment:t,blocks:n,transaction:I});else!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const l=a.getRecordStoreUIParent();if(!l||!(0,k().iU)(l))return;const c=l.getRecordStoreUIParent();if(!c||!(0,k()._p)(c))return;if(!c.isDefined())return;const u=(0,v().Z1)({environment:t,table:i().ev,spaceId:c.getSpaceId()}),f=d().Wv({environment:t,id:u,type:r().xd.transclusionContainer,inMemoryRecordCache:l.inMemoryRecordCache,transaction:o,spaceId:c.getSpaceId()});s().WH({parentStore:l,insertStore:f,afterStore:a,transaction:o});C({newParentStore:f.getContentStore(),blocks:n,transaction:o}),m().clear({environment:t}),p().IU({environment:t}),p().td({environment:t,stores:[f]})}({environment:t,blocks:n,transaction:I})}function x(e){let{environment:t,blocks:n,transaction:o}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(n)&&I({environment:t,blocks:n,blockType:"collection_view_page",transaction:o})}function T(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return[];const l=a.recordStoreUIParentStore;if(null==l||!l.valueIs(S()._))return[];const c=(0,v().Z1)({environment:t,table:i().ev,spaceId:a.getSpaceId()}),u=d().Wv({environment:t,id:c,type:r().xd.columnList,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:a.getSpaceId()}),{childStore:p}=s().nc({parentStore:l,insertStore:u,beforeStore:a,transaction:o});return n.map((e=>{const n=(0,v().Z1)({environment:t,table:i().ev,spaceId:a.getSpaceId()}),c=d().Wv({environment:t,id:n,type:r().xd.column,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:a.getSpaceId()}),{childStore:u}=s().TF({parentStore:l,childToRemoveStore:e,transaction:o}),{childStore:m}=s().WH({parentStore:p.getContentStore(),insertStore:c,transaction:o}),{childStore:f}=s().WH({parentStore:m.getContentStore(),insertStore:u,transaction:o});return f}))}function C(e){const{newParentStore:t,blocks:n,transaction:o}=e;for(const r of n){const e=r.getRecordStoreUIParent();null!=e&&e.valueIs(S()._)&&(s().TF({parentStore:e,childToRemoveStore:r,transaction:o}),s().BC({parentStore:t,appendStore:r,transaction:o}))}}},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>x,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>I,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>k,RRULE_WEEKDAYS_MAP:()=>b,adjustedStartDateIfPossible:()=>C,areRecurrenceSchedulesEqual:()=>N,convertFromUnpersistedRecurrenceConfig:()=>E,convertToUnpersistedRecurrenceConfig:()=>P,getFormattedEndCondition:()=>R,getFormattedNextRecurrenceTime:()=>A,getNewEndTimestamp:()=>B,getNextDateUtc:()=>_,getRecurrenceAfter:()=>M,isRunningBetweenMidnightAnd3AM:()=>w,isValidRecurrenceInterval:()=>y,isValidRecurrenceNumberOfRuns:()=>h,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>T});n(898992),n(354520),n(581454);var o=()=>n(244641);n(944114);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),s=()=>n(720665),l=()=>n(597777),c=()=>n(869190),d=()=>n(416504),u=()=>n(402390);class p extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(912720);const f=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),g={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},b={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},v=99,k=999;function y(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function h(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=k}function S(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:s,hour:c,minute:d}=e,u="week"===n&&i?i.map((e=>b[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,l().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return b[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new p({freq:g[n],dtstart:(0,l().eU)(t),interval:o,byweekday:u,tzid:s,byhour:c??0,byminute:d??0,bysecond:0,...m})}const I=1,x=1;function T(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>I,a=n.length>=x;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function C(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let i=o().c9.fromMillis(n.start_date,{zone:"utc"});const a=o().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,l().DH)(i.toMillis())}}function M(e){const{recurrence:t,afterDate:n}=e;if((0,m().wt)(t)){const e=(0,l().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(C({recurrence:t,afterDate:n})).after((0,l().eU)(n));if(!e)return;return(0,l().h1)(e)}}function w(e){return 0===e.hour||1===e.hour||2===e.hour}function _(e){return S(e).after((0,l().eU)((0,l().Rz)()))||void 0}function A(e){const{recurrence:t,intl:n}=e,r=_(E(t));if(!r)return;const i=w(t),a=o().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),s=(0,c().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(o().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function R(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:o().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const D=100;function P(e){return{...e,start_date:(0,l().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,l().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function B(e,t,n){return e.plus(n-t)}function F(e,t){const n=o().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,l().Rz)(n.toJSDate())}}function E(e){return{...e,start_date:(0,l().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?F(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function N(e,t){const n=i().fN(e,(e=>void 0!==e)),o=i().fN(t,(e=>void 0!==e));return i().n4(n,o)}},487494:(e,t,n)=>{n.d(t,{A:()=>r});var o=function(e){return e[e.Preview=0]="Preview",e[e.Mention=1]="Mention",e[e.Link=2]="Link",e}(o||{});const r=o},552484:(e,t,n)=>{n.r(t),n.d(t,{clipboardMessages:()=>Et,copy:()=>fn,copyDirectLinkToContent:()=>zn,copyFormattedLinkToBlock:()=>Wn,copyHtml:()=>$n,copyLinkToBlock:()=>On,copyLinksToBlocks:()=>Hn,copyString:()=>Xn,copyWithToast:()=>Gn,createSelectedMultiColumnBlockSubtree:()=>an,cutWithMaybeConfirmation:()=>mn,getFormulaEditorInformation:()=>Dn,getInlineTextValueFromClipboardData:()=>Kn,getInlineTitleValueFromClipboardTextHtml:()=>xn,getNotionSelectionClipboardData:()=>nn,htmlToMultiTextSelectionClipboardData:()=>In,insertOrTransformToCodeBlock:()=>Vn,markdownToBlocks:()=>Jn,multiTextSelectionToMarkdown:()=>qn,paste:()=>Nn,pasteFilesForBlocks:()=>gn,pasteMarkdown:()=>hn,serializeMultiTextSelectionToClipboardData:()=>cn,serializePagePropertiesAsText:()=>sn,triggerBrowserCopy:()=>Zn});var o={};n.r(o),n.d(o,{clipboardMessages:()=>Et,copy:()=>fn,copyDirectLinkToContent:()=>zn,copyFormattedLinkToBlock:()=>Wn,copyHtml:()=>$n,copyLinkToBlock:()=>On,copyLinksToBlocks:()=>Hn,copyString:()=>Xn,copyWithToast:()=>Gn,createSelectedMultiColumnBlockSubtree:()=>an,cutWithMaybeConfirmation:()=>mn,getFormulaEditorInformation:()=>Dn,getInlineTextValueFromClipboardData:()=>Kn,getInlineTitleValueFromClipboardTextHtml:()=>xn,getNotionSelectionClipboardData:()=>nn,htmlToMultiTextSelectionClipboardData:()=>In,insertOrTransformToCodeBlock:()=>Vn,markdownToBlocks:()=>Jn,multiTextSelectionToMarkdown:()=>qn,paste:()=>Nn,pasteFilesForBlocks:()=>gn,pasteMarkdown:()=>hn,serializeMultiTextSelectionToClipboardData:()=>cn,serializePagePropertiesAsText:()=>sn,triggerBrowserCopy:()=>Zn});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(430670),n(803949),n(581454),n(908872),n(737550);var r=n.n(n(842838)),i=()=>n(221844),a=()=>n(908006),s=()=>n(764880),l=()=>n(584262),c=()=>n(700500),d=()=>n(970013),u=()=>n(921940),p=()=>n(304740),m=()=>n(634201),f=()=>n(856197),g=()=>n(683259),b=()=>n(107041),v=()=>n(522419),k=()=>n(80979),y=()=>n(977345),h=()=>n(857639),S=()=>n(236162),I=()=>n(416504),x=()=>n(753514),T=()=>n(206267),C=()=>n(777447),M=()=>n(945778),w=()=>n(997769),_=()=>n(128713),A=()=>n(792071),R=()=>n(134025),D=()=>n(351028),P=()=>n(754199),B=()=>n(388821),F=()=>n(696706),E=()=>n(450648),N=()=>n(861017),V=()=>n(179034),U=()=>n(519831),L=()=>n(343666),O=()=>n(161479),W=()=>n(994310),H=()=>n(919709),z=()=>n(439180),$=()=>n(191772),X=()=>n(173979),j=()=>n(708830),Z=()=>n(445120),G=()=>n(959013),q=()=>n(100622),J=()=>n(496603),K=()=>n(498212),Y=()=>n(183558),Q=()=>n(534177),ee=()=>n(939768),te=()=>n(466614),ne=()=>n(921385),oe=()=>n(450510),re=()=>n(404779),ie=()=>n(413962),ae=()=>n(780054),se=()=>n(518736),le=()=>n(183324),ce=()=>n(59110),de=()=>n(375078),ue=()=>n(267419),pe=()=>n(186445),me=()=>n(951177),fe=()=>n(909470),ge=()=>n(808237),be=()=>n(492414),ve=()=>n(594794),ke=()=>n(611191),ye=()=>n(972435),he=()=>n(231722),Se=()=>n(962845),Ie=()=>n(299545),xe=()=>n(969197),Te=()=>n(53664),Ce=()=>n(906537),Me=()=>n(792002),we=()=>n(847463),_e=()=>n(129522),Ae=()=>n(301421),Re=()=>n(919878),De=()=>n(980914),Pe=()=>n(562800),Be=()=>n(24973),Fe=()=>n(351360),Ee=()=>n(673898),Ne=()=>n(227440),Ve=()=>n(77246),Ue=()=>n(508496),Le=()=>n(53137),Oe=()=>n(732770),We=()=>n(630116),He=()=>n(502438),ze=()=>n(24157),$e=()=>n(611371),Xe=()=>n(559926),je=()=>n(209660),Ze=()=>n(812182),Ge=()=>n(755199),qe=()=>n(680074),Je=()=>n(160475);function Ke(e){var t;const{originalHtmlContentSize:n,environment:o}=e;if(n<500)return;const r=(0,qe().R$)(o),i=null==r||null===(t=r.getSettings())||void 0===t?void 0:t.adoption_entry_points,a=i?i.import_nudge_on_large_paste:void 0;if(a){const e=Ue().default.getConfigKey("adoption_entry_point_time_delta","import_nudge_on_large_paste"),t=a[a.length-1];if(!(Date.now()-t>e.view_delta))return}"nudge_on_large_paste"===Ue().default.getEligibleGroup({experimentId:"adoption_import_entry_point",defaultGroup:"control"})&&((0,Je().t)({environment:o,action:"view",from:"import_nudge_on_paste"}),Ze().Iz({message:ye().A.formatMessage(Ye.triggerNudgeOnPasteDescription),presentationType:"persistent",id:"nudge-on-paste",title:ye().A.formatMessage(Ye.triggerNudgeOnPasteTitle),onUserDismiss:()=>{(0,Je().t)({environment:o,action:"dismiss",from:"import_nudge_on_paste"})},onDismiss:()=>{Ge().pr(o,{entryPoint:"import_nudge_on_large_paste"})},actions:{primary:{title:ye().A.formatMessage(Ye.triggerNudgeOnPastePrimaryAction),onAction:()=>{(0,Je().t)({environment:o,action:"click",from:"import_nudge_on_paste"}),Xe().kY(o,{from:"import_nudge_on_paste"}),Ze().UW("nudge-on-paste"),je().Ow({currentTab:"imports",openedFrom:"import_nudge_on_paste"})}}}}))}const Ye=(0,G().YK)({triggerNudgeOnPasteTitle:{id:"adoption.nudgeOnPaste.title",defaultMessage:"Import content directly"},triggerNudgeOnPasteDescription:{id:"adoption.nudgeOnPaste.description",defaultMessage:"Get all your content into Notion with a click"},triggerNudgeOnPastePrimaryAction:{id:"adoption.nudgeOnPaste.primaryAction",defaultMessage:"Import now"}});var Qe=()=>n(970330),et=()=>n(989423),tt=()=>n(136833);var nt=()=>n(541372),ot=(n(16280),n(672577),()=>n(741237)),rt=()=>n(842989),it=()=>n(220719),at=()=>n(44729),st=()=>n(534402),lt=()=>n(108944),ct=()=>n(20313),dt=()=>n(695625),ut=()=>n(257216),pt=()=>n(319975),mt=()=>n(725614);function ft(e){var t;const{environment:n,clipboardData:o,transaction:r,allowPasteIntoHeaderWithoutChildren:i,selectAll:s,preventLegacyTransclusions:l}=e;if(ze().default.isEditingComment()||(0,Me().X4)())return!1;if(function(e,t){return e.blockSelection.blocks.some((e=>{var n;if(!e.blockSubtree)return!0;const o=null===(n=e.blockSubtree.getModel({id:e.blockId,table:V().ev}))||void 0===n?void 0:n.spaceId;return!!(o&&t&&te().Lw({sourceSpaceId:o,targetSpaceId:t,sourceBlockSubtree:e.blockSubtree}))||void 0}))}(o,null===(t=Fe().default.state.currentSpaceStore)||void 0===t?void 0:t.id))return!1;const d=ze().default.state;if("editing"!==d.mode)return!1;const u=d.multiSelection.start.store;if(!u.isTable(V().ev))return!1;const p=(0,xe().T)(u);if(!p)return!1;if(u!==p.getBlockTitleStore())return!1;const m=p.getType(),f=p.getFormat();if(!m)return!1;if(!((0,c().IU)(m,f)||i&&(0,c().CN)(m)))return!1;if(i&&(0,c().CN)(m)){const e=o.blockSelection.blocks[0],t=null==e?void 0:e.blockId,n=null==e?void 0:e.blockSubtree,r=t&&n?n.getModel({id:t,table:"block"}):void 0;if(Boolean(null==r?void 0:r.getContentLength()))return!1}const g=(0,ct().Ag)({includeNonSelectableListContainer:!0});if(!g)return!1;const b=(0,ct().Xs)(p,[g]);if(!b)return!1;let v=0;for(let a=b.length-1;a>=0;a--){const e=b[a].value.store,t=dt().T.findSelectableFromStore(e),n=e.getModel();if(null!=n&&n.isType(c().U6)||t&&!t.props.canSelect){v=a;break}}const k=b.slice(v);if(0===k.length)return!1;const y=k[0].value.store,h=y.pointer.spaceId,S=y.isInsideTemplate()||y.isInsideFactoryOrDuplicateBlocksAction();r.logDebugMessage("pasteMultiTextSelection: pasting",k,{spaceId:h,pastingIntoTemplate:S,insertionPathRootStore:y});const I=o.blockSelection.blocks.map((e=>{var t;let{blockId:o,blockSubtree:i}=e;if(!i)throw new Error("Missing data for local duplicate block during paste");const a=(null===(t=i.getModel({table:V().ev,id:o}))||void 0===t?void 0:t.getType())===c().xd.factory,s=!(S||a),d=We().Bv.createChildStore(y,{table:V().ev,id:o}),u=le().localDuplicate({environment:n,sourceBlockId:o,targetBlockPointer:(0,ve().zP)({environment:n,table:V().ev,spaceId:h}),sourceBlockSubtree:i,targetInMemoryRecordCache:y.inMemoryRecordCache,transaction:r,options:{addCopyName:(0,Te().A)(d),deepCopyTransclusionContainers:!1,preventLegacyTransclusions:l,resolveTemplateVariables:s}}),m=u.targetBlockStore.getType();return m&&Qe().v(n,{from:"paste",type:m,new_page_id:"page"===m?u.targetBlockStore.id:void 0,creating_block_id:u.targetBlockStore.id,parent_collection_id:p.getParentCollectionIdUpToTwoLevels()}),u})),x=o.multiTextSelection.start.pointerPath,T=o.multiTextSelection.end.pointerPath,C=[],M=[],w=Math.max(x.length,T.length),_=(k[k.length-w]||k[0]).value.store,A=(0,j().v)({node:o.tree,recordStoreParent:_},(e=>{let{node:t,recordStoreParent:n}=e;const o=((e,t)=>{let n;for(const{originalToDuplicate:o}of I)if(n=o.get(t),n)break;if(n)return We().Bv.createChildStore(e,n)})(n,t.value),r=C.length<x.length?x[C.length]:void 0,i=M.length<T.length?T[M.length]:void 0;let a=!1;if((null==r?void 0:r.id)===t.value.id&&(a=!0,C.push(o)),(null==i?void 0:i.id)===t.value.id&&(a=!0,M.push(o)),!a)return{value:{store:o}};const s=(null==o?void 0:o.getContentStore())||y;return{value:{store:o},children:t.children.map((e=>({node:e,recordStoreParent:s})))}}));if(C.length!==x.length||0===C.length)throw new Error(`Failed to hydrate start path during paste (found ${C.length} of ${x.length})`);if(M.length!==T.length||0===M.length)throw new Error(`Failed to hydrate end path during paste (found ${M.length} of ${T.length})`);const R=C[C.length-1],D=M[M.length-1];if(!R||!D)throw new Error(`Failed to hydrate position during paste (${R?"":"missing start"} ${D?"":"missing end"})`);const P=(0,j().Qe)([A],(e=>e.value.store===R)),B=(0,j().Qe)([A],(e=>e.value.store===D)),F=P&&B&&rt().W.fromNearestCommonAncestor(P,B);if(!F)throw new Error(`Failed to build range for paths: ${P?"":"missing start"} ${B?"":"missing end"}`);pt().f0({environment:n,multiSelection:d.multiSelection,transaction:r});const E=ze().default.state,N="editing"===E.mode?E.multiSelection:d.multiSelection;if((0,Ie().P4)(p)&&0===o.multiTextSelection.start.textIndex){const e=R.getType();e&&(0,c().aO)(e)&&de().transformBlocks({environment:n,blocks:[p],blockType:e,transaction:r})}let U;return y.useCrdt()?(bt({transaction:r,clipboardData:o,startBlockStore:p,duplicateStartStore:R,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:y}),U=gt({environment:n,transaction:r,clipboardData:o,insertionPoint:N,textSelectionState:d,duplicateEndStore:D,pastingIntoTemplate:S}).newSelectionIndex):(U=gt({environment:n,transaction:r,clipboardData:o,insertionPoint:N,textSelectionState:d,duplicateEndStore:D,pastingIntoTemplate:S}).newSelectionIndex,bt({transaction:r,clipboardData:o,startBlockStore:p,duplicateStartStore:R,range:F,insertionPath:k,duplicates:I,insertionPathRootStore:y})),a().default.afterNextFlush((()=>{const e=(0,ct().PY)({rootStore:y,root:g,target:F.end}),t=e&&(0,xe().aI)(e[e.length-1]);if(!t)return;const n={start:{index:s?N.start.index:U,store:s?N.start.store:t},end:{index:U,store:t}};mt().setMultiSelection({multiSelection:n})})),!0}function gt(e){const{insertionPoint:t,duplicateEndStore:n,pastingIntoTemplate:o,environment:r,transaction:i,clipboardData:a}=e;let s=0;const l=t.end.store,c=t.end.index,d=(0,xe().aI)(n);if(d){s=H().qAZ(d.getValue()).length;const e=(0,it().o9)((0,xe().T)(l)),t=(0,it().o9)((0,xe().T)(d));se().Le({store:l,blockStore:e})&&se().Le({store:d,blockStore:t})?(st().X0({sourceBlockStore:e,targetBlockStore:t,splitAtGraphemeIndex:c,transaction:i,moveIntoNewBlock:!1}),i.logDebugMessage("(CRDT) pasted suffix into end",d)):(pt().jN({environment:r,sourceStore:l,sourceIndex:c,targetStore:d,targetIndex:s,transaction:i}),i.logDebugMessage("pasted suffix into end",d))}else pt().jQ({environment:r,transaction:i,store:l,selection:{startIndex:c,endIndex:1/0}}),i.logDebugMessage("no end title store to paste text into");let u=H().Uee(a.multiTextSelection.start.copiedText,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0});return o||(u=(0,X().f$)(u,{currentUserId:r.currentUser.id,currentTimeZone:(0,I().P)()})),pt().yr({environment:r,index:t.start.index,store:t.start.store,tokens:u,transaction:i}),{newSelectionIndex:s}}function bt(e){const{transaction:t,clipboardData:n,startBlockStore:o,duplicateStartStore:r,insertionPath:i,insertionPathRootStore:a,duplicates:s,range:l}=e,c=Ue().default.checkGate({gateName:"prefer_high_level_operations"});for(const p of l.iterateInsertionAt(i))(0,ct().eM)({transaction:t,treeOperation:p,deleteFrom:"tree-parent",preferHighLevelOperations:c}),ot().O.applyMutable(p);if(n.blockSelection.wasContiguousSelection&&n.blockSelection.blocks.length>0&&!o.hasContent())for(const p of r.getContentStores())at().NI({parentStore:o.getContentStore(),childStore:p,transaction:t});const d=new Set;for(const{originalToDuplicate:p}of s){const e=p.getByTable(V().ev);for(const{value:n}of e){var u;if(!n||d.has(n.id))continue;d.add(n.id);const e=We().Bv.createChildStore(r,n),o=(0,lt().g7)(e),i="transclusion_reference"===a.getType()?null===(u=a.getTransclusionReferenceTargetStore())||void 0===u?void 0:u.id:a.id;o.find((e=>e.id===i))||(t.logDebugMessage("disposing of unwanted duplicated block",e,e.id===r.id),ut().bn({childStore:e,parentStore:a,alive:!1,transaction:t}))}}}var vt=()=>n(899038),kt=()=>n(901389),yt=()=>n(705540),ht=()=>n(675074),St=()=>n(131581),It=()=>n(813743),xt=()=>n(722101),Tt=()=>n(246826),Ct=()=>n(797265),Mt=()=>n(778417),wt=()=>n(436572),_t=()=>n(4319),At=()=>n(538527),Rt=()=>n(751156),Dt=()=>n(633457);const Pt=!1;function Bt(){if(Pt){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("clipboardActions:",...t)}}const Ft=(0,G().YK)({offlineError:{id:"clipboardActions.offlineError.message",defaultMessage:"Please go online to copy this block."},untitled:{defaultMessage:"Untitled",id:"clipboardActions.untitledMessage"}}),Et=(0,G().YK)({copiedQnAMessageToClipboard:{id:"action.copiedQnAMessageToClipboard",defaultMessage:"Copied response to clipboard"},copiedHumanMessageToClipboard:{id:"action.copiedHumanMessageToClipboard",defaultMessage:"Copied your message to clipboard"},copiedEmailToClipboard:{id:"action.copiedEmailToClipboard.snackBarMessage",defaultMessage:"Copied email to clipboard"},copiedUserIdToClipboard:{id:"action.copiedUserIdToClipboard.snackBarMessage",defaultMessage:"Copied user ID to clipboard"},copiedLinkToClipboard:{id:"action.copiedLinkToClipboard.snackBarMessage",defaultMessage:"Copied link to clipboard"},copiedPageLinkToClipboard:{id:"action.copiedPageLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedFormLinkToClipboard:{id:"action.copiedFormLinkToClipboard.snackBarMessage",defaultMessage:"Copied form link to clipboard"},copiedTeamHomeLinkToClipboard:{id:"action.copiedTeamHomeLinkToClipboard.snackBarMessage",defaultMessage:"Copied page link to clipboard"},copiedBlockLinkToClipboard:{id:"action.copiedBlockLinkToClipboard.snackBarMessage",defaultMessage:"Copied block link to clipboard"},copiedLinksToClipboard:{id:"action.copiedLinksToClipboard.snackBarMessage",defaultMessage:"Copied links to clipboard"},copiedPropertyToClipboard:{id:"action.copiedPropertyToClipboard.snackBarMessage",defaultMessage:"Copied property to clipboard"},copiedCodeToClipboard:{id:"action.copiedCodeToClipboard.snackBarMessage",defaultMessage:"Copied code to clipboard"},copiedTokenToClipboard:{id:"action.copiedTokenToClipboard.snackBarMessage",defaultMessage:"Copied token to clipboard"},copiedToClipboard:{id:"action.copiedToClipboard.snackBarMessage",defaultMessage:"Copied to clipboard"},copiedApiObjectToClipboard:{id:"action.copiedApiObjectToClipboard.snackBarMessage",defaultMessage:"Copied API object to clipboard"},copiedImageToClipboard:{id:"action.copiedImageToClipboard.snackBarMessage",defaultMessage:"Copied image to clipboard"},copyImageError:{id:"action.copyImageError.snackBarMessage",defaultMessage:"Failed to copy image to clipboard"},copiedPageToClipboard:{id:"action.copiedPageToClipboard.snackBarMessage",defaultMessage:"Copied page to clipboard"}}),Nt={...n(335098).q,dockerfile:"Docker",javascriptreact:"JavaScript",jsonc:"JSON","objective-c":"Objective-C",proto:"Protobuf",shellscript:"Shell",typescriptreact:"TypeScript",vb:"Visual Basic"},Vt="text/_notion-blocks-v3-production",Ut="text/_notion-text-production",Lt="text/_notion-multi-text-production",Ot="text/_notion-page-source-production",Wt="vscode-editor-data",Ht=[Vt,Ut,Lt,Ot],zt=new Set(Ht);const $t={fromJson:e=>e,toJson:e=>e},Xt=$t,jt=$t,Zt=$t,Gt={fromJson(e){const t=(0,j().v)(e.tree,(e=>e)),n=qt.fromJson(e.blockSelection);return{...e,tree:t,blockSelection:n}},toJson(e){const t=qt.toJson(e.blockSelection);return{...e,blockSelection:t}}},qt={fromJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?B().RecordMap.create(e.blockSubtree):void 0})))}),toJson:e=>({...e,blocks:e.blocks.map((e=>({...e,blockSubtree:e.blockSubtree?e.blockSubtree.toJson():void 0})))})},Jt="VirtualClipboard:production";let Kt;function Yt(e){return e.isAndroid}function Qt(e,t){if(!Yt(t))return e;const n=(0,me().n8)(e.getData("text/html"));if(n){Kt||(Kt=W().A.get(Jt));const t=Kt;if(n===(null==t?void 0:t.id)){const n=e.types.concat(Object.keys(t.mimeTypes));return{getData(n){const o=e.getData(n);return!o&&function(e){return zt.has(e)}(n)?t.mimeTypes[n]||"":o},types:[...new Set(n)].filter((n=>{const o=t.mimeTypes[n];return""!==e.getData(n)||o&&""!==o})),items:e.items}}}return e}function en(e,t,n,o){if(!e.clipboardData)return;const r=n.toJson(o),i=JSON.stringify(r);e.clipboardData.setData(t,i)}function tn(e,t,n){try{const o=e.getData(t),r=JSON.parse(o);return n.fromJson(r)}catch(o){return}}function nn(e){const{clipboardData:t}=e,{text:n,html:o,isFromMicrosoftOffice:r,isHtmlTable:i}=function(e){const{clipboardData:t,tinyMceMicrosoftWordPasteFilter:n}=e,o=t.getData("text/uri-list"),r=t.getData("text/plain").replace(En,"\n")||o,i=t.getData("text/html"),a=_n(i),{isHtmlTable:s,htmlContainsRichFormatting:l}=function(e){var t;const n=document.createElement("div");n.innerHTML=An(e);const o=Boolean("table"===(null===(t=n.firstElementChild)||void 0===t?void 0:t.nodeName.toLowerCase()));return{htmlContainsRichFormatting:x().HZ({node:n,window,emojiData:ue().A.state}),isHtmlTable:o}}({html:i,tinyMceMicrosoftWordPasteFilter:n});if(!l&&!function(e,t){return Fn.test(e)&&Fn.test(t)}(i,r))return{text:r,isFromMicrosoftOffice:a,isHtmlTable:s};return{text:r,html:i,isFromMicrosoftOffice:a,isHtmlTable:s}}(e);return{text:n,html:o,multiTextSelectionData:tn(t,Lt,Gt),textSelectionData:tn(t,Ut,Xt),blockSelectionData:tn(t,Vt,qt),isFromMicrosoftOffice:r,isHtmlTable:i}}function on(e){const{blocks:t,action:n,environment:o}=e;if(0===t.length)return{action:n,blocks:[],wasContiguousSelection:!1};const r=t[0],i=r.inMemoryRecordCache,a=J().sb(J().oE(t.map((e=>e.id)))),s=r.getParentBlockStore(),l=s?s.getRenderableContentIds():[],c=l.indexOf(r.id),d=Boolean(s&&t.every(((e,t)=>l.indexOf(e.id)===c+t)));if(i.isTemplatePreview){return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ce().loadLocalSubtree)(o,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap}))),action:n,wasContiguousSelection:d}}if(i.snapshotData){!function(e,t){et().vd(e,"history_copy",{ageMs:(0,tt().S)(t)})}(o,i.snapshotData);return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ce().loadLocalSubtree)(o,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!0,requireFullSubtree:!0,skipNavigableChildren:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap}))),action:n,wasContiguousSelection:d,wasSelectionFromSnapshot:!0}}{const e=(0,me().x4)(t),r=e&&an({environment:o,inMemoryRecordCache:i,multiColumnPasteInfo:e});if(e&&r){let t=!1;const s=[];for(const n of a)e.blockIds.has(n)?t||(s.push({blockId:e.columnListId,blockSubtree:r}),t=!0):s.push({blockId:n,blockSubtree:(0,ce().loadLocalSubtree)(o,{blockId:n,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap});return{blocks:s,action:n,wasContiguousSelection:d}}return{blocks:a.map((e=>({blockId:e,blockSubtree:(0,ce().loadLocalSubtree)(o,{blockId:e,inMemoryRecordCache:i,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap}))),action:n,wasContiguousSelection:d}}}function rn(e){const{markdown:t,markdownOptions:n,markdownLinkifyIt:o}=e;if(o)return _().uY({...o,markdown:t,plugin:null==n?void 0:n.plugin})}function an(e){var t;const{environment:n,multiColumnPasteInfo:o,inMemoryRecordCache:r}=e,{columnListId:i,columnIds:a,spaceId:s}=o,l=B().RecordMap.create(),c=null===(t=r.getEntry({pointer:{table:V().ev,id:i,spaceId:s},userId:n.currentUser.id}))||void 0===t?void 0:t.value.value;if("column_list"!==(null==c?void 0:c.type))return;const d={...c,content:(c.content||[]).filter((e=>a.has(e)))};l.setValue({table:V().ev,id:i,spaceId:s},d);for(const m of a){var u;const e=null===(u=r.getEntry({pointer:{table:V().ev,id:m,spaceId:s},userId:n.currentUser.id}))||void 0===u?void 0:u.value.value;if("column"!==(null==e?void 0:e.type))return;const t={...e,content:(e.content||[]).filter((e=>o.blockIds.has(e)))};l.setValue({table:V().ev,id:m,spaceId:s},t)}const p=[l];for(const m of o.blockIds){const e=(0,ce().loadLocalSubtree)(n,{blockId:m,inMemoryRecordCache:r,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap;if(!e)return;p.push(e)}return B().RecordMap.merge(p)}function sn(e){const{rootBlock:t,getRecordValue:n}=e,o=n(t);if(!o)return;const r=(0,S().zN)({block:o,getRecordValue:n});if(!r)return;const i=(0,me().M9)({rootBlock:t,getRecordValue:n,formulasModule:k()}),a=(0,d().Dp)(r),s=Object.keys(a),l=J().Ul(s,(e=>{const t=a[e];return t&&t.name||""}));let c="";for(const d of l){const e=a[d];if(e&&"title"!==d){const t=(0,g().sL)({property:d,schema:a,block:o,exportArgs:i,renderers:f().z});t&&(c+=`${e.name}: ${t}\n`)}}return c||void 0}function ln(e){const{treePath:t,textPosition:n,endpoint:o}=e,{store:r,index:i}=n,a=t.map((e=>e.value.store.pointer)),s=se().SL(n.store)?["properties","title"]:n.store.path,l=H().AI5(r.getValue(),i,i);return{copiedText:"end"===o?l.tokensBeforeRange:l.tokensAfterRange,textIndex:i,attributePath:s,pointerPath:a}}function cn(e){var t;const{multiSelection:n,action:o,environment:r}=e;(0,he().KP)(n)&&console.warn("Warning, serializeMultiTextSelectionToClipboardData() was called with a single-store text selection! This function should only be  called with a multi-selection that spans multiple blocks.");const i=null===(t=(0,Se().ZS)({filterCommonAncestors:!0,multiSelection:n,focus:void 0}))||void 0===t?void 0:t.stores;if(!i)return;const a=n.start.store.inMemoryRecordCache,s=on({action:o,blocks:i,environment:r});if(0===s.blocks.length)return;const l=(0,Se().Tp)({multiSelection:n,includeNonSelectable:!1});if(!l)return;const{treeRange:c}=l,d=[],u=new Map,p=(e,t)=>{t.forEach((e=>p(e,[])));const n=u.get(e),o=n&&n.length>t.length?n:t;u.set(e,o)},m=Ue().default.checkGate({gateName:"prefer_high_level_operations"});for(const{start:y,end:h}of c.iterateAnalogousNodes()){if(y){const e=y.childrenBeforeRange.slice(-1).concat(y.childrenInsideRange);p(y.parent,e)}if(h)if(p(h.parent,h.childrenInsideRange),m)for(const e of h.childrenAfterRange)d.push({command:"removeChild",path:["content"],pointer:h.parent.value.store.pointer,args:{id:e.value.store.id}});else d.push(R().op.set({pointer:h.parent.value.store.pointer,path:["content"],args:h.childrenInsideRange.map((e=>e.value.store.id))}))}const f=ln({textPosition:n.start,endpoint:"start",treePath:c.startPath}),g=ln({textPosition:n.end,endpoint:"end",treePath:c.endPath});d.push(...(0,me().Qr)(f),...(0,me().Qr)(g));for(const y of[null===(b=s.blocks[0])||void 0===b?void 0:b.blockSubtree,null===(v=s.blocks[s.blocks.length-1])||void 0===v?void 0:v.blockSubtree]){var b,v;y&&((0,D().applyOperationsToRecordMap)({recordMap:y,operations:d,updateOnly:!0}),m&&dn(r,a,y))}const k=(0,j().v)(c.commonAncestor,(e=>{const t=u.get(e);if(t)return{value:e.value.store.pointer,children:t}}));if(k)return{blockSelection:s,tree:k,multiTextSelection:{start:f,end:g},action:o};Bt("unexpected: trimming tree produced undefined")}function dn(e,t,n){const o=[];for(const{model:r}of n)if(r instanceof A().zgg&&!r.alive){o.push(r.pointer);const n=(0,ce().loadLocalSubtree)(e,{blockId:r.pointer.id,inMemoryRecordCache:t,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap;if(n)for(const{pointer:e}of n)o.push(e)}for(const r of o)n.delete(r)}function un(e){const{environment:t,event:n}=e,o=T().JW();!function(e){const{environment:t,event:n,markdownLinkifyIt:o}=e;if(!n.clipboardData)return;const r=He().default.state.stores,i=ze().default.isEditingComment(),a=Be().A.state.open,s=De().wg(),l="empty"!==ze().default.state.mode&&ze().default.state.multiSelection,d=t.currentUser.id,u="copy"===n.type?"copy":"cut",p=pe().ZO();p&&(0,F().Yt)(p.pointer,V().ev)&&en(n,Ot,jt,p.pointer);const m=l&&(0,he().H7)(l);if(m&&m.selection.startIndex!==m.selection.endIndex){const e=ye().A.getIntl(),{store:o,selection:r}=m,i=o.inMemoryRecordCache,a=o.getValue();if(Bt("copy: copying single-store text selection"),n.preventDefault(),a&&!Dn()){const e=o.table===V().ev?(0,xe().T)(o):void 0,t=e&&J().n4(o.path,e.getBlockTitleStore().path)?e.getType():void 0,i=t&&(0,c().aO)(t)?t:void 0,s=a.filter((e=>!H().Br(e)));en(n,Ut,Xt,{blockType:i,editing:s,selection:r,action:u})}const s=H().Ffo(a,r.startIndex,r.endIndex),l=A().b4_.fromGetRecordValueFn(i.makeGetRecordValueFn(d)),p=i.makeGetRecordRoleFn(d),f=(0,E().r4)({intl:e,textValue:s,getRecordModel:l,userTimeZone:(0,I().P)(),externalIntegrations:Le().A.integrations.state});n.clipboardData.setData("text/plain",(0,me().Df)(t.device.isWindows,f));const g=$().$e({textValue:s&&{value:s,spaceId:(0,O().e)(o.pointer.spaceId)},getRecordModel:l,getRecordRole:p,userTimeZone:(0,I().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,q().x0)(),intl:e,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:be().QN,externalIntegrations:Le().A.integrations.state,formulaValueTypes:[],emojiData:ue().A.state,isMobileNative:!1});return void n.clipboardData.setData("text/html",(0,me().Df)(t.device.isWindows,g))}if(l&&!(0,he().kM)(l)&&!i&&l.start.store.table===V().ev&&l.end.store.table===V().ev){const e=cn({environment:t,multiSelection:l,action:u});if(e){Bt("copy: copying multi-text selection"),n.preventDefault(),en(n,Lt,Gt,e);const r=l.start.store.inMemoryRecordCache,i=l.start.store.getRecordStoreUIRoot().getValue();if(!i)return;const{markdown:a,html:s}=(0,me().Ij)({clipboardData:e,rootBlock:{id:i.id,table:V().ev,spaceId:i.space_id},isWindows:t.device.isWindows,fallbackGetRecordValue:r.makeGetRecordValueFn(d),markdownLinkifyIt:o,markdownSerializationOptions:{transformBlockMapping:{image:Ue().default.checkGate({gateName:"docs_clipboard_imagedata"})?pn:void 0}},formulasModule:k()});return a&&n.clipboardData.setData("text/plain",a),void(s&&n.clipboardData.setData("text/html",s))}}if(l&&!(0,he().kM)(l)&&!i&&l.start.store.table===L().SN&&l.end.store.table===L().SN){Bt("copy: copying comment multi-text selection"),n.preventDefault();const e=(0,Se().$W)(l),o=ye().A.getIntl(),r=e.map((e=>{let{store:n,selection:r}=e;if(r.startIndex===r.endIndex)return;const i=n.inMemoryRecordCache,a=A().b4_.fromGetRecordValueFn(i.makeGetRecordValueFn(d)),s=i.makeGetRecordRoleFn(d),l=H().Ffo(n.getValue(),r.startIndex,r.endIndex);return{plainText:(0,E().r4)({intl:o,textValue:l,getRecordModel:a,userTimeZone:(0,I().P)(),externalIntegrations:Le().A.integrations.state}),htmlContent:$().$e({textValue:l&&{value:l,spaceId:(0,O().e)(n.pointer.spaceId)},getRecordModel:a,getRecordRole:s,userTimeZone:(0,I().P)(),isAndroid:!1,isSafariOrIOS:!1,isWindows:!1,disableLinks:!1,disabled:!0,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,showEmojiInline:!0,emojiType:"raw",theme:(0,q().x0)(),intl:o,katex:void 0,isClient:void 0,currentUserId:void 0,getPublicBaseUrlForPage:Pe().SN(t),externalIntegrations:Le().A.integrations.state,formulaValueTypes:[],emojiData:ue().A.state,isMobileNative:!1}),textValue:l}})).filter(Q().O9),i=r.map((e=>e.plainText)).join("\n\n"),a=`<div>${r.map((e=>e.htmlContent)).join("</div><div>")}</div>`;return n.clipboardData.setData("text/plain",(0,me().Df)(t.device.isWindows,i)),void n.clipboardData.setData("text/html",(0,me().Df)(t.device.isWindows,a))}if(r.length>0&&!i&&!s&&!a){Bt("copy: copying block selection"),n.preventDefault();const e=r[0],i=e.inMemoryRecordCache,a=on({blocks:r,environment:t,action:u});if(en(n,Vt,qt,a),!e.isDefined())return;const s=J().oE(r.map((e=>e.computeWithRecordValues((t=>{let{getRecordValueAndSubscribe:n}=t;return n(e)}))))),l=i.makeGetRecordValueFn(d),{markdown:c,html:p}=(0,me().ZI)({rootBlock:{id:e.id,table:V().ev,spaceId:e.getSpaceId()},blockValues:s,getRecordValue:l,isWindows:t.device.isWindows,markdownLinkifyIt:o,formulasModule:k()});return c&&n.clipboardData.setData("text/plain",c),void(p&&n.clipboardData.setData("text/html",p))}Bt("copy: doing nothing")}(e),(0,me().dk)(n,o),function(e){let{event:t,device:n,customEventId:o}=e;if(!t.clipboardData||!Yt(n))return;const r={};for(const s of Ht)r[s]=t.clipboardData.getData(s);const i=t.clipboardData.getData("text/html");t.clipboardData.setData("text/html",`${i}${(0,me().uE)(o)}`),Kt={id:o,mimeTypes:r};try{W().A.set(Jt,Kt)}catch(a){h().log({level:"error",from:"clipboardActions",type:"setVirtualClipboardData",error:{message:"Unable to persistently store virtual clipboard data."}})}}({event:n,device:t.device,customEventId:o})}function pn(e){const{block:t,exportArgs:n}=e,{getExportedRenderAsset:o}=n,{source:r}=A().Bj6.fromBlock(t).getProperties(),i=H().q4_(r),a=function(e){if(!e.file_ids)return;const t=_e().K.findBlockFromId(e.id);if(!t)return;const n=t.getNode();if(!(n instanceof Element))return;const o=n.querySelector("img");if(!o)return;const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const i=r.getContext("2d");if(!i)return;return i.drawImage(o,0,0,o.width,o.height),r.toDataURL()}(t)??o({fromBlockId:n.blockId,toFileURI:i}),s=_().qh(e)||_().Qw({block:t,exportArgs:n})||a;return{text:(0,p().rS)({url:i})?`![${s}](${a})`:`[${s}](${a})`,breakLines:!0,children:_().q5(e)}}async function mn(e){const{event:t,environment:n,markdownLinkifyIt:o}=e;mt().syncTextSelection();const r=He().default.state.stores,i=ze().default.isEditingComment(),a=pe().fI(),s="editing"===ze().default.state.mode&&ze().default.state.multiSelection,{phase:l}=He().default.state;if(fn({environment:n,event:t,disableSyncTextSelection:!0,markdownLinkifyIt:o}),s&&!(0,he().kM)(s)){const e=s.start.store.getAncestorBlockStoreAtRootPath(),t=e?Ve().Uv.getMode(e):"default";Rt().createAndCommit({userAction:"clipboardActions.cutWithMaybeConfirmation",environment:n,canUndo:!0,perform:o=>{if("suggest"===t){const t=ie().RR(n,o,e);ie().rY({environment:n,multiSelection:s,transaction:o,discussionStore:t})}else pt().f0({environment:n,multiSelection:s,transaction:o})}})}else(l===He().SelectionPhase.Selected||s)&&r.length>0&&!i&&!a&&await Ct().Af({environment:n,blocks:r,shouldCheckSuggestEdit:!0});Oe().A.setKeyboardMode(!0)}function fn(e){const{environment:t,event:n,disableSyncTextSelection:o,markdownLinkifyIt:r}=e;o||mt().syncTextSelection(),un({environment:t,event:n,markdownLinkifyIt:r}),Oe().A.setKeyboardMode(!0)}function gn(e){var t;const{environment:n,files:o,transaction:r,insertBelowBlockStore:i}=e,a=He().default.getCurrentRecordCache(),s=pe().y0(n);if(!a)return;const l=He().default.state.stores,c=ht().$C({environment:n,files:o,inMemoryRecordCache:a,transaction:r,pageWidth:s,spaceId:0!==l.length?l[0].pointer.spaceId:null===(t=pe().ZO())||void 0===t?void 0:t.pointer.spaceId});c.forEach((e=>{const t=e.getType();t&&Qe().v(n,{from:"paste",type:t,creating_block_id:e.id})})),kn({environment:n,blocks:c,transaction:r,replaceEmptyTextBlock:!0,insertBelowBlockStore:i})}function bn(e){const{environment:t,store:n,tokens:o,index:r,transaction:i,multiTextSelection:s,disableEmbedMenu:l,selectAll:c}=e,d=(0,he().H7)(s),u=d?{value:d.store.getValue()}:void 0,p=n.getAncestorBlockStoreAtRootPath(),f=p?Ve().Uv.getMode(p):"default";let g=o;(ze().default.isEditingComment()||ze().default.isEditingCaption())&&(g=function(e){const{environment:t,tokens:n}=e,o=vn(n);if(o&&o.url===o.text){const e=(0,N().parseRoute)({url:o.url,baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,isMobile:t.device.isMobile,protocol:ae().A.protocol,currentUrl:window.location.href});if("page"===e.name&&e.blockId){const t=H().ld4(e.scrollToBlockId??e.blockId,void 0);return[H().wmz(t),H().Ey_(" ")]}}return n}({environment:t,tokens:o})),pt().yr({environment:t,store:n,tokens:g,index:r,transaction:i,selectAll:c,editorMode:f});const b=vn(g);!l&&u&&b&&"suggest"!==f&&function(e){const{environment:t,hyperlink:n,oldTextValue:o}=e,r="editing"===ze().default.state.mode&&(0,he().H7)(ze().default.state.multiSelection),i=He().default.state;if(r&&i.stores.length>0){const e=r.store.getValue(),i=H().q4_(e),s=m().PE(i.substring(0,i.indexOf(n.text))).length,l=s+m().PE(n.text).length;if(r.store.isTable(V().ev)||r.store.isTable(L().SN)){if(Dt().p6({environment:t,blockStore:He().default.state.stores[0],textStore:r.store,textValueBeforePaste:o,url:n.url,urlSelection:{startIndex:s,endIndex:l}}))return;if(It().Yf({environment:t,textStore:r.store,blockStore:He().default.state.stores[0],oldTextValue:o,url:n.url,urlSelection:{startIndex:s,endIndex:l}}))return}a().default.afterNextFlush((()=>{const e=n.url;St().p6({environment:t,textStore:r.store,oldTextValue:o,url:e,urlSelection:{startIndex:s,endIndex:l}})}))}}({environment:t,hyperlink:b,oldTextValue:u.value,transaction:i})}function vn(e){if(1!==e.length)return;const t=e[0];if(!H().BEe(t))return;const[n,o]=t;if(1!==o.length)return;const r=o[0];if(!H().sh$(r))return;return{text:n,url:H().cQR(r)}}function kn(e){const{environment:t,blocks:n,transaction:o,replaceEmptyTextBlock:r,insertBelowBlockStore:i}=e,a=He().default.state.stores;if(1===a.length){const e=a[0];if(e.getType()&&e.isType(c().KK)&&function(e){if("editing"!==ze().default.state.mode||!ze().default.state.multiSelection)return!1;const t=(0,he().H7)(ze().default.state.multiSelection);if(!t)return!1;return t.store===e.getTitleStore()}(e)){const r=e.getContentStore(),i=J().o8(n).reverse().map((e=>xt().Hs({parentStore:r,prependStore:e,transaction:o}).childStore));return Mt().td({environment:t,stores:i}),i}}return Ct().LE({environment:t,blocksToInsert:n,target:i?[i]:a,transaction:o,replaceEmptyTextBlock:r})}function yn(e,t,n,o){const r=(0,pe().ZO)();if(!r)return;const i=He().default.state.stores,s=0!==i.length?i[0].pointer.spaceId:r.pointer.spaceId,l="suggest"===Ve().Uv.getMode(r,!0);let d=function(e,t){if("cut"!==t.action||!Ue().default.checkGate({gateName:"convert_cut_paste_to_move"}))return;const n="suggest"===Ve().Uv.getMode(e,!0),o=[];for(const r of t.blocks){const t=We().Bv.createChildStore(e,{table:V().ev,id:r.blockId});if(!t.isReady())return;const i=t.getModel();if(!i)return;if(i.getSpaceId()!==e.getSpaceId())return;if(!1!==i.alive)return;n&&!c().ei[i.getType()]||o.push(t)}return o}(r,t);if(!d){const n=JSON.stringify(t).length>we().vs;d=t.blocks.reduce(((i,a)=>{var d,u,p,m,f,g;let{blockId:b,blockSubtree:v}=a;const k=We().Bv.createChildStore(r,{table:V().ev,id:b});let y;if(k.isDefined())y=k.getModel();else{const e=null==v?void 0:v.getValue({table:V().ev,id:b});y=e&&A().Bj6.fromBlock(e)}if(l&&y&&!c().ei[y.getType()])return i;if(null!==(d=y)&&void 0!==d&&d.isCollectionView()&&(null===(u=y)||void 0===u||!u.getCollectionPointer())&&(null===(p=y)||void 0===p?void 0:p.getSpaceId())!==s&&Ue().default.checkGate({gateName:"collections_xws"})){const t=Tt().Wv({environment:e,type:c().xd.text,inMemoryRecordCache:k.inMemoryRecordCache,transaction:o,spaceId:s});return pt().yr({environment:e,store:t.getBlockTitleStore(),tokens:[H().wmz(H().ld4(b,y.getSpaceId()))],index:0,transaction:o}),i.push(t),i}const S=!(r.isInsideTemplate()||Pn()||r.isInsideFactoryOrDuplicateBlocksAction()||null!==(m=y)&&void 0!==m&&m.isTemplateVariableContainerBlock()),I=v&&s&&(null===(f=y)||void 0===f?void 0:f.getSpaceId())&&te().Lw({sourceSpaceId:y.getSpaceId(),targetSpaceId:s,sourceBlockSubtree:v});if(v&&!n&&!I){const n=le().localDuplicate({environment:e,sourceBlockId:b,targetBlockPointer:(0,ve().zP)({environment:e,table:V().ev,spaceId:s}),sourceBlockSubtree:v,targetInMemoryRecordCache:k.inMemoryRecordCache,options:{addCopyName:(0,Te().A)(k),deepCopyTransclusionContainers:!1,resolveTemplateVariables:S,preventLegacyTransclusions:(0,ke().$J)()},transaction:o,shallowCopyNavigableBlock:!!t.wasSelectionFromSnapshot&&Ue().default.checkGate({gateName:"duplicate_snapshot_navigable_blocks_by_reference"})}).targetBlockStore,r=n.getType();return r&&Qe().v(e,{from:"paste",type:r,new_page_id:"page"===r?n.id:void 0,creating_block_id:n.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()}),i.push(n),i}if(t.wasSelectionFromSnapshot)return h().log({level:"warning",from:"clipboardActions",type:"pasteBlockSelection",data:{message:"Unable to locally duplicate pasted block selection from snapshot",miscDataToConvertToString:{blockId:b,blockType:k.getType(),blockSelectionTooBig:n,missingBlockSubtree:!v}}}),i;Ne().A.state.online||kt().f1(ye().A.formatMessage(Ft.offlineError));const{blockStores:x,onComplete:T}=le().serverDuplicate({environment:e,sourceBlocks:[{id:b,spaceId:(0,O().e)(null===(g=y)||void 0===g?void 0:g.getSpaceId())}],targetInMemoryRecordCache:k.inMemoryRecordCache,transaction:o,options:{addCopyName:(0,Te().A)(k),deepCopyTransclusionContainers:!1,resolveTemplateVariables:S,convertExternalObjectInstancesToPlaceholders:!1},targetSpaceId:(0,O().e)(s),userActionSuffix:v&&n?" (forceServerSideCopy)":void 0}),C=x[0],M=C.getType();return T.then((n=>{if("error"===n.status){const o=n.error;te().Rk(o)?t.blocks.length>1?te().UK(e,{product:o.clientData.metadata.product}):te().yj({product:o.clientData.metadata.product}):kt().f1(n.errorMessage)}else M&&Qe().v(e,{from:"paste",type:M,new_page_id:"page"===M?C.id:void 0,creating_block_id:C.id,parent_collection_id:k.getParentCollectionIdUpToTwoLevels()})})),i.push(C),i}),[])}if(l){const t=ie().RR(e,o,d[0]),n=[];d.forEach((e=>{const r={type:"insert",id:T().JW(),discussionId:t.id};ie().tM(o,e,r),n.push(e.id)})),o.preEnqueueActions.push((()=>{ie().c3({environment:e,transaction:o,discussionStore:t,addModifiedBlockIdsAfter:n})})),At().Ug({environment:e,blocks:d,annotation:[H().Ifu.SuggestionInsertText,t.id],transaction:o})}kn({environment:e,blocks:d,transaction:o,replaceEmptyTextBlock:!0});const u=He().default.state.stores,p=u.length>0?u:[r],m=t.blocks.map((e=>{const t=p.length>0?p[0]:function(e){return e.isCollectionView()?e.getCollectionStore()||e:e.getContentStore()}(r);return We().Bv.createChildStore(t,{table:V().ev,id:e.blockId})}));a().default.afterNextFlush((async()=>{await Promise.all(p.map((e=>e.waitUntil((()=>{const t=e.getType();return Boolean(t&&t!==c().xd.copyIndicator)}))))),await Promise.all(m.map((e=>e.load()))),n&&nt().ei({environment:e,blocks:p,pageSource:n,copiedStores:m,action:t.action,wasContiguousSelection:t.wasContiguousSelection,rootStore:r})&&nt().gi({environment:e,copiedStores:m,blocks:p,pageSource:n})}))}function hn(e){const{environment:t,disableEmbedMenu:n,transaction:o,overwrite:r,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,text:l,tinyMceMicrosoftWordPasteFilter:c}=e,d=l.includes("\n"),u=ze().default.state,p=Rn(u);d&&"inline"!==p||"editing"!==u.mode?r?(o.logDebugMessage("paste: pasting as markdown overwrite"),function(e){const{environment:t,text:n,transaction:o,selectAll:r,markdownOptions:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s}=e,l=rn({markdown:n,markdownOptions:i,markdownLinkifyIt:a});if(!l)return;let c=In({environment:t,html:l,wrapInEmptyBlocks:!1,tinyMceMicrosoftWordPasteFilter:s});c||(c=In({environment:t,html:l,wrapInEmptyBlocks:!0,tinyMceMicrosoftWordPasteFilter:s}));if(!c)return;ft({environment:t,clipboardData:c,transaction:o,allowPasteIntoHeaderWithoutChildren:!0,selectAll:r,preventLegacyTransclusions:(0,ke().$J)()})}({environment:t,text:l,transaction:o,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):l&&(o.logDebugMessage("paste: pasting as markdown append"),function(e){const{environment:t,text:n,transaction:o,markdownOptions:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=rn({markdown:n,markdownOptions:r,markdownLinkifyIt:i});if(s)Cn({environment:t,html:s,transaction:o,tinyMceMicrosoftWordPasteFilter:a})}({environment:t,text:l,transaction:o,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c})):(o.logDebugMessage("paste: pasting as inline markdown"),function(e){const{environment:t,text:n,disableEmbedMenu:o,transaction:r,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l}=e,c="editing"===ze().default.state.mode&&ze().default.state.multiSelection;if(c){const e=(0,he().H7)(c);if(e&&function(e){const t=ze().default.state;return"editing"===t.mode&&!(0,he().kM)(t.multiSelection)&&(0,he().KP)(t.multiSelection)&&w().t(e,"url")}(n))Bn({environment:t,text:n,transaction:r,editingSelection:e,selectAll:i});else if((0,Me().B1)("c")){const e=(0,xe().T)(c.start.store);pt().$D({environment:t,editorMode:e?Ve().Uv.getMode(e):"default",multiSelection:c,string:n,disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:r,selectAll:i})}else{const e=s&&_().Z4({...s,markdown:n,plugin:null==a?void 0:a.plugin});if(!e)return;Tn({environment:t,html:e,transaction:r,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:o,selectAll:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}}}({environment:t,text:l,disableEmbedMenu:n,transaction:o,selectAll:i,markdownOptions:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:c}))}function Sn(e,t){const n=e.getValue({table:V().ev,id:t});if(!n)return;const o={table:V().ev,id:t,spaceId:n.space_id},r=(n.content??[]).map((t=>Sn(e,t))).filter(Q().O9);return new(j().PH)(o,r)}function In(e){var t,n,o,r;const a=pe().ZO(),{html:s,wrapInEmptyBlocks:l,tinyMceMicrosoftWordPasteFilter:c,environment:d}=e,u=wn({environment:d,html:s,tinyMceMicrosoftWordPasteFilter:c,useCrdt:!1});if(!u)return;const{currentUserStore:p}=Fe().default.state;if(!p)return;let{allOperations:m,rootContentIds:f}=u;if(l){const e=Mn(d),t=Mn(d);if(!e||!t)return;m=[e.operation,...m,t.operation],f=[e.id,...f,t.id]}const g=B().RecordMap.create();(0,D().applyOperationsToRecordMap)({recordMap:g,operations:m,updateOnly:!1});const b=[],v=function(e){const{name:t,userId:n,recordMap:o}=e,r=B().RecordMapWithRole.create();for(const{pointer:i,model:a}of o)r.setModelAndRole(i,a,"reader");return new(i().A)({name:t,data:new(Z().b)({[n]:r})})}({name:"htmlToMultiTextSelectionClipboardData",userId:p.id,recordMap:g});for(const i of f){const e=(0,ce().loadLocalSubtree)(d,{blockId:i,inMemoryRecordCache:v,allowCopyCollections:!0,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,excludeCrdtData:!0,includeLegacyTransclusionBlockValues:(0,ke().$J)()}).recordMap;b.push({blockId:i,blockSubtree:e})}const k=new(j().PH)({...(0,ve().zP)({environment:d,table:V().ev,spaceId:null==a?void 0:a.pointer.spaceId})},f.map((e=>Sn(g,e))).filter(Q().O9));if(0===k.children.length)return;const y=k.children[0],h=null===(t=(0,j().Qe)([k],(e=>e===y)))||void 0===t?void 0:t.map((e=>e.value)),S=null===(n=g.getValue(y.value))||void 0===n||null===(n=n.properties)||void 0===n?void 0:n.title,I=(0,j().wI)(k),x=null===(o=(0,j().Qe)([k],(e=>e===I)))||void 0===o?void 0:o.map((e=>e.value)),T=null===(r=g.getValue(I.value))||void 0===r||null===(r=r.properties)||void 0===r?void 0:r.title,C=T?H().q4_(T).length:0;return S&&h&&T&&x?{blockSelection:{blocks:b,wasContiguousSelection:!0,action:"copy"},tree:k,multiTextSelection:{start:{textIndex:0,copiedText:S,attributePath:["properties","title"],pointerPath:h},end:{textIndex:C,copiedText:T,attributePath:["properties","title"],pointerPath:x}},action:"copy"}:void 0}function xn(e){const{text:t,html:n,stripText:o,stripSurroundingWhitespace:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=n||(t?rn({markdown:t,markdownLinkifyIt:i}):void 0);if(!s)return;if(Ue().default.checkGate({gateName:"paste_links_as_mentions"})){const e=(0,me().Lj)(s);if(e)return[H().wmz(H().ld4(e.id,e.spaceId),[])]}const l=document.createElement("div");return l.innerHTML=An({html:s,tinyMceMicrosoftWordPasteFilter:a}),x().Hw({node:l,window,stripText:o,stripSurroundingWhitespace:r,emojiData:ue().A.state})}function Tn(e){const{environment:t,html:n,transaction:o,stripText:r,stripSurroundingWhitespace:i,disableEmbedMenu:a,selectAll:s,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c}=e,d="editing"===ze().default.state.mode&&ze().default.state.multiSelection;if(d){const e=xn({html:n,stripText:r,stripSurroundingWhitespace:i,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c});if(!e)return;const u=(0,xe().T)(d.start.store),p=1===e.length;if(p){if(p&&(!e[0][1]||0===e[0][1].length)){o.logDebugMessage("pasteInlineHtml: insertString");const n=e[0][0];return void pt().$D({environment:t,editorMode:u?Ve().Uv.getMode(u):"default",multiSelection:d,string:n,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:o,selectAll:s})}const n=(0,he().H7)(d);if(n&&!(0,he().kM)(d)){const[,r]=e[0],i=r&&H().VtW(r);if(i){o.logDebugMessage("pasteInlineHtml: pasteLinkOverText");return void Bn({environment:t,text:H().cQR(i),transaction:o,editingSelection:n,selectAll:s})}}}o.logDebugMessage("pasteInlineHtml: delete selection and insert"),pt().f0({environment:t,multiSelection:d,transaction:o}),bn({environment:t,store:d.start.store,tokens:e,index:d.start.index,transaction:o,disableEmbedMenu:a,multiTextSelection:d,selectAll:s})}}function Cn(e){const{environment:t,html:n,transaction:o,tinyMceMicrosoftWordPasteFilter:r}=e,i=pe().ZO();if(!i)return;const s=wn({environment:t,html:n,tinyMceMicrosoftWordPasteFilter:r,useCrdt:i.useCrdt()});if(!s)return;const{allOperations:l,rootContentIds:d}=s;for(const a of l)if((0,z().ph)(a)){const e=We().Bv.createChildStore(i,a.pointer);Rt().applyCrdtTextOperation({store:e,operation:a,invertedOperation:void 0,transaction:o})}else if((0,R().$Y)(a)){const e=(0,We().Oo)(i,a.pointer);Rt().applyOperation({store:e,operation:a,transaction:o})}else(0,Q().HB)(a);const u=d.map((e=>We().Bv.createChildStore(i,{table:V().ev,id:e})));u.forEach((e=>{const n=e.getType();n&&Qe().v(t,{from:"paste",type:n,creating_block_id:e.id,parent_collection_id:e.getParentCollectionIdUpToTwoLevels()})}));const p=kn({environment:t,blocks:u,transaction:o,replaceEmptyTextBlock:!0}).slice().reverse();return a().default.afterNextFlush((()=>{const e=p.map((e=>{if(e.getType()!==c().xd.text)return;const n=vn(e.getTitleValue());if(!n)return;const o=(0,N().parseRoute)({url:n.url,baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,isMobile:t.device.isMobile,protocol:ae().A.protocol,currentUrl:window.location.href});return"page"===o.name?o:void 0})).filter(Q().O9);nt().T_({environment:t,rootStore:i,blocks:p,copiedLinks:e})||nt().Tw({environment:t,blocks:p})})),u}function Mn(e){const{currentUserStore:t}=Fe().default.state,n=pe().ZO();if(!t||!n)return;const o=t.id;if(!o)return;const r=n.id,i=n.pointer.spaceId,a=(0,ve().Z1)({environment:e,table:V().ev,spaceId:i});return{operation:{pointer:{table:"block",id:a,spaceId:i},command:"set",path:[],args:{id:a,version:1,type:"text",properties:{title:[[""]]},parent_id:r,parent_table:"block",space_id:i,created_by_table:"notion_user",created_by_id:o,created_time:Date.now(),last_edited_by_table:"notion_user",last_edited_by_id:o,last_edited_time:Date.now(),alive:!0}},id:a}}function wn(e){const{environment:t,useCrdt:n,...o}=e,r=document.createElement("div");r.innerHTML=An(o);const{currentUserStore:i}=Fe().default.state,a=pe().ZO();if(!i||!a)return;const l=i.getValue();if(!l)return;const c=a.getSpaceId(),d=(0,ve().Gx)({environment:t,spaceId:c}),u=t.idCreator.getSpaceShortIdCreator(c,d);return x().aH({actor:(0,s().A7)(l),parent:{id:a.id,table:V().ev,spaceId:c},rootNode:r,deps:{importFileMap:{},window,intl:ye().A.getIntl(),randomID:K().Ay,spaceIdCreator:u,randomShortID:Y().Ay,isPhoneNumber:P().W,emojiData:ue().A.state},options:{useCrdt:n,ignoreBlockCount:!1}})}function _n(e){return/schemas-microsoft-com:office/.test(e)||/xmlns:m="http:\/\/schemas.microsoft.com\/office\/2004\/12\/omml"/.test(e)}function An(e){const{html:t,tinyMceMicrosoftWordPasteFilter:n}=e;return r().sanitize(n&&_n(t)?n(t):t)}function Rn(e){const t="editing"===e.mode&&e.multiSelection;if(!t)return;const n=Ae().n.findEditableWithStore(t.start.store),o=null==n?void 0:n.props;return o&&!o.disabled?o.pasteBehavior:void 0}function Dn(){var e;if("editing"!==ze().default.state.mode)return;const t=ze().default.state.multiSelection.start,n=t.store.path;if("formula"!==n[n.length-1])return;const o=t.store.getRecordStoreAtRootPath();if((null==o?void 0:o.table)!==V().ev)return;const r=null==o||null===(e=o.getPropertiesStore())||void 0===e||null===(e=e.getValue())||void 0===e||null===(e=e.collection_id)||void 0===e||null===(e=e[0])||void 0===e?void 0:e[0];if(!r)return;const i={table:U().Vl,id:r,spaceId:o.getSpaceId()},a=o.getRecordModel(i);return a?{parentCollection:a,start:t,getRecordModel:o.getRecordModel}:void 0}function Pn(){const e=He().default.state.stores;if("editing"!==ze().default.state.mode)return e.length>0&&e[0].isInsideFactoryOrDuplicateBlocksAction();if(0===e.length)return!1;const{multiSelection:t}=ze().default.state,n=t.start.store;if(!n.isTable(V().ev))return!1;const o=ge().E(n);return Boolean(o)}function Bn(e){const{text:t,transaction:n,environment:o,editingSelection:r,selectAll:i}=e,a=(0,N().parseRoute)({url:t,baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,isMobile:o.device.isMobile,protocol:ae().A.protocol,currentUrl:window.location.href}),s="page"===a.name&&a.blockId?(0,C().wv)({pageId:a.blockId,peekViewBlockId:a.peekViewBlockId,peekMode:a.peekMode,discussionId:a.discussionId,scrollToBlockId:a.scrollToBlockId,collectionViewId:a.collectionViewId}):t,l=pt().di({environment:o,store:r.store,selection:r.selection,transaction:n});pt().gw({environment:o,store:r.store,selection:l,annotationKey:"a",transaction:n,updateSelection:!1}),At().Mw({environment:o,store:r.store,selection:l,annotation:["a",s],transaction:n}),mt().setSelection({store:r.store,selection:{startIndex:i?l.startIndex:l.endIndex,endIndex:l.endIndex}})}const Fn=/\<\!-- wp:/;const En=/\u2028/g;function Nn(e){var t;let{environment:n,event:r,disableEmbedMenu:i,transaction:a,onPasteFiles:s,formulasModule:l,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}=e;const p=Ue().default.checkGate({gateName:"allow_cut_copy_comment"});if(r.preventDefault(),mt().syncTextSelection(),!r.clipboardData)return;const f=Qt(r.clipboardData,n.device),g=Array.from(Array((null===(t=f.items)||void 0===t?void 0:t.length)??0).keys()).flatMap((e=>{var t;const n=f.items[e];if("file"!==n.kind)return[];const o=null===(t=n.getAsFile())||void 0===t||null===(t=t.name.match(/\.[^.]+$/))||void 0===t?void 0:t[0];return o?[o]:[]})),b=f.getData("text/html"),v=null==b?void 0:b.length;!function(e,t){let{source:n,types:o,fileExtensions:r,htmlContent:i}=t;const a=[...o];a.sort();const s=r.map((e=>e.toLowerCase()));et().vd(e,"paste",{source:n,types:a,file_extensions:s,original_html_content_size:i.length})}(n,{source:"editor",types:f.types||[],fileExtensions:g,htmlContent:b});const{text:k,html:h,multiTextSelectionData:S,textSelectionData:x,blockSelectionData:T,isFromMicrosoftOffice:C,isHtmlTable:M}=nn({clipboardData:f,tinyMceMicrosoftWordPasteFilter:u}),w=tn(f,Ot,jt),_=function(e){return e.clipboardData?e.clipboardData.items?J().oE(Array.from(e.clipboardData.items).map((e=>{const t=e.getAsFile();if(t&&t.size>0)return new File([t],t.name??ye().A.formatMessage(Ft.untitled),{type:e.type})}))):m().PE(e.clipboardData.files):[]}(r),A=Rn(ze().default.state),R=(null==T?void 0:T.action)||(null==S?void 0:S.action)||(null==x?void 0:x.action);a.annotateWithUserAction("cut"===R?"paste.from_cut":me().Vz);const D=k.includes("\n"),P="body"===(0,Me().X4)()&&!x;if((_.length>0||T||D&&!P)&&!(0,$e().EF)(n))return;const B=function(e){const t=tn(e,Wt,Zt),n=null==t?void 0:t.mode;if(!n)return;return Nt[n]||"Plain Text"}(f),F=D&&B&&"inline"!==A&&!(0,Me().X4)()?Vn({codeLanguage:B,environment:n,transaction:a}):void 0;Xe().oF(n,{pastedText:k,source:"editor_paste"});const E=De().wg(),N=De().KR(),V=r.clipboardData.getData(oe().sE),U=Dn();if(_.length>0&&!C&&!M)a.logDebugMessage("paste: file/image detected -> onPasteFiles"),s({environment:n,files:_,transaction:a});else if(P)a.logDebugMessage("paste: editing code block contents with no Notion text selection -> pasteRawText"),Un(n,k,a);else if(F)a.logDebugMessage("paste: pasting code in existing empty text block with no selection or new code block after selection  -> pasteRawText"),Un(n,k,a);else if(U){a.logDebugMessage("paste: formulaInformation detected, attempting to paste as formula");const{parentCollection:e,start:t}=U,o=[[k]],r=e;if(!r||!l)return void Un(n,k,a);const i=ze().default.state;"multiSelection"in i&&pt().f0({environment:n,multiSelection:i.multiSelection,transaction:a});const s=(0,y().K5)({formulasModule:l,getRecordModel:U.getRecordModel,sourceCollection:r,textValue:o,featureGates:(0,fe().i)()});pt().yr({environment:n,tokens:s,store:t.store,index:t.index,transaction:a})}else if("plaintext"===A)a.logDebugMessage("paste: plaintext paste behavior detected, pasting as inline html"),Tn({environment:n,html:k,transaction:a,stripText:!0,stripSurroundingWhitespace:!0,disableEmbedMenu:i,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}),Ke({environment:n,type:"plaintext",originalHtmlContentSize:v});else if(S){a.logDebugMessage("paste: multiTextSelectionData detected, attempting to paste as textselection");const e=function(e){const{environment:t,transaction:n,multiTextSelectionData:o,disableEmbedMenu:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}=e,s=e.pasteBehavior||"inline",l=e.html||rn({markdown:e.text,markdownLinkifyIt:i});if("editing"===ze().default.state.mode)switch(s){case"inline":return!!l&&(Tn({environment:t,html:l,transaction:n,stripText:!1,stripSurroundingWhitespace:!0,disableEmbedMenu:r,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:a}),!0);case"block":return ft({environment:t,clipboardData:o,transaction:n,preventLegacyTransclusions:(0,ke().$J)()});default:(0,Q().HB)(s)}}({multiTextSelectionData:S,environment:n,html:h,text:k,transaction:a,disableEmbedMenu:i,pasteBehavior:A,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u});e||(a.logDebugMessage("paste: could not paste as textSelection -> paste as blockSelection"),yn(n,S.blockSelection,w,a))}else if(x&&x.editing){a.logDebugMessage("paste: textSelectionData detected, pasting text selection");const e=(0,ne().dr)(),t=(null==w?void 0:w.id)!==(null==e?void 0:e.id);!function(e){const{environment:t,textSelectionData:n,transaction:o,disableEmbedMenu:r,removeDiscussions:i}=e,a=He().default.getCurrentRecordCache(),{editing:s,selection:l}=n;let{tokensInsideRange:d}=H().AI5(s,l.startIndex,l.endIndex);d=H().Uee(d,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:i??!0});const u=(0,pe().ZO)();if(u&&!(u.isInsideTemplate()||Pn()||u.isInsideFactoryOrDuplicateBlocksAction())&&(d=(0,X().f$)(d,{currentUserId:t.currentUser.id,currentTimeZone:(0,I().P)()})),"body"===(0,Me().X4)()){const e=H().Cc8(d);e&&(d=e)}const p="editing"===ze().default.state.mode&&ze().default.state.multiSelection;if(p){if(!(0,he().kM)(p)){const t=(0,he().H7)(p);if(t){const o=H().Ffo(n.editing,n.selection.startIndex,n.selection.endIndex);if(1===o.length){const[n,r]=o[0],i=r&&H().VtW(r);if(i){const o=H().cQR(i);if([n,`http://${n}`,`https://${n}`].includes(o))return void Bn({environment:e.environment,text:o,transaction:e.transaction,editingSelection:t})}}}}const i=(0,xe().T)(p.start.store),a=i?Ve().Uv.getMode(i):"default";if("suggest"===a){const e=ie().RR(t,o,p);ie().rY({environment:t,multiSelection:p,transaction:o,discussionStore:e}),d=H().Mwp({textValue:d,selection:{startIndex:0,endIndex:1/0},annotation:[H().Ifu.SuggestionInsertText,e.id]})}else"default"===a&&pt().f0({environment:t,multiSelection:p,transaction:o});const s=ze().default.state;if("editing"===s.mode){const e=s.multiSelection;if(n.blockType&&0===l.startIndex){const r=(0,xe().T)(e.start.store);r&&"page"!==n.blockType&&(0,Ie().P4)(r)&&de().transformBlocks({environment:t,blocks:[r],blockType:n.blockType,transaction:o})}bn({environment:t,store:e.end.store,tokens:d,index:e.end.index,transaction:o,disableEmbedMenu:"suggest"===a||r,multiTextSelection:p})}}else if(a){var m;const e=He().default.state.stores,n=Tt().Wv({environment:t,type:c().xd.text,inMemoryRecordCache:a,transaction:o,spaceId:0!==e.length?e[e.length-1].pointer.spaceId:null===(m=pe().ZO())||void 0===m?void 0:m.pointer.spaceId}),r=n.getTitleStore();r&&pt().yr({environment:t,store:r,tokens:d,index:0,transaction:o}),kn({environment:t,blocks:[n],transaction:o,replaceEmptyTextBlock:!1}),Qe().v(t,{from:"paste",type:c().xd.text,creating_block_id:n.id,parent_collection_id:n.getParentCollectionIdUpToTwoLevels()})}}({environment:n,textSelectionData:x,transaction:a,disableEmbedMenu:i,removeDiscussions:!p||("copy"===R||t)})}else if(T&&T.blocks.length>0&&"inline"!==A)a.logDebugMessage("paste: blockSelectionData detected, pasting block selection"),yn(n,T,w,a);else if(E&&N&&V){const{simpleTableStore:e}=E.getProps(),{selection:t}=N,i=De().$O(e);t&&i&&_t().GZ({clipboardActions:o,environment:n,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:i,event:r,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u})}else if(h)if(E&&N){const{simpleTableStore:e}=E.getProps(),{selection:t}=N,i=De().$O(e);t&&i&&(a.logDebugMessage("paste: pasting selection into simple table"),_t().GZ({clipboardActions:o,environment:n,simpleTableStore:e,selection:t,currentRows:e.getContentStores(),columnOrder:i,event:r,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}))}else(D||M)&&"inline"!==A?(a.logDebugMessage("paste: pasting as html"),Cn({environment:n,html:h,transaction:a,tinyMceMicrosoftWordPasteFilter:u}),Ke({environment:n,type:"html",originalHtmlContentSize:v})):(a.logDebugMessage("paste: pasting as inline html"),Tn({environment:n,html:h,transaction:a,stripText:!1,stripSurroundingWhitespace:!1,disableEmbedMenu:i,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}),Ke({environment:n,type:"inline_html",originalHtmlContentSize:v}));else a.logDebugMessage("paste: pasting as markdown"),hn({environment:n,text:k,disableEmbedMenu:i,transaction:a,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}),Ke({environment:n,type:"markdown",originalHtmlContentSize:v});Oe().A.setKeyboardMode(!0)}function Vn(e){const{codeLanguage:t,environment:n,transaction:o}=e,r=ze().default.state,i="editing"===r.mode&&r.multiSelection,a=He().default.state.stores;if(!i&&0===a.length)return;let s,l,d;if(i?(s=i.start.store,l=i.end.store,d=(0,xe().T)(l)):(s=a[0],l=a[a.length-1],d=l),!d)return;let u=d;if((0,Ie().P4)(d))!function(e){const{blockStore:t,environment:n,transaction:o,codeLanguage:r}=e;de().transformBlocks({environment:n,blocks:[t],blockType:"code",transaction:o}),vt().IA({blocks:[t],language:r,transaction:o})}({blockStore:d,environment:n,transaction:o,codeLanguage:t});else{const e=(0,xe().T)(d);if(!e)return;const t=s.inMemoryRecordCache;if(!t)return;u=Tt().Wv({environment:n,type:c().xd.code,inMemoryRecordCache:t,transaction:o,spaceId:e.pointer.spaceId}),xt().WH({parentStore:e.getContentStore(),afterStore:l,insertStore:u,transaction:o})}Ce().clear(n);const p=(0,xe().aI)(u);return p&&mt().setSelectionAtStart({store:p}),u}function Un(e,t,n){const o="editing"===ze().default.state.mode&&ze().default.state.multiSelection;if(o){const r=(0,xe().T)(o.start.store);pt().$D({environment:e,editorMode:r?Ve().Uv.getMode(r):"default",multiSelection:o,string:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:n})}}function Ln(e){const t=e.getNavigableBlockStore();if(t)return(0,be().J8)({store:t,scrollToBlockId:t.id===e.id?void 0:e.id,fullyQualified:!0,pageVisitSource:l().y8.CopyLink,embedded:!1})}function On(e){const{environment:t,blocks:n,callback:o}=e,r=n[0];(0,re().y)(),Re().wr();const i=Ln(r);if(i){Xn({environment:t,stringValue:i,copiedMessage:r.isPageBlock()||r.isFormBlock()?Et.copiedLinkToClipboard:Et.copiedBlockLinkToClipboard}).then(o)}}function Wn(e){const{environment:t,blocks:n,callback:o}=e,r=n[0];(0,re().y)(),Re().wr();const i=Ln(r),a=function(e,t){var n;const o=Ln(t);if(!o)return;const r=e.currentUser.id,i=(0,g()._z)({blockId:t.id,intl:ye().A.getIntl(),getRecordValue:t.inMemoryRecordCache.makeGetRecordValueFn(r),userTimeZone:(0,I().P)()}),a=null===(n=t.getBlockIconStore())||void 0===n?void 0:n.getValue(),s=[(0,M().A)(a)?a:void 0,i].filter(Q().O9).join(" ");if(!s)return o;let l=`<a href="${o}"><span>${s}</span></a>`;return Ue().default.checkGate({gateName:"paste_links_as_mentions"})&&(l+=(0,me().a0)({id:t.id,spaceId:t.getSpaceId()})),l}(t,r);if(i&&a){$n({environment:t,stringValue:i,htmlValue:a,copiedMessage:r.isPageBlock()?Et.copiedPageLinkToClipboard:r.isFormBlock()?Et.copiedFormLinkToClipboard:Et.copiedBlockLinkToClipboard}).then(o)}}function Hn(e){const{environment:t,blocks:n,callback:o}=e;if(n.length<2)return On(e);(0,re().y)(),Re().wr();const r=n.map(Ln).filter(Q().O9);if(r.some(Boolean)){const e=r.length>1?Et.copiedLinksToClipboard:Et.copiedLinkToClipboard;Xn({environment:t,stringValue:r.join("\n\n"),copiedMessage:e}).then(o)}}function zn(e){const{environment:t,blocks:n,callback:o}=e,r=n[0];if(!r.isDefined())return;const i=r.getModel(),a=r.getProperties(),s=r.getFormat();let l;if(r.isType(c().xd.bookmark))l=H().q4_(a.link);else if((0,c().ie)(i.type))l=H().q4_(a.source);else if(r.isType(c().xd.externalObjectInstance)||r.isType(c().xd.externalObjectInstancePage))l=(null==s?void 0:s.original_url)||(null==s?void 0:s.uri);else if(r.isType(c().xd.collectionView)){var d;const e=null===(d=r.getCollectionStore())||void 0===d?void 0:d.getValue();var u;if(e&&(0,b().ek)(e))l=null===(u=e.format)||void 0===u?void 0:u.original_url}else{if(!r.isType(c().xd.alias))return;l=null==s?void 0:s.comment_alias_url}if(!l)return;if(v()._J(l))return void h().log({level:"error",from:"clipboardActions",type:"copyDirectLinkToContent",error:{message:"Attempted to copy a direct signed url for S3-housed content."}});if(l=ee().q7(l),!l)return;(0,re().y)(),Re().wr();Xn({environment:t,stringValue:l,copiedMessage:Et.copiedLinkToClipboard}).then(o)}function $n(e){return jn(e)}function Xn(e){return jn(e)}async function jn(e){const{environment:t,htmlValue:n,stringValue:o,copiedMessage:r,showCopyModal:i}=e;function a(){Mt().IU({environment:t}),Ee().A.setState({...Ee().A.state,active:!0,stringValue:o})}if(i)a();else try{var s;if(t.device.isElectron&&null!==(s=yt().electronApi)&&void 0!==s&&null!==(s=s.clipboard)&&void 0!==s&&s.write){const e={text:o};n&&(e.html=n),await yt().electronApi.clipboard.write(e)}else if("undefined"==typeof ClipboardItem)await navigator.clipboard.writeText(o);else{const e={"text/plain":new Blob([o],{type:"text/plain"})};n&&(e["text/html"]=new Blob([n],{type:"text/html"}));const t=new ClipboardItem(e);await navigator.clipboard.write([t])}r&&wt().D6({label:ye().A.formatMessage(r)})}catch{a()}}function Zn(){document.queryCommandSupported("copy")&&document.execCommand("copy")}async function Gn(e,t){let n;n="string"==typeof t?t:JSON.stringify(t),n&&await Xn({environment:e,stringValue:n,copiedMessage:Et.copiedToClipboard})}function qn(e){const{environment:t,textSelection:n,markdownSerializationOptions:o,markdownLinkifyIt:r}=e,i=(0,he().H7)(n);if(i&&i.selection.startIndex!==i.selection.endIndex)return function(e){const{environment:t,singleStoreTextSelection:n,markdownSerializationOptions:o}=e,{store:r,selection:i}=n,a=t.currentUser.id,s=r.inMemoryRecordCache,c=ye().A.getIntl(),d=r.getValue(),p=H().Ffo(d,i.startIndex,i.endIndex),m=r.getRecordStoreUIRoot().getValue();if(!m)return;const f={id:m.id,table:V().ev,spaceId:m.space_id},g=s.makeGetRecordValueFn(a);return _().ZR({textValue:p,exportArgs:{root:f,navigableBlockId:f.id,renderParentBlockId:void 0,blockId:f.id,userTimeZone:(0,I().P)(),intl:c,getRecordValue:g,numberedListCache:{},bulletedListCache:{},getRecordsWithParent:()=>[],getExportedPathToFile:e=>{let{toFileURI:t}=e;return t},getExportedRenderAsset:e=>{let{toFileURI:t}=e;return t},getExportedPathToPage:e=>{let{toPageId:t}=e;return(0,u().A)({pageId:t,pageValue:g({table:V().ev,id:t}),baseUrl:ae().A.domainBaseUrl,pageVisitSource:l().y8.Export})},baseUrl:ae().A.domainBaseUrl,publicDomainName:ae().A.publicDomainName,transformAnnotation:null==o?void 0:o.transformAnnotation,transformBlockMapping:null==o?void 0:o.transformBlockMapping,resultCache:new Map,regExpCache:new Map,experimentService:Ue().default,collectionFeatureGates:(0,fe().i)(),formulasModule:k()}})}({environment:t,singleStoreTextSelection:i,markdownSerializationOptions:o});const a=cn({environment:t,multiSelection:n,action:"copy"});if(!a)return;const s=n.start.store.inMemoryRecordCache,c=n.start.store.getRecordStoreUIRoot().getValue();if(!c)return;const d=t.currentUser.id,{markdown:p}=(0,me().Ij)({clipboardData:a,rootBlock:{id:c.id,table:V().ev,spaceId:c.space_id},isWindows:t.device.isWindows,fallbackGetRecordValue:s.makeGetRecordValueFn(d),markdownSerializationOptions:o,markdownLinkifyIt:r,formulasModule:k()});return p}function Jn(e){const{environment:t,inMemoryRecordCache:n,text:o,transaction:r,markdownOptions:i,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:l,parentPointer:c}=e,d=rn({markdown:o,markdownOptions:i,markdownLinkifyIt:a});if(!d)return;const u=document.createElement("div");u.innerHTML=An({html:d,tinyMceMicrosoftWordPasteFilter:l});const{currentUserStore:p,currentSpaceStore:m}=Fe().default.state;if(!p||!m)return;const f=p.getValue();if(!f)return;const g=(pe().ZO()??m).id,b=m.id,v=(0,ve().Gx)({environment:t,spaceId:b}),k=t.idCreator.getSpaceShortIdCreator(b,v),{allOperations:y,rootContentIds:h}=x().aH({actor:(0,s().A7)(f),parent:c??{id:g,table:V().ev,spaceId:m.id},rootNode:u,deps:{importFileMap:{},window,intl:ye().A.getIntl(),randomID:K().Ay,spaceIdCreator:k,randomShortID:Y().Ay,isPhoneNumber:P().W,emojiData:ue().A.state},options:{useCrdt:(0,se().D8)(m),ignoreBlockCount:!1}});for(const s of y)if((0,z().ph)(s)){const e=new(We().Bv)(t,s.pointer,{inMemoryRecordCache:n,userId:f.id});Rt().applyCrdtTextOperation({store:e,operation:s,invertedOperation:void 0,transaction:r})}else if((0,R().$Y)(s)){const e=new(We().pm)({environment:t,pointer:s.pointer,recordStoreOptions:{inMemoryRecordCache:n,userId:f.id}});Rt().applyOperation({store:e,operation:s,transaction:r})}else(0,Q().HB)(s);return h.map((e=>new(We().Bv)(t,{table:V().ev,id:e},{inMemoryRecordCache:n})))}function Kn(e){const{event:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}=e;if(!t.clipboardData)return;const{text:r,html:i,multiTextSelectionData:a,textSelectionData:s,blockSelectionData:l}=nn({clipboardData:t.clipboardData,tinyMceMicrosoftWordPasteFilter:o});if(a)return xn({text:r,html:i,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o});if(s){const{editing:e,selection:t}=s;return H().Uee(H().AI5(e,t.startIndex,t.endIndex).tokensInsideRange,{removeSuggestionAnnotationsAndText:!1,removeSuggestionAnnotations:!0,removeDiscussions:!0})}return i||r?function(e){const{text:t,html:n,blockSelectionData:o,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i}=e,a=t.includes("\n");return a||o&&o.blocks.length>0?H().x9d(t):xn({text:t,html:n,stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}({text:r,html:i,blockSelectionData:l,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):void 0}},563015:(e,t,n)=>{n.d(t,{eJ:()=>g,ew:()=>f,ml:()=>d,rA:()=>p,yI:()=>m,zf:()=>u});n(581454);var o=()=>n(496603),r=()=>n(534177),i=()=>n(708685),a=()=>n(145076),s=()=>n(349835),l=()=>n(977345);function c(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,r().HB)(e)}}function d(e){switch(e.type){case s().M9.InvalidCharacter:return{...a().x0.InvalidCharacter,values:{errorCharacter:e.character}};case s().M9.UnclosedStringLiteral:return a().x0.UnclosedStringLiteral;case s().M9.UnclosedComment:return a().x0.UnclosedComment;case s().M9.TokenExpected:return{...a().x0.TokenExpected,values:{expectedToken:e.token}};case s().M9.StringLiteralContainsToken:return a().x0.StringLiteralContainsToken;case s().M9.ExpressionExpected:return a().x0.ExpressionExpected;case s().M9.PropertyTokenOrFunctionExpected:return a().x0.PropertyTokenOrFunctionExpected;case s().M9.EndOfInputExpected:return a().x0.EndOfInputExpected;case s().M9.UnexpectedError:return a().x0.UnexpectedError;case s().M9.TooDeeplyNested:return a().x0.TooDeeplyNested;default:(0,r().HB)(e)}}function u(e){switch(e.type){case s().IA.FunctionCallArgumentWrongType:case s().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function p(e,t){let n;switch(t.type){case s().IA.ThisRowTypeNotFound:n=a().Xz.ThisRowTypeNotFound;break;case s().IA.ThisRowNotBlockWithCollection:n=a().Xz.ThisRowNotBlockWithCollection;break;case s().IA.MissingPropertyOnThisRow:n={...a().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().IA.MissingContextVariable:{const e=(0,l().ix)(t.token)?t.token.contextValueId:t.token.valueId;n={...a().Xz.MissingContextVariable,values:{valueId:e}}}break;case s().IA.MissingBlock:n={...a().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case s().IA.CallingNotFunction:n={...a().Xz.CallingNotFunction,values:{expressionType:c(t.callee.type.type)}};break;case s().IA.FunctionCallTooFewArguments:n={...a().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().IA.FunctionCallUnexpectedArgument:n={...a().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().IA.FunctionCallArgumentWrongType:n={...a().Xz.FunctionCallArgumentWrongType,values:{argumentType:c(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().IA.MemberPropertyMismatchCollection:n={...a().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().IA.MemberPropertyMissing:n={...a().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().IA.MemberPropertyTargetNotBlock:n=a().Xz.MemberPropertyTargetNotBlock;break;case s().IA.MemberPropertyTypeInvalid:n={...a().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().IA.UndefinedIdentifier:n={...a().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().IA.UnifiedFunctionCannotFindFunction:n={...a().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().IA.UnifiedFunctionNoArguments:n={...a().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().IA.UnifiedFunctionTargetWrongType:n={...a().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:c(t.expression.type.type)}};break;case s().IA.CannotRelativelyCompareTypes:n={...a().Xz.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().IA.CannotDoMathOnType:n={...a().Xz.CannotDoMathOnType,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().IA.UnaryMinusOnNonNumber:n={...a().Xz.UnaryMinusOnNonNumber,values:{type:c(t.expression.type.type)}};break;case s().IA.IdentifierExpected:n=a().Xz.IdentifierExpected;break;case s().IA.FunctionCallExpected:n={...a().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().IA.RenamedIdentifier:n={...a().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().IA.RemovedFunction:n={...a().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().IA.ContextVariableNotBlockWithCollection:n={...a().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().IA.MissingPropertyOnContextVariable:n={...a().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().IA.BlockPropertyTypeInvalid:n={...a().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().IA.DisallowedReturnType:{const o=t.allowedReturnTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(o,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,i().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().IA.CrossSpacePropertyNotSupported:n={...a().Xz.CrossSpacePropertyNotSupported};break;default:(0,r().HB)(t)}return{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function m(e,t){let n;switch(t.type){case s().uW.MissingThisRow:n=a().X8.MissingThisRow;break;case s().uW.MissingSchemaPropertyOnThisRow:n={...a().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().uW.ThisRowBlockPropertyMismatchCollection:n=a().X8.ThisRowBlockPropertyMismatchCollection;break;case s().uW.MissingContextVariable:n={...a().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case s().uW.IdentifierNotFound:n={...a().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().uW.CannotRelativelyCompareTypes:n={...a().X8.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType),rhsType:c(t.rhsType)}};break;case s().uW.CannotDoMathOnType:n={...a().X8.CannotDoMathOnType,values:{valueType:c(t.valueType)}};break;case s().uW.CannotCallNonFunction:n={...a().X8.CannotCallNonFunction,values:{calleeType:c(t.calleeType)}};break;case s().uW.UnifiedFunctionPropertyNotFound:n={...a().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().uW.LibraryFunctionExecutionError:const o=t.error instanceof s().x4?t.error:void 0;n=(null==o?void 0:o.info.type)===s().v3.DateInvalidDurationUnit?{...a().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:o.info.invalidUnit}}:(null==o?void 0:o.info.type)===s().v3.CannotUseToNumberOnList?{...a().gW.CannotUseToNumberOnList}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToNonInteger?{...a().gW.CannotRoundToNonInteger,values:{precision:o.info.precision}}:(null==o?void 0:o.info.type)===s().v3.CannotRoundToTooManyDecimalPlaces?{...a().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:o.info.precision}}:{...a().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallTooFewArguments:n={...a().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallUnexpectedArgument:n={...a().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallArgumentWrongType:n={...a().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:c(t.argumentType)}};break;case s().uW.AccessingPropertyOnNonBlock:n=a().X8.AccessingPropertyOnNonBlock;break;case s().uW.MissingDataDependencyBlock:n={...a().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().uW.MissingDataDependencyPerson:n={...a().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().uW.MemberPropertyMismatchCollection:n=a().X8.MemberPropertyMismatchCollection;break;case s().uW.MissingPropertyOnSchemaForMemberProperty:n=a().X8.MissingPropertyOnSchemaForMemberProperty;break;case s().uW.UnaryMinusOnNonNumber:n={...a().X8.UnaryMinusOnNonNumber,values:{expressionType:c(t.expressionType)}};break;case s().uW.UnexpectedRecoveryNode:n=a().X8.UnexpectedRecoveryNode;break;case s().uW.UnexpectedError:n=a().X8.UnexpectedError;break;case s().uW.DepthExceeded:n=a().X8.DepthExceeded;break;case s().uW.CycleDetected:n=a().X8.CycleDetected;break;case s().uW.DownstreamParseFailure:n=a().X8.DownstreamParseFailure;break;case s().uW.MaxEvaluationTimeExceeded:n=a().X8.MaxEvaluationTimeExceeded;break;case s().uW.MissingSchemaPropertyOnCollection:n={...a().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().uW.ContextVariableWrongType:n={...a().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().uW.DisallowedValueType:{const o=t.allowedValueTypes.map((t=>e.formatMessage((0,i().getHumanReadableType)(t)).toLocaleLowerCase()));n={...a().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(o,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,i().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,r().HB)(t)}return(0,l().li)(t)?{...n,values:{...n.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:n}function f(e){const t=null==e?void 0:e.values;return[o().cJ(e,"values"),t]}function g(e){return e.type===s().uW.DepthExceeded||e.type===s().uW.CycleDetected||e.type===s().uW.MaxEvaluationTimeExceeded||e.type===s().uW.LibraryFunctionExecutionError}},603815:(e,t,n)=>{n.d(t,{A$:()=>C,JQ:()=>M,Vn:()=>x,s4:()=>T});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var o=()=>n(857639),r=()=>n(585515),i=()=>n(577449),a=()=>n(388821),s=()=>n(179034),l=()=>n(545285),c=()=>n(534177),d=()=>n(449506),u=()=>n(780054),p=()=>n(989423),m=()=>n(870618),f=()=>n(303626),g=()=>n(14307),b=()=>n(245865),v=()=>n(540758),k=()=>n(670631),y=()=>n(508496),h=()=>n(571963),S=()=>n(603815),I=()=>n(108944);async function x(e){const{environment:t,request:n,abortSignal:o,prefetchCacheKey:r,headers:i}=e;return(0,h().updateLoadCachedPageChunkCalledAt)(),g().isConnected()||g().isConnecting()?d().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:n,abortSignal:o,prefetchCacheKey:r,headers:i}):d().callApi({eventName:"loadPageChunkV2",environment:t,data:n,abortSignal:o,prefetchCacheKey:r,headers:i})}async function T(e){const{mode:t,environment:n,request:c,isFirstChunk:d,abortSignal:g}=e,b={...c,limit:30,cursor:c.cursor||{stack:[]},baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await S().A$(n,{id:c.page.id,table:s().ev}),null!=g&&g.aborted))throw new Error("Abort signal received");const y=a().RecordMapWithRole.create(),h=[];let I=!1;const x=new Set,T=await r().T(b,i().h.fromMonomorphicFunctionUnsafe((async e=>{const o=await m().h7({environment:n,pointer:e,abortSignal:g,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=g&&g.aborted)throw new Error("Abort signal received");if(o)return y.setModelAndRole(e,o.model,o.role),o.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,l().u)(e)&&!x.has(e.id)&&d){if(void 0===k().A.state.offlinePages)return h.push(e),void(I=!0);if(void 0===k().A.state.offlinePages||!v().Bd(c.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);h.push(e)}})),((e,t,n,o)=>{f().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${n})`),null!=o&&o.suppressErrorOnClient&&x.add(t.id)}));if(I&&(await k().A.waitUntil((()=>void 0!==k().A.state.offlinePages)),!v().Bd(c.page.id))){const[e]=h;throw new Error(`Record not found: ${e.table},${e.id}`)}if(h.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:n,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&o().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:c.page.id,missingRecords:h}})})),null!=g&&g.aborted)throw new Error("Abort signal received");return{recordMap:y.toJson(),cursor:T.cursorValue}}async function C(e,t){const n=e.currentUser.id;if(!n||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:n})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),b().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function M(e){if(!y().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=a().RecordMapPolymorphic.create();let n=0;const o=()=>n>=50,r=e=>{"space"!==(null==e?void 0:e.table)&&(o()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),n++))};if(e.isReady())for(const a of(0,I().E)(e))r(a);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);r(t.getModel({table:"notion_user",id:e.userId}));let n=0;for(const e of t.getPointersByTable("notion_user")){if(o()||n>=10)break;n++,r(t.getModel(e))}}const i=Array.from(t).map((e=>{let{pointer:t,value:n}=e;if(void 0!==n)return{pointer:t,version:n}})).filter(c().O9);return i.length?i:void 0}},663199:(e,t,n)=>{n.d(t,{W:()=>i});var o=()=>n(970013),r=()=>n(72135);function i(e){let{intl:t,propertySchema:n,value:i}=e,a=r().C4;return n&&(0,o().AM)(n)&&(a=n.number_format??r().C4),r().ZV(i,a,t)}},673898:(e,t,n)=>{n.d(t,{A:()=>r});class o extends(()=>n(757695))().default{getInitialState(){return{active:!1,stringValue:""}}}const r=new o},725649:(e,t,n)=>{function o(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>o,j6:()=>i})},754199:(e,t,n)=>{function o(e){return/^(\+\d{1,2}[\s.-])?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}function r(e){return/^[0-9 .()\-\+]{7,}$/.test(e)}n.d(t,{W:()=>o,e:()=>r})},813743:(e,t,n)=>{n.d(t,{O8:()=>F,Yf:()=>P,fS:()=>B});var o=()=>n(221844),r=()=>n(496506),i=()=>n(700500),a=()=>n(792071),s=()=>n(861017),l=()=>n(179034),c=()=>n(197959),d=()=>n(161479),u=()=>n(919709),p=()=>n(534177),m=()=>n(246826),f=()=>n(778417),g=()=>n(725614),b=()=>n(780054),v=()=>n(97270),k=()=>n(299545),y=()=>n(906537),h=()=>n(110955),S=()=>n(487494),I=()=>n(176106),x=()=>n(525112),T=()=>n(375447),C=()=>n(630116),M=()=>n(292167),w=()=>n(437219),_=()=>n(722101),A=()=>n(666144),R=()=>n(319975),D=()=>n(751156);function P(e){const{environment:t,textStore:n,blockStore:i,url:a,oldTextValue:u,urlSelection:p}=e;if(h().A.state.open||v().A.state.open||T().A.state.open||I().A.state.open)return!1;const m=y().get();if(!m)return!1;const f=y().getRect(m);if(!f)return!1;const g=(0,s().parseRoute)({url:a,baseUrl:b().A.domainBaseUrl,publicDomainName:b().A.publicDomainName,isMobile:t.device.isMobile,protocol:b().A.protocol,currentUrl:window.location.href});if("page"===g.name&&Boolean(g.discussionId)&&g.discussionId){const e=g.discussionId,s=g.blockId;if(!s)return!1;const m=i.getParentBlockStore();if(!m)return!1;const b=(0,C().Oo)(m,{table:l().ev,id:s,spaceId:(0,d().e)(m.pointer.spaceId)}),v=(0,C().Oo)(b,{table:c().$Y,id:e,spaceId:(0,d().e)(i.pointer.spaceId)});if("none"===v.getRole())return!1;const y=new(r().default)((()=>k().wc(v)[0]),{debugName:"firstCommentStore"}),h=new(o().A)({name:"internalUnfurlingMenuActions.activate",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(h);const I=i.clone(h),T=n.clone(h),M=m.clone(h);return x().A.setState({args:{commentStore:y},stores:{blockStore:i,textStore:n,parentStore:m},temporaryStores:{blockStore:I,textStore:T,parentStore:M},temporaryRecordCache:h,focusedIndex:S().A.Preview,selectionRect:f,oldTextValue:u,open:!0,url:a,urlSelection:p}),w().wQ(t,{url:a}),!0}return!1}function B(e){const{actionType:t,environment:n,commentStore:o,useTempStores:r}=e,i=x().A.state;if(!i.open)return;const{oldTextValue:s}=i,l=r?i.temporaryStores:i.stores,{textStore:c,blockStore:m,parentStore:b}=l,v=n.currentUser.id;if(v){if(r){i.temporaryRecordCache.clearCache();for(const e in i.temporaryStores){const t=i.temporaryStores[e],o={userId:v,pointer:t.pointer},r=n.defaultRecordCache.inMemoryRecordCache.getRecord(o);r?A().PC({environment:n,inMemoryRecordCache:i.temporaryRecordCache,pointer:t.pointer,model:a().Bj6.fromValue(t.pointer.table,r.value),role:r.role,updatePaths:[[]],userId:v,force:!0,debugSource:"setUnfurlType"}):A().oX({environment:n,inMemoryRecordCache:i.temporaryRecordCache,persistedRecordCache:void 0,pointer:t.pointer,userId:v})}}else n.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i.temporaryRecordCache);switch(t){case S().A.Link:f().hc({environment:n,store:i.stores.blockStore}),g().setSelection({store:i.stores.textStore,selection:{startIndex:i.urlSelection.endIndex,endIndex:i.urlSelection.endIndex}}),x().A.setState({...i,focusedIndex:S().A.Link});break;case S().A.Mention:if(!o)return;const e=(0,d().e)(c.pointer.spaceId);if(!e)return;const r=o.id;D().createAndCommit({environment:n,userAction:"internalUnfurlingMenuActions.mention",canUndo:!0,perform:t=>{R().R9({environment:n,store:c,value:s,transaction:t}),R().Gf({environment:n,editorMode:"default",store:c,selection:{startIndex:i.urlSelection.startIndex,endIndex:i.urlSelection.startIndex},annotation:u().hiQ(r,e),transaction:t,analyticsFrom:"block"})}}),x().A.setState({...i,focusedIndex:S().A.Mention});break;case S().A.Preview:if(!o)return;D().createAndCommit({environment:n,userAction:"internalUnfurlingMenuActions.preview",canUndo:!0,perform:e=>{R().R9({environment:n,store:c,value:s,transaction:e});const t=k().eK(o);if(!t)return;if(!k().No(t)||!b||!t.getParentId())return;const r=M().s({environment:n,parentBlockStore:b,targetStore:o,transaction:e});if(_().WH({parentStore:b.getContentStore(),insertStore:r,afterStore:m,transaction:e}),0===u().q4_(i.oldTextValue).trim().length){const t=C().Bv.createChildStore(b.getContentStore(),i.stores.blockStore.pointer);_().TF({parentStore:b.getContentStore(),childToRemoveStore:t,transaction:e})}}}),x().A.setState({...i,focusedIndex:S().A.Preview});break;default:throw(0,p().HB)(t)}r||x().A.setState({open:!1})}}function F(e){var t,n;const{blockStore:o,transaction:r}=e,a=o.getType(),s=o.getFormat(),l=o.getSpaceId();if(!o.isDefined()||a!==i().xd.alias||null==s||null===(t=s.alias_pointer)||void 0===t||!t.id)return;const c=[u().wmz(u().hiQ(null==s||null===(n=s.alias_pointer)||void 0===n?void 0:n.id,l))];m().zv({store:o,data:{type:i().xd.text},transaction:r}),m().zv({store:o.getFormatStore(),data:{alias_pointer:null},transaction:r}),R().R9({environment:o.environment,store:o.getBlockTitleStore(),value:c,transaction:r})}},856197:(e,t,n)=>{n.d(t,{z:()=>S});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(581454);var o=()=>n(764880),r=()=>n(713998),i=()=>n(869190),a=()=>n(604995),s=()=>n(663199),l=()=>n(683259),c=()=>n(128713),d=()=>n(792071),u=()=>n(142748),p=()=>n(179034),m=()=>n(919709),f=()=>n(931075);const g=i().ZF;function b(e){return(0,l().vy)({...e,fromString:e=>e}).join("")}function v(e){const{textValue:t}=e;if(t){const n=[];for(const o of t)m().bHQ(o)||n.push(b({...e,textValue:[o]}));return n.join(", ")}return""}const k={[m().Ifu.Page]:e=>{let{annotation:t,exportArgs:n}=e;const{getExportedPathToPage:o}=n,r=m().v55(t),i=(0,l()._z)({intl:n.intl,blockId:r,getRecordValue:n.getRecordValue,userTimeZone:n.userTimeZone}),a=o({toPageId:r});if(i&&a)return`${i} (${a})`},[m().Ifu.SlackSpecialMention]:e=>{let{annotation:t,exportArgs:n}=e;return`@${m().p5C(t)}`},[m().Ifu.CustomEmoji]:e=>{let{annotation:t,exportArgs:n}=e;const{getRecordValue:o}=n,r=m().qS0(t);if(!r)return;const i=d().b4_.fromGetRecordValueFn(o)(r);return i?i.getRenderTitle():void 0},[m().Ifu.Comment]:e=>{let{annotation:t,exportArgs:o}=e;const{getRecordValue:r,baseUrl:i}=o,a=d().b4_.fromGetRecordValueFn(r),s=m().MdE(t);if(!s)return;const l=a(s);if(!l)return;const c=l.getParentId(),p=l.getParentPointer(),f=(0,u().NJ)((0,u().Yn)(p,r));if(!f)return;const g=a(p);let b;if(g){const e=a(g.getParentPointer());b=e&&"table_row"===e.getType()?e.getParentId():g.getParentId()}return(0,n(921940).A)({pageId:f.id,scrollToBlockId:b,pageValue:f,baseUrl:i,discussionId:c,pageVisitSource:n(584262).y8.Export})},[m().Ifu.Link]:e=>{let{annotation:t,exportArgs:o}=e;const{getExportedPathToFile:r,getExportedPathToPage:i,navigableBlockId:a,baseUrl:s,publicDomainName:l}=o,c=m().cQR(t),d=(0,n(777447).lX)({url:c,baseUrl:s,publicDomainName:l});return d?i({toPageId:d}):r({fromBlockId:a,toFileURI:c})},[m().Ifu.User]:e=>{let{annotation:t,exportArgs:o}=e;const{intl:r}=o,i=m().NcG(t),a=o.getRecordValue({table:n(798880).oo,id:i});if(a)return`@${(0,n(695608).c6)(r,a)}`},[m().Ifu.Bot]:e=>{let{annotation:t,exportArgs:o}=e;const r=m().vjW(t),i=o.getRecordValue({table:n(824862).GP,id:r});if(i)return`@${(0,n(799288).Hg)(i)}`},[m().Ifu.Group]:e=>{let{annotation:t,exportArgs:n}=e;const o=(0,l().Pf)({annotation:t,exportArgs:n});if(o)return o},[m().Ifu.Team]:e=>{let{annotation:t,exportArgs:n}=e;const o=(0,l().nZ)({annotation:t,exportArgs:n});if(o)return o},[m().Ifu.ExternalObjectInstance]:e=>{var t;let{annotation:n,exportArgs:o}=e;const r=m().T$c(n);return null===(t=o.getRecordValue({table:p().ev,id:r,spaceId:o.root.spaceId}))||void 0===t||null===(t=t.format)||void 0===t?void 0:t.original_url},[m().Ifu.LinkMention]:e=>{let{annotation:t,exportArgs:n}=e;const{href:o}=m().q1R(t);return o},[m().Ifu.Date]:e=>{let{annotation:t,exportArgs:n}=e;const{date_format:o,time_format:r,...a}=m().K7D(t);return`@${(0,i().ZF)({value:a,date_format:o,time_format:r,userTimeZone:n.userTimeZone,allowRelativeDates:!1,intl:n.intl})}`},[m().Ifu.Equation]:e=>{let{annotation:t,exportArgs:n}=e;const o=(0,c().TG)(t),r=(0,c().oV)(t,n.getExportedPathToPage,n);return`${o}${m().U35(t)}${r}`},[m().Ifu.Bold]:l().if,[m().Ifu.Italic]:l().if,[m().Ifu.Strike]:l().if,[m().Ifu.Code]:l().if,[m().Ifu.Highlight]:l().if,[m().Ifu.Discussion]:l().if,[m().Ifu.Underline]:l().if,[m().Ifu.Inserted]:l().if,[m().Ifu.Deleted]:l().if,[m().Ifu.TemporaryComment]:l().if,[m().Ifu.TemporaryCursor]:l().if,[m().Ifu.TemporaryEquation]:l().if,[m().Ifu.TemporaryPage]:l().if,[m().Ifu.TemporaryInput]:l().if,[m().Ifu.TemporarySelection]:l().if,[m().Ifu.TemporaryFindHighlight]:l().if,[m().Ifu.TemporarySelectedFindHighlight]:l().if,[m().Ifu.TemplateVariable]:l().if,[m().Ifu.FormulaPageProperty]:l().if,[m().Ifu.FormulaContextValue]:l().if,[m().Ifu.FormulaError]:l().if,[m().Ifu.Citation]:l().if,[m().Ifu.SuggestionInsertText]:l().if,[m().Ifu.SuggestionRemoveText]:l().if,[m().Ifu.SuggestionAnnotate]:l().if,[m().Ifu.SuggestionUnannotate]:l().if,[m().Ifu.TemporaryNativeMABFilter]:l().if,[m().Ifu.TemporaryDictation]:l().if,[m().Ifu.TemporaryHighlight]:l().if,[m().Ifu.AssistantInstructionsCollection]:l().if,[m().Ifu.TemporaryCommentHighlight]:l().if,[m().Ifu.TemporarySuggestionUnderline]:l().if,[m().Ifu.GeoPoint]:l().if};function y(){}function h(){return Promise.resolve(void 0)}const S={blockRenderers:{text:y,encrypted_text:y,header:y,sub_header:y,sub_sub_header:y,quote:y,bulleted_list:y,toggle:y,to_do:y,numbered_list:y,code:y,page:y,image:y,video:y,embed:y,bookmark:y,file:y,tweet:y,maps:y,gist:y,framer:y,invision:y,mixpanel:y,drive:y,figma:y,loom:y,pdf:y,typeform:y,codepen:y,audio:y,divider:y,equation:y,collection_view:y,collection_view_page:y,column_list:y,column:y,factory:y,copy_indicator:y,breadcrumb:y,link_to_collection:y,link_to_page:y,table_of_contents:y,callout:y,whimsical:y,miro:y,abstract:y,sketch:y,excalidraw:y,replit:y,alias:y,transclusion_container:y,transclusion_reference:y,external_object_instance:y,table:y,table_row:y,tab:y,hex:y,deepnote:y,external_object_instance_page:y,button:y,ai_block:y,drawing:y,slide:y,personal_home_page:y,form:y,post:y,workflow:y,transcription:y,person_profile:y},asyncBlockRenderers:{text:h,encrypted_text:h,header:h,sub_header:h,sub_sub_header:h,quote:h,bulleted_list:h,toggle:h,to_do:h,numbered_list:h,code:h,page:h,image:h,video:h,embed:h,bookmark:h,file:h,tweet:h,maps:h,gist:h,framer:h,invision:h,mixpanel:h,drive:h,figma:h,loom:h,pdf:h,typeform:h,codepen:h,audio:h,divider:h,equation:h,collection_view:h,collection_view_page:h,column_list:h,column:h,factory:h,copy_indicator:h,breadcrumb:h,link_to_collection:h,link_to_page:h,table_of_contents:h,callout:h,whimsical:h,miro:h,abstract:h,sketch:h,excalidraw:h,replit:h,alias:h,transclusion_container:h,transclusion_reference:h,external_object_instance:h,table:h,table_row:h,tab:h,hex:h,deepnote:h,external_object_instance_page:h,button:h,ai_block:h,drawing:h,slide:h,personal_home_page:h,form:h,post:h,workflow:h,transcription:h,person_profile:h},annotationRenderers:k,propertyRenderers:{title:e=>b(e),text:b,select:e=>{const{textValue:t,propertySchema:n}=e,o=n.options||[];return r().L3(t,o)},multi_select:e=>{const{textValue:t,propertySchema:n}=e,o=n.options||[],i=r().o2(t,o);return i.sort(),i.join(", ")},status:e=>{const{textValue:t,propertySchema:n}=e;return r().RZ(t,n)},relation:e=>{const{textValue:t,propertySchema:n,exportArgs:o}=e;if("relation"!==n.type)return;const i=r().bG({relationValue:r().n(t),getRecordModel:d().b4_.fromGetRecordValueFn(o.getRecordValue),propertySchema:n,includeNoAccess:!0}),a=r().Ap(i);return v({...e,textValue:a})},rollup:e=>{const t=e.exportArgs.getRecordValue,o=e.exportArgs.formulasModule,r=d().Bj6.fromValue(p().ev,e.block),i=d().b4_.fromGetRecordValueFn(t);return n(568063).I({...e,block:r,getRecordModel:i,collectionRequestContext:{userId:void 0,userTimeZone:e.exportArgs.userTimeZone,depth:0,intl:e.exportArgs.intl,visitedProperties:new Set,resultCache:e.exportArgs.resultCache,regExpCache:e.exportArgs.regExpCache,experimentService:e.exportArgs.experimentService,collectionFeatureGates:e.exportArgs.collectionFeatureGates},formulasModule:o})},url:e=>{let{textValue:t}=e;return m().k4p(t)},email:e=>{let{textValue:t}=e;return m().k4p(t)},phone_number:e=>{let{textValue:t}=e;return m().k4p(t)},checkbox:e=>{let{textValue:t}=e;return r().wu(t)?"Yes":"No"},person:e=>{let{textValue:t,exportArgs:o,propertySchema:i,block:a}=e;const{intl:s}=o,l=d().Bj6.fromBlock(a),c=r().e5({textValue:t,propertySchema:i,blockCreatorPointer:l.getCreatedByPointer()});return n(496603).oE(c.map((e=>{const t=o.getRecordValue(e),n=t&&d().Bj6.fromValue(e.table,t);return null==n?void 0:n.getDisplayName(s)}))).join(", ")},number:e=>{let{exportArgs:t,property:o,schema:i,textValue:a}=e;const l=i[o],c=r().Me(a);if(!(0,n(534177).O9)(c))return;let d=!0;var u;l&&(0,n(970013).AM)(l)&&(d=(null===(u=l.show_as)||void 0===u?void 0:u.showValue)??!0);return d?(0,s().W)({intl:t.intl,propertySchema:l,value:c}):void 0},date:e=>{let{textValue:t,propertySchema:o,...r}=e;const a=r.exportArgs.userTimeZone,s=(0,n(787626).b)(t),{date_format:l,time_format:c}=o;if(s)return(0,i().ZF)({allowRelativeDates:!1,value:s,date_format:l,time_format:c,userTimeZone:a,intl:r.exportArgs.intl,displayInUserTimezone:r.exportArgs.displayInUserTimezone??!1,alwaysIncludeTimezone:!0})},file:v,formula:e=>{const{property:t,schema:o,block:r,exportArgs:i}=e,{userTimeZone:a,getRecordValue:l,intl:c,resultCache:u,regExpCache:p,formulasModule:m}=i;if(!m)return;const f=o[t],b=m.primitiveFormulaValueFromPropertySchema({schema:o,property:t,blockModel:d().Bj6.fromBlock(r),getRecordModel:d().b4_.fromGetRecordValueFn(l),intl:c,userTimeZone:a,depth:0,resultCache:u,regExpCache:p,experimentService:i.experimentService,collectionFeatureGates:i.collectionFeatureGates});return"boolean"==typeof b?b?"Yes":"No":(0,n(720665).Et)(b)?(0,s().W)({intl:i.intl,propertySchema:f,value:b}):(0,n(597777).kC)(b)?g({value:b,userTimeZone:a,allowRelativeDates:!1,intl:i.intl}):b},created_time:e=>{const{block:t,exportArgs:n}=e,{userTimeZone:o}=n;if(t.created_time)return g({allowRelativeDates:!1,value:(0,a().KQ)(t.created_time,o),userTimeZone:o,intl:n.intl})},last_edited_time:e=>{const{block:t,exportArgs:n}=e,{userTimeZone:o}=n;if(t.last_edited_time)return g({allowRelativeDates:!1,value:(0,a().KQ)(t.last_edited_time,o),userTimeZone:o,intl:n.intl})},created_by:e=>{const{block:t,exportArgs:n}=e,{getRecordValue:r,intl:i}=n;if(t.created_by_table&&t.created_by_id){const e=(0,o().xC)({getRecordValue:r,pointer:{table:t.created_by_table,id:t.created_by_id,spaceId:t.space_id}});if(e.asActor)return(0,o().lR)(i,e)}},last_edited_by:e=>{const{block:t,exportArgs:n}=e,{getRecordValue:r,intl:i}=n;if(t.last_edited_by_table&&t.last_edited_by_id){const e=(0,o().xC)({getRecordValue:r,pointer:{table:t.last_edited_by_table,id:t.last_edited_by_id,spaceId:t.space_id}});if(e.asActor)return(0,o().lR)(i,e)}},button:e=>"",auto_increment_id:e=>{let{textValue:t,block:o,exportArgs:i}=e;const a=r().On(t),{getRecordValue:s}=i;if(void 0!==a){const e=d().Bj6.fromBlock(o),t=e.getParentTable();if(t!==n(519831).Vl)return;const r=s((0,n(835243).aZ)({spaceId:e.getSpaceId(),parentTable:t,parentId:e.getParentId()}));return(0,n(716016).H4)(null==r?void 0:r.record_key,a)}},last_visited_time:e=>"",location:e=>"",verification:e=>{let{textValue:t,exportArgs:n}=e;const o=f().U1(t);if(!o)return"";const r=f().B2(o);return n.intl.formatMessage(f().D6(r.type))},geo_point:()=>""}}}}]);