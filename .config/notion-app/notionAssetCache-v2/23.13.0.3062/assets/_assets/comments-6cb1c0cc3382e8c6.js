"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[37125],{213806:(e,t,o)=>{o.r(t),o.d(t,{Comment:()=>Xe,CommentFileBlock:()=>To().A,Discussion:()=>Rt,DiscussionIndicator:()=>Tt().Ay,DiscussionInput:()=>Je().A,DiscussionReactionBar:()=>ye().tx,MOBILE_REACTION_PILL_STYLE_OVERRIDES:()=>ye().ZR,MarginCommentsSection:()=>So,NewDiscussionMenu:()=>Bo,PropertyDiscussionIndicator:()=>Nt,REACTION_PILL_STYLE:()=>ye().Of,ReactionBar:()=>ye().Ay,ReplyDiscussionMenu:()=>Ro,SuggestionContext:()=>Bt,discussionHelpers:()=>_(),discussionViewActions:()=>s,reactionActions:()=>Fo()});var s={};o.r(s),o.d(s,{isCommentUnread:()=>nt});o(898992),o(354520);var n=o(296540),i=()=>o(908006),r=()=>o(484714),a=()=>o(792485),l=()=>o(790748),c=()=>o(847249),d=()=>o(401497),u=()=>o(68263),m=()=>o(919709),p=()=>o(959013),g=()=>o(284371),h=()=>o(112873),f=()=>o(901389),x=()=>o(620689),v=()=>o(725614),S=()=>o(751156),C=()=>o(260414),b=()=>o(331542),y=()=>o(719147),k=()=>o(447587),A=()=>o(709438),w=()=>o(299545),j=()=>o(424746),I=()=>o(372154),L=()=>o(230062),B=()=>o(630116),D=()=>o(789557),M=()=>o(902731),R=()=>o(848565),_=()=>o(493319);function T(e){return e.isFirstComment&&"comment_unfurl"!==e.discussionLocation&&"post_top_level_discussion"!==e.discussionLocation}var F=()=>o(404783),E=()=>o(555776),P=(o(944114),()=>o(584262)),U=()=>o(700500),K=()=>o(526278),N=()=>o(29037),O=()=>o(671089),H=()=>o(66913),W=()=>o(30626),V=()=>o(742852),z=()=>o(863522),$=()=>o(105819),G=()=>o(350124),J=o(474848);const X=(0,o(340498).wt)("reopen",{viewBox:"0 0 14 14",svg:(0,J.jsx)("path",{d:"M1.64844 7.88477C1.64844 10.791 3.98047 13.1289 6.88086 13.1289C9.78125 13.1289 12.1133 10.791 12.1133 7.88477C12.1133 7.53906 11.873 7.29297 11.5273 7.29297C11.1934 7.29297 10.9707 7.53906 10.9707 7.88477C10.9707 10.1582 9.14844 11.9805 6.88086 11.9805C4.61328 11.9805 2.79688 10.1582 2.79688 7.88477C2.79688 5.59961 4.60156 3.78906 6.86328 3.78906C7.25 3.78906 7.60742 3.81836 7.90625 3.88281L6.3125 5.46484C6.20703 5.57617 6.1543 5.69922 6.1543 5.85156C6.1543 6.17383 6.39453 6.41992 6.71094 6.41992C6.875 6.41992 7.00977 6.36719 7.10938 6.26172L9.51758 3.83594C9.64062 3.71289 9.69922 3.57227 9.69922 3.41406C9.69922 3.26172 9.63477 3.10938 9.51758 2.99219L7.10938 0.548828C7.00977 0.4375 6.875 0.378906 6.71094 0.378906C6.39453 0.378906 6.1543 0.636719 6.1543 0.953125C6.1543 1.10547 6.20703 1.24023 6.30664 1.3457L7.72461 2.74609C7.4668 2.69336 7.16797 2.66406 6.86328 2.66406C3.96875 2.66406 1.64844 4.98438 1.64844 7.88477Z"})});var Y=()=>o(483690),Q=()=>o(236262),Z=()=>o(798880),q=()=>o(496603),ee=()=>o(534177),te=()=>o(884107),oe=()=>o(760217),se=()=>o(406699),ne=()=>o(285790),ie=()=>o(928600),re=()=>o(939740),ae=()=>o(8980),le=()=>o(89924),ce=()=>o(859428),de=()=>o(962036),ue=()=>o(780054),me=()=>o(38337),pe=()=>o(722872),ge=()=>o(108944),he=()=>o(836251),fe=()=>o(963589),xe=()=>o(351360),ve=()=>o(508496),Se=()=>o(725332);o(581454);var Ce=()=>o(249349),be=()=>o(413962),ye=()=>o(138873);const ke=(0,p().YK)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function Ae(e){const{discussionLocation:t,isFirstComment:o,blockStore:s,discussionStore:i}=e,l=(0,p().tz)(),d=(0,r().v3)(),m=d.device,g=(0,n.useRef)(null),f=(0,a().S)(),x=(0,c().K8)((()=>Boolean(i.getResolved())),[i]),v=(0,c().K8)((()=>e.store.isDefined()),[e.store]),C=(0,c().K8)((()=>{var e;return null===(e=xe().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),b=(0,c().K8)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===Z().oo&&C===t}),[C,e.store]),y=(0,c().K8)((()=>{var e;const t=null===(e=xe().default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&u().Km(t)}),[]),k=(0,c().K8)((()=>s.getRole()),[s]),A=(0,c().K8)((()=>{var e;return null==f||null===(e=f.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==f?void 0:f.publicEditModeStore]),{isFirstCommentOfSuggestionDiscussion:w,disableAccept:j}=(0,c().K8)((()=>{var t;const o="suggestion"===i.getType()&&i.getCommentPointers()[0].id===e.store.id,n=(null===(t=s.getNavigableBlockStore())||void 0===t?void 0:t.canEdit())??!1;return{isFirstCommentOfSuggestionDiscussion:o,disableAccept:o&&!n}}),[i,s,e.store]),I=(0,c().K8)((()=>s.pathIsDead()),[s]),L=(0,c().K8)((()=>T({isFirstComment:o,discussionLocation:t})),[o,t]),B="comment_only"===k||"comment"===A,M=(0,fe().X)("comment_sidebar_for_you"),R=(0,c().K8)((()=>i.isUnread(ve().default.getConfigKey("assume_comment_read","last_seen_at"))),[i]),_=(0,n.useCallback)((()=>S().createAndCommit({userAction:"Comment.markDiscussionRead",environment:d,canUndo:!0,perform:e=>(0,Se().U)({transaction:e,discussionStore:i})})),[d,i]),F=(0,n.useCallback)((()=>S().createAndCommit({userAction:"Comment.markDiscussionUnread",environment:d,canUndo:!0,perform:e=>function(e){const{transaction:t,discussionStore:o}=e,s=o.userId;if(!s)return;const n=o.getCommentStores().map((e=>e.getCreatedTime())),i=n.length?Math.max(...n):void 0,r=o.getUserSeenRecordStore(s);return S().applyOperation({store:r,operation:{pointer:r.pointer,path:[],command:"update",args:{user_id:s,space_id:r.pointer.spaceId,parent_id:o.id,parent_table:o.table,last_seen_at:i?i-1:void 0}},transaction:t}),o}({transaction:e,discussionStore:i})})),[d,i]);if(!v||!C)return null;const E=()=>{S().createAndCommit({userAction:"Comment.handleReopen",environment:d,canUndo:!0,perform:t=>{D().E3({environment:d,commentStore:e.store,discussionStore:i,transaction:t,discussionLocation:e.discussionLocation})}})},H=t=>{S().createAndCommit({userAction:"Comment.handleResolve",environment:d,canUndo:!0,perform:t=>{(0,Ce().j)({environment:d,commentStore:e.store,discussionStore:i,transaction:t,discussionLocation:e.discussionLocation})}}),h().UP(),null==t||t.stopPropagation()},W=()=>{S().createAndCommit({userAction:"Suggestion.handleAccept",environment:d,canUndo:!0,perform:t=>{be()._3({action:"accept",environment:d,commentStore:e.store,discussionStore:i,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:ge().fA(i)})}}),h().UP()},G=()=>{S().createAndCommit({userAction:"Suggestion.handleReject",environment:d,canUndo:!0,perform:t=>{be()._3({action:"reject",environment:d,commentStore:e.store,discussionStore:i,transaction:t,discussionLocation:e.discussionLocation,currentPageStore:ge().fA(i)})}}),h().UP()},X=async()=>{var t,o;const s=e.store.getParentStore();if(!s||null==s||!s.isDefined())return null;let n=s.getParentStore();if(null===(t=n)||void 0===t||!t.isDefined())return null;var i;n.getType()===U().xd.tableRow&&(n=null===(i=n)||void 0===i?void 0:i.getParentBlockStore());if(null===(o=n)||void 0===o||!o.isDefined())return null;const r=n.getModel().getRenderUrl({baseUrl:ue().A.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:s.id,pageVisitSource:P().y8.CopyLink}),a=await te().R.clipboardActions.load();a.copyString({environment:d,stringValue:r,copiedMessage:a.clipboardMessages.copiedLinkToClipboard})};if(!d.currentUser.isLoggedIn())return null;const Y=k&&u().h9(k)||I;if(Y)return null;const ne=L&&!m.isMobile&&!B&&!Y,ce=[];m.isMobile&&!B&&!Y&&e.isFirstComment&&(x?ce.push("reopen"):ce.push("resolve")),!w&&b&&ce.push("edit"),o&&(ce.push("copyLink"),M&&(R?ce.push("markDiscussionRead"):ce.push("markDiscussionUnread"))),w||!b&&!y||ce.push("delete");const ke=ce.length>0;return ke||ne||e.canShowReactions?(0,J.jsx)(se().Ay,{ref:g,popupType:m.isMobile?se().z7.BottomSheet:se().z7.Popup,bottomSheetInitialState:"half",buttonPopupStore:e.buttonPopupStore,placementToOrigin:se().sx.Right,stopClickPropagation:!0,renderOrigin:o=>(0,J.jsx)(Ie,{buttonConfig:{resolve:{visible:ne&&!w,resolved:x,onResolve:H,onReopen:E},react:{visible:e.canShowReactions,onReact:()=>{var o;(0,ye().uJ)(d,l,e.store,(null===(o=g.current)||void 0===o?void 0:o.getAnchor())??null,t,e.handleReaction)}},accept:{visible:w&&!j&&!x,onAccept:W},reject:{visible:w&&!x&&(!B||b),onReject:G},moreActions:{visible:ke}},visible:e.visible,buttonPopupEvents:o,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=m.isMobile?{menuType:pe().gu.Modal,title:(0,J.jsx)(p().sA,{id:"comment.mobileCommentMenu.title",defaultMessage:"Comment"})}:{menuType:pe().gu.Popup};const s=ce.map((t=>"reopen"===t?{key:"reopen",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:K().w}),title:(0,J.jsx)(p().sA,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:E}:"resolve"===t?{key:"resolve",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:N().checkmarkIcon}),title:(0,J.jsx)(p().sA,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>H()}:"edit"===t?{key:"edit",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:$().pencilLineIcon}),title:(0,J.jsx)(p().sA,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:Q().trashIcon}),title:(0,J.jsx)(p().sA,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:V().w}),title:(0,J.jsx)(p().sA,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:X}:"markDiscussionRead"===t?{key:"markDiscussionRead",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:O().checkmarkCircleIcon}),title:(0,J.jsx)(p().sA,{id:"comment.markDiscussionRead.button",defaultMessage:"Mark as read"})}),action:_}:"markDiscussionUnread"===t?{key:"markDiscussionUnread",render:e=>(0,J.jsx)(oe().A,{...e,icon:(0,J.jsx)(ae().I,{icon:z().C}),title:(0,J.jsx)(p().sA,{id:"comment.markDiscussionUnread.button",defaultMessage:"Mark as unread"})}),action:F}:void(0,ee().HB)(t)));return(0,J.jsx)("div",{className:me().Jb,children:(0,J.jsxs)(ie().A,{...o,children:[(0,J.jsx)(re().Ay,{type:re().Oh.Vertical,initialFocus:void 0,onAccept:t.close,sections:q().oE([s.length&&{key:0,render:e=>(0,J.jsx)(le().A,{...e}),items:s}])}),!m.isMobile&&(0,J.jsx)(le().A,{topBorder:!0,disableDesktopPadding:!1,children:(0,J.jsx)(de().A,{title:(0,J.jsx)(p().sA,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,he().xS)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function we(e){return"accept"in e}function je(e){return"resolve"in e}function Ie(e){const{buttonPopupEvents:t,buttonConfig:o}=e,s=(0,r().v3)().device,n=(0,p().tz)(),i=(0,d().IS)((t=>({addIcon:{height:21,width:21,fill:t.mediumIconColor},container:{display:"flex",boxShadow:"0px 2px 12px 0px rgba(29, 27, 22, 0.06)",borderWidth:1,borderStyle:"solid",borderColor:t.stroke.secondary,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,right:0,...s.isMobile?{borderRadius:6,top:-3}:{marginRight:0,marginTop:"updates_sidebar"===e.discussionLocation?6:0,opacity:e.visible?1:0,gap:1,borderRadius:6,transition:"opacity 100ms ease-out",zIndex:1,top:-4}}})),[s.isMobile,e.discussionLocation,e.visible]);return(0,J.jsxs)("div",{style:i.container,children:[we(o)&&o.accept.visible&&(0,J.jsx)(ce().A,{renderTooltip:()=>(0,J.jsx)(p().sA,{...ke.acceptButton}),render:e=>(0,J.jsx)(ne().A,{hasBackground:!1,showShadow:!1,icon:Y().q,onClick:o.accept.onAccept,ariaLabel:n.formatMessage(ke.acceptButton),...e})}),we(o)&&o.reject.visible&&(0,J.jsx)(ce().A,{renderTooltip:()=>(0,J.jsx)(p().sA,{...ke.rejectButton}),render:e=>(0,J.jsx)(ne().A,{hasBackground:!1,showShadow:!1,icon:H().V,onClick:o.reject.onReject,iconStyle:{height:18,width:18},ariaLabel:n.formatMessage(ke.rejectButton),...e})}),o.react.visible&&(0,J.jsx)(ce().A,{renderTooltip:()=>(0,J.jsx)(p().sA,{...ke.addReaction}),render:e=>(0,J.jsx)(ne().A,{ariaLabel:n.formatMessage(ke.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,G().s)(i.addIcon),onClick:o.react.onReact,...e})}),je(o)&&o.resolve.visible&&(0,J.jsx)(ce().A,{renderTooltip:()=>(0,J.jsx)(p().sA,{...o.resolve.resolved?ke.reopenButton:ke.resolveButton}),render:e=>(0,J.jsx)(ne().A,{hasBackground:!1,showShadow:!1,icon:o.resolve.resolved?X:Y().q,onClick:o.resolve.resolved?o.resolve.onReopen:o.resolve.onResolve,...e,ariaLabel:n.formatMessage(o.resolve.resolved?ke.reopenButton:ke.resolveButton)})}),o.moreActions.visible&&(0,J.jsx)(ce().A,{renderTooltip:()=>(0,J.jsx)(p().sA,{...ke.moreActions}),render:e=>(0,J.jsx)(ne().A,{...t,...e,hasBackground:!1,showShadow:!1,icon:W()._,ariaLabel:n.formatMessage(ke.moreActions)})})]})}var Le=()=>o(675074),Be=()=>o(24611),De=()=>o(518888),Me=()=>o(489436),Re=()=>o(973753);const _e=3;function Te(e){let{stores:t,collapsed:o,shouldShowGrayFogInScroller:s,onRemoveBlockFromComment:n}=e;return 0===t.length?null:t.length<=_e?(0,J.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,J.jsx)(Me().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:n}},e.id)))}):(0,J.jsx)(Re().A,{shouldShowGrayFog:s,children:t.map((e=>(0,J.jsx)(Me().A,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o,onRemoveBlockFromComment:n}},e.id)))})}var Fe=()=>o(797265),Ee=()=>o(704152);const Pe=3,Ue=4;function Ke(e){let{stores:t,embedBlockLocation:o,onRemoveContent:s}=e;const n=(0,r().v3)();if(0===t.length)return null;if(t.length<=Pe)return(0,J.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,J.jsx)(Ne,{store:e,embedBlockLocation:o,onRemoveContent:s,isLarge:!0},e.id)))});if(t.length<=Ue)return(0,J.jsx)("div",{style:{display:"flex",gap:4},children:t.map((e=>(0,J.jsx)(Ne,{store:e,embedBlockLocation:o,onRemoveContent:s,isLarge:!1},e.id)))});const i=t.slice(0,Ue-1),a=t[Ue-1],l=t.length-Ue+1,c=t.slice(Ue);return(0,J.jsxs)("div",{style:{display:"flex",gap:4},children:[i.map((e=>(0,J.jsx)(Ne,{store:e,embedBlockLocation:o,onRemoveContent:s,isLarge:!1},e.id))),(0,J.jsxs)("div",{children:[(0,J.jsx)(Ee().A,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:g().Wy.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{Fe().iy({environment:n,blockStore:a})},children:`+${l}`}),(0,J.jsx)(Ne,{store:a,embedBlockLocation:o,onRemoveContent:s,isLarge:!1},a.id)]}),(0,J.jsx)("div",{style:{display:"none"},children:c.map((e=>(0,J.jsx)(Ne,{store:e,embedBlockLocation:o,onRemoveContent:s,isLarge:!1},e.id)))})]})}function Ne(e){let{store:t,isLarge:o,embedBlockLocation:s,onRemoveContent:n}=e;const i=(0,d().IS)((e=>({imageShared:{border:`1px solid ${e.stroke.secondary}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,J.jsx)(Be().Ay,{store:t,blockLocation:s,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...i.imageShared,...o?Oe:He},disableActions:!o,onRemoveBlockFromComment:o?n:void 0},t.id)}const Oe={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},He={width:48,height:48,minWidth:48,minHeight:48};var We=()=>o(773382);function Ve(e){let{store:t}=e;const o=(0,c().K8)((()=>De().default.getKeyState(De().default.getBlockKey(t.id))),[t.id]),s=(0,p().tz)(),n=(0,d().IS)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:g().Wy.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!o)return(0,J.jsxs)("div",{style:n.wrapper,children:[(0,J.jsx)("div",{style:n.icon,children:(0,J.jsx)(b().A,{})}),(0,J.jsx)("div",{style:n.fileDetails,children:(0,J.jsx)("div",{style:n.fileName,children:s.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:i,size:r,progressPercent:a,progressText:l}=o;return(0,J.jsxs)("div",{style:n.wrapper,children:[(0,J.jsx)("div",{style:n.icon,children:(0,J.jsx)(b().A,{})}),(0,J.jsx)("div",{style:{overflow:"hidden"},children:(0,J.jsxs)("div",{style:n.fileDetails,children:[(0,J.jsx)("div",{style:n.fileName,children:i}),(0,J.jsxs)("div",{style:n.sizeAndProgressContainer,children:[(0,J.jsx)("span",{style:n.fileSizeText,children:(0,_().formatFileSize)(r)}),(0,J.jsx)("span",{style:n.progressText,children:"—"}),(0,J.jsx)(b().A,{}),a?(0,J.jsx)(We().A,{percentage:a,style:n.progressText}):l?(0,J.jsx)("span",{children:l}):null]})]})})]})}function ze(e){let{stores:t}=e;return 0===t.length?null:(0,J.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,J.jsx)(Ve,{store:e},e.id)))})}function $e(e){const t=e.discussionFormat===_().DiscussionFormat.Sidebar?Le().ZO.SidebarComment:Le().ZO.PageComment,{uploading:o,images:s,embeds:n,files:i}=(0,c().K8)((()=>{const[t,o]=q().jB(e.contentStores,(e=>{const t=Boolean(De().default.getKeyState(De().default.getBlockKey(e.id))),o=(0,Be().x7)(e);return t||!o})),[s,n]=q().jB(o,(e=>e.getType()===U().xd.image)),[i,r]=q().jB(n,(e=>"video"===e.getType()));return{uploading:t,images:s,embeds:i,files:r}}),[e.contentStores]);return 0===o.length&&0===s.length&&0===n.length&&0===i.length?null:(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,J.jsx)(ze,{stores:o}),(0,J.jsx)(Ke,{stores:s,embedBlockLocation:t,onRemoveContent:e.onRemoveContent}),n.length>0&&(0,J.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:n.map((o=>(0,J.jsx)(Be().Ay,{store:o,blockLocation:t,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},o.id)))}),(0,J.jsx)(Te,{stores:i,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===_().DiscussionFormat.Margin||e.discussionFormat===_().DiscussionFormat.Sidebar),onRemoveBlockFromComment:e.onRemoveContent})]})}function Ge(){const e=(0,fe().X)("inbox_page_grouping_notification_style"),t=(0,d().IS)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:g().Wy.semibold,display:"flex",alignItems:"center",margin:0,paddingTop:10,paddingBottom:10,paddingLeft:R().FB},newBarPill:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:R().jw,height:"100%",borderRadius:2,left:R().im,top:-6}})),[]),o=(0,d().IS)((e=>({newBarLine:{height:"0px",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:e.tint.uiBlue,width:"100%",marginLeft:0},newBarWrapper:{color:e.text.secondary,fontSize:10,fontWeight:g().Wy.regular,display:"flex",alignItems:"center",paddingTop:10,paddingBottom:10,paddingLeft:R().FB},newBarPill:{textTransform:"uppercase",height:16,display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,whiteSpace:"nowrap",borderRadius:4,backgroundColor:e.tint.uiBlue,color:e.text.uiBluePrimary,marginLeft:12,marginRight:12},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,width:R().jw,height:"100%",borderRadius:2,left:R().im,top:-6}})),[]),s=e?o:t;return(0,J.jsxs)("div",{style:{position:"relative"},children:[(0,J.jsx)("div",{style:s.threadLine}),(0,J.jsxs)("div",{style:s.newBarWrapper,children:[(0,J.jsx)("div",{style:s.newBarLine}),(0,J.jsx)("div",{style:s.newBarPill,children:e?(0,J.jsx)(p().sA,{id:"comment.newBar.label",defaultMessage:"New"}):(0,J.jsx)(p().sA,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,J.jsx)("div",{style:s.newBarLine})]})]})}var Je=()=>o(640753);const Xe=function(e){const{store:t,discussionContext:s,discussionLocation:P,shouldShowThreadLine:U,discussionStore:K,blockStore:N,collapsed:O}=e,H=(0,r().v3)(),[W,V]=(0,n.useState)(!1),[z,$]=(0,n.useState)(!1),[G,X]=(0,n.useState)(!1),[Y,Q]=(0,n.useState)(!1),[Z,q]=(0,n.useState)("post_top_level_discussion"===P&&O),ee=(0,c().K8)((()=>e.store.isDefined()?new(F().A)(H,e.store.getSpaceId()):void 0),[H,e.store]),te=(0,c().K8)((()=>w().dd(e.store).filter((e=>(0,B().G_)(e,{table:o(179034).ev,id:e.id},"alive").getValue()))),[e.store]),oe=(0,c().K8)((()=>K.getResolved()),[K]),se=(0,c().K8)((()=>null==ee?void 0:ee.state.files),[ee]),ne=(0,c().K8)((()=>null==ee?void 0:ee.state.textStore),[ee]),ie=(0,n.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,o(819121).p)(t)&&$(!0)}),[]),re=(0,n.useCallback)((()=>{$(!1)}),[]),ae=(0,n.useCallback)((()=>{L().A.state||X(!0)}),[]),le=(0,n.useCallback)((()=>{X(!1)}),[]),ce=(0,a().S)(),de=(0,c().uB)(void 0,o(463830).A),ue=(0,c().K8)((()=>de.state.open),[de]),me=(0,o(551619).Sm)(N),pe=(0,c().K8)((()=>(0,o(252833).o7)(e.store.id)),[e.store.id]),ge=(0,c().K8)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),he=(0,c().K8)((()=>{var t;const o=N.getRole(),s=T({isFirstComment:ge,discussionLocation:P}),n=N.pathIsDead(),i=o&&u().h9(o)||n,{device:r}=H,a="comment_only"===o||ce&&"comment"===(null===(t=ce.publicEditModeStore.state)||void 0===t?void 0:t.permission),l=s&&!r.isMobile&&!a&&!i;return G||z||e.hoveringDiscussion&&s||ue||r.isMobile||e.showResolveButtonByDefaultIfPossible&&l}),[N,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,ge,P,H,ce,G,z,ue]),fe=(0,n.useContext)(o(789550).R),xe=(0,c().K8)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:B().Lk.getUserVisibleReactions(t)}:null}),[t]),ve=(0,c().K8)((()=>xe?B().sk.createChildStore(t,xe.createdByPointer):null),[xe,t]),Se=function(e){const{discussionLocation:t,isCommentCollapsed:o,isDiscussionCollapsed:s,maxLines:n}=e;if("post_top_level_discussion"===t)return o?n:void 0;return s?n:void 0}({discussionLocation:P,isCommentCollapsed:Z,isDiscussionCollapsed:O,maxLines:e.maxLines}),Ce=(0,n.useCallback)((()=>{S().createAndCommit({userAction:"Comment.deleteComment",environment:H,canUndo:!0,perform:t=>{D().Tu({environment:H,commentStore:e.store,transaction:t,discussionLocation:P})},skipUpdatingEditedMetadata:!0})}),[H,e.store,P]),be=(0,n.useCallback)((async()=>{const{accept:e}=await f().Gh({message:(0,J.jsx)(p().sA,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,J.jsx)(p().sA,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})});e&&(Ce(),h().UP(),E().A.state.overlapsExistingDiscussionMenu&&!I().A.state.open&&E().A.setState({...E().A.state,overlapsExistingDiscussionMenu:!1}),M().jS(H))}),[Ce,H]),ke=(0,n.useCallback)((async t=>{const o=w().gp(e.store).getValue(),s=w().dd(e.store).filter((e=>e.id!==t.id)),n=o&&o.length>0,i=0===s.length;!n&&i?(await be(),V(!1)):S().createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:H,canUndo:!0,perform:o=>{D().L6({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[H,be,e.store]),we=(0,n.useCallback)((()=>{Q(!0)}),[]),je=(0,n.useCallback)((async()=>{if(!ee)return;const t=w().gp(e.store).getValue()||[],s=ee.state.textStore;S().createAndCommit({userAction:"Comment.handleEditComment",environment:H,canUndo:!0,perform:e=>{o(319975).R9({environment:H,store:s,value:t,transaction:e})}}),V(!0),await i().default.afterNextFlush(),await i().default.afterNextFlush(),v().setSelectionAtEnd({store:s})}),[ee,H,e.store]),Ie=(0,n.useCallback)((async()=>{if(!ee)return!1;if(!(0,_().hasCommentChanged)(ee,e.store))return V(!1),!0;{const{accept:e}=await f().Gh({message:(0,J.jsx)(p().sA,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,J.jsx)(p().sA,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})});if(e)return V(!1),!0}return!1}),[ee,e.store]),Le=(0,n.useCallback)((async()=>{const t=null==ne?void 0:ne.getValue();t&&t.length>0||se&&se.length>0?S().createAndCommit({userAction:"Comment.handleSubmitEdit",environment:H,canUndo:!0,perform:o=>{D().QA({environment:H,store:e.store,text:t||[],transaction:o,discussionLocation:P,files:se||[],property_id:K.getPropertyId(),blockStore:N})}}):await be(),V(!1)}),[ne,se,H,e.store,P,K,N,be]),Be=(0,n.useCallback)((()=>{"post_top_level_discussion"===P&&q(!1)}),[P]),De=(0,n.useRef)(null),Me=(0,n.useRef)(null);(0,l().b)(j().A,(()=>({edit:je,handleCancelEdit:Ie,getNode:()=>De.current,isEditing:()=>W,discussionLocation:P,commentId:e.store.id})),[je,Ie,W,P,e.store.id]);const Re=null==xe?void 0:xe.text,_e=void 0!==Re&&Re.length>0&&m().AhH(Re)>0,Te=_e&&(0,_().isCommentAllEmojis)(Re),Fe=function(e){let{discussionLocation:t,isAllEmojis:o}=e;return(0,d().IS)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0,paddingTop:"comment_unfurl"===t?R().ds:R().e4,paddingRight:"margin_comments"===t?12:16,paddingBottom:R().Wv,paddingLeft:R().SM(t)},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:R().FB},discussionInputContainer:{width:"calc(100% + 8px)"},threadLine:{position:"absolute",backgroundColor:e.stroke.secondary,borderRadius:2,width:R().jw,height:R().k2,left:R().im,top:R().uG},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:"comment_unfurl"===t?g().Wy.medium:void 0,display:"block",marginBottom:-1.5,pointerEvents:"auto"},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,lineHeight:"20px",paddingTop:4,...o?{fontSize:32,lineHeight:"32px"}:{}},attachmentContainer:{display:"flex",alignItems:"center"},commentAttachment:{},authorRowContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},unreadStatusDot:{display:"flex",flexDirection:"row",alignItems:"center",marginRight:4}})),[t,o])}({discussionLocation:P,isAllEmojis:Te}),Ee=(0,n.useMemo)((()=>({type:"comment_match",commentId:e.store.id})),[e.store.id]),Pe="comment_unfurl"!==P,Ue=Pe&&xe&&xe.reactions.length>0;if((0,n.useEffect)((()=>{Y&&Me.current&&Ue&&(x().hT({element:Me.current,environment:H,scrollerContext:fe,vertical:{reveal:"closest"},horizontal:void 0,animate:!0}),Q(!1))}),[H,fe,Y,Ue]),!ee)return null;if(!xe||!ve)return null;const Ke=te.length>0&&(0,J.jsx)("div",{style:Fe.commentAttachment,children:(0,J.jsx)($e,{contentStores:te,onRemoveContent:ke,discussionFormat:(0,_().discussionLocationToDiscussionFormat)(P),collapsed:O,discussionHovered:e.hoveringDiscussion})});return(0,J.jsxs)("div",{ref:De,onClick:e=>W&&e.stopPropagation(),style:Fe.container,children:[e.showNewBar&&(0,J.jsx)(Ge,{}),(0,J.jsxs)("div",{style:Fe.comment,onFocus:ie,onBlur:re,onMouseMove:ae,onMouseLeave:le,children:[(0,J.jsxs)("div",{style:Fe.authorRowContainer,children:[(0,J.jsx)(o(436683).Y,{createdTime:xe.createdTime,lastEditedTime:xe.lastEditedTime,location:P,isResolved:oe,isSuggestionComment:e.isSuggestionComment,authorStore:ve}),e.showUnreadStatusDot&&(0,J.jsx)("div",{style:Fe.unreadStatusDot,children:(0,J.jsx)(A().m,{size:C().jd})})]}),U&&(0,J.jsx)("div",{style:Fe.threadLine}),(0,J.jsxs)("div",{style:Fe.commentElementsBelowUserRow,children:[Boolean(s)&&s,W&&(0,J.jsx)("div",{style:{marginTop:4},children:(0,J.jsx)(Je().A,{containerStyle:Fe.discussionInputContainer,showAvatar:!1,parentStore:e.store,blockStore:N,onCancel:Ie,onSubmit:Le,discussionInputStore:ee,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,_().discussionLocationToDiscussionFormat)(P),canDrop:!0})}),_e&&!W&&(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,J.jsx)(k().A,{onMore:"comment_unfurl"===P?void 0:Be,moreElement:(0,J.jsxs)(y().A,{disableUnderline:!0,style:Fe.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,J.jsx)("span",{children:(0,J.jsx)(p().sA,{id:"comment.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:Se,children:(0,J.jsx)(o(524702).A,{style:Fe.text,store:w().gp(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:Ee})}),me&&pe&&(0,J.jsx)(b().A,{style:{alignSelf:"flex-end",marginRight:8,marginLeft:8}})]}),W||"comment_unfurl"===P?!_e&&(0,J.jsxs)("div",{style:Fe.attachmentContainer,children:[(0,J.jsx)("div",{style:{marginRight:5},children:(0,o(819713).j)(Fe.attachIcon)}),(0,J.jsx)(p().sA,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:te.length},id:"comment.unfurl.attachments.title"})]}):Ke,Ue&&(0,J.jsx)("div",{ref:Me,style:{marginTop:8},children:(0,J.jsx)(ye().Ay,{parentStore:e.store,discussionLocation:P})})]}),"comment_unfurl"!==P&&!W&&!me&&(0,J.jsx)(Ae,{store:e.store,discussionStore:e.discussionStore,blockStore:N,discussionLocation:P,visible:he,isFirstComment:ge,buttonPopupStore:de,canShowReactions:Pe,handleEditComment:je,handleDeleteComment:be,handleReaction:we})]})]})};o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(672577);var Ye=()=>o(601813),Qe=()=>o(220719),Ze=()=>o(478726),qe=()=>o(953418),et=()=>o(756214),tt=()=>o(695625),ot=()=>o(486130),st=()=>o(546574);function nt(e){var t;let{discussionStore:o,commentStore:s}=e;if(!s.isDefined())return!1;const n=null===(t=xe().default.state.currentUserStore)||void 0===t?void 0:t.id;const i=st().A.state.lastInteractionTimes[o.id];if(s.getCreatedById()===n)return!1;const r=function(){if(!o.isDefined()||!n)return 0;const{pageVisitStore:e}=xe().default.state,{lastViewTime:t,lastExitTime:s}=e.state;return s||t}();if(void 0===r)return!1;const a=(0,_().getAndSortCommentStoresByTime)(o).filter((e=>e.getCreatedById()===n)).reverse()[0],l=s.getCreatedTime();return!l||!(a&&l<a.getCreatedTime())&&(!(i&&l<i)&&l>r)}var it=()=>o(641007),rt=()=>o(133033),at=()=>o(693954),lt=()=>o(187485),ct=()=>o(265665);const dt="https://notion.notion.site/AI-Conflict-Detection-158efdeead058037b57efc2b77ad9c21";function ut(e){let{origin:t}=e;const s=(0,d().IS)((e=>({learnMoreLink:{color:e.text.contrastPrimary}})),[]);return(0,J.jsx)(o(292379).B,{origin:t,placementToOrigin:"bottom",tutorialId:"ai-comment-onboarding",tutorialStepId:"ai-comment-onboarding-tooltip",hideActions:!0,hideInsteadOfFlip:!0,header:(0,J.jsx)(p().sA,{id:"AiCommentOnboardingTooltip.header",defaultMessage:"Check for conflicts with Notion AI"}),content:(0,J.jsx)(p().sA,{id:"AiCommentOnboardingTooltip.content",defaultMessage:"Notion AI searches across your workspace and connected apps for conflicting information, using only sources that all members can access. {learnMoreLink}",values:{learnMoreLink:(0,J.jsx)(o(285176).o,{href:dt,style:s.learnMoreLink})}})})}function mt(e){const{discussionLocation:t,commentStore:o}=e,s=(0,c().K8)((()=>{if(!o)return!1;const e=o.getCreatedByPointer();return!!e&&e.id===it().px.id}),[o]),n=(0,r().Y0)(),i=(0,d().IS)((e=>({container:{display:"flex",flexDirection:"row",gap:6,width:"100%",color:e.text.tertiary,fontSize:n.isMobile?g().J.UISmall.mobile:g().J.UISmall.desktop,paddingTop:R().e4,paddingLeft:R().SM(t)+R().eQ-8},warningIcon:{width:10,height:10,alignSelf:"center",display:"inline-block",verticalAlign:"text-bottom"},helpIcon:{color:e.text.tertiary,flexDirection:"row-reverse",gap:6,width:14,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto"},text:{maxWidth:200}})),[n,t]);return s?(0,J.jsxs)("div",{style:i.container,children:[(0,at().Q)(i.warningIcon),(0,J.jsx)(ct().j,{style:i.text,children:(0,J.jsx)(p().sA,{id:"aiCommentHeader.conflictingContent.label",defaultMessage:"Notion AI found potential conflicts"})}),(0,J.jsx)(lt().A,{href:dt,external:!0,style:i.helpIcon,children:(0,rt().$)({width:14,marginRight:4})})]}):null}var pt=()=>o(846583),gt=()=>o(449729),ht=()=>o(651196),ft=()=>o(506327),xt=()=>o(532945);var vt=()=>o(631611),St=()=>o(972435);const Ct=(0,p().YK)({helpful:{id:"assistant.commentFeedback.helpful",defaultMessage:"Helpful"},notHelpful:{id:"assistant.commentFeedback.notHelpful",defaultMessage:"Not helpful"}});function bt(e){const{blockStore:t}=e,s=t.id,n=function(e){const t=(0,r().v3)(),o=(0,c().K8)((()=>{const o=e.getNavigableBlockStore();if(o)return new(B().Gd)(t,{table:ft().bw,id:o.id,spaceId:o.getSpaceId()})}),[t,e]);return(0,c().K8)((()=>{if(!o)return;const t=e.id,s=o.getRelatedContent().find((e=>e.targetId===t));return s?{feedback:xt().A.state[s.inferenceId],inferenceId:s.inferenceId}:void 0}),[o,e.id])}(t),i=null==n?void 0:n.feedback,a=null==n?void 0:n.inferenceId,l=(0,r().v3)(),u=(0,o(47170).O)(),m=(0,d().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:12,width:"100%"},buttonRow:{display:"flex",flexDirection:"row",gap:8}})),[]);return a?(0,J.jsx)(vt().hP,{surface:vt().wy.conflictingContentComment,children:(0,J.jsx)("div",{style:m.container,children:(0,J.jsxs)("div",{style:m.buttonRow,children:[(0,J.jsx)(ht().Ay,{title:St().A.formatMessage(Ct.helpful),variant:"tinted",icon:"thumbs_up"===i?o(886903).x:o(72275).x,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,gt().H8)({environment:l,pageId:e.id,blockId:s,spaceId:u,inferenceId:a,thumbsUpOrDown:"up"})}}),(0,J.jsx)(ht().Ay,{title:St().A.formatMessage(Ct.notHelpful),variant:"tinted",icon:"thumbs_down"===i?o(592834).a:o(317658).Q,onClick:()=>{if(!u||!a)return;const e=t.getNavigableBlockStore();e&&(0,gt().H8)({environment:l,pageId:e.id,blockId:s,spaceId:u,inferenceId:a,thumbsUpOrDown:"down"})}})]})})}):null}const yt={block_menu:"8px 16px 0px",page_discussion:"8px 0px 0px",updates_sidebar:"4px 16px 12px",margin_comments:"8px 12px 6px",comment_unfurl:"0",post_top_level_discussion:"8px 16px 0px",updates_menu_mentions_comments:"4px 16px 12px",updates_menu_all_updates:"4px 16px 12px",updates_menu_archive:"4px 16px 12px",reply_menu_mentions_comments:"8px 16px 0px",reply_menu_all_updates:"8px 16px 0px",reply_menu_archive:"8px 16px 0px",reply_menu_updates_sidebar:"8px 16px 0px",ai_reject_all_suggestions:"0"},kt=n.forwardRef((function(e,t){const s=(0,r().v3)(),{format:i,role:a,showMoreCommentsButton:l,onMoreCommentsClick:m,inputVisible:p,blockStore:g,store:h}=e,f=(0,o(891078).i0)(g),x=a&&u().h9(a)||f,v=s.currentUser.isLoggedIn(),S=(0,n.useRef)(null),C=(0,d().IS)((t=>({container:{position:"relative",padding:0,...i===_().DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}},discussionInputContainer:{padding:yt[e.discussionLocation]},aiFeedbackContainer:{display:"flex",flexDirection:"row",gap:8,marginLeft:"page_discussion"===e.discussionLocation?32:24,padding:yt[e.discussionLocation]}})),[i,e.discussionLocation]),b=(0,c().K8)((()=>{const e=h.getCommentStores()[0];if(!e)return!1;const t=e.getCreatedByPointer();return!!t&&t.id===it().px.id}),[h]);return v&&!x&&(l||p)?(0,J.jsxs)("div",{style:C.container,children:[l&&(0,J.jsx)(o(499512).d,{enableIcon:!0,onClick:m}),p&&(b?(0,J.jsxs)("div",{style:C.aiFeedbackContainer,ref:S,children:[(0,J.jsx)(bt,{blockStore:g,location:e.discussionLocation}),(0,J.jsx)(ut,{origin:S})]}):(0,J.jsx)(Je().A,{autoFocus:!0,showAvatar:!0,containerStyle:C.discussionInputContainer,parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded}))]}):null}));var At=()=>o(493823);function wt(e){const t=(0,d().IS)((t=>{const o=R().SM(e.discussionLocation)+R().eQ;return{moreCommentsWrapper:{color:t.text.tertiary,fontSize:14,flexGrow:1,display:"flex",alignItems:"center",paddingLeft:8},button:{borderRadius:6,fontSize:14,color:t.text.secondary,justifyContent:"space-between",padding:"14px 0",margin:`0 0 0 ${o}px`,width:`calc(100% - ${o}px - 16px)`},buttonHovered:{background:t.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:t.stroke.secondary,width:R().jw,height:"100%",top:R().e4-R().Yz,left:R().SM(e.discussionLocation)+R().im,borderRadius:2}}}),[e.discussionLocation]);return e.count<=0?null:(0,J.jsxs)("div",{style:{position:"relative"},children:[(0,J.jsx)("div",{style:t.threadLine}),(0,J.jsx)(At().p,{isGray:!0,size:"xs",style:t.button,onClick:e.onClick,hoveredStyle:t.buttonHovered,children:(0,J.jsx)("div",{className:"discussion-show-all-button",style:t.moreCommentsWrapper,children:(0,J.jsx)(p().sA,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var jt=()=>o(797809),It=()=>o(712030),Lt=()=>o(921855);function Bt(e){const{discussionStore:t}=e,o=(0,p().tz)(),s=(0,c().K8)((()=>t.isSuggestionDiscussion()),[t]),n=(0,c().K8)((()=>{const t=e.discussionStore.getContext();return(t?(0,Ye().Qe)({discussionContextData:t,discussionId:e.discussionStore.id,discussionType:(0,Qe().o9)(e.discussionStore.getType()),intl:o}):[])??[]}),[e.discussionStore,o]),i=(0,d().IS)((e=>({container:{marginTop:2},label:{color:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},labelDeleteColor:{color:e.text.tertiary},text:{color:e.text.uiBluePrimary,fontSize:14,lineHeight:1.29},textDeleteColor:{color:e.text.secondary},suggestionContextItem:{display:"block",marginBottom:4,whiteSpace:"pre-wrap",wordBreak:"break-word"},unfurlMoreWrapper:{color:e.text.tertiary,fontWeight:g().Wy.medium,display:"block",marginBottom:-1.5,pointerEvents:"auto"}})),[]),r=(0,jt().RX)(o).title;return s&&r&&0!==n.length?(0,J.jsx)("div",{style:i.container,children:(0,J.jsx)(k().A,{maxLines:e.collapsed?1:void 0,clampOverride:{lineHeight:1.29,fontSize:14},moreElement:(0,J.jsxs)(y().A,{disableUnderline:!0,style:i.unfurlMoreWrapper,hoverColor:"blue",children:["…"," ",(0,J.jsx)("span",{children:(0,J.jsx)(p().sA,{id:"suggestion.truncated.showMoreLabel",defaultMessage:"more"})})]}),children:n.map(((e,o)=>{let{label:s,value:n,shouldUseDeleteColor:r,removeQuotationMarks:a}=e;return(0,J.jsxs)("div",{style:i.suggestionContextItem,children:[(0,J.jsxs)("span",{style:{...i.label,...r&&i.labelDeleteColor},children:[s,": "]}),(0,J.jsxs)("span",{style:{...i.text,...r&&i.textDeleteColor},children:[a?null:"“",(0,J.jsx)(Dt,{value:n,discussionStore:t}),a?null:"”"]})]},o)}))})}):null}function Dt(e){let{value:t,discussionStore:o}=e;const s=(0,r().v3)(),n=(0,d().DP)(),i=(0,c().K8)((()=>(0,Lt().S5)({environment:s,textValue:{value:t,spaceId:o.pointer.spaceId},parentStore:o,disableHover:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!0,disabled:!0,theme:n,emojiType:(0,It().FN)(s),katex:s.KatexStore.getKatex(),formulaValueTypes:[]})),[s,t,o,n]);return(0,J.jsx)("span",{children:i})}function Mt(e){const{onDismiss:t}=e,s=(0,n.useRef)(null),a=(0,p().tz)(),u=(0,r().v3)(),g=(0,c().K8)((()=>"suggestion"===e.store.getType()),[e.store]),h=(0,c().K8)((()=>w().wc(e.store)),[e.store]),C=(0,c().K8)((()=>h.filter((e=>e.isDefined())).filter((e=>Boolean(e.getAlive())))),[h]),b="page_discussion"===e.discussionLocation?3:5;(0,n.useEffect)((()=>{C.length===b&&U(!0)}),[C,b]);const y=(0,n.useRef)(e.discussionInputStore||new(F().A)(u,e.store.pointer.spaceId)).current,k=(0,c().K8)((()=>(0,_().inputIsEmpty)(y)),[y]),I=(0,c().K8)((()=>(0,Ze().fc)(e.blockStore)&&!(0,Ze().Cg)(e.blockStore)),[e.blockStore]),M=(0,c().K8)((()=>e.store.getResolved()),[e.store]),[T,E]=(0,n.useState)(!1),[P,U]=(0,n.useState)(void 0!==e.collapsed&&!e.collapsed),[K,N]=(0,n.useState)(!0),O=(0,c().uB)(void 0,o(17090).A),H=(0,c().K8)((()=>O.state.clientRect),[O]),W=e.format===_().DiscussionFormat.Sidebar,V=e.format===_().DiscussionFormat.Margin,z=(0,n.useRef)(null);(0,l().b)(o(143857).A,(()=>({isSidebarFormat:()=>W,isMarginFormat:()=>V,getStore:()=>e.store,getInputStore:()=>y,getNode:()=>z.current,getMarginDiscussionScrollContainer:()=>s.current})),[W,V,e.store,y]);const $=(0,c().K8)((()=>{if(!W)return;return(0,_().getAndSortCommentStoresByTime)(e.store).find((t=>nt({discussionStore:e.store,commentStore:t})))}),[W,e.store]),G=(0,n.useRef)($),X=(0,fe().X)("comment_sidebar_for_you"),Y=(0,c().K8)((()=>X&&function(e){const{discussionStore:t,navigableBlockStore:o}=e;if(!o)return!1;const s=t.userId,n=o.getSpaceId();return Boolean(s&&n&&(0,et().R)({userId:s,blockStore:o,discussionStores:[t],groupIdsUserIsIn:ot()._.getSpacePermissionGroupIds({userId:s,spaceId:n})}).length)}({discussionStore:e.store,navigableBlockStore:e.blockStore.getNavigableBlockStore()})),[X,e.store,e.blockStore]),Q=(0,c().K8)((()=>X&&(Y||e.store.hasEverBeenRead())&&Boolean(e.store.isUnread(ve().default.getConfigKey("assume_comment_read","last_seen_at")))),[X,Y,e.store]),Z=(0,c().K8)((()=>{if(!X)return void 0===G.current?$:G.current;if(!e.store.getSpaceId())return;const t=e.store.getUserSeenRecordStore();if(!t)return;const o=t.getLastSeenAt();if(!o)return $;const s=C.find((e=>e.getCreatedTime()>o));return s||void 0}),[X,$,G,C,e.store]),te=(0,n.useCallback)((()=>{var t;if(P||C.length<=b||"block_menu"===e.discussionLocation)return C;if("page_discussion"===e.discussionLocation)return q().O6(C,1);const o=[e.showAllRepliesAfterTimestamp,null===(t=G.current)||void 0===t?void 0:t.getCreatedTime(),null==$?void 0:$.getCreatedTime()].filter(ee().O9),s=o.length>0?Math.min(...o):void 0;if(s){const e=C.filter((e=>(e.getCreatedTime()||0)>s)),t=C.filter((e=>(e.getCreatedTime()||0)<=s));return t.length<=5?C:[...q().O6(t,2),...e]}return q().O6(C,2)}),[C,$,b,e.discussionLocation,e.showAllRepliesAfterTimestamp,P]),oe=(0,c().K8)((()=>{const t=te(),o=new Set(t.map((e=>e.id))),s=C.filter((e=>!o.has(e.id)));return{commentStores:C,commentsToShow:t,commentsToCollapse:s,reactionsToShow:B().Lk.getUserVisibleReactions(e.store)}}),[C,te,e.store],{useDeepEqual:!0}),se=(0,n.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;const o=(0,Ye().l8)({discussionContextData:t,discussionType:(0,Qe().o9)(e.store.getType()),discussionId:e.store.id,intl:a});return m().JJ$(o,(t=>!m().iQL(t)||m().Orm(t)===e.store.id))}),[e.store,a]),ne=(0,c().K8)((()=>{if(!W)return;return(0,_().getAndSortCommentStoresByTime)(e.store).find((t=>nt({discussionStore:e.store,commentStore:t})))}),[W,e.store]),ie=(0,n.useRef)(null),re=(0,n.useRef)(e.blockStore.clone()).current,ae=(0,d().IS)((t=>({discussionWrapper:{...e.format===_().DiscussionFormat.Page&&{margin:`0px ${R().Ql}px 16px`,..."post_top_level_discussion"===e.discussionLocation&&{marginLeft:-16,marginBottom:oe.reactionsToShow.length>0?0:12}},...e.format===_().DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===_().DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}},reactionBarWrapper:{paddingLeft:16,paddingRight:16,..."post_top_level_discussion"===e.discussionLocation&&{display:"flex",justifyContent:"space-between"}}})),[oe.reactionsToShow.length,e.discussionLocation,e.format,e.isFirst]);(0,n.useEffect)((()=>{u.KatexStore.loadIfNeeded(se)}),[u.KatexStore,se]);const le=(0,n.useCallback)((t=>{const{device:s}=u;if(!s.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),o(265201).A.setState({open:!1});const n=q().oE(tt().T.findSelectablesFromIds([e.store.getParentId()])),i=null==n?void 0:n[0];i&&x().pb({environment:u,handle:i,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[e.store,u]),ce=(0,n.useCallback)((e=>{V||(e.stopPropagation(),U(!0))}),[V]),de=(0,n.useMemo)((()=>{const{commentStores:t,commentsToShow:n,commentsToCollapse:i}=oe;if(V){const n=(0,_().lineClampForCommentCount)(t.length);if(!e.collapsed)return(0,J.jsx)(o(2143).H,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll"},ref:s,type:o(756279).A.Y,store:O,children:t.map(((o,s)=>{const i=g&&0===s;return(0,J.jsx)(Xe,{store:o,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:T,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:n,shouldShowThreadLine:s!==t.length-1,discussionContext:i?(0,J.jsx)(Bt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,showNewBar:o.id===(null==Z?void 0:Z.id)&&0!==s,isSuggestionComment:i,showUnreadStatusDot:0===s&&Q},o.id)}))});const i=t[0]&&(0,J.jsx)(Xe,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:T,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:n,collapsed:e.collapsed,shouldShowThreadLine:1!==t.length,discussionContext:g?(0,J.jsx)(Bt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:g,showUnreadStatusDot:Q},t[0].id),r=t.length>1&&t[t.length-1]&&(0,J.jsx)(Xe,{store:t[t.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:T,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:n,collapsed:e.collapsed,shouldShowThreadLine:!1,showUnreadStatusDot:!1},t[t.length-1].id),a=t.length-2;return(0,J.jsxs)(J.Fragment,{children:[i,(0,J.jsx)(wt,{insetButton:!V,count:a,onClick:ce,discussionLocation:e.discussionLocation}),r]})}const r=i.length>0,a=n.map(((t,o)=>{const s=g&&0===o,i=0===o&&!r,a=s?(0,J.jsx)(Bt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):i&&(e.format===_().DiscussionFormat.Menu||e.format===_().DiscussionFormat.Sidebar)&&(0,J.jsx)(pt().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:le}),l="post_top_level_discussion"===e.discussionLocation?(0,_().lineClampForCommentCount)(n.length):void 0;return(0,J.jsx)(Xe,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:T,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:a,isSuggestionComment:s,showNewBar:t.id===(null==Z?void 0:Z.id)&&0!==o,shouldShowThreadLine:o!==n.length-1,maxLines:l,showUnreadStatusDot:i&&Q},t.id)})),l=g,c=l?(0,J.jsx)(Bt,{discussionStore:e.store,collapsed:Boolean(e.collapsed)}):(e.format===_().DiscussionFormat.Menu||e.format===_().DiscussionFormat.Sidebar)&&(0,J.jsx)(pt().A,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:le});return(0,J.jsxs)("div",{style:{position:"relative"},children:[!X&&W&&ne&&(0,J.jsx)(A().m,{style:_t}),r&&(0,J.jsx)(Xe,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:T,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:c,shouldShowThreadLine:1!==t.length,isSuggestionComment:l,collapsed:e.collapsed,maxLines:"post_top_level_discussion"===e.discussionLocation&&e.collapsed?(0,_().lineClampForCommentCount)(t.length):void 0,showUnreadStatusDot:Q},t[0].id),(0,J.jsx)(wt,{insetButton:!V,count:i.length-1,onClick:ce,discussionLocation:e.discussionLocation}),a]})}),[oe,V,g,e.store,e.collapsed,e.format,e.discussionLocation,e.blockStore,e.showResolveButtonByDefaultIfPossible,le,W,ne,T,Q,ce,O,null==Z?void 0:Z.id,X]),ue=(0,c().K8)((()=>e.blockStore.getRole()),[e.blockStore]),[me,pe]=(0,n.useState)(!0);(0,n.useEffect)((()=>{var e;const t=null===(e=s.current)||void 0===e?void 0:e.getNode();if(t){function o(){t&&pe(qe().wU(t))}return t.addEventListener("scroll",o),()=>t.removeEventListener("scroll",o)}}),[s]);const ge=K&&!e.collapsed&&V&&H&&!me,he=(0,n.useCallback)((()=>{const e=tt().T.findSelectableFromStore(re);e&&x().pb({environment:u,handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})}),[re,u]),xe=(0,n.useCallback)((()=>{y.reset()}),[y]),Ce=(0,n.useCallback)((()=>{const t=u.currentUser.id;if(!t)return;const o=w().wc(e.store).filter((e=>e.getCreatedById()===t)),s=q().HV(o);if(!s)return;if(g&&1===o.length)return;const n=j().A.find((t=>t.commentId===s.id&&t.discussionLocation===e.discussionLocation));n&&(v().clear({environment:u}),n.edit())}),[e.discussionLocation,g,e.store,u]),be=(0,n.useCallback)((async()=>{if((0,_().hasCommentChanged)(y)){const{accept:e}=await f().Gh({message:(0,J.jsx)(p().sA,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,J.jsx)(p().sA,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})});e?(xe(),t&&t()):(await i().default.afterNextFlush(),v().setSelectionAtEnd({store:y.state.textStore}))}else xe(),t&&t()}),[t,y,xe]),ke=(0,n.useCallback)((()=>{i().default.afterNextFlush((()=>{var e;const t=null===(e=s.current)||void 0===e?void 0:e.getNode();t&&qe().VG({element:t,environment:u,options:{top:t.scrollHeight,behavior:"smooth"}})}))}),[s,u]),Ae=q().sg((()=>{setTimeout((()=>N(!0)),50)}),50),we=(0,n.useCallback)((async()=>{N(!1);const{device:t}=u;S().createAndCommit({userAction:"Discussion.handleSubmitReply",environment:u,canUndo:!0,perform:t=>{D().lV({environment:u,discussionStore:e.store,textValue:y.state.textStore.getValue()||[],transaction:t,discussionLocation:e.discussionLocation,files:y.state.files,property_id:e.store.getPropertyId(),blockStore:e.blockStore}),ve().default.checkGate({gateName:"comment_sidebar_for_you"})&&(0,Se().U)({transaction:t,discussionStore:e.store})}}),xe(),v().clear({environment:u}),ke(),Ae(),t.isMobile||(await i().default.afterNextFlush(),v().setSelectionAtStart({store:y.state.textStore}))}),[y,Ae,e.blockStore,e.store,e.discussionLocation,ke,u,xe]),je=(0,n.useCallback)((()=>{L().A.state||E(!0)}),[]),Ie=(0,n.useCallback)((()=>{E(!1)}),[]);return 0===oe.commentsToShow.length&&oe.reactionsToShow.length>0||"post_top_level_discussion"===e.discussionLocation&&0===oe.commentsToShow.length&&oe.reactionsToShow.length>0?(0,J.jsxs)("div",{ref:z,style:{...ae.discussionWrapper,...ae.reactionBarWrapper},onMouseMove:je,onMouseLeave:Ie,children:[(0,J.jsx)(ye().tx,{focused:!0,disableShadow:!0,parentStore:e.store,discussionLocation:e.discussionLocation}),"post_top_level_discussion"===e.discussionLocation&&e.pageVisitStore&&e.presenceStore&&(0,J.jsx)(o(126126).hJ,{pageVisitStore:e.pageVisitStore,presenceStore:e.presenceStore,rootStore:e.blockStore,maxUsers:5,isShowingInPostFeed:!0})]}):(0,J.jsx)(o(199896).A,{store:re,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;ie.current&&await ie.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,J.jsxs)("div",{ref:z,style:ae.discussionWrapper,onMouseMove:je,onMouseLeave:Ie,children:[!e.collapsed&&(0,J.jsx)(mt,{commentStore:h[0],discussionLocation:e.discussionLocation}),de,M?(0,J.jsx)("div",{style:{height:8}}):(0,J.jsx)(kt,{ref:ie,showMoreCommentsButton:Boolean(ge),onMoreCommentsClick:ke,inputVisible:!(I||e.collapsed&&k&&"post_top_level_discussion"!==e.discussionLocation),store:e.store,blockStore:re,format:e.format,discussionInputStore:y,discussionLocation:e.discussionLocation,onCancel:be,onSubmit:we,onEditPreviousComment:Ce,showCtaButtons:!!V||void 0,onFileUploaded:he,role:ue})]})})}const Rt=n.memo(Mt),_t={marginRight:4,position:"absolute",right:16,top:14};var Tt=()=>o(886901),Ft=()=>o(21140),Et=()=>o(644914),Pt=()=>o(835066);const Ut=(0,p().YK)({commentsAriaLabel:{defaultMessage:"{count, plural, one {1 comment} other {{count} comments}}",id:"comments.components.discussionindicator.commentAriaLabel"},suggestionsAriaLabel:{defaultMessage:"{count, plural, one {1 suggestion} other {{count} suggestions}}",id:"comments.components.discussionindicator.suggestionAriaLabel"},reactionsAriaLabel:{defaultMessage:"{count, plural, one {1 reaction} other {{count} reactions}}",id:"comments.components.discussionindicator.reactionsAriaLabel"}});function Kt(e){const t=(0,p().tz)(),{store:s,propertyId:n,style:i}=e,{showIndicator:a,formattedReactionCount:l,onlySuggestions:u,icon:m,showReactionsIcon:h,onlyHasDraftIndicator:f,formattedCommentCount:x,handleClick:v,discussionIsSelected:S,commentsCount:C,shouldShowDraftIndicator:b}=(0,o(257120).A)({store:s,recursivelyLoadAllDiscussions:!1,onlyCountBlockLevelDiscussions:!1,propertyId:n}),y=(0,d().IS)((e=>({iconButton:{background:S?e.selectLightGray[100]:void 0,gap:2},icon:{width:14,color:e.text.tertiary},commentCaptionStyle:{fontWeight:g().Wy.semibold,...b?{color:e.icon.tertiary}:{color:e.text.tertiary,marginBottom:1}},reactionCaptionStyle:{fontWeight:g().Wy.semibold,color:e.text.tertiary}})),[S,b]),k=(0,r().v3)(),A=(0,c().K8)((()=>(0,Et().me)(k)),[k]),w=(0,c().K8)((()=>(0,Pt().dC)(k,s)),[k,s]),{isPropertyInPageDetails:j}=(0,o(517223)._1)({store:s,propertyId:n});return!a||!j&&(A||w)?null:(0,J.jsxs)(Ft().Ye,{style:i,children:[(C>0||f)&&(0,J.jsxs)(Ft().Ye,{style:{position:"relative"},children:[(0,J.jsx)(ne().A,{ariaLabel:u?t.formatMessage(Ut.suggestionsAriaLabel,{count:x}):t.formatMessage(Ut.commentsAriaLabel,{count:x}),icon:m,style:y.iconButton,iconStyle:y.icon,onClick:v,caption:x,captionStyle:y.commentCaptionStyle}),b&&(0,J.jsx)(o(359848).h,{customTop:3,customLeft:16,onlyShowDraftDot:!0})]}),h&&(0,J.jsx)(ne().A,{ariaLabel:t.formatMessage(Ut.reactionsAriaLabel,{count:l}),icon:o(650225).l,style:y.iconButton,iconStyle:y.icon,onClick:v,captionStyle:y.reactionCaptionStyle,caption:l})]})}const Nt=n.memo(Kt);var Ot=()=>o(145214),Ht=()=>o(747100),Wt=()=>o(496506),Vt=()=>o(191772),zt=()=>o(94953),$t=()=>o(116008),Gt=(o(430670),o(737550),()=>o(563884)),Jt=()=>o(715862),Xt=()=>o(125565),Yt=()=>o(659799),Qt=()=>o(907514),Zt=()=>o(938045),qt=()=>o(811879);function eo(e){let{discussionData:{groupedDiscussionsData:t,newDiscussionData:o,id:s},onClick:i}=e;const[a,l]=(0,n.useState)(!1),u=(0,r().v3)(),m=u.currentUser.id,h=(0,n.useCallback)((()=>{l(!0)}),[]),f=(0,n.useCallback)((()=>{l(!1)}),[]),x=o,v=(0,n.useCallback)((async e=>{if(x){const e=xe().default.state.mainEditorCurrentBlockStore;E().A.setActiveWithSource("margin_comments"),await(0,Zt().x)({currentBlockStore:e,discussionInputStore:o.discussionInputStore,environment:u})}else if(t.length>0){const o=t[0].discussionStore;await i(e,o)}}),[x,t,null==o?void 0:o.discussionInputStore,u,i]),{commentStores:S,reactionStores:b}=(0,c().K8)((()=>{if(t){return{commentStores:t.flatMap((e=>(0,w().wc)(e.discussionStore))),reactionStores:t.flatMap((e=>B().Lk.getUserVisibleReactions(e.discussionStore)))}}return{commentStores:[],reactionStores:[]}}),[t]),y=(0,c().K8)((()=>{let e;if(x&&(e=o.parentBlockStore),t.length>0&&(e=t[0].parentBlockStore),!e)return;const s=S.map((e=>e.getCreatedById())).filter(ee().O9),n=b.map((e=>e.getActorPointers().map((e=>e.id)))).flat().filter(ee().O9);return Array.from(new Set([...s,...n,...x&&m?[m]:[]])).map((t=>B().LU.createChildStore(e,{table:Z().oo,id:t}))).slice(0,5)}),[t,x,S,b,m,null==o?void 0:o.parentBlockStore]),k=(0,c().K8)((()=>{const e=S.map((e=>e.getLastEditedTime())),t=b.map((e=>e.getCreatedTime()));return Math.max(...e,...t)}),[S,b]),j=(0,fe().X)("inbox_page_grouping_notification_style"),I=(0,c().K8)((()=>{if(!j)return!1;const e=t.map((e=>e.discussionStore)),o=ve().default.getConfigKey("assume_comment_read","last_seen_at");return e.some((e=>e.isUnread(o)))}),[t,j]),L=(0,d().IS)((e=>({discussion:{background:a?e.hoveredMarginDiscussionBackground:e.contentBackground,width:Pt().JC,display:"flex",cursor:"pointer",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,padding:"12px",alignItems:"center",gap:6},userAvatarsContainer:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row-reverse",marginRight:8},lastEditedTime:{margin:"1px 0px 0px 0px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",color:e.text.tertiary,fontSize:12,lineHeight:"15px"},commentAuthorAvatarStyle:{borderRadius:20,position:"relative",userSelect:"none",WebkitUserSelect:"none",width:24,height:24,boxShadow:e.avatarBoxShadow,marginRight:-6},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:g().J.UISmall.desktop,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",marginLeft:0,marginTop:0,color:e.text.tertiary},expandIcon:{width:g().J.UISmall.desktop,height:g().J.UISmall.desktop,fill:e.text.tertiary,marginTop:1},expandDiv:{display:"flex",justifyContent:"center",alignItems:"center",marginLeft:0},unreadStatusDot:{display:"flex",alignItems:"center",marginRight:4,marginLeft:"auto"}})),[a]),D=(0,J.jsx)("div",{style:L.secondaryLabel,children:(0,J.jsx)(p().sA,{defaultMessage:"Draft",id:"marginComments.collapsed.draft.label"})}),M=(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{style:L.expandDiv,children:(0,Jt().e)(L.expandIcon)}),x?D:(0,J.jsx)("div",{style:L.secondaryLabel,children:(0,J.jsx)(p().sA,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"})})]}),R=x?D:k&&(0,J.jsx)(Xt().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:L.lastEditedTime,children:(0,J.jsx)(Yt().A,{text:(0,Qt().nl)(k,{useUltraCompactFormat:!0}),tooltipText:(0,Qt().x$)(k),icon:Gt().k})});return(0,J.jsxs)("div",{style:L.discussion,onMouseEnter:h,onMouseLeave:f,onClick:v,className:me().OO1,children:[(0,J.jsx)("div",{style:L.userAvatarsContainer,children:null==y?void 0:y.map((e=>(0,J.jsx)(qt().E,{authorStore:e,avatarSize:24,avatarStyle:L.commentAuthorAvatarStyle,placeholderStyle:L.commentAuthorPlaceholderStyle},e.id)))}),(0,J.jsx)(to,{reactionCount:b.length,commentCount:S.length+(x?1:0)}),a?M:R,I&&(0,J.jsx)("div",{style:L.unreadStatusDot,children:(0,J.jsx)(A().m,{size:C().jd})})]})}function to(e){const t=(0,d().IS)((e=>({commentCount:{fontSize:14,whiteSpace:"normal",marginLeft:0,color:e.text.primary,fontWeight:g().Wy.medium,lineHeight:"18px"},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:4,marginLeft:4}})),[]);return e.commentCount>0?(0,J.jsx)("div",{style:t.commentCount,children:(0,J.jsx)(p().sA,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:e.commentCount}})}):e.reactionCount>0?(0,J.jsx)("div",{style:t.commentCount,children:(0,J.jsx)(p().sA,{defaultMessage:"{numReactions, plural, one {{numReactions} reaction} other {{numReactions} reactions}}",id:"marginComments.collapsed.numReactions.count",values:{numReactions:e.reactionCount}})}):(0,J.jsx)("div",{style:t.textPlaceholder})}var oo=()=>o(833744),so=()=>o(862292),no=()=>o(441467);function io(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:s}=e;const i=(0,n.useRef)(null),a=(0,r().v3)(),l=(0,n.useCallback)((async()=>{const e=await so().T.formulas.load();no().i5({environment:a,allowActionsWhileCommenting:!0,formulasModule:e})}),[a]),u=(0,c().K8)((()=>o.isEmpty()),[o]),m=(0,n.useCallback)((()=>{E().A.setActiveWithSource("margin_comments")}),[]),p=(0,n.useCallback)((()=>{E().A.resetActiveSource("margin_comments")}),[]),g=(0,n.useCallback)((()=>{u&&$t().A.reset(),E().A.resetEditorActiveSources()}),[u]),h=(0,n.useCallback)((()=>{E().A.setHoverWithSource("margin_comments")}),[]),f=(0,n.useCallback)((()=>{E().A.resetHoverSource("margin_comments")}),[]),x=(0,n.useMemo)((()=>[`.${me().MUV}`]),[]),v=(0,c().K8)((()=>E().A.state.isActivelyComposing),[]),S=(0,c().K8)((()=>E().A.state.isHovered&&!E().A.state.isActivelyComposing),[]),C=Boolean(v||u);(0,oo().L)({active:s&&C,closeHandler:g,ref:i,excludedSelectors:x,ignoreKeydown:!0});const b=(0,d().IS)((e=>({discussion:{borderRadius:10,...v?{boxShadow:e.shadowSM}:{border:`1px solid ${e.lightDividerColor}`},width:Pt().JC,background:e.selectedMarginDiscussionBackground,willChange:"transform",transition:"transform 200ms ease",transform:v?"translateX(-20px)":S?"translateX(-5px)":void 0},discussionInputContainer:{borderRadius:6,padding:"8px 0px 4px 12px",backgroundColor:S?e.hoveredMarginDiscussionBackground:void 0}})),[v,S]);return(0,J.jsx)("div",{style:b.discussion,ref:i,className:me().OO1,onMouseEnter:h,onMouseLeave:f,children:(0,J.jsx)(Je().A,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:_().DiscussionFormat.Margin,onSubmit:l,onCancel:g,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:b.discussionInputContainer,showCtaButtons:!0,onFocus:m,onBlur:p})})}var ro=()=>o(955825),ao=()=>o(878523);function lo(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:s,onClick:i,isVisible:a,isDiscussionSelected:l,isDiscussionHovered:u}=e;const m=(0,n.useRef)(null),p=(0,r().v3)(),[g,f]=(0,n.useState)((()=>new(F().A)(p,t.pointer.spaceId))),x=(0,fe().X)("block_reactions"),v=t.id,S=(0,c().K8)((()=>t.getCommentStores().length>0),[t]),C=(0,c().K8)((()=>t.getReactionStores().length>0),[t]),b=(0,n.useMemo)((()=>[`.${(0,ro().wV)({discussionId:v})}`,`.${me().MUV}`,`.${me().OO1}`]),[v]),y=(0,n.useCallback)((async()=>{const e=j().A.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}h().xl()}),[]);(0,oo().L)({active:a&&l,closeHandler:y,ref:m,excludedSelectors:b,ignoreKeydown:!0});const k=(0,n.useCallback)((async e=>{var o;l||(ao().E9(p,{discussion_id:t.id,discussion_type:t.getType(),from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await i(e,t))}),[i,t,l,p]),A=(0,d().IS)((e=>({discussion:{border:l?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:10,padding:l?"1px":void 0,background:l?e.selectedMarginDiscussionBackground:u?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:l?e.shadowSM:void 0,width:Pt().JC,cursor:l?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:l?"translateX(-20px)":u?"translateX(-5px)":void 0}})),[u,l]);return(0,J.jsxs)("div",{className:me().OO1,ref:m,style:A.wrapper,onClick:k,children:[C&&x&&(0,J.jsx)("div",{style:{width:Pt().JC},children:(0,J.jsx)(ye().tx,{focused:l,parentStore:t,discussionLocation:"margin_comments"})}),S&&(0,J.jsx)("div",{style:A.discussion,children:(0,J.jsx)(Rt,{store:t,blockStore:o,format:_().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:s,discussionInputStore:g,collapsed:!l})})]})}const co=n.memo(lo);o(803949);var uo=()=>o(300857);function mo(e){let{discussionData:{discussionStore:t,parentBlockStore:s},timeMounted:i,onClick:a,isVisible:l,isDiscussionSelected:u,isDiscussionHovered:m,onMouseEnter:g,onMouseLeave:f}=e;const x=(0,n.useRef)(null),v=(0,r().v3)(),C=(0,p().tz)(),[b,y]=(0,n.useState)((()=>new(F().A)(v,t.pointer.spaceId))),k=(0,fe().X)("block_reactions"),A=(0,fe().X)("margin_comments_stepper"),w=t.id,L=(0,c().K8)((()=>t.getCommentStores().length>0),[t]),B=(0,c().K8)((()=>t.getReactionStores().length>0),[t]),D=(0,n.useMemo)((()=>[`.${(0,ro().wV)({discussionId:w})}`,`.${me().MUV}`,`.${me().OO1}`]),[w]),M=(0,n.useCallback)((async()=>{const e=j().A.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}h().xl()}),[]);(0,oo().L)({active:l&&u,closeHandler:M,ref:x,excludedSelectors:D,ignoreKeydown:!0});const R=(0,n.useCallback)((async e=>{var o;u||(ao().E9(v,{discussion_id:t.id,discussion_type:t.getType(),from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await a(e,t))}),[a,t,u,v]),T=(0,c().K8)((()=>(0,o(186445).ao)()),[]),E=(0,o(419123).k)({navigableBlockStore:T}),{pageSortedDiscussions:P,pageSortedUnreadDiscussions:U}=(0,c().K8)((()=>{const e=Array.from(E).sort(((e,t)=>{var o,s;const n=null===(o=document.getElementsByClassName((0,ro().wV)({discussionId:e.id}))[0])||void 0===o?void 0:o.getBoundingClientRect(),i=null===(s=document.getElementsByClassName((0,ro().wV)({discussionId:t.id}))[0])||void 0===s?void 0:s.getBoundingClientRect();return n&&i?n.top-i.top:0}));return{pageSortedDiscussions:e,pageSortedUnreadDiscussions:e.filter((e=>e.isUnread(void 0)))}}),[E]),K=(0,c().K8)((()=>U.length),[U]),N=(0,c().K8)((()=>U.findIndex((e=>e.id===t.id))+1),[t,U]),O=(0,c().K8)((()=>I().A.getFramePageFirstSelectedDiscussionId()),[]),H=(0,c().K8)((()=>(1===N&&void 0===O||u)&&U.length>0),[N,O,u,U]),W=(0,d().IS)((e=>({discussion:{border:u?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:10,padding:u?"1px":void 0,background:u?e.selectedMarginDiscussionBackground:m?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:u?e.shadowSM:void 0,width:Pt().JC,cursor:u?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:u?"translateX(-20px)":m?"translateX(-5px)":void 0},stepper:{display:"flex",justifyContent:"end",gap:4,opacity:H?1:0,transition:"opacity 250ms ease-in"},markAllAsRead:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,borderRadius:6,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},discussionCount:{marginRight:"auto",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:e.text.secondary,paddingLeft:6,paddingRight:6},discussionItemAndStepperContainer:{display:"flex",flexDirection:"column",gap:10}})),[m,u,H]),V=(0,n.useCallback)((()=>{S().createAndCommit({userAction:"MarginCommentsStepper.markAllAsRead",environment:v,canUndo:!0,perform:e=>U.forEach((t=>(0,Se().U)({transaction:e,discussionStore:t})))})}),[v,U]),z=(0,n.useCallback)((async()=>{const e=P.findIndex((e=>e.id===t.id));if(-1===e)return;const o=P.slice(e+1).find((e=>e.isUnread(void 0)))||P.slice(0,e).find((e=>e.isUnread(void 0)));o&&((0,uo().b)({discussionId:o.id,blockId:s.id,environment:v,animate:!0}),await h().B4({environment:v,blockStore:s,discussionIds:[o.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[t,v,s,P]),$=(0,n.useCallback)((async()=>{const e=P.findIndex((e=>e.id===t.id));if(-1===e)return;const o=P.slice(0,e).reverse().find((e=>e.isUnread(void 0)))||P.slice(e+1).reverse().find((e=>e.isUnread(void 0)));o&&((0,uo().b)({discussionId:o.id,blockId:s.id,environment:v,animate:!0}),await h().B4({environment:v,blockStore:s,discussionIds:[o.id],analyticsFrom:"margin_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1}))}),[t,v,s,P]);return A?(0,J.jsxs)("div",{style:W.discussionItemAndStepperContainer,children:[H&&(0,J.jsxs)("div",{style:W.stepper,children:[(0,J.jsx)("div",{style:W.discussionCount,children:`${N} of ${K}`}),(0,J.jsx)(Ee().A,{style:W.markAllAsRead,onClick:V,children:"Mark all as read"}),(0,J.jsx)(ne().A,{icon:o(300905).E,ariaLabel:C.formatMessage({id:"discussion.stepper.previousUnread",defaultMessage:"Previous unread discussion"}),onClick:$}),(0,J.jsx)(ne().A,{icon:o(626466).arrowChevronSingleDownFillIcon,ariaLabel:C.formatMessage({id:"discussion.stepper.nextUnread",defaultMessage:"Next unread discussion"}),onClick:z})]}),(0,J.jsxs)("div",{ref:x,className:me().OO1,style:W.wrapper,onMouseEnter:g,onMouseLeave:f,onClick:R,role:"button",tabIndex:0,children:[B&&k&&(0,J.jsx)("div",{style:{width:Pt().JC},children:(0,J.jsx)(ye().tx,{focused:u,parentStore:t,discussionLocation:"margin_comments"})}),L&&(0,J.jsx)("div",{style:W.discussion,children:(0,J.jsx)(Rt,{store:t,blockStore:s,format:_().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:b,collapsed:!u})})]})]}):(0,J.jsxs)("div",{className:me().OO1,ref:x,style:W.wrapper,onClick:R,role:"button",tabIndex:0,children:[B&&k&&(0,J.jsx)("div",{style:{width:Pt().JC},children:(0,J.jsx)(ye().tx,{focused:u,parentStore:t,discussionLocation:"margin_comments"})}),L&&(0,J.jsx)("div",{style:W.discussion,children:(0,J.jsx)(Rt,{store:t,blockStore:s,format:_().DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:b,collapsed:!u})})]})}const po=n.memo(mo);function go(e){const{discussionData:t,isLastItem:o,isDiscussionSelected:s,discussionItemElementMap:i}=e,a=(0,d().IS)((()=>({discussionContainer:{transition:t.hide?void 0:"opacity 200ms ease-in-out",top:t.offsetTop,position:"absolute",paddingBottom:o?Pt().t_:Pt().kH,zIndex:s?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,s,o]);let l;const u=t.type,m=(0,r().v3)(),p=(0,c().K8)((()=>(0,Pt().$N)(m,t.parentBlockStore)),[m,t.parentBlockStore]),g=(0,fe().X)("margin_comments_stepper"),h=(0,n.useCallback)((()=>{zt().A.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),f=(0,n.useCallback)((()=>{zt().A.setState({discussionIds:[]})}),[]),x=(0,n.useCallback)((e=>{i.set(t.id,e)}),[t.id,i]);p?"existing"===u?l=g?(0,J.jsx)(po,{...e,onMouseEnter:h,onMouseLeave:f,discussionData:t}):(0,J.jsx)(co,{...e,discussionData:t}):"new"===u?l=(0,J.jsx)(io,{...e,discussionData:t}):"grouped"===u?l=(0,J.jsx)(eo,{...e,discussionData:t}):(0,ee().HB)(u):l=null;return g&&"existing"===u?(0,J.jsx)("div",{style:a.discussionContainer,ref:x,children:l}):(0,J.jsx)("div",{style:a.discussionContainer,onMouseEnter:h,onMouseLeave:f,ref:x,children:l})}const ho=n.memo(go),fo=`.${Vt().iU}, .${Vt().F0}`;function xo(e){let{pageBlockStore:t,timeMounted:s,isVisible:i,animating:a,pageViewBlockAccessor:l,width:u,context:m}=e;const p=(0,r().v3)(),g=(0,n.useRef)(null),h=(0,n.useRef)(new Map),f=(0,n.useRef)(new Map),x=(0,c().K8)((()=>zt().A.getFirstSelectedDiscussionId()),[]),v=(0,n.useCallback)((async(e,s)=>{(0,o(592678).Zm)()||e.target instanceof Element&&e.target.closest(fo)||await D().DZ({discussionStore:s,currentBlockStore:t,environment:p,analyticsFrom:"margin_comments",currentEl:g.current})}),[t,p]),[S,C]=(0,n.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[b,y]=(0,n.useState)(!1),{WindowSizeStore:k}=p,A=o(175947).ek(p.device.isElectronMac);(0,n.useEffect)((()=>{if(!i)return;const e=new(Wt().default)((()=>({selectableRectMap:o(666710).default.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:o(737230).Ay.state.isAnimating,windowHeight:k.state.height})),{debugName:"effectDataStore"}),s=new(Wt().default)((()=>Pt().Ob.state),{debugName:"discussionStoresStore"}),n=new(Wt().default)((()=>{const e=$t().A.state,t=$t().A.getBlockStore(),s=$t().A.getClosestBlockStore();if(e.open&&e.rect&&"comment"===e.content&&(t||s)&&(!t||o(489348).A.isBlockInFrame(t)&&!e.property_id))return{recomputeFocus:E().A.state.isActivelyComposing,blockStore:t??e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),r=new(Wt().default)((()=>{if(!E().A.state.isActivelyComposing)return I().A.getFramePageFirstSelectedDiscussionId();I().A.reset()}),{debugName:"selectedDiscussionIdStore"});let c=!1;const d=(0,q().sg)((()=>{const{selectableRectMap:o,pageContentStores:i,sidebarIsAnimating:d,windowHeight:u}=e.state,x=s.state,v=n.state,k=r.state;if(a||d)return;const w=l();if(!(w&&g.current&&o&&o.size))return;(0,Pt().cY)({discussionStores:x,pageContentStores:i,marginDiscussionItemRefs:h.current,selectedDiscussionId:k,newMarginDiscussionArgs:v,marginContainerElement:g.current,pageViewBlockElement:w,onComputeComplete:(e,t)=>{c||(f.current=t,b||y(!0),C(e))},computedOnce:b,topbarHeight:A,windowHeight:u,isFullWidth:(0,Ze().Ck)(t,m,p),prevSelectedDiscussionId:S.selectedDiscussion,previousDiscussionElements:f.current})}),5);return e.addListener(d),s.addListener(d),r.addListener(d),n.addListener(d),()=>{c=!0,e.removeListener(d),s.removeListener(d),r.removeListener(d),n.removeListener(d)}}),[i,a,l,b,t,S.selectedDiscussion,k,A,p,m]);const w=(0,d().IS)((()=>({marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,paddingLeft:Pt().JR,paddingRight:Pt().JR,width:u-2*Pt().JR,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:1}})),[u]);return(0,J.jsx)("div",{style:w.marginCommentsContainer,ref:g,children:S.data.map(((e,t)=>(0,J.jsx)(ho,{discussionData:e,timeMounted:s,onClick:v,isVisible:i,discussionItemElementMap:h.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===x,isLastItem:t===S.data.length-1},`margin-discussion-${e.id}`)))})}const vo=n.memo(xo);function So(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:s,context:i,isCollapsedAnchor:a}=e;const[l,u]=(0,n.useState)(!1),m=(0,r().v3)(),p=(0,n.useMemo)((()=>(new Date).getTime()),[]),g=(0,c().K8)((()=>{const e=(0,Ze().Ck)(t,i,m);return a?{paddingLeft:e?96:16,height:0}:e?void 0:{position:"absolute",right:(0,Pt().gg)(m,(0,Ht().cq)(t),(0,Ht().RX)(t))}}),[t,i,m,a]),h=(0,n.useCallback)((()=>{u(!0)}),[]),f=(0,n.useCallback)((()=>{u(!1)}),[]),x=(0,d().IS)((()=>({marginCommentsSection:{display:o||l?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?Pt().Qb:0,...g}})),[o,l,g]);return(0,J.jsx)(Ot().A,{animate:{opacity:o?1:0},onAnimationStart:h,onAnimationEnd:f,style:x.marginCommentsSection,children:(0,J.jsx)(vo,{pageBlockStore:t,timeMounted:p,isVisible:o,animating:l,pageViewBlockAccessor:s,width:Pt().Qb,context:i})})}var Co=()=>o(297872),bo=()=>o(897119),yo=()=>o(13679);const ko=function(e){const{capture:t,children:s}=e,i=(0,n.useRef)(null);return(0,l().b)(o(536612).A,(()=>({getNode:()=>i.current,isCaptured:()=>t})),[t]),(0,J.jsx)("div",{ref:i,children:n.Children.only(s)})};var Ao=()=>o(691298),wo=()=>o(962730),jo=()=>o(377586),Io=()=>o(574012);function Lo(e){let{blockStore:t,discussionInputStore:o,handleDismiss:s}=e;const i=(0,r().v3)(),{device:a,WindowSizeStore:l}=i,u=(0,n.useCallback)((async()=>{const e=await so().T.formulas.load();no().i5({environment:i,allowActionsWhileCommenting:!0,formulasModule:e})}),[i]),m=(0,c().K8)((()=>Io().A.keyboardHeight()>0),[]),p=(0,c().K8)((()=>{const e=a.isAndroid?12:8;return{paddingLeft:l.getSafePaddingLeftCSS(12),paddingRight:l.getSafePaddingRightCSS(8),paddingBottom:m?e:l.getSafePaddingBottomCSS(e)}}),[l,m,a.isAndroid]),g=(0,d().IS)((()=>({inputWrapper:{width:a.isMobileNative?"100%":470,maxWidth:a.isMobileBrowser?"90vw":"100%",paddingTop:9,paddingLeft:p.paddingLeft,paddingRight:p.paddingRight,paddingBottom:p.paddingBottom}})),[a,p]);return(0,Ao().A)({shouldPreserveTextSelection:!0,shouldPreserveBlockSelection:!0,shouldRestoreSelection:!0}),(0,J.jsx)(Co().A,{capture:!0,allowOpenLinkMenu:!0,render:()=>(0,J.jsx)(yo().A,{store:t,droppable:!0,render:()=>(0,J.jsx)(ko,{capture:!0,children:(0,J.jsx)("div",{style:g.inputWrapper,children:(0,J.jsx)(Je().A,{showAvatar:!0,parentStore:t,onCancel:s,onSubmit:u,discussionInputStore:o,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:_().DiscussionFormat.Page,blockStore:t,canDrop:!0})})})},t.id)})}const Bo=function(){const e=(0,r().v3)(),t=(0,r().WS)(),s=(0,c().K8)((()=>$t().A.state.rect),[]),i=(0,c().K8)((()=>{if($t().A.state.open&&"comment"===$t().A.state.content){const{discussionInputStore:o}=$t().A.state;if((0,Et().me)(e))return null;if($t().A.updateRect(),E().A.state.isActivelyComposing){"comments_pane"===E().A.state.clickEntryPoint&&E().A.setActiveWithSource("popover_comments");const s=$t().A.getBlockStore();var t;if(s)return{blockStore:s,discussionInputStore:o,canMarginCommentsRender:!(null!==(t=$t().A.state)&&void 0!==t&&t.property_id)&&(0,Pt().$N)(e,s)}}}return null}),[e]),a=(0,n.useCallback)((()=>{const t=null==i?void 0:i.discussionInputStore;t&&(0,o(36088).M)({discussionInputStore:t,environment:e})}),[e,null==i?void 0:i.discussionInputStore]),l=(0,n.useCallback)((()=>{$t().A.hasContent()?E().A.resetEditorActiveSources():i&&(0,o(681634).c)(e)}),[e,i]);(0,n.useEffect)((()=>{function t(t){const s=$t().A.state,n=s.open&&"comment"===s.content&&s.discussionInputStore||void 0;n&&((0,o(405981).HR)({discussionInputStore:n,environment:e,discussionHelpers:_()}),t.preventDefault())}return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e]);const d=(0,c().K8)((()=>o(205682).A.state.isOpen),[]);return(0,c().K8)((()=>E().A.state.overlapsExistingDiscussionMenu),[])?null:(0,J.jsx)(bo().Ay,{popupType:t?jo().n.SlideUp:jo().n.Popup,keepFocus:!0,open:null!==i&&(!i.canMarginCommentsRender||d),originRect:s,placementToOrigin:wo().W.Bottom,alignmentToOrigin:wo().C.Center,originGap:4,onDismiss:l,render:()=>i?(0,J.jsx)(Lo,{blockStore:i.blockStore,discussionInputStore:i.discussionInputStore,handleDismiss:l}):null,onAnimationEnd:a})};var Do=()=>o(347199),Mo=()=>o(21510);const Ro=function(){const e=(0,r().v3)(),t=(0,r().Y0)(),{open:o,rect:s,discussionLocation:n}=(0,c().K8)((()=>{const{open:e,rect:t}=Mo().A.state;return{open:e,rect:t,discussionLocation:Mo().A.state.open?Mo().A.state.discussionLocation:Mo().A.state.prevDiscussionLocation}}),[]),i=(0,fe().X)("comment_sidebar_for_you"),{popupType:a,bottomSheetInitialState:l}=function(e){if(!e.device.isPhone)return{popupType:jo().n.Popup,bottomSheetInitialState:void 0};if(e.enableForYouCommentSidebar||"post_top_level_discussion"===e.discussionLocation)return{popupType:jo().n.BottomSheet,bottomSheetInitialState:"full"};return{popupType:jo().n.SlideUp,bottomSheetInitialState:void 0}}({device:t,enableForYouCommentSidebar:i,discussionLocation:n});return(0,J.jsx)(bo().Ay,{popupType:a,bottomSheetInitialState:l,open:o,originRect:s,placementToOrigin:wo().W.Bottom,alignmentToOrigin:wo().C.Center,originGap:4,onDismiss:()=>M().oU(e),render:()=>(0,J.jsx)(_o,{}),trapFocus:!0})};function _o(){const e=(0,r().v3)(),{device:t}=e,o=(0,c().O$)(Mo().A),s=(0,c().K8)((()=>Mo().A.state.open?Mo().A.state.discussionInputStore.state.textStore.getValue():null),[]);if((0,n.useEffect)((()=>{var e;if(o.open&&"post_top_level_discussion"===o.discussionLocation)return;const t=null===(e=Do().A.MenuScroller)||void 0===e?void 0:e.getNode();null==t||t.scrollTo({top:t.scrollHeight})}),[s,o]),o.open){const{discussionStore:s,discussionInputStore:n,blockStore:i,discussionLocation:r}=o;let a;return a=t.isMobile?{menuType:pe().gu.Modal,title:(0,J.jsx)(p().sA,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:(0,J.jsx)(p().sA,{defaultMessage:"Done",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>M().oU(e),whiteBackground:!0}:{menuType:pe().gu.Popup,width:420,minHeight:"100px",maxHeight:"50vh",maxWidth:"100%"},(0,J.jsx)(ie().A,{className:me()._qG,...a,children:(0,J.jsx)(Co().A,{capture:!0,allowMobileAutoScroll:!0,render:()=>(0,J.jsx)(Rt,{store:s,discussionInputStore:n,onDismiss:()=>M().oU(e),format:_().DiscussionFormat.Menu,isFirst:!0,isOnly:!0,showResolveButtonByDefaultIfPossible:!0,blockStore:i,collapsed:!1,..."post_top_level_discussion"===r?{pageVisitStore:void 0,presenceStore:void 0,discussionLocation:"post_top_level_discussion"}:{discussionLocation:r}})})})}return null}var To=()=>o(165492),Fo=()=>o(528787)},285176:(e,t,o)=>{o.d(t,{o:()=>a});o(296540);var s=()=>o(401497),n=()=>o(133033),i=()=>o(959013),r=o(474848);function a(e){const{href:t,style:o}=e,a=(0,s().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,r.jsxs)("a",{href:t,target:"_blank",style:{...a.default,...o},children:[(0,n().$)({width:14,marginRight:4}),(0,r.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},292379:(e,t,o)=>{o.d(t,{B:()=>p});var s=o(296540),n=()=>o(484714),i=()=>o(847249),r=()=>o(541235),a=()=>o(73223),l=()=>o(739135);const c=new Map;var d=()=>o(351360),u=()=>o(953006),m=o(474848);function p(e){let{tutorialId:t,tutorialStepId:o,onPrimaryButtonClick:p,displayStore:g,...h}=e;const f=(0,n().v3)(),x=function(e){const t=!c.get(e),o=(0,s.useRef)(t);return o.current&&c.set(e,!0),(0,s.useEffect)((()=>()=>{o.current&&c.set(e,!1)}),[e]),o.current}(`${t}.${o}`),{currentStep:v,isLoading:S}=(0,i().K8)((()=>{var e;return{isLoading:!(null!==(e=d().default.state.currentUserSettingsStore)&&void 0!==e&&e.getSettings()),currentStep:(0,l().gt)(d().default.state.currentUserSettingsStore,t)}}),[t]);if((0,s.useEffect)((()=>{S||v!==o||!x?null==g||g.setState(!1):null==g||g.setState(!0)}),[S,v,o,x,g]),S||v!==o||!x)return null;const C=r().c$[t],b=C.steps.findIndex((e=>e.id===o)),y=C.steps.length;return(0,m.jsx)(u().k,{onCloseClick:()=>{a().dismissTutorial(f,t)},onPrimaryButtonClick:e=>{a().tutorialGoToNextStep(f,t),null==p||p(e)},onBackButtonClick:()=>{a().tutorialGoToPrevStep(f,t)},numSteps:y,currStepIndex:b,...h})}},350124:(e,t,o)=>{o.d(t,{s:()=>n});o(296540);var s=o(474848);const n=(0,o(340498).wt)("reactionAdd",{viewBox:"0 0 20 20",svg:(0,s.jsxs)("g",{children:[(0,s.jsx)("path",{d:"M12 14.3516C12 14.1875 12.0573 14.0482 12.1719 13.9336C12.2891 13.8164 12.4297 13.7578 12.5938 13.7578H14.7617V11.5938C14.7617 11.4297 14.819 11.2904 14.9336 11.1758C15.0482 11.0586 15.1875 11 15.3516 11C15.5156 11 15.6549 11.0586 15.7695 11.1758C15.8867 11.2904 15.9453 11.4297 15.9453 11.5938V13.7578H18.1133C18.2747 13.7578 18.4128 13.8164 18.5273 13.9336C18.6445 14.0482 18.7031 14.1875 18.7031 14.3516C18.7031 14.5156 18.6445 14.6562 18.5273 14.7734C18.4128 14.888 18.2747 14.9453 18.1133 14.9453H15.9453V17.1133C15.9453 17.2747 15.8867 17.4128 15.7695 17.5273C15.6549 17.6445 15.5156 17.7031 15.3516 17.7031C15.1875 17.7031 15.0482 17.6445 14.9336 17.5273C14.819 17.4128 14.7617 17.2747 14.7617 17.1133V14.9453H12.5938C12.4297 14.9453 12.2891 14.888 12.1719 14.7734C12.0573 14.6562 12 14.5156 12 14.3516Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.0615 17.123C9.09538 17.123 8.1862 16.9385 7.33398 16.5693C6.48177 16.2048 5.72982 15.6966 5.07812 15.0449C4.43099 14.3932 3.92285 13.6413 3.55371 12.7891C3.18457 11.9368 3 11.0277 3 10.0615C3 9.09538 3.18457 8.1862 3.55371 7.33398C3.92285 6.48177 4.43099 5.7321 5.07812 5.08496C5.72982 4.43327 6.47949 3.92285 7.32715 3.55371C8.17936 3.18457 9.08854 3 10.0547 3C11.0254 3 11.9368 3.18457 12.7891 3.55371C13.6413 3.92285 14.3932 4.43327 15.0449 5.08496C15.6966 5.7321 16.207 6.48177 16.5762 7.33398C16.9453 8.1862 17.1299 9.09538 17.1299 10.0615C17.1299 10.6193 17.0684 11.1581 16.9453 11.678V11.5938C16.9453 11.1646 16.7813 10.7706 16.4767 10.4687C16.2657 10.2558 16.0099 10.1116 15.7285 10.0441C15.7263 9.26677 15.5805 8.53887 15.291 7.86035C14.9993 7.1722 14.5938 6.56836 14.0742 6.04883C13.5547 5.5293 12.9508 5.1237 12.2627 4.83203C11.5791 4.54036 10.8431 4.39453 10.0547 4.39453C9.27083 4.39453 8.53483 4.54036 7.84668 4.83203C7.16309 5.1237 6.5638 5.5293 6.04883 6.04883C5.53385 6.56836 5.13053 7.1722 4.83887 7.86035C4.5472 8.54395 4.40137 9.27767 4.40137 10.0615C4.40137 10.8499 4.5472 11.5859 4.83887 12.2695C5.13053 12.9531 5.53385 13.5547 6.04883 14.0742C6.56836 14.5938 7.16992 14.9993 7.85352 15.291C8.54167 15.5827 9.27767 15.7285 10.0615 15.7285C10.5739 15.7285 11.0641 15.6669 11.5321 15.5438C11.8272 15.8056 12.1958 15.9453 12.5938 15.9453H13.7617V16.0641C13.4535 16.2554 13.1293 16.4238 12.7891 16.5693C11.9368 16.9385 11.0277 17.123 10.0615 17.123ZM10.0547 13.4248C9.58073 13.4248 9.16146 13.3405 8.79688 13.1719C8.43685 12.9987 8.15658 12.8005 7.95605 12.5771C7.76009 12.3538 7.66211 12.167 7.66211 12.0166C7.66211 11.9346 7.69401 11.8776 7.75781 11.8457C7.82617 11.8092 7.89909 11.8092 7.97656 11.8457C8.22721 11.9779 8.51204 12.1055 8.83105 12.2285C9.15006 12.3516 9.55794 12.4131 10.0547 12.4131C10.5514 12.4131 10.9593 12.3516 11.2783 12.2285C11.6019 12.1055 11.8867 11.9779 12.1328 11.8457C12.2103 11.8092 12.2832 11.8092 12.3516 11.8457C12.4199 11.8776 12.4541 11.9346 12.4541 12.0166C12.4541 12.167 12.3538 12.3538 12.1533 12.5771C11.9528 12.8005 11.6725 12.9987 11.3125 13.1719C10.9525 13.3405 10.5332 13.4248 10.0547 13.4248ZM8.03809 9.44629C7.82389 9.44629 7.63704 9.3597 7.47754 9.18652C7.32259 9.01335 7.24512 8.79004 7.24512 8.5166C7.24512 8.24772 7.32259 8.02669 7.47754 7.85352C7.63704 7.67578 7.82389 7.58691 8.03809 7.58691C8.25228 7.58691 8.44141 7.67578 8.60547 7.85352C8.76953 8.02669 8.85156 8.24772 8.85156 8.5166C8.85156 8.79004 8.76953 9.01335 8.60547 9.18652C8.44141 9.3597 8.25228 9.44629 8.03809 9.44629ZM12.0713 9.44629C11.8571 9.44629 11.6702 9.3597 11.5107 9.18652C11.3558 9.01335 11.2783 8.79004 11.2783 8.5166C11.2783 8.24772 11.3558 8.02669 11.5107 7.85352C11.6702 7.67578 11.8571 7.58691 12.0713 7.58691C12.2855 7.58691 12.4746 7.67578 12.6387 7.85352C12.8027 8.02669 12.8848 8.24772 12.8848 8.5166C12.8848 8.79004 12.8027 9.01335 12.6387 9.18652C12.4746 9.3597 12.2855 9.44629 12.0713 9.44629Z"})]})})},536612:(e,t,o)=>{o.d(t,{A:()=>n});class s extends(()=>o(959180))().A{}const n=new s},577009:(e,t,o)=>{o.d(t,{rU:()=>m,QB:()=>i,hR:()=>c,pT:()=>l,JN:()=>u,i8:()=>r,Wt:()=>d,Sx:()=>a});var s=()=>o(645873);const n=new(s().O2)("notifications",(()=>Promise.all([o.e(75134),o.e(43380),o.e(96346),o.e(55373),o.e(36192),o.e(44711),o.e(62475),o.e(3151),o.e(16471),o.e(53321),o.e(58550),o.e(98629),o.e(90825),o.e(37353),o.e(29151),o.e(31895),o.e(83647),o.e(49889),o.e(97727),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(4422),o.e(28721),o.e(28866),o.e(21194),o.e(6463),o.e(71993),o.e(1213),o.e(17989),o.e(90625),o.e(59794),o.e(78846),o.e(26483),o.e(43741),o.e(81768),o.e(94387),o.e(82850),o.e(52393),o.e(77692),o.e(75601),o.e(11341),o.e(7060),o.e(82136),o.e(12739),o.e(26090),o.e(73594),o.e(93282),o.e(12341),o.e(50984),o.e(66984),o.e(40828),o.e(26199),o.e(18057),o.e(90978),o.e(56264),o.e(5023),o.e(55927),o.e(61151),o.e(72226),o.e(48199),o.e(60499),o.e(24593),o.e(89686),o.e(85314),o.e(23844),o.e(19632),o.e(6893)]).then(o.bind(o,241637)))),i=(0,s()._h)(n,(e=>e.GetNotifiedFor)),r=(0,s()._h)(n,(e=>e.TopbarUpdatesMenu)),a=(0,s()._h)(n,(e=>e.UpdateSidebar)),l=(0,s()._h)(n,(e=>e.MobileInboxPopup)),c=(0,s()._h)(n,(e=>e.InboxActionsMenu)),d=((0,s()._h)(n,(e=>e.InboxNotificationSettingsButton)),(0,s()._h)(n,(e=>e.UnreadMentionsBadge))),u=(0,s()._h)(n,(e=>e.NotificationInboxPanelContent)),m=(0,s()._h)(n,(e=>e.AnimatedEmojiBadge))},671089:(e,t,o)=>{o.r(t),o.d(t,{checkmarkCircleIcon:()=>i,iconDefinition:()=>n});o(296540);var s=o(474848);const n={viewBox:"0 0 20 20",svg:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:"M12.876 7.982a.625.625 0 1 0-1.072-.644L9.25 11.595 7.815 9.92a.625.625 0 0 0-.95.813l2 2.334a.625.625 0 0 0 1.01-.085z"}),(0,s.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},i=(0,o(340498).wt)("checkmarkCircle",n)}}]);