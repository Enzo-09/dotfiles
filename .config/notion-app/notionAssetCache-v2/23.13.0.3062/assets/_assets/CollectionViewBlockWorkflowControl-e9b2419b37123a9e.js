"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72535],{390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>T,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>k,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>A,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>b,RRULE_WEEKDAYS_MAP:()=>g,adjustedStartDateIfPossible:()=>C,areRecurrenceSchedulesEqual:()=>B,convertFromUnpersistedRecurrenceConfig:()=>U,convertToUnpersistedRecurrenceConfig:()=>S,getFormattedEndCondition:()=>N,getFormattedNextRecurrenceTime:()=>I,getNewEndTimestamp:()=>D,getNextDateUtc:()=>x,getRecurrenceAfter:()=>E,isRunningBetweenMidnightAnd3AM:()=>R,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>_,rruleFromRecurrence:()=>w,templateAncestorsViolateRecurrenceNesting:()=>M});n(898992),n(354520),n(581454);var r=()=>n(244641);n(944114);function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...o(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),s=()=>n(720665),c=()=>n(597777),d=()=>n(869190),l=()=>n(416504),u=()=>n(402390);class m extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>n(912720);const f=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),h={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},g={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},y=99,b=999;function v(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function _(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=b}function w(e){const{start_date:t,frequency:n,interval:r,weekdays:i,timezone:s,hour:d,minute:l}=e,u="week"===n&&i?i.map((e=>g[e])):void 0,p={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return g[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new m({freq:h[n],dtstart:(0,c().eU)(t),interval:r,byweekday:u,tzid:s,byhour:d??0,byminute:l??0,bysecond:0,...p})}const A=1,k=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>A,a=n.length>=k;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function C(e){var t;const{recurrence:n,afterDate:o}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=o)return n;let i=r().c9.fromMillis(n.start_date,{zone:"utc"});const a=r().c9.fromMillis(o,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,c().DH)(i.toMillis())}}function E(e){const{recurrence:t,afterDate:n}=e;if((0,p().wt)(t)){const e=(0,c().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=w(C({recurrence:t,afterDate:n})).after((0,c().eU)(n));if(!e)return;return(0,c().h1)(e)}}function R(e){return 0===e.hour||1===e.hour||2===e.hour}function x(e){return w(e).after((0,c().eU)((0,c().Rz)()))||void 0}function I(e){const{recurrence:t,intl:n}=e,o=x(U(t));if(!o)return;const i=R(t),a=r().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),s=(0,d().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(r().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(f.dateAtTime,{date:s,time:e})}}function N(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,d().Yq)({date:r().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const T=100;function S(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function D(e,t,n){return e.plus(n-t)}function j(e,t){const n=r().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(n.toJSDate())}}function U(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?j(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function B(e,t){const n=i().fN(e,(e=>void 0!==e)),r=i().fN(t,(e=>void 0!==e));return i().n4(n,r)}},725649:(e,t,n)=>{function r(e){return!(!e||"askUserToPick"in e)}function o(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>o,K$:()=>r,j6:()=>i})},818434:(e,t,n)=>{n.r(t),n.d(t,{CollectionViewBlockWorkflowControl:()=>j});n(944114),n(581454);var r=n(296540),o=()=>n(484714),i=()=>n(847249),a=()=>n(401497),s=()=>n(584262),c=n(474848);const d={viewBox:"0 0 20 20",svg:(0,c.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125z"})},l=(0,n(340498).wt)("appFill",d);var u=()=>n(179034),m=()=>n(519831),p=()=>n(743246),f=()=>n(99895),h=()=>n(959013),g=()=>n(857783),y=()=>n(751156),b=()=>n(630116),v=()=>n(392012),_=()=>n(46986),w=()=>n(493823),A=()=>n(760217),k=()=>n(406699),M=()=>n(331542),C=()=>n(678553),E=()=>n(939740),R=()=>n(614505),x=()=>n(16006),I=()=>n(89924),N=(n(898992),n(672577),()=>n(187174)),T=()=>n(386164),S=()=>n(68263),D=()=>n(449506);function j(e){const{store:t,style:n}=e,d=(0,o().v3)(),A=(0,i().K8)((()=>(0,_().sx)()),[]),j=function(e){const t=(0,o().v3)(),[n,r]=(0,i().K8)((()=>[e.getSpaceId(),e.getAllSourceCollectionStores()]),[e]),[a]=(0,N().Yb)((async()=>{const e=await D().callApi({environment:t,eventName:"getWorkflowsForCollections",data:{collectionIds:r.map((e=>({id:e.id,spaceId:n})))},headers:(0,T().WS)({cellId:void 0,spaceId:n})});return"success"===e.type?e.data.workflowResults:[]}),[t,n,r]);return(0,i().K8)((()=>{const t=new Map(r.map((e=>[e.id,e])));return"resolved"!==a.status?a:{status:"resolved",value:a.value.map((n=>{const{collectionId:r,botId:o}=n,i=t.get(r);if(!i)return{...n,access:"none"};const a=[...i.getPermissionItems(),...e.getPermissionItems()].find((e=>"bot_permission"===e.type&&e.bot_id===o)),s=null==a?void 0:a.role;let c="none";return s&&(0,S().p2)(s)?c="write":s&&(0,S().Tt)(s)&&(c="read"),{...n,access:c}}))}}),[e,a,r])}(t),U=(0,a().IS)((e=>({appContainer:{maxHeight:250,overflowY:"scroll"},appItem:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"}})),[]),L=(0,i().K8)((()=>{if("resolved"!==j.status)return[];const e=new(f().G)((()=>[]));for(const t of j.value)e.get(t.collectionId).push(t);const n=Array.from(e.entries()).map((e=>{let[n,o]=e;const i=b().md.createChildStore(t,{table:m().Vl,id:n,spaceId:t.getSpaceId()});return{key:n,items:o.map((e=>{let{blockId:n,workflowId:o,access:a}=e;const l=b().Bv.createChildStore(t,{table:u().ev,id:n,spaceId:t.getSpaceId()}),m=b().NU.createChildStore(t,{table:p().C0,id:o,spaceId:t.getSpaceId()});return{key:n,render:e=>(0,r.createElement)(C().Ay,{...e,key:n,title:(0,c.jsxs)(w().p,{style:U.appItem,onClick:()=>{g().uK({environment:d,store:l,openInNew:"tab",pageVisitSource:s().y8.CollectionViewBlockWorkflowControl})},children:[(0,c.jsx)(R().B,{disabled:!0,icon:l.getIcon(),isEmptyPage:!1,size:18}),(0,c.jsx)(x().A,{store:l})]}),right:(0,c.jsx)(B,{access:a,disabled:!i.canAdmin(),onChange:async e=>{await m.load(),y().createAndCommit({environment:d,canUndo:!1,userAction:"CollectionViewBlockWorkflowControl.updateAccessScope",perform:t=>{(0,v().dd)({workflowStore:m,collectionStore:i,newAccess:e,transaction:t})}})}})}),action:()=>{}}})),render:e=>{let{children:t,...n}=e;return(0,c.jsx)(I().A,{title:(0,c.jsx)(x().A,{store:i}),...n,children:t})}}}));return n}),[d,t,j,U]);return"pending"===j.status?(0,c.jsx)(M().A,{size:"sm"}):"rejected"===j.status||"idle"===j.status?null:A?0===j.value.length?null:(0,c.jsx)(k().Ay,{popupType:k().z7.Popup,renderOrigin:e=>(0,c.jsx)(w().p,{...e,style:n,isLightGray:!0,icon:l,children:(0,c.jsx)(h().sA,{id:"collectionViewBlock.workflow.apps",defaultMessage:"{count, plural, one {1 app} other {{count} apps}}",values:{count:j.value.length}})}),render:()=>(0,c.jsx)(E().Ay,{style:U.appContainer,type:E().Oh.Vertical,sections:L,initialFocus:0})}):null}const U={read:(0,c.jsx)(h().sA,{id:"accessButton.read",defaultMessage:"Read"}),write:(0,c.jsx)(h().sA,{id:"accessButton.write",defaultMessage:"Write"}),remove:(0,c.jsx)(h().sA,{id:"accessButton.remove",defaultMessage:"Remove"})};function B(e){const{access:t,disabled:n,onChange:r}=e,o=(0,a().IS)((e=>({container:{width:200},redButtonMenuItem:{color:e.text.uiRedPrimary}})),[]),i=e=>{switch(e){case"read":return U.read;case"write":return U.write;case"none":return null}},s=e=>[{key:"access-scope",render:e=>(0,c.jsx)(I().A,{...e,topBorder:!1}),items:[{key:"write",render:e=>(0,c.jsx)(A().A,{...e,title:U.write}),action:()=>{r("write"),e()}},{key:"read",render:e=>(0,c.jsx)(A().A,{...e,title:U.read}),action:()=>{r("read"),e()}}]},{key:"remove-access",render:e=>(0,c.jsx)(I().A,{...e,topBorder:!0}),items:[{key:"remove",render:e=>(0,c.jsx)(A().A,{...e,style:o.redButtonMenuItem,title:U.remove}),action:()=>{r("none"),e()}}]}];return(0,c.jsx)(k().Ay,{popupType:k().z7.Popup,renderOrigin:e=>(0,c.jsx)(w().p,{...e,isLightGray:!0,disabled:n,children:i(t)}),render:e=>{let{close:n}=e;return(0,c.jsx)("div",{style:o.container,children:(0,c.jsx)(E().Ay,{type:E().Oh.Vertical,sections:s(n),initialFocus:"write"===t?0:1})})}})}},972261:(e,t,n)=>{n.d(t,{Fl:()=>s,KI:()=>l,PI:()=>o,S:()=>c,Tq:()=>p,_u:()=>i,e5:()=>a,fK:()=>u,fl:()=>r,lF:()=>d});n(898992),n(672577);const r=["slack","google_drive","github","jira","sharepoint","microsoftTeams","gmail","linear"],o=["slack","googleDrive","github","jira","microsoftTeams","sharepoint","gmail","linear","web","githubCode"],i="7c57d10c-00cc-48bc-a552-fb3911dd7745",a="1031cb6c-4935-4cc1-9c08-c9a4ecaae323",s="65683ef9-c923-4a14-8c5b-bfcf591cf5a1",c="c1f230b1-6635-4ab0-a3f5-f7eb105a87c3",d="c91548d4-25d0-44a2-ab2e-19f6f0b11d96",l="1724f2a1-f543-43a7-82af-8a0f85bda112",u="07351274-83bb-4118-9f5b-9d75f0453999",m=[{regex:/https:\/\/(?<workspace>[\w-]+)\.slack\.com\/archives\/(?<channel>[^\/]+)\/p(?<timestamp>\d+)(\?thread_ts=(?<thread_ts>\d+\.\d+)&cid=(?<cid>[^\/]+))?/,type:"slack"},{regex:/https:\/\/docs\.google\.com\/(?<fileType>document|spreadsheets|presentation)\/d\/(?<fileId>[a-zA-Z0-9_-]+)(?:\/\S*)?/,type:"googleDrive"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?:blob|tree|blame)\/(?<branchName>[^\/]+)\/(?<codePath>[^#]+)(#(?<lineNumber>L\d+(?:C\d+)?(?:-L\d+)?))?/,type:"githubCode"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/pull\/(?<prNumber>\d+)(\/(files|commits|checks)?)?/,type:"github"},{regex:/https:\/\/app\.graphite\.dev\/github\/pr\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?<prNumber>\d+)(?:\/\S*)?/,type:"github"},{regex:/https:\/\/(?:[^\.]+)\.sourcegraphcloud\.com\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/@]+)(?:@(?<branchName>[a-f0-9]+))?\/-\/blob\/(?<codePath>[^?]+)\?(?<lineNumbers>L\d+|l\d+)?/,type:"githubCode"},{regex:/https:\/\/(?<site>[^/]+\.atlassian\.net).*?(?:browse\/|[?&]selectedIssue=)(?<issueKey>[A-Z0-9]+-\d+).*?/,type:"jira"}];function p(e){const t=m.find((t=>t.regex.test(e)));return(null==t?void 0:t.type)??"web"}}}]);