"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[51466],{3031:(e,n,t)=>{t.r(n),t.d(n,{RemoveAddOnModal:()=>C});t(16280);var r=t(296540),o=()=>t(662303),i=()=>t(484714),a=()=>t(847249),s=()=>t(869190),u=()=>t(206267),c=()=>t(762433),d=()=>t(47273),l=()=>t(323063),p=()=>t(786508),f=()=>t(166386),m=()=>t(959013),g=()=>t(496603),y=()=>t(252105),v=()=>t(436572),h=()=>t(58293),_=()=>t(224701),b=()=>t(749356),w=()=>t(807778),x=()=>t(527059),I=()=>t(231127),S=()=>t(156262),E=()=>t(30265),A=t(474848);function C(e){let{currentPeriodEnd:n,isOpen:t,onClose:g}=e;const I=(0,i().v3)(),[C,T]=r.useState("survey"),[V,j]=r.useState({reasons:[],reasonOther:void 0,reasonOtherTools:void 0}),[k,M]=r.useState(void 0),[R]=r.useState(u().JW());(0,r.useEffect)((()=>y().u4(I,{name:"churn_survey",args:{churnType:"ai",reasons:V.reasons,reasonOther:V.reasonOther,reasonOtherTools:V.reasonOtherTools,stage:C,churnSurveyId:R}})),[I,C,V,R]);const B=(0,h().r)(),q=Boolean((0,a().K8)((()=>null==B?void 0:B.canAdmin()),[B])),P=(0,x().lh)({spaceId:null==B?void 0:B.id}),D=(0,a().K8)((()=>(0,c().Rz)(P)),[P]),Q=(0,c().qd)({billingData:P,canUpdateBilling:q}),U=n?(0,s().W_)(n,"long",o().locale):void 0,z=r.useCallback((()=>{y().u4(I,{name:"churn_survey_close",args:{churnSurveyId:R}}),g()}),[R,I,g]);return(0,A.jsx)(E().W,{step:C,isOpen:t,onClose:z,children:(()=>{switch(C){case"survey":return(0,A.jsx)(S().lU,{options:O(),onSubmit:async e=>{y().u4(I,{name:"churn_survey_submitted",args:{churnType:"ai",reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0,stage:C,churnSurveyId:R}}),j((n=>({...n,reasons:e.reasons,reasonOther:e.customTextByReason.other??void 0,reasonOtherTools:e.customTextByReason.using_another_ai_service??void 0})));const n=await b().z6(I,{spaceId:null==B?void 0:B.id,offerCampaign:"ai_fifty_percent_downgrade"}),t=(0,p().RS)(n);return t&&(0,f().J5)(t)?(M(t),void T("offer")):T("downgrade")}});case"offer":return k?(0,A.jsx)(S().hL,{currentProduct:"ai",secondaryButtonMessage:(0,A.jsx)(m().sA,{id:"removeAddOnModal.cancelAnyway",defaultMessage:"Cancel anyway"}),newProduct:"free",coupon:k,onSubmit:async e=>{if(e){y().u4(I,{name:"offer_accepted",args:{coupon:k}});const e=null==B?void 0:B.id;if(D&&e&&Q&&(0,f().J5)(k))return(0,w().S7)()?await b().VY({environment:I,spaceId:e,offerCampaign:"ai_fifty_percent_downgrade",entrypoint:"ai_downgrade_flow"}):await b().Qm(I,{customerId:D,coupon:k,offerType:"add_on_downgrade_flow"}),z(),void v().D6({label:(0,A.jsx)(m().sA,{id:"applyCoupon.success",defaultMessage:"Coupon successfully applied"})})}T("downgrade")}}):void T("downgrade");case"downgrade":return(0,A.jsx)(S().kv,{title:(0,A.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.title",defaultMessage:"Remove AI at the end of your billing period?"}),description:U?(0,A.jsx)(m().sA,{id:"addOnCancellationStep.cancellation.description",defaultMessage:"If you continue with the downgrade, you will continue to enjoy Notion AI until the end of your billing period on <bold>{periodEnd}</bold>. You can resubscribe anytime.",values:{periodEnd:U,bold:e=>(0,A.jsx)("b",{children:e})}}):null,onSubmit:async()=>{if(y().u4(I,{name:"continue_downgrade_button_clicked"}),P&&B){const e=(0,c().lQ)(P),n=(0,l().gL)(e,"ai");await(0,_().nV)({environment:I,spaceStore:B,from:"billing_page",desiredState:n})}T("confirmation")}});case"confirmation":if(P){const e=(0,c().lQ)(P);if(Boolean((0,d().yp)(e,"ai")))throw new Error("Notion AI is not cancelled or scheduled to be cancelled")}return(0,A.jsx)(S().Qe,{title:(0,A.jsx)(m().sA,{id:"downgradeFlow.confirmationStep.ai.title",defaultMessage:"Notion AI has been removed"}),formattedPeriodEndDate:U})}})()})}function O(){return[...(0,g().k4)([I().V.tooExpensive,I().V.missingFeatures,I().V.upgradedByMistake,I().V.tooDifficult,I().V.notUsingEnough,I().V.qualityOfResults,I().V.usingAnotherAiService,I().V.dataSecurity]),I().V.other]}},323063:(e,n,t)=>{t.d(n,{HO:()=>f,V5:()=>u,Vr:()=>c,ef:()=>p,gL:()=>d,ng:()=>y,vH:()=>l,vk:()=>g,z2:()=>m});t(16280),t(269479),t(898992),t(354520),t(672577),t(581454),t(737550);var r=()=>t(720665),o=()=>t(762433),i=()=>t(47273),a=()=>t(622963),s=()=>t(979340);function u(e,n){return f(e.items,n.items).some((e=>{let[n,t]=e;return function(e,n){if(!e)return!1;if(!n)return!0;const t=o().xp(e),r=o().xp(n);if(!t||!r)return!1;return s().o3[t]>s().o3[r]}(n,t)}))}function c(e,n,t){let{trialEnd:r,items:o}=n;return{trialEnd:r,items:o.map((n=>{const r=n.price.product,o=n.price.unitAmount.currencyCode,i=g(e,{interval:t,product:r,currency:o});return{...n,price:i}}))}}function d(e,n){const t=e.items.filter((e=>o().IE(e)!==n));return{...e,items:t}}function l(e,n,t){const{isMay13PackagingChangesEnabled:r}=t,i=o().IE(n),a=n.price.product,s=e.items.filter((e=>{const n=e.price.product,t=o().IE(e);return!(i===t)&&!(r&&"ai"===n&&("business"===a||"enterprise"===a))}));return{...e,items:s.concat([n])}}function p(e){const{state:n,prices:t,quantities:r,params:{interval:i,currency:a},products:s,flags:{isMay13PackagingChangesEnabled:u}}=e,c=s.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),d=c.map((e=>o().Mr(e))),l=n.items.filter((e=>{const n=e.price.product,t=o().IE(e),r=d.includes(t),i=u&&"ai"===n&&(c.includes("business")||c.includes("enterprise"));return!r&&!i})),p=c.map((e=>y(g(t,{interval:i,currency:a,product:e}),r)));return{...n,items:l.concat(p)}}function f(e,n){return(0,r().Z4)(e,(e=>o().IE(e)),n,(e=>o().IE(e)))}function m(e){const{prices:n,billingData:t,product:r}=e,a=o().Ry(t),s=o().lQ(t),u=i().yw(s),c=o().q8(t),d=u??c;return n.find((e=>e.product===r&&e.billingInterval===d&&e.unitAmount.currencyCode===a))}function g(e,n){let{interval:t,product:r,currency:o}=n;return function(e,n){if(null==e)throw new Error(n);return e}(e.find((e=>e.product===r&&e.billingInterval===t&&e.unitAmount.currencyCode===o)),`Unable to find price with interval: ${t}, product: ${r}, currency: ${o}`)}function y(e,n){const{numSeats:t,numCustomHostnames:r}=n;return"public_domain_custom_hostnames"===(0,a().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:t}}}}]);