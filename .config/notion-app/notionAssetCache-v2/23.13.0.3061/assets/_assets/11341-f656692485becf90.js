"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11341],{51473:(e,t,n)=>{n.d(t,{A:()=>o});n(898992),n(672577);class a extends(()=>n(757695))().default{getInitialState(){return{open:!1}}close(){this.state.open&&this.setState({open:!1})}open(e){let{oldTier:t,newTier:a,oldAddOns:o,newAddOns:r}=e;if(function(e){if(!e)return!1;return["plus","enterprise","business","student"].includes(e)}(a)){if(function(e,t){if(!e||!t)return!1;return"upgrade"===(0,n(979340).qR)({oldTier:e,newTier:t})}(t,a))return this.setState({productUpgrade:a,open:!0}),!0}if(r.length>o.length){const e=r.find((e=>!o.includes(e)));if(function(e){if(!e)return!1;return["ai"].includes(e)}(e))return this.setState({productUpgrade:e,open:!0}),!0}return!1}}const o=new a},112527:(e,t,n)=>{n.r(t),n.d(t,{getLegacyStripeAppearance:()=>k,getStripe:()=>S,injectStripe:()=>y,optionalPaymentMethodIdGivenPaymentData:()=>T,optionalStripeTokenGivenPaymentData:()=>B,stripeElementLocaleGivenNotionLocale:()=>w,translateStripeError:()=>x,useElementsOptions:()=>I});var a=()=>n(624119),o=()=>n(37458),r=n(296540),i=()=>n(484714),s=()=>n(847249),d=()=>n(401497),c=()=>n(402390);var l=()=>n(798880),u=()=>n(807487),p=()=>n(534177),m=()=>n(284371),g=()=>n(780054),f=()=>n(351360),h=()=>n(508496),b=n(474848);let v=null;function y(e){return function(t){const[n]=r.useState(S);return(0,b.jsx)(a().Elements,{stripe:n,children:(0,b.jsx)(a().ElementsConsumer,{children:n=>{let{stripe:a,elements:o}=n;const r={...t,stripe:a,elements:o};return(0,b.jsx)(e,{...r})}})})}}async function S(){return v||(o().loadStripe.setLoadParameters({advancedFraudSignals:!1}),v=(0,o().loadStripe)(g().A.stripe.key)),v}function w(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function I(e){const t=(0,d().DP)(),n=(0,i().v3)(),{type:a}=e,o="setup"===a||"subscription"===a?e.currency:void 0,g="subscription"===a?e.amount:void 0,b=(0,s().K8)((()=>{var e;return(null===(e=f().default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||c().q}),[]),v=(0,s().K8)((()=>"KRW"===o&&function(e){const{experimentService:t,actor:n}=e;return t.checkGate({actor:n,gateName:"kr_card_payment_method"})}({experimentService:h().default,actor:{table:l().oo,id:n.currentUser.id??""}})),[n.currentUser,o]);return(0,r.useMemo)((()=>{const e=function(e){const t=A(e.text.primary),n=A(e.text.secondary),a=A(e.text.tertiary),o=A(e.text.uiRedPrimary),r=A(e.text.uiBluePrimary),i=A(e.icon.contrast),s=A(e.whiteButtonBackground);return{labels:"above",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"12px",spacingGridColumn:"12px",spacingUnit:"4px",spacingTab:"6px",colorPrimary:t,colorPrimaryText:t,colorText:t,colorTextSecondary:n,colorTextPlaceholder:a,colorIcon:t,colorIconCheckmark:i,colorDanger:o,colorBackground:s,colorIconTabHover:t,colorIconTabSelected:r,colorIconChevronDown:t,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.medium}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"500",lineHeight:"16px",color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground},".Tab:focus":{boxShadow:e.outlineBlueInputBoxShadow},".Tab--selected, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:t,boxShadow:"none",outline:"none"},".Tab--selected:hover":{backgroundColor:e.whiteButtonBackground,color:t},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.outlineBlueInputBoxShadow},".Input":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",padding:"7px 8px",backgroundColor:e.surface.wash,boxShadow:`0 0 0 1px ${e.stroke.primary}`,border:"none",color:t},".Input--invalid":{color:t,boxShadow:e.outlineRedInputBoxShadow},".Input:focus":{color:t,boxShadow:e.outlineBlueInputBoxShadow},".Label":{fontSize:"12px",lineHeight:"15px",fontWeight:"500",letterSpacing:"-0.154px",color:n,marginBottom:"8px"},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:o},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:t},".PickerItem:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:t,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--selected:hover":{boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:t},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:n,fontSize:"10px",fontWeight:"400",lineHeight:"13px",letterSpacing:"0.12px"},".CheckboxLabel":{color:t,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:t,fontWeight:"400",padding:"4px 8px"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.outlineBlueInputBoxShadow},".MenuIcon, .MenuIcon:hover":{fill:t},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",padding:"16px"},".Icon":{fill:t}}}}(t),n={appearance:e,locale:w(b)},r={paymentMethodTypes:(0,u().VV)({currency:o,isKrCardFeatureGateEnabled:v})};switch(a){case"address":return n;case"setup":return{...n,...r,currency:null==o?void 0:o.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"};case"subscription":return{...n,...r,amount:g,currency:null==o?void 0:o.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session",loader:"never"};default:(0,p().HB)(a)}}),[t,b,o,v,a,g])}function x(e,t){if(!t.code)return t.message||"";switch(t.code){case"invalid_expiry_year_past":return e.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return e.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(e,t.decline_code);default:return t.message||""}}function k(e){return{labels:"floating",theme:"dark"===e.mode?"night":"stripe",variables:{spacingGridRow:"8px",spacingGridColumn:"8px",spacingUnit:"4px",spacingTab:"4px",colorPrimary:e.text.primary,colorPrimaryText:e.text.primary,colorText:e.text.primary,colorTextSecondary:e.text.secondary,colorTextPlaceholder:e.text.tertiary,colorIcon:e.text.primary,colorIconCheckmark:e.icon.contrast,colorDanger:e.text.uiRedPrimary,colorBackground:e.whiteButtonBackground,colorIconTabHover:e.text.primary,colorIconTabSelected:e.text.uiBluePrimary,colorIconChevronDown:e.text.primary,fontFamily:m().Tf.sans,fontWeightLight:`${m().Wy.light}`,fontWeightNormal:`${m().Wy.regular}`,fontWeightMedium:`${m().Wy.medium}`,fontWeightBold:`${m().Wy.semibold}`,fontSizeBase:"14px",fontSizeSm:"12px",colorLogo:e.mode,colorLogoBlock:e.mode,colorLogoTab:e.mode,colorLogoTabSelected:e.mode,borderRadius:"6px"},rules:{".Tab":{padding:"10px 16px 10px 10px",fontSize:"13px",fontWeight:"510",lineHeight:"16px",color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",backgroundColor:e.whiteButtonBackground},".Tab:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary},".Tab:focus":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:e.outlineBlueInputBoxShadow},".Tab--selected, .Tab--selected:hover, .Tab--selected:active":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,color:e.text.primary,boxShadow:"none",outline:"none"},".Tab--selected:focus":{border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:e.outlineBlueInputBoxShadow},".Input":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",padding:"4px 8px",boxShadow:"none",backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,color:e.text.primary},".Input--invalid":{border:"none",color:e.text.primary,boxShadow:e.outlineRedInputBoxShadow},".Label":{fontSize:"14px",lineHeight:"18px",letterSpacing:"-0.154px",color:e.text.tertiary},".Label--floating":{fontSize:"10px",fontWeight:"510",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease",color:e.text.secondary},".Error":{fontSize:"12px",fontWeight:"400",lineHeight:"15px",color:e.text.uiRedPrimary},".CodeInput":{backgroundColor:e.surface.wash,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem, .PickerItem--selected":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary},".PickerItem:hover, .PickerItem--selected:hover":{backgroundColor:e.whiteButtonHoveredBackground,color:e.text.primary,border:`1px solid ${e.stroke.primary}`,boxShadow:"none"},".PickerItem--new":{fontSize:"14px",fontWeight:"500",lineHeight:"18px",color:e.text.primary},".PickerItem--highlight, .PickerItem--highlight:hover":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.uiBluePrimary}`,boxShadow:"none"},".PickerItem--highlight:hover":{backgroundColor:e.whiteButtonHoveredBackground},".TermsText":{color:e.text.secondary,fontSize:"12px",fontWeight:"400",lineHeight:"15px"},".CheckboxLabel":{color:e.text.primary,fontSize:"12px",fontWeight:"500",lineHeight:"15px"},".Action, .MenuAction":{color:e.text.primary,fontWeight:"400"},".Action:hover, .MenuAction:hover":{backgroundColor:e.buttonHoveredBackground},".BlockAction:focus, .CodeInput:focus, .Input:focus,.CheckboxInput:focus, .PickerItem:focus, .PickerAction:focus,.MenuAction:focus, .Action:focus, .SecondaryLink:focus":{boxShadow:e.outlineBlueInputBoxShadow},".MenuIcon, .MenuIcon:hover":{fill:e.text.primary},".Block":{backgroundColor:e.whiteButtonBackground,border:`1px solid ${e.stroke.primary}`,boxShadow:"none",color:e.text.primary}}}}function A(e){const[t,n,a,o]=e.match(/[\d.]+/g)??[];return t&&n&&a&&o&&1===parseInt(o)?`rgb(${t}, ${n}, ${a})`:e}function B(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function T(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}},411341:(e,t,n)=>{n.r(t),n.d(t,{applyStudentGitHubGrant:()=>Ne,cancelSubscription:()=>Se,closeSubscriptionUpgradeModal:()=>Me,handlePaymentIntentNextActions:()=>_e,handlePlanChangeClick:()=>De,openSubscriptionUpgradeModal:()=>Ce,openSubscriptionUpgradeModalForClaimAndUpgrade:()=>Pe,payUnpaidInvoice:()=>he,refresh:()=>ke,refreshBillingHistory:()=>Be,trackSubscriptionUpdate:()=>ge,updateAddress:()=>be,updateBillingEmail:()=>ye,updateCurrentSpace:()=>xe,updatePaymentMethod:()=>fe,updateSubscription:()=>pe,updateSubscriptionToEducationPlan:()=>Ie,updateVatId:()=>ve});n(16280),n(296540);var a=()=>n(857639),o=()=>n(206267),r=()=>n(763884),i=()=>n(386164),s=()=>n(762433),d=()=>n(47273),c=()=>n(323063),l=()=>n(166386);var u=()=>n(959013),p=()=>n(496603),m=()=>n(534177),g=()=>n(252105),f=()=>n(449506),h=()=>n(934839),b=()=>n(901389),v=()=>n(496414),y=()=>n(209660),S=()=>n(662453),w=()=>n(680074),I=()=>n(972435),x=()=>n(965378),k=()=>n(719431),A=()=>n(529803),B=()=>n(351360),T=()=>n(780262),C=()=>n(57605),M=()=>n(21735),P=()=>n(508496),D=()=>n(975971),_=()=>n(150193),E=()=>n(589994),N=()=>n(613240),U=()=>n(151059),H=()=>n(630116),W=()=>n(404141),L=()=>n(506090),O=()=>n(596513),$=()=>n(762299);const F=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async function(e,t){let{spaceId:a}=t;const o=await Promise.resolve().then(n.bind(n,449506)),r=await o.callApi({eventName:"countUsers",environment:e,data:{spaceId:a}});return"success"===r.type?r.data:void 0}));n(604341).exposeDebugValue("UserCountsStore",F);var R=()=>n(271084),V=()=>n(807778),j=()=>n(263928),z=()=>n(779795),G=()=>n(72256);n(898992),n(354520),n(672577),n(581454);var q=()=>n(112527),Y=()=>n(134217),K=()=>n(10984),Q=()=>n(995604),J=()=>n(430395),Z=()=>n(805061),X=()=>n(51473),ee=()=>n(981046),te=()=>n(749240),ne=()=>n(921997),ae=()=>n(941541);async function oe(e){const{environment:t,spaceId:n}=e,a=(0,ne().GM)({spaceId:n});if(!se||se!==a){let n;!function(e){ie&&ae().Ay.removeListener(ie,e)}(t);const o=t=>{let{value:a}=t;void 0!==n&&n!==a&&re(e),n=a},r=p().nF(o,5e3);ie=ae().Ay.addListener(a,void 0,r,void 0,t),se=a;const i=A().A.state;if(!Object.keys(i).length)return re(e)}}async function re(e){const{environment:t,spaceId:n}=e;if((0,Y().e9)(t,n))return;const a=await f().callApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},headers:(0,i().WS)({cellId:void 0,spaceId:n})});var o;"success"===a.type&&((null===(o=B().default.state.currentSpaceStore)||void 0===o?void 0:o.id)===n&&A().A.setState(a.data.bannerData));const r=await f().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var s;"success"===r.type&&((null===(s=B().default.state.currentSpaceStore)||void 0===s?void 0:s.id)===n&&T().A.setState(r.data))}let ie,se;var de=()=>n(128265),ce=n(474848);const le="SubscriptionData",ue=(0,u().YK)({updatingSubscription:{id:"subscriptionSettings.updatingSubscriptionMessage",defaultMessage:"Updating your subscription…"},paymentMethodUpdateAuthFailed:{id:"subscriptionSettings.paymentMethodUpdateAuthFailedMessage",defaultMessage:"We could not update your payment method. Please try again or contact support."},verifyingEligibility:{id:"subscriptionSettings.verifyingEligibilityMessage",defaultMessage:"Verifying eligibility…"},educationPlusFree:{id:"subscriptionSettings.educationPlusFreeMessage",defaultMessage:"You are now subscribed to Notion's Education plan for free"},finishingUp:{id:"subscription.upgrade.finishing",defaultMessage:"Finishing up..."}});async function pe(e){const{from:t,environment:n,spaceStore:a,billingEmail:o,paymentData:r,vatId:i,coupon:d,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:g,addressState:S,addressCountry:w,promoCodeId:I,useTestClock:x,sessionId:k,inAppOffer:A,desiredState:B,trialData:T}=e;h().Re({bannerStore:_().A}),v().m({message:ue.updatingSubscription});if(!te().subscriptionDataStoreInstance.state)throw new Error("Subscription data not loaded.");const M=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!M)throw new Error("Billing data not loaded");const P=(0,s().PP)(M),{plan:D,addOns:E,isTrial:N}=function(e,t){if(!t)return{plan:void 0,addOns:[],isTrial:void 0};const n=e.items.filter((e=>"plan"!==(0,s().IE)(e))),a=t.items.find((e=>"plan"===(0,s().IE)(e))),o=t.items.filter((e=>"plan"!==(0,s().IE)(e)));return{isTrial:Boolean(t.trialEnd),plan:null==a?void 0:a.price.externalId,addOns:(0,c().HO)(n,o).map((e=>{let[t,n]=e;return{isCancellation:!n,priceId:(n??t).price.externalId,quantity:null==n?void 0:n.quantity}}))}}(P,B),U=await f().callApi({eventName:"updateSubscription",environment:n,data:{spaceId:a.id,plan:D,addOns:E,billingEmail:o,paymentMethodId:(0,q().optionalPaymentMethodIdGivenPaymentData)(r),vatId:i,coupon:d,customerName:l,businessName:u,addressLine1:p,addressZip:m,addressCity:g,addressState:S,addressCountry:w,promoCodeId:I,useTestClock:x,modalSessionId:k,inAppOffer:A,isTrial:N,clientVersion:n.device.version,trialData:T,from:t}});if(v().V(),"failed"===U.type)throw b().Qg(U),new Error("An error occurred while updating subscription");await we({environment:n,spaceStore:a,newDefaultTeamId:U.data.newDefaultTeamId});const H=te().subscriptionDataStoreInstance.state,L=a.id,O=a.getPlanType(),$=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!$)throw new Error("Billing data not loaded");if(ge({environment:n,context:{spaceId:L,planType:O,from:t,isMmOrEnt:await(0,de().G)(n),trialData:T,modalId:k},oldData:M,newData:$,desiredState:B}),!H)throw new Error("Subscription data not loaded.");return Boolean(T)||me({oldTier:(0,s().AI)(M),newTier:(0,s().AI)($),oldAddOns:(0,s().ji)(M),newAddOns:(0,s().ji)($)}),W().A.state.open&&"requests"===W().A.state.currentTab&&y().Ow({currentTab:"billing"}),U.data}function me(e){return!!(0,V().Pe)()&&X().A.open(e)}function ge(e){var t;let{environment:n,context:a,oldData:o,newData:r,desiredState:i}=e;const c=(0,s().V9)(o),l=(0,s().AI)(o),u=(0,s().ji)(o),p=(0,s().q8)(o),m=(0,s().Ry)(o),f=o.email,h=(0,d().j1)(i),b=(0,d().Gf)(i),v=(0,d().V_)(i),y=(0,d().yw)(i),S=(0,d().j8)(i),I=Boolean(null==i?void 0:i.trialEnd),x=r.email,k=!(0,s().Fq)(o)&&(0,d().DS)(i),A=(0,s().Fq)(o)&&(0,d().DS)(i),B=(0,s().Fq)(o)&&!(0,d().DS)(i);k&&h?g().BK(n,{plan:h,credit_amount:0}):A?g().pT(n,{billing_email_changed:f!==x,plan_changed:h!==c,plan_current:h,plan_old:c,currency_code:S,billing_address_changed:!1}):B&&c&&g().pp(n,{plan:c}),g().xN(n,{from:a.from,action:B?"cancel":"update",spaceId:a.spaceId,isMmOrEnt:a.isMmOrEnt,planType:a.planType,addressCountry:null===(t=r.address)||void 0===t?void 0:t.country,oldSubscriptionTier:l,newSubscriptionTier:b,oldCurrency:m,newCurrency:S,oldPriceId:c,newPriceId:h,oldAddOns:u,newAddOns:v,oldBillingInterval:p,newBillingInterval:y,creditAmount:0,isProfessionalTeamUser:(0,w().YD)(),isTrial:I,trialEndDate:(0,s().i5)(o),trialData:a.trialData,modalId:a.modalId})}async function fe(e){const{environment:t,stripe:n,spaceStore:a,paymentMethodId:o}=e,r=await f().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:o}});if("failed"!==r.type){if(r.data.clientSecret&&"requires_action"===r.data.status){if("succeeded"!==await Ee({stripe:n,clientSecret:r.data.clientSecret}))return void b().f1(I().A.formatMessage(ue.paymentMethodUpdateAuthFailed));const e=await f().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:o}});if("failed"===e.type)return void b().Qg(e)}await ke(t)}else b().Qg(r)}async function he(e){const{environment:t,invoiceId:n,paymentMethodId:a}=e,o=await f().callApi({eventName:"payInvoice",environment:t,data:{invoiceId:n,paymentMethodId:a}});"failed"!==o.type||b().Qg(o)}async function be(e){const{environment:t,spaceStore:n,address:a}=e;h().Re({bannerStore:_().A}),v().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:a}});if("failed"===o.type)throw v().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await Ae(t),await ke(t),v().V()}async function ve(e){const{environment:t,spaceStore:n,vatId:a}=e;h().Re({bannerStore:_().A}),v().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:a}});if("failed"===o.type)throw v().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await Ae(t),await ke(t),v().V()}async function ye(e){const{environment:t,spaceStore:n,email:a}=e;h().Re({bannerStore:_().A}),v().m({message:ue.updatingSubscription});const o=await f().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:a}});if("failed"===o.type)throw v().V(),b().Qg(o),o.error;g().pT(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await Ae(t),await ke(t),v().V()}async function Se(e){var t;const{environment:n,spaceStore:a,from:o}=e,r=await C().A.awaitData(n,{spaceId:null==a?void 0:a.id});if(!r)throw new Error("Billing data not loaded");h().Re({bannerStore:_().A}),v().m({message:ue.updatingSubscription});const i=await f().callApi({eventName:"cancelSubscription",environment:n,data:{spaceId:a.id,cancelImmediately:e.cancelImmediately}});if("failed"===i.type)return v().V(),void b().Qg(i);const d=(0,s().V9)(r);d&&g().pp(n,{plan:d}),await we({environment:n,spaceStore:a,newDefaultTeamId:void 0});if(!te().subscriptionDataStoreInstance.state)throw new Error("Subscription data not loaded.");return g().xN(n,{from:o,action:"cancel",spaceId:a.id,oldSubscriptionTier:(0,s().AI)(r),newSubscriptionTier:void 0,oldPriceId:null===(t=(0,s().KH)(r,"plan"))||void 0===t?void 0:t.price.externalId,oldCurrency:(0,s().Ry)(r),newCurrency:void 0,oldAddOns:(0,s().ji)(r),oldBillingInterval:(0,s().q8)(r),newBillingInterval:void 0,isCancelSubscription:!0,isProfessionalTeamUser:(0,w().YD)(),trialEndDate:(0,s().i5)(r)}),v().V(),!0}async function we(e){let{environment:t,newDefaultTeamId:n,spaceStore:a}=e;if(await ke(t),await Ae(t),ee().A.reset(),t.currentUser.id&&void 0!==n){await j().u({userId:t.currentUser.id,spaceId:a.id,environment:t});const e=H().h4.createChildStore(a,{table:"team",id:n,spaceId:a.id});await e.load()}}const Ie=(0,p().sg)((async function(e){const{environment:t,spaceStore:a,code:o}=e;v().m({message:ue.verifyingEligibility});const r=te().subscriptionDataStoreInstance.state;if(!r)throw new Error("Subscription data not loaded.");const i=await f().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:o}});"failed"===i.type?b().Qg(i):i.data.isEligible?Te(r,t):n(446242).A.setState({open:!0,handlePromoCode:async e=>{v().m({message:ue.updatingSubscription});const n=await f().callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:e}});"failed"===n.type?b().Qg(n):n.data.isEligible?Te(r,t):b().f1((0,ce.jsx)(u().sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),v().V()}}),v().V()}),1e3,{leading:!0,trailing:!1});async function xe(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:a}=e,o=te().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||o&&o===n)await te().subscriptionDataStoreInstance.waitUntilLoaded();else if(A().A.setState({}),oe({environment:t,spaceId:n}),T().A.setState({}),a){const e={type:"unsubscribed_admin",users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,accountBalance:0,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1};te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,R().k.setState(e.userSimilarity),ke(t)}else ke(t)}async function ke(e,t){var n;const o=t??(null===(n=B().default.state.currentSpaceStore)||void 0===n?void 0:n.id),s=e.currentUser.id;if(!o)throw new Error("No spaceId.");{const t=`${le}:${o}:v2`,n=r().K.get({userId:s,key:t});n&&(te().subscriptionDataStoreInstance.setState(n),te().subscriptionDataStoreInstance.spaceId=o,R().k.setState(n.userSimilarity)),await async function(e){let{environment:t,spaceId:n,currentUserId:o,localKey:s}=e;await E().transactionQueue.drain();const d=P().default.checkGate({gateName:"dont_load_users"}),[c,l]=await Promise.all([f().callApi({eventName:"getSubscriptionData",environment:t,data:{spaceId:n},headers:(0,i().WS)({cellId:void 0,spaceId:n})}),d?Promise.resolve({type:"success",data:{users:[],joinedMemberIds:[],userSimilarity:{},shouldUseEdgeCache:!0},status:200}):f().callApi({eventName:"getVisibleUsers",environment:t,data:{spaceId:n,supportsEdgeCache:!0},headers:(0,i().WS)({spaceId:n})})]),u=P().default.checkGate({gateName:"users_edge_cache"});if("success"===c.type&&"success"===l.type){var p;const e={...c.data,...l.data};u&&M().A.setState({shouldUseEdgeCache:l.data.shouldUseEdgeCache});try{r().K.set({userId:o,key:s,value:e})}catch{a().log({level:"error",from:"subscriptionActions",type:"subscriptionDataTooLarge",data:{miscDataToConvertToString:{subscriptionDataJsonSize:JSON.stringify(e).length}}})}(null===(p=B().default.state.currentSpaceStore)||void 0===p?void 0:p.id)===n&&(te().subscriptionDataStoreInstance.setState(e),te().subscriptionDataStoreInstance.spaceId=n,R().k.setState(e.userSimilarity),Y().Fq(e)&&g().G3(t))}else a().log({level:"error",from:"subscriptionActions",type:"fetchSubscriptionDataFailed",data:{miscDataToConvertToString:{getSubscriptionDataResponseType:c.type,getSubscriptionDataResponseStatus:c.status,getVisibleUserResponseType:l.type,getVisibleUserResponseStatus:l.status}}});u&&M().A.state.shouldUseEdgeCache&&await F.resetData(t,{spaceId:n});await Promise.all([U().A.awaitData(t,{spaceId:n},!0),S().aiDependency.load().then((e=>{let{completionActions:a}=e;return a.maybeUpdateAiEligibility(t,n,!0)}))])}({environment:e,spaceId:o,currentUserId:s,localKey:t}),await C().A.resetData(e,{spaceId:o}),await O().t.resetData(e,{spaceId:o}),await D().A.resetData(e,{spaceId:o}),await Z().c.resetData(e,{spaceId:o})}}function Ae(e){var t;const n=null===(t=B().default.state.currentSpaceStore)||void 0===t?void 0:t.id;if(!n)throw new Error("No spaceId.");return $().A.resetData(e,{spaceId:n})}async function Be(e,t){const n=B().default.state.currentSpaceStore;if(!n)return;const a=await f().callApi({eventName:"getBillingHistory",environment:e,data:{spaceId:n.id,limit:t.state.billingEventsLimit}});"success"===a.type&&t.update((e=>({...e,billingEvents:a.data.events})))}async function Te(e,t){await ke(t),await Ae(t),ee().A.reset();const n=()=>{me({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||b().rG({message:I().A.formatMessage(ue.educationPlusFree)}),W().A.setState({...W().A.state,currentTab:"billing",defaultSubtab:void 0});const n=Y().RJ(e);g().tt(t,{plan:"student_free",old_plan:n?n.plan:void 0})};await k().shouldCreatePassword(t)?x().r({environment:t,onSubmit:n,onCancel:n}):n()}function Ce(e,t){const{subscriptionTier:n,from:a,addOnFeature:r,coupon:i,isTrial:s,dismissMobilePlansModal:d,offer:c}=t,l=o().JW();g().ae(e,{subscriptionTier:n,from:a,addOnFeature:r,currency_code:ee().A.state.selectedCurrencyCode,isTrial:s,modal_id:l}),L().A.open({from:a,subscriptionTier:n,billingInterval:"month",addOnFeature:r,coupon:i,isTrial:s,sessionId:l,dismissMobilePlansModal:d,offer:c})}function Me(e){const t=L().A.state;t.open&&(g().OC(e,{modal_id:t.sessionId}),L().A.setState({open:!1}))}function Pe(e){J().A.open(e)}async function De(e){var t;const{environment:n,product:o,spaceStore:r,from:i,pageSection:u,churnState:g,billingData:f}=e,h=await z().p_({environment:n,spaceId:r.id}),b=f.subscription;if(!(b&&(0,m().O9)(f.paymentMethod)||"free"===o))return void Ce(n,{subscriptionTier:o,from:i});const v=(0,s().lQ)(f),y=(0,s().Ry)(f),S=(0,d().yw)(v),w=(0,d().yw)(b),I=S??w,x=(null===(t=(0,s().KH)(f,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,k=(0,d().GB)({spaceId:r.id,logFunction:a().log.bind(a()),subscriptionState:v}),A=(0,d().GB)({spaceId:r.id,logFunction:a().log.bind(a()),subscriptionState:b}),B=k??A;let T;if("free"===o)T=(0,c().gL)(v,"plan");else{if(!(y&&I&&B))throw new Error("Trying to update plan on a subscription with no items");{const e=(0,V().Le)();T=(0,c().ef)({state:v,prices:h,quantities:{numSeats:B,numCustomHostnames:x},params:{currency:y,interval:I},products:[o],flags:{isMay13PackagingChangesEnabled:e}})}}if(!p().n4(v,T)){if((0,c().V5)(v,T)){if("no_churn"===g||!g)return;if((0,l().hZ)(N().A.getData(n,{spaceId:null==r?void 0:r.id}))&&(0,l().Jf)("resurrection_offer",K().AI(),w)){if(!(await(0,Q().Z)(n)))return}return 0===T.items.length?await Se({environment:n,spaceStore:r,from:i,cancelImmediately:"churn_immediately"===g}):await pe({environment:n,spaceStore:r,desiredState:T,from:i})}(0,G().o)(n,{desiredProducts:[o],from:i,analyticsArgs:{from:i,pageSection:u}})}}async function _e(e){v().m({message:ue.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:a,onFailure:o}=e,r=t.paymentIntentClientSecret;let i=t.paymentIntentStatus;r&&"requires_action"===i&&(i=await Ee({stripe:n,clientSecret:r})),"succeeded"===i||"processing"===i?null==a||a():function(e){let{status:t}=e;return["requires_payment_method","requires_source"].includes(t)}({status:i})&&(null==o||o()),v().V()}async function Ee(e){let{stripe:t,clientSecret:n}=e;const{paymentIntent:a,setupIntent:o,error:r}=await t.handleNextAction({clientSecret:n});if(a)return a.status;if(o)return o.status;if(r.payment_intent)return r.payment_intent.status;if(r.setup_intent)return r.setup_intent.status;throw new Error(`Unexpected error handling intent: ${r.message}`)}async function Ne(e){const{environment:t,data:n}=e;await f().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}},430395:(e,t,n)=>{n.d(t,{A:()=>o});class a extends(()=>n(757695))().default{getInitialState(){return{open:!1,succeeded:!1}}close(){this.setState({open:!1,succeeded:!1})}closeWithSuccess(){this.setState({open:!1,succeeded:!0})}open(e){this.setState({open:!0,temporaryBillingInterval:"month",temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},appliedPromo:void 0,error:void 0,vatApplicable:!1,calculatingTax:!1,payButtonState:"disabled",subscriptionTier:"enterprise",targetPlan:void 0,targetSpace:e,totalUpgradeCost:void 0,onlyShowAddOn:!1,sessionId:n(206267).JW(),type:n(506090).p.TargetSpace})}setAddressField(e){this.state.open&&this.setState({...this.state,temporaryAddress:{...this.state.temporaryAddress,...e},taxCalculationError:void 0})}}const o=new a},446242:(e,t,n)=>{n.d(t,{A:()=>o});class a extends(()=>n(757695))().default{getInitialState(){return{open:!1}}}const o=new a},503416:(e,t,n)=>{n.d(t,{r:()=>a});const a=(0,n(340498).xh)("arrowInCircleDown",{default:{loader:()=>n.e(96029).then(n.bind(n,973238))},small:{loader:()=>n.e(96029).then(n.bind(n,747012))},fill:{loader:()=>n.e(96029).then(n.bind(n,561604))},fillSmall:{loader:()=>n.e(96029).then(n.bind(n,613131))}},["arrow","circle","down","direction","pointer","downgrade"])},762299:(e,t,n)=>{n.d(t,{A:()=>o});const a=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:a}=t;const o=await Promise.resolve().then(n.bind(n,449506)),r=await o.callApi({eventName:"getInvoiceData",environment:e,data:{spaceId:a,type:"upcoming"}});return"success"===r.type?r.data.invoiceData:void 0}));n(604341).exposeDebugValue("UpcomingInvoiceStore",a);const o=a},805061:(e,t,n)=>{n.d(t,{c:()=>a});const a=new(n(848776).U)((e=>{let{spaceId:t}=e;return t}),(async(e,t)=>{let{spaceId:a}=t;const o=await Promise.resolve().then(n.bind(n,449506)),r=await o.callApi({eventName:"getLegacyPriceInfo",environment:e,data:{spaceId:a},headers:(0,n(386164).WS)({cellId:void 0,spaceId:a})});if("success"===r.type)return r.data}))},995604:(e,t,n)=>{n.d(t,{Z:()=>h});n(296540);var a=()=>n(449506),o=()=>n(689309),r=()=>n(49210),i=()=>n(989423),s=()=>n(351360),d=()=>n(503416),c=()=>n(959013),l=()=>n(7674),u=()=>n(719147),p=()=>n(836251),m=n(474848);function g(e){let{onAccept:t}=e;return(0,m.jsx)(l().tf,{header:(0,m.jsx)(l().YA,{iconAndTitle:(0,m.jsx)(l().ZQ,{iconGroup:d().r,iconColorName:"uiRedPrimary",title:(0,m.jsx)(c().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,m.jsx)(c().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,m.jsx)(u().A,{external:!0,href:(0,p().xS)("resurrectionLearnMore"),children:e})}})}),footer:(0,m.jsx)(l().aO,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,m.jsx)(c().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:t}],secondaryButtons:[{buttonType:"dismiss",label:(0,m.jsx)(c().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const f=406;async function h(e){var t;const n=null===(t=s().default.state.currentSpaceStore)||void 0===t?void 0:t.id;return await r().T.showAsyncModal((t=>(0,m.jsx)(o().s,{isOpen:t.isOpen,onDismiss:()=>{(0,i().u4)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:f},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,m.jsx)(g,{onAccept:async()=>{(0,i().u4)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await a().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}}}]);