"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[57613,90871],{108414:(e,t,n)=>{n.d(t,{A:()=>r});class i extends(()=>n(757695))().default{getInitialState(){return{open:!1}}}const r=new i},159026:(e,t,n)=>{n.d(t,{Ay:()=>o,NJ:()=>i,d5:()=>r});n(898992),n(354520),n(581454),n(737550);let i=function(e){return e.unselected="unselected",e.workspace_member="workspace_member",e.request_workspace_member="request_workspace_member",e.page_guest="page_guest",e.closed="closed",e}({}),r=function(e){return e[e.closed=0]="closed",e[e.share_page=1]="share_page",e[e.share_workspace=2]="share_workspace",e[e.request_workspace=3]="request_workspace",e}({});class s extends(()=>n(757695))().default{getInitialState(){return{inviteStage:r.closed,selection:i.workspace_member,order:[i.workspace_member,i.page_guest],invitedUsers:[],invitedEmailToUserIdMap:{},flowId:n(206267).JW()}}startWorkspaceInvite(){this.setState({...this.state,inviteStage:r.share_workspace,order:[i.workspace_member,i.page_guest],selection:i.workspace_member})}startRequestMembership(){this.setState({...this.state,inviteStage:r.request_workspace,order:[i.request_workspace_member,i.page_guest],selection:i.request_workspace_member})}hasGuests(){return this.state.invitedUsers.some((e=>e.isGuest))}getGuestEmails(){return this.state.invitedUsers.filter((e=>e.isGuest)).map((e=>e.email))}}const o=s},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>E,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>I,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>_,RRULE_WEEKDAYS_MAP:()=>g,adjustedStartDateIfPossible:()=>M,areRecurrenceSchedulesEqual:()=>q,convertFromUnpersistedRecurrenceConfig:()=>N,convertToUnpersistedRecurrenceConfig:()=>P,getFormattedEndCondition:()=>k,getFormattedNextRecurrenceTime:()=>C,getNewEndTimestamp:()=>D,getNextDateUtc:()=>A,getRecurrenceAfter:()=>R,isRunningBetweenMidnightAnd3AM:()=>U,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>w,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>T});n(898992),n(354520),n(581454);var i=()=>n(244641);n(944114);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===n.length)return e.map((e=>[e]));const s=[];for(const o of e)s.push(...r(n[0],...n.slice(1)).map((e=>[o,...e])));return s}var s=()=>n(496603),o=()=>n(534177),a=()=>n(720665),c=()=>n(597777),l=()=>n(869190),u=()=>n(416504),d=()=>n(402390);class m extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var v=()=>n(912720);const p=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},g={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},y=99,_=999;function h(e){return(0,a().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function w(e){return(0,a().Et)(e)&&Number.isInteger(e)&&e>0&&e<=_}function S(e){const{start_date:t,frequency:n,interval:i,weekdays:s,timezone:a,hour:l,minute:u}=e,d="week"===n&&s?s.map((e=>g[e])):void 0,v={};return(0,o().O9)(e.end_condition)&&("date"===e.end_condition.type?v.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?v.count=e.end_condition.number_of_occurrences:(0,o().HB)(e.end_condition)),"month"===e.frequency&&(0,o().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?v.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?v.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return g[t].nth(n)})):(0,o().HB)(e.monthly_restriction)),new m({freq:f[n],dtstart:(0,c().eU)(t),interval:i,byweekday:d,tzid:a,byhour:l??0,byminute:u??0,bysecond:0,...v})}const b=1,I=1;function T(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),i=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,s=i>b,o=n.length>=I;return{violatesConstraint:s||o,templateNestingExceedsMaxDepth:s,ancestorHasDailyTemplate:o,nestedDepthOfAutomationAncestors:i,immediateAncestorRecurrenceType:r}}function M(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let s=i().c9.fromMillis(n.start_date,{zone:"utc"});const o=i().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(o.diff(s,"years").years/n.interval);s=s.plus({years:e*n.interval});break}case"month":{const e=Math.floor(o.diff(s,"months").months/n.interval);s=s.plus({months:e*n.interval});break}case"week":{const e=Math.floor(o.diff(s,"weeks").weeks/n.interval);s=s.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(o.diff(s,"days").days/n.interval);s=s.plus({days:e*n.interval});break}}return{...n,start_date:(0,c().DH)(s.toMillis())}}function R(e){const{recurrence:t,afterDate:n}=e;if((0,v().wt)(t)){const e=(0,c().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(M({recurrence:t,afterDate:n})).after((0,c().eU)(n));if(!e)return;return(0,c().h1)(e)}}function U(e){return 0===e.hour||1===e.hour||2===e.hour}function A(e){return S(e).after((0,c().eU)((0,c().Rz)()))||void 0}function C(e){const{recurrence:t,intl:n}=e,r=A(N(t));if(!r)return;const s=U(t),o=i().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(n)).setZone(t.timezone),a=(0,l().Yq)({date:o,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(s)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:a});{let e=o.toLocaleString(i().c9.TIME_SIMPLE);return t.timezone!==(0,u().P)()&&(e+=` ${o.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:a,time:e})}}function k(e,t){return(0,o().O9)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().Yq)({date:i().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,o().HB)(e):t.formatMessage(p.noEndCondition)}const E=100;function P(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,o().HB)(e.end_condition):void 0}}function D(e,t,n){return e.plus(n-t)}function x(e,t){const n=i().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(n.toJSDate())}}function N(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?x(e,e.end_condition):(0,o().HB)(e.end_condition):void 0}}function q(e,t){const n=s().fN(e,(e=>void 0!==e)),i=s().fN(t,(e=>void 0!==e));return s().n4(n,i)}},477093:(e,t,n)=>{n.d(t,{Vs:()=>U,gj:()=>R,v4:()=>A,hX:()=>k,oH:()=>C});n(16280);var i=()=>n(110192),r=()=>n(857639),s=()=>n(416504),o=()=>n(206267),a=()=>n(854150),c=()=>n(529316),l=()=>n(797573),u=()=>n(919709),d=()=>n(946141),m=()=>n(449506),v=()=>n(413677),p=()=>n(751156),f=()=>n(972435),g=()=>n(45359),y=()=>n(37433),_=()=>n(274511),h=()=>n(406792),w=()=>n(632709),S=()=>n(351360),b=()=>n(630116),I=()=>n(108414),T=()=>n(519831);var M=()=>n(848237);async function R(e){let{environment:t,name:n,description:i,icon:r,accessLevel:s,isDefault:o,flowId:c,createTeamHome:l,teamPermissionRole:u,spacePermissionRole:v,members:p,settings:f}=e;const{currentSpaceStore:g}=S().default.getState();if(!g)throw new Error("currentSpaceStore does not exist");const y=h().default.mark("client_create_team_latency"),_=g.id,w=await m().callApi({eventName:"createTeam",environment:t,data:{spaceId:_,name:n,description:i,icon:r,isDefault:o,accessLevel:s,teamPermissionRole:u,spacePermissionRole:v,members:p,settings:f}});if("failed"===w.type)return void(0,M().O)(w);const{teamId:I}=w.data,R=b().h4.createChildStore(g,{table:a().yK,id:I,spaceId:_});await R.load();const U=null==R?void 0:R.getChannelStore();return await(null==U?void 0:U.load()),async function(e){const{environment:t,channelStore:n,parentStore:i}=e,r=null==n?void 0:n.getSpaceId(),s=n&&r&&{id:n.id,table:T().Vl,spaceId:r},o=i&&s&&b().md.createChildStore(i,s),a=n&&n.isReady()&&!n.isDefined()&&n.canEdit();if(!n||!i||!o)return;const c=n.getSpaceId();if(c&&a){const e=await m().callApi({eventName:"createCollectionViewBlockForPosts",environment:t,data:{spaceId:c,parentId:i.pointer.id,parentTable:i.pointer.table,channelId:n.id}});if("failed"===e.type)throw e.error;if("success"===e.type){const{collectionViewBlockId:t}=e.data}}}({environment:t,channelStore:U,parentStore:R}),l&&E({environment:t,teamStore:R}),d()._P(t,{store:R,flowId:c}),h().default.measure(y,{environment:t}),R}function U(e){var t;let{environment:n,page:i}=e;const r=o().JW(),s=(null===(t=i.getParentPointer())||void 0===t?void 0:t.table)!==a().yK?"page_to_team_nested":"page_to_team";d().H8(n,{from:s,flowId:r}),I().A.setState({open:!0,pageStore:i,flowId:r})}async function A(e){var t;let{environment:n,page:i,flowId:r,intl:o}=e;const{accessLevel:c,spacePermissionRole:l,teamPermissionRole:d,members:m}=(0,y().getAccessLevelAndPermissionsForTeamCreatedFromPage)(i),v=(i.isDefined()?i.getModel().getRenderTitle({intl:o,userTimeZone:(0,s().P)(),getRecordModel:i.getRecordModel}):void 0)??u().q4_(i.getTitleValue()),f=await R({environment:n,name:v,icon:null===(t=i.getIcon())||void 0===t?void 0:t.icon,accessLevel:c,isDefault:!1,description:"",flowId:r,createTeamHome:!1,teamPermissionRole:d,spacePermissionRole:l,members:m});if(!f)return;const{currentSpaceViewStore:g}=S().default.state;if(!g)return;const h=await(0,_().U)();p().createAndCommit({userAction:"teamActions.movePageToCreatedTeam",environment:n,canUndo:!0,perform:e=>{h({environment:n,currentSpaceViewStore:g,transaction:e,teamStore:f,action:"move",value:{type:a().yK,id:f.id},targets:[i],location:{type:"append"}})}}),(0,M().F2)({environment:n,teamId:f.id,tab:w().p.Members,from:"create_team_from_page"}),await new Promise((e=>setTimeout((()=>(0,M().Mh)({teamStore:f,environment:n})),100)))}async function C(e){let{environment:t,name:n,description:i,icon:r,flowId:s,trackCreateTeamComplete:o}=e;const{currentSpaceStore:c}=S().default.getState();if(!c)throw new Error("currentSpaceStore does not exist");const l=c.id,u=await m().callApi({eventName:"enableTeams",environment:t,data:{spaceId:l,defaultTeamName:n,defaultTeamIcon:r,defaultTeamDescription:i}});if("failed"===u.type)return void(0,M().O)(u);const{teamId:v}=u.data,p=b().h4.createChildStore(c,{table:a().yK,id:v,spaceId:l});return await p.load(),await E({environment:t,teamStore:p}),d().b0(t,{spaceId:l,store:p,flowId:s}),o&&v&&d()._P(t,{store:p,flowId:s}),p}async function k(e){var t;let{environment:n,teamStore:r,from:s,buttonPopupStore:a}=e;if(!n.currentUser.id)return!1;const c=o().JW(),l=r.isDefault(),u=r.getTeamAccessLevel();if(l)return!1;const m=r.getName(),v=await R({environment:n,name:(0,i().Q)(m||""),description:"",icon:r.getRawIcon(),accessLevel:u,isDefault:l,createTeamHome:!0,teamPermissionRole:null===(t=r.getTeamPermission())||void 0===t?void 0:t.role,spacePermissionRole:r.getSpacePermissionRole(),members:[],settings:r.getSettings(),flowId:c});return!!v&&(d().KK(n,{store:v,from:s}),(0,M().L0)({environment:n,teamStore:v,shouldScroll:!0}),(0,M().F2)({environment:n,teamId:v.id,tab:w().p.General,from:"duplicate_team",buttonPopupStore:a}),new Promise((e=>setTimeout(e,500))).then((()=>{(0,g().jH)(m)})),!0)}async function E(e){const{environment:t,teamStore:n}=e,i=S().default.state.currentSpaceStore,s=S().default.state.currentSpaceViewStore;if(!i||!s)return r().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-SpaceOrSpaceViewStoreError"}),!1;const o=(a=f().A.getIntl(),(0,l().B)(c().wA.teamsHomepage,a));var a;return!!(await v().createTemplateInstance({environment:t,item:o,spaceStore:i,spaceViewStore:s,useMinimalTemplates:!1,type:"inTeam",teamStore:n,from:"homepage_team",isOnboarding:!1}))||(r().log({level:"error",from:"teamActions",type:"createHomepageOnTeamCreation-PageNotCreated"}),!1)}},495867:(e,t,n)=>{n.d(t,{BY:()=>y,Lg:()=>_,id:()=>b,nE:()=>I,xi:()=>h});n(944114),n(898992),n(430670),n(581454);var i=()=>n(857639),r=()=>n(402390),s=()=>n(68263),o=()=>n(762433),a=()=>n(449506),c=()=>n(579627),l=()=>n(436572),u=()=>n(972435),d=()=>n(351360),m=()=>n(57605),v=()=>n(159026),p=()=>n(577437),f=()=>n(47373),g=()=>n(250064);async function y(e){const{environment:t,spaceStore:n,contextualInviteStore:i}=e;!function(e){const{spaceStore:t,contextualInviteStore:n}=e,i=t.getRole();if(!i||!(0,s().NB)(i))return!1;if(!n.hasGuests())return!1;if(t.getDisableMembershipRequests())return!1;return(0,f().x3)()}({environment:t,spaceStore:n,contextualInviteStore:i})?await async function(e){const{spaceStore:t,contextualInviteStore:n,environment:i}=e,r=t.getRole();if(!r||!(0,s().vp)(r))return!1;if(!n.hasGuests())return!1;return await(0,p().Se)(i,{name:"members",spaceId:t.id,userId:t.userId,amount:1})}({environment:t,spaceStore:n,contextualInviteStore:i})?i.startWorkspaceInvite():i.setState({...i.state,inviteStage:v().d5.closed}):i.startRequestMembership()}async function _(e){const{environment:t,spaceStore:n,contextualInviteStore:r,from:s,intl:o}=e,{selection:a,flowId:u}=r.state;if("page_guest"===a||!r.hasGuests())return r.reset(),!1;const{inviteTargets:d,unknownEmails:m}=await w({environment:t,contextualInviteStore:r}),v={...r.state};r.reset();const f=await(0,p().Se)(t,{name:"non_admin_members",spaceId:n.id,userId:n.userId})?e.inviteRole??"read_and_write":"editor";try{await c().eP({environment:t,store:n,inviteTargets:d,inviteRole:f,isOnboarding:!1,invite:{inviteOrigin:s,inviteFlowId:u,disable_invite_email:!0}})}catch(g){return function(e,t){if(0===t.length)return;l().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:b(t,e),userCount:t.length})})}(o,v.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{...v,inviteTargets:d}}}),!1}finally{m.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.unknownUserId",data:{miscDataToConvertToString:{...v,unknownEmails:m}}})}return!0}async function h(e){const{environment:t,spaceStore:n,originId:r,originType:s,reasonMessage:o,contextualInviteStore:c,intl:u}=e,{selection:d}=c.state;if("page_guest"===d||!c.hasGuests())return c.reset(),!1;const{inviteTargets:m,unknownEmails:v}=await w({environment:t,contextualInviteStore:c}),p={...c.state};c.reset();const f=[];try{const e=m.map((e=>a().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:e.value.id,spaceId:n.id,message:o,attributes:{origin_id:r,origin_type:s,origin_table:"share_menu"===s?"block":"space",add_permissions_on_approval:!1}}}).catch((()=>f.push(e)))));await Promise.all(e)}catch(g){return function(e,t){if(0===t.length)return;l().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:b(t,e)})})}(u,p.invitedUsers),i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.inviteTargets",data:{miscDataToConvertToString:{...p,inviteTargetsWithErrors:f}}}),!1}finally{v.length&&i().log({level:"error",from:"contextualInviteHelpers",type:"requestMembers.unknownUserId",data:{miscDataToConvertToString:{...p,unknownEmails:v}}})}return!0}async function w(e){const{environment:t,contextualInviteStore:n}=e,{invitedEmailToUserIdMap:i}=n.state,r=[],s=[];for(const o of n.state.invitedUsers){if(!o.isGuest)continue;const e=await S(t,o,i);e?r.push({type:"existingUser",value:{id:e,email:o.email,version:1}}):s.push(o.email)}return{inviteTargets:r,unknownEmails:s}}async function S(e,t,n){const i=await async function(e,t,n){let i=t.id;if(i||(i=n[t.email]),!i){const n=await a().callApi({eventName:"findUser",environment:e,data:{email:t.email}});if("failed"!==n.type){const e=n.data;e.value&&(i=e.value.value.id)}}return i}(e,t,n);if(i)return i;const s=(0,r().H)(u().A.getIntl()),o=await a().callApi({eventName:"createEmailUser",environment:e,data:{email:t.email,preferredLocaleOrigin:"inferred_from_inviter",preferredLocale:s}});return"failed"!==o.type?o.data.userId:void 0}function b(e,t){return(0,g().l)(e.flatMap((e=>e.email||[])))}function I(e,t){var n;const{state:i}=t,r=null===(n=d().default.state.currentSpaceStore)||void 0===n?void 0:n.id,s=r?(0,o().AI)(m().A.getData(e,{spaceId:r})):void 0,a=t.getGuestEmails();return{invite_flow_id:i.flowId,user_count:a.length,user_emails:a,invite_space_role_selection:i.selection,is_bot:!1,subscription_tier:s}}},535279:(e,t,n)=>{n.d(t,{P4:()=>r,U1:()=>o,lW:()=>a});n(944114),n(898992),n(354520),n(737550);var i=()=>n(842599);function r(e){const{target:t,inviteTargetsStore:n}=e;return n.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:"group"===t.type?e.type===t.type&&e.value.group_id===t.value.group_id:e.type===t.type&&e.value.id===t.value.id))}function s(e){return"invalidUser"!==e.type}function o(e){const{inviteTargetsStore:t,includeInputFieldText:n}=e,o=[...t.state.inviteTargets];if(n){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,i().DT)(t))return;const n={type:"newUser",value:{email:t},source:"email"};return r({target:n,inviteTargetsStore:e})?void 0:n}(t);e&&o.push(e)}return o.filter(s)}function a(e){const{inviteTargetsStore:t,inviteTarget:n}=e;if(r({target:n,inviteTargetsStore:t})){const e=t.state.inviteTargets.filter((e=>"group"===n.type&&"group"===e.type?n.value.group_id!==e.value.group_id:"existingUser"===n.type&&"existingUser"===e.type?n.value.id!==e.value.id:"newUser"!==n.type||"newUser"!==e.type||n.value.email!==e.value.email));return t.setState({...t.state,inviteTargets:e}),!1}return t.setState({inviteTargets:[...t.state.inviteTargets,n],tokenQuery:""}),!0}},542056:(e,t,n)=>{n.d(t,{Ah:()=>x,D6:()=>D,KW:()=>C,Oo:()=>A,Pp:()=>N,St:()=>P,hQ:()=>O,iS:()=>E,kW:()=>k,l5:()=>U,lf:()=>q});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var i=()=>n(842599),r=()=>n(68263),s=()=>n(179034),o=()=>n(96689),a=()=>n(496603),c=()=>n(763824),l=()=>n(534177),u=()=>n(579627),d=()=>n(495867),m=()=>n(731320),v=()=>n(743260),p=()=>n(299545),f=()=>n(37433),g=()=>n(106628),y=()=>n(351360),_=()=>n(57605),h=()=>n(159026),w=()=>n(508496),S=()=>n(406999),b=()=>n(630116),I=()=>n(991249),T=()=>n(477093),M=()=>n(134696),R=()=>n(449506);async function U(e){const{environment:t,store:n,sudoModeStore:a,permissionsInviteStore:c,onInviteStart:d,contextualInviteStore:f,inviteOrigin:g}=e,{tokenQuery:y}=c.state;if((0,i().DT)(y.trim())&&(c.state.isInviteTargetsEmpty||!(0,S().qs)(c.state))){const e={type:"newUser",value:{email:y.trim()},source:"email"};v().mQ({target:e,permissionsInviteStore:c})||c.setState({...c.state,inviteTargets:[...c.state.inviteTargets,e],isInviteTargetsEmpty:!1,tokenQuery:""})}if(!c.state.isInviteTargetsEmpty&&c.state.inviteTargets.length>0){null==d||d();const e=c.state;if((0,S().qs)(e)){if(e.table===s().ev){if(!(0,p()._p)(n))throw new Error("Table mismatch.");const{inviteTargets:i,flowId:r,emailMessage:s}=e;c.reset();const o=await u().eP({environment:t,store:n,sudoModeStore:a,inviteTargets:i,inviteRole:void 0,isOnboarding:!1,invite:{inviteFlowId:r,inviteMessage:s,inviteOrigin:g}});return{success:o.success,requestedUserCount:o.success?Object.keys(o.requestedUsers).length:0}}if(e.table===o().NX){if(!(0,p().Yu)(n))throw new Error("Table mismatch.");const{inviteTargets:i,inviteRole:r,flowId:s}=e;c.reset();return{success:(await u().eP({environment:t,store:n,sudoModeStore:a,inviteTargets:i,inviteRole:r,isOnboarding:!1,invite:{inviteFlowId:s,inviteOrigin:g}})).success,requestedUserCount:0}}(0,l().HB)(e)}else{const{inviteRole:i,flowId:s,emailMessage:o}=e;c.reset();const l=await(0,m().hb)(n,e.inviteTargets);if((0,r().PW)(i)){const e=await u().eP({environment:t,store:n,sudoModeStore:a,inviteTargets:l,inviteRole:i,isOnboarding:!1,invite:{inviteFlowId:s,inviteMessage:o,inviteOrigin:g}});return e.success&&(null==f||f.setState({...null==f?void 0:f.state,invitedEmailToUserIdMap:e.invitedUsers})),{success:e.success,requestedUserCount:e.success?Object.keys(e.requestedUsers).length:0}}if((0,p().$R)(n)&&(0,S().nV)(e)){return{success:await u().sQ({environment:t,store:n,inviteTargets:e.inviteTargets,inviteRole:i,createNewTeamFlowId:s}),requestedUserCount:0}}}}return{success:!0,requestedUserCount:0}}function A(e){e.permissionsInviteStore.setState({...e.permissionsInviteStore.state,modalOpen:!1,flowId:void 0})}function C(e){const{permissionsInviteStore:t,contextualInviteStore:n}=e;if(!n)return;const i=[];t.state.inviteTargets.forEach((e=>{if("newUser"===e.type)i.push({email:e.value.email,isGuest:!0});else if("existingUser"===e.type){const t={...e.value,email:e.value.email,isGuest:"none"===e.spaceRole||"not_in_space"===e.spaceRole};i.push(t)}})),n.setState({...n.state,invitedUsers:i})}async function k(e){const{environment:t,store:n,sudoModeStore:i,permissionsInviteStore:r,contextualInviteStore:s,onInviteClick:a,onInviteComplete:c,inviteOrigin:l,intl:u}=e,m=n.getSpaceId(),v=new(b().SL)(t,{table:o().NX,id:m}),p=m?await _().A.awaitData(t,{spaceId:m}):void 0;if((null==s?void 0:s.state.selection)===h().NJ.workspace_member&&v&&(0,f().isEligibleToCreateTeamspace)(t,p)){if(!(await T().oH({environment:t,flowId:r.state.flowId||"",trackCreateTeamComplete:!1})))return;C({permissionsInviteStore:r,contextualInviteStore:s}),await(0,d().Lg)({environment:t,spaceStore:v,contextualInviteStore:s,from:l,intl:u})}else C({permissionsInviteStore:r,contextualInviteStore:s});let g={success:!1,requestedUserCount:0};try{g=await U({environment:t,store:n,sudoModeStore:i,permissionsInviteStore:r,contextualInviteStore:s,onInviteStart:()=>{null==a||a()},inviteOrigin:l})}catch(y){}finally{null==c||c(g.success,g.requestedUserCount)}}async function E(e){const{environment:t,permissionsInviteStore:n,from:i}=e;await v().iQ({environment:t,permissionsInviteStoreState:n.state,from:i})||n.reset()}function P(e){const{permissionsInviteStore:t,targetToRemove:n,defaultRoleForNonBot:i}=e;if(!t.state.isInviteTargetsEmpty)if((0,S().qs)(t.state))if((0,S().qs)(t.state)){const e=t.state.inviteTargets.filter((e=>e!==n));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}else(0,l().HB)(t.state);else{const e=t.state.inviteTargets.filter((e=>e!==n));0===e.length?t.setState({...t.state,inviteTargets:[],inviteRole:i,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:e})}}function D(e){const{environment:t,onUpgradeButtonClick:n,upgradeButtonName:i}=e;I().K(t,{from:i,upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}}),null==n||n()}async function x(e,t){const n=new Set(t),i=Array.from(n).map((async t=>{const n=await R().callApi({eventName:"findUser",environment:e,data:{email:t}});if("success"===n.type){const e=n.data;if(e.value){return{type:"existingUser",value:e.value.value}}}return{type:"newUser",value:{email:t},source:"email"}}));return await Promise.all(i)}async function N(e){const t="invitee",{environment:n,permissionsInviteStore:r,event:s}=e;if(!r.state.isInviteTargetsEmpty&&(0,S().qs)(r.state)){const e=s.target.value;r.setState({...r.state,inputFocus:t,tokenQuery:e})}else{const e=s.target.value,{extractedEmails:o,newInputValue:a}=(0,i().Ct)(e),c=(await x(n,o)).filter((e=>!v().mQ({target:e,permissionsInviteStore:r}))),l=[...r.state.inviteTargets,...c];l.length>0?r.setState({...r.state,inviteTargets:l,isInviteTargetsEmpty:!1,inputFocus:t,tokenQuery:a}):r.setState({...r.state,inviteTargets:[],isInviteTargetsEmpty:!0,inputFocus:t,tokenQuery:a})}}function q(e){const{environment:t,newRole:n,permissionsInviteStore:i}=e,{state:r}=i;M().Jy(t,{...v().oX(t,r),invite_updated_role:n}),!r.isInviteTargetsEmpty&&(0,S().qs)(r)||i.setState({...r,inviteRole:n})}async function O(e){var t;const{query:n,environment:i,sectionLimit:r,intl:s,membersOnly:o,importContactType:l,shouldUseEdgeCache:u}=e,{currentSpaceStore:d}=y().default.state;if(!d)return{inviteUsers:[],inviteBots:[],inviteGroups:[]};const m=w().default.getConfigKey("search_contacts_timeout","timeoutMs"),{userLimit:v,botLimit:p,groupLimit:f,importContactLimit:_}=r,h=await g().T.searchActions.load(),[S,b,I,{user:T,email:M},U]=await Promise.all([v>0?u?h.searchEdgeCacheSpaceUsers({environment:i,query:n,membersOnly:o,limit:v}):h.searchVisibleSpaceUsers({environment:i,query:n,membersOnly:o}):[],p>0?h.searchSpaceBots({environment:i,query:n}):[],f>0?h.searchSpaceGroups({query:n,intl:s}):[],h.searchEmailUser(i,n),_>0?(0,c().nQ)(m,R().callApi({eventName:"searchContacts",environment:i,data:{spaceId:d.id,limit:_,query:n,importContactType:l,includeNonNotionUsers:!o,includeUserId:!0}})):void 0]),A=S.slice(0,v).map((e=>({type:"existingUser",value:e}))),C=b.slice(0,p).map((e=>({type:"bot",value:e}))),k=I.slice(0,f).map((e=>({type:"group",value:e})));T&&A.unshift({type:"existingUser",value:T}),M&&A.unshift({type:"newUser",value:{email:M},source:"email"});let E=[];return"success"===(null==U||null===(t=U.result)||void 0===t?void 0:t.type)&&(E=U.result.data.contacts.map((e=>({type:"newUser",value:{email:e.email,name:e.name,avatar_url:e.profile_photo,user_id:e.user_id},source:e.type})))),{inviteUsers:a().hS(A,(e=>e.value.email)),inviteBots:C,inviteGroups:k,importedContacts:E}}},603815:(e,t,n)=>{n.d(t,{A$:()=>M,JQ:()=>R,Vn:()=>I,s4:()=>T});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var i=()=>n(857639),r=()=>n(585515),s=()=>n(577449),o=()=>n(388821),a=()=>n(179034),c=()=>n(545285),l=()=>n(534177),u=()=>n(449506),d=()=>n(780054),m=()=>n(989423),v=()=>n(870618),p=()=>n(303626),f=()=>n(14307),g=()=>n(245865),y=()=>n(540758),_=()=>n(670631),h=()=>n(508496),w=()=>n(571963),S=()=>n(603815),b=()=>n(108944);async function I(e){const{environment:t,request:n,abortSignal:i,prefetchCacheKey:r,headers:s}=e;return(0,w().updateLoadCachedPageChunkCalledAt)(),f().isConnected()||f().isConnecting()?u().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:n,abortSignal:i,prefetchCacheKey:r,headers:s}):u().callApi({eventName:"loadPageChunkV2",environment:t,data:n,abortSignal:i,prefetchCacheKey:r,headers:s})}async function T(e){const{mode:t,environment:n,request:l,isFirstChunk:u,abortSignal:f}=e,g={...l,limit:30,cursor:l.cursor||{stack:[]},baseUrl:d().A.domainBaseUrl,publicDomainName:d().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await S().A$(n,{id:l.page.id,table:a().ev}),null!=f&&f.aborted))throw new Error("Abort signal received");const h=o().RecordMapWithRole.create(),w=[];let b=!1;const I=new Set,T=await r().T(g,s().h.fromMonomorphicFunctionUnsafe((async e=>{const i=await v().h7({environment:n,pointer:e,abortSignal:f,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=f&&f.aborted)throw new Error("Abort signal received");if(i)return h.setModelAndRole(e,i.model,i.role),i.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,c().u)(e)&&!I.has(e.id)&&u){if(void 0===_().A.state.offlinePages)return w.push(e),void(b=!0);if(void 0===_().A.state.offlinePages||!y().Bd(l.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);w.push(e)}})),((e,t,n,i)=>{p().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${n})`),null!=i&&i.suppressErrorOnClient&&I.add(t.id)}));if(b&&(await _().A.waitUntil((()=>void 0!==_().A.state.offlinePages)),!y().Bd(l.page.id))){const[e]=w;throw new Error(`Record not found: ${e.table},${e.id}`)}if(w.length>0&&(0,m().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,m().u4)({environment:n,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&i().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:l.page.id,missingRecords:w}})})),null!=f&&f.aborted)throw new Error("Abort signal received");return{recordMap:h.toJson(),cursor:T.cursorValue}}async function M(e,t){const n=e.currentUser.id;if(!n||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:n})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),g().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function R(e){if(!h().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=o().RecordMapPolymorphic.create();let n=0;const i=()=>n>=50,r=e=>{"space"!==(null==e?void 0:e.table)&&(i()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),n++))};if(e.isReady())for(const o of(0,b().E)(e))r(o);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);r(t.getModel({table:"notion_user",id:e.userId}));let n=0;for(const e of t.getPointersByTable("notion_user")){if(i()||n>=10)break;n++,r(t.getModel(e))}}const s=Array.from(t).map((e=>{let{pointer:t,value:n}=e;if(void 0!==n)return{pointer:t,version:n}})).filter(l().O9);return s.length?s:void 0}},725649:(e,t,n)=>{function i(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function s(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>i,j6:()=>s})},980270:(e,t,n)=>{n.r(t),n.d(t,{handleEnterPress:()=>R,handleGuestInvite:()=>I,handleMemberInvite:()=>b,handleMemberRequest:()=>T,handlePopupClickWithEmail:()=>U,inviteToSpaceAsMembers:()=>M,showMessageForInviteComplete:()=>A});n(944114),n(898992),n(354520),n(430670),n(581454),n(737550),n(296540);var i=()=>n(842599),r=()=>n(857639),s=()=>n(206267),o=()=>n(68263),a=()=>n(959013),c=()=>n(319625),l=()=>n(502800),u=()=>n(966505),d=()=>n(449506),m=()=>n(579627),v=()=>n(542056),p=()=>n(436572),f=()=>n(250064),g=()=>n(535279),y=()=>n(731320),_=()=>n(134217),h=()=>n(10984),w=()=>n(477093),S=n(474848);async function b(e){const{environment:t,onInviteComplete:n,flowId:i,intl:s,spaceStore:o,invitedUsers:a,inviteTargetsStore:d,inviteOrigin:m,disable_invite_email:v}=e;let p={success:!1};try{p=await M({environment:t,spaceStore:o,invitedUsers:a,from:m,flowId:i,intl:s,inviteTargetsStore:d,disable_invite_email:v}),p.success?u().ke(t,{invited_user_count:Object.keys(p.invitedUsers).length,invite_flow_id:i,origin:m}):(u().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:p.error}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(f){const e=(0,c().A)(f);u().N_(t,{invite_stage:"invite_member",invite_flow_id:i,error:e}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,l().convertErrorToLog)(f)})}finally{null==n||n(p)}}async function I(e){const{environment:t,blockStore:n,inviteTargetsStore:a,sudoModeStore:d,onInviteComplete:v,inviteOrigin:p,role:f,emailMessage:_,flowId:h}=e;let w={success:!1};try{if(w=await async function(e){const{environment:t,blockStore:n,sudoModeStore:r,inviteTargetsStore:a,role:c,inviteOrigin:l,emailMessage:u,onInviteStart:d}=e,v=e.flowId||s().JW();if(!(0,o().PW)(c))return{success:!1};const{tokenQuery:p,inviteTargets:f}=a.state;if((0,i().DT)(p.trim())&&0===f.length){const e={type:"newUser",value:{email:p.trim()},source:"email"};g().P4({target:e,inviteTargetsStore:a})||a.setState({inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}const _=await y().hb(n,g().U1({inviteTargetsStore:a}));null==d||d();const h=await m().eP({environment:t,store:n,sudoModeStore:r,inviteTargets:_,inviteRole:c,isOnboarding:!1,invite:{inviteFlowId:v,inviteMessage:u,inviteOrigin:l}});return h}({environment:t,blockStore:n,sudoModeStore:d,inviteTargetsStore:a,role:f,emailMessage:_,inviteOrigin:p,flowId:h}),!w.success)return}catch(S){const e=(0,c().A)(S);u().N_(t,{invite_stage:"invite_guest",invite_flow_id:h,error:e}),r().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,l().convertErrorToLog)(S)})}finally{w.success&&u().oU(t,{invited_user_count:Object.keys(w.invitedUsers).length,origin:p,invite_flow_id:h}),null==v||v(w)}return w}async function T(e){const{environment:t,spaceStore:n,originId:i,originType:s,reasonMessage:o,intl:a,flowId:l,onInviteComplete:m,invitedUsers:v,inviteOrigin:g}=e,y=[];let _={success:!1};try{const e=Object.entries(v).map((e=>{let[r,a]=e;return d().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:a,spaceId:n.id,message:o,attributes:{origin_id:i,origin_type:s,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>y.push([r,a])))}));await Promise.all(e),_={success:!0,invitedUsers:v,requestedUsers:{}}}catch(h){const e=(0,c().A)(h);return u().N_(t,{invite_stage:"request_member",invite_flow_id:l,error:e}),function(e,t){const n=Object.keys(t);if(0===n.length)return;p().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,f().l)(n)})})}(a,v),r().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:y}}}),_}finally{_.success&&u().d6(t,{invited_user_count:Object.keys(_.invitedUsers).length,origin:g,invite_flow_id:l}),null==m||m(_)}return _}async function M(e){const{environment:t,spaceStore:n,from:i,invitedUsers:s,intl:o,flowId:a,onInviteStart:c,inviteTargetsStore:l,disable_invite_email:u}=e,d=function(e){const t=[];if(!e)return t;for(const[n,i]of Object.entries(e))t.push({type:"existingUser",value:{id:i,email:n,version:1}});return t}(s),v=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(l),g=[...d];for(const r of v){d.some((e=>e.value.email===r.value.email))||g.push(r)}const y=(0,h().AI)(),S=y&&(0,_().fk)(y)?"editor":e.inviteRole??"read_and_write";let b={success:!1};if(!n.isTeamsEnabled()){if(!(await w().oH({environment:t,flowId:a,trackCreateTeamComplete:!1})))return b}try{null==c||c(),b=await m().eP({environment:t,store:n,inviteTargets:g,inviteRole:S,isOnboarding:!1,invite:{inviteOrigin:i,inviteFlowId:a,disable_invite_email:u}})}catch(I){return function(e,t){0!==t.length&&p().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,f().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(o,g),r().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:g}}}),b}return b}async function R(e){const{environment:t,inviteTargetsStore:n,allowShowEmptyError:r,personPropertyInviteStore:s}=e,o=n.state.tokenQuery;if(""===o)return void(0===n.state.inviteTargets.length&&r&&s.setState({...s.state,showEmptyError:!0}));const a=(0,i().C3)(o),c=await v().Ah(t,a);let l=[];0===c.length&&(l=[{type:"invalidUser",value:{text:o}}]);const u=c.filter((e=>!g().P4({inviteTargetsStore:n,target:e}))),d=[...n.state.inviteTargets,...u,...l];n.setState({...n.state,inviteTargets:d,tokenQuery:""})}function U(e){const{email:t,inviteTargetsStore:n}=e,i={type:"newUser",value:{email:t},source:"email"},r=[...n.state.inviteTargets];g().P4({inviteTargetsStore:n,target:i})||r.push(i),n.setState({...n.state,inviteTargets:r})}function A(e){const{success:t,invitedUserEmails:n,isRequestMember:i}=e;t?0!==n.length&&(i?p().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,f().l)(n)}})}):p().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,f().l)(n)}})})):p().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,f().l)(n)}})})}}}]);