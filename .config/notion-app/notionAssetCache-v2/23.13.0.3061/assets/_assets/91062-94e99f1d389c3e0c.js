"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[91062],{275764:(e,t,n)=>{n.d(t,{G5:()=>u,Ux:()=>g,g3:()=>p,jn:()=>c,o2:()=>m});n(898992),n(581454),n(908872);var r=()=>n(484714),a=()=>n(187174),i=()=>n(643819),o=()=>n(786508),s=()=>n(166386),l=()=>n(449506),d=()=>n(134217);function c(e){const{items:t,promo:n}=e;return t.map((e=>e.price.getDiscountPerBillingInterval({quantity:e.quantity,promo:n}))).reduce(((e,t)=>e.plus(t)))}function u(e){const{items:t,coupon:n}=e,r=n?(0,s().Pz)((0,o().Pq)(n)):void 0;return t.map((e=>e.price.getCostPerBillingInterval({quantity:e.quantity,offer:r}))).reduce(((e,t)=>e.plus(t)))}function p(e){const{taxAmount:t,calculatingTax:n,currencyCode:r}=e,a=t&&!n?t:0;return new(i().W)(r,a)}function m(e,t){const n=Math.min(0,d().o2(e));return new(i().W)(t,-n)}function g(e){const t=(0,r().v3)(),[n]=(0,a().Yb)((async()=>{if(!e)return;const n=await l().callApi({eventName:"getPromoCode",environment:t,data:{code:e.code}});return"failed"!==n.type?n.data.promo:void 0}),[t,e]);return"resolved"===n.status?n.value:void 0}},369773:(e,t,n)=>{n.d(t,{P:()=>g});var r=n(296540),a=()=>n(484714),i=()=>n(401497),o=()=>n(959013),s=()=>n(84817),l=()=>n(554509),d=()=>n(73332),c=()=>n(989423),u=()=>n(836251),p=()=>n(208993),m=n(474848);function g(e){let{message:t,isChecked:n,onChange:g,error:f}=e;const y=(0,o().tz)(),v=(0,i().IS)((e=>({termsContainer:{display:"flex",flexDirection:"column",gap:8,paddingTop:16,borderTop:`1px solid ${e.stroke.primary}`}})),[]),h=(0,a().v3)(),b=r.useRef(null);return r.useEffect((()=>{f&&b.current&&b.current.scrollIntoView({behavior:"smooth",block:"center"})}),[f]),(0,m.jsx)("div",{ref:b,style:v.termsContainer,children:(0,m.jsxs)(s().Y1,{direction:"horizontal",align:"top-left",gap:8,children:[(0,m.jsx)(d().T,{size:14,checked:n,onClick:()=>{(0,c().u4)({environment:h,event:{eventName:"click_subscription_terms_checkbox",eventProperties:{checked:!n}}}),g(!n)},id:"terms",style:{margin:1},"aria-required":!0}),(0,m.jsxs)(s().Y1,{direction:"vertical",gap:8,children:[(0,m.jsxs)(l().D,{styleName:"UISmall-12px/Regular",colorName:"primary",as:"label",htmlFor:"terms",children:[t,(0,m.jsx)("div",{style:{display:"inline-block",position:"absolute",paddingLeft:1},children:(0,m.jsx)(p().W,{tooltipTitle:y.formatMessage({id:"onboardingTimedTrials.termsOfService.tooltip",defaultMessage:"Read full terms and conditions"}),buttonProps:{href:(0,u().xS)("terms"),external:!0}})})]}),f?(0,m.jsx)(l().D,{styleName:"UISmall-12px/Regular",colorName:"uiRedPrimary",children:f}):null]})]})})}},585312:(e,t,n)=>{n.d(t,{q:()=>v});var r=()=>n(624119),a=(r(),n(296540),()=>n(484714)),i=()=>n(852507),o=()=>n(847249),s=()=>n(959013),l=()=>n(252105),d=()=>n(84817),c=()=>n(710149),u=()=>n(351360),p=()=>n(506090),m=()=>n(34699),g=()=>n(414402),f=()=>n(471725),y=n(474848);function v(e){const{modalId:t}=e,n=(0,o().O$)(f().D),d=(0,a().v3)();(0,i().w)((()=>{f().D.setState(!0)}));const c={defaultValues:{billingDetails:(0,o().K8)((()=>{const e=u().default.state.currentUserStore;return{email:null==e?void 0:e.getEmail(),name:null==e?void 0:e.getName()}}),[])},terms:{card:"never"}};return(0,y.jsxs)(m().iy,{title:n?(0,y.jsx)(g().y,{labelOnly:!0}):(0,y.jsx)(s().sA,{id:"subscriptions.checkout.paymentMethod.title",defaultMessage:"Payment method"}),children:[n?(0,y.jsx)(h,{}):null,(0,y.jsx)(r().PaymentElement,{options:c,onChange:e=>{l().C3(d,{event:e,modal_id:t}),p().A.update((e=>{if(!e.open)return e;const{paymentData:t,...n}=e;return n}))},onReady:()=>f().D.setState(!1)})]})}function h(){return(0,y.jsxs)(d().Y1,{gap:12,children:[(0,y.jsxs)(d().Y1,{direction:"horizontal",gap:12,children:[(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}}),(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}})]}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{})]})}},591062:(e,t,n)=>{n.r(t),n.d(t,{CheckoutUpgradeModal:()=>Re});var r=()=>n(624119),a=n(296540),i=()=>n(484714),o=()=>n(847249),s=()=>n(762433),l=()=>n(107683),d=()=>n(38337),c=()=>n(240865),u=()=>n(506090),p=()=>n(224701),m=()=>n(112527),g=()=>n(134217),f=()=>n(527059),y=()=>n(981046),v=(n(944114),n(898992),n(737550),()=>n(852507)),h=()=>n(857639);const b=(0,n(340498).xh)("infoBubble",{default:{loader:()=>n.e(89306).then(n.bind(n,889306))},small:{loader:()=>n.e(87344).then(n.bind(n,487344))},mini:{loader:()=>n.e(72612).then(n.bind(n,272612))},large:{loader:()=>n.e(78596).then(n.bind(n,778596))}});var x=()=>n(984380),S=()=>n(622963),j=()=>n(979340),I=()=>n(959013),A=()=>n(496603),w=()=>n(252105),C=()=>n(209660),_=()=>n(84817),M=()=>n(460292),T=()=>n(554509),P=()=>n(640653),k=()=>n(876853),D=()=>n(6208),N=()=>n(351360),E=()=>n(227440),U=()=>n(404141),B=(n(16280),n(354520),()=>n(244641)),R=()=>n(584262),O=()=>n(967786),K=()=>n(179034),F=()=>n(323063),q=()=>n(166386),Y=()=>n(807487),L=()=>n(901389),z=()=>n(496414),W=()=>n(857783),V=()=>n(436572),G=()=>n(34542),H=()=>n(211716),Q=()=>n(770769),J=()=>n(57605),Z=()=>n(630116),$=()=>n(23954),X=()=>n(399995),ee=()=>n(106196),te=n(474848);function ne(e){const{onClick:t}=e;return(0,te.jsx)(ee().N,{buttonInfo:{onClick:t,label:(0,te.jsx)(I().sA,{id:"spaceSubscriptionUpgradeModal.upgradeAi.getStarted",defaultMessage:"Get started"})}})}var re=()=>n(807778),ae=()=>n(779795),ie=()=>n(411341);const oe=(0,I().YK)({cancelFailedSubscription:{id:"subscription.upgrade.cancel_failed_subscription",defaultMessage:"Cancelling subscription..."}});async function se(e){var t;const{address:n,billingEmail:r,billingInterval:a,coupon:i,currencyCode:o,environment:l,isStartingTrial:d,modalId:c,modalType:u,paymentData:p,promo:m,quantity:g,selectedProducts:f,stripe:y,useTestClock:v,vatId:h,intl:b,from:x}=e,S=N().default.state.currentSpaceStore;if(!S)return;const j=await ae().p_({environment:l,spaceId:S.id}),C=await J().A.awaitData(l,{spaceId:null==S?void 0:S.id});if(!C)throw new Error("Billing data not loaded");const _=(null===(t=(0,s().KH)(C,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,M=(0,s().lQ)(C),T=d?B().c9.now().plus({days:14}):void 0,P=(0,A().oE)(f).filter((e=>"free"!==e)),k=(0,re().Le)(),D=(0,F().ef)({state:{...M,trialEnd:T},prices:j,quantities:{numSeats:g,numCustomHostnames:_},params:{interval:a,currency:o},products:P,flags:{isMay13PackagingChangesEnabled:k}}),E=P.some((e=>(0,q().Jf)(i,e,a)));try{const e=await ie().updateSubscription({environment:l,spaceStore:S,desiredState:(0,F().Vr)(j,D,a),paymentData:p,billingEmail:r,coupon:m&&"coupon"===m.source?m.code:void 0,customerName:n.name,businessName:n.businessName,addressLine1:n.addressLine1,addressCity:n.city,addressZip:n.zipCode,addressState:n.state,addressCountry:n.country,vatId:h??void 0,promoCodeId:m&&"promo_code"===m.source?m.code:void 0,from:x??"subscription_upgrade_modal",useTestClock:v,sessionId:c,inAppOffer:E?i:void 0});await ie().handlePaymentIntentNextActions({paymentIntentData:e,stripe:y,onSuccess:()=>{w().dI(l,{payment_intent_id:e.paymentIntentId,modal_id:c,modal_type:u})},onFailure:async()=>{await async function(e){const{updateSubscriptionResponse:t,environment:n,modalId:r,modalType:a,spaceStore:i,currencyCode:o,intl:s}=e,{subscriptionStatus:l,paymentIntentId:d}=t,c=$().w;await ie().refreshBillingHistory(n,c);const u=c.state.billingEvents;L().ui({message:"trialing"===l?(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.trial",defaultMessage:"Please provide an alternate payment method to complete your upgrade."}):(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."}),showCancel:!1,keepFocus:!1,disableBackgroundDismiss:!0,items:[{label:(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.pay_invoice",defaultMessage:"Complete payment"}),onAccept:()=>{if(w().GB(n,{payment_intent_id:d,modal_id:r,modal_type:a}),(0,re().Ug)())return(0,X().U)(n,i,o,[u[0]],$().w,s);window.open(t.invoiceUrl,"_blank")},color:"red"},{label:(0,te.jsx)(I().sA,{id:"subscription.upgrade.payment_failed.cancel",defaultMessage:"Cancel upgrade"}),onAccept:async()=>{w().WB(n,{payment_intent_id:t.paymentIntentId,modal_id:r,modal_type:a}),z().m({message:oe.cancelFailedSubscription}),await ie().cancelSubscription({environment:n,spaceStore:i,from:"subscription_upgrade_modal-failed_payment"}),z().V()}}]})}({updateSubscriptionResponse:e,environment:l,modalId:c,spaceStore:S,currencyCode:o,intl:b})}}),m&&(0,O().rP)(l.currentUser.id)}catch{w().WB(l,{modal_id:c,modal_type:u})}}var le=()=>n(19575),de=()=>n(749356),ce=()=>n(601203),ue=()=>n(889173),pe=()=>n(730764),me=()=>n(637833),ge=()=>n(517492),fe=()=>n(10984),ye=()=>n(906195),ve=()=>n(775916),he=()=>n(816953),be=()=>n(651390),xe=()=>n(931783),Se=()=>n(183819),je=()=>n(662866),Ie=()=>n(34699),Ae=()=>n(369773),we=()=>n(161165),Ce=()=>n(401497),_e=()=>n(581495),Me=()=>n(270511);function Te(e){let{header:t,paymentContent:n,orderOptions:r,footer:a,showDismissButton:s}=e;const l=(0,i().v3)(),{isMobile:d}=(0,i().Y0)(),c=(0,o().K8)((()=>(0,Me().A)(l)),[l])||!r,u=function(e){return(0,Ce().IS)((()=>({wrapper:{...!e&&{minWidth:506}},mobile:{display:"grid",gridTemplateRows:"1fr auto",overflow:"hidden auto"}})),[e])}(d),p=(0,te.jsxs)(_().Y1,{direction:c?"vertical":"horizontal",gap:c?20:32,style:{...d&&u.mobile},children:[(0,te.jsx)(_().Y1,{direction:"vertical",gap:c?20:28,width:c?"fill":420,children:n}),(0,te.jsxs)(_().Y1,{direction:"vertical",gap:c?20:28,width:c?"fill":310,children:[r,a]})]});return(0,te.jsxs)(_().Y1,{direction:"vertical",gap:c?28:36,padding:32,width:"hug",height:"hug",style:u.wrapper,children:[t,p,s&&(0,te.jsx)(_e().Rz,{})]})}n(581454);var Pe=()=>n(802790),ke=()=>n(331542),De=()=>n(275764),Ne=()=>n(86089);function Ee(e){var t;const{state:n,data:r,promo:i,billingData:l,dueAtPeriodEnd:d,billingInterval:u,products:p}=e,{coupon:m,calculatingTax:g,taxAmount:f}=n,[v,h]=a.useState(!1),b=De().Ux(i),x=(0,o().K8)((()=>y().A.state.selectedCurrencyCode??"USD"),[]),S=(0,Ne().o)(),j=(0,c().V)()??1;if(0===S.length)return(0,te.jsx)(ke().A,{});const I=p.map((e=>(0,F().vk)(S,{product:e,interval:u,currency:x}))),A={numSeats:j,numCustomHostnames:(null===(t=(0,s().KH)(l,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0},w=I.map((e=>(0,F().ng)(e,A))),C=p.some((e=>(0,q().Jf)(m,e,u))),M=De().G5({items:w,coupon:C?m:void 0});let T;if(0!==S.length&&"year"===u){const e=C?"year":"month",t=p.map((t=>(0,F().vk)(S,{product:t,interval:e,currency:x}))).map((e=>(0,F().ng)(e,A)));T=De().G5({items:t}).withMultipliedAmount(C?1:12)}const P=T?T.minus(M):void 0,k=De().g3({calculatingTax:g,taxAmount:f,currencyCode:x}),D=De().jn({items:w,promo:b}),N=De().o2(r,x),E=M.plus(k).minus(D).minus(N),U=E.amount<0?E.withMultipliedAmount(0):E,B=function(e){var t;let{hasDiscount:n,dueAtPeriodEnd:r,billingData:a,billingInterval:i}=e;if(n)return{chargeType:"immediate"};if(r&&null!=a&&null!==(t=a.subscription)&&void 0!==t&&t.currentPeriodEnd)return{chargeType:"nextPeriod",periodEnd:a.subscription.currentPeriodEnd};return{chargeType:void 0,billingInterval:i}}({hasDiscount:0!==D.amount&&0!==N.amount,dueAtPeriodEnd:d,billingData:l,billingInterval:u});return(0,te.jsxs)(_().Y1,{gap:2,children:[(0,te.jsx)(Ie().BB,{total:U,handleToggleExpanded:()=>h((e=>!e)),isExpanded:v,discount:D,accountBalance:N,annualPriceDifference:P,coupon:C?m:void 0,isTotalLoading:g,...B}),(0,te.jsx)(Ie()._z,{isExpanded:v,children:(0,te.jsxs)(_().Y1,{gap:12,children:[(0,te.jsx)(Ie().f5,{items:w,coupon:C?m:void 0}),(0,te.jsx)(Pe().A,{size:1}),(0,te.jsx)(Ie().Qs,{subtotal:M,tax:k,discount:D,accountBalance:N,showDiscountLine:0!==D.amount&&b&&!m,isCalculatingTax:g,subtotalMonthly:T})]})})]})}var Ue=()=>n(585312);function Be(e){const{state:t,data:n,spaceStore:l,spaceViewStore:d}=e,c=(0,i().v3)(),p=(0,I().tz)(),B=(0,r().useStripe)(),O=(0,r().useElements)(),{isMobile:F}=(0,i().Y0)(),q=(0,f().lh)({spaceId:l.id}),L=(0,Se().q)(),z=(0,o().K8)((()=>N().default.state.currentUserRootStore),[]),J=(0,ve().p)(),$=(0,o().K8)((()=>{if(u().A.state.open)return u().A.state.dismissMobilePlansModal}),[]),X=(0,o().O$)(E().e),{availableCurrencyCodes:ee,currencyCode:ie}=(0,o().K8)((()=>({availableCurrencyCodes:y().A.availableCurrencyCodes,currencyCode:y().A.selectedCurrencyCode??"USD"})),[]),oe=(0,he().A)(),Ce=(0,D().L)(),_e=(0,f().UL)(),Me=(0,ye().D)(),Pe=(0,o().K8)((()=>t.addOnFeature??(0,S()._y)(t.subscriptionTier)),[t.addOnFeature,t.subscriptionTier]),ke=(0,o().K8)((()=>"ai"===Pe&&(0,re().u1)()),[Pe]),De=(0,we().v1)(q,J,Pe);(0,v().l)((()=>{const e=g().qc(n);u().A.update((t=>{var r;return{...t,appliedPromo:e?null===(r=n.customerData)||void 0===r?void 0:r.stripe.promo:void 0}})),e&&void 0!==(null==q?void 0:q.address)&&u().A.setAddressField(null==q?void 0:q.address)}));const Ne=De&&(0,s().eh)(q,"ai"),Be=(0,o().K8)((()=>(0,re().Le)()),[]),Re=(0,fe().RL)({salesStatus:L,packagingChangesEnabled:Be}),Oe=(0,o().K8)((()=>{const e=[Pe];return!((0,s().ji)(q)??[]).includes("ai")&&!De&&!Be&&e.push("ai"),e}),[Pe,q,De,Be]),[{billingInterval:Ke,addOnFeature:Fe,name:qe,businessName:Ye,vatId:Le,termsAccepted:ze},We]=a.useState({billingInterval:"ai"===Pe?"year":"month",name:Ce??"",businessName:"",vatId:oe?"":void 0,termsAccepted:void 0}),[Ve,Ge]=a.useState({}),[He,Qe]=a.useState(),[Je,Ze]=a.useState(!1),$e=a.useCallback((e=>{Qe(void 0),e.name&&Ge((e=>({...e,name:void 0}))),void 0!==e.termsAccepted&&Ge((e=>({...e,termsAccepted:void 0}))),We((t=>({...t,...e})))}),[]),Xe=a.useMemo((()=>(0,A().sb)((0,A().oE)([Pe,Fe,...Ne?["ai"]:[]]))),[Pe,Fe,Ne]),[et,tt]=a.useState(!1);a.useEffect((()=>{_e&&!t.coupon&&(u().A.update((e=>({...e,coupon:"ai_fifty_percent"}))),async function(){await(0,de().x3)({environment:c,hasReceived:!1,offerType:"add_on_upgrade_flow",coupon:"ai_fifty_percent"})}())}),[t.coupon,_e,c]),a.useEffect((()=>{Me&&("month"===Ke&&"plus"===Pe&&(u().A.update((e=>({...e,coupon:"resurrection_offer"}))),et||(!async function(){await(0,de().x3)({environment:c,hasReceived:!1,offerType:"resurrection_flow",coupon:"resurrection_offer"})}(),tt(!0))),"year"===Ke&&"plus"===Pe&&u().A.update((e=>({...e,coupon:void 0}))))}),[t.coupon,Me,Ke,Pe,c,et]),a.useEffect((()=>{ce().Qe({environment:c,billingInterval:Ke,vatId:Le,billingData:q,addOn:Fe,onlyShowAddOn:"ai"===Pe})}),[c,Ke,Fe,Le,q,Pe]);const nt={month:(0,be().H)({billingInterval:"month",priceStore:y().A,products:Oe}),year:(0,be().H)({billingInterval:"year",priceStore:y().A,products:Oe})},rt=(0,xe()._)({asyncPrice:nt[Ke??"month"].ai}),at=(0,we().tA)(q,_e),it=(0,xe()._)({asyncPrice:nt.month[Pe]}),ot=(0,xe()._)({asyncPrice:nt.year[Pe]}),st=a.useCallback((()=>{const e={};return(0,k().r)(qe)||(e.name=p.formatMessage({id:"spaceSubscriptionUpgradeModal.name.required.error",defaultMessage:"Please enter a valid name."})),ke&&!ze&&(e.termsAccepted=p.formatMessage({id:"spaceSubscriptionUpgradeModal.terms.required.error",defaultMessage:"You must opt in to upgrade your plan"})),Ge((t=>({...t,...e}))),e}),[qe,p,ze,ke]),lt=a.useCallback((async e=>{Qe(void 0);const n=st();if(!(0,A().Im)(n))return;if(w().Fp(c,{modal_id:t.sessionId,from:t.from}),Ze(!0),!O||!B)return(0,h().log)({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}}),Qe(p.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})),void Ze(!1);const r=await(0,P().Pu)({environment:c,spaceId:l.id})??1,a=await async function(e){const{billingEmail:t,coupon:n,currencyCode:r,environment:a,elements:i,billingInterval:o,name:s,businessName:l,vatId:d,intl:c,modalId:u,promo:p,quantity:g,selectedProducts:f,stripe:y,useTestClock:v,from:h}=e,b=await async function(e){const{modalId:t,modalType:n,environment:r,intl:a,elements:i,stripe:o}=e,s=a.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."}),{error:l}=await i.submit();if(l)return w().qC(r,{error:"could not submit form",error_type:"payment_method",modal_id:t,modal_type:n}),{error:s};const{error:d,paymentMethod:c}=await o.createPaymentMethod({elements:i});if(d)return w().qC(r,{error:d.message,error_type:"payment_method",modal_id:t,modal_type:n}),w().cr(r,{error:d.code,stripe_decline_code:d.decline_code}),{error:m().translateStripeError(a,d)};if(!c)return w().qC(r,{error:"could not create token",error_type:"payment_method",modal_id:t,modal_type:n}),{error:s};const u={type:"paymentMethodId",value:c.id},p=c.billing_details.address;return{paymentData:u,address:{zipCode:(null==p?void 0:p.postal_code)??"",country:Y()._q.includes(c.type)?"KR":(null==p?void 0:p.country)??""}}}({modalId:u,environment:a,intl:c,elements:i,stripe:y});if("error"in b)return{error:b.error};return void(await se({address:{name:s??"",businessName:l??"",addressLine1:"",addressLine2:"",zipCode:b.address.zipCode??"",city:"",state:"",country:b.address.country??""},billingEmail:t,billingInterval:o,coupon:n,currencyCode:r,environment:a,modalId:u,paymentData:b.paymentData,promo:p,quantity:g,selectedProducts:f,stripe:y,vatId:d,useTestClock:v,intl:c,from:h}))}({billingEmail:g().Nl(t,q),coupon:t.coupon,currencyCode:ie,environment:c,elements:O,intl:p,billingInterval:Ke,name:qe,businessName:Ye,vatId:oe?Le:void 0,modalId:t.sessionId,promo:t.appliedPromo,quantity:r,selectedProducts:Xe,stripe:B,useTestClock:e.useTestClock,from:t.from});return null!=a&&a.error?(Qe(a.error),void Ze(!1)):(function(e){const{environment:t,modalId:n}=e;u().A.reset(),w().OC(t,{modal_id:n})}({environment:c,modalId:t.sessionId}),"ai"===Pe?(U().A.reset(),function(e){const{environment:t,spaceStore:n,spaceViewStore:r,intl:a,currentUserRootStore:i}=e,o=(0,Q().getAIUpgradeTemplate)({intl:a});if(!o)throw new Error("AI template not found");if(!i)throw new Error("Cannot create BlockStore: currentUserRootStore not found");const s=Z().Bv.createChildStore(i,{table:K().ev,id:o.rootId});(0,G().Fq)({environment:t,blockStore:s,spaceStore:n,spaceViewStore:r,hideModal:!0,disableRedirect:!0,showDuplicationStartedToast:!1,showDuplicationFinishedToast:!1}).then((e=>{e&&V().D6({label:a.formatMessage({id:"spaceSubscriptionUpgradeModal.upgradeAi.success",defaultMessage:"You now have unlimited Notion AI"}),style:{gap:8,display:"flex"},right:(0,te.jsx)(ne,{onClick:()=>{W().uK({environment:t,store:e,visitType:H().ig.Link,pageVisitSource:R().y8.Duplicate})}})})})).catch((e=>{h().log({from:"client/checkoutActions",level:"error",type:"aiUpgrade.duplicationFailed",data:{message:"AI Upgrade duplication failed.  Block store not found"}})}))}({environment:c,spaceStore:l,spaceViewStore:d,intl:p,currentUserRootStore:z}),void(F&&(null==$||$()))):void C().Ow({currentTab:"billing"}))}),[q,Ke,Ye,ie,z,O,c,p,F,qe,$,Pe,Xe,l,d,t,B,st,oe,Le]),dt=(0,o().K8)((()=>(0,re().Ir)()&&!1),[]),ct=[{buttonType:"primary",isDisabled:Je,isLoading:Je,label:x().Kq.some((e=>e===Pe))?(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeButton.upgradeToPlan",defaultMessage:"Upgrade to {plan}",values:{plan:(0,j().u2)({product:Pe,intl:p,useEnterpriseLimitedName:Re})}}):(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeButton.upgradeAi",defaultMessage:"Upgrade now"}),onClick:()=>lt({useTestClock:!1})}];dt&&ct.push({buttonType:"primary",isDisabled:Je,label:"ðŸš§ Upgrade with Test Clock ðŸš§",onClick:()=>lt({useTestClock:!0})});const ut=["business","enterprise"].includes(Pe)?[{buttonType:"outline",label:(0,te.jsxs)(_().Y1,{direction:"horizontal",gap:6,align:"center",children:[(0,te.jsx)(M().Q,{iconGroup:b,variantName:"default",colorName:"primary"}),(0,te.jsx)(I().sA,{id:"spaceSubscriptionSettings.upgradeModal.contactSales",defaultMessage:"Contact sales"})]}),onClick:()=>(0,le().lK)({initialQuestion:"enterprise"===Pe?"interest_in_enterprise":"interest_in_business",openedFrom:"enterprise"===Pe?"enterprise_checkout_modal":"business_checkout_modal"})}]:void 0;if(!X)return(0,te.jsx)(je()._,{});const pt=(0,we().P8)({product:Pe,coupon:t.coupon,isOnTrialWithAiProduct:Ne,from:t.from,may13PackagingChangesEnabled:Be,useEnterpriseLimitedName:Re});De&&(pt.subtitle=(0,te.jsx)(T().D,{styleName:"UIRegular-14px/Regular",colorName:"secondary",customStyles:{maxWidth:525},children:(0,te.jsx)(I().sA,{id:"subscriptionUpgradeModal.upgradeDuringTrial",defaultMessage:"Unlimited access to our most loved team features. If you choose not to upgrade, you will be on a free plan with restricted usage."})}));const mt=(0,ue().f)({headerContent:pt,primaryProduct:Pe});return(0,te.jsx)(Te,{showDismissButton:!0,header:(0,te.jsx)(Ie().K4,{...pt,image:mt}),paymentContent:(0,te.jsxs)(_().Y1,{gap:14,children:[(0,te.jsx)(Ie().ck,{formData:{name:qe,businessName:Ye,vatId:Le},onChangeFormData:$e,errors:Ve,modalId:t.sessionId}),(0,te.jsx)(Ue().q,{modalId:t.sessionId})]}),orderOptions:at?null:(0,te.jsxs)(_().Y1,{gap:20,children:[(0,te.jsx)(Ie().TJ,{selectedBillingInterval:Ke,monthlyUnitPrice:it,yearlyUnitPrice:ot,onChange:e=>{w().bT(c,{billingInterval:e,modal_id:t.sessionId}),$e({billingInterval:e})},product:Pe,coupon:t.coupon}),Oe.includes("ai")&&"ai"!==Pe?(0,te.jsx)(Ie().nB,{selectedAddOn:Fe,unitPrice:rt,onChange:e=>{w().Gs(c,{addOnFeatures:e?[e]:void 0,modal_id:t.sessionId}),$e({addOnFeature:e})},coupon:t.coupon,billingInterval:Ke}):null,(0,te.jsx)("div",{style:{position:"absolute",top:-8,right:0},children:(0,te.jsx)(me().y,{availableCurrencyCodes:ee,selectedCurrencyCode:ie,onSelectCurrency:ae().cP,from:"upgrade_modal"})})]}),footer:(0,te.jsxs)(_().Y1,{gap:16,children:[(0,te.jsx)(Ee,{state:t,data:n,billingInterval:Ke,products:Xe,promo:t.appliedPromo,billingData:q,dueAtPeriodEnd:De}),ke?(0,te.jsx)(Ae().P,{isChecked:Boolean(ze),onChange:e=>{$e({termsAccepted:e})},error:Ve.termsAccepted,message:(0,te.jsx)(I().sA,{defaultMessage:"Notion {planName} will auto-renew each month at {money}/seat plus taxes unless canceled. Cancel via the Billing tab prior to renewal to avoid future charges",id:"checkout.termsOfService",values:{money:it?(0,te.jsx)(ge().v,{cost:it,trailingZeroDisplay:"stripIfInteger"}):"-",planName:(0,j().u2)({product:Pe,intl:p,useEnterpriseLimitedName:Re})}})}):null,(0,te.jsx)(Ie().iu,{primaryButtons:ct,secondaryButtons:ut,termsOfService:(0,te.jsx)(pe().w,{showTrialEndDisclaimer:(0,s().TB)(q)&&!we().v1,products:Xe,showProductTerms:!ke})}),He?(0,te.jsx)(T().D,{styleName:"Caption-12px/Regular",colorName:"uiRedPrimary",children:He}):null]})})}function Re(e){let{data:t,spaceStore:n,spaceViewStore:r}=e;const a=(0,i().v3)(),s=(0,f().lh)({spaceId:n.id}),c=(0,o().K8)((()=>u().A.state),[]);return(0,te.jsx)(l().s,{ariaLabelledBy:d().Kvs,isOpen:c.open,onClosed:()=>p().dl(a),animateSizeTransition:!1,areaConstraint:{width:{type:"min",length:400}},render:()=>c.open?(0,te.jsx)("div",{style:{overflowY:"auto"},children:(0,te.jsx)(Oe,{state:c,billingData:s,data:t,spaceStore:n,spaceViewStore:r})}):null})}function Oe(e){const{state:t,billingData:n,data:i,spaceStore:l,spaceViewStore:d}=e,{subscriptionTier:u,onlyShowAddOn:p,calculatingTax:f,temporaryBillingInterval:v,taxAmount:h,addOnFeature:b,coupon:x}=t,S=(0,o().K8)((()=>(0,s().Ry)(n)??y().A.selectedCurrencyCode),[n]),j=(0,c().V)()??1,{payAmount:I}=g().TQ({subscriptionTier:u,memberCount:j,currencyCode:S,promo:t.appliedPromo,data:i,onlyShowAddOn:p,calculatingTax:f,billingInterval:v??"year",taxAmount:h,addOnFeature:b,coupon:x}),A=(0,m().useElementsOptions)({type:"subscription",amount:I.amount,currency:I.currencyCode}),w=(0,a.useMemo)((()=>(0,m().getStripe)()),[]);return(0,te.jsx)(r().Elements,{stripe:w,options:A,children:(0,te.jsx)(Be,{spaceViewStore:d,state:t,data:i,spaceStore:l})})}},730764:(e,t,n)=>{n.d(t,{w:()=>x});n(898992),n(737550);var r=n(296540),a=()=>n(484714),i=()=>n(847249),o=()=>n(401497),s=()=>n(166386),l=()=>n(959013),d=()=>n(449506),c=()=>n(554509),u=()=>n(719147),p=()=>n(836251),m=()=>n(47170),g=()=>n(506090),f=()=>n(906195),y=()=>n(981046),v=()=>n(284371),h=n(474848);const b=function(){const e=(0,o().IS)((e=>({discountDescription:{alignItems:"center",color:e.text.secondary,fontSize:12,lineHeight:v().K_.UISmall.desktop}})),[]);return(0,h.jsx)("div",{style:e.discountDescription,children:(0,h.jsx)(l().sA,{id:"spaceSubscriptionSettings.orderOptions.estimatedPriceWarning",defaultMessage:"The final amount due may be impacted by prorations and member changes since your last invoice."})})};function x(e){const{products:t,showTrialEndDisclaimer:n,showProductTerms:r=!0}=e,a=(0,o().IS)((()=>({termsOfService:{display:"flex",flexDirection:"column",gap:12}})),[]),l=(0,i().K8)((()=>y().A.state.selectedCurrencyCode),[]),d=t.includes("ai"),u=t.some((e=>"ai"!==e)),p=void 0!==l&&"USD"!==l,m=(0,i().K8)((()=>{var e;return g().A.state.open?null===(e=g().A.state)||void 0===e?void 0:e.coupon:void 0}),[]),v=(0,f().D)()&&t.includes("plus")&&(0,s().u6)(m);return(0,h.jsx)(c().D,{styleName:"Body-12px/Regular",colorName:"secondary",children:(0,h.jsxs)("div",{style:a.termsOfService,children:[n?(0,h.jsx)(j,{}):null,r?(0,h.jsx)(S,{hasAi:d,hasPlan:u}):null,u&&v&&(0,h.jsx)(C,{}),p?(0,h.jsx)(_,{currencyCode:l}):null]})})}function S(e){let{hasAi:t,hasPlan:n}=e;return(0,h.jsxs)(h.Fragment,{children:[t&&!n?(0,h.jsx)(I,{}):null,t&&n?(0,h.jsx)(A,{}):null,!t&&n?(0,h.jsx)(w,{}):null]})}function j(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"spaceSubscriptionUpgradeModal.trialWillEndToday.message",defaultMessage:"Upgrading will end your trial and your workspace will be billed immediately."})})}function I(){const e=function(){const e=(0,a().v3)(),t=(0,m().O)(),[n,i]=(0,r.useState)();return(0,r.useEffect)((()=>{async function n(){var n;if(!t)return!1;const r=await d().callApi({eventName:"getSpaceMembershipUpdates",environment:e,data:{spaceId:t}});if("failed"===r.type)return!1;const a=!1===(null===(n=r.data[0])||void 0===n?void 0:n.isProcessed);i(!!a)}n()}),[e,t]),n}();return(0,h.jsxs)("div",{children:[(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.aiOnly",defaultMessage:"By continuing, you agree to the <aiTerms>Notion AI Product Specific Terms</aiTerms>.",values:{br:(0,h.jsx)("br",{}),aiTerms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("ai.terms"),external:!0,children:e})}}),e?(0,h.jsx)(b,{}):null]})}function A(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planWithAi",defaultMessage:"By continuing, you agree to the <terms>Notion Terms and Conditions</terms> and <aiTerms>Notion AI Product Specific Terms</aiTerms>.",values:{br:(0,h.jsx)("br",{}),terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms"),external:!0,children:e}),aiTerms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("ai.terms"),external:!0,children:e})}})})}function w(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planOnly",defaultMessage:"By continuing, you agree to the <terms>Notion Terms and Conditions</terms>.",values:{terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms"),external:!0,children:e})}})})}function C(){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.planOnlyResurrection",defaultMessage:"Enjoy 50% off your first 3 months of billing, then standard rates apply. <learnMore>Learn more</learnMore>",values:{learnMore:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("resurrectionLearnMore"),external:!0,children:e})}})})}function _(e){return(0,h.jsx)("div",{children:(0,h.jsx)(l().sA,{id:"subscriptionUpgradeModal.confirmation.currencyRateWarning",defaultMessage:"<terms>Learn about FX rates</terms>. Rates will refresh throughout the billing period.",values:{terms:e=>(0,h.jsx)(u().A,{href:(0,p().xS)("terms.currency.fxRates"),external:!0,children:e})}})})}},816953:(e,t,n)=>{n.d(t,{A:()=>l});var r=()=>n(484714),a=()=>n(660237),i=()=>n(187174),o=()=>n(816758),s=()=>n(449506);function l(){var e;const t=(0,r().v3)(),[n]=(0,i().Yb)((async()=>{const e=await s().callApi({eventName:"getGeoIpLocation",environment:t,data:{}});if("success"===e.type)return e.data}),[t]),l=null==n||null===(e=n.value)||void 0===e?void 0:e.countryCodeFromIp;return!!(0,a().Ef)(l)&&(0,o().Lv)(l)}},889173:(e,t,n)=>{n.d(t,{f:()=>p});n(296540);var r=()=>n(148307),a=()=>n(401497),i=n(474848);function o(e){const{style:t,shadowVariant:n="strong",wrapStyle:r,imageSrc:o,variant:s="medium",alt:l,wrapWithPadding:d=!0}=e;let c=36;"medium"===s?c=36:"large"===s&&(c=48);const u=(0,a().IS)((e=>({faceImgWrap:{width:c,height:c,borderRadius:"100%",background:e.assistantCornerButtonBackground,..."strong"===n&&{boxShadow:e.shadowMD},..."light"===n&&{borderRadius:"50%",boxShadow:e.shadowSM},overflow:"hidden",...r},faceImg:{height:c,width:c,...d&&{pointerEvents:"none"},...t}})),[n,r,d,t,c]),p=(0,i.jsx)("img",{style:u.faceImg,src:o,alt:l});return d?(0,i.jsx)("div",{children:(0,i.jsx)("div",{style:u.faceImgWrap,children:p})}):p}var s=()=>n(200424);function l(){const e=(0,a().IS)((e=>({wrapper:{display:"inline-block",position:"relative",width:55,height:50,top:0,right:0},headset:{position:"absolute",width:16,objectFit:"cover",left:0,bottom:0},notionAIFace:{position:"absolute",top:0,right:0}})),[]);return(0,i.jsxs)("div",{style:e.wrapper,children:[(0,i.jsx)(o,{imageSrc:s(),variant:"large",alt:"Notion AI Meeting Notes Icon",style:e.notionAIFace,wrapStyle:e.notionAIFace}),(0,i.jsx)("img",{style:e.headset,src:r().A.images.subscriptions.meetingNotesSvg,alt:"Notion AI Meeting Notes Icon"})]})}function d(){const e=(0,a().IS)((e=>({wrapper:{display:"inline-block",position:"relative",width:52,height:52},mailIcon:{position:"absolute",width:24,objectFit:"cover",right:0,bottom:0}})),[]);return(0,i.jsxs)("div",{style:e.wrapper,children:[(0,i.jsx)(o,{imageSrc:s(),variant:"large",alt:"Notion AI Mail Icon"}),(0,i.jsx)("img",{style:e.mailIcon,src:r().A.images.subscriptions.notionAiMailSvg,alt:"Notion AI Mail Icon"})]})}var c=()=>n(938987),u=()=>n(558094);function p(e){const{headerContent:t,primaryProduct:n}=e;if("featureWithCustomImage"in t)switch(t.featureWithCustomImage){case"coreAI":case"aiConnectors":return(0,i.jsx)(c().cG,{variant:"medium_large"});case"meetingNotes":return(0,i.jsx)(l,{});case"researchMode":return(0,i.jsx)(o,{imageSrc:r().A.images.subscriptions.researchModeSvg,variant:"large",alt:"Notion Research Mode"});case"notionAIForMail":return(0,i.jsx)(d,{})}else if("ai"===n)return(0,i.jsx)(c().cG,{variant:"medium_large"});return(0,i.jsx)(u().X,{product:n})}},906195:(e,t,n)=>{n.d(t,{D:()=>y});var r=n(296540),a=()=>n(484714),i=()=>n(847249),o=()=>n(786508),s=()=>n(166386),l=()=>n(449506),d=()=>n(640653),c=()=>n(58293),u=()=>n(351360),p=()=>n(749356),m=()=>n(714300),g=()=>n(762433),f=()=>n(807778);function y(){const e=(0,a().v3)(),t=(0,c().r)(),n=null==t?void 0:t.id,y=(0,m().l)({spaceId:n}),[v,h]=(0,r.useState)(!1),{currentSpaceStore:b}=(0,i().K8)((()=>{const{currentSpaceStore:e}=u().default.state;return{currentSpaceStore:e}}),[]),x=(0,i().K8)((()=>b?(0,d().GK)(e,b):void 0),[b,e]),S=function(e){return(0,i().K8)((()=>(0,f().vv)()&&Boolean("free"===(0,g().AI)(e))),[e])}(y),j=(0,i().K8)((()=>null==t?void 0:t.canAdmin()),[t]);return(0,r.useEffect)((()=>{!async function(){if(S&&n&&j)try{const t=await l().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:n,offerCampaign:"resurrection_offer"}});if("failed"===t.type)return;if("offer"in t.data){const n=(0,o().RS)(t.data.offer);(0,s().u6)(n)&&(h(!0),x&&(0,p().Zc)({environment:e,spaceName:x,offerCampaign:"resurrection_offer"}))}}catch(t){return}}()}),[e,n,S,x,j]),v}}}]);