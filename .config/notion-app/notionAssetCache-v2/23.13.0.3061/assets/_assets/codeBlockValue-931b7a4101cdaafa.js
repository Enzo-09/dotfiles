"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[69734],{141768:(e,t,n)=>{n.d(t,{YH:()=>s,bi:()=>r});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(908872);var o=()=>n(919709),i=()=>n(496603),a=()=>n(713972);function r(e){let t="";const n=document.createElement("div");n.innerHTML=e;const o=a().zn(n);for(const a of o){const e=i().ih(a.data);if(null!==a.parentElement&&a.parentElement!==n){t+=`<span class="${l({parent:a.parentElement,root:n}).join(" ")}">${e}</span>`}else t+=e}return t}function l(e){const{parent:t,root:n}=e,o=new Set;let i=t;for(;i&&i!==n;)i.classList.forEach((e=>{o.add(e)})),i=i.parentElement??void 0;return Array.from(o)}function s(e,t){const n={text:d(e),syntax:d(t)},i=function(e){let t=0;return e.reduce(((e,n)=>(e.push([t,n]),t+=n,e)),[])}(function(e,t){const n=e.slice(),o=t.slice(),i=[];let a=0,r=0;for(;a<n.length&&r<o.length;){const e=n[a],t=o[r];e===t?(i.push(e),a+=1,r+=1):e<t?(i.push(e),a+=1,o[r]-=e):(i.push(t),n[a]-=t,r+=1)}return i}(n.text,n.syntax)),a={text:0,syntax:0},r={text:0,syntax:0},l=[],s=e.map(o().N8A).join("");for(const[o,d]of i){const e=o+d,i=t[a.syntax],u={value:s.substring(o,e),textTokenIndex:a.text,classNames:(c=i,c&&c[1])};l.push(u);const m=n.text[a.text],p=n.syntax[a.syntax];e>=r.text+m&&(a.text+=1,r.text+=m),e>=r.syntax+p&&(a.syntax+=1,r.syntax+=p)}var c;return l}function d(e){return e.map((e=>e[0].length))}},849332:(e,t,n)=>{n.r(t),n.d(t,{CodeBlockValueWithDeps:()=>D});n(18107),n(967357),n(581454);var o=n(296540),i=()=>n(847249),a=()=>n(979004),r=()=>n(379632),l=()=>n(919709),s=()=>n(191772),d=()=>n(496603),c=()=>n(884107),u=()=>n(319975),m=()=>n(315097),p=()=>n(751156),g=()=>n(659602),v=()=>n(354584),f=()=>n(335722),k=()=>n(921855),b=()=>n(713972),h=()=>n(231722),S=()=>n(141768),C=()=>n(645873),x=()=>n(77246),y=()=>n(735372),M=()=>n(871399),A=n(474848);const w=1e4,T=o.memo((function(e){const{disabled:t,store:g,blockStore:v,markdownLinkifyIt:f,codeWrap:b,wrapStyle:C,tinyMceMicrosoftWordPasteFilter:T,language:D,Prism:P,parentSpaceId:V,isQuickFind:F,style:_,disableSuggestEdit:H}=e,R=(0,n(959013).tz)(),U=(0,n(484714).v3)(),j=(0,n(401497).DP)(),O=(0,n(792485).S)(),$=(0,o.useRef)(null),L=(0,n(493720).RJ)(),W=(0,n(963589).X)("improved_cursor_navigation"),q=(0,i().O$)(n(24157).default),K=(0,i().O$)(n(116008).A),z=(0,i().O$)(n(555776).A),J=(0,i().O$)(y().qu),Y=(0,i().O$)(y().wb),G=(0,i().K8)((()=>O&&O.publicEditModeStore.state),[O]),Q=(0,i().K8)((()=>O&&O.pageStore?x().Uv.getMode(O.pageStore):"default"),[O]),X=(0,i().K8)((()=>g.canEdit()),[g]),Z=(0,i().K8)((()=>g.canComment()),[g]),ee=(0,o.useMemo)((()=>{var e;return"editing"===q.mode&&(null===(e=(0,h().H7)(q.multiSelection))||void 0===e?void 0:e.store)===g}),[g,q]),te=(0,o.useCallback)((()=>{var e;null===(e=$.current)||void 0===e||null===(e=e.getNode())||void 0===e||e.blur()}),[$]),ne=(0,o.useMemo)((()=>{var e;return K.open&&"inline"===K.type&&(null===(e=(0,h().H7)(K.multiSelection))||void 0===e?void 0:e.store)===g}),[K,g]),oe=(0,o.useCallback)((()=>{if((0,n(731320).QT)(G))return!1;const e=null!=O&&O.pageStore?Q:"default";return!(t||"suggest"!==e||!Z)||Boolean(!t&&X)}),[t,null==O?void 0:O.pageStore,G,Q,X,Z]),ie=(0,o.useMemo)((()=>!oe()),[oe]),ae=(0,i().K8)((()=>{if(!z.isHovered||"right_margin_button"!==z.hoverEntryPoint)return!1;const e=M().default.state.isOpen?M().default.state.currentStore:void 0;return g&&(null==e?void 0:e.id)===g.id}),[g,z]),re=(0,o.useMemo)((()=>{const e=(0,n(792540).wc)(Y)&&Y.id===g.id;return{query:J,focusedResult:e?Y:void 0}}),[Y,J,g.id]),le=(0,o.useCallback)(((e,t)=>{(0,n(267856).D)({type:e,environment:U,blockStore:v,store:g,isInCollectionView:!1,eventTimeStamp:t})}),[U,v,g]),se=(0,o.useCallback)((e=>{var t,o;if(!oe)return;if(le("typing_enter",e.timeStamp),null===(t=e.preventDefault)||void 0===t||t.call(e),$&&null!==(o=$.current)&&void 0!==o&&o.isComposing())return;const i="editing"===q.mode&&(0,h().H7)(q.multiSelection);if(i){const e=null!=O&&O.pageStore?Q:"default";!function(e){const{environment:t,editorMode:o,store:i,selection:a}=e;let r="";if(n(508496).default.checkGate({gateName:"code_block_preserve_indent"})){const e=l().Ffo(i.getValue(),0,a.startIndex),t=l().q4_(e).split("\n").at(-1),n=null==t?void 0:t.match(/^[ \t]+/);n&&(r=n[0])}p().createAndCommit({userAction:"CodeBlockValue.handleEnter",environment:t,canUndo:!0,perform:e=>{u().$D({environment:t,editorMode:o,store:i,string:`\n${r}`,selection:a,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})}({environment:U,store:g,editorMode:e,selection:i.selection})}}),[g,U,le,O,$,oe,q,Q]),de=(0,o.useCallback)((e=>{var t;k().HP({environment:U,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:ne,isRightMarginCommentActionHovered:ae}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:oe()})}),[g,U,v,oe,re,$,ne,ae]),ce=(0,o.useCallback)((e=>{if(oe()&&(le("typing_delete",e.timeStamp),"editing"===q.mode&&q.multiSelection.start.store===g)){const t=null!=O&&O.pageStore?Q:"default";p().createAndCommit({userAction:"CodeBlockValue.handleDelete",environment:U,canUndo:!0,perform:n=>{m().wT({environment:U,multiSelection:q.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:t})}})}}),[U,g,le,oe,O,q,Q]),ue=(0,o.useCallback)((e=>{if(oe()&&(le("typing_backspace",e.timeStamp),"editing"===q.mode&&q.multiSelection.start.store===g)){if(m().CZ({device:U.device,event:e,multiSelection:q.multiSelection}))return;const t=null!=O&&O.pageStore?Q:"default";p().createAndCommit({userAction:"CodeBlockValue.handleBackspace",environment:U,canUndo:!0,perform:n=>{m().wT({environment:U,multiSelection:q.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:t})}})}}),[U,g,le,oe,O,q,Q]),me=(0,o.useCallback)((e=>{var t;if(oe()&&(le("typing_enter",e.timeStamp),null===(t=e.preventDefault)||void 0===t||t.call(e),"editing"===q.mode)){const e=null!=O&&O.pageStore?Q:"default";p().createAndCommit({userAction:"CodeBlockValue.handleShiftEnter",environment:U,canUndo:!0,perform:t=>{n(261374).Ve({environment:U,editorMode:e,multiSelection:q.multiSelection,transaction:t})}}),E()}}),[U,le,oe,null==O?void 0:O.pageStore,q,Q]),pe=(0,o.useCallback)((e=>{if(!oe())return;le("typing_tab",e.timeStamp),e.preventDefault();const t="editing"===q.mode&&(0,h().H7)(q.multiSelection);if(t){const e=null!=O&&O.pageStore?Q:"default";p().createAndCommit({userAction:"CodeBlockValue.handleTab",environment:U,canUndo:!0,perform:n=>{u().RJ({environment:U,editorMode:e,store:g,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,g,le,oe,null==O?void 0:O.pageStore,q,Q]),ge=(0,o.useCallback)((e=>{if(!oe())return;le("typing_untab",e.timeStamp),e.preventDefault();const t="editing"===q.mode&&(0,h().H7)(q.multiSelection);if(t){const e=null!=O&&O.pageStore?Q:"default";p().createAndCommit({userAction:"CodeBlockValue.handleUntab",environment:U,canUndo:!0,perform:n=>{u().Ye({environment:U,editorMode:e,store:g,selection:t.selection,transaction:n,shouldStripTokens:!0})}})}}),[U,g,le,oe,O,q,Q]),ve=(0,o.useCallback)((async e=>{if(!oe())return void e.preventDefault();(await c().R.clipboardActions.load()).cutWithMaybeConfirmation({environment:U,event:e,markdownLinkifyIt:f})}),[U,f,oe]),fe=(0,o.useCallback)((async e=>{if(!oe())return void e.preventDefault();const t=await c().R.clipboardActions.load();p().createAndCommit({userAction:"CodeBlockValue.handlePaste",environment:U,canUndo:!0,perform:n=>{t.paste({environment:U,event:e,disableEmbedMenu:!0,transaction:n,onPasteFiles:t.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:f,tinyMceMicrosoftWordPasteFilter:T})}})}),[U,f,T,oe]),ke=(0,o.useCallback)((e=>{var t;k().sp({environment:U,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:ne,isRightMarginCommentActionHovered:ae}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:oe()})}),[oe,U,re,$,g,v,ne,ae]),be=(0,o.useCallback)((e=>{var t;k().W5({environment:U,event:e,textValue:N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:ne,isRightMarginCommentActionHovered:ae}),editorNode:(null===(t=$.current)||void 0===t?void 0:t.getNode())||void 0,store:g,canEdit:oe()})}),[re,g,v,ne,ae,$,oe,U]),he=(0,o.useCallback)((()=>{if(ee)return(0,n(792002).Do)(g)}),[ee,g]),Se=(0,o.useCallback)((()=>{const e=n(634201).PE(l().q4_(N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:ne,isRightMarginCommentActionHovered:ae})));return{startIndex:e.length,endIndex:e.length}}),[g,v,re,ne,ae]),Ce=(0,o.useRef)(),xe=(0,o.useCallback)((()=>{const e=N({store:g,blockStore:v,inPageFindDetails:re,isNewDiscussionMenuTarget:ne,isRightMarginCommentActionHovered:ae}),t=l().q4_(e),i=P.languages[D];D!==a().PrismLanguages.html&&D!==a().PrismLanguages.markup||(P.languages.markup.tag.addInlined("style","css"),P.languages.markup.tag.addInlined("script","javascript"));const c=t.length>=w,u=Ce.current;if(Ce.current=t.length,t&&i&&!c){const n=document.createElement("div"),a=P.highlight(t,i,D);n.innerHTML=S().bi(a);const c=Array.from(n.childNodes).map(B),u=function(e){let{syntaxTokens:t,textValue:n,parentSpaceId:o,store:i,theme:a}=e;const r=s().E7(n&&{value:n,spaceId:o},i.getRecordModel),d=S().YH(r,t),c=r.map(l().uPN).map((e=>s().sT({annotations:e,theme:a,spaceId:o,getRecordModel:i.getRecordModel})));return d.map(((e,t)=>(0,A.jsx)("span",{className:[e.classNames||"",...c[e.textTokenIndex].classNames].join(" "),style:c[e.textTokenIndex].style,"data-token-index":e.textTokenIndex,children:e.value},t)))}({parentSpaceId:V,store:g,syntaxTokens:d().oE(c),textValue:e,theme:j}),m=(0,A.jsxs)(o.Fragment,{children:[u,(0,A.jsx)("span",{children:"\n"})]});return r().A.renderToStaticMarkup(m)}c&&"number"==typeof u&&u<w&&function(e){const{intl:t}=e,o=new Intl.NumberFormat(t.locale),i=o.format(w);n(812182).HK({presentationType:"transient",title:t.formatMessage({id:"codeBlock.maxChars.toast.title",defaultMessage:"Code highlighting disabled"}),message:t.formatMessage({id:"codeBlock.maxChars.toast.message",defaultMessage:"Syntax highlighting is not supported for more than {numBlocks} characters"},{numBlocks:i})})}({intl:R});const m=k().S5({environment:U,textValue:e&&{value:e,spaceId:V},parentStore:g,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!0,disableSuggestionAnnotations:!1,disabled:!oe(),theme:j,emojiType:"raw",katex:void 0,formulaValueTypes:[]});return r().A.renderToStaticMarkup((0,A.jsx)(A.Fragment,{children:m}))}),[re,g,v,ne,ae,U,oe,V,P,D,j,R]),ye=(0,o.useCallback)((()=>{p().createAndCommit({userAction:"CodeBlockValue.handleMoveUp",environment:U,canUndo:!0,perform:e=>{u().$P({environment:U,transaction:e,direction:"up"})}})}),[U]),Me=(0,o.useCallback)((()=>{p().createAndCommit({userAction:"CodeBlockValue.handleMoveDown",environment:U,canUndo:!0,perform:e=>{u().$P({environment:U,transaction:e,direction:"down"})}})}),[U]),Ae=(0,o.useCallback)(((e,t)=>{oe()&&(t.preventDefault(),n(482287).po({environment:U,annotation:e}),E())}),[oe,U]),we=(0,o.useCallback)((e=>{const{newValue:t}=e;le("typing_lag",e.timeStamp);const n=null!=O&&O.pageStore?x().Uv.getMode(null==O?void 0:O.pageStore):"default";p().createAndCommit({userAction:"CodeBlockValue.handleMutation",environment:U,canUndo:!0,perform:e=>{u().dw({environment:U,editorMode:n,store:g,newValue:t,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e})}})}),[le,U,g,null==O?void 0:O.pageStore]),Te=(0,o.useCallback)((async e=>{(await c().R.clipboardActions.load()).copy({environment:U,event:e,markdownLinkifyIt:f})}),[U,f]),De=(0,o.useCallback)(((e,t,o)=>{let{leafRef:i,wrapperRef:a,...r}=e;if($)return(0,A.jsx)("div",{ref:a,style:{display:"flex",padding:"12px 0px",...!b&&{overflowX:"auto",WebkitOverflowScrolling:"touch"},...C},className:"line-numbers notion-code-block",...r,children:(0,A.jsx)(n(477450).A,{leafRef:L($,i),style:{...I(j,_),...F&&{paddingTop:12},...b?{whiteSpace:"break-spaces",wordBreak:"break-all",minWidth:0}:{whiteSpace:"pre"}},debugName:"CodeBlockValue",store:g,isDisabled:ie,getHtml:xe,getSelection:he,onMutation:e=>we(e),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:ke,onMouseOut:be,suppressNewlineEvents:!1,placeholder:" ",disableContentEditableWhenNotEditingTextOnMobile:!0,expandSelectionOnTripleClick:!1})})}),[F,b,C,j,_,ie,xe,he,we,ke,be,L,$,g]);return(0,A.jsx)(n(682372).F,{store:g,disabled:t,clearBrowserSelection:te,onBlur:te,getEndSelection:Se,onClick:de,onDelete:ce,onBackspace:ue,onEnter:se,onShiftEnter:me,onCommandEnter:d().D_,onCommandShiftEnter:d().D_,onTab:pe,onUntab:ge,onToggleHighlight:e=>Ae(["h",n(77272).A.getMostRecentlyUsedColor()],e),onToggleBold:e=>Ae(["b"],e),onToggleItalics:e=>Ae(["i"],e),onToggleUnderline:e=>Ae(["_"],e),onToggleStrike:e=>Ae(["s"],e),onToggleCode:d().D_,onCopy:e=>Te(e),onCut:ve,onPaste:fe,onMoveUp:ye,onMoveDown:Me,render:De,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,topBottomPadding:W?22:40,pasteBehavior:"inline",disableSuggestEdit:H})}));function D(e){const{value:t}=(0,C().fJ)(v().y),{value:n}=(0,C().fJ)(g().g),{value:o}=(0,C().fJ)(f().S);return t?(0,A.jsx)(T,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function E(){n(908006).default.flush()}function B(e){return b().KH(e)?[e.data]:b().vq(e)?[e.textContent||"",e.className]:void 0}function I(e,t){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:n(284371).vc(n(662303).locale).githubMono,fontSize:"85%",tabSize:2,minHeight:"1em",color:e.text.primary,...t}}function N(e){const{store:t,blockStore:n,inPageFindDetails:o,isNewDiscussionMenuTarget:i,isRightMarginCommentActionHovered:a}=e;let r=t.getValue();if(o.query&&(r=k().nu({textValue:r,blockId:null==n?void 0:n.id,find:o.query,textProps:{type:"block_match"},currentFocusedResult:o.focusedResult})),a){const e=l().qAZ(r);return k().PB({store:t,temporaryAnnotation:l().Ifu.TemporarySelection,multiSelection:{start:{store:t,index:0},end:{store:t,index:e.length}}})}return i?k().Fm({store:t}):r}}}]);