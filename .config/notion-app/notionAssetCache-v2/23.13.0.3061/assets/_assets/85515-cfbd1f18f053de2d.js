"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[85515],{585515:(e,t,o)=>{o.d(t,{T:()=>v});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(430670),o(803949),o(581454),o(908872);var n=()=>o(496603),s=()=>o(763824),i=()=>o(534177),c=()=>o(700500),a=()=>o(452540),r=()=>o(792071),l=()=>o(577449),u=()=>o(212547),d=()=>o(388821),p=()=>o(696706),f=()=>o(912720),h=()=>o(199378),g=()=>o(179034),b=()=>o(519831),m=()=>o(869558),C=()=>o(343666),y=()=>o(197959),k=()=>o(37165),P=()=>o(144081),I=()=>o(919709);async function v(e,t,o){var v;const{isServerMultiCellRequest:M,shouldTraverseToggleBlocks:B,loadButtonBlockChildren:T,omitAncestorDependencies:V}=e;let O;const j={};O=e.cursor?n().mg(e.cursor.stack):[];const L=e.page.id,R=e.limit,S=e.batchLoadChildren??!1,A=e.contentBatchSize??25,E=d().RecordMap.create();0===O.length&&O.push([{table:g().ev,id:L,index:0,spaceId:e.page.spaceId}]);let F=0,z=0;const D=l().h.throughRecordMap(E,t),N=async(e,t)=>{if(!e.length)return d().RecordMap.create();const{sameCellPointers:o,crossCellPointers:s}=await q(e);for(const[n,i]of Object.entries(s))j[n]??=new Map,i.forEach((e=>{j[n].set(e.id,e)}));z+=o.length;const c=await D(o),r=n().hS([...c].map((e=>{let{model:t}=e;return t})).filter(i().O9).flatMap((e=>U(e))),a().jV);if(t){const e=n().hS([...c].map((e=>{let{model:t}=e;return t})).filter(i().O9).flatMap((e=>X(e))),a().jV);V?await Promise.all([N(r,!1),N(e,!0)]):await N(e.concat(r),!0)}else await N(r,!1);return c},Q=l().h.fromLoadRecords((e=>N(e,!0))),q=async e=>{if(M&&!M.isMainCell){const{spaceCellObjects:t,mainDbObjects:o}=await M.groupValueContainingRecordPointerByCell(e,(e=>e),((e,t)=>{t.spaceId=e})),n=t[M.currentCellId]??[];return delete t[M.currentCellId],n.push(...o),{sameCellPointers:n,crossCellPointers:t}}return{sameCellPointers:e,crossCellPointers:{}}},G=new Set,K=(e,t)=>t.filter((e=>{let[t,o]=e;const n=(0,a().jV)(t);return!G.has(n)&&(G.add(n),!0)})).map((t=>{let[n,s,i]=t;return o&&o({table:e.table,id:e.id},n,s,i),n})),U=function(e){const t=[];if((0,u().A0)(e)){const o=e.getParentPointer();t.push([o,"Block parent_id"])}return K(e,t)},X=function(t){const o=[];function n(t,n){I().air(t,{spaceId:n,inlinePageLink:e}).forEach((e=>{o.push([e,"text token mention",{suppressErrorOnClient:!0}])}))}if(t.table===g().ev){const e=t.getCollectionViewPointers();for(const t of e)o.push([t,"CollectionViewBlock view_id"]);if(t.type===c().xd.form){const e=t.getLayoutPointer();e&&o.push([e,"Form layout"])}const s=t.getCollectionPointer();s&&o.push([s,"CollectionViewBlock collection_id"]);const i=t.getDiscussionPointers();for(const t of i)o.push([t,"Discussion"]);const a=t.getProperties().title;if((0,c().Db)(t.getType(),t.getFormat())&&a&&n(a,t.spaceId),t.getType()===c().xd.alias){const e=t.getAliasTargetPointer();e&&o.push([e,"alias"])}else if(t.isExternalObjectInstanceType()){const e=t.getExternalObjectSubInstancePointers();for(const t of e)o.push([t,"eoi"])}else if(t.getType()===c().xd.button){const e=t.getAutomationPointer();e&&o.push([e,"button_automation"])}}else if(t.table===y().$Y){if(!t.getResolved()){for(const e of t.getCommentPointers())o.push([e,"discussion table comment"]);for(const e of t.getReactionPointers())o.push([e,"discussion table reaction"])}}else if(t.table===C().SN){const e=t.getCreatedByPointer();e&&o.push([e,"comment table author"]);const s=t.getText();s&&n(s,t.spaceId);for(const n of t.getContentPointers())o.push([n,"comment table attachment"]);for(const n of t.getReactionPointers())o.push([n,"comment table reaction"])}else if(t.table===m().Gy){const e=t.getFormatStore().getKeyStore("collection_pointer").getValue();e&&o.push([e,"CollectionView collection_id"])}else if(t.table===P().zx){if("form"===t.getLayoutType()){const e=t.getRawModules().form_layout_schema||[];for(const n of e)"formQuestion"===n.type&&o.push([{table:k().lo,id:n.formQuestionId,spaceId:t.spaceId},"Form question"])}else{const e=t.getBlockChildren();for(const t of e)o.push([{table:g().ev,id:t},"Layout dependent block"])}}else if(t.table===f().yB){const e=t.getActionPointers();for(const t of e)o.push([t,"Automation action_ids"])}else if(t.table===h().SC)for(const e of t.getBlocks())o.push([{table:g().ev,id:e},"Automation action blocks"]);else if(t.table===b().Vl){for(const s of t.getAutomationPointers())o.push([s,"Collection automation_ids"]);const e=t.getLayoutPointer();e&&o.push([e,"Collection layout"]);const n=t.getSharingEnabledRelationTargetPointer();n&&o.push([n,"Sharing-enabled relation target collection"])}return K(t,o)},Y=new Map,$=[],H=async function(){const t=[],n=O[O.length-1];if(F>=R&&z>10*R||z>20*R||!n)return!1;const s=n.map((e=>{const{table:t,id:o,spaceId:n}=e;return p().L3.fromPointerLike({table:t,id:o,spaceId:n})})),i=await Q(s),a=[];for(let o=0;o<n.length;o++){const s=n[o],d=i.getModel(p().L3.fromPointerLike(s));if(!d||d.table!==g().ev)continue;const f=d.isType(c().xd.button)&&T?w(d,r().b4_.fromRecordMap(E)):null==d?void 0:d.getContentIds(),h=null==d?void 0:d.getFormat();if(!e.verticalColumns&&d&&f&&"column_list"===d.type&&0===s.index){for(let e=0;e<f.length;e++){const o=f[e],n=d.spaceId;a.push([{table:g().ev,id:o,spaceId:n},s,"column"]),t.push({table:g().ev,id:o,index:0,spaceId:n})}s.index=f.length}else if(d&&"transclusion_reference"===d.type&&h&&h.transclusion_reference_pointer&&0===s.index)a.push([h.transclusion_reference_pointer,s,"transclusion reference"]),t.push({...h.transclusion_reference_pointer,index:0}),s.index=1;else if(f&&((0,c().IU)(d.type,h)||d.isType(c().xd.button)&&T)&&(d.id===L&&1===O.length||!(0,c().NC)(d.type)&&(!(0,c().BN)(d.type,h)||B))&&f[s.index]){if(S){var l;const e=x(A,s.index);if(null===(l=Y.get(d.id))||void 0===l||!l.has(e)){var u;for(const t of _(f.map((e=>({table:g().ev,id:e}))),A,e))a.push([t,s,"block content child"]);Y.has(d.id)||Y.set(d.id,new Set),null===(u=Y.get(d.id))||void 0===u||u.add(e)}}else{const e=f[s.index];a.push([{table:g().ev,id:e,spaceId:d.spaceId},s,"block content child"])}t.push({table:g().ev,id:f[s.index],index:0,spaceId:d.space_id}),s.index++}}const d=a.map((e=>{let[t,n,s]=e;return o&&o(n,t,s),t}));await Q(d),a.forEach((e=>{if("block content child"===e[2]){const t=e[0],o=E.getModel(t);if(o&&o instanceof r().zgg&&!o.alive){const e=E.getModel({id:o.parent_id,table:o.parent_table,spaceId:o.spaceId});e&&e instanceof r().zgg&&e.alive&&e.getContentIds().includes(o.id)&&$.push(o.pointer)}}}));const f=t.filter((e=>{for(let t=0;t<O.length;t++){const o=O[t];for(let t=0;t<o.length;t++){const n=o[t];if(n.table===e.table&&n.id===e.id)return!1}}return!0}));return f.length>0?(O.push(f),F++):O.pop(),!0};for(;await H(););if(null===(v=e.performFixForQuasiAliveBlock)||void 0===v||v.call(e,$),M){const t={},o=await s().lX(O,20,(async e=>await M.groupValueContainingRecordPointerByCell(e,(e=>p().L3.fromPointerLike({id:e.id,table:e.table,spaceId:e.spaceId})),((e,t)=>{t.spaceId=e}))));for(const{spaceCellObjects:e,mainDbObjects:s}of o){if(s.length>0){const e=M.currentCellId;t[e]??={stack:[]},t[e].stack.push(s)}for(const[o,n]of Object.entries(e))t[o]??={stack:[]},t[o].stack.push(n)}const n=e.cursor.stack.reduce(((e,t)=>(t.forEach((t=>{e[t.id]=t})),e)),{});for(const[e,s]of Object.entries(j)){t[e]??={stack:[]};Array.from(s.values()).map((e=>{const t=n[e.id];return{...e,index:t?t.index:0}})).forEach((o=>{t[e].stack.push([o])}))}const i=Object.keys(t).map((e=>({...t[e],cellId:e})));return{recordMap:E,cursorValue:{stack:[]},cursorValueCellularized:i}}return{recordMap:E,cursorValue:{stack:O},cursorValueCellularized:[]}}function x(e,t){return Math.trunc(t/e)}function*_(e,t,o){const n=Math.min(o*t,e.length-1),s=Math.min((o+1)*t,e.length);for(let i=n;i<s;i++)yield e[i]}function w(e,t){const o=e.getAutomationPointer();if(!o)return[];const n=t(o);if(!n)return[];return n.getActionPointers().map((e=>t(e))).filter(i().O9).flatMap((e=>e.getBlocks()))}}}]);