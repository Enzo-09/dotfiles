"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[58504],{8802:(e,t,i)=>{i.d(t,{d:()=>u});i(296540);var n=()=>i(484714),s=()=>i(847249),o=()=>i(764880),r=()=>i(53528),a=()=>i(959013),l=()=>i(125565),d=i(474848);function u(e){const{getRecordModel:t,actorPointer:i,lastVerifiedDate:u}=e,c=(0,n().Y0)(),p=(0,a().tz)(),g=(0,s().K8)((()=>(0,o().lR)(p,(0,o().xC)({pointer:i,getRecordModel:t}))),[t,p,i]);return(0,d.jsxs)("div",{style:{padding:"8px 14px"},children:[(0,d.jsx)(l().A,{isSmall:!0,isSecondaryColor:!0,isMobile:c.isMobile,isMultiline:!0,style:{marginBottom:4},children:(0,d.jsx)(a().sA,{defaultMessage:"Last verified by {user}",id:"VerificationMetadata.lastVerified",values:{user:g}})}),(0,d.jsx)(l().A,{isSmall:!0,isSecondaryColor:!0,isMobile:c.isMobile,children:(0,r().OH)({dateTime:u,intl:p})})]})}},15897:(e,t,i)=>{i.d(t,{A:()=>d});i(581454),i(296540);var n=()=>i(401497),s=()=>i(962730),o=()=>i(704152),r=()=>i(859428),a=i(474848);function l(e){const{isFirst:t,isLast:i,isSelected:l,item:d,itemStyle:u,selectedItemStyle:c,innerStyle:p,children:g,colors:m,onClick:v}=e,{isDisabled:y,tooltip:h}=d,f=(0,n().IS)((e=>{const n=(null==m?void 0:m.selectedOutline)??e.blueColor,s=(null==m?void 0:m.unselectedOutline)??e.selectorBorderUnselected;return{SegmentedItem:{alignItems:"center",background:l?null==m?void 0:m.selectedBackground:void 0,borderBottomLeftRadius:t?3:0,borderBottomRightRadius:i?3:0,borderColor:l?n:s,borderStyle:"solid",borderTopLeftRadius:t?3:0,borderTopRightRadius:i?3:0,borderWidth:1,cursor:y?void 0:"pointer",display:"flex",flexBasis:"50%",marginLeft:t?0:-1,padding:0,userSelect:"none",zIndex:l?10:0,...u,...l?c:void 0},Inner:{borderBottomLeftRadius:t?2:0,borderBottomRightRadius:i?2:0,borderColor:l?n:"transparent",borderStyle:"solid",borderTopLeftRadius:t?2:0,borderTopRightRadius:i?2:0,borderWidth:1,display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",padding:"12px 20px",textAlign:"center",width:"100%",...p}}}),[null==m?void 0:m.selectedBackground,null==m?void 0:m.selectedOutline,null==m?void 0:m.unselectedOutline,t,i,l,y,u,c,p]),x=()=>{v&&v(d.key)};return(0,a.jsx)(r().A,{render:e=>(0,a.jsx)(o().A,{ariaLabel:d.ariaLabel,"aria-pressed":l,onClick:x,style:f.SegmentedItem,disabled:y,...e,children:(0,a.jsx)("div",{style:f.Inner,children:g})}),renderTooltip:()=>(0,a.jsx)("div",{children:h}),disableTooltip:l||void 0===h,placement:s().W.Bottom})}function d(e){const{items:t=[],itemStyle:i,selectedItemStyle:s,innerStyle:o,outerStyle:r,value:d,onChange:u,colors:c}=e,p=(0,n().IS)((e=>({SegmentedButton:{background:e.cardContentBackground,display:"flex",width:"100%",...r}})),[r]);return 0===t.length?null:(0,a.jsx)("div",{style:p.SegmentedButton,children:t.map(((e,n)=>(0,a.jsx)(l,{isFirst:0===n,isLast:n===t.length-1,isSelected:e.key===d,item:e,itemStyle:i,selectedItemStyle:s,innerStyle:o,colors:c,onClick:u,children:e.render()},e.key)))})}},51493:(e,t,i)=>{i.d(t,{q:()=>o,y:()=>r});var n=()=>i(534177),s=()=>i(989423);function o(e){const{environment:t,blockStore:i,update:o}=e,r=function(e){switch(e){case"add":return"page_verification_enabled";case"update":return"page_verification_edited";case"remove":return"page_verification_disabled";default:(0,n().HB)(e)}}(o.metadata.action),a=i.id,l=i.getAssociatedCollectionId(),d=i.getSpaceId(),u=o.metadata.entrypoint;let c=l?"db":"non_db";if(l){const e=i.getAssociatedCollectionStore();null!=e&&e.isPageTreeCollection()&&(c="wiki")}"page_verification_enabled"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d,expiration:o.metadata.expiration??void 0,expiration_date:o.metadata.expiration_date??void 0}}}),"page_verification_edited"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d,expiration:o.metadata.expiration??void 0,expiration_date:o.metadata.expiration_date??void 0}}}),"page_verification_disabled"===r&&(0,s().u4)({environment:t,event:{eventName:r,eventProperties:{entrypoint:u,page_type:c,page_id:a,collection_id:l,space_id:d}}})}function r(e){const{environment:t,blockStore:i,entrypoint:n,action:o}=e,r=i.id,a=i.getAssociatedCollectionId(),l=i.getSpaceId();let d=a?"db":"non_db";if(a){const e=i.getAssociatedCollectionStore();null!=e&&e.isPageTreeCollection()&&(d="wiki")}(0,s().u4)({environment:t,event:{eventName:"page_verification_owner_edited",eventProperties:{entrypoint:n,page_type:d,action:o,page_id:r,collection_id:a,space_id:l}}})}},101749:(e,t,i)=>{i.d(t,{N:()=>r});i(296540);var n=()=>i(959013),s=()=>i(423657),o=i(474848);function r(e){const t=(0,s().A)(e);return t.isGuestRequestRequired?(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.guestRequestRequired",defaultMessage:"This guest must be approved by a workspace owner first"}):t.isStoreInTeam?t.teamAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine1",defaultMessage:"This teamspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.teamDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]}):t.spaceAllowsGuests?void 0:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine1",defaultMessage:"This workspace doesn't allow guests."})}),(0,o.jsx)("div",{children:(0,o.jsx)(n().sA,{id:"contextualInvite.buttonAndTokenTooltip.spaceDisablesGuestsAlertLine2",defaultMessage:"Remove any guests to continue."})})]})}},133507:(e,t,i)=>{i.d(t,{j:()=>l});i(296540);var n=()=>i(847249),s=()=>i(959013),o=()=>i(10984),r=()=>i(749240),a=i(474848);function l(e){let{featureAvailability:t}=e;const i=(0,n().K8)((()=>(0,o().aV)(r().subscriptionDataStoreInstance.state)),[])??0,l={type:"unavailable",limit:{type:"cumulative",total:i,current:i},upsell:{type:"product",product:"plus",limit:{type:"cumulative",current:i,total:"unlimited"},trialability:"none"}};t??=l;const d=t.limit.total,u=t.upsell;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to {currentLimit, plural, one {{currentLimit} unique guest} other {{currentLimit} unique guests}}.",values:{currentLimit:d}})}),"product"===u.type?(0,a.jsx)("div",{children:(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2upgrade",defaultMessage:"Upgrade to get up to {upsellLimit, plural, one {{upsellLimit} guest} other {{upsellLimit} guests}}",values:{upsellLimit:u.limit.total}})}):(0,a.jsx)(s().sA,{id:"inviteUserButton.modalTooltip.guestLimitLine2contactSales",defaultMessage:"Contact sales to get more guests"})]})}},206837:(e,t,i)=>{i.d(t,{o:()=>p});i(296540);var n=()=>i(484714),s=()=>i(401497),o=()=>i(149375),r=()=>i(959013),a=()=>i(284371),l=()=>i(115512),d=()=>i(398208),u=()=>i(285790),c=i(474848);function p(e){const{label:t,onClickBackButton:i,onClose:p,width:g,showBottomBorder:m}=e,v=(0,n().v3)(),y=(0,r().tz)(),h=(0,s().IS)((e=>({container:{display:"flex",alignItems:"center",gap:4,height:40,width:g??320,paddingLeft:8,paddingRight:8,borderBottom:m?`1px solid ${e.regularDividerColor}`:void 0},backButton:{width:24,height:24},closeButton:{position:"absolute",right:0,marginRight:8,borderRadius:"100%"},menuTitle:{flexGrow:1,fontWeight:a().Wy.semibold,fontSize:(0,l().ny)(v,"UIRegular")}})),[v,m,g]);return(0,c.jsxs)("div",{style:h.container,children:[(0,c.jsx)(u().A,{icon:o().v,ariaLabel:y.formatMessage({id:"verificationMenuHeader.backButton.ariaLabel",defaultMessage:"Back"}),onClick:()=>i(),style:h.backButton}),(0,c.jsx)("div",{style:h.menuTitle,children:t}),(0,c.jsx)(d().A,{onClose:()=>p(),style:h.closeButton})]})}},423657:(e,t,i)=>{i.d(t,{A:()=>a});var n=()=>i(108944),s=()=>i(299545),o=()=>i(640653);function r(e,t){return(0,o().hN)(e)?{isGuestRequestRequired:!0}:t?{isStoreInTeam:!0,teamAllowsGuests:!0,spaceAllowsGuests:!0,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1}}const a=function(e){return(0,i(847249).K8)((()=>{if((0,s().nw)(e))return{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};if(!(0,s()._p)(e))return(0,o().r7)(e)?r(e,void 0):{isStoreInTeam:!1,spaceAllowsGuests:!0,isGuestRequestRequired:!1};const t=(0,n().Uo)(e),a=(0,n().pp)(e),l=a||i(351360).default.state.currentSpaceStore;if((0,o().r7)(l))return r(l,t);const d=!(null!=a&&a.getDisableGuests());return t?{isStoreInTeam:!0,teamAllowsGuests:!t.getDisableGuests(),spaceAllowsGuests:d,isGuestRequestRequired:!1}:{isStoreInTeam:!1,spaceAllowsGuests:d,isGuestRequestRequired:!1}}),[e])}},583538:(e,t,i)=>{i.d(t,{Ay:()=>Y,Qg:()=>H});i(944114),i(898992),i(354520),i(581454),i(737550);var n=i(296540),s=()=>i(484714),o=()=>i(847249),r=()=>i(764880),a=()=>i(798880),l=()=>i(919709),d=()=>i(959013),u=()=>i(496603),c=()=>i(458366),p=()=>i(722872),g=()=>i(963589),m=()=>i(401497),v=()=>i(842599),y=()=>i(906380),h=()=>i(97835),f=()=>i(966505),x=()=>i(653048),b=()=>i(760217),S=()=>i(406699),C=()=>i(811979),M=()=>i(64e3),A=()=>i(8980),k=()=>i(89924),T=()=>i(351360),_=()=>i(529183),w=()=>i(10984),j=()=>i(980270),I=()=>i(875497),R=()=>i(690490),P=i(474848);function B(e){const t=(0,o().uB)(void 0,_().Ay),i=(0,o().uB)(void 0,I().A),{store:r,inputValue:l,intl:u,propertySchemaLimit:p,isLoading:g,handlePersonPropertyMenuChange:B,format:U}=e,D=(0,s().v3)(),E=(0,m().IS)((e=>({moreBarTitleStyle:{color:e.text.secondary,fontSize:11},desktopTitleStyle:{color:e.text.secondary,fontSize:11},messageBodyStyle:{color:e.text.tertiary,paddingLeft:2},messageTitleStyle:{color:e.text.tertiary},inviteBodyStyle:{color:e.text.primary}})),[]),{isMobile:L}=(0,s().Y0)(),F=(0,o().K8)((()=>{var e;return null===(e=T().default.state.currentSpaceStore)||void 0===e?void 0:e.getName()}),[]),q=(0,o().K8)((()=>i.state.flowId),[i]),{email:G,isEmail:O,inviteButtonTitle:V}=(0,n.useMemo)((()=>{const e=(0,v().qh)(l),t=(0,v().DT)(e),i=u.formatMessage({id:"invite.person_property.button.invite_people",defaultMessage:"Invite people"}),n=u.formatMessage({id:"invite.person_property.button.invite_email",defaultMessage:"Invite ”{email}”"},{email:e});return{email:e,isEmail:t,inviteButtonTitle:t?n:i}}),[l,u]),N=(0,n.useCallback)((()=>{O&&G&&j().handlePopupClickWithEmail({email:G,inviteTargetsStore:t}),f().TS(D,{origin:"person_property_invite",invite_flow_id:q})}),[O,q,G,D,t]),W=(0,n.useCallback)((()=>{f().F$(D,{origin:"person_property_invite",invite_flow_id:q})}),[q,D]),K=(0,o().K8)((()=>{const e=function(e){const{canAddPermissions:t,isMobile:i,format:n}=e,s="enterprise"===e.subscriptionTier;if(i||s||!t||(0,c().NN)(n))return!1;return!0}({canAddPermissions:r.canEditMembership(),isMobile:L,subscriptionTier:(0,w().AI)(),format:U});return e&&f().HJ(D,{origin:"person_property_invite",invite_flow_id:q}),e}),[r,q,L,D,U]),z=(0,o().K8)((()=>{if(!(0,c().NN)(U))return(0,x().t)(p)}),[U,p]);return K?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(k().A,{title:(0,P.jsx)(d().sA,{defaultMessage:"People",id:"database.personPropertyValue.selectPerson.noSearchResults.resultsTitle"}),desktopTitleStyle:E.desktopTitleStyle,loading:g,desktopStyle:{paddingBottom:4},children:(0,P.jsx)(M().A,{title:(0,P.jsx)("span",{style:E.messageBodyStyle,children:(0,P.jsx)(d().sA,{defaultMessage:"No matches in {spaceName}",id:"database.personPropertyMenu.noSearchResults.messageWithSpaceName",values:{spaceName:F}})}),titleStyle:E.messageTitleStyle})}),(0,P.jsx)(k().A,{title:(0,P.jsx)(d().sA,{defaultMessage:"More",id:"database.personPropertyValue.selectPerson.noSearchResults.suggestionTitle"}),desktopTitleStyle:E.moreBarTitleStyle,topBorder:!0,desktopStyle:{marginTop:0,paddingTop:10},children:(0,P.jsx)(C().A,{focused:!1,stopClickPropagation:!0,popupType:S().z7.Popup,renderOrigin:e=>(0,P.jsx)(b().A,{...e,focused:!1,icon:(0,P.jsx)(A().I,{icon:h().x,color:"primary"}),title:V,right:(0,P.jsx)(A().I,{icon:y().x,size:"sm",color:"secondary"}),textWrapperStyle:E.inviteBodyStyle}),onClick:N,onClose:W,borderRadius:8,render:e=>(0,P.jsx)(R().A,{inviteOrigin:"person_property_invite",store:r,handleBackButtonClick:()=>e.close(),inviteTargetsStore:t,personPropertyInviteStore:i,onInviteCompleteFn:t=>{e.close();const i=(t.success?Object.values(t.invitedUsers):[]).map((e=>({table:a().oo,id:e})));B(i)}})})})]}):(0,P.jsx)(k().A,{title:z,loading:g,children:(0,P.jsx)(M().A,{title:(0,P.jsx)(d().sA,{defaultMessage:"No results",id:"database.personPropertyMenu.noSearchResults.message"})})})}var U=()=>i(106628),D=()=>i(508496),E=()=>i(422464),L=()=>i(828180),F=()=>i(928600),q=()=>i(939740),G=()=>i(448693),O=()=>i(513416),V=()=>i(252833),N=()=>i(449506);var W=()=>i(453697);function K(e){let{environment:t,intl:i,store:n,isSyncedCollection:s,inputValue:o,value:l,format:c,propertySchema:p,handlePersonPropertyMenuAddMentions:g,sectionMenuTitle:m,externalSyncedCollectionType:v}=e;const y=async e=>{if(s&&e.emailAddress){const s=await U().T.searchActions.load(),o=await s.searchSpaceActors({environment:t,query:e.emailAddress,membersOnly:!1,userLocale:i.locale,shouldUseEdgeCacheForFeatureGate:D().default.checkGate({gateName:"edge_cache_person_property"}),limit:1});if(1===o.users.length)g([{table:a().oo,id:o.users[0].id}]);else{const i=await async function(e){let{environment:t,externalUser:i,blockPointer:n,externalSyncedCollectionType:s}=e;const o=await N().callApi({eventName:"getOrCreateNotionUserFromExternalUser",environment:t,data:{externalUser:(0,V().Vz)(i,s),blockPointer:n}});if(!(0,O().kX)(o))return"success"===o.type?o.data.notionUser:void 0}({environment:t,externalUser:e,blockPointer:n.pointer,externalSyncedCollectionType:v});i&&g([{table:a().oo,id:i.id}])}}},h={request:{query:o,actors:u().pb(l,r().Pu)},performRequest:async e=>{let{query:i,actors:s}=e;const o=await async function(e){let{environment:t,blockPointer:i,query:n}=e;const s=await N().callApi({eventName:"getExternalUsersForSyncedCollection",environment:t,data:{blockPointer:i,query:n}});return(0,O().kX)(s)?[]:"success"===s.type?s.data.externalUsers:[]}({environment:t,blockPointer:n.pointer,query:i});return{externalUsers:o,type:"externalUsers"}},render:(e,t,i)=>{if(e)return(0,P.jsx)(k().A,{title:m,loading:!i,children:(0,P.jsx)(M().A,{title:(0,P.jsx)(d().sA,{...H.searchErrorMessage})})});if(t&&"externalUsers"!==t.type)return(0,P.jsx)(k().A,{title:m,loading:!i,children:(0,P.jsx)(M().A,{title:(0,P.jsx)(d().sA,{...H.searchErrorMessage})})});const n=u().oE((t&&t.externalUsers||[]).map((e=>{const t=(0,P.jsx)(W().A,{avatar:{email:e.emailAddress,avatarUrl:"",name:e.displayName}});return{key:e.accountId,render:i=>(0,P.jsx)(b().A,{...i,title:e.displayName,caption:e.emailAddress,icon:t}),action:async()=>{await y(e)}}}))),s=u().oE([n.length>0?{key:"external user section",render:e=>(0,P.jsx)(k().A,{...e,title:(0,P.jsx)(d().sA,{defaultMessage:"Select user from Jira",id:"database.personPropertyValue.externalUsers.searchPlaceholder"}),loading:!i}),items:n}:void 0]);return(0,P.jsx)(q().Ay,{type:q().Oh.Vertical,initialFocus:o.length>0?0:void 0,sections:s})}};return{...h}}var z=()=>i(856952);const H=(0,d().YK)({searchForPerson:{defaultMessage:"Search for a person…",id:"database.personPropertyValue.searchPlaceholder"},searchErrorMessage:{defaultMessage:"Something went wrong.",id:"database.personPropertyMenu.searchErrorMessage"},searchOfflineErrorMessage:{defaultMessage:"Unavailable offline.",id:"database.personPropertyMenu.searchOfflineErrorMessage"}});function $(e){let{tokens:t,disabled:i,onChange:n,value:o,inputValue:r,setInputValue:a}=e;const l=(0,s().Y0)(),u=(0,d().tz)(),c=(0,p().Tf)(),m=(0,g().X)("db_ux_chrome")?{padding:L().QJ[0].token,gap:4}:{padding:"4px 6px",gap:4};return(0,P.jsx)(k().A,{disableDesktopPadding:!0,children:(0,P.jsx)(z().Ay,{focus:!l.isMobile||void 0,focusAfterAnimation:!0,format:z().le.Person,tokens:t,tokenWrapStyle:m,placeholder:u.formatMessage(H.searchForPerson),hideInput:i,onRemoveLastToken:()=>{n({type:"personPropertyMenuUpdateRemovePerson",removedValue:o[o.length-1]})},value:r,onChange:e=>a(e.target.value),dontShowBorderBottom:l.isAndroid||c})})}const Y=function(e){const t=(0,g().X)("db_ux_mobile"),m=(0,s().v3)(),v=(0,s().Y0)(),y=(0,d().tz)(),{disabled:h,value:f,format:S,valueIsUnpersistedDefaultValue:C,onChange:A,propertySchema:T,parentStore:_,onDismiss:w,isTemplatePage:j,insertChar:I,formQuestionStore:R,collectionStore:L}=e,[O,V]=(0,n.useState)((()=>I||"")),N=(0,o().K8)((()=>{if(!(0,c().NN)(S))return(0,x().t)(T.limit)}),[S,T.limit]),W=(0,o().K8)((()=>{const e=T.limit;return(0,c().NN)(S)&&R?(0,i(31503).hm)(T,R.getModel()):e}),[R,S,T]),z=(0,o().K8)((()=>void 0!==W&&f.length>=W),[W,f]),Y=(0,n.useCallback)((e=>{!function(e){let{newMentions:t,tokenLimit:i,value:n,valueIsUnpersistedDefaultValue:s,onChange:o}=e;1===i&&t.length>0?o({type:"personPropertyMenuUpdateReplacePerson",newValue:t[0]}):void 0===i?o(s?{type:"personPropertyMenuUpdateAddPerson",newValues:[...n,...t]}:{type:"personPropertyMenuUpdateAddPerson",newValues:t}):t.length+n.length<=i&&o({type:"personPropertyMenuUpdateAddPerson",newValues:t})}({newMentions:e,tokenLimit:W,value:f,valueIsUnpersistedDefaultValue:C,onChange:A}),V("")}),[A,W,f,C]),{tokens:J,selectedTemplateAnnotationVariables:Q}=(0,o().K8)((()=>{const e=[];return{tokens:f.map((t=>{if((0,l().MMZ)(t))return e.push(t),(0,P.jsx)(E().W,{templateVariableType:t,showRemoveButton:!h,onRemove:()=>{A({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},style:{margin:"0px 6px 6px 0px"}},t);if((0,r().Pu)(t)){const e=(0,r().xC)({pointer:t,getRecordValue:_.getRecordValue});return(0,P.jsx)(G().Ay,{actor:e,format:v.isMobile?G().Ay.Format.Large:G().Ay.Format.Medium,showRemoveButton:!h,onClickRemove:()=>{A({type:"personPropertyMenuUpdateRemovePerson",removedValue:t})},shouldShrink:!0,isSingle:!0},t.id)}(0,i(534177).HB)(t)})),selectedTemplateAnnotationVariables:e}}),[v.isMobile,h,A,_.getRecordValue,f]),X=l().Wov.filter((e=>!Q.includes(e))),Z=(0,o().K8)((()=>{const e=Boolean(L&&L.isExternallyImportedAndSyncedCollection()&&(null==L?void 0:L.getFormat().external_collection_type)),t=null==L?void 0:L.getFormat().external_collection_type;if((0,i(504836).CS)()&&e&&t)return K({environment:m,intl:y,store:_,isSyncedCollection:e,inputValue:O,value:f,format:S,propertySchema:T,handlePersonPropertyMenuAddMentions:Y,sectionMenuTitle:N,externalSyncedCollectionType:t});const n={request:{query:O,actors:u().pb(f,r().Pu)},performRequest:async e=>{let{query:t,actors:i}=e;const n=await U().T.searchActions.load(),{users:s}=await n.searchSpaceActors({environment:m,query:t,membersOnly:!1,userLocale:y.locale,shouldUseEdgeCacheForFeatureGate:D().default.checkGate({gateName:"edge_cache_person_property"}),limit:20});return{users:s.filter((e=>!i.some((t=>t.id===e.id)))).slice(0,20),type:"notionUsers"}},render:(e,t,n)=>{if(e){const e=!i(227440).A.state.online;return(0,P.jsx)(k().A,{title:N,loading:!n,children:(0,P.jsx)(M().A,{title:e?(0,P.jsx)(d().sA,{...H.searchOfflineErrorMessage}):(0,P.jsx)(d().sA,{...H.searchErrorMessage})})})}if(t&&"notionUsers"!==t.type)return(0,P.jsx)(k().A,{title:N,loading:!n,children:(0,P.jsx)(M().A,{title:(0,P.jsx)(d().sA,{...H.searchErrorMessage})})});if(t&&0===t.users.length)return(0,P.jsx)(B,{store:_,inputValue:O,intl:y,propertySchemaLimit:T.limit,isLoading:!n,format:S,handlePersonPropertyMenuChange:e=>{Y(e)}});const s=!(z&&W&&W>1),o=u().oE((t&&t.users||[]).map((e=>{const t={key:e.id,render:t=>(0,P.jsx)(i(859428).A,{disableTooltip:s,renderTooltip:()=>(0,P.jsx)(d().sA,{defaultMessage:"To select more, remove selection above",id:"database.personPropertyMenu.limitReached"}),render:n=>(0,P.jsx)(i(457688).A,{...t,actor:(0,r().A7)(e),disabled:!s,disabledFeedback:!s,...n})}),action:()=>{Y([{table:a().oo,id:e.id}])}};return t}))),l=u().oE([o.length>0?{key:"person section",render:e=>(0,P.jsx)(k().A,{...e,title:N,loading:!n}),items:o}:void 0]);return(0,P.jsx)(q().Ay,{type:q().Oh.Vertical,initialFocus:O.length>0?0:void 0,sections:l})}};return n}),[L,O,f,m,y,_,S,T,Y,N,z,W]),ee=(0,P.jsx)($,{tokens:J,disabled:h,onChange:A,value:f,inputValue:O,setInputValue:V});let te;return te=v.isMobile?{menuType:p().gu.Modal,title:T.name,...!t&&{right:(0,P.jsx)(i(480095).DoneMenuText,{}),onClickRight:w},header:ee}:{menuType:p().gu.Popup,header:ee,tokenInputHeader:!0,maxHeight:333},h?(0,P.jsx)(F().A,{...te}):(0,P.jsxs)(F().A,{...te,children:[j&&(0,P.jsx)(k().A,{title:(0,P.jsx)(d().sA,{defaultMessage:"Shortcuts",id:"PersonPropertyMenu.menuItem.shortcuts.label"}),children:X.length>0?(0,P.jsx)(n.Fragment,{children:X.map((e=>(0,P.jsx)(b().A,{focused:!1,title:(0,P.jsx)(E().W,{templateVariableType:e}),caption:(0,i(173979).EC)(e,y),inline:!0,onClick:()=>{Y([e])}},`relative-person-shortcut-${e}`)))}):(0,P.jsx)(M().A,{title:(0,P.jsx)(d().sA,{id:"database.personPropertyMenu.noShorcuts.message",defaultMessage:"No shortcuts"})})}),(0,P.jsx)(i(251126).A,{...Z})]})}},690490:(e,t,i)=>{i.d(t,{A:()=>ae});var n=i(296540),s=()=>i(484714),o=()=>i(847249),r=()=>i(401497),a=()=>i(959013),l=()=>i(100622),d=()=>i(496603),u=()=>i(966505),c=()=>i(545805),p=()=>i(859428),g=()=>i(912913),m=()=>i(366858),v=()=>i(58293),y=()=>i(646736),h=(i(581454),()=>i(401996)),f=()=>i(856952),x=()=>i(529183),b=(i(517642),i(658004),i(733853),i(845876),i(432475),i(515024),i(731698),i(898992),i(803949),()=>i(784892)),S=()=>i(842599),C=()=>i(534177),M=()=>i(284371),A=()=>i(453697),k=()=>i(423657),T=()=>i(101749),_=()=>i(351360),w=()=>i(749240),j=i(474848);const I=function(e){const{store:t,target:n}=e,d=(0,s().Y0)(),u=(0,a().tz)(),c=function(e){const t=(0,r().IS)((()=>({verifiedDomain:{margin:2,backgroundColor:"rgba(83, 168, 63, 0.1)"},disabled:{margin:2,backgroundColor:"rgba(211, 79, 67, 0.1)",border:"dashed #D9655B 1px",paddingLeft:5},normal:{margin:2},guest:{margin:2,backgroundColor:"rgba(218, 163, 64, 0.2)"},error:{margin:2,backgroundColor:"rgba(195,90,75,0.2)",color:"#DE5550"},tokenContent:{display:"flex",alignItems:"center",maxWidth:"100%"},tokenSpan:{maxWidth:"100%"},tokenText:{marginLeft:4,...M().RC},base:e?{borderRadius:4}:{}})),[e]);return t}((0,o().K8)((()=>(0,i(663590).FI)()),[])),g=(0,o().K8)((()=>{const e=w().subscriptionDataStoreInstance.state,t=e?i(134217).Be(e):[],n={};return t.forEach((e=>{n[e.userId]=e})),n}),[]),m=(0,o().K8)((()=>{const e=_().default.state.currentSpaceStore;return new Set(null==e?void 0:e.getEmailDomains())}),[]),v=(0,k().A)(t),y=(0,T().N)(t),h=(0,o().K8)((()=>{if("invalidUser"===n.type)return"invalidUser";if(e.tokenType)return e.tokenType;if("group"===n.type)return"group";if("existingUser"===n.type&&!Boolean(n.spaceRole)){const e=g[n.value.id];n.spaceRole=e?e.role:"not_in_space"}if(!(0,i(743260).yi)(n))return"member";if(v.isGuestRequestRequired)return"guestRequestRequired";if(v.isStoreInTeam&&!v.teamAllowsGuests)return"teamGuestDisabled";if(!v.isStoreInTeam&&!v.spaceAllowsGuests||v.isStoreInTeam&&!v.teamAllowsGuests&&!v.spaceAllowsGuests)return"spaceGuestDisabled";const t=(0,S().zN)(n.value.email);return t&&m.has(t)?"verifiedDomain":"guest"}),[e.tokenType,n,g,m,v]),f=(0,o().K8)((()=>{const e=c.base;switch(h){case"member":case"group":return{...e,...c.normal};case"invalidUser":return{...e,...c.error};case"guest":case"guestRequestRequired":return{...e,...c.guest};case"verifiedDomain":return{...e,...c.verifiedDomain};case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return{...e,...c.disabled};default:(0,C().HB)(h)}}),[h,c]);function I(){switch(n.type){case"newUser":return n.value.email.trim();case"invalidUser":return n.value.text.trim();case"existingUser":return(0,i(695608).c6)(u,n.value);case"group":return(0,i(698449).Pf)({intl:u,groupName:n.value.name});default:(0,C().HB)(n)}}function R(){const e=(0,i(133033).$)({height:16,width:16,color:"#D34F43"});switch(h){case"member":return(0,x().ju)(n)?(0,j.jsx)(A().A,{userValue:n.value,size:16}):(0,x().rP)(n)?(0,j.jsx)(A().A,{size:16,avatar:n.value}):(0,j.jsx)(A().A,{size:16});case"guest":case"guestRequestRequired":return(0,i(328347).h)({height:16,width:16,color:"#DAA340"});case"invalidUser":return(0,i(889154).G)({height:16,width:16,color:"#DE5550"});case"verifiedDomain":return(0,i(22394).o)({height:16,width:16,color:"#53A83F"});case"group":return(0,j.jsx)("div",{style:{height:16,width:16,backgroundColor:l().Ay.whiteWithAlpha(.8),borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i(234194).M)({height:12,width:12,color:l().Ay.mediumTextColor})});case"spaceGuestDisabled":case"teamGuestDisabled":case"teamGroupOwner":return e;default:(0,C().HB)(h)}}function P(t){const i=R();let n=I(),s=c.tokenText;return e.onlyShowTokenType&&(["guest","teamGuestDisabled","spaceGuestDisabled"].includes(t)?(n="Guest",s={...s,color:"#DAA340"}):(n="Member",s={...s,color:"#53A83F"})),(0,j.jsxs)("div",{style:c.tokenContent,children:[i,(0,j.jsx)("div",{style:s,children:n})]})}function B(t){var i;t.stopPropagation(),null===(i=e.onClickRemove)||void 0===i||i.call(e)}const U="newUser"===n.type?n.value.email:"invalidUser"===n.type?n.value.text:n.value.id,D="group"!==n.type&&"invalidUser"!==n.type?n.value.email:void 0;return(0,j.jsx)(p().A,{placement:i(962730).W.Top,renderTooltip:()=>function(e){const{tokenType:t,target:i,email:n}=e;return"guest"===t?(0,j.jsx)(a().sA,{defaultMessage:"{email} will be invited as a guest",id:"inviteTargetToken.guest.tooltip",values:{email:n}}):"spaceGuestDisabled"===t||"teamGuestDisabled"===t||"guestRequestRequired"===t?y:"invalidUser"===i.type?(0,j.jsx)(a().sA,{defaultMessage:"{text} is not a valid email",id:"inviteTargetToken.invalidUser.tooltip",values:{text:i.value.text}}):"verifiedDomain"===t&&"group"!==i.type?(0,j.jsx)(a().sA,{defaultMessage:"{email}{br}will automatically be added to the workspace{br}since @{domain} is an allowed email domain.",id:"inviteTargetToken.verifiedDomain.tooltip",values:{email:i.value.email,br:(0,j.jsx)("br",{}),domain:(0,S().zN)(i.value.email)}}):"group"===i.type?i.value.name||(0,j.jsx)(a().sA,{defaultMessage:"Untitled group",id:"inviteTargetToken.group.untitled"}):n}({tokenType:h,email:D,target:n}),render:t=>(0,j.jsx)("div",{style:c.tokenSpan,...t,children:(0,j.jsx)(i(881690).A,{isSingle:!1,format:d.isMobile?b().NY.Large:b().NY.Medium,showRemoveButton:e.showRemoveButton,onClickRemove:B,disabledFeedback:!0,value:P(h),style:f,shouldWrap:!1})})},U)};const R=function(e){const{flowId:t,store:n,disabled:a,placeholder:u,right:c,focus:p,hideIconColorAndTooltips:g,showEmptyError:m,origin:v,onFocus:y,onSubmit:b,onInputChanged:S}=e,C=(0,s().v3)(),M=(0,s().Y0)(),A=(0,o().uB)(e.inviteTargetsStore,x().Ay),k=(0,o().K8)((()=>A.state.inviteTargets),[A]),T=(0,o().K8)((()=>A.state.tokenQuery),[A]),_=k.map((e=>{const t="newUser"===e.type?e.value.email:"invalidUser"===e.type?e.value.text:e.value.id;return(0,j.jsx)(I,{store:n,target:e,showRemoveButton:!0,tokenType:g?"member":void 0,onClickRemove:()=>h().S({inviteTargetsStore:A,targetToRemove:e})},t)})),w=(0,r().IS)((e=>({tokenInputMenuItem:{paddingTop:_.length>0?4:6,paddingLeft:4,paddingRight:4,paddingBottom:4,borderRadius:4,minHeight:32,...p&&{background:"none"},...a&&{background:e.inputBackground,color:e.text.secondary,fill:l().Ay.white,opacity:.4}},inputAndTokenWrapRight:{gap:2},inputInnerStyle:{paddingTop:0},warningMessage:{color:"#DE5550"}})),[p,a,_]);return(0,j.jsx)(f().Ay,{focus:p,focusAfterAnimation:!0,onClick:()=>{M.isMobile||null==y||y()},format:f().le.Share,value:T,onChange:e=>h().P({environment:C,event:e,inviteTargetsStore:A,inviteOrigin:v,flowId:t,onInputChanged:S}),type:"email",tokens:_,disabled:a,autoComplete:"off",placeholder:u,onRemoveLastToken:()=>{A.setState({...A.state,inviteTargets:A.state.inviteTargets.slice(0,-1)})},right:c,showBorder:!0,inputStyle:w.inputInnerStyle,inputAndTokenWrapRightStyle:w.inputAndTokenWrapRight,style:w.tokenInputMenuItem,onSubmit:b,inputFullWidth:!0,message:(0,j.jsx)(i(381374).p,{invalidInvites:(0,d().oE)(k.map((e=>"invalidUser"===e.type?e:void 0))),showEmptyError:m,styles:w.warningMessage})})};var P=()=>i(454354),B=()=>i(980270),U=()=>i(875497),D=(i(16280),i(354520),i(737550),()=>i(68263)),E=()=>i(542056),L=()=>i(204063),F=()=>i(125565),q=()=>i(133507),G=()=>i(15897),O=()=>i(535279),V=()=>i(731320),N=()=>i(637573),W=()=>i(577437);function K(e){var t;const{store:i,sudoModeStore:r,personPropertyInviteStore:l,onInviteCompleteFn:d,inviteOrigin:c}=e,g=(0,s().v3)(),m=Y(),v=(0,o().uB)(e.inviteTargetsStore,x().Ay),y=(0,o().K8)((()=>l.state.isLoading),[l]),h=(0,n.useCallback)((e=>{l.setState({...l.state,isLoading:e,focus:U().E.NoFocus})}),[l]),[f,b]=(0,n.useState)("member"),S=(0,o().K8)((()=>{const{emailMessage:e}=l.state;return e}),[l]),C=(0,o().K8)((()=>{const{role:e}=l.state;return e}),[l]),M=(0,a().tz)(),A=(0,o().K8)((()=>l.state.flowId),[l]),I=(0,o().O$)(_().AppStoreCurrentSpaceStore),R=(0,o().K8)((()=>i.canEditMembership()),[i]),P=(0,o().K8)((()=>(0,O().U1)({inviteTargetsStore:v})),[v]),L=(0,n.useCallback)((async()=>{await B().handleEnterPress({environment:g,inviteTargetsStore:v,personPropertyInviteStore:l,allowShowEmptyError:!0})}),[g,v,l]),F=(0,n.useCallback)((()=>{const e=(0,O().U1)({inviteTargetsStore:v}),t=e.filter((e=>{let{type:t}=e;return"newUser"===t})).map((e=>{let{value:t}=e;return t.email})),i=e.filter((e=>{let{type:t}=e;return"existingUser"===t})).map((e=>{let{value:t}=e;return t.id}));return V().FC({subscriptionData:w().subscriptionDataStoreInstance.state,newGuestIds:[...t,...i]})}),[v]),K=(0,o().K8)((()=>F()),[F]),J=(0,o().O$)(w().subscriptionDataStoreInstance),Q=(0,N().r)()??0,X=(0,o().K8)((()=>V().LS(J,Q)),[Q,J]),Z=(0,k().A)(i),ee=(0,o().K8)((()=>{if(Z.isGuestRequestRequired)return!1;const e=Z.isStoreInTeam&&!Z.teamAllowsGuests,t=!Z.isStoreInTeam&&!Z.spaceAllowsGuests||Z.isStoreInTeam&&!Z.teamAllowsGuests&&!Z.spaceAllowsGuests,i=P.some((e=>"newUser"===e.type||("existingUser"===e.type?"none"===e.spaceRole||"not_in_space"===e.spaceRole:void 0)));return(e||t)&&i}),[P,Z]),te=(0,o().K8)((()=>null==I?void 0:I.getRole()),[I]),ie=(0,o().K8)((()=>!(!te||!(0,D().NB)(te))&&!(!I||I.getDisableMembershipRequests())),[te,I]),ne=(0,W().P9)({name:"members",spaceId:null==I?void 0:I.id,userId:null===(t=g.currentUser)||void 0===t?void 0:t.id,amount:1}),se=Boolean(ne&&te&&(0,D().vp)(te));(0,n.useEffect)((()=>{b(se?"member":"guest")}),[se]);const oe=(0,T().N)(i),re=S.length>1e3,ae=(0,n.useCallback)((e=>{const{response:t,shouldDoCompleteFn:i,invitedUserEmails:n,isRequestMember:s}=e;t.success?i&&(u().cI(g,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c,invite_flow_id:A}),B().showMessageForInviteComplete({success:t.success,invitedUserEmails:n,isRequestMember:s}),h(!1),d(t)):(B().showMessageForInviteComplete({success:t.success,invitedUserEmails:n}),u().cI(g,{invited_user_count:n.length,is_success:t.success,can_add_member:se,invite_option:f,origin:c}))}),[d,A,h,g,f,se,c]),le=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,shouldDoCompleteFn:n}=e;return await B().handleGuestInvite({environment:g,inviteOrigin:c,role:C,emailMessage:S,inviteTargetsStore:v,blockStore:i,sudoModeStore:r,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:n||!1,invitedUserEmails:t})}})}),[g,C,S,i,r,A,v,ae,c]),de=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,disable_invite_email:i,guestInviteResponse:n,shouldDoCompleteFn:s}=e;if(!I)return null;const o=null!=n&&n.success?n.invitedUsers:void 0;await B().handleMemberInvite({environment:g,spaceStore:I,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:s||!1,invitedUserEmails:t})},intl:M,invitedUsers:o,inviteTargetsStore:v,inviteOrigin:c,disable_invite_email:i})}),[I,g,A,v,M,ae,c]),ue=(0,n.useCallback)((async e=>{const{invitedUserEmails:t,guestInviteResponse:n}=e;if(!I)return null;const s=null!=n&&n.success?n.invitedUsers:void 0;s&&await B().handleMemberRequest({environment:g,spaceStore:I,originType:"person_property_invite",intl:M,invitedUsers:s,reasonMessage:void 0,originId:i.id,flowId:A,onInviteComplete:e=>{ae({response:e,shouldDoCompleteFn:!0,invitedUserEmails:t,isRequestMember:!0})},inviteOrigin:c})}),[g,A,I,M,ae,i,c]),ce=(0,n.useCallback)((async()=>{const e="member"===f,t=v.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(0===t.length)return void u().N_(g,{invite_stage:"click_invite_button",invite_flow_id:A,error:"No valid input emails"});const i=F();if(h(!0),e)if(i)await de({invitedUserEmails:t,disable_invite_email:!1,guestInviteResponse:void 0,shouldDoCompleteFn:!0});else{const e=!se&&!ie,i=await le({invitedUserEmails:t,shouldDoCompleteFn:e});se?await de({invitedUserEmails:t,disable_invite_email:!0,guestInviteResponse:i,shouldDoCompleteFn:!0}):ie&&await ue({invitedUserEmails:t,guestInviteResponse:i})}else i?u().N_(g,{invite_stage:"click_invite_button",invite_flow_id:A,error:"Invite guest with guest limitation exceed"}):await le({invitedUserEmails:t,shouldDoCompleteFn:!0});h(!1),v.reset()}),[g,se,ie,f,A,F,v,le,de,ue,h]),pe=(0,n.useCallback)((async()=>{await L();const e=(0,O().U1)({inviteTargetsStore:v}).length;u().u$(g,{invited_user_count:e,invite_option:f,can_add_member:se,origin:c,inviteTargets:v.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:v.state.tokenQuery,invite_flow_id:A}),await ce()}),[g,A,L,ce,f,se,v,c]);let ge;ge=ee?oe:re?(0,j.jsx)(a().sA,{id:"shareMenu.inviteButton.emailOverMaxLength.tooltip",defaultMessage:"Message exceeds the limit of 1000 characters."}):void 0;const me=(0,n.useMemo)((()=>[{key:"member",render:()=>(0,j.jsx)(p().A,{disableTooltip:se||ie,renderTooltip:()=>(0,j.jsx)(a().sA,{id:"invite.person_property.invite_member.tooltip",defaultMessage:"You do not have permission to add or request members to this workspace"}),render:e=>(0,j.jsx)($,{isSelected:"member"===f,inviteOption:"member",events:e})}),isDisabled:!se&&!ie},{key:"guest",render:()=>(0,j.jsx)(p().A,{disableTooltip:!K&&X,renderTooltip:()=>(0,j.jsx)(q().j,{}),render:e=>(0,j.jsx)($,{isSelected:"guest"===f,inviteOption:"guest",events:e})})}]),[f,K,X,ie,se]);return(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,j.jsx)("div",{style:m.section,children:(0,j.jsx)(G().A,{items:me,itemStyle:m.itemStyle,innerStyle:m.innerStyle,value:f,onChange:e=>{b(e),u().ZZ(g,{invite_option:e,invite_flow_id:A,origin:c})}})}),!K&&X||"guest"!==f?(0,j.jsx)(H,{tooltip:ge,disabled:!R||ee||re,onClick:pe,isLoading:y}):(0,j.jsx)(z,{onClick:()=>{u().j$(g,{invited_user_count:P.length,invite_flow_id:A,origin:c}),E().D6({environment:g,upgradeButtonName:"user_permission_item"})}})]})}function z(e){const{onClick:t}=e;return(0,j.jsx)(p().A,{disableTooltip:!1,renderTooltip:()=>(0,j.jsx)(q().j,{}),render:e=>(0,j.jsx)(L().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},onClick:t,...e,children:(0,j.jsx)(a().sA,{id:"invite.person_property.upgrade",defaultMessage:"Upgrade"})})})}function H(e){const{tooltip:t,disabled:i,onClick:n,isLoading:s}=e;return(0,j.jsx)(p().A,{disableTooltip:!Boolean(t),renderTooltip:()=>t,render:e=>(0,j.jsx)(L().A,{size:"lg",style:{margin:"0 16px 16px 16px",borderRadius:6},disabled:i,onClick:n,...e,isLoading:s,children:(0,j.jsx)(a().sA,{id:"invite.person_property.invite",defaultMessage:"Invite"})})})}function $(e){const{isSelected:t,inviteOption:i,events:n}=e,s=Y(),o=t?s.mainTextSelected:s.mainTextUnselected;let r,l;switch(i){case"guest":r=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsGuest.title",defaultMessage:"Add to page only"}),l=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsGuest.subtitle",defaultMessage:"Invite as a Guest"});break;case"member":r=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsMember.title",defaultMessage:"Add to Workspace"}),l=(0,j.jsx)(a().sA,{id:"invite.person_property.addAsMember.subtitle",defaultMessage:"Invite and bill as a Member"});break;default:throw new Error(`Unsupported invite option: ${i}`)}return(0,j.jsx)("div",{style:s.row,...n,children:(0,j.jsxs)("div",{style:o,children:[r,(0,j.jsx)(F().A,{isSmall:!0,style:s.optionSubtitle,children:l})]})})}function Y(){return(0,r().IS)((e=>({mainTextSelected:{fontWeight:M().Wy.medium,color:e.text.primary,fontSize:14,lineHeight:"14px"},mainTextUnselected:{color:e.text.secondary,fontSize:14,lineHeight:"14px"},row:{display:"flex",alignItems:"center",justifyContent:"center",gap:4,lineHeight:"14px"},section:{padding:"16px 11px 16px 11px"},itemStyle:{margin:5,borderRadius:8,borderWidth:2},innerStyle:{borderWidth:0},optionSubtitle:{whiteSpace:"pre-wrap",paddingTop:2,fontSize:12}})),[])}var J=()=>i(149375),Q=()=>i(285790);function X(e){let{handleBackButtonClick:t}=e;const i=(0,r().IS)((()=>({container:{display:"flex",margin:"0 12px 0px",height:40}})),[]);return(0,j.jsx)("div",{style:i.container,children:(0,j.jsx)(Z,{onClick:t})})}function Z(e){const{onClick:t}=e,i=(0,a().tz)(),n=(0,r().IS)((()=>({topContainer:{display:"flex",alignItems:"center",width:"max-content"},iconButton:{marginRight:6,height:24,width:24},arrowIcon:{height:16,width:16,strokeWidth:M().Wy.semibold},sendInviteLabel:{fontWeight:M().Wy.medium}})),[]);return(0,j.jsxs)("div",{style:n.topContainer,children:[(0,j.jsx)(Q().A,{icon:J().v,iconStyle:n.arrowIcon,style:n.iconButton,onClick:t,ariaLabel:i.formatMessage({id:"shareMenu.backButton.iconButton",defaultMessage:"Go back to main share menu."})}),(0,j.jsx)(F().A,{style:n.sendInviteLabel,children:(0,j.jsx)(a().sA,{id:"invite.person_property.popup_title",defaultMessage:"Invite and mention"})})]})}var ee=()=>i(456328),te=()=>i(623580),ie=()=>i(250064);const ne=d().sg((e=>{let{environment:t,flowId:i,origin:n}=e;u().IT(t,{origin:n,invite_flow_id:i})}),1e3);function se(e){const{inviteTargetsStore:t,personPropertyInviteStore:i,inviteOrigin:r}=e,a=(0,s().v3)(),{focus:l,emailMessage:d}=(0,o().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),u=(0,o().K8)((()=>i.state.flowId),[i]),c=(0,n.useCallback)((()=>{t.reset()}),[t]),p=(0,n.useCallback)((e=>{i.setState({...i.state,focus:l,emailMessage:e.target.value}),ne({environment:a,flowId:u,origin:r})}),[a,i,u,r,l]),g=(0,n.useCallback)((()=>{c()}),[c]),m=(0,n.useCallback)((()=>{i.setState({...i.state,focus:U().E.MessageInput,emailMessage:d})}),[i,d]);return(0,j.jsx)(oe,{focus:l===U().E.MessageInput,value:d,onFocus:m,onChange:p,onCancel:g,maxLength:1e3,inviteTargetsStore:t})}function oe(e){const{focus:t,value:i,maxLength:n,inviteTargetsStore:l,onFocus:d,onChange:u,onCancel:c}=e,p=(0,a().tz)(),g=i.length/n>=.8,m=(0,ee().BS)(i),v=g||m,y=(0,s().Y0)(),h=(0,r().IS)((e=>({container:{maxHeight:80,bottom:0,padding:"2px 16px 2px 16px",backgroundColor:e.modalBackground,pointerEvents:"all",transitionProperty:"max-height",transitionDuration:"0.3s",overflow:"hidden",zIndex:1,height:72},input:{maxHeight:80,borderTop:1,borderTopStyle:"solid",borderTopColor:e.regularDividerColor,padding:2,fontSize:14,transitionProperty:"max-height",transitionDuration:"0.3s",height:"100%"},inputBox:{padding:"0px 4px 0px 4px",boxShadow:e.inputBoxShadow,background:e.inputBackground,width:"auto",height:"100%",borderRadius:6,...t&&{background:"none",boxShadow:"rgba(35, 131, 226, 0.57) 0px 0px 0px 1px inset, rgba(35, 131, 226, 0.35) 0px 0px 0px 2px"}}})),[t]),f=(0,o().K8)((()=>l.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email))),[l]),x=(0,o().K8)((()=>f.length>0?p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.withEmails",defaultMessage:"Add a message for {users}"},{users:(0,ie().l)(f)}):p.formatMessage({id:"invite.person_property.emailMessageInput.placeholder.noEmails",defaultMessage:"Add a message to your invite..."})),[p,f]);return(0,j.jsxs)("div",{style:h.container,children:[v&&(0,j.jsx)(re,{value:i,maxLength:n,shouldShowLengthWarning:g,shouldShowLinkWarning:m}),(0,j.jsx)(te().A,{textarea:!0,focusInitial:!1,format:te().C.Transparent,placeholder:x,maxlength:n,focus:t,value:i,onFocus:d,onChange:u,inputStyle:h.input,onCancel:c,style:h.inputBox,onClick:()=>{y.isMobile||null==d||d()}})]})}function re(e){const{shouldShowLengthWarning:t,shouldShowLinkWarning:i,value:n,maxLength:s}=e,o=(0,r().IS)((e=>({container:{position:"absolute",top:0,display:"flex",justifyContent:"center",fontSize:12,color:e.text.tertiary,width:"100%"},warning:{display:"flex",justifyContent:"center",width:"calc(100% - 36px)",backgroundColor:e.modalBackground,marginTop:1}})),[]);return(0,j.jsx)("div",{style:o.container,children:(0,j.jsxs)("div",{style:o.warning,children:[t&&(0,j.jsx)(a().sA,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",values:{characters:n.length,maxCharacters:s}}),t&&i&&" · ",i&&(0,j.jsx)(a().sA,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning"})]})})}function ae(e){const{store:t,handleBackButtonClick:i,onInviteCompleteFn:a,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p}=e,g=(0,o().uB)(void 0,P().A),m=(0,s().v3)(),v=(0,n.useCallback)((async()=>{await B().handleEnterPress({environment:m,inviteTargetsStore:l,personPropertyInviteStore:u,allowShowEmptyError:!1})}),[m,l,u]),y=(0,r().IS)((()=>({container:{position:"relative",width:450,transition:"all",transitionDuration:"0.3s",display:"flex",flexDirection:"column",maxHeight:500},searchBar:{paddingLeft:16,paddingRight:16,paddingBottom:16,paddingTop:16},horizontalLine:{margin:"0",color:"#E3E2E0",opacity:.3}})),[]);return(0,j.jsx)(c().A,{debugName:"PersonPropertyInvitePopup",capture:!0,onLeft:d().D_,onRight:d().D_,onSelectAll:d().D_,onRedo:d().D_,onUndo:d().D_,onCut:d().D_,onCopy:d().D_,onPaste:d().D_,onKeypress:d().D_,onDelete:d().D_,onBackspace:d().D_,onTab:d().D_,onEnter:v,children:(0,j.jsxs)("div",{style:y.container,children:[(0,j.jsx)(X,{handleBackButtonClick:i}),(0,j.jsx)("hr",{style:y.horizontalLine}),(0,j.jsx)("div",{style:y.searchBar,children:(0,j.jsx)(le,{store:t,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p})}),(0,j.jsx)(se,{store:t,inviteTargetsStore:l,personPropertyInviteStore:u,inviteOrigin:p}),(0,j.jsx)("div",{children:(0,j.jsx)(K,{store:t,inviteTargetsStore:l,sudoModeStore:g,onInviteCompleteFn:a,personPropertyInviteStore:u,inviteOrigin:p})})]})})}function le(e){const{store:t,personPropertyInviteStore:i,inviteOrigin:n}=e,d=(0,a().tz)(),c=(0,s().v3)(),h=(0,o().uB)(e.inviteTargetsStore,x().Ay),f=(0,v().r)(),b=(0,y().HI)(),S=(0,m().A)(f),{focus:C,emailMessage:M}=(0,o().K8)((()=>{const{focus:e,emailMessage:t}=i.state;return{focus:e,emailMessage:t}}),[i]),{role:A,showEmptyError:k}=(0,o().K8)((()=>{const{role:e,showEmptyError:t}=i.state;return{role:e,showEmptyError:t}}),[i]),T=(0,o().K8)((()=>t.getType()),[t]),_=(0,o().K8)((()=>i.state.flowId),[i]),w=(0,o().K8)((()=>t.canEditMembership()),[t]),I=(0,r().IS)((()=>({permissionsRoleSelectButton:{display:"flex",whiteSpace:"nowrap",height:20,margin:0,borderRadius:4,color:l().Ay.uiGray}})),[]);return f&&b&&S?(0,j.jsx)(p().A,{disableTooltip:w,renderTooltip:()=>{if(!w)return(0,j.jsx)(a().sA,{id:"shareMenu.inviteButton.fullAccessOnlyMessage.tooltip",defaultMessage:"Only those with full access can add people."})},render:e=>(0,j.jsx)("div",{style:{display:"flex"},...e,children:(0,j.jsx)(R,{inviteTargetsStore:h,store:f,disabled:!w,origin:n,flowId:_,focus:C===U().E.InviteInput,showEmptyError:k,onFocus:()=>{i.setState({...i.state,focus:U().E.InviteInput,emailMessage:M||""})},placeholder:d.formatMessage({id:"invite.person_property.inviteTargetsInput.placeholder",defaultMessage:"Add emails..."}),onInputChanged:()=>i.setState({...i.state,showEmptyError:!1}),right:(0,j.jsx)(g().Ay,{disabled:!w,role:A,table:"block",type:"user_permission",blockType:T,isInvite:!0,upgradeButtonName:"invite_permission_block",buttonStyle:I.permissionsRoleSelectButton,isMenuItem:!1,onChange:e=>{i.setState({...i.state,role:e}),u().et(c,{invited_role:e,invite_flow_id:_,origin:n})}})})})}):null}},875497:(e,t,i)=>{i.d(t,{A:()=>o,E:()=>n});let n=function(e){return e.InviteInput="invite_input",e.MessageInput="message_input",e.NoFocus="no_focus",e}({});class s extends(()=>i(757695))().default{getInitialState(){return{flowId:i(206267).JW(),role:"editor",focus:n.InviteInput,emailMessage:"",isLoading:!1,showEmptyError:!1}}}const o=s},908671:(e,t,i)=>{i.d(t,{y:()=>V});var n=i(296540),s=()=>i(484714),o=()=>i(401497),r=()=>i(604995),a=()=>i(416504),l=()=>i(798880),d=()=>i(931075),u=()=>i(959013),c=()=>i(284371),p=()=>i(989423),g=()=>i(722872),m=()=>i(508496),v=()=>i(928600),y=()=>i(480095),h=()=>i(206837),f=()=>i(212050),x=()=>i(760217),b=()=>i(89924),S=i(474848);function C(e){const{onClick:t}=e,i=(0,s().v3)().device.isMobile,n=(0,o().IS)((e=>({buttonStyle:{color:e.text.uiRedPrimary,fontSize:i?c().J.UIRegular.mobile:c().J.UIRegular.desktop}})),[i]);return(0,S.jsx)(b().A,{topBorder:!0,children:(0,S.jsx)(x().A,{focused:!1,icon:(0,f().u)({width:14,marginLeft:0}),title:(0,S.jsx)(u().sA,{defaultMessage:"Remove verification",id:"VerificationPropertyOverlayMenu.removeVerificationButton"}),onClick:t,style:n.buttonStyle})})}var M=()=>i(244641),A=()=>i(847249),k=()=>i(186445),T=()=>i(972435),_=()=>i(712677),w=()=>i(573351);const j=(0,u().YK)({placeholder:{id:"VerificationExpiryMenu.pickSpecificDate.placeholder",defaultMessage:"Pick a date"}});function I(e){const{onChange:t,clearCustomDatePicker:i,verificationState:a,addExtraTopPadding:l}=e,d=(0,n.useRef)(e.today),u=(0,n.useRef)(e.today.plus({days:1})),[c,p]=(0,n.useState)(!1),g=(0,A().O$)(k().XX),m="verified"!==a.type||a.isIndefinite?void 0:a.dateTimeRange.end,v=(0,s().Y0)().isMobile,y=(0,o().IS)((e=>({containerStyle:{paddingTop:l?12:4,paddingBottom:12},mobileContainerStyle:{paddingBottom:10},calendar:v?{padding:"16px 14px 16px",borderBottom:`1px solid ${e.regularDividerColor}`,background:e.popoverBackground,marginTop:27,boxShadow:`0 -1px 0 ${e.regularDividerColor}`}:{},input:v?{padding:"16px 0",marginTop:0}:{}})),[l,v]);return(0,S.jsxs)(b().A,{mobileStyle:y.mobileContainerStyle,style:y.containerStyle,disableMobilePadding:!0,children:[(0,S.jsx)(_().A,{placeholder:T().A.formatMessage(j.placeholder),focused:c,value:"verified"!==e.verificationState.type||e.verificationState.isIndefinite?void 0:r().lN(e.verificationState.dateTimeRange.end),onUpdate:e=>{if(e.error)return;const n=e.value&&r().Dz(e.value);n?t({range:{start:d.current,end:n.start}}):i()},onFocus:()=>p(!0),onBlur:()=>p(!1),onClearButtonClick:i,hideClearButton:!0,style:y.input}),(0,S.jsx)("div",{style:y.calendar,children:(0,S.jsx)(w().A,{firstDayOfWeek:g,value:(null==m?void 0:m.toMillis())||u.current.toMillis(),selectValue:Boolean(m),onChange:e=>{t({range:{start:d.current,end:M().c9.fromMillis(e)},option:"custom"})},disabledDays:{before:new Date(u.current.toMillis())},className:"notion-date-property-menu"})})]})}i(581454);var R=()=>i(599987),P=()=>i(563884);const B=(0,i(340498).wt)("infinity",{viewBox:"0 0 40 19",svg:(0,S.jsx)("path",{d:"M0.297852 9.42383C0.297852 11.2695 0.65918 12.876 1.38184 14.2432C2.11426 15.6104 3.13477 16.6748 4.44336 17.4365C5.75195 18.1885 7.26562 18.5645 8.98438 18.5645C10.3613 18.5645 11.6504 18.2715 12.8516 17.6855C14.0625 17.0898 15.2881 16.1963 16.5283 15.0049L20 11.6504L23.4717 15.0049C24.7119 16.1963 25.9375 17.0898 27.1484 17.6855C28.3594 18.2715 29.6484 18.5645 31.0156 18.5645C32.7344 18.5645 34.248 18.1885 35.5566 17.4365C36.8652 16.6748 37.8809 15.6104 38.6035 14.2432C39.3359 12.876 39.7021 11.2695 39.7021 9.42383C39.7021 7.57812 39.3359 5.97168 38.6035 4.60449C37.8809 3.2373 36.8652 2.17773 35.5566 1.42578C34.248 0.664062 32.7344 0.283203 31.0156 0.283203C29.6484 0.283203 28.3594 0.581055 27.1484 1.17676C25.9375 1.7627 24.7119 2.65137 23.4717 3.84277L20 7.19727L16.5283 3.84277C15.2881 2.65137 14.0625 1.7627 12.8516 1.17676C11.6504 0.581055 10.3613 0.283203 8.98438 0.283203C7.26562 0.283203 5.75195 0.664062 4.44336 1.42578C3.13477 2.17773 2.11426 3.2373 1.38184 4.60449C0.65918 5.97168 0.297852 7.57812 0.297852 9.42383ZM3.5791 9.42383C3.5791 8.23242 3.80371 7.19727 4.25293 6.31836C4.71191 5.43945 5.34668 4.76074 6.15723 4.28223C6.96777 3.80371 7.91016 3.56445 8.98438 3.56445C9.88281 3.56445 10.752 3.78418 11.5918 4.22363C12.4316 4.66309 13.3154 5.3125 14.2432 6.17188L17.7002 9.42383L14.2285 12.6758C13.3105 13.5352 12.4316 14.1846 11.5918 14.624C10.752 15.0635 9.88281 15.2832 8.98438 15.2832C7.91016 15.2832 6.96777 15.0439 6.15723 14.5654C5.34668 14.0869 4.71191 13.4082 4.25293 12.5293C3.80371 11.6406 3.5791 10.6055 3.5791 9.42383ZM22.2998 9.42383L25.7568 6.17188C26.6846 5.3125 27.5684 4.66309 28.4082 4.22363C29.248 3.78418 30.1172 3.56445 31.0156 3.56445C32.0898 3.56445 33.0322 3.80371 33.8428 4.28223C34.6533 4.76074 35.2832 5.43945 35.7324 6.31836C36.1914 7.19727 36.4209 8.23242 36.4209 9.42383C36.4209 10.6055 36.1914 11.6406 35.7324 12.5293C35.2832 13.4082 34.6533 14.0869 33.8428 14.5654C33.0322 15.0439 32.0898 15.2832 31.0156 15.2832C30.1172 15.2832 29.248 15.0635 28.4082 14.624C27.5684 14.1846 26.6895 13.5352 25.7715 12.6758L22.2998 9.42383Z"})});var U=()=>i(53528),D=()=>i(991249),E=()=>i(645109),L=()=>i(118849),F=()=>i(704152);function q(e){const{verificationState:t,onChange:i,onCustomDateClick:r,showTitle:a,showUpsell:l,isEligibleForBusinessTrial:p}=e,g=(0,s().v3)(),m=(0,u().tz)(),v=g.device.isMobile,y=(0,n.useRef)(e.today),h=(0,o().IS)((e=>({title:{fontSize:v?c().J.UIRegular.mobile:c().J.UIRegular.desktop,color:e.text.primary},disabledTitle:{color:e.text.secondary},disabledCaption:{color:e.text.tertiary},clockIconStyle:{width:14,marginLeft:0,marginTop:2},upsellContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 12px",gap:8,border:`1px solid ${e.regularDividerColor}`,borderRadius:6,margin:"8px 8px 4px",height:36},upsellText:{fontSize:14,color:e.text.primary,fontWeight:c().Wy.medium,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",flex:1},disabledButton:{color:e.text.tertiary}})),[v]),f="expired"===t.type||"none"===t.type?(0,S.jsx)(u().sA,{defaultMessage:"Verify page",id:"VerificationExpiryPicker.verify.header"}):(0,S.jsx)(u().sA,{defaultMessage:"Reverify page",id:"VerificationExpiryPicker.reverify.header"}),C="verified"===t.type&&t.isIndefinite,M="verified"===t.type&&!t.isIndefinite&&t.dateTimeRange.end,A=Boolean(l),k="verification_upsell_item_page_entrypoint",T=(0,n.useCallback)((()=>{(0,D().K)(g,{from:k,upsell:{type:"product",product:"business",limit:{type:"none"},trialability:"none"}})}),[g,k]);return(0,S.jsxs)("div",{children:[!p&&l&&(0,S.jsxs)(F().A,{style:h.upsellContainer,onClick:T,children:[(0,S.jsx)("div",{style:h.upsellText,children:(0,S.jsx)(u().sA,{defaultMessage:"Upgrade to unlock",id:"VerificationExpiryPicker.upsellExperience"})}),(0,S.jsx)(L().A,{subscriptionTier:"business",analyticsName:k})]}),p&&(0,S.jsx)(E().c,{openedFrom:"business_trial_verify_pages_upsell",styleOverrides:{margin:"12px 12px 0px 12px"}}),(0,S.jsxs)(b().A,{title:a&&f,children:[d().yj.map((e=>{const t=M&&d().gj({start:y.current,end:M})===e;return(0,S.jsx)(x().A,{buttonStyle:A?h.disabledButton:void 0,disabled:A,focused:!1,icon:(0,R().P)(h.clockIconStyle),inline:!1,title:(0,S.jsx)("span",{style:A?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"For {numDays} days",id:"VerificationExpiryMenu.preset.title",values:{numDays:e}})}),caption:m.formatMessage({defaultMessage:"Until {date}",id:"VerificationExpiryMenu.preset.subtitle"},{date:U().OH({dateTime:d().RD(e,y.current).end,intl:m,shortenDateAndRange:!0})}),captionStyle:A?h.disabledCaption:void 0,isChecked:Boolean(t),onClick:()=>{return t=e,void i({range:{start:y.current,end:y.current.plus({days:t})},option:`${t}d`});var t}},e)})),(0,S.jsx)(x().A,{buttonStyle:A?h.disabledButton:void 0,disabled:A,focused:!1,icon:B({width:14,marginLeft:0,marginTop:1}),inline:!1,title:(0,S.jsx)("span",{style:A?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"Indefinitely",id:"VerificationExpiryPicker.option.indefinitely"})}),onClick:()=>i({option:"indefinite"}),isChecked:C},"indefinite"),(0,S.jsx)(x().A,{buttonStyle:A?h.disabledButton:void 0,disabled:A,focused:!1,icon:(0,P().k)({width:14,marginLeft:0}),title:(0,S.jsx)("span",{style:A?h.disabledTitle:h.title,children:(0,S.jsx)(u().sA,{defaultMessage:"Pick a date",id:"VerificationExpiryPicker.option.customDate"})}),onClick:r},"custom")]})]})}var G=()=>i(8802),O=()=>i(880298);function V(e){const{verificationValue:t,getRecordModel:i,onChange:p,blockId:m,propertyName:f,onClose:x,showTitle:b,showRemoveVerificationButton:M,showVerificationFooter:A,showCurrentStatusHeader:k,showCustomHeader:T,customHeader:_,showUpsell:w,entrypoint:j,isEligibleForBusinessTrial:R}=e,P=(0,s().v3)(),B=(0,s().Y0)(),U=(0,u().tz)(),[D,E]=(0,n.useState)(!1),L=(0,n.useMemo)((()=>d().B2(t)),[t]),F="verified"===L.type,V=(0,n.useRef)(r().ah((0,a().P)())),W=(0,n.useRef)(r().ah((0,a().P)()).plus({days:1})),K=e=>{var t;const{range:i,option:n}=e,s=null===(t=P.currentUser)||void 0===t?void 0:t.id;if(!s)return;if(null!=i&&i.end&&i.end.toMillis()<W.current.toMillis())return;const o={table:l().oo,id:s},a=i?r().C6.toPersistedDateTimeRange(i):r().C6.toPersistedDateTime(V.current.toMillis()),d="none"===L.type?"add":"update";N(P,{action:d,verification_page_id:m,verification_expiry:i?i.end.toMillis():void 0}),p({value:[o,a],metadata:{action:d,entrypoint:j,expiration:n,expiration_date:i?i.end.toMillis():void 0}})},z=(0,o().IS)((e=>({footerStyle:{borderTop:`1px solid ${e.regularDividerColor}`},headerStyle:{padding:B.isMobile?10:7,paddingLeft:B.isMobile?20:7,background:B.isMobile?e.popoverBackground:e.tokenInputMenuItemBackground,display:"flex",alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`}})),[B.isMobile]);let H={menuType:g().gu.Popup,footer:A&&"none"!==L.type&&!D&&(0,S.jsx)("div",{style:z.footerStyle,children:(0,S.jsx)(G().d,{lastVerifiedDate:F&&L.isIndefinite?L.startDateTime:L.dateTimeRange.start,getRecordModel:i,actorPointer:L.actorPointer})})};B.isMobile&&(H={...H,title:f,menuType:g().gu.Modal,right:(0,S.jsx)(y().DoneMenuText,{}),onClickRight:D?()=>E(!1):x});return(0,S.jsxs)(S.Fragment,{children:[T&&_&&!D?_:T&&D?(0,S.jsx)(h().o,{label:U.formatMessage({id:"verificationPropertyOverlay.verificationMenuHeader.pickDate",defaultMessage:"Pick a date"}),onClickBackButton:()=>E(!1),onClose:()=>x(),width:265,showBottomBorder:!1}):null,(0,S.jsx)(v().A,{...H,header:!D&&k&&"none"!==L.type&&(0,S.jsx)("div",{style:z.headerStyle,children:(0,S.jsx)(O().r,{verificationValue:t,fontSize:B.isMobile?c().J.UIRegular.mobile:void 0})}),children:D?(0,S.jsx)(I,{today:V.current,verificationState:L,onChange:e=>K(e),clearCustomDatePicker:()=>E(!1),addExtraTopPadding:!T}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(q,{today:V.current,verificationState:L,onChange:e=>K(e),onCustomDateClick:()=>E(!0),showTitle:b,showUpsell:w,isEligibleForBusinessTrial:R}),M&&(F||"expired"===L.type)&&(0,S.jsx)(C,{onClick:()=>{N(P,{action:"remove",verification_page_id:m}),p({value:void 0,metadata:{action:"remove",entrypoint:j}})}})]})})]})}function N(e,t){p().vd(e,"verification_update",t),m().default.logEvent("verification_update",t.action)}},980270:(e,t,i)=>{i.r(t),i.d(t,{handleEnterPress:()=>T,handleGuestInvite:()=>M,handleMemberInvite:()=>C,handleMemberRequest:()=>A,handlePopupClickWithEmail:()=>_,inviteToSpaceAsMembers:()=>k,showMessageForInviteComplete:()=>w});i(944114),i(898992),i(354520),i(430670),i(581454),i(737550),i(296540);var n=()=>i(842599),s=()=>i(857639),o=()=>i(206267),r=()=>i(68263),a=()=>i(959013),l=()=>i(319625),d=()=>i(502800),u=()=>i(966505),c=()=>i(449506),p=()=>i(579627),g=()=>i(542056),m=()=>i(436572),v=()=>i(250064),y=()=>i(535279),h=()=>i(731320),f=()=>i(134217),x=()=>i(10984),b=()=>i(477093),S=i(474848);async function C(e){const{environment:t,onInviteComplete:i,flowId:n,intl:o,spaceStore:r,invitedUsers:a,inviteTargetsStore:c,inviteOrigin:p,disable_invite_email:g}=e;let m={success:!1};try{m=await k({environment:t,spaceStore:r,invitedUsers:a,from:p,flowId:n,intl:o,inviteTargetsStore:c,disable_invite_email:g}),m.success?u().ke(t,{invited_user_count:Object.keys(m.invitedUsers).length,invite_flow_id:n,origin:p}):(u().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:m.error}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite"}))}catch(v){const e=(0,l().A)(v);u().N_(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,d().convertErrorToLog)(v)})}finally{null==i||i(m)}}async function M(e){const{environment:t,blockStore:i,inviteTargetsStore:a,sudoModeStore:c,onInviteComplete:g,inviteOrigin:m,role:v,emailMessage:f,flowId:x}=e;let b={success:!1};try{if(b=await async function(e){const{environment:t,blockStore:i,sudoModeStore:s,inviteTargetsStore:a,role:l,inviteOrigin:d,emailMessage:u,onInviteStart:c}=e,g=e.flowId||o().JW();if(!(0,r().PW)(l))return{success:!1};const{tokenQuery:m,inviteTargets:v}=a.state;if((0,n().DT)(m.trim())&&0===v.length){const e={type:"newUser",value:{email:m.trim()},source:"email"};y().P4({target:e,inviteTargetsStore:a})||a.setState({inviteTargets:[...a.state.inviteTargets,e],tokenQuery:""})}const f=await h().hb(i,y().U1({inviteTargetsStore:a}));null==c||c();const x=await p().eP({environment:t,store:i,sudoModeStore:s,inviteTargets:f,inviteRole:l,isOnboarding:!1,invite:{inviteFlowId:g,inviteMessage:u,inviteOrigin:d}});return x}({environment:t,blockStore:i,sudoModeStore:c,inviteTargetsStore:a,role:v,emailMessage:f,inviteOrigin:m,flowId:x}),!b.success)return}catch(S){const e=(0,l().A)(S);u().N_(t,{invite_stage:"invite_guest",invite_flow_id:x,error:e}),s().log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,d().convertErrorToLog)(S)})}finally{b.success&&u().oU(t,{invited_user_count:Object.keys(b.invitedUsers).length,origin:m,invite_flow_id:x}),null==g||g(b)}return b}async function A(e){const{environment:t,spaceStore:i,originId:n,originType:o,reasonMessage:r,intl:a,flowId:d,onInviteComplete:p,invitedUsers:g,inviteOrigin:y}=e,h=[];let f={success:!1};try{const e=Object.entries(g).map((e=>{let[s,a]=e;return c().callApi({eventName:"requestAccess",environment:t,data:{type:"actor-to-space",forActorId:a,spaceId:i.id,message:r,attributes:{origin_id:n,origin_type:o,origin_table:"block",add_permissions_on_approval:!1}}}).catch((()=>h.push([s,a])))}));await Promise.all(e),f={success:!0,invitedUsers:g,requestedUsers:{}}}catch(x){const e=(0,l().A)(x);return u().N_(t,{invite_stage:"request_member",invite_flow_id:d,error:e}),function(e,t){const i=Object.keys(t);if(0===i.length)return;m().D6({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,v().l)(i)})})}(a,g),s().log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:h}}}),f}finally{f.success&&u().d6(t,{invited_user_count:Object.keys(f.invitedUsers).length,origin:y,invite_flow_id:d}),null==p||p(f)}return f}async function k(e){const{environment:t,spaceStore:i,from:n,invitedUsers:o,intl:r,flowId:a,onInviteStart:l,inviteTargetsStore:d,disable_invite_email:u}=e,c=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(o),g=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(d),y=[...c];for(const s of g){c.some((e=>e.value.email===s.value.email))||y.push(s)}const h=(0,x().AI)(),S=h&&(0,f().fk)(h)?"editor":e.inviteRole??"read_and_write";let C={success:!1};if(!i.isTeamsEnabled()){if(!(await b().oH({environment:t,flowId:a,trackCreateTeamComplete:!1})))return C}try{null==l||l(),C=await p().eP({environment:t,store:i,inviteTargets:y,inviteRole:S,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:u}})}catch(M){return function(e,t){0!==t.length&&m().D6({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"{userCount, plural, one {Failed to invite {users} as member} other {Failed to invite {users} as members}}"},{users:(0,v().l)(t.flatMap((e=>e.value.email||[]))),userCount:t.length})})}(r,y),s().log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:y}}}),C}return C}async function T(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:s,personPropertyInviteStore:o}=e,r=i.state.tokenQuery;if(""===r)return void(0===i.state.inviteTargets.length&&s&&o.setState({...o.state,showEmptyError:!0}));const a=(0,n().C3)(r),l=await g().Ah(t,a);let d=[];0===l.length&&(d=[{type:"invalidUser",value:{text:r}}]);const u=l.filter((e=>!y().P4({inviteTargetsStore:i,target:e}))),c=[...i.state.inviteTargets,...u,...d];i.setState({...i.state,inviteTargets:c,tokenQuery:""})}function _(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},s=[...i.state.inviteTargets];y().P4({inviteTargetsStore:i,target:n})||s.push(n),i.setState({...i.state,inviteTargets:s})}function w(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?m().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,v().l)(i)}})}):m().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,v().l)(i)}})})):m().D6({label:(0,S.jsx)(a().sA,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,v().l)(i)}})})}}}]);