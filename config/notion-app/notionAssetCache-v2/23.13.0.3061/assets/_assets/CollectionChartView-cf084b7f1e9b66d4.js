"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22],{318897:(e,t,o)=>{o.r(t),o.d(t,{DonutChart:()=>f});o(944114),o(898992),o(354520);var r=o(296540),i=()=>o(401497),a=()=>o(100594),n=()=>o(379632),l=()=>o(959013),s=()=>o(496603),u=()=>o(534177),c=()=>o(284371),d=()=>o(900983),g=()=>o(620586),p=()=>o(191446),h=()=>o(27936),m=()=>o(128040),v=o(474848);const y=14;function f(e){const t=(0,l().tz)(),o=(0,i().DP)(),f=e.chartHeight||a().bg.medium,k=e.seriesData.length>0&&e.seriesData[0].data.length>0,M=r.useMemo((()=>k?e.seriesData:[{name:"No data",data:[]}]),[k,e.seriesData]),_=(0,r.useMemo)((()=>(0,g().wW)(e.colorTheme||"auto",Boolean(e.weightColorValue),o)),[e.colorTheme,e.weightColorValue,o]),V=(0,r.useMemo)((()=>(0,a().sh)(f)),[f]),T=e.dataLabelsFormatter?.9:1,P=(V-160)*T,A=(0,r.useMemo)((()=>{const r=e.showCaption?(0,p().I)(e.caption):"";return s().h1((0,h().A)(o),{chart:{type:"pie",height:V,events:{render:function(){const r=this,i=r.container;if(i)if(k){if(e.title){var a;const e=r.title.getBBox();null===(a=r.title)||void 0===a||a.attr({y:y+r.plotTop+(r.plotHeight-e.height)/2})}}else(0,p().h)({intl:t,theme:o,chartType:"donut",container:i,hasData:k,hasBadYAxisRange:!1,isInPeekMode:Boolean(e.isInPeekMode)})},load:e.onLoadEventHandler}},time:{timezone:e.timezone},title:{useHTML:!0,floating:!0,text:void 0},series:M,..._,plotOptions:{pie:{size:P,innerSize:f===a().bg.small||f===a().bg.medium?"85%":"90%",showInLegend:!e.hideLegend,color:k?void 0:"transparent",fillColor:k?"transparent":o.tableDividerColor,states:{inactive:{opacity:1}},dataLabels:{enabled:!!e.dataLabelsFormatter,formatter:e.dataLabelsFormatter}},series:{cursor:e.onSeriesClick?"pointer":void 0,point:{events:{click:function(t){if(e.onSeriesClick){const o=(0,d().V)(e.seriesData,this.x);if(!o)return;e.onSeriesClick(o,t)}}}},marker:{enabled:!1},states:{hover:{halo:null}}}},legend:{enabled:!e.hideLegend,labelFormatter:function(){if(e.legendLabelFormatter){const t=this.index,o=M.length>0?M[0].data[t]:void 0;return e.legendLabelFormatter(this.name,o)}return this.name}},caption:{text:r},tooltip:{...e.tooltipOptions},responsive:{rules:x(P,f)}})}),[e,o,V,M,_,P,f,k,t]),D=(0,i().IS)((e=>({titleStyle:{fontWeight:500,color:e.text.primary,textAlign:"center"},subtitleStyle:{color:e.text.secondary,fontWeight:400,lineHeight:"15px",textAlign:"center",...c().RC}})),[]),B=r.useCallback(((t,o)=>{const r=o||f,i=function(e,t,o){const r=(e||"").split("").filter((e=>","!==e&&"."!==e)),i=5*r.length;if(t&&C(t,o)){const e=t/5-i;return o===a().bg.small||o===a().bg.medium?Math.max(e,S):Math.max(e,b)}if(o===a().bg.extra_large){const e=108-i;return Math.max(e,R)}if(o===a().bg.large){const e=84-i;return Math.max(e,w)}if(o===a().bg.medium){const e=72-i;return Math.max(e,b)}{const e=48-i;return Math.max(e,S)}}(e.title,t,r),l=function(e){if(!e||e===a().bg.small||e===a().bg.medium)return 12;if(e===a().bg.large)return 14;if(e===a().bg.extra_large)return 16;(0,u().HB)(e)}(r),s=function(e,t){if(e&&C(e,t))return.5*e;return t===a().bg.extra_large?400:t===a().bg.large?250:t===a().bg.medium?150:80}(t,r),c=t??200,d=c<50?"":n().A.renderToStaticMarkup((0,v.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,v.jsx)("div",{style:{...D.titleStyle,fontSize:i,lineHeight:`${i+13}px`,maxWidth:s},children:e.title}),e.subtitle&&c>=200?(0,v.jsx)("div",{style:{...D.subtitleStyle,fontSize:l,lineHeight:`${l+3}px`,maxWidth:s},children:e.subtitle}):null]}));return{title:{useHTML:!0,floating:!0,text:k?d:""}}}),[f,e.title,e.subtitle,D.titleStyle,D.subtitleStyle,k]);return(0,v.jsx)(m().A,{loadingProps:e.loadingProps,chartOptions:A,containerHeight:V,getResponsiveChartOptions:B})}function x(e,t){const o=[];return t!==a().bg.extra_large&&t!==a().bg.large||o.push({condition:{maxWidth:e},chartOptions:{plotOptions:{pie:{size:void 0}}}}),o.push({condition:{maxWidth:(0,a().I9)(t)},chartOptions:{plotOptions:{pie:{size:"75%"}}}}),o}function C(e,t){return t===a().bg.extra_large?e-180<(0,a().I9)(t):t===a().bg.large?e-100<(0,a().I9)(t):e<(0,a().I9)(t)}const S=8,b=12,w=18,R=24},673995:(e,t,o)=>{o.r(t),o.d(t,{CollectionChartView:()=>Le});var r=o(296540),i=()=>o(484714),a=()=>o(847249),n=()=>o(282339),l=()=>o(416504),s=()=>o(714185),u=()=>o(735695),c=()=>o(145214),d=()=>o(106412),g=()=>o(322638);var p=()=>o(247788),h=(o(944114),()=>o(901610)),m=()=>o(289915),v=()=>o(873050),y=()=>o(941814);var f=()=>o(525432),x=()=>o(489348),C=()=>o(351360),S=()=>o(227440),b=()=>o(199896),w=()=>o(71059),R=()=>o(952047),k=()=>o(622317),M=()=>o(100594),_=()=>o(534177),V=()=>o(75544),T=()=>o(818367),P=()=>o(708685),A=()=>o(921598),D=()=>o(713998),B=()=>o(959013),L=()=>o(812480),F=()=>o(989423),K=()=>o(476492),j=()=>o(401497),z=()=>o(133033),O=()=>o(751735),G=()=>o(962730),E=()=>o(285790),I=()=>o(859428),N=o(474848);function H(e){let{message:t,tooltipMessage:o,tooltipAriaLabel:r}=e;const i=(0,j().IS)((e=>({container:{padding:"8px 4px 8px 14px",borderRadius:20,backgroundColor:"light"===e.mode?(0,O().X4)(e.accentColors.gray[100],.3):"rgba(255, 255, 255, 0.05)",width:"max-content",margin:"0 auto",marginBottom:20},text:{fontSize:12,textAlign:"center",color:e.text.secondary},iconStyle:{width:14,height:14,fill:e.text.secondary,position:"absolute",bottom:-2},iconContainer:{position:"relative",height:14,width:30}})),[]);return(0,N.jsx)("div",{style:i.container,children:(0,N.jsxs)("div",{style:i.text,children:[t,(0,N.jsx)(I().A,{renderTooltip:()=>o,placement:G().W.Top,render:e=>(0,N.jsx)(E().A,{icon:()=>(0,z().$)(i.iconStyle),ariaLabel:r,style:{...i.iconContainer},disableBackground:!0,...e})})]})})}const q=(0,B().YK)({earliestDates:{defaultMessage:"Only showing earliest {limit} {dateGroupByOption}",id:"charts.limitsWarning.earliestDates"},latestDates:{defaultMessage:"Only showing latest {limit} {dateGroupByOption}",id:"charts.limitsWarning.latestDates"},lowestNumbers:{defaultMessage:"Only showing lowest {limit} values",id:"charts.limitsWarning.lowestNumbers"},highestNumbers:{defaultMessage:"Only showing highest {limit} values",id:"charts.limitsWarning.highestNumbers"},genericLimit:{defaultMessage:"Only showing {limit} options in {propertyName}",id:"charts.limitsWarning.genericLimit"}}),$=(0,B().YK)({addFilters:{defaultMessage:"Add filters to reduce the data range.",id:"charts.limitsWarning.tooltip.addFilters"}}),W=(0,B().YK)({column:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.columnChart"},bar:{defaultMessage:"Max {limit} bars can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.barChart"},line:{defaultMessage:"Max {limit} data points can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.lineChart"},donut:{defaultMessage:"Max {limit} slices can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.donutChart"},subGroups:{defaultMessage:"Max {limit} groups can be displayed in a chart.",id:"charts.limitsWarning.tooltip.maxDisplay.subGroups"}});function Y(e,t,o){const r=null==e?void 0:e.type;if((0,A().Ik)(t)&&"relative"===t.groupBy)return q.genericLimit;if("ascending"===o.type)switch(r){case"formula":switch((0,P().getFormulaPropertySchemaResultType)(e)){case"date":return q.earliestDates;case"number":return q.lowestNumbers;default:return q.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return q.earliestDates;case"number":return q.lowestNumbers;default:return q.genericLimit}else{if("descending"!==o.type)return q.genericLimit;switch(r){case"formula":switch((0,P().getFormulaPropertySchemaResultType)(e)){case"date":return q.latestDates;case"number":return q.highestNumbers;default:return q.genericLimit}case"date":case"created_time":case"last_edited_time":case"last_visited_time":return q.latestDates;case"number":return q.highestNumbers;default:return q.genericLimit}}}function X(e){let{chartConfig:t,chartLimit:o,collectionContextStore:r}=e;const{limitType:i,limit:n}=o,l=(0,B().tz)(),s=(0,a().O$)(r.normalizedSchemaStore);if("results"===i&&"results_reducer"===t.dataConfig.type){const e=(0,D()._g)({schema:s,property:t.dataConfig.nameProperty});return e?(0,N.jsx)(B().sA,{...q.genericLimit,values:{limit:n,propertyName:e.name}}):null}if("groups"===i&&"groups_reducer"===t.dataConfig.type){const e=t.dataConfig.groupBy,o=(0,A().Kq)(e),r=(0,D()._g)({schema:s,property:e.property});if(!r)return null;const i=Y(r,e,o);return(0,N.jsx)(B().sA,{...i,values:{limit:n,dateGroupByOption:(0,A().Ik)(e)?l.formatMessage(L().cS[e.groupBy]).toLocaleLowerCase():void 0,propertyName:r.name}})}if("subGroups"===i&&"groups_reducer"===t.dataConfig.type&&(0,h().m)(t)&&t.dataConfig.aggregationConfig.stackOptions){const e=t.dataConfig.aggregationConfig.stackOptions.groupBy,o=(0,A().Kq)(e),r=(0,D()._g)({schema:s,property:e.property});if(!r)return null;const i=Y(r,e,o);return(0,N.jsx)(B().sA,{...i,values:{limit:n,dateGroupByOption:(0,A().Ik)(e)?e.groupBy:void 0,propertyName:r.name}})}return null}function U(e){let{chartConfig:t,chartReducerResults:o,loadingProps:n,collectionContextStore:l}=e;const s=(0,B().tz)(),u=function(e){let{chartConfig:t,chartReducerResults:o,collectionContextStore:n}=e;const l=(0,i().v3)(),s=(0,a().K8)((()=>(0,y().hk)()),[]),u=(0,a().K8)((()=>(0,y().dP)()),[]),c=(0,a().K8)((()=>(0,y().H4)()),[]),d=(0,a().K8)((()=>(0,K().sl)(n)),[n]),g=r.useMemo((()=>{let e;return"results_reducer"===t.dataConfig.type&&"results"===(null==o?void 0:o.type)&&o.blockIds.length>=u?e={limitType:"results",limit:u}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==o?void 0:o.type)&&o.results.length>=s?e={limitType:"groups",limit:s}:"groups_reducer"===t.dataConfig.type&&"groups"===(null==o?void 0:o.type)&&o.subGroupResults&&o.subGroupResults.length>=c&&(e={limitType:"subGroups",limit:c}),e}),[t.dataConfig.type,o,s,u,c]);return r.useEffect((()=>{(0,F().u4)({environment:l,event:{eventName:"charts_data_length",eventProperties:{chart_group_length:"groups"===(null==o?void 0:o.type)?o.results.length:void 0,chart_results_length:"results"===(null==o?void 0:o.type)?o.blockIds.length:void 0,chart_sub_group_length:"groups"===(null==o?void 0:o.type)&&o.subGroupResults?o.subGroupResults.length:void 0,chart_data_limit:g,...d}}})}),[g,o,d,l]),g}({chartConfig:t,chartReducerResults:o,collectionContextStore:l});if(void 0===u||n.isInitialLoading||n.isThrottledLoading)return null;const{limitType:c,limit:d}=u;return(0,N.jsx)(H,{message:(0,N.jsx)(X,{chartConfig:t,collectionContextStore:l,chartLimit:u}),tooltipMessage:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{children:(0,N.jsx)(B().sA,{..."subGroups"===c?W.subGroups:W[t.type],values:{limit:d}})}),(0,N.jsx)("div",{children:(0,N.jsx)(B().sA,{...$.addFilters})})]}),tooltipAriaLabel:s.formatMessage("subGroups"===c?W.subGroups:W[t.type],{limit:d})})}o(898992),o(354520),o(581454),o(737550);var Q=()=>o(67657),J=()=>o(381891),Z=()=>o(732038),ee=()=>o(645873);const te=new(ee().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(28721),o.e(55717),o.e(88372),o.e(22)]).then(o.bind(o,697476)))),oe=(0,ee()._h)(te,(e=>e.AxisChart));var re=()=>o(10594),ie=()=>o(682146),ae=()=>o(622281),ne=()=>o(374136),le=()=>o(202017),se=()=>o(379632),ue=()=>o(100622),ce=()=>o(705876);const de=(0,B().YK)({noData:{defaultMessage:"No data",id:"database.chart.multipleSeriesTooltip.noData"},empty:{defaultMessage:"Empty",id:"database.chart.tooltip.empty"},clickToViewData:{defaultMessage:"Click to view data",id:"database.chart.tooltip.clickToViewData"},clickToViewDetails:{defaultMessage:"Click to view details",id:"database.chart.tooltip.clickToViewDetails"}}),ge=43;function pe(e){var t;const{chartConfig:o,schema:i,seriesData:n,isClickable:l}=e,s=(0,B().tz)(),u=(0,j().IS)((e=>({defaultContainer:{border:`1px solid ${e.accentColors.gray[100]}`,borderRadius:"8px",backgroundColor:e.cardContentBackground,maxHeight:"375px",maxWidth:"300px",width:"max-content",overflow:"hidden",pointerEvents:"auto",boxShadow:"0px 2px 4px rgb(0, 0, 0, 0.1)"},scrollContainer:{overflow:"auto",padding:"12px",maxHeight:l?375-ge+"px":"375px"},clickToSeeDataContainer:{padding:"12px",display:"flex",gap:"6px",alignItems:"center"},clickToSeeDataSeparator:{border:"none",borderTop:`1px solid ${e.stroke.secondary}`,margin:"0 12px"},clickToSeeDataIcon:{width:"14px",height:"14px",color:e.text.tertiary},clickToSeeDataText:{color:e.text.tertiary,fontSize:"12px",lineHeight:"16px"},containerSingleSeries:{padding:"10px 12px"},header:{fontSize:"12px",paddingBottom:"7px",color:e.text.primary,overflowX:"hidden",whiteSpace:"normal",display:"block"},row:{fontSize:"12px",lineHeight:"18px",textAlign:"left",display:"flex",justifyContent:"space-between",gap:"16px"},square:{height:"8px",width:"8px",minWidth:"8px",borderRadius:"1px",borderWidth:"0px",margin:"0 3px",verticalAlign:"top",display:"inline-block"},rowLeft:{display:"inline-block",color:e.text.secondary,overflowX:"hidden",whiteSpace:"normal"},rowLeftContainer:{display:"inline-flex",alignItems:"center",gap:"6px"},rowRight:{color:e.chartRowRightColor},noData:{color:e.text.secondary}})),[l]),c=(0,r.useMemo)((()=>s.formatMessage(de.noData)),[s]),d=(0,r.useMemo)((()=>({useHTML:!0,shadow:!1,borderWidth:0,backgroundColor:void 0,outside:!1,stickOnContact:!0,hideDelay:100})),[]),g=(0,a().K8)((()=>"donut"===(null==o?void 0:o.type)),[null==o?void 0:o.type]),p=(0,a().K8)((()=>"results_reducer"===(null==o?void 0:o.dataConfig.type)?s.formatMessage(de.clickToViewDetails):s.formatMessage(de.clickToViewData)),[null==o?void 0:o.dataConfig.type,s]),m=(0,a().K8)((()=>{var e;return("bar"===(null==o?void 0:o.type)||"column"===(null==o?void 0:o.type))&&("groups_reducer"===o.dataConfig.type&&(!!o.dataConfig.aggregationConfig.stackOptions&&"percent"===(null===(e=o.chartFormat)||void 0===e?void 0:e.axisGroupStyle)))}),[o]),v=(0,a().K8)((()=>{var e,t;if("precision_from_number_property"===(null==o||null===(e=o.chartFormat)||void 0===e?void 0:e.numberPrecisionOverride)){const e=null==o?void 0:o.dataConfig;if(!e||"results_reducer"!==e.type)return;const t=(0,D()._g)({schema:i,property:e.valueProperty});return t?(0,ne().i5)(t):void 0}return null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.numberPrecisionOverride}),[null==o||null===(t=o.chartFormat)||void 0===t?void 0:t.numberPrecisionOverride,null==o?void 0:o.dataConfig,i]),y=(0,r.useMemo)((()=>({...d,formatter:function(){const e=this.color??this.series.color;ce().U.setCurrentTooltipPoint(this.point);const{label:t,value:r}=(0,ne().NH)({chartConfig:o,schema:i,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:s,numberPrecisionOverride:v});let a="";g&&this.point.percentage&&(a=` (${(0,ne().l9)(this.point.percentage)}%)`);const n=""===t?s.formatMessage(de.empty):t;return se().A.renderToStaticMarkup((0,N.jsxs)("div",{style:u.defaultContainer,children:[(0,N.jsx)("div",{style:u.containerSingleSeries,children:(0,N.jsxs)("div",{style:u.row,children:[(0,N.jsxs)("div",{style:u.rowLeftContainer,children:[(0,N.jsx)("div",{style:{...u.square,backgroundColor:me(e)}}),(0,N.jsx)("div",{style:u.rowLeft,children:n})]}),(0,N.jsxs)("div",{style:u.rowRight,children:[r,a]})]})}),l?(0,N.jsx)(he,{label:p,styles:u}):null]}))}})),[d,o,i,s,v,g,u,l,p]),f=(0,r.useMemo)((()=>({...d,shared:!0,formatter:function(){var e;const t=null===(e=this.points)||void 0===e?void 0:e.filter((e=>!(null==e||!e.y)&&0!==e.y));ce().U.setCurrentTooltipPoint(this.point);("line"===this.series.type||"area"===this.series.type||"areaspline"===this.series.type)&&(null==t||t.sort(((e,t)=>((null==t?void 0:t.y)??0)-((null==e?void 0:e.y)??0))));let r=this.point.name;if(o&&(0,h().m)(o)&&"groups_reducer"===o.dataConfig.type){const e=o.dataConfig,t=e.groupBy,a=(0,D()._g)({schema:i,property:e.groupBy.property});a&&(r=(0,ne().w$)({propertySchema:a,groupByFormat:t,aggregation:o.dataConfig.aggregationConfig.aggregation,highChartsLabel:this.point.name,intl:s}))}return t&&0!==t.length?se().A.renderToStaticMarkup((0,N.jsxs)("div",{style:u.defaultContainer,children:[(0,N.jsxs)("div",{style:u.scrollContainer,children:[(0,N.jsx)("div",{style:u.header,children:r}),t.map((e=>{const t=e.color??e.series.color,{label:r,value:a}=(0,ne().NH)({chartConfig:o,schema:i,highChartsLabel:e.series.name,highChartsValue:e.y??void 0,isMultiSeries:!0,intl:s,numberPrecisionOverride:v});let n="";m&&e.percentage&&(n=` (${(0,ne().l9)(e.percentage)}%)`);const l=""===r?s.formatMessage(de.empty):r;return(0,N.jsxs)("div",{style:u.row,children:[(0,N.jsxs)("div",{style:u.rowLeftContainer,children:[(0,N.jsx)("div",{style:{...u.square,backgroundColor:me(t)}}),(0,N.jsx)("div",{style:u.rowLeft,children:l})]}),(0,N.jsxs)("span",{style:u.rowRight,children:[a,n]})]},e.key)}))]}),l?(0,N.jsx)(he,{label:p,styles:u}):null]})):se().A.renderToStaticMarkup((0,N.jsxs)("div",{style:u.defaultContainer,children:[(0,N.jsxs)("div",{style:u.scrollContainer,children:[(0,N.jsx)("div",{style:u.header,children:r}),(0,N.jsx)("div",{style:{...u.row,...u.noData},children:c})]}),l?(0,N.jsx)(he,{label:p,styles:u}):null]}))}})),[d,o,u,i,s,c,v,m,l,p]);return n?1===n.length?y:f:d}function he(e){const{label:t,styles:o}=e;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("hr",{style:o.clickToSeeDataSeparator}),(0,N.jsxs)("div",{style:o.clickToSeeDataContainer,children:[(0,le().n)(o.clickToSeeDataIcon),(0,N.jsx)("div",{style:o.clickToSeeDataText,children:t})]})]})}function me(e){const t=ue().OK.colorful[0];return e?"string"==typeof e?e:"pattern"in e?e.pattern.backgroundColor??t:t:t}var ve=()=>o(963589);function ye(e){let{collectionContextStore:t,groupedChartReducerResults:o,groupedDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const d=(0,i().v3)(),p=(0,B().tz)(),m=(0,j().DP)(),v=(0,r.useRef)(!0),f=(0,ve().X)("charts_drilldown"),{chartConfig:x,chartErrorStore:C,collectionViewStore:S,collectionViewBlockStore:b,databaseType:w,isMultiSourceView:R}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&(0,h().m)(o)&&"groups_reducer"===o.dataConfig.type?o:void 0,chartErrorStore:t.chartErrorStore,collectionViewStore:e,collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,isMultiSourceView:t.isMultiSourceView}}),[t]),k=(0,a().O$)(t.normalizedSchemaStore),_=(0,a().O$)(t.normalizedFormatStore),V=(0,a().O$)(t.normalizedQueryStore),T=(0,a().O$)(t.temporaryStateStore),P=(0,a().K8)((()=>(0,D()._g)({schema:k,property:n.groupBy.property})),[n.groupBy.property,k]),L=(0,a().K8)((()=>{if(n.aggregationConfig.aggregation.property)return(0,D()._g)({schema:k,property:n.aggregationConfig.aggregation.property})}),[n.aggregationConfig.aggregation,k]),F=(0,a().K8)((()=>null==l?void 0:l.mainSort),[null==l?void 0:l.mainSort]),K=(0,a().K8)((()=>null==l?void 0:l.axisAvatar),[null==l?void 0:l.axisAvatar]),z=(0,a().K8)((()=>{if("side_by_side"===(null==l?void 0:l.axisGroupStyle))return;if(n.aggregationConfig.stackOptions){if(null!=l&&l.axisGroupStyle)return l.axisGroupStyle;if("line"!==(null==x?void 0:x.type))return M().PC.normal}}),[null==x?void 0:x.type,null==l?void 0:l.axisGroupStyle,n.aggregationConfig]),O=(0,a().K8)((()=>P?P.name||ie().dC[P.type]:""),[P]),G=(0,a().K8)((()=>{const e=n.aggregationConfig;if((0,Q().Iq)(e.aggregation)){return(0,g().TQ)({aggregation:e.aggregation,databaseType:w,intl:p})||""}const t=(0,g().TQ)({aggregation:e.aggregation,databaseType:w,intl:p});return L?`${L.name||ie().dC[L.type]} (${t})`:""}),[n.aggregationConfig,w,p,L]),E=(0,a().K8)((()=>(0,M().q_)(x)),[x]),I=!!x&&(0,ae().hu)(x),H=(null==l?void 0:l.hideLegend)||I,q=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),$=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),W=(0,a().K8)((()=>(0,y().hk)()),[]),Y=(0,a().K8)((()=>(0,y().H4)()),[]),X=(0,a().K8)((()=>{if(o&&x)return(0,ae().CL)({groupedChartReducerResults:o,chartConfig:x,sortType:"main"})}),[o,x]),U=(0,a().K8)((()=>{if(!(o&&t&&b&&X))return;const{result:e,xAxisType:r}=function(e){var t;let{collectionContextStore:o,groupedDataConfig:r,groupedChartReducerResults:i,chartFormat:a,timezone:n,theme:l,environment:s,intl:u,getRecordModel:c,getRecordRole:d,renderGroupsFromAggregationArgs:g,groupsLimit:p,subGroupsLimit:h,databaseType:m,schema:v,collectionViewFormat:y}=e;const f=i.aggregationResults;if(!f)return;const x=(0,ae().AY)({groupedDataConfig:r,hideEmptyGroups:Boolean(null==a?void 0:a.axisHideEmptyGroups),mainSort:null==a?void 0:a.mainSort});if("v2"===(null==i?void 0:i.version)){var C;const e=i.results.filter((e=>e.visible)).map((e=>({property:r.groupBy.property,value:e.value}))),t=r.aggregationConfig.stackOptions,a=t?null===(C=i.subGroupResults)||void 0===C?void 0:C.filter((e=>e.visible)).map((e=>({property:t.groupBy.property,value:e.value}))):[];return{result:(0,ae().w7)({collectionContextStore:o,groupedDataConfig:r,groupResults:e,subGroupResults:a,aggregationResults:f,xAxisType:x,timezone:n,environment:s,intl:u,theme:l,groupTotals:g.groupTotals}),xAxisType:x}}const S=(0,A().oH)({schema:v,groupBy:r.groupBy});let b=(0,re().ck)({groupBy:r.groupBy,schema:v,formatGroups:y[A().V1]||[],schemaGroups:S,reducerResults:i.results,getRecordModel:c,getRecordRole:d,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:o.collectionStoresStore.state,renderGroupsFromAggregationArgs:g});b=b.filter((e=>!(0,A().tx)(e))),b=b.slice(0,p);const w=r.aggregationConfig.stackOptions?(0,A().oH)({schema:v,groupBy:r.aggregationConfig.stackOptions.groupBy}):void 0,R=i.subGroupResults&&null!==(t=r.aggregationConfig.stackOptions)&&void 0!==t&&t.groupBy?(0,re().ck)({groupBy:r.aggregationConfig.stackOptions.groupBy,schema:v,formatGroups:y.chart_subgroups||[],schemaGroups:w,reducerResults:i.subGroupResults,getRecordModel:c,getRecordRole:d,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:m,allowedCollectionStores:o.collectionStoresStore.state}).filter((e=>!(0,A().tx)(e))).slice(0,h):void 0,k=(0,ae().w7)({collectionContextStore:o,groupedDataConfig:r,groupResults:b,subGroupResults:R,aggregationResults:f,xAxisType:x,timezone:n,environment:s,intl:u,theme:l,groupTotals:g.groupTotals});return{result:k,xAxisType:x}}({collectionContextStore:t,groupedDataConfig:n,groupedChartReducerResults:o,chartFormat:l,timezone:s,theme:m,environment:d,intl:p,getRecordModel:b.getRecordModel,getRecordRole:b.getRecordRole,renderGroupsFromAggregationArgs:X,groupsLimit:W,subGroupsLimit:Y,databaseType:w,schema:k,collectionViewFormat:_})||{};if(!r)return;var i;v.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),v.current=!1);const a=o.results.some((e=>(0,J().bv)(e)?e.visible:e.total>0));return{seriesData:null==e?void 0:e.seriesData,maxValue:(null==e?void 0:e.maxValue)??0,minValue:(null==e?void 0:e.minValue)??0,dataPointsForXAxisLabels:null==e?void 0:e.dataPointsForXAxisLabels,xAxisType:r,reverseXAxis:(0,ae().p4)({xAxisType:r,mainSort:F}),hasData:a}}),[o,W,Y,t,b,n,k,_,w,F,l,s,d,p,m,X],{useDeepEqual:!0}),ee=(0,ne().gc)(null==S?void 0:S.getRecordModel,p,K===M().GL.avatar_name),te=(0,r.useMemo)((()=>P&&(0,M().fn)(P)&&(void 0===K||K===M().GL.avatar||K===M().GL.avatar_name)),[K,P]),le=(()=>{if(!P)return;if(te)return ee;if((0,M().JW)(P))return(0,ne().ck)({propertySchema:P,aggregation:n.aggregationConfig.aggregation,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride});const e="formula"===n.groupBy.type?n.groupBy.groupBy:n.groupBy;return(0,A().Ik)(e)&&(0,M().i8)(P)?(0,ne().jY)({groupBy:e.groupBy,dateFormat:P.date_format,intl:p}):void 0})(),se=(()=>{if(L)return(0,M().JW)(L)?(0,ne().ck)({propertySchema:L,aggregation:n.aggregationConfig.aggregation,intl:p,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0})(),ue=(e=>{const t=null===(e=n.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy;if(H||!t)return;const o="formula"===t.type?t.groupBy:t,r=t.property,i=(0,D()._g)({schema:k,property:r});return i&&(0,A().Ik)(o)&&(0,M().i8)(i)?e=>(0,ne().H$)({dateString:e,dateFormat:i.date_format,groupBy:o.groupBy,intl:p}):void 0})(),ce=(0,r.useCallback)(((e,o)=>{Z().Sp({chartConfig:x,collectionViewBlockStore:b,format:_,dataPoint:e,clickEvent:o,schema:k,intl:p,query2:V,temporaryViewState:T,environment:d,collectionContextStore:t})}),[x,b,_,k,T,V,p,d,t]),de=f&&!R?ce:void 0,ge=pe({chartConfig:x,schema:k,seriesData:null==U?void 0:U.seriesData,isClickable:Boolean(de)}),he=(0,a().K8)((()=>!(!L||!U)&&(0,ne()._G)({dataYAxisMax:U.maxValue,dataYAxisMin:U.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:L,aggregation:n.aggregationConfig.aggregation})),[U,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,n.aggregationConfig.aggregation,L]),me=(0,a().O$)(t.isInPeekRendererStore);r.useEffect((()=>{var e;if(!S)return;const t=null==o?void 0:o.subGroupResults;if(Boolean(x&&(0,h().m)(x)&&"groups_reducer"===x.dataConfig.type&&(null===(e=x.dataConfig.aggregationConfig.stackOptions)||void 0===e?void 0:e.groupBy))&&t){if(1===t.length&&!t[0].value.value){const e=new Map(C.state);return e.set(S.id,"stackBy_property_no_values"),void C.setState(e)}}const r=new Map(C.state);r.delete(S.id),C.setState(r)}),[x,S,null==o?void 0:o.subGroupResults,C]);const ye=(0,r.useCallback)((()=>{t.onItemMount()}),[t]);return(0,N.jsx)(oe,{axisType:c,timezone:s,seriesData:(null==U?void 0:U.seriesData)||[],hasData:Boolean(null==U?void 0:U.hasData),loadingProps:u,xAxisType:null==U?void 0:U.xAxisType,xAxisTitle:O,yAxisTitle:G,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:H,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:q,showVerticalGridLines:$,dataLabelsEnabled:E,columnStacking:z,axisHideEmptyGroups:null==l?void 0:l.axisHideEmptyGroups,tooltipOptions:ge,sortReversed:null==U?void 0:U.reverseXAxis,dataPointsForXAxisLabels:null==U?void 0:U.dataPointsForXAxisLabels,xLabelFormatter:le,disableXAxisAutoRotation:te,yLabelFormatter:se,dataLabelFormatter:se,stackLabelFormatter:se,legendLabelFormatter:ue,yAxisAllowDecimals:he,dataYAxisMax:null==U?void 0:U.maxValue,dataYAxisMin:null==U?void 0:U.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:ye,isInPeekMode:me,onSeriesClick:de})}const fe=new(ee().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(28721),o.e(55717),o.e(88372),o.e(22)]).then(o.bind(o,318897)))),xe=(0,ee()._h)(fe,(e=>e.DonutChart));var Ce=()=>o(284371);function Se(e,t){const o=(0,B().tz)(),r=(0,j().IS)((e=>({name:{maxWidth:"250px",...Ce().RC,display:"inline-block",verticalAlign:"middle"},value:{display:"inline-block",verticalAlign:"middle",marginLeft:5}})),[]),i=(0,a().K8)((()=>null==e?void 0:e.chartFormat),[e]);if((null==i?void 0:i.donutDataLabels)!==M().D0.none)return function(){const{label:a,value:n}=(0,ne().NH)({chartConfig:e,schema:t,highChartsLabel:this.point.name,highChartsValue:this.point.y,isMultiSeries:!1,intl:o,numberPrecisionOverride:void 0});let l="";return this.point.percentage&&(l=` (${(0,ne().l9)(this.point.percentage)}%)`),(null==i?void 0:i.donutDataLabels)===M().D0.value?`${n}${l}`:(null==i?void 0:i.donutDataLabels)===M().D0.name?se().A.renderToStaticMarkup((0,N.jsx)("div",{style:r.name,children:a})):(null==i?void 0:i.donutDataLabels)===M().D0.name_and_value?se().A.renderToStaticMarkup((0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:r.name,children:a}),(0,N.jsx)("div",{style:r.value,children:`${n}${l}`})]})):void 0}}var be=()=>o(72135),we=()=>o(972435);const Re=(0,B().YK)({total:{id:"charts.donut.aggregationValue.total",defaultMessage:"Total"},totalPropertyName:{id:"charts.donut.aggregationValue.totalPropertyName",defaultMessage:"Total {propertyName}"},averagePropertyName:{id:"charts.donut.aggregationValue.averagePropertyName",defaultMessage:"Average {propertyName}"},minPropertyName:{id:"charts.donut.aggregationValue.minPropertyName",defaultMessage:"Min {propertyName}"},maxPropertyName:{id:"charts.donut.aggregationValue.maxPropertyName",defaultMessage:"Max {propertyName}"},medianPropertyName:{id:"charts.donut.aggregationValue.medianPropertyName",defaultMessage:"Median {propertyName}"},uniquePropertyName:{id:"charts.donut.aggregationValue.uniquePropertyName",defaultMessage:"Distinct {propertyName}"}});function ke(e,t,o,i){const a=(0,B().tz)();return(0,r.useMemo)((()=>{if(!e||!o)return;const r=e.aggregationResult,n=(0,D()._g)({schema:i,property:o});if(!r||"number"!==r.type||!n)return;let l;const s=r.value?(0,ne().EN)(r.value,2):void 0;if((0,M().JW)(n)&&"count"!==t&&"unique"!==t){const e=(0,ne().JI)(n)??"number";l=(0,be().ZV)(s,e,a,"compact")}else l=(0,be().ZV)(s,"number",a,"compact");let u;const c=n.name;switch(t){case"sum":u=we().A.formatMessage(Re.totalPropertyName,{propertyName:c});break;case"average":u=we().A.formatMessage(Re.averagePropertyName,{propertyName:c});break;case"min":u=we().A.formatMessage(Re.minPropertyName,{propertyName:c});break;case"max":u=we().A.formatMessage(Re.maxPropertyName,{propertyName:c});break;case"median":u=we().A.formatMessage(Re.medianPropertyName,{propertyName:c});break;case"unique":u=we().A.formatMessage(Re.uniquePropertyName,{propertyName:c});break;default:u=we().A.formatMessage(Re.total)}return{title:l,subtitle:u}}),[e,t,a,o,i])}function Me(e){let{collectionContextStore:t,groupedChartReducerResults:o,aggregationChartReducerResults:n,groupedDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().v3)(),g=(0,B().tz)(),p=(0,j().DP)(),h=(0,r.useRef)(!0),m=(0,ve().X)("charts_drilldown"),{collectionViewBlockStore:v,databaseType:f,schema:x,query2:C,chartConfig:S,isMultiSourceView:b}=(0,a().K8)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();return{collectionViewBlockStore:t.collectionViewBlockStore(),databaseType:t.databaseType,schema:t.normalizedSchemaStore.state,query2:t.normalizedQueryStore.state,chartConfig:o&&"donut"===o.type&&"groups_reducer"===o.dataConfig.type?o:void 0,isMultiSourceView:t.isMultiSourceView}}),[t]),w=(0,a().K8)((()=>(0,A().oH)({schema:x,groupBy:l.groupBy})),[l,x]),R=(0,a().O$)(t.normalizedFormatStore),k=(0,a().O$)(t.temporaryStateStore),_=(0,a().K8)((()=>(0,y().hk)()),[]),V=(0,a().K8)((()=>{if(o&&S)return(0,ae().CL)({groupedChartReducerResults:o,chartConfig:S,sortType:"main"})}),[o,S]),T=(0,a().K8)((()=>{const e=null==o?void 0:o.aggregationResults;if(!v||!V||!e)return;if("v2"===(null==o?void 0:o.version)){const i=o.results.filter((e=>e.visible)).map((e=>({property:l.groupBy.property,value:e.value}))),a=(0,ae().cN)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:g,theme:p,groupTotals:V.groupTotals});var r;if(h.current)null===(r=t.databaseItemsVisibleTracker)||void 0===r||r.handleItemsRenderStart(),h.current=!1;return a}let i=(0,re().ck)({groupBy:l.groupBy,schema:x,formatGroups:R[A().V1]||[],schemaGroups:w,reducerResults:o.results,getRecordModel:v.getRecordModel,getRecordRole:v.getRecordRole,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:f,allowedCollectionStores:t.collectionStoresStore.state,renderGroupsFromAggregationArgs:V});i=i.filter((e=>!(0,A().tx)(e))),i=i.slice(0,_);const a=(0,ae().cN)({collectionContextStore:t,groupedDataConfig:l,groupResults:i,aggregationResults:e,timezone:u,environment:d,intl:g,theme:p,groupTotals:V.groupTotals});var n;h.current&&(null===(n=t.databaseItemsVisibleTracker)||void 0===n||n.handleItemsRenderStart(),h.current=!1);return a}),[o,l,u,d,g,t,p,v,f,x,w,_,R,V],{useDeepEqual:!0}),P=(0,a().K8)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),L=(0,a().K8)((()=>"count"===l.aggregationConfig.aggregation.aggregator?l.groupBy.property:l.aggregationConfig.aggregation.property),[l]),F=ke(n,l.aggregationConfig.aggregation.aggregator,L,x),K=(0,a().K8)((()=>null==s?void 0:s.valueLabel),[null==s?void 0:s.valueLabel])||(null==F?void 0:F.subtitle),z=(()=>{const e="formula"===l.groupBy.type?l.groupBy.groupBy:l.groupBy,t=(0,D()._g)({schema:x,property:l.groupBy.property});if(t)return(0,A().Ik)(e)&&(0,M().i8)(t)?o=>(0,ne().H$)({dateString:o.toString(),dateFormat:t.date_format,groupBy:e.groupBy,intl:g}):void 0})(),O=Se(S,x),G=(0,r.useCallback)(((e,o)=>{Z().Sp({chartConfig:S,collectionViewBlockStore:v,format:R,dataPoint:e,clickEvent:o,schema:x,intl:g,query2:C,temporaryViewState:k,environment:d,collectionContextStore:t})}),[S,v,R,x,k,C,g,d,t]),E=m&&!b?G:void 0,I=pe({chartConfig:S,schema:x,seriesData:T,isClickable:Boolean(E)}),H=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),q=(0,a().O$)(t.isInPeekRendererStore);return(0,N.jsx)(xe,{timezone:u,seriesData:T||[],title:P?null==F?void 0:F.title:void 0,subtitle:P?K:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:I,legendLabelFormatter:z,onLoadEventHandler:H,dataLabelsFormatter:O,isInPeekMode:q,onSeriesClick:E})}function _e(e){let{collectionContextStore:t,resultsChartReducerResults:o,resultsDataConfig:n,chartFormat:l,timezone:s,loadingProps:u,axisType:c}=e;const d=(0,i().v3)(),g=(0,B().tz)(),p=(0,j().DP)(),m=(0,ve().X)("charts_drilldown"),v=(0,r.useRef)(!0),{chartConfig:y,collectionViewBlockStore:f,collectionViewStore:x,collectionStore:C,isMultiSourceView:S}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&(0,h().m)(o)&&"results_reducer"===o.dataConfig.type?o:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:e,collectionStore:t.collectionStore(),isMultiSourceView:t.isMultiSourceView}}),[t]),b=(0,a().O$)(t.normalizedSchemaStore),w=null==l?void 0:l.mainSort,R=(0,a().K8)((()=>{const e=n.nameProperty,t=b[e];return t?t.name||ie().dC[t.type]:""}),[n.nameProperty,b]),k=(0,a().K8)((()=>{const e=b[n.valueProperty];return e?`${e.name||ie().dC[e.type]}`:""}),[n,b]),_=!!y&&(0,ae().hu)(y),V=(null==l?void 0:l.hideLegend)||_,T=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!e||("horizontal"===e||"both"===e)}),[l]),P=(0,a().K8)((()=>{const e=null==l?void 0:l.axisGridLine;return!!e&&("vertical"===e||"both"===e)}),[l]),A=(0,a().K8)((()=>{if(!n||!t||!f)return;const e="category",r=(0,ae().UX)({collectionContextStore:t,resultsDataConfig:n,resultsChartReducerResults:o,chartType:"axis",xAxisType:e,timezone:s,environment:d,intl:g,theme:p});var i;v.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),v.current=!1);const a=o&&o.blockIds.length>0;return{seriesData:null==r?void 0:r.seriesData,maxValue:(null==r?void 0:r.maxValue)??0,minValue:(null==r?void 0:r.minValue)??0,xAxisType:e,reverseXAxis:(0,ae().p4)({xAxisType:e,mainSort:w}),hasData:a}}),[n,t,f,o,s,d,g,p,w],{useDeepEqual:!0}),L=(0,a().K8)((()=>(0,M().q_)(y)),[y]),F=(0,a().K8)((()=>(0,D()._g)({schema:b,property:n.nameProperty})),[n.nameProperty,b]),K=(0,a().K8)((()=>(0,D()._g)({schema:b,property:n.valueProperty})),[n.valueProperty,b]),z=(0,ne().wK)(null==x?void 0:x.getRecordModel,g,s),O=(()=>{if(F)return"title"===F.type?z:void 0})(),G=K?(0,ne().ck)({propertySchema:K,aggregation:void 0,intl:g,numberPrecisionOverride:null==l?void 0:l.numberPrecisionOverride}):void 0,E=(0,a().K8)((()=>!(!K||!A)&&(0,ne()._G)({dataYAxisMax:A.maxValue,dataYAxisMin:A.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,propertySchema:K,aggregation:void 0})),[A,null==l?void 0:l.yAxisMax,null==l?void 0:l.yAxisMin,K]),I=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),H=(0,r.useCallback)(((e,o)=>{Z().sw({collectionStore:C,dataPoint:e,environment:d,clickEvent:o,collectionContextStore:t})}),[C,d,t]),q=m&&!S?H:void 0,$=pe({chartConfig:y,schema:b,seriesData:null==A?void 0:A.seriesData,isClickable:Boolean(q)}),W=(0,a().O$)(t.isInPeekRendererStore);return(0,N.jsx)(oe,{axisType:c,timezone:s,seriesData:(null==A?void 0:A.seriesData)||[],hasData:Boolean(null==A?void 0:A.hasData),loadingProps:u,xAxisType:null==A?void 0:A.xAxisType,xAxisTitle:R,yAxisTitle:k,axisLabelFormat:null==l?void 0:l.axisLabel,colorTheme:null==l?void 0:l.colorTheme,chartHeight:null==l?void 0:l.height,weightColorValue:null==l?void 0:l.weightColorValue,hideLegend:V,showCaption:null==l?void 0:l.showCaption,caption:null==l?void 0:l.caption,showHorizontalGridLines:T,showVerticalGridLines:P,dataLabelsEnabled:L,columnStacking:void 0,tooltipOptions:$,sortReversed:null==A?void 0:A.reverseXAxis,xLabelFormatter:O,dataLabelFormatter:G,yLabelFormatter:G,yAxisAllowDecimals:E,dataYAxisMax:null==A?void 0:A.maxValue,dataYAxisMin:null==A?void 0:A.minValue,userYAxisMax:null==l?void 0:l.yAxisMax,userYAxisMin:null==l?void 0:l.yAxisMin,onLoadEventHandler:I,isInPeekMode:W,onSeriesClick:q})}function Ve(e){let{collectionContextStore:t,resultsChartReducerResults:o,aggregationChartReducerResults:n,resultsDataConfig:l,chartFormat:s,timezone:u,loadingProps:c}=e;const d=(0,i().v3)(),g=(0,B().tz)(),p=(0,j().DP)(),h=(0,r.useRef)(!0),m=(0,ve().X)("charts_drilldown"),{chartConfig:v,collectionViewBlockStore:y,collectionViewStore:f,collectionStore:x,isMultiSourceView:C}=(0,a().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getChartConfig();return{chartConfig:o&&"donut"===o.type&&"results_reducer"===o.dataConfig.type?o:void 0,collectionViewBlockStore:t.collectionViewBlockStore(),collectionViewStore:t.collectionViewStore(),collectionStore:t.collectionStore(),isMultiSourceView:t.isMultiSourceView}}),[t]),S=(0,a().O$)(t.normalizedSchemaStore),b=(0,a().K8)((()=>{var e;if(!o||!y)return;const r=(0,ae().UX)({collectionContextStore:t,resultsDataConfig:l,resultsChartReducerResults:o,chartType:"donut",xAxisType:void 0,timezone:u,environment:d,intl:g,theme:p});var i;h.current&&(null===(i=t.databaseItemsVisibleTracker)||void 0===i||i.handleItemsRenderStart(),h.current=!1);const a=null==r||null===(e=r.seriesData)||void 0===e?void 0:e[0];return[{...a,data:(null==a?void 0:a.data)||[],type:"pie"}]}),[o,y,t,l,u,d,g,p],{useDeepEqual:!0}),w=(0,a().K8)((()=>{if(l.valueProperty)return l.valueProperty}),[l]),R=(0,a().K8)((()=>!(null!=s&&s.donutHideValue)),[null==s?void 0:s.donutHideValue]),k=ke(n,"sum",w,S),M=(0,r.useCallback)((()=>{t.onItemMount()}),[t]),_=(0,ne().wK)(null==f?void 0:f.getRecordModel,g,u),V=(()=>{if("title"===l.nameProperty)return _})(),T=Se(v,S),P=(0,r.useCallback)(((e,o)=>{Z().sw({collectionStore:x,dataPoint:e,clickEvent:o,environment:d,collectionContextStore:t})}),[x,d,t]),A=m&&!C?P:void 0,D=pe({chartConfig:v,schema:S,seriesData:b,isClickable:Boolean(A)}),L=(0,a().O$)(t.isInPeekRendererStore);return(0,N.jsx)(xe,{timezone:u,seriesData:b||[],title:R?null==k?void 0:k.title:void 0,subtitle:R?null==k?void 0:k.subtitle:void 0,loadingProps:c,colorTheme:null==s?void 0:s.colorTheme,chartHeight:null==s?void 0:s.height,weightColorValue:null==s?void 0:s.weightColorValue,hideLegend:null==s?void 0:s.hideLegend,showCaption:null==s?void 0:s.showCaption,caption:null==s?void 0:s.caption,tooltipOptions:D,legendLabelFormatter:V,onLoadEventHandler:M,dataLabelsFormatter:T,isInPeekMode:L,onSeriesClick:A})}var Te=()=>o(496603),Pe=()=>o(62856);function Ae(e){var t;let{collectionContextStore:o,chartConfig:i,timezone:n,reducerRequestType:l,groupedChartReducer:s,aggregationChartReducer:u,resultsChartReducer:c}=e;const{reducer:d,reducerKey:g}=(0,a().K8)((()=>"groups"===l?{reducer:s,reducerKey:k().jJ}:"results"===l?{reducer:c,reducerKey:k().wh}:void(0,_().HB)(l)),[s,l,c]),p=(0,a().K8)((()=>(0,T().x)()),[]),m=(0,V().A)({id:g,reducer:d,collectionContextStore:o,debounceWait:p}),v=(0,a().O$)(o.isFullScreenStore),y=(0,r.useMemo)((()=>{var e;const t=(null==i||null===(e=i.chartFormat)||void 0===e?void 0:e.height)||M().bg.medium;return(0,M().sh)(t)}),[null==i||null===(t=i.chartFormat)||void 0===t?void 0:t.height]),f=(0,a().K8)((()=>{var e;if(void 0!==m)return;const t=o.remoteErrorStore.state;return"msg"!==(null==t?void 0:t.requestSrc)?"RequestTimeoutCancellationError"===(null==t||null===(e=t.errorBody)||void 0===e?void 0:e.name)?"queryCollection_timeout":t?"queryCollection_generic":void 0:void 0}),[o,m]),{loadingProps:x,chartConfigToDisplay:C}=function(e){let{collectionContextStore:t,chartConfig:o,chartReducerResults:i}=e;const n=(0,r.useRef)(void 0),l=(0,r.useRef)(void 0),[s,u]=(0,r.useState)(void 0),c=(0,a().K8)((()=>t.shouldShowSpinnerStore.state),[t],{useDeepEqual:!0}),d=(0,a().K8)((()=>{var e;return void 0===i||Boolean(t.lastRemoteRequestStore.state&&t.remoteRequestStore.state&&!Te().n4(null===(e=t.lastRemoteRequestStore.state.remoteRequest)||void 0===e?void 0:e.source,t.remoteRequestStore.state.source))}),[i,t]),g=(0,a().K8)((()=>t.isFullScreenStore.state),[t]);(0,r.useEffect)((()=>{n.current=o,(t.isClientModeEnabledStore.state||t.isViewSpecificClientModeEnabledStore.state)&&u(o)}),[o,t]),(0,r.useEffect)((()=>{c||(l.current=n.current)}),[c]),(0,r.useEffect)((()=>{l.current=n.current,u(n.current)}),[null==o?void 0:o.type]);const{nameProperty:p,valueProperty:h}=(0,a().K8)((()=>"results_reducer"===(null==o?void 0:o.dataConfig.type)?{nameProperty:o.dataConfig.nameProperty,valueProperty:o.dataConfig.valueProperty}:{}),[null==o?void 0:o.dataConfig]);return(0,r.useEffect)((()=>{l.current=n.current,u(n.current)}),[p,h]),(0,r.useEffect)((()=>{u(c?l.current:n.current)}),[c]),{loadingProps:{isInitialLoading:d,isThrottledLoading:(0,Pe().A)(c,200,0),initialLoadingSvg:(0,r.useCallback)((()=>(0,N.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:g})),[null==o?void 0:o.type,g])},chartConfigToDisplay:s}}({collectionContextStore:o,chartConfig:i,chartReducerResults:m});if(f)return(0,N.jsx)(w().A,{chartError:f,collectionSettingsStore:o.settingsStore,chartType:null==i?void 0:i.type});if(C){if(i&&(0,h().m)(i)&&C&&(0,h().m)(C))return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(U,{loadingProps:x,chartConfig:C,chartReducerResults:m,collectionContextStore:o}),(0,N.jsx)(De,{collectionContextStore:o,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:m,loadingProps:x,timezone:n,chartHeight:y,isFullScreen:v})]});if("donut"===(null==i?void 0:i.type)&&C&&"donut"===C.type)return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(U,{loadingProps:x,chartConfig:C,chartReducerResults:m,collectionContextStore:o}),(0,N.jsx)(Be,{collectionContextStore:o,chartConfig:i,chartConfigToDisplay:C,chartReducerResults:m,timezone:n,loadingProps:x,aggregationChartReducer:u,chartHeight:y,isFullScreen:v})]})}return(0,N.jsx)("div",{style:{height:y,width:"100%"},children:(0,N.jsx)(R().z,{chartType:null==i?void 0:i.type,showCopy:v})})}function De(e){let{collectionContextStore:t,chartConfig:o,chartConfigToDisplay:r,chartReducerResults:i,timezone:a,loadingProps:n,chartHeight:l,isFullScreen:s}=e;if(o&&(0,h().m)(o)&&r&&(0,h().m)(r)){if("groups_reducer"===r.dataConfig.type&&(void 0===i||"groups"===(null==i?void 0:i.type)))return(0,N.jsx)(ye,{loadingProps:n,timezone:a,groupedDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,axisType:o.type});if("results_reducer"===r.dataConfig.type&&(void 0===i||"results"===(null==i?void 0:i.type)))return(0,N.jsx)(_e,{loadingProps:n,timezone:a,resultsDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,axisType:o.type})}return(0,N.jsx)("div",{style:{height:l,width:"100%"},children:(0,N.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:s})})}function Be(e){let{collectionContextStore:t,chartConfig:o,chartConfigToDisplay:r,chartReducerResults:i,timezone:n,loadingProps:l,aggregationChartReducer:s,chartHeight:u,isFullScreen:c}=e;const d=(0,a().K8)((()=>(0,T().x)()),[]),g=(0,V().A)({id:k().nb,reducer:s,collectionContextStore:t,debounceWait:d});return"groups_reducer"!==r.dataConfig.type||void 0!==i&&"groups"!==(null==i?void 0:i.type)?"results_reducer"!==r.dataConfig.type||void 0!==i&&"results"!==(null==i?void 0:i.type)?(0,N.jsx)("div",{style:{height:u,width:"100%"},children:(0,N.jsx)(R().z,{chartType:null==o?void 0:o.type,showCopy:c})}):(0,N.jsx)(Ve,{loadingProps:l,timezone:n,resultsDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,resultsChartReducerResults:i,aggregationChartReducerResults:g}):(0,N.jsx)(Me,{loadingProps:l,timezone:n,groupedDataConfig:r.dataConfig,chartFormat:o.chartFormat,collectionContextStore:t,groupedChartReducerResults:i,aggregationChartReducerResults:g})}function Le(e){const{collectionContextStore:t,isPreviewing:o,paddingLeft:r,paddingRight:k,headingWidth:M=0}=e,_=(0,i().v3)(),{isMobile:V}=_.device,{collectionViewBlockStore:T,collectionSettingsStore:P,collectionViewStore:A,chartErrorStore:D}=(0,a().K8)((()=>({collectionViewBlockStore:t.collectionViewBlockStore(),collectionSettingsStore:t.settingsStore,collectionViewStore:t.collectionViewStore(),chartErrorStore:t.chartErrorStore})),[t]),B=(0,a().O$)(t.isFullScreenStore),L=(0,a().O$)(t.isInHomeWidgetStore),F=(0,a().K8)((()=>Boolean(t.viewsModuleContextStore.getViewModuleType())),[t]),K=(0,a().K8)((()=>T&&x().A.isBlockInTemplate(T)),[T]),j=(0,a().O$)(t.normalizedFormatStore),z=(0,a().K8)((()=>j.chart_config),[j]),O=(0,a().K8)((()=>{var e;return(null==A?void 0:A.id)&&(null===(e=t.updateFreeChartsResultStore.state.get(A.id))||void 0===e?void 0:e.isPending)}),[t.updateFreeChartsResultStore,A]),{canViewChart:G,canViewChartError:E}=(0,s().f)({collectionContextStore:t}),I=(0,a().K8)((()=>{if(!S().A.state.online)return"offline";const e=(0,n().ye)({chartConfig:z,collectionSchema:t.normalizedSchemaStore.state});if(void 0!==e)return e;const o=A?D.getState().get(A.id):void 0;if(void 0!==o)return o;let r;return K||!E&&G||(r=E??"paywall"),r}),[z,D,t.normalizedSchemaStore,A,G,E,K],{useDeepEqual:!0}),H=(0,a().K8)((()=>"sidebar"===(0,f().DN)(t,V,M)&&P.state.open),[t,P,M,V]),q=(0,a().K8)((()=>{var e;return(null===(e=C().default.state.currentUserSettingsStore)||void 0===e?void 0:e.getSettingsStore().getKeyStore("time_zone").getValue())||(0,l().P)()}),[]),$=(0,p().x)({chartConfig:z,chartError:I,collectionContextStore:t}),W=function(e){let{chartConfig:t,chartError:o}=e;return(0,a().K8)((()=>{var e,r;if((!o||(0,n().xG)(o))&&t&&"placeholder"!==t.type)if("groups_reducer"===(null===(e=t.dataConfig)||void 0===e?void 0:e.type)){const e=(0,g().p7)(t);if(e)return{type:"aggregation",aggregation:e}}else if("results_reducer"===(null===(r=t.dataConfig)||void 0===r?void 0:r.type))return{type:"aggregation",aggregation:{aggregator:"sum",property:t.dataConfig.valueProperty}}}),[t,o],{useDeepEqual:!0})}({chartConfig:z,chartError:I}),Y=function(e){let{chartConfig:t,chartError:o,collectionContextStore:r}=e;const i=(0,a().K8)((()=>{var e;const o=(0,v().N1)({collectionContextStore:r,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}),i=t&&(0,h().m)(t)?null===(e=t.chartFormat)||void 0===e?void 0:e.axisHideEmptyGroups:void 0,a=t&&(0,h().m)(t)&&"results_reducer"===t.dataConfig.type?t.dataConfig.valueProperty:void 0;if(i&&a){const e={property:a,filter:{operator:"is_not_empty"}},t={property:a,filter:{operator:"number_does_not_equal",value:{type:"exact",value:0}}};o.push(e,t)}return(0,m().GV)(o)}),[r,t]),l=(0,a().K8)((()=>(0,y().dP)()),[]);return(0,a().K8)((()=>{if((!o||(0,n().xG)(o))&&t&&"placeholder"!==t.type&&"results_reducer"===t.dataConfig.type)return{type:"results",limit:l,filter:i}}),[o,t,i,l],{useDeepEqual:!0})}({chartConfig:z,chartError:I,collectionContextStore:t}),X=(0,a().K8)((()=>{var e,o;if(z&&"placeholder"!==z.type&&W)return"groups_reducer"===(null==z||null===(e=z.dataConfig)||void 0===e?void 0:e.type)&&$?{reducerRequestType:"groups",groupedChartReducer:$,aggregationChartReducer:W,collectionContextStore:t,chartConfig:z,timezone:q}:"results_reducer"===(null==z||null===(o=z.dataConfig)||void 0===o?void 0:o.type)&&Y?{reducerRequestType:"results",resultsChartReducer:Y,aggregationChartReducer:W,collectionContextStore:t,chartConfig:z,timezone:q}:void 0}),[z,t,$,W,Y,q]),U=(0,d().Zp)();if(!T)return null;let Q;return Q=I&&!(0,n().xG)(I)?"paywall"!==I||!O&&void 0!==G?(0,N.jsx)(w().A,{chartError:I,collectionSettingsStore:t.settingsStore,chartType:null==z?void 0:z.type}):(0,N.jsx)(R().z,{chartType:null==z?void 0:z.type,showCopy:B}):z&&"placeholder"!==z.type&&X?(0,N.jsx)(Ae,{...X}):(0,N.jsx)(w().A,{chartError:z?"data_model_invalid":"chart_config_not_found",collectionSettingsStore:t.settingsStore,chartType:null==z?void 0:z.type}),(0,N.jsx)("div",{style:{paddingLeft:r,paddingRight:k,paddingTop:15},children:(0,N.jsx)(b().A,{store:T,shouldShowHalo:!B&&!L&&!o,canSelect:!B&&!F,disablePointerEvents:null==U?void 0:U.disableAllPointerEvents,analyticsName:"chart",children:(0,N.jsx)(c().A,{animate:{width:H?`calc(100% - ${u().vE}px)`:"100%"},children:Q})})})}},732038:(e,t,o)=>{o.d(t,{Sp:()=>w,sw:()=>R,Iz:()=>k});var r=()=>o(584262),i=()=>o(713998),a=()=>o(750660),n=()=>o(467676),l=()=>o(681445),s=()=>o(989423),u=()=>o(476492),c=(o(898992),o(354520),()=>o(901610)),d=()=>o(592269),g=()=>o(289915),p=()=>o(857639),h=()=>o(416504),m=()=>o(498212),v=()=>o(274375);var y=()=>o(374136),f=()=>o(492414),x=()=>o(753199),C=()=>o(630116),S=()=>o(246826),b=()=>o(435009);function w(e){const{chartConfig:t,collectionViewBlockStore:o,format:r,dataPoint:a,clickEvent:n,schema:f,environment:C,collectionContextStore:S,intl:b,query2:w,temporaryViewState:R}=e;if(!o||"groups_reducer"!==(null==t?void 0:t.dataConfig.type))return;(0,x().SQ)({event:n,context:x().y$.EditorClick});const k=function(e){const{dataPoint:t,propertySchema:o,groupByFormat:r,aggregation:i,intl:a}=e,n=t.name??t.x.toString();if(!o)return n;return(0,y().w$)({propertySchema:o,groupByFormat:r,aggregation:i,highChartsLabel:n,intl:a})}({dataPoint:a,propertySchema:(0,i()._g)({schema:f,property:t.dataConfig.groupBy.property}),groupByFormat:null==t?void 0:t.dataConfig.groupBy,aggregation:null==t?void 0:t.dataConfig.aggregationConfig.aggregation,intl:b}),M=function(e){var t,o;const{chartConfig:r,dataPoint:i,format:a,schema:n,collectionViewBlockStore:l,query2:s,temporaryViewState:u}=e;if(!(r&&"placeholder"!==r.type&&"results_reducer"!==r.dataConfig.type&&r.dataConfig.groupBy&&i&&l&&l.pointer.spaceId))return void p().log({level:"error",from:"chartDrilldownHelpers",type:"chartDrilldownMissingRequiredData",error:{name:"chartDrilldownHelpers",message:"Unexpected error"},data:{miscDataToConvertToString:{chartConfig:r,dataPoint:i,collectionViewBlockStore:l}}});const y=r.dataConfig.groupBy.property,f=(0,v().Q)(l,y),x={type:"table",parent_id:l.pointer.id,parent_table:l.pointer.table,alive:!0,space_id:l.pointer.spaceId,format:{is_unlisted:!0,collection_pointer:null==a?void 0:a.collection_pointer,property_filters:(null==u||null===(t=u.propertyFilters)||void 0===t?void 0:t.value)??(null==a?void 0:a.property_filters),table_properties:f},query2:{...s,filter:(null==u||null===(o=u.combinatorFilter)||void 0===o?void 0:o.value)??(null==s?void 0:s.filter)}};let C;var S;return i.groupFormat&&(C=(0,d().K8)({schema:n,propertyMapping:void 0,groupBy:r.dataConfig.groupBy,group:i.groupFormat,timeZone:(0,h().P)()})),C&&((0,g().dU)(C)?null!==(S=x.query2)&&void 0!==S&&S.filter?x.query2.filter=(0,g().GV)([x.query2.filter,C]):x.query2.filter=C:(0,g().yX)(C)&&(x.format.property_filters=[...x.format.property_filters??[],{filter:C,id:(0,m().Ay)()}])),"groups_reducer"===r.dataConfig.type&&(0,c().m)(r)&&r.dataConfig.aggregationConfig.stackOptions&&(x.format.collection_group_by=function(e){var t;if(null===(t=e.aggregationConfig)||void 0===t||!t.stackOptions)return;const o=e.aggregationConfig.stackOptions.groupBy;return o.hideEmptyGroups=!0,o}(r.dataConfig)),x}({chartConfig:t,format:r,dataPoint:a,schema:f,collectionViewBlockStore:o,query2:w,temporaryViewState:R});if(!M)return;const _=(0,u().sl)(S);(0,s().u4)({environment:C,event:{eventName:"collection_chart_drilldown_click",eventProperties:{..._,drilldown_type:"grouped",from:"chart_data_point"}}}),l().S.openCollectionDrilldownView({collectionViewValue:M,collectionViewBlockStore:o,viewsModuleContext:S.viewsModuleContextStore.state,title:k})}function R(e){var t;const{collectionStore:o,dataPoint:i,clickEvent:a,environment:n,collectionContextStore:l}=e;if(null==i||null===(t=i.pagePointer)||void 0===t||!t.id||!o)return;(0,x().SQ)({event:a,context:x().y$.EditorClick});const c=C().Bv.createChildStore(o,i.pagePointer),d=(0,f().Ay)({store:c,fullyQualified:!1,pageVisitSource:r().y8.Expand,showMoveTo:!1,openInCenterPeek:!0});if(!d)return;const g=(0,u().sl)(l);(0,s().u4)({environment:n,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...g,drilldown_type:"results",from:"chart_data_point"}}}),b().oo({environment:n,url:d})}async function k(e){const{environment:t,collectionViewStore:o,collectionViewBlockStore:r,collectionContextStore:i,acceptMoveToArgs:l,transaction:c,intl:d}=e;if(!o)return;const g=r.getCollectionPointer(),p=S().Wv({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,type:"collection_view",transaction:c}),h=(0,n().t)({environment:t,transaction:c,collectionViewStore:o,collectionViewBlockStore:p,intl:d,copyNameExactly:!0});if(!h)return;h.getFormatStore().getKeyValue("collection_pointer")||S().zv({store:h.getFormatStore().getKeyStore("collection_pointer"),data:g,transaction:c}),S().zv({store:h.getFormatStore(),data:{is_unlisted:null},transaction:c}),await a().Ju({...l,targets:[p],transaction:c});const m=(0,u().sl)(i);return(0,s().u4)({environment:t,event:{eventName:"collection_chart_drilldown_save",eventProperties:{...m,new_collection_view_block_id:p.pointer.id}}}),p}},851979:(e,t,o)=>{o.d(t,{h:()=>i});o(296540);var r=o(474848);const i=(0,o(340498).wt)("eye",{viewBox:"0 0 32 32",svg:(0,r.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})}}]);