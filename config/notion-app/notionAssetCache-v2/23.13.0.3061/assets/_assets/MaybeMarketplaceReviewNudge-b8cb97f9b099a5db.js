"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[54215],{20051:(e,t,i)=>{i.d(t,{Bl:()=>d,IH:()=>l,Lh:()=>y,Mh:()=>p,RY:()=>w,VP:()=>T,_A:()=>m,n$:()=>f});var n=()=>i(534177),r=()=>i(130382),o=()=>i(416845),s=()=>i(266442);const a=15;function d(e){if(!s().Vu.includes(e))throw new(o().rTV)("Rating must be an integer between 1 and 5.",{type:"marketplace_listing_review_invalid_rating"});return!0}const c=3,u=100;function l(e){const t=e.trim();if(t.length<c)throw new(o().rTV)("Title too short",{type:"marketplace_listing_review_title_too_short"});if(t.length>u)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_title_too_long"})}const g=50,v=1500;function m(e){const t=e.trim();if(t.length<g)throw new(o().rTV)("Description too short",{type:"marketplace_listing_review_description_too_short"});if(t.length>v)throw new(o().rTV)("Title too long",{type:"marketplace_listing_review_description_too_long"})}const h=40;function w(e){const t=e.trim();if(0===t.length)throw new(o().rTV)("Name is required",{type:"marketplace_listing_review_name_too_short"});if(t.length>h)throw new(o().rTV)("Name too long",{type:"marketplace_listing_review_name_too_long"})}const I=5,_=1500;function f(e){const t=e.trim();if(t.length<I)throw new(o().rTV)("Creator response too short",{type:"marketplace_listing_review_creator_response_too_short"});if(t.length>_)throw new(o().rTV)("Creator response too long",{type:"marketplace_listing_review_creator_response_too_long"})}function p(e){return void 0!==e.getTitle()&&void 0!==e.getSerializedContent()}function T(e){return(0,r().YH)(e)<a}function y(e){switch(e){case"mostRecent":return{columnName:"updated_time",direction:"descending"};case"highestRating":return{columnName:"rating",direction:"descending"};case"lowestRating":return{columnName:"rating",direction:"ascending"};default:(0,n().HB)(e)}}},348069:(e,t,i)=>{i.r(t),i.d(t,{MaybeMarketplaceReviewNudge:()=>T});var n=i(296540),r=()=>i(484714),o=()=>i(847249),s=()=>i(187174),a=()=>i(20051),d=()=>i(449506),c=()=>i(351360),u=()=>i(936015),l=()=>i(103826),g=()=>i(836586),v=()=>i(743071),m=()=>i(672753),h=()=>i(998765),w=i(474848);const I=15,_=10,f=10,p=1;function T(e){let{blockStore:t}=e;const i=(0,r().v3)(),{installationPointer:T,version:y,lastEditedById:q,lastEditedTime:C,createdTime:k}=function(e){return(0,o().K8)((()=>{var t;if(!e.isDefined())return{};const i=e.getModel();return{installationPointer:i.getIsImprintableBlock()?null===(t=i.getFormat().installation_imprint)||void 0===t?void 0:t.pointer:void 0,lastEditedById:e.getLastEditedById(),lastEditedTime:e.getLastEditedTime(),createdTime:e.getCreatedTime(),version:i.getVersion()}}),[e])}(t),{acquisitionPointer:R}=function(e){const t=(0,r().v3)();return(0,o().K8)((()=>{if(!e)return{};const i=new(g().f)(t,e);return{acquisitionPointer:null==i?void 0:i.getAcquisitionPointer()}}),[t,e])}(T),{customerPointer:S,acquisitionStatus:V,listingId:b,acquisitionId:P,succeededTime:E}=function(e){const t=(0,r().v3)();return(0,o().K8)((()=>{var i,n;if(!e)return{};const r=new(u().y)(t,e);return{acquisitionStatus:null==r?void 0:r.getStatus(),succeededTime:(null===(i=r.getAttributes())||void 0===i?void 0:i.succeeded_time)??r.getCreatedTime(),customerPointer:null==r?void 0:r.getCustomerPointer(),listingId:null==r?void 0:r.getListingId(),acquisitionId:null==r||null===(n=r.getModel())||void 0===n?void 0:n.id}}),[t,e])}(R),{acquirerId:M,customerId:B}=function(e){let{customerPointer:t,acquisitionStatus:i,succeededTime:n,listingId:s}=e;const d=(0,r().v3)();return(0,o().K8)((()=>{var e,r;if(!t||"succeeded"!==i||!s||!n||(0,a().VP)(n))return{};const{currentUserSettingsStore:o}=c().default.state;if(null==o||!o.isDefined())return{};const u=o.getSettingsStore().getKeyStore("marketplace_review_nudge").getValue();if(Object.keys(u||{}).length>=f||(null===(e=(u||{})[s])||void 0===e?void 0:e.length)>=p)return{};const g=new(l().z)(d,t);return{acquirerId:null==g?void 0:g.getAcquirerId(),customerId:null==g||null===(r=g.getModel())||void 0===r?void 0:r.id}}),[d,t,i,s,n])}({customerPointer:S,acquisitionStatus:V,succeededTime:E,listingId:b}),N=function(e){let{currentUserId:t,listingId:i,customerId:r,acquirerId:s,version:a,lastEditedById:d,lastEditedTime:c,createdTime:u}=e;const l=(0,n.useRef)(Date.now());return(0,o().K8)((()=>{if(!(r&&s&&i&&a&&d&&c&&u))return!1;if(c<l.current)return!1;if(s!==t||d!==t)return!1;return!((c-u)/6e4<I)&&!(a<_)}),[t,i,r,s,a,d,c,u])}({currentUserId:i.currentUser.id,listingId:b,customerId:B,acquirerId:M,version:y,lastEditedById:q,lastEditedTime:C,createdTime:k}),{reviewId:K,isReady:A}=function(e){let{acquisitionId:t,listingId:i,customerId:o,shouldDisplayNudge:a}=e;const c=(0,r().v3)(),[u,l]=(0,n.useState)(),[g,m]=(0,s().V$)((async()=>{if(i&&o&&t){const e=await d().callApi({eventName:"getMarketplaceListingReviewForCustomer",environment:c,data:{listingId:i,customerId:o}});if("success"===e.type&&e.data.success){const{reviewId:i}=e.data;v().A.setReviewId(t,i),l(i)}}}),[c,i,o,t]),h=Boolean(a&&i&&o&&t);return(0,n.useEffect)((()=>{h&&m()}),[h,m]),{reviewId:u,isReady:"resolved"===g.status}}({acquisitionId:P,listingId:b,customerId:B,shouldDisplayNudge:N}),{isReady:D,isComplete:L,rating:U}=(0,m().Z)(K);return N&&A&&D&&!L&&!U&&P&&b?(0,w.jsx)(h().lK,{acquisitionId:P,listingId:b}):null}},672753:(e,t,i)=>{i.d(t,{L:()=>c,Z:()=>u});var n=()=>i(484714),r=()=>i(847249),o=()=>i(20051),s=()=>i(266442),a=()=>i(630116),d=()=>i(743071);function c(e){return u((0,r().K8)((()=>d().A.getReviewId(e)),[e]))}function u(e){const t=(0,n().v3)();return(0,r().K8)((()=>{if(e){const i=new(a().Js)(t,{table:s().UN,id:e}),n=i.isReady(),r=i.getModel();return{isReady:n,isComplete:Boolean(r&&(0,o().Mh)(r)),rating:i.getRating()}}return{isComplete:!1,isReady:!0}}),[t,e])}},743071:(e,t,i)=>{i.d(t,{A:()=>o});const n={reviewIdCache:{},isOpen:!1,acquisitionId:"",stage:"rating",rating:0,source:void 0};class r extends(()=>i(757695))().default{getInitialState(){return{...n}}setReviewId(e,t){this.setState({...this.state,reviewIdCache:{...this.state.reviewIdCache,[e]:t}})}getReviewId(e){return this.state.reviewIdCache[e]}openModal(e){let{stage:t,acquisitionId:i,rating:r,source:o}=e;this.setState({...n,reviewIdCache:this.state.reviewIdCache,isOpen:!0,acquisitionId:i,stage:t,rating:r||0,source:o})}closeModal(){this.setState({...n,reviewIdCache:this.state.reviewIdCache})}updateState(e){this.setState({...this.state,...e})}}const o=new r}}]);