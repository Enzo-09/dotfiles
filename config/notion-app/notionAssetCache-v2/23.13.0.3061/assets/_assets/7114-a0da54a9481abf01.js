(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[7114,92821],{42245:(e,t,r)=>{"use strict";r.d(t,{KO:()=>y,PD:()=>x,Qw:()=>g,Rr:()=>m,fX:()=>T,jL:()=>h,lM:()=>_});r(16280),r(898992),r(672577),r(430670),r(803949),r(581454);var i=()=>r(496603),n=()=>r(498212),o=()=>r(534177),a=()=>r(638681),s=()=>r(970013),u=()=>r(254947),c=()=>r(68263),d=()=>r(179034),p=()=>r(915671),l=()=>r(725649);function y(){return{id:(0,n().Ay)(),parent_table:d().ev,parent_id:p().KB,space_id:p().KB,alive:!0,version:1}}function g(e){if(e)return e.collection?(0,s().Dp)(e.collection):e.blockSchema}function m(e){const{schema:t,internalRelations:r,databaseModules:i}=e,n={},o={};for(const[a,s]of Object.entries(t)){if(!s)continue;const e=k({propertyId:a,propertySchema:s,internalRelations:r,databaseModules:i});e&&(n[e.name]=e.schema,o[e.name]=a)}return n.content||(n.content={type:"content",description:""}),{workflowSchema:n,propertyKeyToIdMap:o}}function h(e){const t={};for(const[r,i]of Object.entries(e))i&&(t[v(i.name)]=r);return t}const f="userDefined:",b=["id","url"];function v(e){const t=e.toLowerCase();return b.includes(t)?`${f}${e}`:e}function k(e){const{propertyId:t,propertySchema:r,internalRelations:n,databaseModules:a}=e,s=v(r.name);if("title"===r.type)return{name:s,schema:{type:"title",description:r.description||""}};if("text"===r.type)return{name:s,schema:{type:"text",description:r.description||""}};if("url"===r.type)return{name:s,schema:{type:"url",description:r.description||""}};if("email"===r.type)return{name:s,schema:{type:"email",description:r.description||""}};if("phone_number"===r.type)return{name:s,schema:{type:"phone_number",description:r.description||""}};if("checkbox"===r.type)return{name:s,schema:{type:"checkbox",description:r.description||""}};if("person"===r.type)return{name:s,schema:{type:"person",description:r.description||""}};if("file"===r.type)return{name:s,schema:{type:"file",description:r.description||""}};if("select"===r.type)return{name:s,schema:{type:"select",description:r.description||"",options:(r.options||[]).map((e=>({value:e.value,description:e.description||""})))}};if("multi_select"===r.type)return{name:s,schema:{type:"multi_select",description:r.description||"",options:(r.options||[]).map((e=>({value:e.value,description:e.description||""})))}};if("status"===r.type)return{name:s,schema:{type:"status",description:r.description||"",groups:{to_do:w({propertySchema:r,type:u().QV}),in_progress:w({propertySchema:r,type:u().jc}),complete:w({propertySchema:r,type:u().P0}),current:w({propertySchema:r,type:u().nX}),future:w({propertySchema:r,type:u().p7})}}};if("date"===r.type)return{name:s,schema:{type:"date",description:r.description||""}};if("created_time"===r.type)return{name:s,schema:{type:"created_time",description:r.description||""}};if("last_edited_time"===r.type)return{name:s,schema:{type:"last_edited_time",description:r.description||""}};if("relation"===r.type){var c;if(n[t]){const{databaseKey:e,propertyKey:i}=n[t];return{name:s,schema:{type:"relation",description:r.description||"",databaseKey:e,propertyKey:i}}}const e=(null===(c=r.collection_pointer)||void 0===c?void 0:c.id)??r.collection_id;if(!e)return;const o=a.find((t=>{var r,i;const n=(0,l().DK)(t.state);return!!n&&((null===(r=n.pointer)||void 0===r?void 0:r.id)===e||(null===(i=n.collection)||void 0===i?void 0:i.id)===e)}));if(!o)return;const u=(0,l().DK)(o.state);if(!u)return;const d=r.property;let p;const y=g(u);if(y){const e=d?y[d]:void 0;p=e?v(e.name):void 0}else{const e=i().B8(u.propertyKeyToIdMap||{});p=d?e[d]:void 0}return{name:s,schema:{type:"relation",description:r.description||"",databaseKey:o.key,propertyKey:p}}}if("number"===r.type)return{name:s,schema:{type:"number",description:r.description||""}};var d;"rollup"!==(d=r).type&&"formula"!==d.type&&"created_by"!==d.type&&"location"!==d.type&&"last_edited_by"!==d.type&&"last_visited_time"!==d.type&&"button"!==d.type&&"auto_increment_id"!==d.type&&"verification"!==d.type&&"geo_point"!==d.type&&(0,o().HB)(r)}function w(e){var t;const{propertySchema:r,type:i}=e;return((null===(t=(r.groups||[]).find((e=>e.name===i)))||void 0===t?void 0:t.optionIds)||[]).flatMap((e=>{const t=(r.options||[]).find((t=>t.id===e));return t?[{value:t.value,description:t.description||""}]:[]}))}a().array(a().string());function x(e){let t=e.replace(/\s+/g,"").replace(/[^a-zA-Z0-9]/g,"").replace(/^(.)/,(e=>e.toLowerCase()));return""===t&&(t="untitled"),/^[^a-z]/.test(t)&&(t=`_${t}`),t}function T(e){return(0,c().p2)(e)?"write":"read"}function _(e){const{newBlockSchema:t,newDatabaseModule:r,databaseModules:i}=e,n=(0,l().DK)(r.state);if(!n||!n.pointer)throw new Error("Database state not found");const o=n.internalRelations??{},a={...t};for(const[u,c]of Object.entries(a)){var s;if(!c||"relation"!==c.type||(null===(s=c.collection_pointer)||void 0===s?void 0:s.id)!==p().KB)continue;const{databaseKey:e,propertyKey:t}=o[u]??{},r=i.find((t=>t.key===e));if(!r)throw new Error("Relation database module not found");const n=(0,l().DK)(r.state);if(!n||!n.pointer||!n.propertyKeyToIdMap)throw new Error("Relation collection pointer not found");const d=n.pointer,y=t?n.propertyKeyToIdMap[t]:void 0;a[u]={...c,collection_pointer:d,property:y}}return a}},94522:(e,t,r)=>{"use strict";r.d(t,{Cq:()=>w,Ds:()=>v,EP:()=>I,FY:()=>_,SU:()=>T,V4:()=>x,aY:()=>k,bX:()=>b,dh:()=>y,n2:()=>g});r(16280),r(410838),r(944114),r(898992),r(354520),r(672577),r(803949),r(581454),r(737550);var i=()=>r(943387),n=()=>r(42245),o=()=>r(725649),a=()=>r(550622),s=()=>r(915671),u=()=>r(496603),c=()=>r(534177),d=()=>r(255299),p=()=>r(630116),l=()=>r(564037);function y(e){var t;return(null===(t=e.getModel())||void 0===t?void 0:t.getData())||s().ZB}function g(e){var t;const{workflowStore:r,clientStore:i,environment:n,store:o,threadStore:s}=e,u=(0,l().getCurrentWorkflowNavigationState)(n);if(null==u||!u.isOpen)return;const c=(0,d().A3)({clientStore:i,threadStore:s}),p=null===(t=(0,a().rE)({transcript:c,appId:o.id,spaceId:o.getSpaceId()}))||void 0===t?void 0:t.workflow;return p||(r?y(r):void 0)}function m(e,t,r){if(!e)return(null==t?void 0:t.map((e=>({value:e,diff:"added"}))))||[];if(!t)return e.map((e=>({value:e,diff:"removed"})));const i=new Map(e.map((e=>[e[r],e]))),n=new Map(t.map((e=>[e[r],e]))),o=[];for(const[a,s]of n)if(i.has(a)){const e=i.get(a);u().n4(e,s)||o.push({value:s,diff:"changed"})}else o.push({value:s,diff:"added"});for(const[a,s]of i)n.has(a)||o.push({value:s,diff:"removed"});return o}function h(e){return Object.entries(e||{}).filter((e=>void 0!==e[1])).map((e=>{let[t,r]=e;return{propertyId:t,property:r}}))}function f(e){const{oldSchema:t,newSchema:r}=e;return m(h(t),h(r),"propertyId")}function b(e){const{previousDatabaseModule:t,newDatabaseModule:r,collectionStore:i,databaseModules:a}=e,s=i.getSchema(),u=(0,o().DK)(null==t?void 0:t.state);let d=(0,n().Qw)(u);const p=(0,o().DK)(r.state),l=(0,n().Qw)(p);null!=p&&p.pointer&&!t&&(d=s);const y=f({oldSchema:d,newSchema:l}),{schema:g,deletedSchema:m}=function(e){const{diff:t,currentSchema:r}=e,i=new Map(t.map((e=>[e.value.propertyId,e]))),n={},o={};for(const[a,s]of Object.entries(r)){if(!s)continue;const e=i.get(a);e?(o[a]=s,"removed"!==e.diff&&("changed"===e.diff||"added"===e.diff?n[a]=e.value.property:(0,c().HB)(e.diff))):n[a]=s}for(const[a,s]of i)n[a]||"removed"===s.diff||(n[a]=s.value.property);return{schema:n,deletedSchema:o}}({diff:y,currentSchema:s}),h=(0,n().Rr)({schema:g,internalRelations:(null==p?void 0:p.internalRelations)||{},databaseModules:a});return{newBlockSchema:g,newDeletedBlockSchema:m,mappedDiff:f({oldSchema:s,newSchema:g}),newPropertyKeyToIdMap:h.propertyKeyToIdMap}}function v(e){const{newDatabaseViews:t,lastSavedStepDatabaseViews:r,store:i}=e,n=[],o=i.getCollectionViewStores().map((e=>e.getValue())).filter(c().O9);for(const a of t){const e=r.find((e=>e.collectionView.id===a.collectionView.id));if(!e){n.push({value:a,diff:"added"});continue}if(u().n4(e,a))continue;const t=o.find((e=>e.id===a.collectionView.id));t?u().n4(t,a)||n.push({value:a,diff:"changed"}):n.push({value:a,diff:"added"})}for(const a of r){t.find((e=>e.collectionView.id===a.collectionView.id))||n.push({value:a,diff:"removed"})}return n}function k(e){return e.filter((e=>e.isFunction())).map((e=>e.getData())).filter((e=>void 0!==e))}function w(e){const{workflowStore:t,threadStore:r}=e,i=(null==t?void 0:t.getSpaceId())??(null==r?void 0:r.getSpaceId());if(!i)throw new Error("No spaceId found in workflowStore or threadStore");if(r)return{table:"thread",id:r.id,spaceId:i};if(t)return{table:"workflow",id:t.id,spaceId:i};throw new Error("No workflow definition pointer found")}function x(e){let{module:t,store:r}=e;const i=(0,o().DK)(t.state);if(null!=i&&i.pointer&&r)return p().md.createChildStore(r,i.pointer)}function T(e){const t=[];let r=[],i=-1;return e.forEach(((e,n)=>{"workflow"===e.type?(-1!==i&&r.length>0&&(t.splice(i+1,0,...r),r=[]),t.push(e),i=t.length-1):"workflow-progress"===e.type?r.push(e):t.push(e)})),-1!==i&&r.length>0&&t.splice(i+1,0,...r),t}function _(e){var t,r;const{collectionViewId:i,workflow:n}=e,o=null===(t=n.databaseViews)||void 0===t?void 0:t.find((e=>e.collectionView.id===i)),a=null===(r=n.views)||void 0===r?void 0:r.find((e=>{var t;return(null===(t=e.pointer)||void 0===t?void 0:t.id)===i}));return(null==o?void 0:o.key)??(null==a?void 0:a.key)}function I(e){return e?null==e?void 0:e.getTranscript().filter((e=>(0,i().Pj)(e))).filter((e=>{var t;return null===(t=e.threadOperations)||void 0===t?void 0:t.some((e=>void 0===e.userAction))})):[]}},142918:(e,t,r)=>{"use strict";r.d(t,{$h:()=>T,IA:()=>M,NW:()=>I,QA:()=>w,Yp:()=>g,bE:()=>K,kK:()=>b,sr:()=>_,xb:()=>x});r(16280),r(944114),r(898992),r(354520),r(672577),r(581454);var i=()=>r(496603),n=()=>r(534177),o=()=>r(134025),a=()=>r(351028),s=()=>r(179034),u=()=>r(519831),c=()=>r(869558),d=()=>r(42245),p=()=>r(725649),l=()=>r(724639),y=()=>r(915671);function g(e){const{workflowStep:t,transcript:r}=e;if(null==t||!t.value)return y().ZB;const i=r.findIndex((e=>e.id===t.id));if(-1===i)return t.value;const n=function(e){const{workflowStepIndex:t,transcript:r}=e,i=[];for(const o of r.slice(t+1)){var n;if((0,l().P0)(o))(null===(n=o.appliesToPointer)||void 0===n?void 0:n.id)===r[t].id&&i.push(o);else if((0,l().S7)(o))break}return i}({workflowStepIndex:i,transcript:r});return function(e){const{workflowValue:t,operationSteps:r}=e;let i=t;for(const n of r)i=m(i,n.workflowOperations);return i}({workflowValue:t.value,operationSteps:n})}function m(e,t){let r=e;for(const i of t){const e=i.workflowValueOperation;if(e)switch(e.type){case"operation":r=f(r,e.operation);break;case"set":case"setModule":case"setConfigVariable":case"setTrigger":case"setFunction":r=h(r,e).data;break;case"addModule":{const{data:t,wasFound:i}=h(r,{type:"setModule",moduleKey:e.moduleKey,args:e.args});r=i?t:{...r,modules:[...r.modules??[],e.args]};break}case"removeModule":r={...r,modules:(r.modules??[]).filter((t=>t.key!==e.moduleKey))};break;case"addTrigger":{const{data:t,wasFound:i}=h(r,{type:"setTrigger",triggerKey:e.triggerKey,args:e.args});r=i?t:{...r,triggers:[...r.triggers??[],e.args]};break}case"removeTrigger":r={...r,triggers:(r.triggers??[]).filter((t=>t.key!==e.triggerKey))};break;default:(0,n().HB)(e)}}return r}function h(e,t){let r=e,n=!1;switch(t.type){case"set":{const e=i().mg(t.args),n=t.path??[];r=n.length>0?(0,a().cloneAndSetValueAtPath)(r,n,e):e;break}case"setModule":{const e=i().mg(t.args),o=t.path??[],s=(r.modules??[]).findIndex((e=>e.key===t.moduleKey));if(-1!==s){const t=["modules",s,...o];r=(0,a().cloneAndSetValueAtPath)(r,t,e),n=!0}break}case"setConfigVariable":{const e=i().mg(t.args),n=t.path??[],o=["configVariables",t.configVariableKey,...n];r=(0,a().cloneAndSetValueAtPath)(r,o,e);break}case"setTrigger":{const e=i().mg(t.args),o=t.path??[],s=(r.triggers??[]).findIndex((e=>e.key===t.triggerKey));if(-1!==s){const t=["triggers",s,...o];r=(0,a().cloneAndSetValueAtPath)(r,t,e),n=!0}break}case"setFunction":{const e=r.functionPointers??[],i=e.findIndex((e=>e.id===t.oldFunctionPointer.id));if(-1!==i){const o=[...e];o[i]=t.newFunctionPointer,r={...r,functionPointers:o},n=!0}break}}return{data:r,wasFound:n}}function f(e,t){return v(t)?function(e,t){const r=(e.modules??[]).filter((e=>"database"===e.type)),i=r.map((e=>{var t;return null===(t=(0,p().DK)(e.state))||void 0===t?void 0:t.collection})).findIndex((e=>(null==e?void 0:e.id)===t.pointer.id));if(-1===i)return e;const n=r[i],o=(0,p().DK)(n.state);if(!o||!o.collection)return e;const s={...n,state:{...o,collection:(0,a().performPrimitiveOperation)(t,o.collection)}},{data:u}=h(e,{type:"setModule",moduleKey:s.key,args:s});return u}(e,t):k(t)?function(e,t){const r=i().mg(e),n=r.databaseViews??[],o=n.findIndex((e=>e.collectionView.id===t.pointer.id));if(function(e){return"set"===e.command&&0===e.path.length}(t)){if(-1!==o)return e;const i=(r.modules??[]).filter((e=>"database"===e.type)).find((e=>{var r,i;return(null===(r=(0,p().DK)(e.state))||void 0===r||null===(r=r.pointer)||void 0===r?void 0:r.id)===(null===(i=t.args.format)||void 0===i||null===(i=i.collection_pointer)||void 0===i?void 0:i.id)})),a={key:(0,d().PD)(t.args.name||t.args.type||"Untitled"),databaseKey:null==i?void 0:i.key,collectionView:t.args};return{...r,databaseViews:[...n,a]}}if(function(e){return"update"===e.command&&!1===e.args.alive}(t))return-1===o?e:{...r,databaseViews:[...n.slice(0,o),...n.slice(o+1)]};{if(-1===o)return e;const i=n[o],s=(0,a().performPrimitiveOperation)(t,i.collectionView),u={...i,collectionView:s};return{...r,databaseViews:[...n.slice(0,o),u,...n.slice(o+1)]}}}(e,t):e}function b(e){return v(e)||k(e)}function v(e){return e.pointer.table===u().Vl&&"schema"===e.path[0]&&("set"===e.command||"update"===e.command)}function k(e){if(!(0,o().$Y)(e)||e.pointer.table!==c().Gy)return!1;if("set"===e.command)return!1;const{last_edited_by:t,last_edited_time:r,...i}=e.args;return 0!==Object.keys(i).length}function w(e){return e.pointer.table===s().ev&&"format"===e.path[0]&&"update"===e.command&&e.args.collection_pointers}function x(e){const{pointer:t,module:r}=e;return{pointer:t,command:"keyedObjectListUpdate",path:["data","modules"],args:{key:"key",value:r}}}function T(e){const{pointer:t,module:r}=e;return{pointer:t,command:"keyedObjectListRemove",path:["data","modules"],args:{key:"key",remove:r}}}function _(e){const{pointer:t,functionPointer:r}=e;return{pointer:t,command:"keyedObjectListUpdate",path:["data","functionPointers"],args:{key:"id",value:r}}}function I(e){const{pointer:t,trigger:r}=e;return{pointer:t,command:"keyedObjectListUpdate",path:["data","triggers"],args:{key:"key",value:r}}}function M(e){const{pointer:t,triggers:r}=e;return{pointer:t,command:"set",path:["data","triggers"],args:r}}function K(e){const{pointer:t,configVariable:r}=e;return{pointer:t,command:"update",path:["data","configVariables",r.key],args:r}}},166442:(e,t,r)=>{"use strict";r.d(t,{Kd:()=>u});var i=()=>r(757695);const n={acceptedInferenceKeys:[],inferenceKeysToAnnotations:{},inferenceKeysToMemories:{},tags:[],abortController:void 0,stopInferencePromise:void 0,temporarySteps:[],inferences:[],traceId:void 0,requestInfo:void 0,loading:!1};class o extends i().default{getInitialState(){return n}resetState(){var e;null===(e=this.state.abortController)||void 0===e||e.abort(),this.setState(n)}}const a={type:"search",scopeForNextSearch:{type:"everything"}};class s extends i().default{getInitialState(){const e=r(17022).A.withListenerIgnored((()=>r(508496).default.checkGate({gateName:"workflows_inference_replay"})));return{showHistory:!1,showDebug:!1,loading:!1,configForNewTranscripts:a,userSelectedConfig:void 0,agentModelConfig:void 0,model:void 0,debugOverrides:{usePromptCache:e?"s3":void 0},threadRegistry:{},isAIChatTranscriptSidePanelVisible:!1}}getClientAIChatThreadStore(e){if(!this.state.threadRegistry[e]){const t=new o;return this.setState({...this.state,threadRegistry:{...this.state.threadRegistry,[e]:t}}),t}return this.state.threadRegistry[e]}}const u=new s},181856:(e,t,r)=>{"use strict";r.d(t,{Dp:()=>M,GW:()=>u,HQ:()=>s,LN:()=>a,N8:()=>k,Qv:()=>T,RR:()=>c,S2:()=>C,SX:()=>m,TP:()=>S,Te:()=>n,Uc:()=>_,af:()=>O,bV:()=>K,dO:()=>h,gJ:()=>p,js:()=>I,kT:()=>N,nB:()=>d,nD:()=>x,oN:()=>b,oS:()=>v,qW:()=>y,u7:()=>q,w5:()=>f,wL:()=>o,xU:()=>g,yc:()=>l,yd:()=>w});r(16280),r(581454);var i=()=>r(534177);class n extends Error{constructor(e,t,r){super(t),this.type=e,this.cause=r}getMetadata(){}}class o extends n{}class a extends o{constructor(e){let t=1===e.attributeNames.length?`Unexpected attribute for <${e.tagName}> tag: ${e.attributeNames[0]}`:`Unexpected attributes for <${e.tagName}> tag: ${e.attributeNames.join(", ")}`;e.attributeNames.includes("key")&&(t+="\n\nThe key attribute is not needed. You should omit it."),super("unexpected_attributes",t)}}class s extends o{constructor(e){super("missing_attribute",`The <${e.tagName}> tag is missing a ${e.attributeName} attribute. It should be specified as <${e.tagName} ${e.attributeName}="...">`)}}class u extends o{constructor(e){super("bad_attribute",`Attempted to set attribute ${e.attributeName} on a <${e.tagName}> tag to a value that is not allowed: ${e.receivedValue}`)}}class c extends o{constructor(e){const{tagName:t,unexpectedNode:r}=e;let i;i=r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag. Make sure not to include any extra whitespace or newlines in your XML.`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag`:`Encountered an invalid child inside a <${t}> tag.`,"set-title"===t||"set-property"===t?i+=`\nOnly inline elements and text are allowed inside <${t}>`:"insert-before"===t||"insert-after"===t||"insert-inside"===t||"chat"===t?(i+=`\nOnly block elements are allowed inside <${t}>`,"chat"===t&&(i+="\nWhen using <chat>, remember to wrap text in <text> tags.")):"create"===t&&(i+="\nWhen using <create>, remember to wrap in a <page> tag."),super("disallowed_child",i),this.tagName=void 0,this.unexpectedNode=void 0,this.tagName=t,this.unexpectedNode=r}}class d extends o{constructor(e){const{tagName:t,unexpectedNode:r,conditionName:i,cause:n}=e;super("disallowed_child_in_condition",r?"text"===r.type?`Plain text, whitespace, or newlines are not allowed inside a <${t}> tag with "${i}" condition`:`A <${r.tagName}> tag is not allowed inside a <${t}> tag with "${i}" condition`:`Encountered an invalid child inside a <${t}> tag with "${i}" condition`),this.cause=void 0,this.cause=n}}class p extends o{constructor(e){super("expected_tag_name",`Expected a <${e}> tag`)}}class l extends o{constructor(e){let t;(0,i().O9)(e.unexpectedNode)?"text"===e.unexpectedNode.type?t=`Text is not supported as a child for a ${e.nodeType} node`:"element"===e.unexpectedNode.type?t=`Unsupported ${e.nodeType} tag name: ${e.unexpectedNode.tagName}`:(0,i().HB)(e.unexpectedNode):t=`Unexpected value for a ${e.nodeType} node`,super("unsupported_node",t)}}class y extends o{constructor(e,t){super("unmapped_id",`Expected counter ID for attribute ${e}, instead received ${t}`)}}class g extends o{constructor(e){const{expectedIdType:t,receivedIdType:r,tagNameForErrorMessage:i,idValueForErrorMessage:n}=e;super("unexpected_id_type",i?`Expected ID ${n} in <${i}> to be of type '${t}', instead received ID of type '${r}'`:`Expected ID ${n} to be of type '${t}', instead received ID of type '${r}'`)}}class m extends o{constructor(e){super("out_of_order_node",`Encountered a ${e.foundNodeType} after a ${e.incorrectlyAfterType}. You should ensure that any ${e.foundNodeType}s come before ${e.incorrectlyAfterType}s.`)}}class h extends o{constructor(){super("table_row_property_name","Inside tr, the property-text name attribute must be a string which is an integer counter, starting from 1.")}}class f extends o{constructor(){super("synced_block_invalid_children","Cannot include content when writing a <synced-block-reference> tag")}}class b extends o{constructor(){super("must_provide_id","Block node is missing an id attribute")}}class v extends o{constructor(){super("cannot_provide_id","When creating new blocks, do not provide an id attribute.")}}class k extends o{constructor(){super("must_provide_unknown_block_id","When referencing unknown blocks, you must provide an id.")}}class w extends o{constructor(){super("cannot_append_to_multiple_properties","Cannot append to multiple properties. Use multiple calls to <insert-inside> instead.")}}class x extends o{constructor(){super("cannot_remove_from_multiple_properties","Cannot remove from multiple properties. Use multiple calls to <delete> instead.")}}class T extends o{constructor(){super("move_disallowed","A <move> tag is not allowed in this context")}}class _ extends o{constructor(){super("set_attribute_without_key","<set-attribute> is missing an attribute to set")}}class I extends o{constructor(e){super("invalid_query_condition",`<${e.tagName}> condition operator must be ${e.allowedOperators.map((e=>`"${e}"`)).join(" or ")}, not "${e.inputCondition}"`)}}class M extends o{constructor(e){super("children_required",`<${e.tagName}> must have children`)}}class K extends o{constructor(e){super("only_one_child_allowed",`Only one ${e} element is allowed`)}}class S extends o{constructor(e){super("unknown_api",`Unexpected API: ${e}. Make sure to use only the supported XML APIs, and ensure you are using this API in the right context.`)}}class q extends n{constructor(e,t){super("load_page_as_xml_failed",t),this.pageId=e}getMetadata(){return{pageId:this.pageId}}}class C extends n{constructor(e,t){super("load_database_as_xml_failed",t),this.databaseId=e}getMetadata(){return{databaseId:this.databaseId}}}class N extends n{constructor(){super("illegal_replace_page",'When calling <replace> on a page, you must provide a <page> tag as the single child, like this: <replace start="..." end="..."><page>...</page></replace>.')}}class O extends n{constructor(){super("out_of_order_replace","When calling <replace>, the start of the range must be AFTER the end of the range.")}}},242634:()=>{},252050:(e,t,r)=>{"use strict";r.d(t,{BP:()=>u,Bt:()=>c,F6:()=>d,Fu:()=>D,GU:()=>y,HV:()=>Y,L7:()=>A,MQ:()=>E,P8:()=>s,RD:()=>_,RI:()=>f,RW:()=>B,Su:()=>$,Tj:()=>V,U4:()=>m,VB:()=>N,Ve:()=>U,Y1:()=>F,_S:()=>l,aL:()=>L,ew:()=>q,g5:()=>Q,gc:()=>W,h5:()=>R,oK:()=>P,qI:()=>p,sA:()=>K,sW:()=>S,sk:()=>k,w3:()=>H,wn:()=>C,ye:()=>j,z5:()=>O});r(581454);var i=r.n(r(625473)),n=()=>r(498212),o=()=>r(534177),a=()=>r(206267);(0,o().u0)((e=>"element"===e.type?{true:e}:{false:e}));const s={default:"default",gray:"gray",brown:"brown",orange:"orange",yellow:"yellow",teal:"green",blue:"blue",purple:"purple",pink:"pink",red:"red",default_background:"default-background",gray_background:"gray-background",brown_background:"brown-background",orange_background:"orange-background",yellow_background:"yellow-background",teal_background:"green-background",blue_background:"blue-background",purple_background:"purple-background",pink_background:"pink-background",red_background:"red-background"},u=Object.fromEntries(Object.entries(s).map((e=>{let[t,r]=e;return[r,t]}))),c=Object.values(s),d=["mention-page","mention-database","mention-person","mention-assistant","mention-date","mention-datetime","mention-date-range","mention-datetime-range","mention-link"],p=["b","i","code","s","u","a","h","e",...d],l={b:{attributes:{},inline:p,text:!0,isToken:!1},i:{attributes:{},inline:p,text:!0,isToken:!1},code:{attributes:{},inline:p,text:!0,isToken:!1},s:{attributes:{},inline:p,text:!0,isToken:!1},u:{attributes:{},inline:p,text:!0,isToken:!1},a:{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context.",mappingMode:"href_counter"},type:{required:!1,values:r(972261).PI,description:"universal source type"},"external-id":{required:!1,values:!0,description:"ID for loadable external resource",mappingMode:"external_id_counter"}},inline:p,text:!0,isToken:!1},h:{attributes:{color:{required:!0,values:c,description:"text color"}},inline:p,text:!0,isToken:!1},e:{attributes:{equation:{required:!0,values:!0,description:"LaTeX equation string"}},inline:[],text:!0,isToken:!0},"mention-page":{attributes:{"page-id":{required:!0,values:!0,description:"ID of page",mappingMode:"block_counter"}},inline:[],text:!0,isToken:!0},"mention-link":{attributes:{href:{required:!0,values:!0,description:"link URL. Do not link to any URLs that are not already in the current context."},title:{required:!1,values:!0,description:"Linked page title"},icon_url:{required:!1,values:!0,description:"Favicon. Do not edit this field."},description:{required:!1,values:!0,description:"Linked page description. Do not edit this field."}},inline:[],text:!0,isToken:!0},"mention-database":{attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},inline:[],text:!0,isToken:!0},"mention-person":{attributes:{"person-id":{required:!0,values:!0,description:"ID of person",mappingMode:"person_counter"},"person-name":{required:!1,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"find-person":{attributes:{name:{required:!0,values:!0,description:"Name of person"}},inline:[],text:!0,isToken:!0},"mention-assistant":{attributes:{},inline:[],text:!0,isToken:!0},"mention-date":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime":{attributes:{date:{required:!0,values:!0,description:"Date in ISO 8601 (YYYY-MM-DD) format"},time:{required:!0,values:!0,description:"Time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},"mention-date-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"}},inline:[],text:!1,isToken:!1},"mention-datetime-range":{attributes:{"start-date":{required:!0,values:!0,description:"Start date in ISO 8601 (YYYY-MM-DD) format"},"end-date":{required:!0,values:!0,description:"End date in ISO 8601 (YYYY-MM-DD) format"},"start-time":{required:!0,values:!0,description:"Start time in ISO 8601 (HH:MM) format"},"end-time":{required:!0,values:!0,description:"End time in ISO 8601 (HH:MM) format"}},inline:[],text:!1,isToken:!1},option:{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:[],text:!1,isToken:!1},"schema-option":{attributes:{option:{values:!0,description:"Option name",required:!0}},inline:[],text:!1,isToken:!1},"schema-option-category":{attributes:{category:{values:!0,description:"Status category",required:!0}},inline:["schema-option"],text:!1,isToken:!1}},y={"property-title":{text:!0,inline:d,attributes:{}},"property-text":{text:!0,inline:p,attributes:{}},"property-url":{text:!0,inline:[],attributes:{}},"property-email":{text:!0,inline:[],attributes:{}},"property-phone-number":{text:!0,inline:[],attributes:{}},"property-person":{text:!1,inline:["mention-person","find-person"],attributes:{}},"property-date":{text:!1,inline:["mention-date","mention-date-range","mention-datetime","mention-datetime-range"],attributes:{}},"property-created-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-last-edited-time":{text:!1,inline:["mention-date","mention-datetime"],attributes:{}},"property-created-by":{text:!1,inline:["mention-person"],attributes:{}},"property-last-edited-by":{text:!1,inline:["mention-person"],attributes:{}},"property-checkbox":{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}},"property-select":{text:!1,inline:["option"],attributes:{}},"property-multi-select":{text:!1,inline:["option"],attributes:{}},"property-relation":{text:!1,inline:["mention-page"],attributes:{"database-id":{values:!0,description:"The database ID the relation points to",required:!1,mappingMode:"collection_counter"}}},"property-status":{text:!1,inline:["option"],attributes:{}},"property-number":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!1}}}},g=(0,o().uv)(y),m={"schema-property-title":{propertyTagName:"property-title",inline:[],attributes:{}},"schema-property-text":{propertyTagName:"property-text",inline:[],attributes:{}},"schema-property-url":{propertyTagName:"property-url",inline:[],attributes:{}},"schema-property-email":{propertyTagName:"property-email",inline:[],attributes:{}},"schema-property-phone-number":{propertyTagName:"property-phone-number",inline:[],attributes:{}},"schema-property-person":{propertyTagName:"property-person",inline:[],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0}}},"schema-property-date":{propertyTagName:"property-date",inline:[],attributes:{}},"schema-property-created-time":{propertyTagName:"property-created-time",inline:[],attributes:{}},"schema-property-last-edited-time":{propertyTagName:"property-last-edited-time",inline:[],attributes:{}},"schema-property-created-by":{propertyTagName:"property-created-by",inline:[],attributes:{}},"schema-property-last-edited-by":{propertyTagName:"property-last-edited-by",inline:[],attributes:{}},"schema-property-checkbox":{propertyTagName:"property-checkbox",inline:[],attributes:{}},"schema-property-select":{propertyTagName:"property-select",inline:["schema-option"],attributes:{}},"schema-property-multi-select":{propertyTagName:"property-multi-select",inline:["schema-option"],attributes:{}},"schema-property-relation":{propertyTagName:"property-relation",inline:["mention-page"],attributes:{limit:{values:["1","Infinity"],description:"The number of options that can be added",required:!0},"database-id":{values:!0,description:"The database ID the relation points to",required:!0,mappingMode:"collection_counter"},"synced-property-name":{required:!1,values:!0,description:"The symmetric relation property name in the database this relation points to"}}},"schema-property-status":{propertyTagName:"property-status",inline:["schema-option-category"],attributes:{}},"schema-property-number":{propertyTagName:"property-number",inline:[],attributes:{format:{values:!0,description:"Number format",required:!1}}}},h={is:{text:!1,inline:["mention-date"],attributes:{}},">":{text:!1,inline:["mention-date"],attributes:{}},"<":{text:!1,inline:["mention-date"],attributes:{}},"≥":{text:!1,inline:["mention-date"],attributes:{}},"≤":{text:!1,inline:["mention-date"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},f={"property-title":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-text":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-url":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-email":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-phone-number":{is:{text:!0,inline:[],attributes:{}},contains:{text:!0,inline:[],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-person":{contains:{text:!1,inline:["mention-person","find-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-date":h,"property-created-time":h,"property-last-edited-time":h,"property-created-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-last-edited-by":{contains:{text:!1,inline:["mention-person"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-checkbox":{is:{text:!1,inline:[],attributes:{checked:{values:["true","false"],description:'checked state, either "true" or "false"',required:!0}}}},"property-select":{is:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-multi-select":{contains:{text:!1,inline:["option"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-relation":{contains:{text:!1,inline:["mention-page"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-status":{is:{text:!1,inline:["option","option-category"],attributes:{}},"is empty":{text:!1,inline:[],attributes:{}}},"property-number":{is:{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},">":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"<":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≥":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"≤":{text:!1,inline:[],attributes:{number:{values:!0,description:"value",required:!0}}},"is empty":{text:!1,inline:[],attributes:{}}}},b=["Count all"],v=["Count values","Count unique values","Count empty","Count not empty","Percent empty","Percent not empty","Show unique values"],k={"Count all":"count","Count values":"count_values","Count unique values":"unique","Count empty":"empty","Count not empty":"not_empty","Percent empty":"percent_empty","Percent not empty":"percent_not_empty","Show unique values":"show_unique","Count checked":"checked","Count unchecked":"unchecked","Percent checked":"percent_checked","Percent unchecked":"percent_unchecked","Count per group":"count_per_group","Percent per group":"percent_per_group",Sum:"sum",Average:"average",Median:"median",Min:"min",Max:"max",Range:"range","Earliest date":"earliest_date","Latest date":"latest_date","Date range":"date_range"},w={basic:[...b,...v],date:[...b,...v,"Earliest date","Latest date","Date range"],status:[...b,...v,"Count per group","Percent per group"],number:[...b,...v,"Sum","Average","Median","Min","Max","Range"],checkbox:[...b,"Count checked","Count unchecked","Percent checked","Percent unchecked"]};function x(e){return`the name of the ${e} property being aggregated`}function T(e){return`the method of aggregation for the ${e} property`}const _={"aggregation-property-title":{attributes:{name:{required:!0,values:!0,description:x("title")},aggregation:{values:w.basic,required:!0,description:T("title")}}},"aggregation-property-text":{attributes:{name:{required:!0,values:!0,description:x("text")},aggregation:{values:w.basic,required:!0,description:T("text")}}},"aggregation-property-url":{attributes:{name:{required:!0,values:!0,description:x("url")},aggregation:{values:w.basic,required:!0,description:T("url")}}},"aggregation-property-email":{attributes:{name:{required:!0,values:!0,description:x("email")},aggregation:{values:w.basic,required:!0,description:T("email")}}},"aggregation-property-phone-number":{attributes:{name:{required:!0,values:!0,description:x("phone_number")},aggregation:{values:w.basic,required:!0,description:T("phone_number")}}},"aggregation-property-date":{attributes:{name:{values:!0,required:!0,description:x("date")},aggregation:{values:w.date,required:!0,description:T("date")}}},"aggregation-property-created-time":{attributes:{name:{values:!0,required:!0,description:x("created-time")},aggregation:{values:w.date,required:!0,description:T("created-time")}}},"aggregation-property-last-edited-time":{attributes:{name:{values:!0,required:!0,description:x("last-edited-time")},aggregation:{values:w.date,required:!0,description:T("last-edited-time")}}},"aggregation-property-person":{attributes:{name:{values:!0,required:!0,description:x("person")},aggregation:{values:w.basic,required:!0,description:T("person")}}},"aggregation-property-created-by":{attributes:{name:{values:!0,required:!0,description:x("created-by")},aggregation:{values:w.basic,required:!0,description:T("created-by")}}},"aggregation-property-last-edited-by":{attributes:{name:{values:!0,required:!0,description:x("last-edited-by")},aggregation:{values:w.basic,required:!0,description:T("last-edited-by")}}},"aggregation-property-checkbox":{attributes:{name:{values:!0,required:!0,description:x("checkbox")},aggregation:{values:w.checkbox,required:!0,description:T("checkbox")}}},"aggregation-property-select":{attributes:{name:{values:!0,required:!0,description:x("select")},aggregation:{values:w.basic,required:!0,description:T("select")}}},"aggregation-property-multi-select":{attributes:{name:{values:!0,required:!0,description:x("multi-select")},aggregation:{values:w.basic,required:!0,description:T("multi-select")}}},"aggregation-property-relation":{attributes:{name:{values:!0,required:!0,description:x("relation")},aggregation:{values:w.basic,required:!0,description:T("relation")}}},"aggregation-property-number":{attributes:{name:{values:!0,required:!0,description:x("number")},aggregation:{values:w.number,required:!0,description:T("number")}}},"aggregation-property-status":{attributes:{name:{values:!0,required:!0,description:x("status")},aggregation:{values:w.status,required:!0,description:T("status")},group:{values:!0,required:!0,description:"then name of the status group being aggregated when aggregation is 'Count per group' or 'Percent per group'. For other aggregations, just provide any group name."}}}},I=["hr","h1","h2","h3","database","math-block","code-block","child-page","link-page","child-database","link-database","database-views","text","page","synced-block","synced-block-reference","uli","oli","toggle","quote","callout","todo","columns","table","unknown-block"],M={required:!1,values:c,description:"color for the block"},K={hr:{title:!1,content:[],attributes:{},properties:[],schemas:[]},h1:{title:!0,content:[],attributes:{color:M},properties:[],schemas:[]},h2:{title:!0,content:[],attributes:{color:M},properties:[],schemas:[]},h3:{title:!0,content:[],attributes:{color:M},properties:[],schemas:[]},database:{title:!1,content:[],attributes:{},properties:["property-title"],schemas:g},"math-block":{title:!0,content:[],attributes:{},properties:[],schemas:[]},"code-block":{title:!0,content:[],attributes:{language:{required:!1,values:r(15440).yz,description:"language of code"}},properties:[],schemas:[]},"child-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"},"has-content":{required:!1,values:["true","false"],description:'"true" if the page has content, "false" otherwise'}},properties:g,schemas:[]},"link-page":{title:!1,content:[],attributes:{"page-id":{required:!0,values:!0,description:"ID of page, to be used in <load>",mappingMode:"block_counter"},"database-id":{required:!1,values:!0,description:"The ID of the database this page is within, if there is one",mappingMode:"collection_counter"}},properties:g,schemas:[]},"child-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database. Make sure to use the value of this attribute as the id in query-database.",mappingMode:"block_counter"}},properties:["property-title"],schemas:g},"database-views":{title:!1,content:[],attributes:{},properties:["property-title"],schemas:g},"link-database":{title:!1,content:[],attributes:{"database-id":{required:!0,values:!0,description:"ID of database",mappingMode:"collection_counter"}},properties:["property-title"],schemas:g},text:{title:!0,content:I,attributes:{color:M},properties:[],schemas:[]},page:{title:!1,content:I,attributes:{"database-id":{required:!1,values:!0,description:"ID of the database this page belongs to. Use this to look up the schema for the page",mappingMode:"collection_counter"},"page-font":{required:!1,values:["default","serif","mono"],description:"Font used for the page"},"page-width":{required:!1,values:["default","full-width"],description:"Width of the page"},"page-font-size":{required:!1,values:["default","small"],description:"Font size for the page"}},properties:g,schemas:[]},uli:{title:!0,content:I,attributes:{color:M},properties:[],schemas:[]},oli:{title:!0,content:I,attributes:{color:M,index:{required:!1,values:!0,description:"Specify a custom index for the list item"}},properties:[],schemas:[]},toggle:{title:!0,content:I,attributes:{color:M,size:{required:!1,values:["h1","h2","h3"],description:"size of the toggle header, if the toggle is a header"}},properties:[],schemas:[]},quote:{title:!0,content:I,attributes:{color:M},properties:[],schemas:[]},todo:{title:!0,content:I,attributes:{checked:{required:!0,values:["true","false"],description:'checked state, either "true" or "false"'},color:M},properties:[],schemas:[]},callout:{title:!0,content:I,attributes:{color:M},properties:[],schemas:[]},"synced-block":{title:!1,content:I,attributes:{},properties:[],schemas:[]},"synced-block-reference":{title:!1,content:I,attributes:{"synced-block-id":{required:!0,values:!0,description:"The ID of the <synced-block> node that this references",mappingMode:"block_counter"}},properties:[],schemas:[]},columns:{title:!1,content:["column"],attributes:{},properties:[],schemas:[]},column:{title:!1,content:I,attributes:{},properties:[],schemas:[]},table:{title:!1,content:["tr"],attributes:{"header-row":{required:!1,values:["true","false"],description:'whether first <tr> is row header, either "true" or "false"'},"header-column":{required:!1,values:["true","false"],description:'whether first <td> in every <tr> is column header, either "true" or "false"'}},properties:[],schemas:["property-text"]},tr:{title:!1,content:[],attributes:{},properties:["property-text"],schemas:[]},"ai-block":{title:!0,content:I,attributes:{},properties:["property-text"],schemas:[]},transcript:{title:!0,content:I,attributes:{},properties:[],schemas:[]},"unknown-block":{title:!0,content:I,attributes:{type:{required:!1,values:Object.values(r(700500).xd),description:"the type of the unknown block"}},properties:[],schemas:[]}},S=Object.freeze((0,o().uv)({text:!0,toggle:!0,quote:!0,callout:!0,uli:!0,oli:!0,todo:!0,h1:!0,h2:!0,h3:!0}));function q(e){return e}function C(e){return e}function N(e){return e}function O(e){return e}function $(e){return e}function E(e){return e}function D(e){return e}function V(e){return e}function P(e){return e}function j(e){return e}function A(e){return e}function R(e){return e}function H(e){return e}function B(e){return e}function U(e){return e}function F(){return a().JW()}function L(e){return(0,n().gB)(i()(e))}const W=(0,o().u0)((e=>"collectionView"===e.type?{true:e}:{false:e})),Y="search-notion-help",Q=(0,o().u0)((e=>"synced-block-reference"===e||"ai-block"===e||"database-views"===e||"transcript"===e?{true:e}:{false:e}))},255299:(e,t,r)=>{"use strict";r.d(t,{A3:()=>p,Ft:()=>k,Hg:()=>d,JD:()=>g,Jz:()=>v,Ns:()=>m,Pp:()=>x,_R:()=>h,fO:()=>l,l0:()=>w,nZ:()=>y,o6:()=>b,tC:()=>f});r(410838),r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520),r(672577),r(430670),r(581454);var i=()=>r(584262),n=()=>r(919709),o=()=>r(496603),a=()=>r(534177),s=()=>r(492414),u=()=>r(148832),c=()=>r(915189);function d(e,t){if(!t)return{cachedInferences:[],annotationInferences:[]};const{inferences:r,inferenceKeysToAnnotations:i,acceptedInferenceKeys:n}=e.getClientAIChatThreadStore(t).state,a=new Map;for(const o of r)a.set(o.key,o);return{cachedInferences:o().oE(n.map((e=>a.get(e)))),annotationInferences:o().oE(Object.entries(i).map((e=>{let[t,r]=e;const i=a.get(t);if(i)return{...i,value:{...i.value,input:{...i.value.input,annotation:r}}}})))}}function p(e){const{clientStore:t,threadStore:r}=e,i=null==r?void 0:r.id;if(!i)return[];const n=((null==r?void 0:r.getMessageStores())??[]).map((e=>e.getStep())).filter(a().O9)??[],o=new Set(n.map((e=>e.id))),s=t.getClientAIChatThreadStore(i).state.temporarySteps;return[...n.map((e=>s.find((t=>t.id===e.id))??e)),...s.filter((e=>!o.has(e.id)))].filter((e=>"title"!==e.type))}function l(e){var t;return"search"===(null===(t=e.find((e=>"config"===e.type)))||void 0===t?void 0:t.value.type)}function y(e){const t=e.find((e=>"user"===e.type)),r=t?e.indexOf(t):-1;return o().oE(e.map(((e,t)=>{if("context"!==e.type&&t!==r)return e})))}function g(e){const t=e.find((e=>"config"===e.type));if(t)return t.value}function m(e){return g(e?e.getTranscript():[])}function h(e,t){const r=t.findIndex((t=>t.id===e.id));if(-1!==r)return t.slice(0,r).findLast((e=>"user"===e.type))}function f(e){return"helpdocs"===e?"helpdoc":"microsoftTeams"!==e&&"linear"!==e&&e?e:"all"}function b(e){const{searchStep:t,spaceStore:r,environment:o,traceId:d}=e;return e=>{if(!r)return{annotations:[e],status:"missing_citation"};if("resultsComplete"!==(null==t?void 0:t.status)&&"resultsBlended"!==(null==t?void 0:t.status))return{annotations:[e],status:"missing_citation"};const p=Object.entries(t.results).flatMap((e=>{let[t,r]=e;return r.map(((e,t)=>({...e,position:t})))}));return function(e){let{linkAnnotation:t,getRenderableSearchResultAndPositionById:r,environment:o}=e;const c=n().cQR(t);if(!c)return{annotations:[t],status:"other_link"};const d=c.indexOf("#citation:");if(-1===d)return{annotations:[t],status:"other_link"};const p=r(decodeURIComponent(c.slice(d+10)));return p?{annotations:[function(e){const t={resultId:e.id,positionWithinSource:e.positionWithinSource,traceId:e.traceId};return"notion"===e.type?n().X$({...t,href:(0,s().J8)({store:new(u().B)(o,{table:"block",id:e.id}),fullyQualified:!1,pageVisitSource:i().y8.AIQna}),blockId:e.id,type:"block"}):"slack"===e.type?n().X$({...t,href:e.href,threadHref:e.href,type:"slack",domain:e.domain,baseUrl:e.baseUrl,channelId:e.channelId,messageId:e.messageId,threadTs:e.threadTs}):"google-drive"===e.type?n().X$({...t,href:e.href,type:"google-drive",messageId:e.id,url:e.url}):"github"===e.type?n().X$({...t,href:e.href,type:"github",messageId:e.id,url:e.url}):"jira"===e.type?n().X$({...t,href:e.href,type:"jira",messageId:e.id,url:e.url}):"webpage"===e.type?n().X$({...t,href:e.href,type:"webpage",url:(null==e?void 0:e.url)||""}):"helpdoc-section"===e.type?n().X$({...t,type:"helpdoc-section",href:e.href,url:e.url,parentPageHref:e.parentPageHref}):"helpdocs"===e.type?n().X$({...t,type:"helpdoc",href:e.href,url:e.url}):"gmail"===e.type?n().X$({type:"gmail",href:e.href,url:e.url,messageId:e.id}):void(0,a().HB)(e)}(p)],status:"citation"}:{annotations:[t],status:"missing_citation"}}({linkAnnotation:e,getRenderableSearchResultAndPositionById:e=>{const t=p.find((t=>decodeURIComponent(t.key)===e));if(!t)return;const i=(0,c().K)(t.result,r);return i?{...i,positionWithinSource:t.position,traceId:d}:void 0},environment:o})}}function v(e){return e.replace(/\[\]\((.*?)\)/g,((e,t)=>`[citation](#citation:${t})`))}function k(e){let{clientStore:t,threadStore:r}=e;return Boolean(void 0!==(null==r?void 0:r.getCurrentInferenceId())||(null==r?void 0:r.id)&&t.getClientAIChatThreadStore(r.id).state.loading)}function w(e){return"resultsBlended"===e.status||"resultsComplete"===e.status||"resultsPartial"===e.status||"generatingQuery"!==e.status&&"searching"!==e.status&&void(0,a().HB)(e)}function x(e){return"resultsComplete"===e.status||"resultsBlended"===e.status||"resultsPartial"!==e.status&&"generatingQuery"!==e.status&&"searching"!==e.status&&void(0,a().HB)(e)}},550622:(e,t,r)=>{"use strict";r.d(t,{av:()=>u,rE:()=>d,sL:()=>c});r(813451),r(898992),r(354520),r(581454),r(737550);var i=()=>r(943387),n=()=>r(351028),o=()=>r(388821),a=()=>r(179034),s=()=>r(743246);function u(e){return"agent-tool-result"===e.type&&"view"===e.toolName&&(e.toolName,!0)}function c(e){var t;const{transcript:r,pageOrAppId:a,additionalThreadOperations:s}=e,c=r.findLastIndex((e=>u(e)&&e.result&&e.result.entities.some((e=>("app"===e.type||"page"===e.type)&&e.id===a)))),d=r[c],p=d&&u(d)?o().RecordMap.create(null===(t=d.result)||void 0===t?void 0:t.recordMap):o().RecordMap.create({}),l=[...(0,i().XY)(c>=0?r.slice(c):r),...s??[]].filter((e=>"reject"!==e.userAction)).map((e=>e.operation));return(0,n().applyOperationsToRecordMap)({recordMap:p,operations:l,updateOnly:!1}),p}function d(e){const{transcript:t,spaceId:r,appId:i,additionalThreadOperations:n}=e,o=c({transcript:t,pageOrAppId:i,additionalThreadOperations:n}),u=function(e){var t;const{recordMap:r,appId:i,spaceId:n}=e,o={table:a().ev,id:i,spaceId:n},u=r.getModel(o),c=null==u||null===(t=u.getFormat())||void 0===t?void 0:t.workflow_id;if(!c)return;const d={table:s().C0,id:c,spaceId:n},p=r.getModel(d),l=null==p?void 0:p.getData();return l&&p?{workflow:l,workflowModel:p}:void 0}({recordMap:o,appId:i,spaceId:r});if(u)return{...u,recordMap:o}}},564037:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getCurrentWorkflowNavigationState:()=>x,getDefaultClosedNavigationState:()=>b,getDefaultOpenNavigationState:()=>f,getIsWorkflowEditorOpen:()=>k,getIsWorkflowEditorStateOpen:()=>v,getIsWorkflowNavigationStateCurrent:()=>w,getMergedWorkflowNavigationState:()=>T,routeArgsGivenNavigationState:()=>_,useIsWorkflowEditorOpen:()=>M,useWorkflowNavigationState:()=>I});var i=()=>r(484714),n=()=>r(847249),o=()=>r(496603),a=()=>r(498212),s=()=>r(534177),u=()=>r(671593),c=()=>r(638681),d=()=>r(351360),p=()=>r(46986);const l=c().object({required:{isOpen:c().literal(!0)},optional:{}}),y={configure:c().intersection([l,c().object({required:{type:c().literal("configure")},optional:{prompt:c().string()}})]),function:c().intersection([l,c().object({required:{type:c().literal("function"),key:c().string()},optional:{}})]),module:c().intersection([l,c().object({required:{type:c().literal("module"),key:c().string()},optional:{}})]),trigger:c().intersection([l,c().object({required:{type:c().literal("trigger"),key:c().string()},optional:{}})]),debug:c().intersection([l,c().object({required:{type:c().literal("debug")},optional:{}})]),preview:c().intersection([l,c().object({required:{type:c().literal("preview")},optional:{collectionViewId:c().string()}})]),runtime_actor:c().intersection([l,c().object({required:{type:c().literal("runtime_actor")},optional:{}})]),view_settings:c().intersection([l,c().object({required:{type:c().literal("view_settings"),key:c().string()},optional:{}})]),view:c().intersection([l,c().object({required:{type:c().literal("view"),key:c().string()},optional:{}})]),runs:c().intersection([l,c().object({required:{type:c().literal("runs")},optional:{runId:c().string()}})]),test:c().intersection([l,c().object({required:{type:c().literal("test"),name:c().string(),functionKey:c().string()},optional:{}})])},g=c().union(Object.values(y)),m=c().object({required:{isOpen:c().literal(!1)},optional:{}}),h=c().union([g,m]);function f(){return{isOpen:!0,type:"configure"}}function b(){return{isOpen:!1}}function v(e){return(null==e?void 0:e.isOpen)??!1}function k(e){return v(x(e))}function w(e){const{currentNavigationState:t,navigationState:r}=e,i=T({defaultNavigationState:{isOpen:!1},currentNavigationState:t,newNavigationState:r});return(0,o().n4)(t,i)}function x(e){const{RouterStore:t}=e;if("page"!==t.state.route.name)return;const r=d().default.state.mainEditorCurrentBlockStore;return r&&r.isCollectionView()&&r.canEdit()&&!r.isLocked()?function(e){const{workflowViewType:t,workflowViewKey:r,workflowPrompt:i,collectionViewId:n}=e;switch(t){case"debug":case"runtime_actor":return{isOpen:!0,type:t};case"function":case"module":case"trigger":case"view_settings":case"view":if(!r)return;return{isOpen:!0,type:t,key:r};case"preview":return{isOpen:!0,type:"preview",collectionViewId:n};case"configure":return{isOpen:!0,type:"configure",prompt:i?decodeURIComponent(i):void 0};case"runs":return{isOpen:!0,type:"runs",runId:(0,a().ZA)(r)};case"test":if(!r)return;const[e,o]=r.split(",");if(!e||!o)return;return{isOpen:!0,type:"test",name:o,functionKey:e};default:return}}(t.state.route):void 0}function T(e){const{defaultNavigationState:t,currentNavigationState:r,newNavigationState:i}=e;if(!(0,p().sx)())return{isOpen:!1};const n={...t};if(r)for(const[a,s]of Object.entries(r))n[a]=s;if(i)for(const[a,s]of Object.entries(i))n[a]=s;const o=(0,u().tf)(h,n);if(o)throw o;return n}function _(e){if(!e.isOpen)return{workflowViewType:void 0,workflowViewKey:void 0,collectionViewId:void 0};const t=e.type,r={};switch(t){case"configure":case"debug":case"runtime_actor":return{...r,workflowViewType:t,workflowViewKey:void 0};case"function":case"module":case"trigger":case"view_settings":case"view":return{...r,workflowViewType:t,workflowViewKey:e.key};case"runs":return{...r,workflowViewType:t,workflowViewKey:e.runId};case"test":return{...r,workflowViewType:t,workflowViewKey:`${e.functionKey},${e.name}`};case"preview":return{...r,workflowViewType:"preview",collectionViewId:e.collectionViewId};default:(0,s().HB)(t)}}function I(){const e=(0,i().v3)();return(0,n().K8)((()=>x(e)??{isOpen:!1}),[e])}function M(){const e=(0,i().v3)();return(0,n().K8)((()=>k(e)),[e])}},724639:(e,t,r)=>{"use strict";r.d(t,{$A:()=>l,P0:()=>g,S7:()=>m,VB:()=>y,kI:()=>h,nh:()=>p});r(898992),r(354520),r(672577),r(581454),r(814603),r(147566),r(198721);var i=r.n(r(625473)),n=()=>r(534177),o=()=>r(638681),a=()=>r(206267),s=()=>r(234459),u=()=>r(743246),c=()=>r(185864);const d="/workflows/oauth/connect";function p(e,t){const r=Object.fromEntries(Object.entries(e).filter((e=>{let[t,r]=e;return Boolean(r)})));return`${t}${d}?${new URLSearchParams(r).toString()}`}o().object({required:{moduleType:o().literals(...Object.keys(c().Nh)),moduleKey:o().string(),spaceId:o().string()},optional:{redirectToAuth:o().literal("true"),transcriptId:o().string(),workflowId:o().string(),moduleSpecific:o().string(),callbackType:o().literals(...r(861017).Bi)}});function l(e){const t={...e};delete t.examples,delete t.memories,delete t.annotation,"transcript"in e&&Array.isArray(e.transcript)&&(t.transcript=e.transcript.map((e=>({...e,id:void 0,traceId:void 0}))));const r=(n=t,i()(n,o?{space:"  "}:void 0));var n,o;return(0,a().gB)(r)}function y(e,t){var r,i,n;const o=null==t||null===(r=t.modules)||void 0===r?void 0:r.find((t=>t.key===e.moduleKey));if(!o||null===(i=e.state)||void 0===i||!i.type)return!1;const a=null===(n=c().Nh[o.type].triggers[e.state.type])||void 0===n?void 0:n.isTriggerConfigured;return!a||a(e.state)}function g(e){return"workflow-operation"===(null==e?void 0:e.type)||"workflow-user-structured-information"===(null==e?void 0:e.type)}function m(e){return"workflow"===e.type}function h(e){const{spaceId:t,id:r,table:i}=e;return i===u().C0?{spaceId:t,workflowId:r}:i===s().To?{spaceId:t,transcriptId:r}:void(0,n().HB)(i)}},832443:(e,t,r)=>{"use strict";r.d(t,{D4:()=>l,L1:()=>y,OU:()=>g,V6:()=>m,tD:()=>h});r(16280),r(944114),r(581454),r(814603),r(147566),r(198721);var i=r.n(r(625473)),n=()=>r(496603),o=()=>r(973647),a=()=>r(534177),s=()=>r(939768),u=()=>r(181856),c=()=>r(252050);function d(e){if(!(32===e.length&&/^[a-f0-9]*$/g.test(e)))return;return[e.substring(0,8),e.substring(8,12),e.substring(12,16),e.substring(16,20),e.substring(20,32)].join("-")}const p=/^\d+$/,l=(0,a().u0)((e=>p.test(e)?{true:e}:{false:e}));function y(e){try{const t=new URL(e),r=t.searchParams.get("domain")||void 0,i=t.searchParams.get("base_url")||void 0,n=t.searchParams.get("channel_id"),o=t.searchParams.get("message_id"),a=t.searchParams.get("thread_ts")||void 0;if(!r&&!i||!n||!o)return;return{domain:r,baseUrl:i,channelId:n,messageId:o,threadTs:a}}catch(t){return}}function g(e){try{const t=new URL(e).searchParams.get("url");if(!t)return;return{url:t}}catch(t){return}}class m extends Error{constructor(e){super(`Tried to use an ID that doesn't exist: ${e}`)}}class h{generateSerializedKey(e){return i()(e)}constructor(e){if(this.counter=0,this.keyToCounterMap=new Map,this.counterToKeyMap=new Map,this.mapCounterToKeyInModeOrThrow=(e,t,r)=>o().Q.unwrap(this.mapCounterToKeyInMode(e,t,r)),this.mapCounterToKeyInMode=(e,t,r)=>h.mapCounterToKeyInMode(this,e,t,r),this.utilitiesForTests={removeKey:this.removeKey.bind(this),setCounterValueForKey:this.setCounterValueForKey.bind(this)},e){const t=[];for(const{key:i,counter:n}of e.keyMap)this.keyToCounterMap.set(this.generateSerializedKey(i),n),this.counterToKeyMap.set(n,i),t.push(parseInt(n));const r=n().T9(t);this.counter="number"==typeof r?r+1:0}}serialize(){return{keyMap:Array.from(this.counterToKeyMap.entries()).map((e=>{let[t,r]=e;return{key:n().mg(r),counter:t}}))}}inheritFrom(e){for(const[t,r]of e.keyToCounterMap.entries())this.keyToCounterMap.set(t,r);for(const[t,r]of e.counterToKeyMap.entries())this.counterToKeyMap.set(t,r)}mapKeyToCounter(e){const t=this.generateSerializedKey(e);if(!this.keyToCounterMap.has(t)){const r=this.counter.toString();this.keyToCounterMap.set(t,r),this.counterToKeyMap.set(r,e),this.counter++}return this.keyToCounterMap.get(t)}mapNodeKeyToCounter(e){if("block"===e.type){const t={...e},r=this.mapNodeAttributesKeyToCounter(e.attributes);t.attributes=r;const i=e.text.map((e=>this.mapNodeKeyToCounter(e)));t.text=i;const n=e.children.map((e=>{const r=this.mapNodeKeyToCounter(e);return r.parent=t,r}));t.children=n;const o={};for(const[e,u]of Object.entries(t.properties))o[e]=this.mapNodeKeyToCounter(u);t.properties=o;const a={};for(const[e,u]of Object.entries(t.schemas))a[e]=this.mapNodeKeyToCounter(u);t.schemas=a;const s=this.mapKeyToCounter({key:e.schemaId,type:"block"});return t.schemaId=s,t}if("property"===e.type||"schema"===e.type||"inline"===e.type){const t={...e};return t.attributes=this.mapNodeAttributesKeyToCounter(t.attributes),t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("instructions"===e.type){const t={...e};return t.children=t.children.map((e=>this.mapNodeKeyToCounter(e))),t}if("text"===e.type)return{...e};if("collection"===e.type){const t={...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection",key:e.attributes.id})}},r=Object.fromEntries(Object.entries(t.properties).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));t.properties=r;const i=Object.fromEntries(Object.entries(t.schemas).map((e=>{let[t,r]=e;return[t,this.mapNodeKeyToCounter(r)]})));return t.schemas=i,t}if("collectionView"===e.type)return{...e,schemaId:this.mapKeyToCounter({type:"block",key:e.schemaId}),attributes:{...e.attributes,id:this.mapKeyToCounter({type:"collection-view",key:e.attributes.id}),"database-id":this.mapKeyToCounter({type:"collection",key:e.attributes["database-id"]})}};if("slackMessages"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"universal",key:e.attributes.id})}}}if("attachment"===e.type){return{...e,attributes:{...e.attributes,id:this.mapKeyToCounter({type:"attachment",key:e.attributes.id,attachmentType:e.attributes.attachmentType})}}}throw new Error(`Unknown node type ${e}`)}mapNodeAttributesKeyToCounter(e){if(!e)return e;const t={...e};for(const[i,n]of Object.entries(h.attributesToMap)){if(!n)continue;const e=t[i];if(e)if("href"===i){let n;const o=s().qg(e),a=s().Jf({str:o.href,allowNoProtocol:!0});a&&(n=(0,r(777447).lX)({url:a,baseUrl:o.protocol?`${o.protocol}//${o.host}`:`https://${o.host??"www.notion.so"}`,publicDomainName:o.host??"www.notion.so"})),t[i]=n?this.mapKeyToCounter({type:"block",key:n}):e}else t[i]="person-id"===i?this.mapKeyToCounter({type:"person",key:e}):"database-id"===i?this.mapKeyToCounter({type:"collection",key:e}):this.mapKeyToCounter({type:"block",key:e})}return t}doesIdMapperContainMappedKey(e){return this.counterToKeyMap.has(e)}doesIdMapperContainKey(e){return this.keyToCounterMap.has(this.generateSerializedKey(e))}getIdForMappedKeyIfExists(e){const t=this.counterToKeyMap.get(e);return null==t?void 0:t.key}mapCounterToKey(e){const t=this.counterToKeyMap.get(e);if(!t)throw new m(e);return t}mapAssistantContextCounterToKey(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":i,"current-background-page-id":n,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapCounterToKeyInModeOrThrow(e["instructions-page-id"],"block_counter")}:{},...e["current-page-id"]?{"current-page-id":this.mapCounterToKeyInModeOrThrow(e["current-page-id"],"block_counter")}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapCounterToKeyInModeOrThrow(e["current-background-page-id"],"block_counter")}:{},...e["current-thread-id"]?{"current-thread-id":this.mapCounterToKeyInModeOrThrow(e["current-thread-id"],"thread_counter")}:{},...e["current-person-id"]?{"current-person-id":this.mapCounterToKeyInModeOrThrow(e["current-person-id"],"person_counter")}:{}}}mapAssistantContextKeyToCounter(e){const{"instructions-page-id":t,"current-page-id":r,"current-person-id":i,"current-background-page-id":n,...o}=e;return{...o,...e["instructions-page-id"]?{"instructions-page-id":this.mapKeyToCounter({type:"block",key:e["instructions-page-id"]})}:{},...e["current-page-id"]?{"current-page-id":this.mapKeyToCounter({type:"block",key:e["current-page-id"]})}:{},...e["current-background-page-id"]?{"current-background-page-id":this.mapKeyToCounter({type:"block",key:e["current-background-page-id"]})}:{},...e["current-thread-id"]?{"current-thread-id":this.mapKeyToCounter({type:"slack-thread",key:e["current-thread-id"]})}:{},...e["current-person-id"]?{"current-person-id":this.mapKeyToCounter({type:"person",key:e["current-person-id"]})}:{}}}mapAssistantSelectionKeyToCounter(e){return"block"===e.type?{type:"block",blockIds:e.blockIds.map((e=>this.mapKeyToCounter({type:"block",key:e})))}:"text"===e.type?{type:"text",start:{...e.start,blockId:this.mapKeyToCounter({type:"block",key:e.start.blockId})},end:{...e.end,blockId:this.mapKeyToCounter({type:"block",key:e.end.blockId})}}:void(0,a().HB)(e)}static mapCounterToKeyInMode(e,t,r,i){if("block_counter"===r||"person_counter"===r||"thread_counter"===r||"collection_counter"===r||"collection_view_counter"===r||"query_database_result_counter"===r||"external_id_counter"===r||"attachment_id_counter"===r){const n=(0,o().j)((()=>e.mapCounterToKey(t)));if(o().Q.isFail(n))return n;const s=n.value;let c;return"block_counter"===r?c="block":"person_counter"===r?c="person":"thread_counter"===r?c="slack-thread":"collection_counter"===r?c="collection":"collection_view_counter"===r?c="collection-view":"query_database_result_counter"===r?c="query-database-result":"external_id_counter"===r?c="universal":"attachment_id_counter"===r?c="attachment":(0,a().HB)(r),s.type!==c?{error:new(u().xU)({receivedIdType:s.type,expectedIdType:c,tagNameForErrorMessage:i,idValueForErrorMessage:t})}:{value:s.key}}if("href_counter"===r){const r=h.getMappedTypeFromCounterIfExists(t,e);return"query-database-result"===r?{error:new(u().xU)({receivedIdType:r,expectedIdType:"href",tagNameForErrorMessage:i,idValueForErrorMessage:t})}:{value:h.mapHrefCounterToUrl(e,t)}}(0,a().HB)(r)}getTypeKeyFromCounter(e){return h.getMappedTypeFromCounterIfExists(e,this)}static getMappedTypeFromCounterIfExists(e,t){let r;try{r=t.mapCounterToKey(e)}catch(i){if(i instanceof m)return;throw i}return r.type}static blockKeyToHref(e){return`/${e.key.split("/")[0].replaceAll("-","")}`}static blockIdToHref(e){return`/${e.split("/")[0].replaceAll("-","")}`}static parseAssistantHref(e){if(e===h.EMPTY_HREF)return{type:"citation_unsupported"};if(function(e){return e.startsWith("query_database_result_counter://")}(e)){const t=h.databaseQueryHrefToDatabaseQueryResultsId(e);if(t)return{type:"database_query_results",id:t}}else if(function(e){return e.startsWith("slack://")}(e)){const t=y(e);if(t)return{type:"slack",href:(0,c().Su)(e),...t}}else if(function(e){return e.startsWith("google-drive://")}(e)){const t=g(e);if(t)return{type:"google-drive",href:(0,c().Fu)(e),...t}}else if(function(e){return e.startsWith("sharepoint://")}(e)){const t=g(e);if(t)return{type:"sharepoint",href:(0,c().L7)(e),...t}}else if(function(e){return e.startsWith("webpage://")}(e)){const t=g(e);if(t)return{type:"webpage",href:(0,c().RW)(e),...t}}else if(function(e){return e.startsWith("helpdoc://")&&!e.includes("%23")}(e)){const t=g(e);if(t)return{type:"helpdoc",href:(0,c().h5)(e),...t}}else if(function(e){return e.startsWith("helpdoc://")&&e.includes("%23")}(e)){const t=g(e);if(t){const r=(0,c().h5)(e.split("%23")[0]);return{type:"helpdoc-section",href:(0,c().w3)(e),parentPageHref:r,...t}}}else if(function(e){return e.startsWith("github://")}(e)){const t=g(e);if(t)return{type:"github",href:(0,c().Tj)(e),...t}}else if(function(e){return e.startsWith("gmail://")}(e)){const t=g(e);if(t)return{type:"gmail",href:(0,c().oK)(e),...t}}else if(function(e){return e.startsWith("jira://")}(e)){const t=g(e);if(t)return{type:"jira",href:(0,c().MQ)(e),...t}}else if(function(e){return e.startsWith("microsoftTeams://")}(e)){const t=function(e){try{const t=new URL(e).searchParams,r=t.get("url"),i=t.get("message_type"),n=t.get("message_id"),o=t.get("channel_id"),a=t.get("thread_ts")||void 0;if(!(r&&o&&n&&i))return;return{url:r,channelId:o,threadTs:a,messageId:n,messageType:i}}catch(t){return}}(e);if(t)return{type:"microsoftTeams",href:(0,c().ye)(e),...t}}else{const t=h.blockHrefToAssistantBlockId(e);if(t)return{type:"block",blockId:t}}}static databaseQueryHrefToDatabaseQueryResultsId(e){var t;const r=null===(t=e.match(/^query_database_result_counter:\/\/(.+)$/))||void 0===t?void 0:t[1];return r&&d(r)}static blockHrefToAssistantBlockId(e){var t;const r=null===(t=e.match(/\/(.+)/))||void 0===t?void 0:t[1];return r?d(r):void 0}static mapHrefCounterToUrl(e,t){let r;try{r=e.mapCounterToKey(t)}catch(i){if(i instanceof m)return t;throw i}if("block"===r.type)return h.blockKeyToHref(r);if("url"===r.type||"slack-message"===r.type||"slack-thread"===r.type||"webpage"===r.type||"gmail"===r.type||"helpdoc"===r.type||"helpdoc-section"===r.type||"google-drive"===r.type||"github"===r.type||"microsoft-teams-message"===r.type||"microsoft-teams-thread"===r.type||"sharepoint"===r.type||"jira"===r.type)return r.key;if("collection"===r.type||"collection-view"===r.type||"person"===r.type)return h.EMPTY_HREF;if("query-database-result"===r.type||"skill"===r.type)throw new Error(`Invalid URL type: ${r.type}`);return"universal"===r.type||"attachment"===r.type?r.key:void(0,a().HB)(r)}removeKey(e){const t=this.generateSerializedKey(e),r=this.keyToCounterMap.get(t);if(r)return this.keyToCounterMap.delete(t),this.counterToKeyMap.delete(r),r}setCounterValueForKey(e,t){const r=this.generateSerializedKey(e);this.keyToCounterMap.set(r,t),this.counterToKeyMap.set(t,e)}}h.attributesToMap={id:!0,"page-id":!0,"database-id":!0,"person-id":!0,"person-name":!1,href:!0,category:!1,option:!1,format:!1,number:!1,date:!1,time:!1,"start-date":!1,"start-time":!1,"end-date":!1,"end-time":!1,"synced-property-name":!1,"synced-block-id":!0,"external-id":!0,index:!1,title:!1,icon_url:!1,description:!1,name:!1,equation:!1},h.EMPTY_HREF="#"},915189:(e,t,r)=>{"use strict";r.d(t,{K:()=>s});r(16280),r(898992),r(672577),r(581454);var i=r.n(r(755373)),n=()=>r(832443),o=()=>r(179034),a=()=>r(630116);function s(e,t){if("page"===e.type||"block"===e.type||"properties"===e.type){const r=e.pageId??("page"===e.type?e.id:void 0);if(!r)return;return{type:"notion",citationLevel:e.type,store:a().Bv.createChildStore(t,{table:o().ev,id:e.id,spaceId:t.id}),id:e.id,pageId:r,title:e.title,path:e.path,text:e.text,lastEdited:e.lastEdited,badges:"page"===e.type?e.badges:void 0,highlight:"page"===e.type?e.highlight:void 0}}const r=n().tD.parseAssistantHref(e.id);if(r){if("slack"===e.type){if("slack"!==r.type)throw new Error(`Expected Slack result, but got ${r.type}`);const t=`slack://?${i().stringify({base_url:r.baseUrl,channel_id:r.channelId,message_id:r.messageId,thread_ts:r.threadTs})}`,{user:n,text:o}=function(e){let t,r=e.text;if("slack"===e.type){var i;null!==(i=e.highlight)&&void 0!==i&&i.text&&(r=e.highlight.text);const n=": ";if(r.includes(n)){const[e,...i]=r.split(n);e&&"file"!==e.toLowerCase()&&(t=e),r=i.join(n)}if(!t){const r=e.messages.find((t=>t.messageId===e.id));r&&(t=r.user)}}return{user:t??"",text:r}}(e);return{id:e.pageId,type:"slack",href:t,threadHref:t,title:e.title,text:o,user:n,lastEdited:e.lastEdited,domain:r.domain,baseUrl:r.baseUrl,channelId:r.channelId,messageId:r.messageId,threadTs:r.threadTs,threadMessages:e.messages.map((e=>e.messageId)),highlight:{...e.highlight,text:o}}}if("helpdoc"===e.type){if("helpdoc"!==r.type)throw new Error(`Expected helpdocs result, but got ${r.type}`);return{type:"helpdocs",href:e.id,id:e.id,title:e.title,text:e.text,lastEdited:e.lastEdited,url:r.url}}if("helpdoc-section"===e.type){if("helpdoc-section"!==r.type)throw new Error(`Expected helpdoc-section result, but got ${r.type}`);return{type:"helpdoc-section",href:e.id,id:e.id,parentPageHref:r.parentPageHref,title:e.title,text:e.text,lastEdited:e.lastEdited,url:r.url}}if("google-drive"===e.type){if("google-drive"!==r.type)throw new Error(`Expected google-drive result, but got ${r.type}`);return{type:"google-drive",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,fileType:e.fileType,url:r.url,highlight:e.highlight}}if("webpage"===e.type){if("webpage"!==r.type)throw new Error(`Expected webpage result, but got ${r.type}`);return{type:"webpage",href:e.id,id:e.id,title:e.title,text:e.text,lastEdited:e.lastEdited,url:r.url}}if("github"===e.type){if("github"!==r.type)throw new Error(`Expected github result, but got ${r.type}`);return{type:"github",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,authorName:e.authorName,statusTag:e.statusTag,githubRepoName:e.githubRepoName,fileType:e.fileType,url:r.url,highlight:e.highlight}}if("jira"===e.type){if("jira"!==r.type)throw new Error(`Expected jira result, but got ${r.type}`);return{type:"jira",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,url:r.url,highlight:e.highlight}}if("gmail"===e.type){if("gmail"!==r.type)throw new Error(`Expected gmail result, but got ${r.type}`);return{type:"gmail",href:e.id,id:e.pageId,title:e.title,text:e.text,lastEdited:e.lastEdited,emailAddress:e.emailAddress,url:r.url}}}}}}]);