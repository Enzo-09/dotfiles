"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[28387],{299177:(e,t,n)=>{n.d(t,{A:()=>i});class o extends(()=>n(757695))().default{getInitialState(){return{}}}const r=new o;n(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>R,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>T,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>x,MAX_RECURRENCE_INTERVAL:()=>g,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>_,adjustedStartDateIfPossible:()=>A,areRecurrenceSchedulesEqual:()=>O,convertFromUnpersistedRecurrenceConfig:()=>F,convertToUnpersistedRecurrenceConfig:()=>I,getFormattedEndCondition:()=>E,getFormattedNextRecurrenceTime:()=>P,getNewEndTimestamp:()=>D,getNextDateUtc:()=>w,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>C,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>S,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>M});n(898992),n(354520),n(581454);var o=()=>n(244641);n(944114);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),c=()=>n(720665),s=()=>n(597777),l=()=>n(869190),d=()=>n(416504),u=()=>n(402390);class p extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(912720);const y=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},_={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},g=99,v=999;function h(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=g}function S(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function b(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:c,hour:l,minute:d}=e,u="week"===n&&i?i.map((e=>_[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return _[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new p({freq:f[n],dtstart:(0,s().eU)(t),interval:o,byweekday:u,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...m})}const x=1,T=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>x,a=n.length>=T;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function A(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let i=o().c9.fromMillis(n.start_date,{zone:"utc"});const a=o().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,s().DH)(i.toMillis())}}function k(e){const{recurrence:t,afterDate:n}=e;if((0,m().wt)(t)){const e=(0,s().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(A({recurrence:t,afterDate:n})).after((0,s().eU)(n));if(!e)return;return(0,s().h1)(e)}}function C(e){return 0===e.hour||1===e.hour||2===e.hour}function w(e){return b(e).after((0,s().eU)((0,s().Rz)()))||void 0}function P(e){const{recurrence:t,intl:n}=e,r=w(F(t));if(!r)return;const i=C(t),a=o().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),c=(0,l().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(y.dateBetweenMidnightAnd3AM,{date:c});{let e=a.toLocaleString(o().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(y.dateAtTime,{date:c,time:e})}}function E(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(y.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().Yq)({date:o().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(y.noEndCondition)}const R=100;function I(e){return{...e,start_date:(0,s().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function D(e,t,n){return e.plus(n-t)}function U(e,t){const n=o().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Rz)(n.toJSDate())}}function F(e){return{...e,start_date:(0,s().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?U(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function O(e,t){const n=i().fN(e,(e=>void 0!==e)),o=i().fN(t,(e=>void 0!==e));return i().n4(n,o)}},422540:(e,t,n)=>{n.d(t,{$0:()=>_,Fx:()=>T,Ge:()=>m,I3:()=>u,Kj:()=>b,PP:()=>M,TK:()=>A,Yy:()=>d,aE:()=>k,cQ:()=>x,kH:()=>y,m7:()=>p,nq:()=>h,nv:()=>g,tj:()=>f});n(898992),n(354520),n(737550);var o=()=>n(496603),r=()=>n(534177),i=()=>n(970013),a=()=>n(651124),c=()=>n(349835),s=()=>n(390066);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const l={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(l[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:n,filter:c,sort:l,sourcePropertyIds:d}=e,p=(d??(0,r().uv)(n)).filter(((t,o,r)=>{const a=n[t];return!(!a||!u(a))&&(("relation"!==a.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,a))&&(!c||c([t,a],o,n)))}));if(0===p.length)return[];if(!t||!1===l)return p;const m=(0,s().L)(t,n,void 0,a().jf.Page).collection_page_properties||[];return o().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:n,sort:c}=e,l=(0,r().uv)(n).filter(((e,t,o)=>{const r=n[e];return!(!r||!(0,i().JY)(r))}));if(0===l.length)return[];if(!t||!1===c)return l;const d=(0,s().L)(t,n,void 0,a().jf.Page).collection_page_properties||[];return o().Ul(l,(e=>d.findIndex((t=>t.property===e))))}function y(e){return e.type===c().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===c().M9.TokenExpected?{type:e.type,token:e.token}:e.type===c().uW.MissingSchemaPropertyOnThisRow||e.type===c().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===c().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===c().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===c().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===c().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===c().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===c().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===c().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===c().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===c().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===c().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===c().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function _(e){return Boolean(f[e.type])}function g(e){const{collectionFormat:t,collectionSchema:n,filter:c,sort:l}=e,d=(0,r().uv)(n).filter(((e,t,o)=>{var r;const a=n[e];return!(!a||!f[a.type])&&((!(0,i().$M)(a)||null===(r=(0,i().om)(a))||void 0===r||!r.auto_update_on_edit)&&(!c||c([e,a],t,n)))}));if(0===d.length)return[];if(!t||!1===l)return d;const u=(0,s().L)(t,n,void 0,a().jf.Page).collection_page_properties||[];return o().Ul(d,(e=>u.findIndex((t=>t.property===e))))}const v={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function h(e){return v[e.type]}const S={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function b(e){return S[e.type]}function x(e){return 0===e}function T(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function M(e){const{property:t,collectionSchema:n}=e;return!!n&&!n[t]}function A(e){const{collectionSchema:t,property:n,type:o}=e,r=null==t?void 0:t[n];return!r||("action"===o?!u(r):!f[r.type])}function k(e){let{automationTrigger:t,collectionSchema:n}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:o,source:i,relativeDate:a}=t.event;if(void 0===i)return!1;const c="some"===o.type&&o.some,s="all"===o.type&&o.all;if((c||s||[]).some((e=>M({collectionSchema:n,property:e.property})||A({collectionSchema:n,property:e.property,type:"trigger"}))))return!1;const l="some"===o.type&&(!(0,r().O9)(o.some)||0===o.some.length),d="all"===o.type&&(!(0,r().O9)(o.all)||0===o.all.length);if(!e&&("none"===o.type||l||d)&&!a)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},465364:(e,t,n)=>{n.d(t,{$N:()=>P,D5:()=>E,GB:()=>k,M9:()=>M,Pt:()=>w,eW:()=>C,jo:()=>R,v7:()=>A});n(944114),n(898992),n(803949),n(581454);var o=()=>n(244641),r=()=>n(787626),i=()=>n(713998),a=()=>n(597777),c=()=>n(604995),s=()=>n(416504),l=()=>n(519831),d=()=>n(496603),u=()=>n(534177),p=()=>n(299709),m=()=>n(317001),y=()=>n(520861),f=()=>n(878060),_=()=>n(44729),g=()=>n(246826),v=()=>n(319975),h=()=>n(519839),S=()=>n(695625),b=()=>n(397248),x=()=>n(630116),T=()=>n(747671);function M(e){const{environment:t,droppedStores:n,duplicate:i,calendarBy:d,transaction:u,collectionContextStore:f,duplicateActions:g}=e,v=o().c9.fromMillis(e.startOfDay);let S=!0;for(const o of n){const t=e.collectionStore?e.collectionStore:(0,h().Dj)({store:o,collectionContextStore:f});if(o.getParentTable()===l().Vl||!t){S=!1;break}_().X$({childStore:o,parentStore:t,transaction:u})||(S=!1)}const b=(0,y().T)({environment:t,droppedStores:n,duplicate:i,transaction:u,collectionStore:e.collectionStore,duplicateActions:g});for(const o of b){const n=e.collectionStore?e.collectionStore:(0,h().Dj)({store:o,collectionContextStore:f});if(!n)continue;const i=n.getMappedProperty(d),l=o.getPropertyStore(i),y=(0,r().b)(l.getValue())||c().Ec((0,s().P)()),_=c().kW(y,(0,s().P)()),g=v.toFormat(c().tr);let b;if("date"===_.type||"datetime"===_.type)b={..._,start_date:g};else{const e=c().AA(_,(0,s().P)());if(!e.end)return;const t={..._,start_date:g},n=c().AA(t,(0,s().P)()).start.diff(e.start,"days"),o=e.end.plus(n).toFormat(c().tr);b={..._,start_date:g,end_date:o}}const x=c().kW(b,a().$K(y)||(0,s().P)());(0,m().j)({environment:t,store:o,collectionStore:n,collectionContextStore:f,shouldCoerce:!0,groupsPointer:[],transaction:u,alreadyMovedToCollection:S}),E({environment:t,type:"dateValue",propertyId:i,store:o,transaction:u,dateValue:x}),(0,p().E)({environment:t,collectionContextStore:f,block_id:o.id,property:i,property_type:"date",from:"calendar"})}}function A(e){const{calendarStore:t,direction:n,targetStore:o}=e;t.setState({...t.state,isDragging:!0,targetStore:o,direction:n,temporaryValue:void 0})}function k(e){const{calendarStore:t,x:n,y:i,calendarBy:l}=e,u=t.state;if(u.isDragging){const e=(0,r().b)(u.targetStore.getPropertyStore(l).getValue());if(!e)return;const p=c().kW(e,(0,s().P)()),m=u.temporaryValue||e,y=c().kW(m,(0,s().P)()),f=[];u.dayStoreMap.forEach(((e,t)=>{f.push({store:e,timestamp:t})}));const _=f.find((e=>{let{store:t}=e;const o=S().T.getRectFromStore(t);return Boolean(o&&b().ux(o,n,i))}));let g;if(_){const e=o().c9.fromMillis(_.timestamp),t=e.endOf("day"),n=e.toFormat(c().tr);if(p){const r=c().AA(p,(0,s().P)());if(u.direction===T().Q.Left)if(o().IX.fromDateTimes(e,t).contains(r.start))g=p;else{let e;e="datetimerange"===p.type||"daterange"===p.type?{...p,start_date:n,end_date:p.end_date}:"datetime"===p.type?{type:"datetimerange",start_date:n,start_time:p.start_time,end_date:p.start_date,end_time:p.start_time,time_zone:p.time_zone,reminder:p.reminder}:{type:"daterange",start_date:n,end_date:p.start_date,reminder:p.reminder};const t=c().AA(e,(0,s().P)());g=!r.end&&t.start>r.start||r.end&&t.start>r.end?y:e}else if(r.end?o().IX.fromDateTimes(e,t).contains(r.end):o().IX.fromDateTimes(e,t).contains(r.start))g=p;else{let e;e="date"===p.type?{...p,type:"daterange",end_date:n}:"datetime"===p.type?{...p,type:"datetimerange",end_date:n,end_time:"00:00"}:{...p,end_date:n};const t=c().AA(e,(0,s().P)());g=t.end&&t.end<t.start?y:e}}}if(g&&!d().n4(y,g)){const e=c().kW(g,a().$K(m)||(0,s().P)());t.setState({...u,temporaryValue:e})}}}function C(e){const{environment:t,calendarStore:n,calendarBy:o,transaction:r}=e,i=n.state;i.isDragging&&i.temporaryValue&&(E({type:"dateValue",environment:t,dateValue:i.temporaryValue,propertyId:o,store:i.targetStore,transaction:r}),n.setState({...n.state,isDragging:!1}))}function w(e){const{calendarStore:t}=e,n=t.state;n.isDragging&&t.setState({...n,isDragging:!1})}function P(e){const{environment:t,store:n,collectionStore:r,collectionContextStore:a,startDayOfWeek:l,transaction:d}=e,u=a.dateRangeStartStore.state,p=(0,s().P)(),y=a.normalizedQueryStore.state;if(!y||!y.calendar_by)return;const f=(null==r?void 0:r.getMappedProperty(y.calendar_by))??y.calendar_by,_=c().hp(u,l,p),v=_.startOf("month"),h=_.endOf("month"),S=o().c9.now().startOf("day");let b;return b=o().IX.fromDateTimes(v,h).contains(S)?c().p6(S.valueOf(),p):c().p6(c().iB(u,l,p).valueOf(),p),g().zv({store:n.getPropertiesStore(),data:{[f]:i().m5(b)},transaction:d}),(0,m().j)({environment:t,store:n,collectionStore:r,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:d}),n}function E(e){const{environment:t,store:n,propertyId:o,transaction:r}=e;let a;"timestamp"===e.type?a=c().p6(e.timestampMs.valueOf(),(0,s().P)()):"dateValue"===e.type?a=e.dateValue:(0,u().HB)(e);const l=n.getPropertyValue(o),d=i().m5(a);g().zv({store:n.getPropertiesStore(),data:{[o]:d},transaction:r}),f().O({environment:t,store:n,dateProperty:{id:o,oldValue:l,newValue:d}})}function R(e){const{environment:t,collectionStore:n,calendarBy:o,store:r,insertStores:i,collectionContextStore:a,transaction:c}=e,s=r.getPropertyStore(o).getValue();for(const l of i)(0,m().j)({environment:t,store:l,collectionStore:n,collectionContextStore:a,shouldCoerce:!0,groupsPointer:[],transaction:c}),v().R9({environment:t,store:l.getPropertyStore(o),value:s,transaction:c});return i.map((e=>x().Bv.createChildStore(n,e.pointer)))}},520861:(e,t,n)=>{n.d(t,{T:()=>r});n(944114),n(898992),n(908872);var o=()=>n(415651);function r(e){const{environment:t,collectionStore:n,duplicate:r,droppedStores:i,transaction:a,duplicateActions:c}=e,{movedStores:s,reparentedStores:l}=i.reduce(((e,t)=>(r||t.getAssociatedCollectionId()!==(null==n?void 0:n.id)?e.reparentedStores.push(t):e.movedStores.push(t),e)),{movedStores:[],reparentedStores:[]});return[...s,...o().MS({environment:t,droppedStores:l,duplicate:r,transaction:a,resolveTemplateVariables:!1,duplicateActions:c})]}},546461:(e,t,n)=>{n.d(t,{EC:()=>x,To:()=>b,YC:()=>T,or:()=>S,u:()=>h});n(16280);var o=n(296540),r=()=>n(484714),i=()=>n(847249),a=()=>n(496506),c=()=>n(322867),s=()=>n(959013),l=()=>n(534177),d=()=>n(813297),u=()=>n(862292),p=()=>n(698331),m=()=>n(645873),y=()=>n(190019),f=()=>n(76190),_=n(474848);const g=new WeakMap,v=(0,o.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});v.displayName="AutomationContext";function h(e){const{automationStore:t,children:n,contextType:o}=e,h=(0,r().v3)(),S=(0,s().tz)(),{value:b}=(0,m().fJ)(u().T.formulas),{value:x}=(0,m().fJ)(d().QV.automationTypecheck),T=(0,f().n)(t),M=(0,i().K8)((()=>{if(!b)return{error:new(c().N9)("Missing formulas dependency")};if(!x)return{error:new(c().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:n,automationTypecheckModule:o,contextType:r,formulasModule:i,intl:c,isSubscribed:s}=e,d=g.get(n);if(d)return d;{const e=new(a().default)((()=>{const e=n.getTriggerType();let a=r;return(0,l().O9)(e)&&(0,p().x2)(e)&&(a=(0,p().H8)(e)),(0,y().Z)({environment:t,automationStore:n,automationTypecheckModule:o,contextType:a,formulasModule:i,intl:c,isSubscribed:s})}),{debugName:"automationContextTypecheckResultCachedStore"});return g.set(n,e),e}}({environment:h,automationStore:t,automationTypecheckModule:x,contextType:o,formulasModule:b,intl:S,isSubscribed:T});return e.state}),[h,t,x,o,b,S,T]);return(0,_.jsx)(v.Provider,{value:{automationStore:t,typecheckResult:M,contextType:o,defined:!0},children:n})}function S(e){const{automationStore:t,children:n}=e,o=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,_.jsx)(h,{automationStore:t,contextType:(0,p().H8)(o??"event"),children:n})}function b(e){var t;return null===(t=g.get(e))||void 0===t?void 0:t.state}function x(){const e=o.useContext(v);if(!1===e.defined)throw new Error("No automation context found!");return e}function T(){return o.useContext(v)}},698331:(e,t,n)=>{n.d(t,{$X:()=>i,H8:()=>a,x2:()=>r});var o=()=>n(534177);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,o().O9)(t)&&r(t.type)}function a(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,o().HB)(e)}},725649:(e,t,n)=>{function o(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>o,j6:()=>i})},747671:(e,t,n)=>{n.d(t,{Q:()=>o,a:()=>r});let o=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e}({});class r extends(()=>n(757695))().default{getInitialState(){return{dayStoreMap:new Map,isDragging:!1,startingMonth:0}}}},754606:(e,t,n)=>{n.r(t),n.d(t,{PublicAIBuilder:()=>g});n(814603),n(147566),n(198721);var o=n(296540),r=()=>n(484714),i=()=>n(847249),a=()=>n(428045),c=()=>n(427704),s=()=>n(498212),l=()=>n(435009),d=()=>n(508496),u=()=>n(541801),p=()=>n(913454),m=()=>n(317053),y=()=>n(458097),f=()=>n(204063),_=n(474848);function g(){const e=(0,r().v3)(),t=(0,o.useCallback)((()=>{const t=new URLSearchParams(window.location.search).get("prompt"),n=p().globalWorkflowTemplates.fromIdOfType({templateId:a().MH,type:"collection"}),o=(0,s().lZ)();var r;(y().A.setState({open:!0,isSaving:!1,version:"pre_signup_build_with_ai",collectionTemplate:n,userCustomizations:{featureTemplateSelections:[],recordTitles:[]},previewCollectionInfo:void 0,setupGenerator:(0,m().getSetupGeneratorForTemplate)({environment:e,template:n,isForInAppFlows:!1,parentStore:void 0,initialAiPrompt:void 0,analyticsArgs:{origin:"pre_signup_build_with_ai",hadSelectionModalSearchEntered:!1,workflowTemplatesFlowId:o}}),currentStepIndex:0,parentStore:void 0,existingCollectionInfo:void 0,relationInfos:[],navigateToOnFinish:"skip",collectionTemplatesSearchQuery:void 0,origin:"pre_signup_build_with_ai",flowId:o}),y().A.state.open)&&(null===(r=y().A.state.setupGenerator)||void 0===r||r.setPrompt([[t??""]]))}),[e]);(0,o.useEffect)((()=>{if(e.currentUser.isLoggedIn())return void l().oo({environment:e,url:c().JZ.root,redirect:!0});"control"!==d().default.getEligibleGroup({experimentId:"ai_first_onboarding_phase_two",defaultGroup:"control"})?t():l().oo({environment:e,url:c().JZ.root,redirect:!0})}),[t,e]);const n=(0,i().K8)((()=>y().A.state.open),[]);return(0,_.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:[(0,_.jsx)(f().A,{style:{height:32,borderRadius:6,padding:10},onClick:t,children:"Open builder"}),n&&(0,_.jsx)(u().JA,{})]})}},888325:(e,t,n)=>{function o(e){return`${e.table}:${e.id}`}n.d(t,{_:()=>o})}}]);