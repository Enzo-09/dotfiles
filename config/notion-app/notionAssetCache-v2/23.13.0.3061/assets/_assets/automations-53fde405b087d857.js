"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[22542,79665,90871],{6731:(e,t,o)=>{o.d(t,{D:()=>d});o(898992),o(803949);var n=o(296540),i=()=>o(847249),a=()=>o(351028),r=()=>o(388821),s=()=>o(751156),l=()=>o(841696),c=()=>o(351360);function d(e){let{unpersistedInMemoryRecordCache:t}=e;const o=(0,i().K8)((()=>{var e;return null===(e=c().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]);return{createAndCommit:(0,n.useCallback)((e=>{let{perform:n}=e;const i=new(l().Z)({deadlockTimeoutMs:s().DEADLOCK_WARNING_TIMEOUT_MS}),c=n(i),d=r().RecordMap.create();i.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&d.addModel(t)})),(0,a().applyOperationsToRecordMap)({operations:i.operations,recordMap:d,updateOnly:!1});for(const a of d){const{model:e,pointer:n}=a;t.setModelAndRole({pointer:n,userId:o},e,"editor")}return t.emitAll(),{performResult:c,serverCommitResult:Promise.resolve(void 0)}}),[t,o])}}},12193:(e,t,o)=>{o.r(t),o.d(t,{globeIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0m3.123-4.514c.55.252 1.21.463 1.953.612q.135-.585.308-1.086a6.6 6.6 0 0 1 .512-1.15 6.4 6.4 0 0 0-2.773 1.624m-.814.994a6.34 6.34 0 0 0-1.029 2.895h3.396c.022-.715.081-1.403.173-2.048-.962-.191-1.827-.48-2.54-.847m-1.029 4.145a6.34 6.34 0 0 0 1.03 2.895c.712-.367 1.577-.656 2.54-.848a19 19 0 0 1-.174-2.047zm4.647 0c.021.657.076 1.283.158 1.862a15 15 0 0 1 3.08 0c.082-.58.137-1.205.158-1.862zm4.647 0a19 19 0 0 1-.173 2.048c.845.169 1.615.412 2.274.717a.6.6 0 0 1 .23.182 6.34 6.34 0 0 0 1.065-2.947zm3.396-1.25a6.34 6.34 0 0 0-1.03-2.895c-.712.367-1.577.656-2.54.847.093.645.152 1.333.174 2.048zm-4.647 0a17 17 0 0 0-.158-1.862 15 15 0 0 1-3.08 0c-.082.58-.137 1.205-.158 1.862zm-6.2 5.139a6.4 6.4 0 0 0 2.773 1.624 6.6 6.6 0 0 1-.512-1.15 11 11 0 0 1-.308-1.086 9 9 0 0 0-1.953.612m9.004 0a9 9 0 0 0-1.953-.611q-.135.584-.308 1.085a6.6 6.6 0 0 1-.512 1.15 6.4 6.4 0 0 0 2.773-1.624m-3.443.067q.136-.395.249-.86a13.7 13.7 0 0 0-2.615-.001q.111.466.248.861c.198.575.42.995.635 1.259.22.269.366.302.424.302s.205-.033.424-.302c.215-.264.437-.684.635-1.259m3.443-9.095a6.4 6.4 0 0 0-2.773-1.624c.196.337.366.726.512 1.15q.173.501.308 1.086a9 9 0 0 0 1.953-.612M10 6.342q.676-.001 1.308-.062a9 9 0 0 0-.249-.861c-.198-.575-.42-.995-.635-1.259-.22-.269-.366-.302-.424-.302s-.204.033-.424.302c-.215.264-.437.684-.635 1.259q-.136.395-.248.861.631.061 1.307.062"})},i=(0,o(340498).wt)("globe",n)},48278:(e,t,o)=>{o.r(t),o.d(t,{AutomationWorkflowEditor:()=>ta,AutomationWorkflowEditorActionSection:()=>Xi,ButtonBlockUrlPreviewPopup:()=>ua,PlacedButtonBlockEditor:()=>na,automationActions:()=>i(),automationErrorHelpers:()=>ie(),automationExecutionActions:()=>n});var n={};o.r(n),o.d(n,{executeClientAutomation:()=>ne});var i=()=>o(324587),a=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(581454),()=>o(81768)),r=()=>o(496603),s=()=>o(973647),l=()=>o(534177),c=()=>o(322867),d=()=>o(648651),u=()=>o(103966);const p=(0,c().kB)((async function(e){const{context:t,executeAutomationActionFn:o}=e,{actionModels:n,automationModel:i,contextType:a,runtimeStats:p}=t;let g=t.values;const f=performance.now();let y,h={value:{success:!0}};if("button_block"===a||"button_property"===a){if(!i.isButtonType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,u().Z)(i.getTriggerType()).execute(t,e)}else if("event"===a){if(!i.isEventType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,u().Z)(i.getTriggerType()).execute(t,e)}else if("recurrence"===a){if(!i.isRecurrenceType())return{error:new(c().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${a}).`})};const e=i.getTrigger();y=(0,u().Z)(i.getTriggerType()).execute(t,e)}else(0,l().HB)(t);if(s().Q.isFail(y))return y;g=g.concat((0,r().o8)(y.value.values));const v=o??m;for(const r of n){var b;const e=await v({action:r,values:g,executionContext:t}),o=null==p||null===(b=p.actionStats)||void 0===b||null===(b=b[r.id])||void 0===b?void 0:b.executionDurationMs;if((0,l().O9)(o)&&o>7e3&&t.executeEffectMap.logMessage({from:"executeAutomation",level:"warning",type:"longRunningAutomationAction",data:{durationMs:o,automationId:i.id,actionId:r.id,actionType:r.getType()}}),s().Q.isFail(e)){h=e;break}if(g=g.concat(e.value.values),e.value.stopExecution)break}const x=await t.executeEffectMap.updateLastRunTimesForObservability({automationModel:t.automationModel,executeResult:h});s().Q.isFail(x)&&(h=x);const S=Math.trunc(performance.now()-f);p&&(p.executionStartTime=f,p.executionDurationMs=S,p.executionSuccess=s().Q.isSuccess(h),d().hs.aggregate(p));return h}),(e=>e.context.automationModel.id));async function m(e){const{action:t,values:o,executionContext:n}=e,i=(0,a().getActionRegistryItem)(t.getType());return i.requiresPriorTransactionsCommitted&&await n.executeEffectMap.waitForTransactionsCommitted(),await i.execute({...n,values:o},t)}var g=()=>o(247331),f=()=>o(919709),y=()=>o(352271);var h=()=>o(502856),v=()=>o(857639),b=()=>o(416504),x=()=>o(728272),S=()=>o(798880),A=()=>o(498212),C=()=>o(495262),M=()=>o(436572),k=()=>o(518736),T=()=>o(862292),I=()=>o(989423),j=()=>o(909470),w=()=>o(972435),P=()=>o(508496),_=()=>o(10984),B=()=>o(406792);const R={...d().hs,logNotionPerformance(e){const{automationStats:t,environment:o}=e;if((0,d().oh)(t)){var n;const e={metricName:"automation.client.execution_duration_ms",startTime:t.executionStartTime,endTime:t.executionStartTime+t.executionDurationMs};B().default.DO_NOT_USE_measureLegacy(e,{environment:o,data:{success:t.executionSuccess,has_formulas:((null===(n=t.formulaStats)||void 0===n?void 0:n.totalFormulas)??0)>0}})}for(const a of Object.values(t.actionStats))if((0,d().WV)(a)){var i;const e={metricName:"automation.client.action_execution_duration_ms",startTime:a.executionStartTime,endTime:a.executionStartTime+a.executionDurationMs};B().default.DO_NOT_USE_measureLegacy(e,{data:{automation_action_type:a.actionType,success:a.executionSuccess,has_formulas:((null===(i=a.formulaStats)||void 0===i?void 0:i.totalFormulas)??0)>0},environment:o})}}};var E=()=>o(66689),D=()=>o(959013);const O=(0,D().YK)({genericSuccessMessage:{id:"automations.buttonTrigger.genericSuccessMessage",defaultMessage:"Button automation ran successfully"},createdBlocks:{defaultMessage:"Created {numBlocksDuplicated, plural, one {1 block} other {{numBlocksDuplicated} blocks}} on page",id:"automations.buttonTrigger.createdBlocks"},createdSprintsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprints"},updatedSprintsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprints"},createdSprintsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprintsLowercase"},updatedSprintsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprintsLowercase"},createdTasksUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasks"},updatedTasksUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasks"},createdTasksLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasksLowercase"},updatedTasksLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasksLowercase"},createdProjectsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjects"},updatedProjectsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjects"},createdProjectsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjectsLowercase"},updatedProjectsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjectsLowercase"},createdPagesUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPages"},updatedPagesUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPages"},createdPagesLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPagesLowercase"},updatedPagesLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPagesLowercase"}}),F=["sprint","task","project","page"],V={[E().Tw]:"project",[E().dC]:"task",[E().yH]:"page",[E().TC]:"page",[E().av]:"sprint",[E().pW]:"page",[E().BF]:"page",[E().wZ]:"page",[E().CO]:"page",[E().SC]:"page",[E().Qk]:"page"};function N(e){const{typedAutomationExecutionSummary:t,numBlocksDuplicated:o,intl:n}=e,i=function(e){const{typedAutomationExecutionSummary:t,intl:o}=e,n=[];for(const a of F){const e=t[a];if(e){const{numPagesCreated:t,numPagesEdited:o}=e;t>0&&n.push({pageType:a,modificationType:"created",numPagesModified:t}),o>0&&n.push({pageType:a,modificationType:"updated",numPagesModified:o})}}const i=n.slice(0,L).map(((e,t)=>{let{pageType:n,modificationType:i,numPagesModified:a}=e;const r=W[n][i],s=0===t?r.start:r.append;return o.formatMessage(s,{numPagesModified:a})}));if(i.length>0)return o.formatList(i,{type:"conjunction",style:"long"})}({typedAutomationExecutionSummary:t,intl:n});return i||(o>0?n.formatMessage(O.createdBlocks,{numBlocksDuplicated:o}):n.formatMessage(O.genericSuccessMessage))}const L=3;const W={sprint:{created:{start:O.createdSprintsUppercase,append:O.createdSprintsLowercase},updated:{start:O.updatedSprintsUppercase,append:O.updatedSprintsLowercase}},task:{created:{start:O.createdTasksUppercase,append:O.createdTasksLowercase},updated:{start:O.updatedTasksUppercase,append:O.updatedTasksLowercase}},project:{created:{start:O.createdProjectsUppercase,append:O.createdProjectsLowercase},updated:{start:O.updatedProjectsUppercase,append:O.updatedProjectsLowercase}},page:{created:{start:O.createdPagesUppercase,append:O.createdPagesLowercase},updated:{start:O.updatedPagesUppercase,append:O.updatedPagesLowercase}}};var z=()=>o(179034),K=()=>o(630116);o(18107),o(967357);var U=()=>o(908006),H=()=>o(584262),G=()=>o(134025),Y=()=>o(763824),q=()=>o(449506),X=()=>o(246826),$=()=>o(435009),J=()=>o(778417),Q=()=>o(751156),Z=()=>o(492414),ee=()=>o(351360),te=()=>o(387712);class oe{constructor(e){this.environment=void 0,this.clientContext=void 0,this.automationModel=void 0,this.numBlocksDuplicated=0,this.transactionServerCommitResults=[],this.saveTransactionInfos=[],this.undoCheckpointName=void 0,this.waitForTransactionsCommitted=async()=>{await Promise.all(this.transactionServerCommitResults),this.transactionServerCommitResults=[]},this.getCollectionSchema=async e=>{const t=await this.clientContext.parentRecordStore.loadRecordModel(e.pointer);return t?{value:{collectionSchema:t.getNormalizedSchema()}}:{error:new(c().WY)({actionId:e.actionId,pointer:e.pointer})}},this.logMessage=e=>{v().log(e)},this.incrementMetric=()=>{},this.queryCollection=async e=>{const t=await o(450859).mA(this.environment,{source:"automation",parentRecordStore:this.clientContext.parentRecordStore,collectionPointer:e.collection,filter:e.filter,sort:e.sort,limit:e.limit});return s().Q.isFail(t)?{error:new(c().rl)({actionId:e.actionId,type:t.error.type,message:t.error.message,cause:t.error})}:{value:{blockIds:t.value.blockIds}}},this.saveTransaction=e=>{const{info:t,operations:n}=e,i=[];if(this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.saveTransaction",environment:this.environment,perform:e=>{for(const t of n)if((0,o(439180).ph)(t)){const o=K().Bv.createChildStore(this.clientContext.parentRecordStore,t.pointer);Q().applyCrdtTextOperation({store:o,operation:t,invertedOperation:void 0,transaction:e})}else if((0,G().$Y)(t)||(0,G().mP)(t)){const o=(0,K().Oo)(this.clientContext.parentRecordStore,t.pointer);Q().applyOperation({store:o,operation:t,transaction:e})}else(0,l().HB)(t);i.push(e.id)}}),this.saveTransactionInfos.push(t),"create_page"===t.type)o(970330).v(this.environment,{type:"page",automation_id:this.automationModel.id,from:"button_automation",new_page_id:t.pageId,creating_block_id:t.pageId});else if("update_pages"===t.type){const{editedProperties:e,pageIds:n}=t;for(const t of n)for(const{id:n,type:i}of e)(0,o(810519).u)(this.environment,{block_id:t,property:n,property_type:i,from:"button_automation",automation_id:this.automationModel.id},!1)}else"publish_site"===t.type||(0,l().HB)(t);return Promise.resolve({value:{stats:{totalOperations:n.length,transactionIds:i}}})},this.navigateToPage=e=>{const t=ee().default.state.mainEditorCurrentBlockStore;if(!t)return;const n=K().Bv.createChildStore(t,e.page),i="full_page"===e.openIn?(0,Z().Ay)({store:n,fullyQualified:!1,pageVisitSource:H().y8.ButtonAutomation}):(0,Z().Ay)({store:t,peekViewBlockId:n.id,peekMode:(0,o(712505).getUrlParamFromPeekMode)(e.openIn),fullyQualified:!1,pageVisitSource:H().y8.ButtonAutomation});$().oo({environment:this.environment,url:i})},this.openUrl=e=>{$().oo({environment:this.environment,url:e.url,openInNew:"tab"})},this.sendSlackNotification=async e=>{const{action:t,customMessage:o}=e;return(0,I().u4)({environment:this.environment,event:{eventName:"button_automation_slack_action",eventProperties:{type:this.clientContext.type}}}),this.executeServerSideEffect({effect:"send_slack_notification",actionPointer:t.pointer,contextType:this.clientContext.type,args:{custom_message:o}})},this.duplicateBlockChildren=async e=>{if("button_block"!==this.clientContext.type)return{error:new(c().g7)({contextType:this.clientContext.type})};const t=this.clientContext.blockStore,n=t.getRecordStoreUIParent();if(!n)return{value:{}};const i={};let a,r=t;if("before"===e.insertionPoint)a=!0;else if("after"===e.insertionPoint)a=!1;else if("topOfPage"===e.insertionPoint){let e;if(a=!0,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(z().ev)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c()._r)("invalid_record","Missing page store in client context for top of page insertion")};r=e.getContentStores().at(0)||t}else if("bottomOfPage"===e.insertionPoint){let e;if(a=!1,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(z().ev)&&n.getAncestorRecordStoreAtRootPath()&&(e=n.getAncestorRecordStoreAtRootPath()),!e)return{error:new(c()._r)("invalid_record","Missing page store in client context for bottom of page insertion")};r=e.getContentStores().at(-1)||t}else(0,l().HB)(e.insertionPoint);const s=K().Bv.createChildStore(n,e.blockPointer);await s.load();const d=s.getContentStores();a||d.reverse();const u=o(695625).T.findSelectableFromStore(r),p=[],m=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.duplicateBlockChildren",environment:this.environment,perform:e=>{const t=d.map((t=>{const{blockStores:n,onComplete:i}=o(183324).duplicateBlock({environment:this.environment,stores:[t],transaction:e,targetSpaceId:(0,o(161479).e)(t.pointer.spaceId),preferDuplicateLocation:"local",analyticsFrom:"button_automation",options:{addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!0}}),r=n[0];return u&&(a?u.props.onInsertAbove&&p.push(u.props.onInsertAbove({insertStores:[r],transaction:e})[0]):u.props.onInsertBelow&&p.push(u.props.onInsertBelow({insertStores:[r],transaction:e})[0])),{copy:r,onComplete:i}}));return R.aggregateActionStats(i,{transactionIds:[e.id]}),t}}).performResult;return a||p.reverse(),J().td({environment:this.environment,stores:p}),await Y().lX(m,10,(e=>e.onComplete)),U().default.afterNextFlush((()=>{for(const e of p){if(o(547392).Il({environment:this.environment,isAtStartOfLine:!1,store:e}))break}})),this.numBlocksDuplicated+=p.length,R.aggregateActionStats(i,{blocksCreated:this.getNumBlocksDuplicated()}),{value:{stats:i}}},this.displayModal=async e=>{te().A.setState({open:!0,format:e.format,recordStore:this.clientContext.parentRecordStore}),await te().A.waitUntil((()=>!te().A.state.open));const t=te().A.state;let o;return t.open||(o=t.result),o=o??"continue",{value:{result:o}}},this.initializeTemplateInDatabase=async e=>{const t=this.clientContext.parentRecordStore,n={},i=K().Bv.createChildStore(t,{table:z().ev,id:e.templateId});await i.load();const a=K().md.createChildStore(t,e.collection),r=(0,o(594794).Z1)({environment:this.environment,table:z().ev,spaceId:a.pointer.spaceId}),{performResult:s}=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.initializeTemplateInDatabase",environment:this.environment,perform:s=>{const l=X().Wv({environment:this.environment,transaction:s,inMemoryRecordCache:t.inMemoryRecordCache,type:o(700500).xd.page,id:r});return o(44729).X$({parentStore:a,childStore:l,transaction:s}),o(313209).n5({environment:this.environment,store:l,transaction:s,templateStore:i,title:"template",isCreateIn:!1,isKeyboard:!1,from:"automation_actions"}),o(586481).L({environment:this.environment,store:l,properties:e.propertyUpdates,transaction:s}),R.aggregateActionStats(n,{transactionIds:[s.id]}),l}});return this.saveTransactionInfos.push({type:"create_page",pageId:r,collection:e.collection}),await s.load(),s.isDefined()?{value:{pageId:r,pageModel:s.getModel(),stats:n}}:{error:new(c().WY)({actionId:e.actionId,pointer:s.pointer})}},this.sendInAppNotification=async e=>{const{actionPointer:t,targets:o,message:n,pagePointer:i}=e;return this.executeServerSideEffect({effect:"send_in_app_notification",actionPointer:t,contextType:this.clientContext.type,args:{targets:o,message:n,pagePointer:i}})},this.sendGmailNotification=async e=>{var t;const{action:o,to:n,cc:i,bcc:a,replyTo:r,fromName:s,subject:l,body:c}=e,d="button_block"===this.clientContext.type||"button_property"===this.clientContext.type?null===(t=this.clientContext.pageStore)||void 0===t?void 0:t.pointer:void 0;return this.executeServerSideEffect({effect:"send_gmail_notification",actionPointer:o.pointer,contextType:this.clientContext.type,args:{bcc:a,body:c,cc:i,fromName:s,pagePointer:d,replyTo:r,subject:l,to:n}})},this.updateLastRunTimesForObservability=async e=>{const{automationModel:t,executeResult:o}=e,n=this.clientContext.parentRecordStore,i=K().dn.createChildStore(n,t.pointer);return this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.updateLastRunTimesForObservability",environment:this.environment,skipUpdatingEditedMetadata:!0,perform:e=>{const t=Date.now();X().zv({data:{last_executed_time:t},store:i,transaction:e}),s().Q.isFail(o)&&X().zv({data:{last_failed_time:t},store:i,transaction:e})}}),Promise.resolve({value:void 0})},this.sendHttpRequest=async e=>{const{action:t,pagePointer:o,eventId:n}=e;return this.executeServerSideEffect({effect:"send_http_request",actionPointer:t.pointer,contextType:this.clientContext.type,args:{pagePointer:o,eventId:n}})},this.executeServerSideEffect=async e=>{const t=await q().callApi({eventName:"executeAutomationActionEffect",environment:this.environment,headers:{},data:e});return"failed"===t.type?{error:new(c().PD)({actionId:e.actionPointer.id,message:"Failure in execution of the executeAutomationActionEffect endpoint",cause:t.error})}:t.data},this.sleepForJitter=async e=>{await(0,Y().wR)(e)},this.environment=e.environment,this.clientContext=e.clientContext,this.automationModel=e.automationModel,this.undoCheckpointName=`execute-client-automation-${o(206267).JW()}`}getNumBlocksDuplicated(){return this.numBlocksDuplicated}createAndCommitForEffect(e){const t=Q().createAndCommit({...e,undoCheckpoint:this.undoCheckpointName,canUndo:!0});return this.transactionServerCommitResults.push(t.serverCommitResult),t}}async function ne(e){var t,o;const{clientContext:n,environment:r,onUndo:c}=e,d=await T().T.formulas.load(),u=await T().T.simpleFormulas.load();await n.automationStore.load();const m=n.automationStore.getModel();if(!m||!m.isButtonType()&&!m.isRecurrenceType())return;const B=m.spaceId,E=n.automationStore.getActionStores().map((e=>e.getModel())).filter(l().O9),D=m.getTriggerType(),O="button_block"===n.type?n.blockStore.id:"button_property"===n.type?null===(t=n.pageStore)||void 0===t?void 0:t.id:"recurrence"===n.type?void 0:(0,l().HB)(n),F=(0,_().AI)();(0,I().u4)({environment:r,event:{eventName:"automation_triggered",eventProperties:{actions:E.map((e=>e.getType())),automation_id:m.id,block_id:O,context_type:n.type,space_id:B,subscription_tier:F,trigger:D}}});const L=new oe({automationModel:m,clientContext:n,environment:r}),W=(0,h().MC)({collectionFeatureGates:(0,j().i)(),experimentService:P().default,getRecordModel:n.parentRecordStore.getRecordModel,loadRecordModel:n.parentRecordStore.loadRecordModel}),U=P().default.getConfigKey("automation_settings","client_formula_timeout_ms"),H=r.currentUser.id?{id:r.currentUser.id,table:S().oo}:void 0,G="recurrence"!==n.type?null===(o=n.pageStore)||void 0===o?void 0:o.getModel():void 0,Y=[];if("recurrence"===n.type&&"completeSprint"===n.recurrence.type){const{values:e}=function(e){const{nextSprintDateRange:t,completeSprintActionType:o}=e;return{values:[{kind:g().FormulaContextValueKind.ContextValue,id:y().GF,value:{type:"date",value:t}},{kind:g().FormulaContextValueKind.ContextValue,id:y().uM,value:{type:"text",value:(0,f().x9d)(o)}}]}}({completeSprintActionType:n.recurrence.completeSprintActionType,nextSprintDateRange:n.recurrence.nextSprintDateRange});Y.push(...e)}const q=R.create(m.pointer,"client"),X={author:H,automationModel:m,actionModels:E,contextType:n.type,formulaVariableResolution:{executingUserPointer:H,executingUserTimeZone:(0,b().P)(),thisPageBlockModel:G},values:Y,executeEffectMap:L,executeContextualFormula:async(e,t)=>{if(!t)return{value:{type:"undefined"}};const o=Date.now()+U;return await d.executeFormulaAsync(t,{...e,depth:0,throwOnDownstreamParseFailures:!0,handleDataRequest:W,intl:n.intl,resultCache:new Map,regExpCache:new Map,userTimeZone:(0,b().P)(),visitedProperties:new Set,formulaTimeoutTimestampMs:o,experimentService:P().default,spaceId:B})},formulasModule:d,handleDataRequest:W,loadRecordModel:n.parentRecordStore.loadRecordModel,makeGetRecordModelFn:async e=>Promise.resolve(n.parentRecordStore.getRecordModel),userTimeZone:(0,b().P)(),intl:n.intl,depth:0,throwOnDownstreamParseFailures:!0,visitedProperties:new Set,resultCache:new Map,regExpCache:new Map,eventTracker:(0,I().ik)(r),runtimeRecordPointerSet:new(x().d),runtimeStats:q,spaceIdCreator:await r.idCreator.getSpaceIdCreator(B),simpleFormulasModule:u,useCrdtDefault:(0,k().D8)(n.automationStore.getSpaceStore()),experimentService:P().default,collectionFeatureGates:(0,j().i)(),spaceId:B,eventId:(0,A().Ay)()},$=await p({context:X});R.logNotionPerformance({automationStats:q,environment:r});const J={automationContextType:n.type,automationId:m.id,automationRuntime:q,spaceId:B,userId:null==H?void 0:H.id};if(s().Q.isFail($)){const{error:e}=$;0,v().log({actor:H,data:J,error:e,from:"automationActions",level:"error",type:"AutomationExecutionError"}),(0,I().u4)({environment:r,event:{eventName:"automation_execution_fail",eventProperties:{automation_id:m.id,block_id:O,context_type:n.type,error_type:e.type,execution_duration_ms:q.executionDurationMs,subscription_tier:F,trigger:D}}});const t=function(e){if("query_collection_too_many_items"===e.type)return i().messages.errorQueryCollectionTooManyPages;if("record_pointer_in_trash"===e.type)return i().messages.errorRecordInTrash;return i().messages.genericErrorMessage}(e),o=w().A.formatMessage(t);M().D6({label:o})}else(0,I().u4)({environment:r,event:{eventName:"automation_execution_success",eventProperties:{automation_id:m.id,block_id:O,context_type:n.type,execution_duration_ms:q.executionDurationMs,subscription_tier:F,trigger:D}}}),v().log({actor:H,data:J,from:"automationActions",level:"info",type:"AutomationExecutionSuccess"}),function(e){return!e.every((e=>!(0,a().getActionRegistryItem)(e.type).hasSideEffects))}(E)&&await async function(e){const{actionModels:t,environment:o,saveTransactionInfos:n,clientContext:i,undoCheckpointName:r,numBlocksDuplicated:s,onUndo:c}=e,d=function(e){const{saveTransactionInfos:t,parentRecordStore:o}=e,n={},i=new Set;for(const d of t)if("create_page"===d.type){var a,r;if(i.has(d.pageId))continue;const e=K().md.createChildStore(o,d.collection).getDatabaseType(),t=(e&&V[e])??"page",s=(null===(a=n[t])||void 0===a?void 0:a.numPagesEdited)??0,l=(null===(r=n[t])||void 0===r?void 0:r.numPagesCreated)??0;n[t]={numPagesCreated:l+1,numPagesEdited:s},i.add(d.pageId)}else if("update_pages"===d.type){var s,c;const e=K().md.createChildStore(o,d.collection).getDatabaseType(),t=(e&&V[e])??"page",i=(null===(s=n[t])||void 0===s?void 0:s.numPagesEdited)??0,a=(null===(c=n[t])||void 0===c?void 0:c.numPagesCreated)??0;n[t]={numPagesCreated:a,numPagesEdited:i+d.pageIds.length}}else"publish_site"===d.type?n.page={numPagesCreated:0,numPagesEdited:1}:(0,l().HB)(d);return n}({saveTransactionInfos:n,parentRecordStore:i.parentRecordStore}),u=N({typedAutomationExecutionSummary:d,numBlocksDuplicated:s,intl:i.intl}),p=await async function(e){const{saveTransactionInfos:t,clientContext:o}=e;let n;for(const r of t.slice().reverse()){if("create_page"===r.type){var i;n=K().Bv.createChildStore(o.parentRecordStore,{table:z().ev,id:r.pageId,spaceId:null===(i=r.collection)||void 0===i?void 0:i.spaceId});break}if("update_pages"===r.type){if(1===r.pageIds.length){var a;n=K().Bv.createChildStore(o.parentRecordStore,{table:z().ev,id:r.pageIds[0],spaceId:null===(a=r.collection)||void 0===a?void 0:a.spaceId})}else{const e=K().md.createChildStore(o.parentRecordStore,r.collection);await e.load();const t=e.getParentBlockStore();if(!t)continue;n=t}break}if("publish_site"===r.type)break;(0,l().HB)(r)}return n}({saveTransactionInfos:n,clientContext:i}),m=function(e){let t;for(const o of e){const e=(0,a().getActionRegistryItem)(o.type);if(!1===e.invertible)return!1;!0===e.invertible&&(t=!0)}return t}(t),g=!0===m&&C().xy(r)?()=>{C().JM({environment:o,namedRevisionId:r}),M().N2(),c&&c(r)}:void 0;M().AC({blockToOpenStore:p,item:{label:u},performUndo:g})}({actionModels:E,clientContext:n,environment:r,numBlocksDuplicated:L.getNumBlocksDuplicated(),onUndo:c,saveTransactionInfos:L.saveTransactionInfos,undoCheckpointName:L.undoCheckpointName})}var ie=()=>o(653417),ae=o(296540),re=()=>o(484714),se=()=>o(847249),le=()=>o(401497),ce=()=>o(284371),de=()=>o(725614),ue=()=>o(155004),pe=()=>o(623580),me=()=>o(897119),ge=()=>o(204063),fe=()=>o(2143),ye=()=>o(753199),he=()=>o(997583),ve=()=>o(756279),be=()=>o(991249),xe=()=>o(546461),Se=()=>o(911724),Ae=()=>o(276936),Ce=()=>o(559419),Me=()=>o(656134),ke=()=>o(840094),Te=()=>o(633904),Ie=()=>o(774256),je=()=>o(642054),we=()=>o(383594),Pe=()=>o(285790),_e=()=>o(614505),Be=()=>o(859428),Re=()=>o(553965),Ee=()=>o(486666),De=o(474848);const Oe=(0,D().YK)({icon:{defaultMessage:"Icon",id:"buttonBlock.button.iconHeading"},addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel"}});function Fe(e){const{disabled:t,currentIcon:o,handleIconChange:n,store:i}=e,a=(0,re().v3)(),r=(0,D().tz)(),s=(0,ae.useCallback)((e=>{we().W(a,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:Ee().jv,popupHeight:Ee().GF,isSmallWidth:!1,title:r.formatMessage(Oe.icon),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{n(e),we().I()}},{type:"emoji",onChange:(e,t)=>{n(e),we().I()}}],onDelete:o?()=>{n(void 0),we().I()}:void 0})}),[a,n,r,o]),l=(0,le().IS)((e=>({iconButton:{background:"transparent",boxShadow:e.shadowXS,width:28,height:28},icon:{width:16,height:16}})),[]),c=e=>(0,De.jsx)(Pe().A,{ariaLabel:r.formatMessage(Oe.addIconButtonAriaLabel),style:l.iconButton,iconStyle:l.icon,hasBackground:!0,disabled:t,showShadow:!0,icon:e=>o?(0,De.jsx)(_e().B,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:o,pointer:i.pointer},style:e}):(0,je().A)(e),...(0,Re().A)(e??{},{onClick:s})});return o?c():(0,De.jsx)(Be().A,{renderTooltip:()=>(0,De.jsx)(D().sA,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon"}),delayThreshold:300,render:c})}var Ve=()=>o(805751),Ne=()=>o(79043),Le=()=>o(24157),We=()=>o(366360);function ze(e){const{value:t,onChange:o,wrapStyle:n,onBlur:i,...a}=e,[r,s]=(0,ae.useState)(!1),l=(0,re().v3)(),c=(0,Ne().A)(!0),d=(0,ae.useCallback)((()=>{s(!1),null==i||i()}),[i]),u=(0,ae.useCallback)((e=>o(e.currentTarget.value)),[o]),p=(0,ae.useCallback)((()=>{"empty"!==Le().default.state.mode&&J().IU({environment:l,preventDismissMobileKeyboard:!0}),s(!0)}),[l]);return(0,De.jsx)(Ve().A,{debugName:"AutomationPlainTextInput",capture:r,children:(0,De.jsx)("div",{...c,style:n,children:(0,De.jsx)(pe().A,{...a,onBlur:d,onChange:u,onFocus:p,value:t})})})}function Ke(e){const{onChange:t,store:o,...n}=e,{maybePersistedTransactionActions:i}=(0,We().b)(),a=(0,se().K8)((()=>o.getValue()??""),[o]),r=(0,ae.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{X().KY({store:o,transaction:t,value:e})}}),null==t||t(e)}),[i,t,o]);return(0,De.jsx)(ze,{value:a,onChange:r,...n})}var Ue=()=>o(826352),He=()=>o(71634),Ge=(o(803949),()=>o(617668)),Ye=()=>o(863330),qe=()=>o(340498),Xe=()=>o(813297),$e=()=>o(760217),Je=()=>o(406699),Qe=()=>o(439264),Ze=()=>o(8980),et=()=>o(645873),tt=()=>o(463830),ot=()=>o(170253),nt=()=>o(76190),it=()=>o(383574),at=()=>o(542339),rt=()=>o(895876),st=()=>o(963589),lt=()=>o(301782);function ct(e){return!e.pathIsDead()&&e.isDefined()}function dt(e){if(!(0,l().O9)(e))return[];return e.getTemplatePageStores().filter((e=>ct(e)))}var ut=()=>o(475679),pt=()=>o(310109),mt=()=>o(784892),gt=()=>o(16006),ft=()=>o(684125),yt=()=>o(133518),ht=()=>o(548526),vt=()=>o(194373);function bt(e){const{actionStore:t,currentValue:o,onChange:n,disabled:i,errorMessage:a,errorIcon:r,skipVariables:s}=e,c=(0,re().v3)(),{typecheckResult:d}=(0,xe().YC)(),u=(0,st().X)("automation_updated_error_states"),p=(0,se().uB)(void 0,tt().A),m=t.id,g=(0,yt().F)({actionId:m}),f=(0,se().K8)((()=>o&&"collection"===o.type?K().md.createChildStore(t,o.collection):void 0),[o,t]),y=(0,se().K8)((()=>{if(m&&d&&o&&"variable"===o.type)return(0,pt().getContextValueForActionById)(d,m,o.id)}),[o,d,m]),h=(0,ae.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type||(n(e),p.reset(),(0,lt().CM)(((o,n,i)=>{const a=(0,lt().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,l().O9)(a)&&(0,I().u4)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[n,p,t,c]),v=(0,ae.useCallback)((()=>p.reset()),[p]),b=(0,Me().j)(),x=Boolean(f||y);return(0,De.jsx)(Je().Ay,{buttonPopupStore:p,popupType:b,alignmentToOrigin:Je().yP.Center,placementToOrigin:Je().sx.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),hasActionRequired:!x,tooltipMessage:!u&&a,errorIcon:r,dropdownButtonType:"dropdown",children:f?(0,De.jsx)(gt().A,{store:f}):y?(0,De.jsx)(ft().F,{format:mt().NY.Medium,isSingle:!0,value:y,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,De.jsx)(D().sA,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})}),render:e=>(0,De.jsx)(vt()._,{formulaTypecheckContextValues:g,onChange:h,onClose:v,parentRecordStore:t,selectedTarget:o,skipPages:!0,skipVariables:s})})}var xt=()=>o(763996),St=()=>o(928600),At=()=>o(939740),Ct=()=>o(89924),Mt=()=>o(781697);function kt(e){const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:i,errorMessage:a}=e,r=(0,re().v3)(),{device:s}=r,l=(0,st().X)("automation_updated_error_states"),c=(0,se().K8)((()=>{if(!t)return;if(o){const e=K().Bv.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:z().ev});if(!e.pathIsDead())return e}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),d=(0,Me().j)(),u=(0,se().K8)((()=>dt(t)),[t]),p=Boolean(o);return(0,De.jsx)(Je().Ay,{popupType:d,alignmentToOrigin:Je().yP.Center,placementToOrigin:Je().sx.Bottom,originGap:0,disabled:i,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),style:{minWidth:50},tooltipMessage:!l&&a,dropdownButtonType:"dropdown",children:c&&(p||ct(c))?(0,De.jsx)(gt().A,{store:c}):(0,De.jsx)(D().sA,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,Mt().v)({device:s,width:280});return(0,De.jsx)(St().A,{...o,children:t&&(0,De.jsx)(Tt,{collectionStore:t,templatePageStores:u,parent:e,onChange:n})})}})}function Tt(e){const{collectionStore:t,templatePageStores:o,parent:n,onChange:i}=e,a=(0,re().v3)(),{device:s}=a,l=(0,se().K8)((()=>t.getDefaultTemplatePageStore()),[t]),c=o.map((e=>{const o={key:e.id,render:o=>(0,ae.createElement)(xt().K,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:s.isMobile,locked:!0,isDefault:l===e,onCancelClick:r().lQ,draggable:!1}),action:t=>{i(e.id),n.close()}};return o})),d={key:"empty",render:e=>(0,ae.createElement)(xt().K,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:s.isMobile,locked:!0,onCancelClick:r().lQ,draggable:!1}),action:e=>{i(void 0),n.close()}};return(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,De.jsx)(Ct().A,{...e,title:(0,De.jsx)(D().sA,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select template"})}),items:r().oE([...c,l?void 0:d])}]})}var It=()=>o(929531);function jt(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,errorIcon:r}=e,s=(0,st().X)("automation_updated_error_states"),l=(0,se().K8)((()=>{let e;if("collection"===(null==a?void 0:a.type)){const o=t.getRecordModel(a.collection);e=null==o?void 0:o.getDatabaseType()}return(0,rt().$O)(e)}),[t,a]);return(0,De.jsx)(D().sA,{defaultMessage:"Add {itemType} to{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{collectionPicker:(0,De.jsx)(bt,{actionStore:t,currentValue:a,disabled:o,errorMessage:n,errorIcon:s?r:void 0,onChange:i,skipVariables:!0}),itemType:l}})}function wt(e){const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:a}=e;return(0,De.jsx)(D().sA,{defaultMessage:"as{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,De.jsx)(kt,{collectionStore:t,currentTemplateId:a,disabled:o,errorMessage:n,onChange:i})}})}var Pt=()=>o(84817),_t=()=>o(199378),Bt=()=>o(183558),Rt=()=>o(770586);function Et(e,t){const o=e.getConfigStore().getKeyStore("values"),n=o.getValue(),i=null==n?void 0:n[t];return(0,l().O9)(i)?{valueConfig:i,valueStore:o}:{valueConfig:void 0,valueStore:void 0}}var Dt=()=>o(493823);function Ot(e){const{disabled:t,onClick:o}=e,n=(0,le().IS)((e=>({button:{color:e.text.secondary},children:{...ce().RC,flex:"1 1 auto"}})),[]);return(0,De.jsx)(Dt().p,{disabled:t,disabledFeedback:t,onClick:o,shouldShrink:!0,style:n.button,children:(0,De.jsx)("div",{style:n.children,children:(0,De.jsx)(D().sA,{defaultMessage:"Define another variable…",id:"automations.DefineVariablesAction.addVariableButton.label"})})})}var Ft=()=>o(791089),Vt=()=>o(521732),Nt=()=>o(419830),Lt=()=>o(858163),Wt=()=>o(938818),zt=()=>o(546806),Kt=()=>o(962730),Ut=()=>o(852507),Ht=()=>o(708685),Gt=()=>o(145076),Yt=()=>o(764781),qt=()=>o(311894),Xt=()=>o(105819),$t=()=>o(236262),Jt=()=>o(736767),Qt=()=>o(419357),Zt=()=>o(693954);function eo(){const e=(0,le().IS)((e=>({warningIcon:{fill:e.icon.uiRedPrimary,height:14,width:15}})),[]);return(0,Zt().Q)(e.warningIcon)}function to(){}function oo(e){const{analyzedFormulaOutput:t,onClearClick:o,onDeleteClick:n,onDuplicateClick:i,onEditFormulaClick:a,onEditTextClick:r,onVariableNameChange:s,onVariableNameSubmit:c,variableName:d}=e,{parseErrors:u,type:p,typeErrors:m}=t??{},g=(0,D().tz)(),f=(0,ae.useMemo)((()=>(0,Wt().L)(g,u??[],m??[])),[g,u,m]),y=(0,l().O9)(f),h=(0,st().X)("automation_updated_error_states"),v=(0,Mt().e)({width:265}),b=(0,le().IS)((e=>({formulaErrorCaptionMenuItem:{marginBlockStart:0,paddingBlockStart:0,paddingInline:4},formulaReturnTypeDesktopIcon:{marginBlockStart:4,marginInlineStart:12},formulaReturnTypeCaptionMenuItem:{marginBlock:0,paddingInline:4},formulaErrorCaption:{...h&&y&&{color:e.text.uiRedPrimary}},nameInputMenuItem:{marginBlock:6}})),[h,y]),x=(0,ae.useMemo)((()=>p?(0,Ht().getHumanReadableType)(p):Gt().qY.unknown),[p]),S=(0,re().v3)();(0,Ut().l)((()=>{de().clear({environment:S})}));const A=[];if((0,l().O9)(d)){const e=(0,l().O9)(s);A.push({items:[{action:()=>null,key:"variable-name-input-item",render:t=>(0,De.jsx)(Qt().Ay,{...t,disabled:!e,focus:!0,onChange:s??to,onSubmit:c,placeholder:g.formatMessage(_t().xC),style:b.nameInputMenuItem,value:d})}],key:"variable-name-input-section",render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0})})}if((0,l().O9)(r)||(0,l().O9)(a)||(0,l().O9)(i)){const e=[];(0,l().O9)(r)&&e.push({action:r,key:"variable-name-manage-edit-text",render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)(Ze().I,{icon:Xt().pencilLineIcon}),title:(0,De.jsx)(D().sA,{defaultMessage:"Edit as text",id:"EditVariableMenu.editSimpleFormulaButtonMenuItem.label"})})}),(0,l().O9)(a)&&e.push({action:a,key:"variable-name-manage-edit-formula",render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)(Ze().I,{icon:qt().K}),title:(0,De.jsx)(D().sA,{defaultMessage:"Edit as formula",id:"EditVariableMenu.editFormulaButtonMenuItem.label"})})}),(0,l().O9)(i)&&e.push({action:i,key:"variable-name-manage-duplicate",render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)(Ze().I,{icon:Yt().V}),title:(0,De.jsx)(D().sA,{defaultMessage:"Duplicate",id:"EditVariableMenu.duplicateFormulaButtonMenuItem.label"})})});const t=A.length>0;A.push({items:e,key:"variable-name-manage-actions",render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}if((0,l().O9)(n)||(0,l().O9)(o)){const e=[];(0,l().O9)(n)&&e.push({action:n,key:"variable-name-destructive-delete",render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)(Ze().I,{icon:$t().trashIcon}),title:(0,De.jsx)(D().sA,{defaultMessage:"Delete",id:"EditVariableMenu.deleteFormulaButtonMenuItem.label"})})}),(0,l().O9)(o)&&e.push({action:o,key:"variable-name-destructive-clear",render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)(Ze().I,{icon:$t().trashIcon}),title:(0,De.jsx)(D().sA,{defaultMessage:"Clear variable",id:"EditVariableMenu.clearFormulaButtonMenuItem.label"})})});const t=A.length>0;A.push({items:e,key:"variable-name-destructive-actions",render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}const C=A.length>0,M=[{action:()=>{},key:"variable-name-typecheck-return-type",render:e=>(0,De.jsx)(Jt().A,{...e,caption:(0,De.jsx)("span",{style:b.formulaErrorCaption,children:(0,De.jsx)(D().sA,{defaultMessage:"Type: {formulaType}",id:"EditVariableMenu.formulaReturnType.label",values:{formulaType:(0,De.jsx)(D().sA,{...x})}})}),desktopIconStyle:b.formulaReturnTypeDesktopIcon,dontShrinkIcon:!0,icon:y?(0,De.jsx)(eo,{}):null,shouldWrapCaption:!0,style:b.formulaReturnTypeCaptionMenuItem})}];return y&&M.push({action:()=>{},key:"variable-name-typecheck-error",render:e=>(0,De.jsx)(Jt().A,{...e,caption:(0,De.jsx)(D().sA,{...f}),shouldWrapCaption:!0,style:b.formulaErrorCaptionMenuItem})}),A.push({items:M,key:"variable-name-typecheck",render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0,topBorder:C})}),0===A.length?null:(0,De.jsx)(St().A,{...v,children:(0,De.jsx)(At().Ay,{initialFocus:0,sections:A,type:At().Oh.Vertical})})}var no=()=>o(977345);const io={type:"unknown"};function ao(e){const{type:t}=e,o=(0,le().IS)((e=>({icon:{fill:e.icon.secondary,width:16,height:16}})),[]);return(0,no().Ix)(t??io)(o.icon)}function ro(e){const{analyzedFormulaOutput:t,buttonPopupStore:o,children:n,disabled:i,errorMessage:a,onClearClick:r,onDeleteClick:s,onDuplicateClick:l,onEditFormulaClick:c,onEditTextClick:d,onVariableNameChange:u,variableName:p}=e,{parseErrors:m,typeErrors:g}=t,f=Boolean(a),y=Boolean(m&&m.length>0),h=Boolean(g&&g.length>0),v=f||y||h,b=(0,st().X)("automation_updated_error_states"),x=(0,le().IS)((e=>({button:{color:e.text.secondary,padding:"0 6px",gap:2},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",height:14,width:14},children:{...ce().RC,color:v?e.errorText:e.text.secondary,flex:"1 1 auto",...v&&b&&{fontWeight:ce().Wy.medium}},iconWrap:{marginInlineEnd:2}})),[b,v]),S=(0,Me().j)(),A=(0,se().uB)(o,tt().A),C=(0,ae.useCallback)((()=>a??null),[a]),M=(0,ae.useCallback)((()=>{A.reset()}),[A]);return(0,De.jsx)(Je().Ay,{alignmentToOrigin:Je().yP.Start,buttonPopupStore:A,disabled:i,originGap:0,placementToOrigin:Je().sx.Bottom,popupType:S,renderOrigin:e=>(0,De.jsx)(Be().A,{delayThreshold:0,disableTooltip:!f,placement:Kt().W.Bottom,render:o=>(0,De.jsxs)(Dt().p,{...e,...o,disabled:i,disabledFeedback:i,shouldShrink:!0,style:x.button,children:[(0,De.jsx)("div",{style:x.iconWrap,children:v?(0,De.jsx)(eo,{}):(0,De.jsx)(ao,{type:t.type})}),(0,De.jsx)("div",{style:x.children,children:n}),(0,zt().e)(x.chevronIcon)]}),renderTooltip:C}),render:e=>(0,De.jsx)(oo,{analyzedFormulaOutput:t,onClearClick:r,onDeleteClick:s,onDuplicateClick:l,onEditFormulaClick:c,onEditTextClick:d,onVariableNameChange:u,onVariableNameSubmit:M,variableName:p})})}function so(e){var t,o;const{actionStore:n,variableId:a}=e,r=(0,re().v3)(),{automationStore:s,contextType:c}=(0,xe().EC)(),{disabled:d,maybePersistedTransactionActions:u,suppressActionErrors:p}=(0,We().b)(),m=(0,D().tz)(),{value:g}=(0,et().fJ)(T().T.formulas),{value:f}=(0,et().fJ)(Xe().QV.automationTypecheck),y=(0,se().uB)(void 0,tt().A),h=ae.useRef(null),v=(0,se().uB)(void 0,tt().A),b=(0,nt().n)(s),x=(0,se().K8)((()=>s.getActionStores()),[s]),[S,A]=(0,se().K8)((()=>[n.id,n.getSpaceId()]),[n]),C=(0,yt().F)({actionId:S}),{onTextStoreSelect:M,onTextStoreUnselect:k}=(0,Lt().W)(n),I=(0,se().K8)((()=>n.getConfig()),[n]),w=(0,se().K8)((()=>{var e;return null==I||null===(e=I.values)||void 0===e?void 0:e[a]}),[I,a]),P="formula"===(null==w||null===(t=w.value)||void 0===t?void 0:t.type),_=(0,se().K8)((()=>{if(g&&A)return(0,Ft().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:g.createFormulaDataRequestSyncHandler(n.getRecordModel),spaceId:A,valueTypes:C.slice(0),featureGates:(0,j().i)()},value:null==w?void 0:w.value})}),[A,n.getRecordModel,C,g,null==w?void 0:w.value]),B=(0,ae.useMemo)((()=>!p.includes(n.id)),[p,n]),{errorMessage:R}=(0,ie().useErrorComponentForAction)({actionId:n.id,errorKey:a,shouldShow:B}),E=(0,ae.useCallback)((e=>{const t=e.target.value;u.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableName:i}=e,{valueConfig:a,valueStore:r}=Et(t,n);(0,l().O9)(a)&&(0,l().O9)(r)&&X().zv({data:{[n]:{...a,name:i}},store:r,transaction:o})}({automationActionStore:n,transaction:e,variableId:a,variableName:t})},userAction:"DefineVariablesAction.editVariableName"}),(0,lt().UB)(r,{automationStore:s,automationActionStore:n})}),[n,s,r,u,a]),O=(0,ae.useCallback)((()=>{u.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,transaction:n,variableId:i}=e,{valueConfig:a,valueStore:r}=Et(t,i);if(!(0,l().O9)(a)||!(0,l().O9)(r))return;const s=(0,Bt().Ay)(),c=(0,Rt().v)(o,a.name);X().zv({data:{[s]:{...a,name:c}},store:r,transaction:n}),Q().applyOperation({operation:{args:{id:s},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:n})}({automationActionStore:n,automationActionStores:x,transaction:e,variableId:a})},userAction:"DefineVariables.duplicateVariable"}),y.reset(),(0,lt().UB)(r,{automationStore:s,automationActionStore:n})}),[n,x,s,y,r,u,a]),F=(0,ae.useCallback)((e=>{g&&f&&(u.createAndCommit({perform:t=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableValue:i}=e,{valueConfig:a,valueStore:r}=Et(t,n);(0,l().O9)(a)&&(0,l().O9)(r)&&X().zv({data:{[n]:{...a,value:i}},store:r,transaction:o})}({automationActionStore:n,transaction:t,variableValue:e,variableId:a}),(0,i().clearInvalidVariables)({environment:r,automationStore:s,automationTypecheckModule:f,contextType:c,formulasModule:g,intl:m,isSubscribed:b,transaction:t})},userAction:"DefineVariables.editVariableValue"}),(0,lt().UB)(r,{automationStore:s,automationActionStore:n}))}),[n,s,f,c,r,g,m,b,u,a]),V=(0,ae.useMemo)((()=>{if(null==I||!I.variableIds||1===I.variableIds.length)return function(){y.setState({open:!1}),F({type:"simple",value:void 0})}}),[null==I?void 0:I.variableIds,y,F]),N=(0,ae.useMemo)((()=>{if(!(0,l().O9)(V))return function(){u.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n}=e,{valueStore:i}=Et(t,n);(0,l().O9)(i)&&(X().zv({data:{[n]:null},store:i,transaction:o}),Q().applyOperation({operation:{args:{id:n},command:"listRemove",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:o}))}({automationActionStore:n,transaction:e,variableId:a})},userAction:"DefineVariables.deleteVariable"}),y.reset(),(0,lt().UB)(r,{automationStore:s,automationActionStore:n})}}),[n,s,y,r,u,V,a]),L=(0,ae.useCallback)((async()=>{var e,t;if(P){if(!(await(0,Nt().Cp)()))return}null===(e=h.current)||void 0===e||e.focus(),y.setState({open:!1}),F({type:"simple",value:null==w||null===(t=w.value)||void 0===t?void 0:t.value})}),[y,P,F,null==w||null===(o=w.value)||void 0===o?void 0:o.value]),W=(0,ae.useCallback)((()=>{var e;null===(e=h.current)||void 0===e||e.blur(),y.setState({open:!1}),v.setState({open:!0})}),[y,v]),z=(0,le().IS)((()=>({textInput:{width:"100%"}})),[]),K=(0,ae.useCallback)((()=>{de().clear({environment:r})}),[r]);if(!A||!w||!_)return null;const U=w.name||m.formatMessage(_t().xC),{parseErrors:H=[],typeErrors:G=[]}=_,Y=H.length>0||G.length>0;return(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:7,children:[(0,De.jsx)(Pt().Y1,{direction:"horizontal",width:"hug",children:(0,De.jsx)(ro,{analyzedFormulaOutput:_,buttonPopupStore:y,errorMessage:R,onClearClick:V,onDeleteClick:N,onDuplicateClick:O,onEditFormulaClick:W,onEditTextClick:L,onVariableNameChange:E,variableName:w.name,children:(0,De.jsx)("span",{style:ce().RC,children:U})})}),(0,De.jsx)(Vt().Y,{disabled:d,formulaInputButtonPopupStore:v,formulaTypecheckContextValues:C,onChange:F,onTextStoreSelect:M,onTextStoreUnselect:k,onTextEsc:K,parentRecordStore:n,ref:h,spaceId:A,style:z.textInput,value:w.value,shouldShowErrorStyles:Y}),(0,De.jsx)(Wt().J,{analyzedFormulaOutput:_})]},a)}o(672577);var lo=()=>o(261237),co=()=>o(493733),uo=()=>o(199896),po=()=>o(38337);const mo=(0,D().YK)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"},topOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.topOfPageButtonLabel",defaultMessage:"At top of page"},topOfPageTitle:{id:"automations.DuplicateBlocksAction.topOfPageTitle",defaultMessage:"at top of page"},bottomOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.bottomOfPageButtonLabel",defaultMessage:"At bottom of page"},bottomOfPageTitle:{id:"automations.DuplicateBlocksAction.bottomOfPageTitle",defaultMessage:"at bottom of page"}}),go={before:{icon:(0,o(334003).F)({width:qe().Ev.default}),key:"before",menuItemLabel:mo.aboveMenuItemLabel,title:mo.aboveTitle},after:{icon:(0,o(457056).o)({width:qe().Ev.default}),key:"after",menuItemLabel:mo.belowMenuItemLabel,title:mo.belowTitle},topOfPage:{icon:(0,o(419178).Q)({width:qe().Ev.default}),key:"topOfPage",menuItemLabel:mo.topOfPageMenuItemLabel,title:mo.topOfPageTitle},bottomOfPage:{icon:(0,o(820579).f)({width:qe().Ev.default}),key:"bottomOfPage",menuItemLabel:mo.bottomOfPageMenuItemLabel,title:mo.bottomOfPageTitle}},fo=go.after;function yo(e){const{currentOption:t,disabled:o,onChange:n}=e,i=(0,D().tz)(),a=(0,Me().j)(),r=(0,se().uB)(void 0,tt().A),s=(0,ae.useCallback)((e=>{n&&t.key!==e&&n(e),r.setState({open:!1})}),[r,t,n]);return(0,De.jsx)(Je().Ay,{alignmentToOrigin:Je().yP.Center,buttonPopupStore:r,disabled:o,originGap:0,placementToOrigin:Je().sx.Bottom,popupType:a,render:()=>(0,De.jsx)(ho,{currentOption:t,onChange:s}),renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:o,isCompact:!0,dropdownButtonType:"dropdown",children:i.formatMessage(t.title)})})}function ho(e){const{currentOption:t,onChange:o}=e,n=(0,D().tz)(),i=(0,Mt().e)({maxWidth:360}),a=Object.values(go).map((e=>({key:e.key,render:o=>(0,De.jsx)($e().A,{...o,isChecked:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,De.jsx)(St().A,{...i,children:(0,De.jsx)(At().Ay,{initialFocus:0,sections:[{key:0,render:e=>(0,De.jsx)(Ct().A,{enableActionSheetTitle:!0,...e}),items:a}],type:At().Oh.Vertical})})}function vo(e){const{actionStore:t,disabled:o,contentParentPointer:n,buttonPlacement:a}=e,r=(0,re().v3)(),s=(0,le().IS)((e=>({listWrap:{background:e.contentBackground,borderRadius:5,boxShadow:e.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,cursor:"text",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.text.secondary,color:e.text.tertiary,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),l=(0,se().K8)((()=>K().Bv.createChildStore(t,n)),[t,n]),c=(0,se().K8)((()=>l.getContentStore()),[l]),d=(0,ae.useCallback)((()=>{(c.getValue()??[]).length>0||Q().createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:r,canUndo:!0,perform:e=>{const t=i().insertEmptyTextInDuplicateBlockAction({environment:r,contentStore:c,transaction:e});J().hc({environment:r,store:t}),de().setSelectionAtStart({store:t.getBlockTitleStore()})}})}),[r,c]);if(!c)return null;const u="inline"===(null==a?void 0:a.type);return(0,De.jsx)(uo().A,{store:l,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,De.jsx)(ue().s,{allowSelectionWithin:!0,children:(0,De.jsx)("div",{style:s.listWrap,onClick:d,className:po().CCX,children:(0,De.jsx)(lo().c,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,De.jsx)(co().A,{disabled:o,store:c,emptyPlaceholder:(0,De.jsx)("div",{style:s.emptyPlaceholder,children:u?(0,De.jsx)(D().sA,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…"}):(0,De.jsx)(D().sA,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks here…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})}var bo=()=>o(80979),xo=()=>o(912720),So=()=>o(616175);const Ao=(0,D().YK)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var Co=()=>o(422540),Mo=()=>o(265504);function ko(e){const{actionStore:t,disabled:o,errorMessage:n,includeThisPage:i,onChange:a,target:r,urlBehavior:s}=e,c=(0,re().v3)(),{typecheckResult:d}=(0,xe().YC)(),u=(0,se().uB)(void 0,tt().A),[p,m]=(0,se().K8)((()=>[t.id,t.getSpaceId()]),[t]),g=(0,yt().F)({actionId:p}),f=(0,se().K8)((()=>{if(r)if("variable"===r.type){if(!d)return;const e=(0,pt().getContextValueForActionById)(d,p,r.id);if(e)return{type:"variable",contextValue:e}}else{if("page"===r.type||"url"===r.type)return r;(0,l().HB)(r)}}),[r,d,p]),y=(0,Me().j)(),h=(0,ae.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type&&"url"!==e.type||(a(e),u.reset(),(0,lt().CM)(((o,n,i)=>{const a=(0,lt().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,l().O9)(a)&&(0,I().u4)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[a,u,t,c]),v=(0,ae.useCallback)((()=>u.reset()),[u]);let b;return f?"page"===f.type?b=(0,De.jsx)(gt().A,{store:K().Bv.createChildStore(t,f.page),style:{paddingBlock:1}}):"variable"===f.type?b=(0,De.jsx)(ft().F,{value:f.contextValue,format:mt().NY.Medium,isSingle:!0,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):"url"===f.type?b=(0,De.jsx)("div",{children:f.url}):(0,l().HB)(f):b="allow"===s?(0,De.jsx)(D().sA,{id:"automations.AutomationPagePicker.pagesDropdown.labelWithUrl",defaultMessage:"Select page, form, or URL"}):(0,De.jsx)(D().sA,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"}),(0,De.jsx)(Je().Ay,{buttonPopupStore:u,popupType:y,alignmentToOrigin:Je().yP.Center,placementToOrigin:Je().sx.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:o,isCompact:!0,isError:Boolean(n),hasActionRequired:!Boolean(r),tooltipMessage:n,dropdownButtonType:"dropdown",children:b}),render:e=>(0,De.jsx)(vt()._,{formulaTypecheckContextValues:g,includeThisPage:i,onChange:h,onClose:v,parentRecordStore:t,selectedTarget:r,skipCollections:!0,spaceId:m,urlBehavior:s})})}function To(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:a,urlBehavior:r}=e,s=(0,le().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,De.jsxs)("div",{style:s.title,children:[(0,De.jsx)(D().sA,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,De.jsx)("div",{style:s.picker,children:(0,De.jsx)(ko,{urlBehavior:r,actionStore:t,disabled:o,errorMessage:n,onChange:i,target:a})}),span:e=>(0,De.jsx)("span",{style:s.span,children:e})}})," "]})}function Io(e){const{actionStore:t,disabled:o,onChange:n}=e,i=(0,le().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]),a=(0,se().K8)((()=>t.getOpenPageIn()),[t]);return(0,De.jsx)("div",{style:i.title,children:(0,De.jsx)(D().sA,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,De.jsx)("div",{style:i.picker,children:(0,De.jsx)(jo,{disabled:o,onChange:n,value:a})}),span:e=>(0,De.jsx)("span",{style:i.span,children:e})}})})}function jo(e){const{disabled:t,onChange:o,value:n}=e,i=(0,le().DP)(),a=(0,se().uB)(void 0,tt().A),r=(0,se().K8)((()=>(0,Mo().c)({currentViewType:void 0,theme:i}).find((e=>e.key===n))),[n,i]),s=(0,ae.useCallback)((()=>a.reset()),[a]),l=(0,ae.useCallback)((e=>{e!==(null==r?void 0:r.key)&&o(e),s()}),[s,null==r?void 0:r.key,o]),c=(0,Me().j)();return r?(0,De.jsx)(Je().Ay,{alignmentToOrigin:Je().yP.Center,buttonPopupStore:a,disabled:t,originGap:0,placementToOrigin:Je().sx.Bottom,popupType:c,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:r.title}),render:e=>(0,De.jsx)(wo,{onChange:l,value:n})}):null}function wo(e){const{onChange:t,value:o}=e,n=(0,le().DP)(),i=(0,le().IS)((()=>({menuItem:{paddingBlock:8}})),[]),a=(0,Mt().e)({maxWidth:360,width:280}),r=(0,se().K8)((()=>(0,Mo().c)({currentViewType:void 0,theme:n}).map(((e,n)=>({action:()=>t(e.key),key:n,render:t=>(0,De.jsx)($e().A,{...t,body:e.body,caption:e.caption,isChecked:o===e.key,disabled:!1,icon:e.icon,style:i.menuItem,title:e.title})})))),[t,i.menuItem,n,o]),s=[{key:0,render:e=>(0,De.jsx)(Ct().A,{enableActionSheetTitle:!0,...e}),items:r}];return(0,De.jsx)(St().A,{...a,children:(0,De.jsx)(At().Ay,{initialFocus:0,sections:s,type:At().Oh.Vertical})})}var Po=()=>o(324254),_o=()=>o(811979),Bo=()=>o(946548),Ro=()=>o(574036),Eo=()=>o(125565),Do=()=>o(722872),Oo=()=>o(439616),Fo=()=>o(585293),Vo=()=>o(700250);function No(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:a}=e;return(0,De.jsx)(D().sA,{defaultMessage:"Publish{pagePicker}",id:"automations.PublishSiteAction.header.title",values:{pagePicker:(0,De.jsx)(ko,{actionStore:t,disabled:o,errorMessage:n,includeThisPage:!0,onChange:i,target:a})}})}function Lo(){const e=(0,re().Y0)(),t=(0,le().IS)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginLeft:0,marginRight:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginLeft:0,paddingLeft:8,minWidth:"auto",background:"transparent"}})),[]),o={type:"public_permission",role:"reader",expiration_timestamp:void 0},n=[{key:"linkExpiration",render:e=>(0,De.jsx)(Oo().A,{...e,disabled:!1,permissionItem:o,onChange:e=>{},hideIcon:!0}),action:()=>{}},{key:"enableQna",render:o=>(0,De.jsx)(Ro().A,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,De.jsx)(D().sA,{defaultMessage:"Enable QnA",id:"automations.PublishSiteAction.action.siteSettingsEnableQna.title"}),on:!0,onClick:()=>{}}),action:()=>{}},{key:"enableSeo",render:o=>(0,De.jsx)(Ro().A,{...o,isMobile:e.isMobile,buttonStyle:t.button,textWrapperStyle:t.itemInnerContainer,title:(0,De.jsx)(D().sA,{defaultMessage:"Search engine indexing",id:"automations.PublishSiteAction.action.siteSettingsEnableSEO.title"}),on:!1,onClick:()=>{}}),action:()=>{}}],i=(0,r().oE)([{key:0,render:e=>(0,De.jsx)(Ct().A,{style:t.sectionMenuItem,...e}),items:n}]);return(0,De.jsxs)("div",{style:t.outerContainer,children:[(0,De.jsx)("label",{children:(0,De.jsx)(D().sA,{defaultMessage:"Settings",id:"automations.PublishSiteAction.action.siteSettingsTitle"})}),(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,sections:i,initialFocus:void 0,resetFocusOnMouseOut:!0,style:t.siteSettingsContainer})]})}function Wo(){const e=(0,le().IS)((e=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${e.regularDividerColor}`,padding:2},sectionMenuItem:{padding:"6px 2px"}})),[]),t=[{key:"theme",render:t=>(0,De.jsx)(zo,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"header",render:t=>(0,De.jsx)(Ho,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"googleAnalytics",render:t=>(0,De.jsx)(Yo,{...t,style:e.sectionMenuItem}),action:()=>{}}],o=(0,r().oE)([{key:0,render:t=>(0,De.jsx)(Ct().A,{style:e.sectionMenuItem,...t}),items:t}]);return(0,De.jsxs)("div",{style:e.outerContainer,children:[(0,De.jsx)("label",{children:(0,De.jsx)(D().sA,{defaultMessage:"Site customization",id:"automations.PublishSiteAction.action.siteCustomizationTitle"})}),(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,sections:o,initialFocus:void 0,resetFocusOnMouseOut:!0,style:e.siteSettingsContainer})]})}const zo=ae.forwardRef(((e,t)=>{const o=(0,re().Y0)(),n=(0,ae.useCallback)((e=>{}),[]),i="system";return(0,De.jsx)(_o().A,{...e,popupType:o.isMobile?Je().z7.SlideUp:Je().z7.Popup,renderOrigin:t=>(0,De.jsx)(Fo().a,{...(0,Re().A)(e,t),title:(0,De.jsx)(D().sA,{defaultMessage:"Theme",id:"automations.PublishSiteAction.action.siteCustomization.themeTitle"}),right:(0,De.jsxs)(De.Fragment,{children:[(0,De.jsx)(Ko,{value:i}),(0,De.jsx)(Ze().I,{icon:Po().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]})}),alignmentToOrigin:Vo().MY.End,placementToOrigin:Vo().UV.Bottom,render:e=>(0,De.jsx)(Uo,{value:i,onChange:n,onClose:()=>{e.close()}})})}));function Ko(e){const{value:t}=e,o=(0,le().IS)((e=>({container:{color:e.text.secondary}})),[]);return t?"system"===t?(0,De.jsx)(Eo().A,{style:o.container,children:(0,De.jsx)(D().sA,{defaultMessage:"System",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.system"})}):"light"===t?(0,De.jsx)(Eo().A,{style:o.container,children:(0,De.jsx)(D().sA,{defaultMessage:"Light",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.light"})}):"dark"===t?(0,De.jsx)(Eo().A,{style:o.container,children:(0,De.jsx)(D().sA,{defaultMessage:"Dark",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.dark"})}):void(0,l().HB)(t):null}function Uo(e){const{value:t,onChange:o,onClose:n}=e,i=(0,re().Y0)(),a=(0,ae.useCallback)((e=>{void 0!==e&&e!==t&&o(e),n()}),[t,o,n]),r=["system","light","dark"].map((e=>({key:e,render:t=>(0,De.jsx)($e().A,{...t,title:(0,De.jsx)(Ko,{value:e})}),action:()=>{a(e)}}))),s=[{key:0,render:e=>(0,De.jsx)(Ct().A,{...e}),items:r}];return(0,De.jsx)(St().A,{menuType:i.isMobile?Do().gu.ActionSheet:Do().gu.Popup,width:240,children:(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,initialFocus:r.findIndex((e=>e.key===t)),sections:s})})}zo.displayName="ThemeCustomizationItem";const Ho=ae.forwardRef(((e,t)=>{const o=(0,re().Y0)(),n=(0,ae.useCallback)((e=>{}),[]),i={};return(0,De.jsx)(_o().A,{...e,popupType:o.isMobile?Je().z7.SlideUp:Je().z7.Popup,renderOrigin:t=>(0,De.jsx)(Fo().a,{...(0,Re().A)(e,t),title:(0,De.jsx)(D().sA,{defaultMessage:"Header",id:"automations.PublishSiteAction.action.siteCustomization.headerTitle"}),right:(0,De.jsxs)(De.Fragment,{children:[(0,De.jsx)(D().sA,{defaultMessage:"Default",id:"automations.PublishSiteAction.action.siteCustomization.headerDefaultValue"}),(0,De.jsx)(Ze().I,{icon:Po().arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]})}),alignmentToOrigin:Vo().MY.End,placementToOrigin:Vo().UV.Bottom,render:e=>(0,De.jsx)(Go,{value:i,onChange:n,onClose:()=>{e.close()}})})}));function Go(e){const{value:t}=e,o=(0,re().Y0)(),n=[{key:"breadcrumbs",render:e=>(0,De.jsx)(Fo().a,{...e,title:(0,De.jsx)(D().sA,{defaultMessage:"Breadcrumbs",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionBreadcrumb"}),right:(0,De.jsx)(Bo().A,{...e,on:!(null!=t&&t.hideBreadcrumbs)})}),action:()=>{}},{key:"search",render:e=>(0,De.jsx)(Fo().a,{...e,title:(0,De.jsx)(D().sA,{defaultMessage:"Search",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionSearch"}),right:(0,De.jsx)(Bo().A,{...e,on:!(null!=t&&t.hideSearch)})}),action:()=>{}},{key:"watermark",render:e=>(0,De.jsx)(Fo().a,{...e,disabled:!0,title:(0,De.jsx)(D().sA,{defaultMessage:"Watermark",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionWatermark"}),right:(0,De.jsx)(Bo().A,{...e,disabled:!0,on:!(null!=t&&t.hideWatermark)})}),action:()=>{}}],i=[{key:0,render:e=>(0,De.jsx)(Ct().A,{...e}),items:n}];return(0,De.jsx)(St().A,{menuType:o.isMobile?Do().gu.ActionSheet:Do().gu.Popup,width:240,children:(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,initialFocus:n.findIndex((e=>e.key===t)),sections:i})})}Ho.displayName="HeaderCustomizationItem";const Yo=ae.forwardRef(((e,t)=>{const o=(0,ae.useRef)(null);return(0,De.jsx)(Fo().a,{...e,title:(0,De.jsx)(D().sA,{defaultMessage:"Google Analytics",id:"automations.PublishSiteAction.action.siteCustomization.googleAnalyticsTitle"}),right:(0,De.jsx)(qo,{ref:o,value:undefined}),onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}})}));Yo.displayName="GoogleAnalyticsCustomizationSetting";const qo=ae.forwardRef(((e,t)=>{const{value:o}=e,[n,i]=(0,ae.useState)(!1),a=!1,r=(0,le().IS)((e=>({inputContainer:{background:e.surface.page,borderRadius:4,boxShadow:n?"0px 0px 0px 1px #2383E2 inset, 0px 0px 0px 2px rgba(35, 131, 226, 0.35)":`${e.regularDividerColor} 0px 0px 0px 1px inset`,height:28,padding:8,fontWeight:ce().Wy.regular,fontSize:14,lineHeight:1.3,color:e.text.secondary},input:{marginLeft:-6,paddingLeft:0,color:e.text.primary},wrapper:{paddingTop:4,paddingBottom:4}})),[a,n]);return(0,De.jsx)("div",{style:r.wrapper,children:(0,De.jsx)(pe().A,{ref:t,type:"text",style:r.inputContainer,inputStyle:r.input,value:o,onChange:e=>{},format:pe().C.Transparent,onFocus:()=>i(!0),onBlur:()=>i(!1),left:"G-",disabled:a})})}));qo.displayName="GoogleAnalyticsInput";o(430670);var Xo=()=>o(79118),$o=()=>o(617871),Jo=()=>o(90907),Qo=()=>o(704152),Zo=()=>o(554509),en=()=>o(898125),tn=()=>o(53137),on=()=>o(5269);function nn(e){const t=(0,re().v3)();(0,se().K8)((()=>{(0,f().Fbh)(e).forEach((e=>{new(K().LU)(t,{table:S().oo,id:e},{userId:e}).isDefined()}))}),[t,e])}var an=()=>o(905209),rn=()=>o(50401),sn=()=>o(999638),ln=(o(908872),()=>o(970013)),cn=()=>o(842599),dn=()=>o(187174),un=()=>o(931121),pn=()=>o(778078),mn=()=>o(453697),gn=()=>o(742971),fn=()=>o(856952),yn=()=>o(106628),hn=()=>o(361330),vn=()=>o(970585),bn=()=>o(576241),xn=()=>o(674300),Sn=()=>o(644484),An=()=>o(848401);function Cn(e){let{handleRemoveToken:t,token:o,format:n,style:i,addQuotes:a,renderAvatar:r,isDisabled:s}=e;const l=(0,le().DP)();if(!(0,cn().DT)(o))return null;const c=a?`“${o}”`:o;return(0,De.jsx)(An().Ay,{title:c,format:n??mt().NY.Small,renderAvatar:r||(e=>(0,Sn().g)({width:e,height:e,padding:2,marginRight:6})),showRemoveButton:Boolean(t)&&!s,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},style:{background:l.accentColors.gray[75],...i},shouldShrink:!0,isSingle:!1})}var Mn=()=>o(436876);const kn=["gmail.com","yahoo.com","outlook.com"],Tn=["com","net","org"];var In=()=>o(64e3),jn=()=>o(480095),wn=()=>o(320865),Pn=()=>o(996027),_n=()=>o(231713),Bn=()=>o(629203);function Rn(e){let{email:t,disabled:o,menuArgs:n}=e;const i=(0,Bn().U)();return(0,De.jsx)($e().A,{...n,title:(0,De.jsx)(Cn,{token:t,format:mt().NY.Inline,addQuotes:!0,style:{background:void 0,padding:void 0}}),disabled:o,style:o?i.disabledMenuItem:void 0,isTokenTitle:!0})}function En(e){let{token:t,disabled:o,menuArgs:n,type:i}=e;const a=(0,Bn().U)(),r=(0,le().DP)();return(0,De.jsx)($e().A,{...n,title:(0,De.jsx)(Mn().A,{token:t,type:i,format:mt().NY.Inline,style:{color:r.darkTextColor,background:void 0,padding:void 0}}),disabled:o,style:{...o?a.disabledMenuItem:void 0},isTokenTitle:!0})}var Dn=()=>o(764880),On=()=>o(448693);function Fn(e){let{annotation:t,disabled:o,getRecordModel:n,menuArgs:i}=e;const a=(0,Bn().U)(),r=(0,se().K8)((()=>{if((0,Ft().isAnnotationSimpleValueToken)(t)&&(0,f().rie)(t)){const e=(0,f().NcG)(t);return e?(0,Dn().xC)({pointer:{table:S().oo,id:e},getRecordModel:n,getRecordValue:void 0}):void 0}}),[t,n]);return null!=r&&r.asActor&&r.table===S().oo?(0,De.jsx)($e().A,{...i,title:(0,De.jsx)(Vn,{actor:r}),disabled:o,style:o?a.disabledMenuItem:void 0,isTokenTitle:!0}):null}function Vn(e){let{actor:t}=e;const o=(0,le().IS)((e=>({root:{margin:"4px 0"},actor:{margin:"0 10px 0 0"},email:{color:e.actionMenuButtonTextColor,margin:"0 0 0 26px"}})),[]),n=(0,se().K8)((()=>t.getName()),[t]),i=(0,se().K8)((()=>t.getEmail()),[t]);return(0,De.jsxs)("div",{style:o.root,children:[(0,De.jsx)(On().Ay,{actor:t,format:mt().NY.Medium,shouldShrink:!0,isSingle:!1,style:o.actor},t.id),n&&(0,De.jsx)(An().Ay,{title:i,format:mt().NY.ExtraSmall,isSingle:!1,style:o.email})]})}function Nn(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,getRecordModel:a,isDisabled:s,limit:l,menuProps:c,onChange:d,onClose:u,onFormulaButtonClick:p,showFormulaValueItems:m=!1,value:y,pageProperties:h,parentRecordStore:v,showInputErrorStyles:b}=e,x=(0,re().Y0)(),S=(0,le().DP)(),{errorMessage:A,isLoading:C,menuListStore:M,noResultsMessage:k,searchInput:T,userItems:I,valueItems:j,pagePropertyItems:w,emailItems:P}=function(e){var t,o,n;const{action:i,formulaTypecheckContextValues:a,formulaValueContext:s,isDisabled:l=!1,limit:c,onChange:d,onClose:u,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:m,value:y,pageProperties:h,parentRecordStore:v,showInputErrorStyles:b}=e,x=(0,re().v3)(),S=(0,D().tz)(),{collectionStore:A,property:C}="collection"===s.type?s:{collectionStore:void 0,property:void 0},M=v.getRecordModel,k=(0,Nt().pg)(s),T=k(m,"first"),I=a.filter((e=>(0,no().o5)(e.type,{type:"person"}))),j=(0,le().IS)((e=>({personToken:{background:e.accentColors.gray[75],borderRadius:"6px"},formulaValueToken:{background:e.buttonBackground},searchInput:{maxHeight:6*parseInt(fn().sA,10),width:"100%",margin:0,...b&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},clearButton:{height:20},clearButtonIcon:{height:15,width:15,fill:e.lightIconColor},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[b]),[w,P]=(0,ae.useState)(""),_=(0,ae.useRef)(null),B=(0,ae.useRef)(""),R=(0,se().uB)(void 0,vn().A),E=(0,se().K8)((()=>(null==A?void 0:A.getSchema())??{}),[A]),O=(0,se().K8)((()=>{if(E&&C){const e=E[C];if(e&&(0,ln().sO)(e))return 1===e.limit}return!1}),[E,C]),[F]=(0,dn().Yb)((async()=>{const e=w?(0,pn().Ay)(w,I,(e=>e.kind===g().FormulaContextValueKind.ContextValue?e.name:"")):I,t=w?(0,pn().Ay)(w,h,(e=>(0,f().GCe)(e).name??"")):h,o=await yn().T.searchActions.load(),n=await o.searchVisibleSpaceUsers({environment:x,query:w,membersOnly:!1}),i=(0,Ft().fromSimpleFormulaArrayValue)(null==y?void 0:y.value).reduce(((e,t)=>(t&&(0,Ft().isAnnotationSimpleValueToken)(t)&&(0,f().rie)(t)&&e.push(t[1]),e)),[]);let a=0,r=n[a];const s=[];for(;r&&s.length<20;)i.includes(r.id)||s.push(r.id),a+=1,r=n[a];return{valueResults:e,userResults:s,pagePropertyResults:t}}),[x,w,I,null==y?void 0:y.value,h],{debounce:hn().tu}),V=(0,ae.useCallback)((()=>{var e;P(""),null===(e=_.current)||void 0===e||e.focus(),R.setState({...R.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[R]),N=(0,ae.useCallback)(((e,t)=>{d(e||y,t||i)}),[i,d,y]),L=(0,ae.useCallback)((e=>{const t=k(e,"last");N({type:"simple",value:(0,Ft().toSimpleFormulaArrayValue)(t)}),V()}),[k,N,V]),W=(0,ae.useCallback)((()=>{L(T.slice(0,T.length-1))}),[T,L]),z=(0,ae.useCallback)((e=>{null==L||L((0,Ft().simpleFormulaValueWithoutToken)(T,e))}),[T,L]),K=Boolean(c&&T.length>=c),H=r().oE(T.map(((e,t)=>{if("boolean"==typeof e)return null;if("string"==typeof e)return(0,De.jsx)(Cn,{handleRemoveToken:z,token:e,isDisabled:l,renderAvatar:t=>(0,mn().A)({avatar:{email:e},style:{marginRight:4}}),style:j.personToken},t);if((0,f().rie)(e))return(0,De.jsx)(bn().A,{handleRemoveToken:z,token:e,isDisabled:l,style:j.personToken,preventOnClickPropagation:!0},t);if((0,f().s1Y)(e))return(0,De.jsx)(xn().A,{formulaTypecheckContextValues:a,handleRemoveToken:z,isDisabled:l,style:j.formulaValueToken,token:e,preventOnClickPropagation:!0},t);if((0,f().iz3)(e)){var o;const n=(0,f().GCe)(e);return(0,De.jsx)(Mn().A,{type:null===(o=E[n.property])||void 0===o?void 0:o.type,isDisabled:l,handleRemoveToken:z,token:e},t)}return null}))),G=new Set(r().oE(T.map((e=>(0,Ft().isAnnotationSimpleValueToken)(e)&&(0,f().s1Y)(e)&&(0,f().iVq)(e).id)))),Y=new Set(r().oE(T.map((e=>(0,Ft().isAnnotationSimpleValueToken)(e)&&(0,f().rie)(e)&&(0,f().NcG)(e))))),q=r().oE(((null===(t=F.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===g().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!G.has(t))return{action:"append",currentSimpleFormulaValueTokens:T,isDisabled:l||K,id:t,getRecordModel:M,setCurrentTokens:L,value:e}}))),X=r().oE(((null===(o=F.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=Y.has(e);if(t)return;const o=(0,f().P4h)(e);return{action:()=>{t?z(o):L([...T,o]),O&&U().default.afterNextFlush((()=>{u()}))},annotation:o,getRecordModel:M,id:e,isDisabled:l||K,userId:e,isSelected:t}}))),$=new Set(T.filter((e=>(0,Ft().isAnnotationSimpleValueToken)(e)&&(0,f().iz3)(e))).map((e=>(0,f().GCe)(e).property))),J=r().oE(null===(n=F.value)||void 0===n?void 0:n.pagePropertyResults.map((e=>{var t;const o=(0,f().GCe)(e);if(!$.has(o.property))return{id:o.property,type:null===(t=E[o.property])||void 0===t?void 0:t.type,isDisabled:l||K,action:()=>{L([...T,e])},propertyAnnotation:e}}))),Q=(0,ae.useCallback)((e=>{(0,cn().DT)(e)&&L([...T,e])}),[T,L]),Z=(0,ae.useCallback)((()=>{Q(B.current)}),[Q]);(0,ae.useEffect)((()=>{B.current=w}),[w]),(0,ae.useEffect)((()=>{const e=_.current;return e&&e.addEventListener("blur",Z),()=>{e&&e.removeEventListener("blur",Z)}}),[Z]);const ee=(0,cn().DT)(w)?[w]:[];if(0===ee.length){const[e,t]=w.split("@");if(t){const[o,n]=t.split(".");(!n||n.length<=1)&&ee.push(...Tn.map((t=>`${e}@${o}.${t}`)).filter(cn().DT))}else ee.push(...kn.map((t=>`${e}@${t}`)).filter(cn().DT))}const te=ee.map((e=>({action:()=>Q(e),isDisabled:l||K,email:e}))),oe=[...q,...X,...J,...te],ne=(0,st().X)("gmail_action_formula_recipients");return{errorMessage:F.error&&S.formatMessage(gn().D.somethingWentWrong),header:S.formatMessage(gn().D.genericMenuHeader),isLoading:!F.value&&!F.error,menuListStore:R,noResultsMessage:0===oe.length&&F.value&&S.formatMessage(gn().D.noResults),searchInput:e=>(0,De.jsx)(fn().Ay,{ref:_,style:j.searchInput,right:(0,De.jsxs)(Pt().Y1,{direction:"horizontal",style:j.actionButtonGroup,children:[ne&&p&&(0,De.jsx)(rn().F,{disabled:l,onClick:e=>{e.stopPropagation(),p(e)},value:y}),(0,De.jsx)(Pe().A,{ariaLabel:S.formatMessage({id:"automations.emailRecipients.clear",defaultMessage:"Clear"}),disabled:l,disabledFeedback:l,onClick:e=>{e.stopPropagation(),L([])},style:j.clearButton,icon:un().J,iconStyle:j.clearButtonIcon})]}),disabled:l||K,format:fn().le.FilterValue,onChange:e=>P(e.target.value),onRemoveLastToken:W,placeholder:"",onClick:e,tokens:H,value:w}),userItems:X,valueItems:q,pagePropertyItems:J,emailItems:te}}({action:t,formulaTypecheckContextValues:n,formulaValueContext:i,isDisabled:s,limit:l,onChange:d,onClose:u,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:o,value:y,pageProperties:h,parentRecordStore:v,showInputErrorStyles:b})||{},_=(0,ae.useMemo)((()=>j&&m?j.map((e=>{const{annotation:t,itemAction:o}=(0,_n().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,De.jsx)(Pn().A,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:n,menuArgs:o,style:{background:void 0,color:S.darkTextColor,padding:void 0},parentRecordStore:v}),action:o}})):[]),[j,m,n,S,v]),B=(0,ae.useMemo)((()=>I?I.map((e=>({key:e.userId,render:t=>(0,De.jsx)(Fn,{annotation:e.annotation,disabled:e.isDisabled,menuArgs:t,getRecordModel:a||e.getRecordModel}),action:e.action}))):[]),[a,I]),R=[..._,...(0,ae.useMemo)((()=>w?w.map((e=>({key:e.id,render:t=>(0,De.jsx)(En,{disabled:e.isDisabled,menuArgs:t,type:e.type,token:e.propertyAnnotation}),action:e.action}))):[]),[w])],E=[];R.length>0&&E.push({key:"properties",render:e=>(0,De.jsx)(Ct().A,{...e,title:"Property",topBorder:!1}),items:R}),B.length>0&&E.push({key:"users",render:e=>(0,De.jsx)(Ct().A,{...e,title:"Person",topBorder:R.length>0}),items:B});const O=(0,ae.useMemo)((()=>P?P.map((e=>({key:e.email,action:e.action,render:t=>(0,De.jsx)(Rn,{email:e.email,disabled:e.isDisabled,menuArgs:t})}))):[]),[P]);let F;O.length>0&&E.push({key:"emails",render:e=>(0,De.jsx)(Ct().A,{...e,title:"Email",topBorder:R.length>0||B.length>0}),items:O}),F=x.isMobile?{menuType:Do().gu.Modal,right:(0,De.jsx)(jn().DoneMenuText,{}),minWidth:"100%"}:{menuType:Do().gu.Popup,maxHeight:"50vh",minWidth:"100%",disableHeaderBorder:!0};const V={width:"260px"},N=(0,De.jsxs)(De.Fragment,{children:[A&&(0,De.jsx)(Ct().A,{style:V,children:(0,De.jsx)(In().A,{title:A})}),k&&(0,De.jsx)(Ct().A,{style:V,children:(0,De.jsx)(In().A,{title:k})}),C&&(0,De.jsx)(Ct().A,{style:V,children:(0,De.jsx)(wn().A,{})}),E.length>0&&(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,initialFocus:0,sections:E,store:M,style:V})]});return{searchInput:T,innerComponents:N,emailRecipientsMenu:(0,De.jsx)(St().A,{...F,...c,children:N})}}function Ln(e){const{currentValue:t,onChange:o,parentRecordStore:n,spaceId:i,formulaTypecheckContextValues:a,disabled:r}=e;return"formula"===(null==t?void 0:t.type)?(0,De.jsx)(Kn,{parentRecordStore:n,spaceId:i,value:t,formulaTypecheckContextValues:a,isDisabled:r,onChange:o}):(0,De.jsx)(Wn,{...e})}function Wn(e){const{currentValue:t,collectionStore:o,onChange:n,formulaTypecheckContextValues:i,limit:a,pageProperties:r,disabled:s,parentRecordStore:c,errorMessage:d}=e,u=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},p={menuType:Do().gu.Popup},m=(0,se().K8)((()=>(0,Ft().fromSimpleFormulaArrayValue)(null==t?void 0:t.value)),[t]),{searchInput:g,emailRecipientsMenu:f}=Nn({currentSimpleFormulaValueTokens:m,formulaTypecheckContextValues:i,formulaValueContext:u,limit:a,menuProps:p,onChange:n,onClose:window.parent.close,onFormulaButtonClick:e=>{e.stopPropagation(),n({type:"formula",value:null==t?void 0:t.value})},showFormulaValueItems:!0,showGenericHeader:!0,value:t,pageProperties:r,isDisabled:s,parentRecordStore:c,showInputErrorStyles:(0,l().O9)(d)});return(0,De.jsx)(Je().Ay,{renderOrigin:e=>{let{onClick:t}=e;return null==g?void 0:g(t)},popupType:Je().z7.Popup,render:()=>f})}const zn=[{type:"person"},{type:"text"},{type:"array",of:{type:"person"}},{type:"array",of:{type:"text"}}];function Kn(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i,onChange:a,isDisabled:r}=e,s=(0,le().IS)((e=>({containerWrap:{width:"100%"},formulaText:{whiteSpace:"pre-wrap",cursor:"pointer"},scroller:{flexGrow:1,width:"100%"},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",width:"100%"},wrap:{background:e.inputBackground,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:"4px 8px"},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[]),l=async e=>{e.stopPropagation();await(0,Nt().Cp)()&&(null==a||a({type:"simple",value:null==i?void 0:i.value}))},c=(0,se().uB)(void 0,tt().A),d=(0,ae.useCallback)((()=>c.setState({open:!1})),[c]);return(0,De.jsx)(Je().Ay,{buttonPopupStore:c,renderOrigin:e=>(0,De.jsx)("div",{...e,style:s.containerWrap,children:(0,De.jsx)(Pt().Y1,{align:"center",className:po().CCX,direction:"vertical",gap:4,style:s.wrap,children:(0,De.jsxs)("div",{style:s.textWrap,children:[(0,De.jsx)(fe().H,{style:s.scroller,type:ve().A.Y,children:(0,De.jsx)("div",{style:s.formulaText,children:(0,De.jsx)(an().$,{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i})})}),(0,De.jsx)("div",{children:(0,De.jsx)(Pt().Y1,{direction:"horizontal",gap:2,style:s.actionButtonGroup,children:(0,De.jsx)(rn().F,{disabled:r,onClick:l,value:i})})})]})})}),popupType:Je().z7.Popup,render:()=>(0,De.jsx)(sn().A,{allowedReturnTypes:zn,disabled:r,formulaTypecheckContextValues:t??[],onChange:a,onClose:d,parentRecordStore:o,value:i,spaceId:n})})}var Un=()=>o(148307),Hn=()=>o(218275),Gn=()=>o(158661),Yn=()=>o(510683),qn=()=>o(633457),Xn=()=>o(678553),$n=()=>o(47373),Jn=()=>o(47170);const Qn=(0,D().YK)({gmailAccountMenuPickerHeader:{defaultMessage:"Select Account",id:"automations.gmailAccountPicker.menuHeader"},gmailAccountMenuPickerHeaderInvalidAccount:{defaultMessage:"Invalid Account",id:"automations.gmailAccountPicker.menuHeaderInvalidAccount"},gmailAccountMenuPickerHeaderInvalidAccountTooltip:{defaultMessage:"Connect a valid account or delete this step",id:"automations.gmailAccountPicker.menuHeaderInvalidAccountTooltip"},addGmailAccountLabel:{id:"automations.gmailAccountPicker.setupAnotherGmailAccount.label",defaultMessage:"Add Gmail Account"},manageAccountInfoCaption:{id:"automations.gmailAccountPicker.manageAccountInfo.caption",defaultMessage:"Manage connected accounts in the “My Connections” tab of Settings"},connectGmailAccountMobileLabel:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountMobileCaption:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.caption",defaultMessage:"Open desktop or web app to connect"},connectGmailAccountLabel:{id:"automations.gmailAccountPicker.connectGmailAccount.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountCaption:{id:"automations.gmailAccountPicker.connectGmailAccount.caption",defaultMessage:"Allow Notion to send email on your behalf"}});function Zn(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,errorMessage:i,onAccountChange:a}=e,r=(0,re().v3)(),s=(0,re().Y0)(),l=(0,Jn().O)(),c="collection_view_settings",d=(0,se().K8)((()=>tn().A.integrations.state.find((e=>e.id===$o().eg))),[]),u=Boolean(i),p=(0,se().uB)(void 0,tt().A),m=(0,ae.useCallback)((e=>{a(e),(0,I().u4)({environment:r,event:{eventName:"gmail_action_account_click",eventProperties:{}}}),p.reset()}),[a,p,r]),g=(0,Me().j)(),f=(0,Mt().e)(),y=(0,le().IS)((e=>({infoItem:{color:e.text.secondary,cursor:"default"},connectAccount:{paddingRight:"32px"},manageAccountCaption:{color:e.text.tertiary},errorText:{color:e.errorText}})),[]);if(!d)return null;const h=[{items:o.map(((e,o)=>({action:()=>null,key:e.id,render:()=>{const o=(null==t?void 0:t.id)===e.id;return(0,De.jsx)($e().A,{focused:(null==t?void 0:t.id)===e.id,onClick:async()=>{if(l)if(o&&u){const e=await ei(r,d,l,c);if("success"!==e.status)return void p.reset();m(e.externalAuthentication.id)}else m(e.id)},title:e.account_name,left:(0,De.jsx)(mn().A,{avatar:{email:e.account_name}}),isChecked:!u&&o,right:u&&o?(0,De.jsx)(Ze().I,{icon:Gn().exclamationMarkTriangleFillSmallIcon,size:"sm"}):void 0,style:{...o&&u&&y.errorText},bodyStyle:{minWidth:"280px"}},e.id)}}))),key:"gmailAccounts",render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0})}];h.push({key:"add-another-gmail-account-section",items:[{key:"add-another-gmail-account-item",action:async()=>{if(!l)return;const e=await ei(r,d,l,c);"success"===e.status&&(a(e.externalAuthentication.id),p.reset())},render:e=>(0,De.jsx)($e().A,{...e,left:(0,De.jsx)(Ze().I,{icon:Ge().plusIcon}),right:(0,De.jsx)(Ze().I,{icon:Hn().arrowUpRightSquareSmallIcon,size:"sm",color:"tertiary"}),title:(0,De.jsx)(D().sA,{...Qn.addGmailAccountLabel})})}],render:e=>(0,De.jsx)(Ct().A,{...e,topBorder:!0})}),h.push({key:"manage-account-info-section",items:[{key:"manage-account-info-item",action:()=>null,render:e=>(0,De.jsx)($e().A,{...e,style:y.infoItem,focused:!1,caption:(0,De.jsx)(Xn().CU,{caption:(0,De.jsx)(D().sA,{...Qn.manageAccountInfoCaption}),shouldWrapCaption:!0,captionStyle:y.manageAccountCaption})})}],render:e=>(0,De.jsx)(Ct().A,{...e,topBorder:!0})});const v={key:"connect-gmail-account-mobile-item",action:()=>null,render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)("img",{src:Un().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,disabled:!0,buttonStyle:y.connectAccount,title:(0,De.jsx)(D().sA,{...Qn.connectGmailAccountMobileLabel}),caption:(0,De.jsx)(Xn().CU,{caption:(0,De.jsx)(D().sA,{...Qn.connectGmailAccountMobileCaption}),shouldWrapCaption:!0})})},b={key:"connect-gmail-account-item",action:async()=>{if(p.reset(),!l)return;const e=await ei(r,d,l,c);"success"===e.status&&a(e.externalAuthentication.id)},render:e=>(0,De.jsx)($e().A,{...e,icon:(0,De.jsx)("img",{src:Un().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,buttonStyle:y.connectAccount,title:(0,De.jsx)(D().sA,{...Qn.connectGmailAccountLabel}),caption:(0,De.jsx)(Xn().CU,{caption:(0,De.jsx)(D().sA,{...Qn.connectGmailAccountCaption}),shouldWrapCaption:!0})})},x=[{key:"connectGmailAccount",items:[s.isMobile?v:b],render:e=>(0,De.jsx)(Ct().A,{...e,enableActionSheetTitle:!0})}];return(0,De.jsx)(Je().Ay,{buttonPopupStore:p,popupType:g,alignmentToOrigin:Je().yP.End,placementToOrigin:Je().sx.Bottom,originGap:0,disabled:n,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:n,isCompact:!0,isError:u,hasActionRequired:!Boolean(t),dropdownButtonType:"dropdown",children:t?(0,De.jsx)(Be().A,{renderTooltip:()=>i,disableTooltip:!u,render:e=>(0,De.jsx)("span",{...e,children:null==t?void 0:t.account_name})}):(0,De.jsx)(Be().A,{renderTooltip:()=>(0,De.jsx)(D().sA,{...Qn.gmailAccountMenuPickerHeaderInvalidAccountTooltip}),disableTooltip:!u,render:e=>(0,De.jsx)("span",{...e,children:(0,De.jsx)(D().sA,{...u?Qn.gmailAccountMenuPickerHeaderInvalidAccount:Qn.gmailAccountMenuPickerHeader})})})}),render:e=>(0,De.jsx)(St().A,{...f,children:(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,sections:0===o.length?x:h,initialFocus:0})})})}async function ei(e,t,o,n){const i=await Yn().Jq({environment:e,integration:t,spaceId:o,from:n,preventRedirectToLastVisitedPage:(0,$n().dC)()});return s().Q.isFail(i)?{status:"failure"}:i.value.externalAuthentication?{externalAuthentication:i.value.externalAuthentication,status:"success"}:(await qn().oX({environment:e}),{status:"re-auth"})}const ti=(0,D().YK)({toLabel:{defaultMessage:"To",id:"automations.SendGmailNotificationAction.toLabel"},ccLabel:{defaultMessage:"CC",id:"automations.SendGmailNotificationAction.ccLabel"},bccLabel:{defaultMessage:"BCC",id:"automations.SendGmailNotificationAction.bccLabel"},replyToLabel:{defaultMessage:"Send replies to",id:"automations.SendGmailNotificationAction.replyToLabel"},fromNameLabel:{defaultMessage:"Send with display name",id:"automations.SendGmailNotificationAction.fromNameLabel"},subjectLabel:{defaultMessage:"Subject",id:"automations.SendGmailNotificationAction.subjectLabel"},bodyLabel:{defaultMessage:"Message",id:"automations.SendGmailNotificationAction.bodyLabel"},gmailAccountPickerHidden:{defaultMessage:"Hidden",id:"automations.SendGmailNotificationAction.gmailAccountPickerHidden"}}),oi=["subject","body","fromName"],ni={cc:!1,bcc:!1,replyTo:!1,displayName:!1},ii={displayName:!1,replyTo:!1},ai={cc:ti.ccLabel.defaultMessage,bcc:ti.bccLabel.defaultMessage,replyTo:ti.replyToLabel.defaultMessage,displayName:ti.fromNameLabel.defaultMessage};function ri(e){var t,o,n,i,s,c,d,u,p,m,y,h,v,b,x;const A=(0,D().tz)(),{actionStore:C,currentGmailAuthentication:M,gmailAuthentications:k}=e,{automationStore:I,contextType:w}=(0,xe().EC)(),{disabled:P,maybePersistedTransactionActions:_,suppressActionErrors:B}=(0,We().b)(),R=(0,on().y)(I,w),E=(0,se().K8)((()=>Boolean(P)),[P]),O=(0,a().getActionRegistryItem)("send_gmail_notification"),F=(0,se().K8)((()=>C.getSpaceId()),[C]),V=(0,se().K8)((()=>{var e,t,o,n;return{to:null==C||null===(e=C.getConfig())||void 0===e?void 0:e.to,cc:null==C||null===(t=C.getConfig())||void 0===t?void 0:t.cc,bcc:null==C||null===(o=C.getConfig())||void 0===o?void 0:o.bcc,reply_to:null==C||null===(n=C.getConfig())||void 0===n?void 0:n.reply_to}}),[C]),[N,L]=(0,ae.useState)(ni),[W,z]=(0,ae.useState)(ii),U=(0,re().v3)();nn(Object.values(V).flatMap((e=>{var t;return(null==e||null===(t=e.value)||void 0===t?void 0:t.value)||[]})));const{actionId:H,currentFromName:G,currentSubject:Y,currentBody:q,externalBotId:$}=(0,se().K8)((()=>{var e,t,o;return{currentFromName:null===(e=C.getConfig())||void 0===e?void 0:e.from_name,currentSubject:null===(t=C.getConfig())||void 0===t?void 0:t.email_subject,currentBody:null===(o=C.getConfig())||void 0===o?void 0:o.email_body,actionId:C.id,externalBotId:C.getConfigStore().getKeyStore("external_bot_id").getValue()}}),[C]);(0,Ut().l)((()=>{L((e=>{var t,o,n;return{...e,cc:Boolean(null==V||null===(t=V.cc)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.value),bcc:Boolean(null==V||null===(o=V.bcc)||void 0===o||null===(o=o.value)||void 0===o?void 0:o.value),replyTo:Boolean(null==V||null===(n=V.reply_to)||void 0===n||null===(n=n.value)||void 0===n?void 0:n.value),displayName:Boolean(null==G?void 0:G.value)}}))}));const J=(0,yt().F)({actionId:H}),{value:Q}=(0,et().fJ)(T().T.formulas),Z=function(e,t){return(0,se().K8)((()=>t&&e?r().oE(Object.entries(e.getSchema()).map((e=>{let[t,o]=e;const n=new Set(["person","email"]),i=null==o?void 0:o.type;if(!i)return;return n.has(i)||"rollup"===i&&o.target_property_type&&n.has(o.target_property_type)?(0,f().ESw)({contextValueId:(0,Xo().KI)(),name:o.name,property:t,valueSnapshot:"current"}):void 0}))):[]),[e,t])}(R,(0,ae.useMemo)((()=>{if(Q)return J.filter((e=>(null==e?void 0:e.kind)===g().FormulaContextValueKind.ContextValue)).find((e=>(null==e?void 0:e.id)===(0,Xo().KI)()))}),[J,Q])),ee=(0,se().uB)(void 0,tt().A),te=(0,ae.useCallback)((()=>ee.reset()),[ee]),oe=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:C,closeMenu:te})),[C,te]),ne=(0,ae.useMemo)((()=>!B.includes(C.id)),[B,C]),ue=function(e){const{actionId:t,shouldShowError:o}=e,n={};return n.external_bot_id=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"external_bot_id"}),n.to=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"to"}),n.cc=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"cc"}),n.bcc=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"bcc"}),n.reply_to=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"reply_to"}),n.email_body=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_body"}),n.email_subject=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_subject"}),n}({actionId:C.id,shouldShowError:ne}),pe=(0,ie().useRequiresSubscriptionUpgradeError)({actionId:C.id,shouldShow:ne}),me=Boolean(pe),ge=(0,st().X)("automation_updated_error_states"),fe=(0,ae.useMemo)((()=>{if(ge)return Object.values(ue).filter((e=>(0,l().O9)(e.errorMessage)))[0]}),[ue,ge]),ye=(0,ae.useCallback)((e=>{const t=tn().A.externalAuthentications.state.find((t=>t.integration_id===$o().eg&&t.id===e)),o=$!==(null==t?void 0:t.id);t&&o&&_.createAndCommit({perform:e=>{X().zv({data:{external_bot_id:t.id},store:C.getConfigStore(),transaction:e})},userAction:"SendGmailNotificationAction.setExternalBotId"})}),[C,$,_]);(0,se().K8)((()=>{$||1===k.length&&ye(k[0].id)}),[k,ye,$]);const he=(0,ae.useCallback)((e=>t=>{if(!t)return;if("formula"===t.type)return void _.createAndCommit({perform:o=>{X().zv({data:{[e]:{type:"formula",value:t}},store:C.getConfigStore(),transaction:o})},userAction:"SendGmailNotificationAction.setRecipient.formula"});const o=(0,f().RQ)(t.value).filter((e=>{const t=(0,f().Fbh)([e]);if(0===t.length)return!0;return!new(K().LU)(U,{table:S().oo,id:t[0]},{userId:t[0]}).getIsDeleted()}));_.createAndCommit({perform:t=>{X().zv({data:{[e]:{type:"formula",value:{type:"simple",value:o}}},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setRecipient.simple"}),(0,lt().UB)(U,{automationStore:I,automationActionStore:C})}),[C,_,U,I]),ve=(0,ae.useCallback)((e=>{_.createAndCommit({perform:t=>{X().zv({data:{from_name:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setFromName"}),(0,lt().UB)(U,{automationStore:I,automationActionStore:C})}),[C,_,U,I]),be=(0,ae.useCallback)((e=>{_.createAndCommit({perform:t=>{X().zv({data:{email_subject:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setSubject"}),(0,lt().UB)(U,{automationStore:I,automationActionStore:C})}),[C,_,U,I]),Se=(0,ae.useCallback)((e=>{_.createAndCommit({perform:t=>{X().zv({data:{email_body:e},store:C.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setBody"}),(0,lt().UB)(U,{automationStore:I,automationActionStore:C})}),[C,_,U,I]),{onTextStoreSelect:Ae,onTextStoreUnselect:Ce}=(0,Lt().W)(C),Me=(0,se().K8)((()=>{if(!Q||!F)return{};const{createFormulaDataRequestSyncHandler:e}=Q,t={subject:Y,body:q,fromName:G};return Object.fromEntries(oi.map((o=>{const n=t[o];return n?[o,(0,Ft().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:e(C.getRecordModel),spaceId:F,valueTypes:J.slice(0),featureGates:(0,j().i)()},value:n})]:[o,""]})))}),[C.getRecordModel,Y,q,G,J,Q,F]),ke=(0,ae.useCallback)(((e,t)=>{e.stopPropagation(),e.preventDefault(),L((e=>({...e,[t]:!0}))),"displayName"===t&&z((e=>({...e,displayName:!1})))}),[]),Te=(0,ae.useCallback)((e=>{z((t=>({...t,[e]:!t[e]})))}),[]),Ie=(0,ae.useCallback)((e=>{var t,o,n;return!("displayName"!==e||null==G||!G.value)||(!("cc"!==e||null==V||null===(t=V.cc)||void 0===t||null===(t=t.value)||void 0===t||!t.value)||(!("bcc"!==e||null==V||null===(o=V.bcc)||void 0===o||null===(o=o.value)||void 0===o||!o.value)||!("replyTo"!==e||null==V||null===(n=V.reply_to)||void 0===n||null===(n=n.value)||void 0===n||!n.value)))}),[G,V]),je=(0,ae.useCallback)((async(e,t)=>{e.stopPropagation(),e.preventDefault();if(Ie(t)){if(!(await(0,en().bx)({fieldName:`"${ai[t]}"`})))return}"displayName"===t&&ve(void 0),"cc"!==t&&"bcc"!==t||he(t)({type:"simple",value:void 0}),"replyTo"===t&&he("reply_to")({type:"simple",value:void 0}),L((e=>({...e,[t]:!1})))}),[ve,Ie,he]),we=(0,ae.useCallback)((()=>{de().clear({environment:U})}),[U]),{isMobile:_e}=(0,re().Y0)(),Be=(0,le().IS)((e=>{var t;const o={color:e.text.secondary,fontSize:_e?ce().J.UIRegular.mobile:ce().J.UIRegular.desktop,lineHeight:_e?ce().K_.UIRegular.mobile:ce().K_.UIRegular.desktop,fontWeight:ce().Wy.regular};return{inputLabel:{...o},toInputLabel:{...o,...ge&&(0,l().O9)(null===(t=ue.to)||void 0===t?void 0:t.errorMessage)&&{color:e.text.uiRedPrimary,fontWeight:ce().Wy.medium}},toErrorLabel:{color:e.text.uiRedPrimary},toggleableInputLabel:{...o,cursor:"pointer",padding:2,transform:"translateX(-2px)",display:"flex",width:"fit-content"},toggleableInputLabelHovered:{...o,cursor:"pointer",backgroundColor:e.buttonHoveredBackground,transform:"translateX(-2px)",display:"flex",width:"fit-content",borderRadius:"4px",padding:2},messageInput:{width:"100%"},replyToInputContainer:{display:"flex",justifyContent:"space-between"},replyToInputField:{width:"100%",fontSize:_e?ce().J.UIRegular.mobile:ce().J.UIRegular.desktop},ccBccToggle:{padding:"6px 12px",color:e.text.tertiary,borderRadius:"6px",marginLeft:8,alignSelf:"flex-start"},toggleFieldGridContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr auto",alignItems:"center",columnGap:8,rowGap:6},toggleFieldGridLabel:{gridRow:"1",gridColumn:"1"},toggleFieldGridInput:{gridRow:"2",gridColumn:"1"},toggleFieldGridTrashIconButton:{gridRow:"2",gridColumn:"2",alignSelf:"flex-start",height:32,width:32},toggleFieldTrashIconButtonForTextInput:{gridRow:"1",gridColumn:"2",alignSelf:"flex-start",marginTop:26,height:32,width:32},trashIcon:{width:qe().Ev.default,height:qe().Ev.default}}}),[ue,ge,_e]);function Re(e,t){return e||t?!e&&t?Be.toggleableInputLabelHovered:Be.inputLabel:Be.toggleableInputLabel}if(!F)return null;const Ee={collectionStore:R,limit:ci,disabled:E,formulaTypecheckContextValues:J,spaceId:F,pageProperties:Z};return(0,De.jsxs)(It().OT,{actionMenu:oe,buttonPopupStore:ee,disabled:E,actionId:C.id,canCollapse:!me,hideDragHandle:me,children:[(0,De.jsx)(It().h3,{actionId:C.id,actionRegistryItem:O,disabled:E,errorMessage:pe||(null==fe?void 0:fe.errorMessage),styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,De.jsx)(si,{currentGmailAuthentication:M,gmailAuthentications:k,disabled:E,isError:me,onGmailAccountChange:ye,accountPickerErrorMessage:null===(t=ue.external_bot_id)||void 0===t?void 0:t.errorMessage})}),M&&(0,De.jsx)(It().qt,{children:(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:16,children:[(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:6,children:[(0,De.jsx)("label",{style:Be.toInputLabel,children:(0,De.jsx)(D().sA,{...ti.toLabel})}),(0,De.jsxs)("div",{className:"to-input-and-ccBcc-container",style:Be.replyToInputContainer,children:[(0,De.jsx)(li,{...Ee,recipients:null==V||null===(o=V.to)||void 0===o?void 0:o.value,onChange:he("to"),errorMessage:null===(n=ue.to)||void 0===n?void 0:n.errorMessage,style:Be.replyToInputField}),(!N.cc||!N.bcc)&&(0,De.jsx)(Qo().A,{onClick:e=>{N.cc||ke(e,"cc"),N.bcc||ke(e,"bcc")},style:Be.ccBccToggle,children:N.cc||N.bcc?(0,De.jsx)(D().sA,{id:"automations.SendGmailNotificationAction.ccOrBccToggleLabel",defaultMessage:"{showCCLabel, select, true {CC} other {BCC}}",values:{showCCLabel:!N.cc&&N.bcc}}):(0,De.jsx)(D().sA,{id:"automations.SendGmailNotificationAction.ccAndBccToggleLabel",defaultMessage:"CC/BCC"})})]}),ge&&(0,l().O9)(null===(i=ue.to)||void 0===i?void 0:i.errorMessage)&&(0,De.jsx)(Zo().D,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:Be.toErrorLabel,children:(0,De.jsx)(D().sA,{...null===(s=ue.to)||void 0===s?void 0:s.errorMessageDescriptor})})]}),N.cc&&(0,De.jsx)(Pt().Y1,{direction:"vertical",gap:16,children:(0,De.jsxs)("div",{style:Be.toggleFieldGridContainer,children:[(0,De.jsxs)("label",{style:Be.inputLabel,children:[(0,De.jsx)(D().sA,{...ti.ccLabel}),(0,De.jsx)(So().z,{})]}),(0,De.jsx)(li,{...Ee,recipients:null==V||null===(c=V.cc)||void 0===c?void 0:c.value,onChange:he("cc"),errorMessage:null===(d=ue.cc)||void 0===d?void 0:d.errorMessage,style:Be.toggleFieldGridInput}),(0,De.jsx)(Pe().A,{icon:$t().trashIcon,ariaLabel:A.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"cc"),style:Be.toggleFieldGridTrashIconButton,iconStyle:Be.trashIcon})]})}),N.bcc&&(0,De.jsx)(Pt().Y1,{direction:"vertical",gap:16,children:(0,De.jsxs)("div",{style:Be.toggleFieldGridContainer,children:[(0,De.jsxs)("label",{style:{...Be.inputLabel},children:[(0,De.jsx)(D().sA,{...ti.bccLabel}),(0,De.jsx)(So().z,{})]}),(0,De.jsx)(li,{...Ee,recipients:null==V||null===(u=V.bcc)||void 0===u?void 0:u.value,onChange:he("bcc"),errorMessage:null===(p=ue.bcc)||void 0===p?void 0:p.errorMessage,style:Be.toggleFieldGridInput}),(0,De.jsx)(Pe().A,{icon:$t().trashIcon,ariaLabel:A.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"bcc"),style:Be.toggleFieldGridTrashIconButton,iconStyle:Be.trashIcon})]})}),(0,De.jsx)(So().M,{disabled:E,disableMobileActionBar:!1,disableNewLines:!0,disableStyleAnnotations:!0,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:J,onChange:be,onTextStoreSelect:Ae,onTextStoreUnselect:Ce,onTextEsc:we,parentRecordStore:C,spaceId:F,style:Be.messageInput,value:Y,analyzedFormulaOutput:Me.subject,labelMessageDescriptor:ti.subjectLabel,errorMessageDescriptor:null===(m=ue.email_subject)||void 0===m?void 0:m.errorMessageDescriptor,shouldShowErrorStyles:ge&&(0,l().O9)(null===(y=ue.email_subject)||void 0===y?void 0:y.errorMessage)}),(0,De.jsx)(So().M,{disabled:E,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:J,onChange:Se,onTextStoreSelect:Ae,onTextStoreUnselect:Ce,onTextEsc:we,parentRecordStore:C,rows:4,spaceId:F,style:Be.messageInput,value:q,analyzedFormulaOutput:Me.body,labelMessageDescriptor:ti.bodyLabel,errorMessageDescriptor:null===(h=ue.email_body)||void 0===h?void 0:h.errorMessageDescriptor,shouldShowErrorStyles:ge&&(0,l().O9)(null===(v=ue.email_body)||void 0===v?void 0:v.errorMessage)}),!N.displayName&&(0,De.jsx)("label",{children:(0,De.jsxs)("span",{onClick:e=>ke(e,"displayName"),onMouseEnter:()=>Te("displayName"),onMouseLeave:()=>Te("displayName"),style:Re(N.displayName,W.displayName),children:[(0,De.jsx)(D().sA,{...ti.fromNameLabel}),"..."]})}),N.displayName&&(0,De.jsxs)("div",{style:{...Be.toggleFieldGridContainer,rowGap:0},children:[(0,De.jsx)("div",{style:Be.toggleFieldGridLabel,children:(0,De.jsx)(So().M,{disabled:E,disableMobileActionBar:!1,disableTemplateVariableMentions:!1,formulaTypecheckContextValues:J,disableNewLines:!0,disableStyleAnnotations:!0,onChange:ve,onTextStoreSelect:Ae,onTextStoreUnselect:Ce,onTextEsc:we,parentRecordStore:C,rows:1,spaceId:F,value:G,analyzedFormulaOutput:Me.fromName,labelMessageDescriptor:ti.fromNameLabel,isOptional:!0})}),(0,De.jsx)(Pe().A,{icon:$t().trashIcon,ariaLabel:A.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"displayName"),style:Be.toggleFieldTrashIconButtonForTextInput,iconStyle:Be.trashIcon})]}),(0,De.jsxs)("div",{style:Be.toggleFieldGridContainer,children:[(0,De.jsx)("label",{style:Be.toggleFieldGridLabel,children:(0,De.jsxs)("span",{onClick:e=>ke(e,"replyTo"),onMouseEnter:()=>Te("replyTo"),onMouseLeave:()=>Te("replyTo"),style:Re(N.replyTo,W.replyTo),children:[(0,De.jsx)(D().sA,{...ti.replyToLabel}),!N.replyTo&&"...",N.replyTo&&(0,De.jsx)(So().z,{})]})}),N.replyTo&&(0,De.jsxs)(De.Fragment,{children:[(0,De.jsx)(li,{...Ee,recipients:null==V||null===(b=V.reply_to)||void 0===b?void 0:b.value,onChange:he("reply_to"),errorMessage:null===(x=ue.reply_to)||void 0===x?void 0:x.errorMessage,limit:1,style:Be.toggleFieldGridInput}),(0,De.jsx)(Pe().A,{icon:$t().trashIcon,ariaLabel:A.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"replyTo"),style:Be.toggleFieldGridTrashIconButton,iconStyle:Be.trashIcon})]})]})]})})]})}function si(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,isError:i,onGmailAccountChange:a,accountPickerErrorMessage:r}=e,s=(0,le().IS)((()=>({title:{display:"inline-flex",minWidth:50,flexWrap:"wrap",gap:6}})),[]),l=function(){const{isMobile:e}=(0,re().Y0)(),t=e?ce().J.UISmall.mobile:ce().J.UISmall.desktop;return(0,le().IS)((()=>({container:{alignItems:"center",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}();return i?(0,De.jsx)("div",{style:s.title,children:(0,De.jsx)(D().sA,{defaultMessage:"Send mail",id:"automations.SendGmailNotificationAction.header.titleError"})}):(0,De.jsx)("div",{style:s.title,children:(0,De.jsx)(D().sA,{defaultMessage:"Send mail from{gmailAccountPicker}",id:"automations.SendGmailNotificationAction.header.title",values:{gmailAccountPicker:n?(0,De.jsxs)("div",{style:l.container,children:[(0,De.jsx)(Ze().I,{icon:Jo().lockIcon}),(0,De.jsx)("span",{style:ce().RC,children:(0,De.jsx)(D().sA,{...ti.gmailAccountPickerHidden})})]}):(0,De.jsx)(Zn,{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,onAccountChange:a,errorMessage:r})}})})}function li(e){const{recipients:t,style:o,collectionStore:n,...i}=e,{automationStore:a}=(0,xe().EC)();return(0,De.jsx)("div",{style:o,children:(0,De.jsx)(Ln,{currentValue:t,collectionStore:n,parentRecordStore:a,...i})})}const ci=20;var di=()=>o(678350);const ui=(0,D().YK)({defaultMenuHeader:{defaultMessage:"Select people",id:"automationPersonPicker.defaultMenuHeaderMessage"},personValuePickerPlaceholder:{defaultMessage:"Select up to {maxSelected} people...",id:"automations.personPicker.buttonPlaceholder"}});function pi(e){const{currentValue:t,collectionStore:o,disabled:n,onChange:i,formulaTypecheckContextValues:a,menuHeader:r,limit:s,errorMessage:l,parentRecordStore:c,spaceId:d,style:u}=e,p={type:"person_array"},m=(0,D().tz)(),g=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},f={menuType:Do().gu.Popup,header:(0,De.jsx)(Ct().A,{title:r?m.formatMessage(r):m.formatMessage(ui.defaultMenuHeader)})};return(0,De.jsx)(di().U,{allowedReturnTypes:Co().Yy.person,formulaTypecheckContextValues:a,disabled:n,simpleFormulaContext:g,onChange:i,type:p,value:t,menuProps:f,placeholder:s?m.formatMessage(ui.personValuePickerPlaceholder,{maxSelected:s}):void 0,limit:s,errorMessage:l,parentRecordStore:c,spaceId:d,style:u})}var mi=()=>o(464004);const gi=(0,D().YK)({property:{id:"automationAction.sendInAppNotification.targetType.property",defaultMessage:"Person property"},formula:{id:"automationAction.sendInAppNotification.targetType.formula",defaultMessage:"Specific people"},default:{id:"automations.targetPicker.targetTypePlaceholder",defaultMessage:"Select recipients"}});function fi(e){const{disabled:t,errorMessage:o,selectedTargetType:n,onSelectedTargetTypeChange:i}=e,a=(0,se().uB)(void 0,tt().A),r=(0,Me().j)(),s=(0,st().X)("automation_updated_error_states"),l=(0,ae.useCallback)((e=>{e!==n&&(i(e),a.reset())}),[i,a,n]);return(0,De.jsx)(Je().Ay,{buttonPopupStore:a,popupType:r,alignmentToOrigin:Je().yP.End,placementToOrigin:Je().sx.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,De.jsx)(ht().x,{...e,disabled:t,isCompact:!0,isError:Boolean(o),hasActionRequired:!Boolean(n),tooltipMessage:!s&&o,dropdownButtonType:"dropdown",children:n?(0,De.jsx)(D().sA,{...gi[n]}):(0,De.jsx)(D().sA,{...gi.default})}),render:e=>(0,De.jsx)(yi,{handleChange:l,selectedTargetType:n})})}function yi(e){const{handleChange:t}=e,o=(0,Mt().e)(),n=[(0,ae.useMemo)((()=>({action:()=>null,key:"selectUsers",render:e=>(0,De.jsx)($e().A,{...e,onClick:()=>t("formula"),title:(0,De.jsx)(D().sA,{...gi.formula})})})),[t]),(0,ae.useMemo)((()=>({action:()=>null,key:"selectPersonProperty",render:e=>(0,De.jsx)($e().A,{...e,onClick:()=>t("property"),title:(0,De.jsx)(D().sA,{...gi.property})})})),[t])].filter(l().O9);if(0===n.length)return null;const i={items:n,key:"targetType",render:e=>(0,De.jsx)(Ct().A,{topBorder:!0,...e,enableActionSheetTitle:!0})};return(0,De.jsx)(St().A,{...o,children:(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,sections:[i],initialFocus:0})})}const hi=(0,D().YK)({notificationMessageLabel:{defaultMessage:"Message",id:"automations.BaseModalAction.notificationMessageLabel"},personPropertyTargetTypeLabel:{defaultMessage:"Property",id:"automations.SendInAppNotificationAction.personPropertyTargetTypeLabel"},usersTargetTypeLabel:{defaultMessage:"People",id:"automations.SendInAppNotificationAction.usersTargetTypeLabel"},propertyPickerPlaceholder:{defaultMessage:"Select a property",id:"automations.SendInAppNotificationAction.propertyPickerPlaceholder"},personValuePickerMenuHeader:{defaultMessage:"Send notification to",id:"automations.personPicker.menuHeader"}});function vi(e){const{noCollection:t,targetsErrorMessage:o,selectedTargetType:n,disabled:i,onTargetTypeChange:a}=e;return t?(0,De.jsx)(D().sA,{defaultMessage:"Send notification to specific people",id:"automations.SendInAppNotificationAction.header.titleButtonBlock",values:{placeholder:"specific people"}}):(0,De.jsx)(D().sA,{defaultMessage:"Send notification to{targetTypePicker}",id:"automations.SendInAppNotificationAction.header.title",values:{targetTypePicker:(0,De.jsx)(fi,{onSelectedTargetTypeChange:a,disabled:i,errorMessage:o,selectedTargetType:n})}})}function bi(e){const{isError:t,isMobile:o,selectedTargetType:n}=e,i=(0,le().IS)((e=>({inputLabel:{color:t?e.text.uiRedPrimary:e.text.secondary,fontSize:o?ce().J.UIRegular.mobile:ce().J.UIRegular.desktop,lineHeight:o?ce().K_.UIRegular.mobile:ce().K_.UIRegular.desktop,fontWeight:ce().Wy.regular}})),[t,o]),a=(0,se().K8)((()=>{switch(n){case"property":return hi.personPropertyTargetTypeLabel;case"formula":return hi.usersTargetTypeLabel;default:(0,l().HB)(n)}}),[n]);return(0,De.jsx)("label",{style:i.inputLabel,children:(0,De.jsx)(D().sA,{...a})})}const xi=20;function Si(e){const{collectionStore:t,currentProperties:o,currentTargetValue:n,disabled:i,errorMessage:a,formulaTypecheckContextValues:r,onTargetValueChange:s,parentRecordStore:c,spaceId:d}=e,u=n.type;switch(u){case"formula":return(0,De.jsx)(pi,{collectionStore:t,currentValue:n.value,disabled:Boolean(i),onChange:e=>s({type:"formula",value:e}),parentRecordStore:c,formulaTypecheckContextValues:r,menuHeader:hi.personValuePickerMenuHeader,limit:xi,errorMessage:a,spaceId:d,style:{width:"100%"}});case"property":return t?(0,De.jsx)(mi().l,{availablePropertyIds:o,currentValue:n.propertyId,collectionStore:t,onChange:e=>s({type:"property",propertyId:e}),disabled:Boolean(i),alreadyHaveProperties:Boolean(n.propertyId),placeholderMessage:hi.propertyPickerPlaceholder,errorMessage:a}):null;default:(0,l().HB)(u)}}function Ai(e,t){if("formula"===t.type||!(0,l().O9)(t.value))return{type:"simple",value:void 0};const o=t.value.filter((t=>{if(!(0,f().qXl)(t))return!1;const o=(0,f().uPN)(t),n=(0,f().snh)(o);if(n){const t=(0,f().NcG)(n);return!new(K().LU)(e,{id:t,table:S().oo},{userId:t}).getIsDeleted()}return(0,f().tVx)(o)}));return{type:"simple",value:(0,Ft().toSimpleFormulaArrayValue)((0,Ft().filterTextValueToSimpleFormulaValueTokens)(o))}}o(737550);var Ci=()=>o(841369),Mi=()=>o(21140),ki=()=>o(795727);const Ti=(0,D().YK)({addCustomHeader:{defaultMessage:"Add custom header",id:"automations.BaseModalAction.addCustomHeader"},customHeaderKeyLabel:{defaultMessage:"Key",id:"automations.BaseModalAction.customHeaderKeyLabel"},customHeaderValueLabel:{defaultMessage:"Value",id:"automations.BaseModalAction.customHeaderValueLabel"},removeCustomHeaderAriaLabel:{defaultMessage:"Remove custom header",id:"automations.BaseModalAction.removeCustomHeaderAriaLabel"}});function Ii(e){const{actionStore:t}=e,o=(0,D().tz)(),n=Ui(),{suppressActionErrors:i}=(0,We().b)(),{typecheckResult:a}=(0,xe().EC)(),[r,l]=(0,ae.useState)(new Set),[c,d]=(0,ae.useState)((()=>new(ki().A))),u=(0,se().K8)((()=>{if(!s().Q.isSuccess(a))return new(ki().A);const e=i.includes(t.id),o=a.value.actionValidationFailures[t.id]||[],n=new(ki().A);return o.forEach((t=>{if("empty_custom_header_field"===t.type){const[o,i,a]=t.key;n.set({id:i,field:a},!e&&!r.has(i)||(c.get({id:i,field:a})||!1))}})),n}),[a,i,t.id,c,r]),{maybePersistedTransactionActions:p}=(0,We().b)(),m=(0,le().IS)((()=>({customHeadersContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:12},customHeaderInputsContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr 1fr auto",alignItems:"center",columnGap:8,rowGap:4},customHeaderKeyLabel:{...n.inputLabel,gridRow:1,gridColumn:1},customHeaderValueLabel:{...n.inputLabel,gridRow:1,gridColumn:2},customHeaderKeyInput:{...n.input,gridRow:2,gridColumn:1},customHeaderValueInput:{...n.input,gridRow:2,gridColumn:2},customHeaderRemoveButton:{gridRow:2,gridColumn:3,width:32,height:32},customHeaderRemoveButtonIcon:{width:qe().Ev.default,height:qe().Ev.default},addCustomHeaderButton:{marginLeft:-8,marginTop:8}})),[n]),g=(0,se().K8)((()=>t.getConfigStore().getKeyStore("customHeaders")),[t]),f=(0,se().K8)((()=>(g.getValue()||[]).map((e=>({...e,id:e.id||(0,Bt().Ay)()})))),[g]),y=(0,ae.useCallback)(((e,t)=>()=>{const o=new(ki().A)({from:c.entries()});o.set({id:e,field:t},!0),d(o)}),[c]),h=(0,ae.useCallback)(((e,t)=>o=>{const n=(g.getValue()||[]).map((n=>n.id===e?{...n,[t]:o}:n));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{X().KY({store:g,transaction:e,value:n})}})}),[g,p]),v=(0,ae.useCallback)((()=>{p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{const t={id:(0,Bt().Ay)(),key:"",value:""};X().KY({store:g,transaction:e,value:[...f,t]}),l((e=>{const o=new Set(e);return o.add(t.id),o}))}})}),[f,g,p]),b=(0,ae.useCallback)((e=>()=>{const t=f.filter((t=>t.id!==e));p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{X().KY({store:g,transaction:e,value:t})}})}),[f,g,p]),x=f.length>0&&(0,De.jsx)("div",{style:m.customHeadersContainer,children:f.map((e=>(0,De.jsxs)("div",{style:m.customHeaderInputsContainer,children:[(0,De.jsx)("label",{style:m.customHeaderKeyLabel,children:(0,De.jsx)(D().sA,{...Ti.customHeaderKeyLabel})}),(0,De.jsx)("label",{style:m.customHeaderValueLabel,children:(0,De.jsx)(D().sA,{...Ti.customHeaderValueLabel})}),(0,De.jsx)("div",{}),(0,De.jsx)(ze,{style:m.customHeaderKeyInput,value:e.key,onChange:h(e.id,"key"),errorOutline:u.get({id:e.id,field:"key"}),onBlur:y(e.id,"key"),autoFocus:!e.key,maxlength:Ci().Sx}),(0,De.jsx)(ze,{style:m.customHeaderValueInput,value:e.value,onChange:h(e.id,"value"),errorOutline:u.get({id:e.id,field:"value"}),onBlur:y(e.id,"value"),maxlength:Ci().Sx}),(0,De.jsx)(Pe().A,{icon:$t().trashIcon,ariaLabel:o.formatMessage(Ti.removeCustomHeaderAriaLabel),style:m.customHeaderRemoveButton,iconStyle:m.customHeaderRemoveButtonIcon,onClick:b(e.id)})]},e.id)))});return(0,De.jsxs)(De.Fragment,{children:[x,f.length<Ci().qu&&(0,De.jsx)(Mi().Ye,{children:(0,De.jsx)(Dt().p,{isGray:!0,onClick:v,style:m.addCustomHeaderButton,children:(0,De.jsx)(D().sA,{...Ti.addCustomHeader})})})]})}var ji=()=>o(721479),wi=()=>o(148024),Pi=()=>o(187485),_i=()=>o(836251);function Bi(e){const t=(0,re().v3)(),o=(0,D().tz)();return(0,De.jsx)(Be().A,{renderTooltip:()=>(0,De.jsx)(D().sA,{defaultMessage:"Learn more",id:"webhookAction.helpButton.tooltip"}),render:e=>(0,De.jsx)(Pi().A,{...e,href:(0,_i().xS)("guides.webhookAction"),onClick:()=>wi().FH(t,{from:"webhookAction"}),external:!0,children:(0,De.jsx)(Pe().A,{...e,ariaLabel:o.formatMessage({id:"webhookAction.helpButton.ariaLabel",defaultMessage:"Learn about webhook actions"}),icon:ji().questionMarkCircleSmallIcon,iconStyle:{width:qe().Ev.sm,height:qe().Ev.sm}})})})}Bi.displayName="SendWebhookActionHelpLink";var Ri=()=>o(713998),Ei=()=>o(743176),Di=()=>o(488887);const Oi=new Set(["title","text","relation","checkbox","number","person","file","url","email","phone_number","created_time","created_by","last_edited_time","last_edited_by","last_visited_time","formula","rollup","select","multi_select","date","status","auto_increment_id","location","verification","geo_point"]);const Fi=(0,D().YK)({selectAllPropertiesDescription:{defaultMessage:"New properties will not be included automatically",id:"automations.BaseModalAction.selectAllPropertiesDescription"},selectAllProperties:{defaultMessage:"Select all existing properties",id:"automations.BaseModalAction.selectAllProperties"},propertyPickerLabel:{defaultMessage:"Content",id:"automations.BaseModalAction.propertyPickerLabel"},propertyDisabledMissingPermissionTooltip:{defaultMessage:"This property references a database you don't have access to",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledMissingPermissionTooltip"},propertyDisabledUnsupportedTypeTooltip:{defaultMessage:"This property type is not supported",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledUnsupportedTypeTooltip"}});function Vi(){return(0,le().IS)((e=>({buttonMenuItemContent:{height:34,gap:6},buttonMenuItem:{borderRadius:4}})),[])}function Ni(e){let{collectionStore:t,value:o,onChange:n}=e;const i=Vi(),a=Ui(),s=(0,se().K8)((()=>t.getSchema()),[t]),l=(0,ae.useMemo)((()=>new Set("some"===o.type?o.some||[]:Object.keys(s))),[s,o]),c=function(e){const{value:t}=(0,et().fJ)(T().T.formulas),{value:o}=(0,et().fJ)(T().T.formulaPermissions),n=(0,st().X)("collections_xws"),i=(0,se().K8)((()=>{if(!t)return;const o=(0,j().i)();return{allowedReturnTypes:[{type:"unknown"}],handleDataRequest:(0,h().MC)({collectionFeatureGates:o,experimentService:P().default,getRecordModel:e.getRecordModel,loadRecordModel:e.loadRecordModel}),restrictUnaccessibleProperties:n?"cross_space_and_read_permissions":"read_permissions_only",spaceId:e.getSpaceId(),valueTypes:[],featureGates:o}}),[t,e,n]),[a]=(0,dn().Yb)((async()=>{if(!t||!i||!o)return;const n=e.getSchema(),a=Object.keys(n),r=await(0,Y().lX)(a,3,(async t=>{const a=(0,Ri()._g)({schema:n,property:t});if(a)return Oi.has(a.type)?await o.hasAccessToProperty({collectionPointer:e.pointer,collectionSchema:n,context:i,propertyId:t,hasAccessFn:o.hasAccessDefaultFn})?void 0:"missing_permission":"unsupported_property_type"})),s=new Map;return r.forEach(((e,t)=>{s.set(a[t],e)})),s.size>0?s:void 0}),[e,i,t,o]);return a}(t),d=(0,ae.useMemo)((()=>c.value||new Map),[c]),u=(0,ae.useMemo)((()=>new Set(Array.from(d.entries()).filter((e=>{let[t,o]=e;return void 0===o})).map((e=>{let[t]=e;return t})))),[d]),p=(0,ae.useMemo)((()=>"some"===o.type&&(0,Di()._)(l,u)),[o.type,l,u]),m=(0,ae.useRef)(null),g=(0,ae.useCallback)((e=>{l.has(e)?l.delete(e):l.add(e),n({type:"some",some:Array.from(l)})}),[l,n]),f=(0,le().IS)((e=>({sectionMenuItem:{padding:8},propertyPickerContainer:{display:"flex",flexDirection:"column",border:`1px solid ${e.regularDividerColor}`,borderRadius:8,maxHeight:212,overflowY:"auto",marginBottom:2},selectAllPropertiesButtonTitle:{display:"flex",alignItems:"center",gap:4},selectAllPropertiesCheckboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:4},selectAllPropertiesCheckbox:{cursor:"pointer"}})),[]),y=(0,ae.useCallback)((()=>{n(p?{type:"some",some:[]}:{type:"some",some:Array.from(u.values())})}),[p,n,u]);(0,ae.useEffect)((()=>{m.current&&(m.current.indeterminate=l.size>0&&!p)}),[p,l,o.type]);const v=Object.keys(s),b=(0,ae.useMemo)((()=>v.sort(((e,t)=>{const o=(0,Ri()._g)({schema:s,property:e}),n=(0,Ri()._g)({schema:s,property:t});if("title"===(null==o?void 0:o.type))return-1;if("title"===(null==n?void 0:n.type))return 1;const i=(null==o?void 0:o.name)||"",a=(null==n?void 0:n.name)||"";return i.localeCompare(a)}))),[v,s]);if(!d)return null;const x=(0,r().oE)(b.map((e=>{const t=(0,Ri()._g)({schema:s,property:e});if(!t)return null;return{key:e,render:o=>(0,De.jsx)(Li,{...o,propertySchema:t,selected:l.has(e),noAccessReason:d.get(e),buttonStyle:i.buttonMenuItem,style:i.buttonMenuItemContent}),action:()=>{g(e)}}}))),S=(0,r().oE)([{key:0,render:e=>(0,De.jsx)(Ct().A,{...e,style:f.sectionMenuItem}),items:[{key:0,render:e=>(0,De.jsx)($e().A,{...e,style:i.buttonMenuItemContent,buttonStyle:i.buttonMenuItem,title:(0,De.jsxs)("div",{style:f.selectAllPropertiesButtonTitle,children:[(0,De.jsx)(D().sA,{...Fi.selectAllProperties}),(0,De.jsx)(Wi,{})]}),leftStyle:f.selectAllPropertiesCheckboxContainer,left:(0,De.jsx)("input",{type:"checkbox",readOnly:!0,checked:p,ref:m,style:f.selectAllPropertiesCheckbox})}),action:y}]},{key:1,render:e=>(0,De.jsx)(Ct().A,{topBorder:!0,style:f.sectionMenuItem,...e}),items:x}]);return(0,De.jsxs)(De.Fragment,{children:[(0,De.jsx)("label",{style:a.inputLabel,children:(0,De.jsx)(D().sA,{...Fi.propertyPickerLabel})}),(0,De.jsx)("div",{style:f.propertyPickerContainer,children:(0,De.jsx)(At().Ay,{type:At().Oh.Vertical,sections:S,initialFocus:void 0,resetFocusOnMouseOut:!0})})]})}function Li(e){const{propertySchema:t,noAccessReason:o}=e,n=(0,le().DP)(),i=(0,re().v3)(),{name:a,type:r,icon:s}=t,l=Vi(),c=(0,le().IS)((e=>({buttonMenuItemTitle:{color:o?e.text.tertiary:e.text.secondary},propertyIcon:{fill:o?e.icon.tertiary:e.icon.secondary,height:qe().Ev.sm,width:qe().Ev.sm,display:"flex",alignItems:"center",justifyContent:"center"},checkBoxInput:{cursor:o?void 0:"pointer"},checkboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingLeft:4}})),[o]),d=(0,De.jsx)($e().A,{title:a,disabled:Boolean(o),style:l.buttonMenuItemContent,titleStyle:c.buttonMenuItemTitle,icon:(0,De.jsx)(Ei().zB,{icon:s,type:r,size:i.device.isMobile?18:16,theme:n,style:c.propertyIcon}),left:(0,De.jsx)("div",{style:c.checkboxContainer,children:(0,De.jsx)("input",{type:"checkbox",readOnly:!0,checked:e.selected,disabled:Boolean(o),style:c.checkBoxInput})}),...e});return o?(0,De.jsx)(zi,{noAccessReason:o,children:d}):d}function Wi(){return(0,De.jsx)(Be().A,{renderTooltip:()=>(0,De.jsx)(D().sA,{...Fi.selectAllPropertiesDescription}),render:e=>(0,De.jsx)("div",{...e,children:(0,De.jsx)(Ze().I,{icon:ji().questionMarkCircleSmallIcon,size:"sm",color:"secondary"})}),placement:Kt().W.Top})}function zi(e){const{children:t,noAccessReason:o}=e;return(0,De.jsx)(Be().A,{renderTooltip:()=>"missing_permission"===o?(0,De.jsx)(D().sA,{...Fi.propertyDisabledMissingPermissionTooltip}):"unsupported_property_type"===o?(0,De.jsx)(D().sA,{...Fi.propertyDisabledUnsupportedTypeTooltip}):void(0,l().HB)(o),originGap:0,render:e=>(0,De.jsx)("div",{...e,children:t}),placement:Kt().W.Left})}const Ki=(0,D().YK)({urlInputLabel:{defaultMessage:"URL",id:"automations.BaseModalAction.urlInputLabel"}});function Ui(){const{isMobile:e}=(0,re().Y0)();return(0,le().IS)((t=>({inputLabel:{color:t.text.secondary,fontSize:e?ce().J.UIRegular.mobile:ce().J.UIRegular.desktop},input:{backgroundColor:t.contentBackground,paddingTop:6,paddingBottom:6},helpText:{color:t.text.secondary,fontSize:e?ce().J.UISmall.mobile:ce().J.UISmall.desktop}})),[e])}const Hi={create_page:function(e){const{actionStore:t}=e,n=(0,re().v3)(),{automationStore:i}=(0,xe().EC)(),{disabled:r,maybePersistedTransactionActions:s,suppressActionErrors:c}=(0,We().b)(),d=(0,a().getActionRegistryItem)("create_page"),[u,p]=(0,se().K8)((()=>{const e=t.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),[m,g]=(0,se().K8)((()=>{const e=t.getCollectionStore();return null!=e&&e.isDefined()?[e,{collection:e.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[t]),f=(0,se().K8)((()=>dt(m).length>0),[m]),y=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),h=(0,ae.useMemo)((()=>({values:p??{},properties:u??[]})),[p,u]),v=(0,se().uB)(void 0,tt().A),b=(0,ae.useCallback)((()=>v.reset()),[v]),x=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:b})),[t,b]),S=(0,se().K8)((()=>(0,l().O9)(t.getConfigStore().getKeyStore("collection").getValue())),[t]),A=(0,ae.useCallback)((e=>{"collection"===e.type&&(s.createAndCommit({perform:o=>{X().zv({data:{collection:e.collection,properties:["title"],template_page_id:null,values:null},store:t.getConfigStore(),transaction:o})},userAction:"CreatePageAction.setCollection"}),(0,lt().UB)(n,{automationStore:i,automationActionStore:t}))}),[s,n,i,t]),C=(0,ae.useCallback)((e=>{const{properties:o,values:a}=h;let r=!1;if(e&&o&&1===o.length&&o.includes("title")){var l;const e=null==a?void 0:a.title;e&&null!==(l=e.value)&&void 0!==l&&l.value||(r=!0)}s.createAndCommit({perform:o=>{X().zv({store:t.getConfigStore(),data:{template_page_id:e??null,...r&&{properties:[]}},transaction:o})},userAction:"CreatePageAction.onTemplateChange"}),(0,lt().UB)(n,{automationStore:i,automationActionStore:t})}),[h,s,n,i,t]),M=(0,ae.useMemo)((()=>!c.includes(t.id)),[c,t]),{errorMessage:k,errorIcon:T}=(0,ie().useErrorComponentForAction)({actionId:t.id,errorKeys:["collection","config",t.id],shouldShow:M}),{errorMessage:I}=(0,ie().useErrorComponentForAction)({actionId:t.id,errorKey:"template",shouldShow:M}),j=Boolean(r),w=(0,st().X)("automation_updated_error_states");return(0,De.jsxs)(It().OT,{actionId:t.id,actionMenu:x,buttonPopupStore:v,canCollapse:S,disabled:j,children:[(0,De.jsxs)(It().h3,{actionId:t.id,actionRegistryItem:d,disabled:j,errorMessage:w?k||I:void 0,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:[(0,De.jsx)(jt,{actionStore:t,disabled:j,errorMessage:k,errorIcon:T,onChange:A,value:g}),(0,l().O9)(m)&&f&&(0,De.jsx)(wt,{collectionStore:m,disabled:j,errorMessage:I,onChange:C,value:y})]}),m&&(0,De.jsx)(It().qt,{disabled:j,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,De.jsx)(o(95199).Ud,{actionStore:t,collectionStore:m,disabled:j,showSetPropertyActions:!1})})]})},update_pages:o(686169).w,query_collection:function(){return null},open_page:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,We().b)(),r=(0,se().uB)(void 0,tt().A),s=(0,a().getActionRegistryItem)("open_page"),l=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),{contextType:c}=(0,xe().EC)(),d=(0,se().K8)((()=>{if(!(0,Co().Fx)(c))return;const e=t.getIndex();return(0,Co().cQ)(e)?"allow":"disallow_with_message"}),[t,c]),u=(0,se().K8)((()=>l&&"url"!==l.type),[l]),p=(0,ae.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),m=(0,ae.useCallback)((e=>{n.createAndCommit({perform:o=>{X().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[n,t]),g=(0,ae.useCallback)((e=>{n.createAndCommit({perform:o=>{X().zv({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[n,t]),f=(0,ae.useCallback)((()=>r.reset()),[r]),y=(0,ae.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:h}=(0,ie().useErrorComponentForAction)({actionId:t.id,shouldShow:y}),v=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:f})),[t,f]),b=Boolean(o);return(0,De.jsx)(It().OT,{actionMenu:v,buttonPopupStore:r,actionId:t.id,canCollapse:!1,children:(0,De.jsxs)(It().h3,{actionId:t.id,actionRegistryItem:s,disabled:b,styles:p,children:[(0,De.jsx)(To,{actionStore:t,disabled:b,errorMessage:h,onChange:m,value:l,urlBehavior:d}),u?(0,De.jsx)(Io,{actionStore:t,disabled:b,onChange:g}):null]})})},duplicate_blocks:function(e){const{actionStore:t}=e,{disabled:o,editorPlacement:n}=(0,We().b)(),i=(0,re().v3)(),s=(0,le().IS)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:6,whiteSpace:"pre-wrap"}})),[]),l=(0,se().K8)((()=>(0,r().$1)(t.getBlockPointers())),[t],{useDeepEqual:!0}),c=(0,se().K8)((()=>function(e){const t=Object.values(go).find((t=>t.key===e));return t??fo}(t.getInsertionPoint())),[t]),d=(0,ae.useCallback)((e=>function(e,t,o){Q().createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,canUndo:!0,perform:e=>{X().zv({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(i,t,e)),[t,i]),u=(0,se().uB)(void 0,tt().A),p=(0,ae.useCallback)((()=>u.reset()),[u]),m=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:p})),[t,p]),g=(0,a().getActionRegistryItem)("duplicate_blocks"),f=Boolean(o);return(0,De.jsxs)(It().OT,{actionMenu:m,buttonPopupStore:u,disabled:f,actionId:t.id,canCollapse:!0,children:[(0,De.jsx)(It().h3,{actionId:t.id,actionRegistryItem:g,disabled:f,children:(0,De.jsx)("div",{style:s.title,children:(0,De.jsx)(D().sA,{...mo.title,values:{insertionPicker:(0,De.jsx)(yo,{currentOption:c,disabled:f,onChange:d})}})})}),(0,De.jsx)(It().qt,{disabled:f,children:l?(0,De.jsx)(vo,{actionStore:t,buttonPlacement:n,contentParentPointer:l,disabled:f}):null})]})},modal_confirmation:function(e){const{actionStore:t}=e,o=(0,re().v3)(),{isMobile:n}=(0,re().Y0)(),{automationStore:i}=(0,xe().EC)(),r=(0,D().tz)(),{disabled:s,maybePersistedTransactionActions:l}=(0,We().b)(),c=Boolean(s),d=(0,a().getActionRegistryItem)("modal_confirmation"),[u,p]=(0,se().K8)((()=>[t.id,t.getSpaceId()]),[t]),m=(0,yt().F)({actionId:u}),g=(0,le().IS)((e=>({input:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6},inputLabel:{color:e.text.tertiary,fontSize:n?14:12,lineHeight:1.3,fontWeight:ce().Wy.medium,display:"flex",alignItems:"center"}})),[n]),f=(0,se().uB)(void 0,tt().A),y=(0,ae.useCallback)((()=>f.reset()),[f]),h=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().K8)((()=>t.getConfigStore().getKeyStore("text")),[t]),b=(0,se().K8)((()=>v.getValue()),[v]),x=(0,se().K8)((()=>{if(p)return(0,Ft().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,bo().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:p,valueTypes:m.slice(0),featureGates:(0,j().i)()},value:b})}),[p,t.getRecordModel,m,b]),S=(0,se().K8)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),A=(0,se().K8)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),C=(0,ae.useCallback)((e=>{l.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{X().KY({store:v,value:e,transaction:t})}}),(0,lt().UB)(o,{automationStore:i,automationActionStore:t})}),[t,i,o,l,v]),M=(0,ae.useCallback)((()=>{(0,lt().UB)(o,{automationStore:i,automationActionStore:t})}),[t,i,o]),{onTextStoreSelect:k,onTextStoreUnselect:T}=(0,Lt().W)(t);return p&&x?(0,De.jsxs)(It().OT,{actionMenu:h,buttonPopupStore:f,disabled:c,actionId:t.id,canCollapse:!0,children:[(0,De.jsx)(It().h3,{actionId:t.id,actionRegistryItem:d,disabled:c,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,De.jsx)(D().sA,{...d.display.name})}),(0,De.jsx)(It().qt,{disabled:c,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:16,children:[(0,De.jsx)(So().M,{disabled:c,disableMobileActionBar:!0,formulaTypecheckContextValues:m,onChange:C,onTextStoreSelect:k,onTextStoreUnselect:T,parentRecordStore:t,placeholder:r.formatMessage(Ao.confirmationMessageLabel),rows:4,spaceId:p,value:b,analyzedFormulaOutput:x,labelMessageDescriptor:Ao.confirmationMessageLabel}),(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:6,children:[(0,De.jsx)("label",{style:g.inputLabel,children:(0,De.jsx)(D().sA,{...Ao.continueButtonTextLabel})}),(0,De.jsx)(Ke,{disabled:c,maxlength:xo().Vx,onChange:M,style:g.input,store:S})]}),(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:6,children:[(0,De.jsx)("label",{style:g.inputLabel,children:(0,De.jsx)(D().sA,{...Ao.cancelButtonTextLabel})}),(0,De.jsx)(Ke,{disabled:c,maxlength:xo().Vx,onChange:M,style:g.input,store:A})]})]})})]}):null},slack_notification:o(500071).y9,send_in_app_notification:function(e){var t;const{actionStore:o}=e,{isMobile:n}=(0,re().Y0)(),{automationStore:i,contextType:r}=(0,xe().EC)(),{disabled:s,maybePersistedTransactionActions:c,suppressActionErrors:d}=(0,We().b)(),u=(0,on().y)(i,r),p=!(0,l().O9)(u),m=Boolean(s),g=(0,a().getActionRegistryItem)("send_in_app_notification"),f=(0,se().K8)((()=>o.getSpaceId()),[o]),y=(0,se().K8)((()=>null==u?void 0:u.getSpaceShardedPointer()),[u]),h=(0,se().K8)((()=>{if(!u)return[];return(0,Co().Ge)({collectionFormat:u.getFormat(),collectionSchema:u.getSchema(),spaceId:u.getSpaceId(),restrictCrossSpace:P().default.checkGate({gateName:"collections_xws"})})}),[u]),v=(0,se().K8)((()=>{var e;return null==o||null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),b=(0,yt().F)({actionId:o.id}),x=(0,re().v3)();nn("formula"===(null==v?void 0:v.type)?null==v||null===(t=v.value)||void 0===t?void 0:t.value:void 0);const S=(0,se().K8)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.notification_message}),[o]),A=(0,se().K8)((()=>{if(f)return(0,Ft().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,bo().createFormulaDataRequestSyncHandler)(o.getRecordModel),spaceId:f,valueTypes:b.slice(0),featureGates:(0,j().i)()},value:S})}),[o.getRecordModel,S,b,f]),C=(0,se().uB)(void 0,tt().A),M=(0,ae.useCallback)((()=>C.reset()),[C]),k=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:o,closeMenu:M})),[o,M]),T=(0,ae.useMemo)((()=>!d.includes(o.id)),[d,o]),I=(0,st().X)("automation_updated_error_states"),{errorMessages:w,errorMessageDescriptors:_}=function(e){const{actionId:t,shouldShowError:o}=e,n={},i={};n.target=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"target"}).errorMessage;const a=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"notification_message"});return n.notification_message=a.errorMessage,i.notification_message=a.errorMessageDescriptor,n.collectionPointer=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"collectionPointer"}).errorMessage,n.propertyId=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"propertyId"}).errorMessage,n.formulaValue=(0,ie().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"formulaValue"}).errorMessage,{errorMessages:n,errorMessageDescriptors:i}}({actionId:o.id,shouldShowError:T}),B=(0,se().K8)((()=>(0,l().O9)(o.getConfigStore().getKeyStore("target").getValue())),[o]),R=(0,ae.useCallback)((e=>{c.createAndCommit({perform:t=>{X().zv({data:{target:{type:e}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTargetType"})}),[o,c]);(0,ae.useEffect)((()=>{!v&&p&&R("formula")}),[v,p,R]);const E=(0,ae.useCallback)((e=>{const t=e.value;if(!t)return;let n;"formula"===t.type?n={type:"formula",value:t}:"simple"===t.type?n={type:"formula",value:Ai(x,t)}:(0,l().HB)(t.type),c.createAndCommit({perform:e=>{X().zv({data:{target:{type:"formula",value:n.value}},store:o.getConfigStore(),transaction:e})},userAction:"SendInAppNotificationAction.setTarget"}),(0,lt().UB)(x,{automationStore:i,automationActionStore:o})}),[i,o,x,c]),D=(0,ae.useCallback)((e=>{c.createAndCommit({perform:t=>{X().zv({data:{target:{...e,collectionPointer:y}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTarget"}),(0,lt().UB)(x,{automationStore:i,automationActionStore:o})}),[o,i,y,x,c]),O=(0,ae.useCallback)((e=>{switch(e.type){case"formula":return E(e);case"property":return D(e);default:(0,l().HB)(e)}}),[E,D]),F=(0,ae.useCallback)((e=>{c.createAndCommit({perform:t=>{X().zv({data:{notification_message:e},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setNotificationMessage"}),(0,lt().UB)(x,{automationStore:i,automationActionStore:o})}),[o,i,x,c]),{onTextStoreSelect:V,onTextStoreUnselect:N}=(0,Lt().W)(o),L=(0,ae.useCallback)((()=>{de().clear({environment:x})}),[x]);return f&&A?(0,De.jsxs)(It().OT,{actionMenu:k,buttonPopupStore:C,disabled:m,actionId:o.id,canCollapse:B,children:[(0,De.jsx)(It().h3,{actionId:o.id,actionRegistryItem:g,disabled:s,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,De.jsx)(vi,{noCollection:p,targetsErrorMessage:w.target,selectedTargetType:null==v?void 0:v.type,onTargetTypeChange:R,disabled:Boolean(s)})}),v&&(0,De.jsx)(It().qt,{children:(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:16,children:[(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:6,children:[(0,De.jsx)(bi,{isMobile:n,selectedTargetType:v.type,isError:I&&Boolean("property"===v.type?w.propertyId:w.formulaValue)}),(0,De.jsx)("div",{children:(0,De.jsx)(Si,{collectionStore:u,disabled:Boolean(s),formulaTypecheckContextValues:b,currentTargetValue:v,currentProperties:h,onTargetValueChange:O,errorMessage:"property"===v.type?w.propertyId:w.formulaValue,parentRecordStore:o,spaceId:f})})]}),(0,De.jsx)(So().M,{analyzedFormulaOutput:A,labelMessageDescriptor:hi.notificationMessageLabel,disabled:m,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,errorMessageDescriptor:_.notification_message,formulaTypecheckContextValues:b,onChange:F,onTextStoreSelect:V,onTextStoreUnselect:N,onTextEsc:L,parentRecordStore:o,rows:3,spaceId:f,value:S})]})})]}):null},send_gmail_notification:function(e){const{actionStore:t}=e,o=function(e){return(0,se().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return;return tn().A.externalAuthentications.state.find((e=>e.integration_id===$o().eg&&t===e.id))}),[e])}(t),n=(0,se().K8)((()=>tn().A.externalAuthentications.state.filter((e=>e.integration_id===$o().eg))),[]);return(0,De.jsx)(ri,{actionStore:t,gmailAuthentications:n,currentGmailAuthentication:o,allGmailAuthentications:n})},define_variables:function(e){const{actionStore:t}=e,o=(0,re().v3)(),n=(0,D().tz)(),{automationStore:i}=(0,xe().EC)(),{disabled:r,maybePersistedTransactionActions:s}=(0,We().b)(),l=Boolean(r),c=(0,a().getActionRegistryItem)("define_variables"),d=(0,se().K8)((()=>i.getActionStores()),[i]),u=(0,se().K8)((()=>{const e=t.getConfigStore().getValue();return{values:(null==e?void 0:e.values)??{},variableIds:(null==e?void 0:e.variableIds)??[]}}),[t]),p=(0,se().uB)(void 0,tt().A),m=(0,ae.useCallback)((()=>p.reset()),[p]),g=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:m})),[t,m]),f=(0,ae.useCallback)((()=>{s.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,intl:n,transaction:i}=e,a=(0,Bt().Ay)(),r={name:(0,Rt().v)(o,n.formatMessage(_t().xC)),value:{type:"simple",value:[[""]]}};X().zv({data:{[a]:r},store:t.getConfigStore().getKeyStore("values"),transaction:i}),Q().applyOperation({operation:{args:{id:a},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:i})}({automationActionStore:t,automationActionStores:d,intl:n,transaction:e})},userAction:"DefineVariablesAction.addVariable"}),(0,lt().UB)(o,{automationStore:i,automationActionStore:t})}),[t,d,i,o,n,s]),y=(0,le().IS)((()=>({headerWrap:{paddingRight:32},titleWrap:{whiteSpace:"pre-wrap"},footer:{display:"flex",overflow:"hidden"}})),[]);return(0,De.jsxs)(It().OT,{actionMenu:g,buttonPopupStore:p,disabled:l,actionId:t.id,canCollapse:!0,children:[(0,De.jsx)(It().h3,{actionId:t.id,actionRegistryItem:c,disabled:l,styles:{headerWrap:y.headerWrap,titleWrap:y.titleWrap},children:(0,De.jsx)(D().sA,{...c.display.name})}),(0,De.jsx)(It().qt,{disabled:l,children:(0,De.jsxs)(Pt().Y1,{direction:"vertical",gap:16,children:[u.variableIds.length>0&&(0,De.jsx)(Pt().Y1,{direction:"vertical",gap:14,children:u.variableIds.map((e=>u.values[e]?(0,De.jsx)(so,{actionStore:t,variableId:e},e):null))}),(0,De.jsx)("footer",{style:y.footer,children:(0,De.jsx)(Ot,{disabled:l,onClick:f})})]})})]})},http_request:function(e){const{actionStore:t}=e,{disabled:n,maybePersistedTransactionActions:i,suppressActionErrors:r}=(0,We().b)(),{automationStore:l,contextType:c,typecheckResult:d}=(0,xe().EC)(),u=(0,on().y)(l,c),p=Boolean(n),m=(0,a().getActionRegistryItem)("http_request"),g=Ui(),f=(0,se().uB)(void 0,tt().A),y=(0,ae.useCallback)((()=>f.reset()),[f]),h=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:y})),[t,y]),v=(0,se().K8)((()=>t.getConfigStore().getKeyStore("url")),[t]),b=(0,se().K8)((()=>t.getConfigStore().getKeyStore("selectedProperties")),[t]),x=(0,se().K8)((()=>b.getValue()||{type:"some",some:[]}),[b]),S=(0,ae.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{X().KY({store:b,transaction:t,value:e})}})}),[b,i]),A=(0,le().IS)((e=>({divider:{marginBottom:8,marginTop:8},dividerColor:{color:e.stroke.secondary},errorMessage:{color:e.text.redTertiary}})),[]),[C,M]=(0,ae.useState)(!1),k=(0,ae.useMemo)((()=>!r.includes(t.id)||C),[r,t.id,C]),T=(0,se().K8)((()=>{if(!s().Q.isSuccess(d)||!k)return!1;return(d.value.actionValidationFailures[t.id]||[]).some((e=>"invalid_url"===e.type))}),[d,t,k]),I=(0,ie().useRequiresSubscriptionUpgradeError)({actionId:t.id,shouldShow:k}),j=Boolean(I),w=(0,ae.useCallback)((()=>{M(!0)}),[]);return(0,De.jsxs)(It().OT,{actionMenu:h,buttonPopupStore:f,disabled:p,actionId:t.id,canCollapse:!j,hideDragHandle:j,children:[(0,De.jsx)(It().h3,{actionId:t.id,actionRegistryItem:m,disabled:p,errorMessage:I,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,De.jsx)(D().sA,{...m.display.name})}),(0,De.jsxs)(It().qt,{disabled:p,styles:{bodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,De.jsx)("label",{style:g.inputLabel,children:(0,De.jsxs)(Mi().Ye,{alignItems:"center",gap:4,children:[(0,De.jsx)(D().sA,{...Ki.urlInputLabel}),(0,De.jsx)(Bi,{})]})}),(0,De.jsx)(Ke,{disabled:p,style:g.input,store:v,errorOutline:T,onBlur:w,maxlength:Ci().i8}),T&&(0,De.jsx)("div",{style:A.errorMessage,children:(0,De.jsx)(D().sA,{id:"SendWebhookAction.invalidUrl",defaultMessage:"Invalid URL"})}),(0,De.jsx)(Ii,{actionStore:t}),u&&(0,De.jsxs)(De.Fragment,{children:[(0,De.jsx)(o(802790).A,{size:1,style:A.divider,dividerColor:A.dividerColor.color}),(0,De.jsx)(Ni,{collectionStore:u,value:x,onChange:S})]})]})]})},publish_site:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,We().b)(),r=(0,se().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),s=Boolean(o),l=(0,a().getActionRegistryItem)("publish_site"),c=(0,se().uB)(void 0,tt().A),d=(0,ae.useCallback)((e=>{"url"!==e.type&&n.createAndCommit({perform:o=>{X().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"PublishSiteAction.setTarget"})}),[n,t]),u=(0,ae.useCallback)((()=>c.reset()),[c]),p=(0,ae.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:m}=(0,ie().useErrorComponentForAction)({actionId:t.id,shouldShow:p}),g=(0,ae.useMemo)((()=>(0,De.jsx)(ut().z,{actionStore:t,closeMenu:u})),[t,u]);return(0,De.jsxs)(It().OT,{actionMenu:g,buttonPopupStore:c,disabled:s,actionId:t.id,canCollapse:!0,children:[(0,De.jsx)(It().h3,{actionId:t.id,actionRegistryItem:l,disabled:s,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,De.jsx)(No,{actionStore:t,disabled:s,errorMessage:m,onTargetChange:d,value:r})}),(0,De.jsxs)(It().qt,{disabled:s,styles:{sectionBodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,De.jsx)(Lo,{}),(0,De.jsx)(Wo,{})]})]})}};var Gi=()=>o(142755);function Yi(e){const{children:t}=e,{isMobile:o}=(0,re().Y0)(),n=(0,le().IS)((e=>({wrap:{color:e.text.tertiary,fontSize:o?14:12,lineHeight:1.3,fontWeight:ce().Wy.medium}})),[o]);return(0,De.jsx)("div",{style:n.wrap,children:t})}const qi=(0,D().YK)({newActionLabel:{defaultMessage:"New action",id:"AutomationActionSelectButton.actionSection.newAction"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},builderModalActionTitle:{defaultMessage:"Do",id:"builderModal.editAutomationView.actionSection.title"}});function Xi(e){let{isEditable:t}=e;const{automationStore:o}=(0,xe().EC)(),{disabled:n}=(0,We().b)(),i=(0,it().V)(),{contextType:a}=(0,xe().EC)(),r="button_block"===a||"button_property"===a,s=(0,se().K8)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(l().Pe)),[o]),c=s.length>0,d=(0,le().IS)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%",...r&&{marginTop:20}},header:{alignItems:"center",display:"flex",flexDirection:"row",height:24},list:{display:"flex",flexDirection:"column"}})),[r]),u=!n&&t&&i.length>0;return(0,De.jsxs)("section",{style:d.section,children:[(0,De.jsx)("header",{style:d.header,children:(0,De.jsx)(Yi,{children:(0,De.jsx)(D().sA,{...qi.builderModalActionTitle})})}),(0,De.jsxs)("div",{style:d.list,children:[t?(0,De.jsx)(Ji,{actionStores:s}):(0,De.jsx)($i,{actionStores:s}),u&&(0,De.jsx)("footer",{children:(0,De.jsx)(ea,{disabled:n,hasAnyActions:c,variant:"button"})})]})]})}function $i(e){let{actionStores:t}=e;const o=(0,He().vV)();return(0,De.jsx)("div",{style:o.wrap,children:(0,De.jsx)("div",{style:o.list,children:t.map((e=>(0,De.jsx)("div",{className:He().xB,children:(0,De.jsx)(Qi,{actionStore:e})},e.id)))})})}function Ji(e){let{actionStores:t}=e;const o=(0,re().v3)(),{automationStore:n,contextType:a}=(0,xe().EC)(),{disabled:r,onActionDragStart:s,onActionDragEnd:c,maybePersistedTransactionActions:d}=(0,We().b)(),u=(0,D().tz)(),{value:p}=(0,et().fJ)(T().T.formulas),{value:m}=(0,et().fJ)(Xe().QV.automationTypecheck),g=(0,nt().n)(n),{automationActionMap:f,actionStoreIds:y}=(0,se().K8)((()=>{const e=[],t=new Map;return n.getActionStores().forEach((o=>{o.isDefined()&&o.hasConcern("display")&&(e.push(o.id),t.set(o.id,o))})),{automationActionMap:t,actionStoreIds:e}}),[n]),h=(0,se().uB)(void 0,ot().A),v=(0,ae.useCallback)((e=>{const t=e.state;if(t.willDrag){const e=f.get(t.draggingKey);(0,l().O9)(e)&&(0,l().O9)(s)&&s(e)}else t.willDrag||t.isDragging||null==c||c()}),[f,c,s]);(0,ae.useEffect)((()=>(h.addListener(v),()=>h.removeListener(v))),[f,h,v]);const b=(0,ae.useCallback)(((e,t)=>{p&&m&&d.createAndCommit({userAction:"AutomationButtonAction.moveAction",perform:r=>{i().reorderAutomationActions({environment:o,automationStore:n,automationTypecheckModule:m,contextType:a,formulasModule:p,intl:u,newActionIds:e,transaction:r,from:"drag_and_drop",movedActionId:t.key,isSubscribed:g})}})}),[n,a,m,p,u,d,o,g]),x=(0,ae.useMemo)((()=>!r&&t.length>1),[r,t]),S=(0,ae.useCallback)(((e,t)=>{const o=f.get(e);return(0,l().O9)(o)?(0,De.jsx)(Qi,{actionStore:o},o.id):null}),[f]);return t.length>0?(0,De.jsx)(Zi,{draggableListStore:h,hasDragging:x,keys:y,onDrop:b,renderKey:S}):null}function Qi(e){const{actionStore:t}=e,o=(0,se().K8)((()=>t.getType()),[t]);if(!o)return null;const n=Hi[o];return(0,De.jsx)(n,{actionStore:t})}function Zi(e){const{draggableListStore:t,hasDragging:o,keys:n,onDrop:i,renderKey:a}=e,{isMobile:r}=(0,re().Y0)(),s=(0,He().vV)();return(0,De.jsx)("div",{style:s.wrap,children:(0,De.jsx)(Qe().Ay,{childClassName:He().xB,direction:"vertical",disabled:!o||r,keys:n,onDrop:i,renderKey:a,store:t,style:s.list})})}function ea(e){const{disabled:t,hasAnyActions:o,variant:n}=e,i=(0,Me().j)(),a=(0,D().tz)(),r=(0,ae.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),s=(0,se().uB)(void 0,tt().A),l=(0,ae.useCallback)((()=>s.reset()),[s]),c=(0,le().IS)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.text.secondary,fill:e.mediumIconColor,margin:0,width:"100%"}})),[]),d=Boolean(t);return(0,De.jsx)(Je().Ay,{alignmentToOrigin:Je().yP.Start,buttonPopupStore:s,disabled:d,placementToOrigin:Je().sx.Bottom,popupType:i,render:()=>(0,De.jsx)(at().A,{initialState:r,onClose:l}),renderOrigin:e=>"icon"===n?(0,De.jsx)(Pe().A,{...e,ariaLabel:a.formatMessage(qi.addActionAriaLabel),disabled:d,disabledFeedback:d,icon:Ye().plusSmallIcon,iconStyle:{width:qe().Ev.sm,height:qe().Ev.sm}}):"button"===n?(0,De.jsx)(Gi().F,{...e,ariaLabel:a.formatMessage(qi.addActionAriaLabel),disabled:d,icon:(0,De.jsx)(Ze().I,{icon:Ye().plusSmallIcon,size:"sm"}),title:(0,De.jsx)(D().sA,{...o?qi.addActionLabel:qi.newActionLabel})}):(0,De.jsx)($e().A,{...e,buttonStyle:c.button,disabled:d,disabledFeedback:d,focused:!1,icon:(0,De.jsx)(Ze().I,{icon:Ge().plusIcon}),style:c.buttonWrap,title:o?(0,De.jsx)(D().sA,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,De.jsx)(D().sA,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}function ta(e){const{areActionsEditable:t,areTriggersEditable:o,footer:n}=e,{isMobile:i}=(0,re().Y0)(),a=(0,le().IS)((e=>({verticalRule:{background:e.stroke.primary,borderRadius:2,height:56,marginBottom:5,marginLeft:0,marginTop:16,width:2},container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",padding:i?"0 16px":void 0}})),[i]);return(0,De.jsxs)("div",{style:a.container,children:[(0,De.jsx)(He().Kn,{isEditable:o}),(0,De.jsx)("div",{style:a.verticalRule}),(0,De.jsx)(Xi,{isEditable:t}),n]})}const oa=(0,D().YK)({editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder"},buttonInsufficientPermissions:{defaultMessage:"You don’t have permission to run this button",id:"buttonBlock.button.insufficientPermissions"},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit"},done:{defaultMessage:"Done",id:"buttonBlock.button.done"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"buttonBlock.button.noEditError"}});function na(e){var t,o,n;const{buttonBlockStore:i}=e,a=(0,se().K8)((()=>i.state.editing?i.state:void 0),[i]),r=(0,le().IS)((e=>{var t;return{popup:{width:400},editor:{background:e.contentBackground,..."inline"===(null==a||null===(t=a.placement)||void 0===t?void 0:t.type)?{marginTop:6,borderRadius:6,border:`1px solid ${e.regularDividerColor}`,maxWidth:600}:{}}}}),[null==a||null===(t=a.placement)||void 0===t?void 0:t.type]),s=(0,Me().j)({tabletBehavior:"slideUp"});return a&&a.placement?"popup"===(null===(o=a.placement)||void 0===o?void 0:o.type)?(0,De.jsx)(me().Ay,{open:!0,popupType:s,render:()=>(0,De.jsx)(ia,{...e,style:r.editor}),originRect:a.placement.originRect,style:r.popup,originGap:4,onDismiss:()=>{i.stopEditing()}}):"inline"===(null===(n=a.placement)||void 0===n?void 0:n.type)?(0,De.jsx)(ia,{...e,style:r.editor}):void(0,l().HB)(a.placement):null}function ia(e){const{disabled:t,store:o,buttonBlockStore:n}=e,i=(0,re().v3)(),[a,r]=(0,he().z)(),s=(0,le().IS)((e=>({scroller:{maxHeight:"75vh"},container:{fontFamily:ce().Tf.sans},footerButton:{height:32,width:"100%"},upgradeMessageWrap:{margin:8},footerButtonWrap:{width:"100%",display:"flex",flexDirection:"column",paddingTop:24}})),[]),l=(0,se().K8)((()=>o.getAutomationStore()),[o]),c=(0,se().K8)((()=>null==l?void 0:l.getSpaceId()),[l]),{maybePersistedAutomationStore:d,maybePersistedTransactionActions:u}=(0,Te().t)({automationId:null==l?void 0:l.id,spaceId:c,defaultValue:void 0,persist:!0}),p=(0,ke().OW)({store:o,automationStore:d}),m=(0,se().K8)((()=>{var e;return o.canEdit()&&"sufficient"===(null==p||null===(e=p.state)||void 0===e?void 0:e.editPermissionStatus)}),[o,p]),g=(0,se().K8)((()=>n.state.editing?n.state.placement:void 0),[n]),f=(0,ae.useCallback)((e=>{(0,ye().SQ)({event:e,context:ye().y$.EditorClick,callback:()=>{de().clear({environment:i}),J().IU({environment:i})}})}),[i]),y=(0,ae.useCallback)((()=>{n.stopEditing(),(0,I().u4)({environment:i,event:{eventName:"click_configure_button_done",eventProperties:{block_id:o.id,automation_id:null==d?void 0:d.id}}}),P().default.logEvent("click_configure_button_done")}),[n,i,o,d]),h=(0,se().K8)((()=>n.state.suppressErrorsForActionIds),[n]),v=(0,ae.useCallback)((e=>n.suppressErrorsForAction(e.id)),[n]),b=(0,ae.useCallback)((()=>{be().K(i,{from:"button_block_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}})}),[i]),x=(0,Ce().c)(),S=t||!m,A=(0,se().K8)((()=>{var e;return!(null==p||null===(e=p.state)||void 0===e||!e.typecheckResult)&&(0,Ae().h)({environment:i,typecheckResult:p.state.typecheckResult,automationStore:d})}),[p,i,d]);return d?(0,De.jsx)("div",{ref:a,style:{...s.container,...e.style},onClick:f,children:(0,De.jsx)(xe().u,{automationStore:d,contextType:"button_block",children:(0,De.jsxs)(Se().v,{value:{disabled:S,editorPlacement:g,editorWidth:r,maybePersistedTransactionActions:u,onActionAdded:v,suppressActionErrors:h,hideDragHandle:A,...x},defaultCollapseActions:A,children:[(0,De.jsx)(aa,{blockStore:o,disabled:S}),(0,De.jsxs)(fe().H,{style:s.scroller,type:ve().A.Y,children:[A&&(0,De.jsx)("div",{style:s.upgradeMessageWrap,children:(0,De.jsx)(Ue().j,{onUpsellClick:b})}),!m&&(0,De.jsx)("div",{style:s.upgradeMessageWrap,children:(0,De.jsx)(Ie().z,{children:(0,De.jsx)(D().sA,{...oa.noEditError})})}),(0,De.jsx)("section",{style:{paddingBlock:8,paddingInline:8},children:(0,De.jsx)(ta,{areActionsEditable:!A,areTriggersEditable:!1,footer:(0,De.jsx)("div",{style:s.footerButtonWrap,children:(0,De.jsx)(ge().A,{onClick:y,style:s.footerButton,children:(0,De.jsx)(D().sA,{...oa.done})})})})})]})]})})}):null}function aa(e){const{blockStore:t,disabled:o}=e,{automationStore:n}=(0,xe().EC)(),i=(0,re().v3)(),a=(0,le().IS)((e=>({wrap:{display:"flex",flexDirection:"column",padding:12,gap:6},inputs:{display:"flex",alignItems:"center",gap:6,borderBottom:`1px solid ${e.stroke.secondary}`,paddingBottom:12},nameInputWrap:{flexGrow:"1"},nameInput:{background:"transparent",boxShadow:"none",padding:4}})),[]),r=(0,se().K8)((()=>n.getNameStore()),[n]),s=(0,se().K8)((()=>n.getIconStore()),[n]),l=(0,se().K8)((()=>(null==r?void 0:r.getValue())??""),[r]),c=(0,se().K8)((()=>null==s?void 0:s.getValue()),[s]),d=(0,ae.useCallback)(((e,t)=>{Q().createAndCommit({userAction:"ButtonBlock.updateProperty",environment:i,canUndo:!0,perform:o=>{X().zv({store:n.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[n,i]),u=(0,ae.useCallback)((e=>d("icon",e)),[d]),p=(0,ae.useCallback)((e=>d("name",e)),[d]);return(0,De.jsx)(ue().s,{allowSelectionWithin:!0,style:a.wrap,children:(0,De.jsxs)("div",{style:a.inputs,children:[(0,De.jsx)(Fe,{disabled:o,currentIcon:c,handleIconChange:u,store:t}),(0,De.jsx)(ze,{onChange:p,value:l,disabled:o,placeholder:w().A.formatMessage(oa.buttonPlaceholder),wrapStyle:a.nameInputWrap,style:a.nameInput,format:pe().C.ExtraLarge,autoFocus:!l})]})})}var ra=()=>o(591779),sa=()=>o(728611),la=(o(16280),()=>o(495408)),ca=()=>o(881254);function da(e){var t;const{url:o,parentStore:n,onMouseEnter:i,onMouseLeave:a}=e,r=(0,re().v3)(),[s]=(0,dn().Yb)((async()=>{var e,t;const n=await q().callApi({eventName:"getDataForLinkMention",environment:r,data:{url:o,spaceId:(null===(e=ee().default.state.currentSpaceStore)||void 0===e?void 0:e.id)??(null===(t=ee().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId()),source:"button_hover"}});if("success"===n.type){if("error"in n.data)throw new Error(`Error in iframely response: ${n.data.status} ${n.data.error}`);return n.data}throw n.error}),[r,o]);let l;return l=null!==(t=s.value)&&void 0!==t&&t.iframe?(0,De.jsx)(la().p,{hoverData:s.value,iframe_url:s.value.iframe,height:s.value.height,padding:s.value.padding,padding_top:s.value.padding_top,store:n,href:o,showEditButton:!1}):(0,De.jsx)(ca().R,{hoverData:s.value,href:o,showEditButton:!1,store:n,loading:"pending"===s.status}),(0,De.jsx)("div",{onMouseEnter:i,onMouseLeave:a,children:l})}function ua(e){const{renderOrigin:t}=e;return(0,re().Y0)().isMobile?(0,De.jsx)(De.Fragment,{children:t()}):(0,De.jsx)(pa,{...e})}function pa(e){const{renderOrigin:t,urlToPreview:o,parentStore:n}=e,[i,a]=(0,ae.useState)(!1),s=(0,ae.useMemo)((()=>({onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)}})),[]),l=function(e){const{targetHovered:t}=e,[o,n]=(0,ae.useState)(!1),i=(0,ra().lW)(t,400,Object.is),[a,s]=(0,ae.useState)(!1),l=a||!o&&i,c=(0,ae.useCallback)((()=>s(l)),[l]),d=(0,ae.useCallback)((()=>{s(!1)}),[]),u=(0,ae.useCallback)((()=>{d(),n(!0)}),[d]);return(0,ae.useEffect)((()=>{n(!1)}),[i]),(0,ae.useEffect)((()=>{const e=r().nF((()=>{u()}),200,{leading:!0});return sa().P4(window,"scroll",e,!0),()=>sa().Ol(window,"scroll",e,!0)}),[u]),{state:l,pinPopup:c,unpinPopup:d}}({targetHovered:i});return(0,De.jsx)(me().Ay,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,originGap:6,preventOpacityTransition:!0,open:l.state,popupType:me().nl.Popup,alignmentToOrigin:Kt().C.Start,placementToOrigin:Kt().W.Bottom,render:()=>(0,De.jsx)(da,{url:o,parentStore:n,onMouseEnter:l.pinPopup,onMouseLeave:l.unpinPopup}),origin:t(s)})}},49383:(e,t,o)=>{o.r(t),o.d(t,{CollectionSettingsAutomationsView:()=>n().Ay});var n=()=>o(463562)},69447:(e,t,o)=>{o.d(t,{Lq:()=>n,WK:()=>a,nh:()=>i});const n=40,i=48,a=60},80524:(e,t,o)=>{o.r(t),o.d(t,{AutomationBuilderModal:()=>rt,ButtonBuilderModal:()=>vt});o(944114),o(898992),o(354520),o(737550);var n=o(296540),i=()=>o(484714),a=()=>o(847249),r=()=>o(401497),s=()=>o(422540),l=()=>o(278132),c=()=>o(66913),d=()=>o(912720),u=()=>o(959013),p=()=>o(496603),m=()=>o(973647),g=()=>o(534177),f=()=>o(284371),y=()=>o(686526),h=()=>o(436572),v=()=>o(813297),b=()=>o(735695),x=()=>o(704152),S=()=>o(939740),A=()=>o(864943),C=()=>o(204063),M=()=>o(89924),k=()=>o(898125),T=()=>o(584262),I=()=>o(101209),j=()=>o(735384),w=()=>o(693954),P=()=>o(792071),_=()=>o(142748),B=()=>o(179034),R=()=>o(824862),E=()=>o(519831),D=()=>o(96689),O=()=>o(867201),F=()=>o(837570),V=()=>o(774256),N=()=>o(826352),L=()=>o(546461),W=()=>o(76190),z=()=>o(493823),K=()=>o(719147),U=()=>o(862292),H=()=>o(989423),G=()=>o(157857),Y=()=>o(731320),q=()=>o(645873),X=()=>o(630116),$=()=>o(991249),J=o(474848);const Q=(0,u().YK)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationExternalBotNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationExternalBotNoPermissions"},automationExternalBotWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationExternalBotWithPermissions"},automationMissingPermissionsNoPermissionsForDatabase:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissionsForDatabase"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"},automationCollectionInTrashedPage:{defaultMessage:"This database is in the trash and cannot be edited.",id:"AutomationHeaderView.automationCollectionInTrash"},automationCollectionInTrashedPageViewDeletedPageButton:{defaultMessage:"View deleted page",id:"AutomationHeaderView.automationCollectionInTrashedPageViewDeletedPageButton"},automationMissingActionFeature:{defaultMessage:"The {actionName} action is not available in your workspace",id:"AutomationHeaderView.automationMissingActionFeature"},mustBeWorkspaceMember:{defaultMessage:"You must be a workspace member to edit automations",id:"AutomationHeaderView.mustBeWorkspaceMember"}});function Z(e){const{automationPermissionScope:t,collectionStore:o,collectionSettingsStore:r,onDelete:s,referencesIncompatibleCollectionViewFilter:l,requiresSubscriptionUpgrade:c}=e,d=(0,i().v3)(),{automationStore:p,contextType:m}=(0,L().EC)(),f=(0,u().tz)(),{value:y}=(0,q().fJ)(U().T.formulas),{value:h}=(0,q().fJ)(v().QV.automationActionRegistry),{value:b}=(0,q().fJ)(v().QV.automationTypecheck),x=(0,a().K8)((()=>Boolean((0,Y().qb)(d,p))),[p,d]),S=(0,W().n)(p),A=(0,a().K8)((()=>(0,G().sl)({environment:d,automationStore:p,automationActionRegistryModule:h,automationTypecheckModule:b,contextType:m,formulasModule:y,intl:f,isSubscribed:S})),[d,p,h,b,m,y,f,S]),C=(0,a().K8)((()=>{const e=(0,_().O)({recordPointer:o.pointer,getRecordModel:o.getRecordModel});if(!e||e.table!==B().ev)return;const t=e.pointer;return X().Bv.createChildStore(o,t)}),[o]),M=(0,n.useCallback)((()=>{$().K(d,{from:"database_automation_settings_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}})}),[d]),k=ne();if(c)return(0,J.jsx)(N().j,{onUpsellClick:M});if(C)return(0,J.jsx)(oe,{icon:(0,J.jsx)("div",{style:k.lockedIconWrap,children:(0,j().I)(k.lockedIcon)}),children:(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{style:k.paragraph,children:(0,J.jsx)(u().sA,{...Q.automationCollectionInTrashedPage})}),(0,J.jsx)(z().p,{onClick:()=>{!function(e,t){(function(e){(0,H().vd)(e,"view_deleted_page_from_automation_edit_menu")})(t),O().Y({environment:t,store:e,pageVisitSource:T().y8.LinkInPage})}(C,d),F().V({environment:d,collectionSettingsStore:r})},style:k.restoreButton,isLightGray:!0,children:(0,J.jsx)(u().sA,{...Q.automationCollectionInTrashedPageViewDeletedPageButton})})]})});if(x)return(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationPublicAccess})});if("insufficient"===A.editPermissionStatus){if("free_workspace"===A.reason)return(0,G().ip)({contextType:m,environment:d})?(0,J.jsx)(te,{icon:(0,J.jsx)("div",{style:k.boltIconWrap,children:(0,I().v)(k.boltIcon)}),children:(0,J.jsx)("p",{style:k.paragraph,children:(0,J.jsx)(u().sA,{...Q.automationUpgrade,values:{"anchor-upsell":e=>(0,J.jsx)(K().A,{onClick:M,style:k.link,children:e})}})})}):(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationEditOnSite})});if("feature_not_enabled"===A.reason)return(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationMissingActionFeature,values:{actionName:A.actionName.toLocaleLowerCase()}})});var P,Z,ie;if("missing_permissions"===A.reason)return(null===(P=A.relatedPointer)||void 0===P?void 0:P.table)===R().GP?(0,J.jsx)(ee,{botId:A.relatedPointer.id,automationPermissionScope:t,onDelete:s,automationStore:p}):(null===(Z=A.relatedPointer)||void 0===Z?void 0:Z.table)===E().Vl&&A.relatedPointer.id!==o.id?(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationMissingPermissionsNoPermissionsForDatabase})}):(null===(ie=A.relatedPointer)||void 0===ie?void 0:ie.table)===D().NX?(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.mustBeWorkspaceMember})}):(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationGenericFullAccess})});(0,g().HB)(A)}else{if("unknown"===A.editPermissionStatus)return(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...Q.automationGenericFullAccess})});if("sufficient"===A.editPermissionStatus)return l?(0,J.jsx)(V().z,{icon:(0,w().Q)(k.warningIcon),children:(0,J.jsx)(u().sA,{...Q.automationIncompatibleViewFilterAndOwner})}):null;(0,g().HB)(A)}}function ee(e){const{botId:t,automationPermissionScope:o,onDelete:n,automationStore:i}=e,r=(0,u().tz)(),s=ne(),l=(0,a().K8)((()=>{const e=X().vK.createChildStore(i,{id:t,spaceId:i.getSpaceId(),table:R().GP}).getCreatedByStore();return e?e.getDisplayName(r):r.formatMessage(P().Fvx.messages.anonymousPlaceholder)}),[i,t,r]);return(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{..."readonly"===o?Q.automationExternalBotNoPermissions:Q.automationExternalBotWithPermissions,values:{"anchor-delete":e=>(0,J.jsx)(K().A,{onClick:n,style:s.link,children:e}),user:l}})})}function te(e){const{children:t,icon:o}=e,n=ne();return(0,J.jsx)("div",{style:n.wrapWrap,children:(0,J.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,J.jsx)("div",{style:n.iconWrap,children:o}),(0,J.jsx)("div",{style:n.messageWrap,children:t})]})})}function oe(e){const{children:t,icon:o}=e,n=ne();return(0,J.jsx)("div",{style:n.wrapWrap,children:(0,J.jsxs)("div",{style:n.trashPageWrap,children:[o&&(0,J.jsx)("div",{style:n.iconWrap,children:o}),(0,J.jsx)("div",{style:n.messageWrap,children:t})]})})}function ne(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({boltIcon:{fill:t.icon.yellowPrimary,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},restoreButton:{fontSize:e?14:12,fontWeight:f().Wy.medium,marginLeft:-8},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},trashPageWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10,background:t.accentColors.gray[30],padding:8,borderRadius:6},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var ie=()=>o(366360),ae=()=>o(946548),re=()=>o(859428),se=()=>o(115512);const le=(0,u().YK)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"},automationErrorsDisabledTooltip:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"collectionSettings.editAutomationView.automationErrorsDisabledTooltip"}});function ce(e){const{automationId:t,automationOwner:o,disabled:a,isAutomationPaused:s,onPause:l,onResume:c}=e,{cantSaveDueToError:d}=(0,ie().b)(),{isMobile:p}=(0,i().Y0)(),m=`toggle-${t}`,g=(0,n.useCallback)((()=>{s?null==c||c():null==l||l()}),[s,c,l]),y=(0,r().IS)((e=>({labelWrap:{color:a?e.text.tertiary:e.text.secondary,flex:"1 1 auto",fontSize:p?f().J.UIRegular.mobile:f().J.UIRegular.desktop},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:0},toggleWrap:{flex:"0 0 auto",paddingBlockStart:p?5:2}})),[a,p]),h=le.automationEnabledLabel,v=s?le.automationPausedHiddenAriaLabel:le.automationEnabledHiddenAriaLabel;return(0,J.jsxs)("section",{style:y.sectionWrap,children:[(0,J.jsx)("div",{style:y.toggleWrap,children:(0,J.jsx)(re().A,{disableTooltip:!a||!s,renderTooltip:()=>d?(0,J.jsx)(u().sA,{...le.automationErrorsDisabledTooltip}):(0,J.jsx)(u().sA,{...le.automationDisabledTooltip,values:{user:o}}),render:e=>(0,J.jsx)("div",{...e,children:(0,J.jsx)(ae().A,{disabled:a,inputId:m,on:!s,onClick:g})})})}),(0,J.jsx)("div",{style:y.labelWrap,children:(0,J.jsxs)("label",{htmlFor:m,children:[(0,J.jsx)("span",{"aria-hidden":!0,children:(0,J.jsx)(u().sA,{...h})}),(0,J.jsx)("span",{style:se().Qg,children:(0,J.jsx)(u().sA,{...v})})]})})]})}var de=()=>o(508496);var ue=()=>o(253579);function pe(e){const{shouldInvokeHandler:t,isMobile:o,onClick:i}=e;(0,n.useEffect)((()=>{async function e(e){const o=e.target instanceof Element&&((0,ue().pM)(e.target)||(0,ue().m5)(e.target));e.eventPhase===Event.CAPTURING_PHASE&&t&&o&&(e.stopPropagation(),e.preventDefault(),await i())}if(!o)return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o,i])}var me=()=>o(726483),ge=()=>o(698331),fe=()=>o(594794),ye=()=>o(963589),he=()=>o(246125),ve=()=>o(351360),be=()=>o(940371),xe=()=>o(911724),Se=()=>o(276936),Ae=()=>o(104636),Ce=()=>o(190019),Me=()=>o(559419);var ke=()=>o(633904);function Te(){const{automationStore:e}=(0,ie().k)();return(0,a().K8)((()=>function(e){var t;const o=(null===(t=e.getTrigger())||void 0===t?void 0:t.type)??"event";return"event"===o||"recurrence"!==o&&void(0,g().HB)(o)}(e)),[e])}var Ie=()=>o(751156),je=()=>o(623580),we=()=>o(419357);const Pe=(0,u().YK)({placeholder:{defaultMessage:"Automation name",id:"AutomationNameInput.placeholder"}});const _e=(0,n.forwardRef)((function(e,t){const{disabled:s,autoSelectAllOnDesktop:l,placeholder:c,...d}=e,{automationStore:p}=(0,L().EC)(),{maybePersistedTransactionActions:m}=(0,ie().b)(),g=function(e){const{isMobile:t}=(0,i().Y0)(),{disabled:o}=e;return(0,r().IS)((e=>({automationNameInput:{marginBlockEnd:0,paddingInline:0},automationNameText:{color:o?e.text.tertiary:e.text.primary,marginInlineStart:t?12:0,marginInlineEnd:t?12:18,fontWeight:f().Wy.medium,padding:0},input:{background:"transparent",boxShadow:"unset",fontWeight:f().Wy.medium,padding:0}})),[t,o])}({showDeleteEnableDisableOptions:!1,disabled:s}),{isMobile:y}=(0,i().Y0)(),h=(0,u().tz)(),v=(0,a().K8)((()=>(null==p?void 0:p.getName())??""),[p]),b=(0,n.useRef)(null),x=(0,o(93583).A)(b,t),S=c||h.formatMessage(Pe.placeholder),A=(0,n.useCallback)((e=>{m.createAndCommit({userAction:"Automation.updateName",perform:t=>{Ie().applyOperation({store:p,operation:{path:["properties"],pointer:p.pointer,command:"update",args:{name:e}},transaction:t})}})}),[p,m]),C=(0,n.useCallback)((e=>{const t=e.currentTarget.value;A(t)}),[A]),M=(0,n.useCallback)((e=>{e.currentTarget.value||A(S)}),[A,S]);return(0,n.useEffect)((()=>{var e;l&&!y&&(null===(e=b.current)||void 0===e||null===(e=e.querySelector("input"))||void 0===e||e.select())}),[l,y]),(0,o(852507).l)((()=>{y&&!v&&A(S)})),(0,J.jsx)(we().Ay,{style:g.automationNameInput,...d,value:v??"Loading...",onChange:C,disabled:s,onBlur:M,ref:x,inputOuterStyle:g.input,format:je().C.ExtraLarge,textWrapperStyle:g.automationNameText,placeholder:S,inputStyle:{paddingLeft:0,paddingRight:0},autoFocus:!v})}));var Be=()=>o(401634),Re=()=>o(668725),Ee=()=>o(869558),De=()=>o(406699),Oe=()=>o(656134),Fe=(o(581454),o(908872),()=>o(289915)),Ve=()=>o(701545),Ne=()=>o(745266),Le=()=>o(31902),We=()=>o(519839),ze=()=>o(736767),Ke=()=>o(760217),Ue=()=>o(928600),He=()=>o(480095),Ge=()=>o(614505),Ye=()=>o(682146),qe=()=>o(722872),Xe=()=>o(71304),$e=()=>o(962730);const Je=(0,u().YK)({forPagesIn:{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}});function Qe(e){const{selectedSourcePointer:t,collectionContextStore:o,onSelect:r,onClose:s}=e,{isMobile:l}=(0,i().Y0)(),c=(0,u().tz)(),d=(0,i().v3)(),[m,f]=n.useState(""),y=(0,a().K8)((()=>o.collectionStore()),[o]),h=(0,a().K8)((()=>o.collectionViewBlockStore()),[o]),v=(0,a().K8)((()=>h&&y?h.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===y.id})):[]),[h,y]),b=(0,a().K8)((()=>{if(!y)return[];let e;t&&"collection_view"===t.table&&(e=X().pS.createChildStore(y,t));return p().hS([...v,e].filter(g().O9),(e=>{let{id:t}=e;return t})).filter((e=>(0,We().As)(e,m)))}),[y,v,m,t]),x=(0,a().K8)((()=>{if(y&&(0,Ye().zY)({collectionStore:y,environment:d,intl:c,queryForFilter:m}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:a,intl:r}=e,s=t.getIcon(),l=(0,Xe().tS)({environment:o,intl:r,store:t}),c=n&&"collection"===n.table&&n.id===t.id,d=t.getSpaceShardedPointer(),p={key:t.id,action:()=>{d&&i(d)},render:e=>(0,J.jsx)(Ke().A,{...e,icon:s&&(0,J.jsx)(Ge().B,{isEmptyPage:!1,size:a?18:16,disabled:!0,icon:s}),title:l,caption:(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Entire database",values:{collectionName:l}}),right:c&&(0,Ve().p)({width:16,height:"auto"})})};return{key:"collection",items:[p],render:e=>(0,J.jsx)(M().A,{...e})}}({collectionStore:y,environment:d,selectedSourcePointer:t,onSelect:r,isMobile:l,intl:c})}),[y,d,c,l,r,m,t]),A=(0,a().K8)((()=>y&&h&&v?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:a,intl:r}=e,s=n.getSchema(),l=o.map((e=>{if("form_editor"===e.getType()||"chart"===e.getType())return;const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const l=i&&"collection_view"===i.table&&i.id===o.id,c=(0,me().RN)({collectionViewStore:e,collectionSchema:s}),d=(0,me().EN)({collectionViewStore:e,collectionSchema:s}),p=(0,g().O9)(c)||(0,g().O9)(d),m=e.getType(),f=e.getFormat().collection_view_icon,y=e.getName(),h=(o,n)=>(0,J.jsx)(Ke().A,{...o,...n,icon:(0,J.jsx)(Ne().h,{color:"lightGray",viewType:m,viewIcon:f}),title:(0,J.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,J.jsx)(Le().A,{collectionViewType:m,collectionViewName:y}),p&&l&&(0,w().Q)({width:16,height:"auto"})]}),caption:(0,J.jsx)(Ze,{blockStore:t,collectionViewStore:e,intl:r,collectionSchema:s,referencesIncompatibleProperties:p}),right:l&&(0,Ve().p)({width:16,height:"auto"}),disabled:p,disabledFeedback:p});let v;if(p&&c){var n;const e=null===(n=s[c])||void 0===n?void 0:n.type,t=e?Ye().dC[e]:void 0,o=t?(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});v=e=>(0,J.jsx)(re().A,{placement:$e().W.Right,renderTooltip:()=>o,render:t=>h(e,t)})}else if((0,g().O9)(d)){const e=(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.crossSpace",defaultMessage:"Cross work-space properties are not supported"});v=t=>(0,J.jsx)(re().A,{placement:$e().W.Right,renderTooltip:()=>e,render:e=>h(t,e)})}else v=h;return{key:e.id,action:()=>{a(o)},render:v}}}));return[...l].filter(g().O9)}({blockStore:h,collectionStore:y,filteredCollectionViewStores:b,selectedSourcePointer:t,onSelect:r,intl:c}):[]),[h,y,v,b,c,r,t]),C=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,J.jsx)(M().A,{...e,topBorder:!0})}}({menuListItems:A}),k={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,J.jsx)(we().Ay,{value:m,focus:!0,onChange:e=>f(e.target.value),placeholder:c.formatMessage({defaultMessage:"Search views...",id:"collectionViewSelect.viewSearch.placeholder"})})}],render:e=>(0,J.jsx)(M().A,{isInput:!0,...e})};let T;(0,g().O9)(x)||(0,g().O9)(C)||(T={key:"no-results-section",items:[{key:"no-results-item",action:p().lQ,render:()=>(0,J.jsx)(ze().A,{caption:(0,J.jsx)(u().sA,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,J.jsx)(M().A,{...e,topBorder:!0})});const I=[k,x,C,T].filter(g().O9);if(!y)return null;let j;return j=l?{menuType:qe().gu.Modal,title:(0,J.jsx)("div",{style:{display:"flex"},children:(0,J.jsx)(u().sA,{...Je.forPagesIn})}),right:(0,J.jsx)(He().DoneMenuText,{}),onClickRight:()=>{s()}}:{menuType:qe().gu.Popup,width:230,maxHeight:"50vh"},(0,J.jsx)(Ue().A,{...j,children:(0,J.jsx)(S().Ay,{type:S().Oh.Vertical,sections:I,initialFocus:0,onAccept:()=>{s()}})})}function Ze(e){const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:r,referencesIncompatibleProperties:s}=e,l=(0,i().v3)(),c=(0,a().K8)((()=>!o.getAlive()),[o]),d=(0,a().K8)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,Xe().tS)({environment:l,intl:n,store:e}):void 0}),[t.id,o,n,l]),p=(0,a().K8)((()=>{const e=o.getQuery(r);return(0,Fe().rg)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:r}).reduce(((e,t)=>{if((0,Fe().yX)(t))return e+1;return e+(t.filters??[]).length}),0)}),[r,o]);return s?(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):c?(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,J.jsx)("em",{children:e})}}):d?(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,J.jsx)("em",{children:e}),externalParentBlockName:d}}):0===p?(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:p}})}function et(e){const{pointer:t,collectionStore:o,intl:n}=e,s=(0,i().v3)(),l=(0,r().IS)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...f().RC},errorText:{color:e.errorText,fontWeight:f().Wy.medium}})),[]),c=(0,a().K8)((()=>t?X().sk.createChildStore(o,t):void 0),[o,t]),d=(0,a().K8)((()=>c?(0,Xe().tS)({environment:s,intl:n,store:c}):(0,J.jsx)("span",{style:l.errorText,children:(0,J.jsx)(u().sA,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[s,n,l.errorText,c]),p=(0,a().K8)((()=>{if(!c||c.table===E().Vl)return!1;const e=o.getSchema();return(0,g().O9)((0,me().RN)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,J.jsxs)("div",{style:l.titleContainer,children:[p&&(0,w().Q)(l.warningIcon),(0,J.jsx)("span",{style:l.title,children:d})]})}function tt(e){const{collectionContextStore:t,disabled:o}=e,{isMobile:s}=(0,i().Y0)(),l=(0,u().tz)(),c=(0,r().IS)((e=>{const t=o?e.text.tertiary:e.text.secondary,n=s?f().J.UIRegular.mobile:f().J.UIRegular.desktop;return{wrap:{alignItems:"center",color:t,cursor:"default",display:"grid",fontSize:n,gridTemplateColumns:"auto auto"},button:{color:t,fontWeight:f().Wy.medium,fontSize:n,width:"100%",height:24,paddingLeft:6,paddingRight:6,marginLeft:1},icon:{width:10,marginLeft:4,fill:t}}}),[s,o]),{automationStore:d}=(0,L().EC)(),{maybePersistedTransactionActions:p}=(0,ie().b)(),m=(0,a().K8)((()=>t.collectionStore()),[t]),g=(0,a().K8)((()=>{const e=null==d?void 0:d.getTrigger();if("event"===(null==e?void 0:e.type)){const t=e.event.source;if(t&&"filter"!==t.type)return t.pointer}}),[d]),y=(0,n.useCallback)((e=>{const t=e.table===E().Vl?{pointer:e,type:E().Vl}:{pointer:e,type:Ee().Gy};p.createAndCommit({userAction:"Automation.updateSource",perform:e=>{Ie().applyOperation({store:d,operation:{path:["trigger","event"],pointer:d.pointer,command:"update",args:{source:t}},transaction:e})}})}),[d,p]),h=(0,Oe().j)(),v=m?(0,J.jsx)(et,{pointer:g,collectionStore:m,intl:l}):(0,J.jsx)(n.Fragment,{}),b=(0,J.jsx)(De().Ay,{alignmentToOrigin:De().yP.Start,placementToOrigin:De().sx.Bottom,popupType:h,render:e=>(0,J.jsx)(Qe,{selectedSourcePointer:g,onSelect:y,onClose:()=>{e.close()},collectionContextStore:t}),renderOrigin:e=>(0,J.jsxs)(z().p,{...e,style:c.button,disabled:o,children:[v,(0,Re().b)(c.icon)]})});return(0,J.jsx)("div",{style:c.wrap,children:(0,J.jsx)(u().sA,{id:"automationBuilderModal.SourceInput.appliesTo",defaultMessage:"For all pages in {button}",values:{button:b}})})}function ot(){const e=(0,i().v3)(),t=(0,u().tz)(),{isMobile:o}=(0,i().Y0)(),n=(0,r().IS)((e=>{const t=o?f().J.UIRegular.mobile:f().J.UIRegular.desktop;return{wrap:{color:e.text.secondary,fontSize:t},title:{color:e.text.secondary,fontWeight:f().Wy.medium,fontSize:t}}}),[o]),{collectionStore:s}=(0,ie().k)(),l=(0,a().K8)((()=>(0,Xe().tS)({environment:e,intl:t,store:s})),[s,e,t]),c=(0,J.jsx)("span",{style:n.title,children:l});return(0,J.jsx)("div",{style:n.wrap,children:(0,J.jsx)(u().sA,{id:"automationBuilderModal.SourceLabel.appliesTo",defaultMessage:"For {source}",values:{source:c}})})}let nt;(0,o(604341).exposeDebugGetter)("currentAutomation",(()=>nt));const it=(0,u().YK)({deleteButton:{id:"automationBuilderModal.editAutomationView.deleteButton",defaultMessage:"Delete"},createButton:{id:"automationBuilderModal.editAutomationView.createButton.label",defaultMessage:"Create"},saveButton:{id:"automationBuilderModal.editAutomationView.saveButton.label",defaultMessage:"Save"},cancelButton:{id:"automationBuilderModal.editAutomationView.cancelButton.label",defaultMessage:"Cancel"},doneButton:{id:"automationBuilderModal.editAutomationView.doneButton.label",defaultMessage:"Done"},enableButton:{id:"automationBuilderModal.editAutomationView.enableButton.label",defaultMessage:"Enable"},errorsFooterCaption:{id:"automationBuilderModal.editAutomationView.errorCaption",defaultMessage:"Fix errors to enable"}});function at(){}function rt(e){const{collectionSettingsStore:t,collectionContextStore:o,source:T,...I}=e,j=(0,ye().X)("automation_updated_error_states"),[w]=(0,n.useState)((()=>I)),{mode:P}=w,_=(0,u().tz)(),B=(0,i().v3)(),{isMobile:R}=(0,i().Y0)(),{value:E}=(0,q().fJ)(U().T.formulas),{value:D}=(0,q().fJ)(v().QV.automationTypecheck),[O,V]=(0,n.useState)([]),N="create"===P,z=(0,he().l)("BuilderModal",{cacheFallback:B.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),K=(0,a().K8)((()=>ve().default.state.currentUserStore),[]),G=(0,a().K8)((()=>null==K?void 0:K.userId),[K]),Y=(0,a().K8)((()=>null==K?void 0:K.getDisplayName(_)),[K,_]),$=(0,a().K8)((()=>o.collectionStore()),[o]),Q=(0,a().K8)((()=>null==$?void 0:$.getSpaceId()),[$]),ee=(0,a().K8)((()=>null==$?void 0:$.id),[$]),te=(0,n.useMemo)((()=>"update"===w.mode?w.automationId:(0,fe().Z1)({environment:B,table:d().yB,spaceId:Q})),[w,B,Q]),oe=(0,a().O$)(o.aliveAutomationCountStore),ne=(0,a().K8)((()=>{if(Q&&$&&G)return new(X().dn)(B,{id:te,table:d().yB,spaceId:Q})}),[te,$,G,B,Q]);!function(e){(0,n.useEffect)((()=>(nt=e,()=>{nt=void 0})),[e])}(ne);const ie=(0,a().K8)((()=>(0,l().PK)(_,Y)),[Y,_]),ae=(0,a().K8)((()=>{if(!Q||!$||!G)return;const e={id:te,table:d().yB,spaceId:Q},t=z.getEntry({pointer:e,userId:G});return t?t.value.value:me().EZ({automationId:te,automationName:"",collectionStore:$,userId:G})}),[te,$,G,Q,z]),{maybePersistedAutomationStore:re,maybePersistedTransactionActions:se,hasUnpersistedChanges:le}=(0,ke().t)({automationId:te,spaceId:Q,defaultValue:N?ae:void 0,persist:!1}),ce=(0,a().K8)((()=>{if(re&&(0,ge().$X)(re))return re}),[re]),ue=(0,a().K8)((()=>((null==ce?void 0:ce.getActionStores())??[]).filter((e=>e.isDefined()))),[ce]),Ae=(0,a().K8)((()=>(0,ge().H8)((null==ce?void 0:ce.getTriggerType())??"event")),[ce]),Te=(0,a().K8)((()=>{const e=null==$?void 0:$.getParentBlockStore();return!!e&&e.pathIsDead()}),[$]),Ie=function(e){const{actionStores:t,automationStore:o,collectionStore:n,loadingStatus:i,mode:r}=e;return(0,a().K8)((()=>"create"===r?"edit":"resolved"===i&&o&&t&&n?(0,me().TT)({automationStore:o,actionStores:t,collectionStore:n})?"edit":(0,me().Gz)({automationStore:o,collectionStore:n})?"readonly_with_delete":"readonly":"readonly"),[r,i,o,t,n])}({automationStore:ce,actionStores:ue,collectionStore:$,loadingStatus:"resolved",mode:w.mode}),je=("readonly_with_delete"===Ie||"edit"===Ie&&!N)&&!Te,we=(0,W().n)(ce),Pe=(0,a().K8)((()=>!(!ce||!$)&&me().l({automationStore:ce,collectionStore:$})),[ce,$]),Re=(0,a().K8)((()=>ce&&E&&D?(0,Ce().Z)({environment:B,automationStore:ce,automationTypecheckModule:D,contextType:Ae,formulasModule:E,intl:_,isSubscribed:we}):void 0),[ce,E,D,B,Ae,_,we]),Ee=(0,a().K8)((()=>!!($&&ce&&Re)&&me().Qn({automationStore:ce,collectionStore:$,typecheckResult:Re})),[ce,$,Re]),De=(0,a().K8)((()=>!!Re&&(0,Se().h)({environment:B,typecheckResult:Re,automationStore:ce})),[ce,B,Re]),Oe=(0,a().K8)((()=>ne&&E&&D?(0,Ce().Z)({environment:B,automationStore:ne,automationTypecheckModule:D,contextType:Ae,formulasModule:E,intl:_,isSubscribed:we}):void 0),[B,ne,Ae,E,D,_,we]),Fe=(0,a().K8)((()=>!!($&&ne&&Oe)&&me().Qn({automationStore:ne,collectionStore:$,typecheckResult:Oe})),[$,ne,Oe]),Ve=(0,a().K8)((()=>{if(!ce)return!0;let e;var t;ce.isTriggerType("event")&&(e=null===(t=ce.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited.type);const o=(0,g().O9)(e)&&"none"!==e,n=ce.getActionStores().length>0;if(!n&&!o)return!1;const i=!(0,s().aE)({automationTrigger:ce.getTrigger(),collectionSchema:null==$?void 0:$.getSchema()});if(o&&i)return!0;if(n&&(0,g().O9)(Re)&&m().Q.isSuccess(Re)){if(Object.keys(Re.value.actionValidationFailures).some((e=>!O.includes(e))))return!0}return!1}),[ce,$,O,Re]);!function(e){const{automationStore:t,collectionStoreId:o,source:r}=e,s=(0,i().v3)(),[l,c]=(0,n.useState)(!1),d=(0,a().K8)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),u=(0,a().K8)((()=>{if(!t||!t.isTriggerType("event"))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();if("any"===(null==n?void 0:n.type))o++;else if("some"===(null==n?void 0:n.type)){var i;o+=(null===(i=n.some)||void 0===i?void 0:i.length)??0}else if("all"===(null==n?void 0:n.type)){var a;o+=(null===(a=n.all)||void 0===a?void 0:a.length)??0}return o}),[t]);(0,n.useEffect)((()=>{o&&!l&&t&&((0,H().u4)({environment:s,event:{eventName:"automation_configure_view",eventProperties:{automation_id:t.id,automation_total_actions:d,automation_total_triggers:u,collection_id:o,source:r}}}),de().default.logEvent("automation_configure_view","true"),c(!0))}),[s,o,l,d,u,null==t?void 0:t.id,t,r])}({automationStore:ce,collectionStoreId:ee,source:e.source});const Ne="edit"===Ie&&!Te&&!De,Le=(0,n.useCallback)((()=>{j&&V([])}),[j]),We=(0,n.useCallback)((()=>{$&&ce&&le&&("create"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:a,from:r}=e;k().nO({automationStore:t,collectionStore:n,environment:i,intl:a,from:r,builderType:"modal"}),h().D6({label:(0,J.jsx)(u().sA,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),F().V({environment:i,collectionSettingsStore:o});const s=(0,be().S)(o);s&&"automationSettings"!==s.type&&y().a2({collectionSettingsStore:o,item:{type:"automationSettings",source:"first_automation_created"}})}({automationStore:ce,collectionSettingsStore:t,collectionStore:$,environment:B,intl:_,from:w.from}):"update"===P?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,source:a}=e;k().kU({automationStore:t,collectionStore:n,environment:i,builderType:"modal",source:a}),h().D6({label:(0,J.jsx)(u().sA,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),F().V({environment:i,collectionSettingsStore:o})}({automationStore:ce,collectionSettingsStore:t,collectionStore:$,environment:B,source:T}):(0,g().HB)(P))}),[ce,t,$,B,le,_,P,w,T]),ze=(0,n.useCallback)((async()=>{ce&&$&&!N&&await k().lg({intl:_,environment:B,existingAutomationStore:ce,collectionStore:$,onDelete:()=>{var e;F().V({environment:B,collectionSettingsStore:t}),1===oe&&"automationSettings"===(null===(e=(0,be().S)(t))||void 0===e?void 0:e.type)&&y().R8({collectionSettingsStore:t,item:{type:"main"}})}})}),[oe,ce,t,$,B,_,N]),Ke=(0,n.useCallback)((async()=>{if(le){await k().lT({hasPendingChanges:le})&&F().V({environment:B,collectionSettingsStore:t})}else F().V({environment:B,collectionSettingsStore:t})}),[t,B,le]);pe({shouldInvokeHandler:!0,onClick:Ke,isMobile:R});const Ue=(0,n.useCallback)((e=>{V([e.id])}),[]),He=(0,Me().c)(),Ge=function(){const{isMobile:e}=(0,i().Y0)(),t=dt();return(0,r().IS)((o=>({header:{backgroundColor:o.surface.elevated,zIndex:100,width:"100%",...e?{paddingBottom:0,paddingTop:0}:{paddingBottom:8,borderBottom:`1px solid ${o.stroke.secondary}`}},nameInput:{...e&&{paddingTop:8}},buttons:{backgroundColor:o.surface.elevated,display:"flex",flexDirection:"row",paddingBottom:e?16:4,paddingTop:12,justifyContent:"space-between",gap:e?"10px":0,width:"100%",zIndex:100,...e&&{paddingLeft:st,paddingRight:st,flexDirection:"column-reverse"}},footerButton:{height:32,width:e?"100%":"auto"},footerErrorCaption:{color:o.text.tertiary,fontSize:f().J.UISmall.desktop},footerRight:{alignItems:"center",display:"flex",gap:14,justifyContent:"space-between"},automationOptionIconDesktop:{marginInlineStart:12},wrap:{marginTop:e?16:17,marginBottom:e?20:0,paddingBottom:16,width:"100%",flexGrow:1,overflowY:"auto"},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:101},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:o.tint.regular,width:24,height:24},closeButtonHover:{background:o.buttonPressedBackground},closeButtonIcon:{width:14,fill:o.icon.secondary},...t})),[e,t])}(),Ye=[],qe=le&&Ee;Ne&&!R&&Ye.push((0,J.jsxs)(M().A,{style:Ge.buttons,mobileStyle:Ge.buttons,children:[(0,J.jsx)(A().A,{size:"lg",onClick:Ke,style:Ge.footerButton,children:(0,J.jsx)(u().sA,{...it.cancelButton})}),(0,J.jsxs)("div",{style:Ge.footerRight,children:[j&&!qe&&Ve&&(0,J.jsx)("div",{style:Ge.footerErrorCaption,children:(0,J.jsx)(u().sA,{...it.errorsFooterCaption})}),(0,J.jsx)(C().A,{onClick:We,onMouseEnter:Le,disabled:!qe,style:Ge.footerButton,children:N?(0,J.jsx)(u().sA,{...j?it.enableButton:it.createButton}):(0,J.jsx)(u().sA,{...j?it.doneButton:it.saveButton})})]})]},"save"));const Xe=(0,a().K8)((()=>$&&ce?(0,J.jsx)(L().or,{automationStore:ce,children:(0,J.jsxs)(xe().v,{value:{collectionStore:$,disabled:!Ne,editorPlacement:{type:"inline"},editorWidth:b().vE,maybePersistedTransactionActions:se,onActionAdded:Ue,suppressActionErrors:O,hideDragHandle:De,cantSaveDueToError:Ve,...He},defaultCollapseActions:De,children:[!R&&(0,J.jsx)("div",{style:Ge.closeButtonContainer,children:(0,J.jsx)(x().A,{onClick:Ke,style:Ge.closeButton,hoveredStyle:Ge.closeButtonHover,children:(0,c().V)(Ge.closeButtonIcon)})}),(0,J.jsx)("div",{style:Ge.header,children:(0,J.jsx)(S().Ay,{type:S().Oh.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:(0,p().oE)([{key:"automation_name",action:()=>{},render:e=>(0,J.jsx)("div",{...e,style:Ge.nameInput,children:(0,J.jsx)(_e,{...e,disabled:!Ne,autoSelectAllOnDesktop:Ne&&"create"===P,placeholder:ie})})},lt({showActiveAutomationToggle:je,isPersistedStateComplete:Fe,collectionContextStore:o,canEdit:Ne,automationStore:ce})]),render:e=>(0,J.jsx)(M().A,{...e,disableMobilePadding:!0,desktopStyle:{paddingTop:0,paddingBottom:0}})}]})}),(0,J.jsxs)("div",{style:Ge.wrap,children:[(0,J.jsx)(Z,{collectionStore:$,collectionSettingsStore:t,automationPermissionScope:Ie,referencesIncompatibleCollectionViewFilter:Pe,requiresSubscriptionUpgrade:De,onDelete:ze}),(0,J.jsx)(v().U3,{areActionsEditable:Ne,areTriggersEditable:Ne})]})]})}):null),[$,ce,Ne,se,Ue,O,De,He,R,Ge,Ke,je,Fe,o,Ve,t,Ie,Pe,ze,P,ie]);return(0,J.jsxs)(Be().i,{handleOnDismiss:Ke,handleOnSave:We,canSave:qe,mode:P,children:[Xe,Ye]})}const st=16;function lt(e){const{showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i}=e;return{key:"automation_toggle_and_source",action:at,render:e=>(0,J.jsx)(ct,{menuListItemProps:e,showActiveAutomationToggle:t,isPersistedStateComplete:o,collectionContextStore:n,canEdit:i})}}function ct(e){const{menuListItemProps:t,showActiveAutomationToggle:o,isPersistedStateComplete:s,collectionContextStore:l,canEdit:c}=e,d=(0,u().tz)(),{isMobile:p}=(0,i().Y0)(),m=(0,i().v3)(),g=(0,ye().X)("automation_updated_error_states"),f=dt(),y=(0,r().IS)((e=>({wrap:{display:"flex",...p?{flexDirection:"column",justifyContent:"center",alignItems:"flex-start",paddingInline:12,borderBottom:`1px solid ${e.stroke.primary}`,paddingBlock:12,gap:12}:{gap:8,minHeight:24,alignItems:"center"}},toggle:{display:"flex",alignItems:"center",marginLeft:1},...f})),[p,f]),{automationStore:h}=(0,L().EC)(),v=(0,a().K8)((()=>{var e;return(null==h||null===(e=h.getOwnerStore())||void 0===e?void 0:e.getDisplayName(d))??""}),[d,h]),b="active"===(0,a().K8)((()=>(null==h?void 0:h.getStatus())??"disabled"),[h]),x=Te(),S=(0,n.useCallback)((()=>{h&&k().WA({automationStore:h,environment:m})}),[m,h]),A=(0,n.useCallback)((()=>{h&&k().HJ({automationStore:h,environment:m})}),[m,h]),C=(0,a().K8)((()=>!s||(0,Ae().NH)(h)),[h,s]);return(0,J.jsxs)("div",{...t,style:y.wrap,children:[(s||g&&!b)&&o&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("div",{style:y.toggle,children:(0,J.jsx)(ce,{automationId:h.id,automationOwner:v,isAutomationPaused:!b,onPause:S,onResume:A,disabled:C})}),(0,J.jsx)("div",{style:y.verticalDivider})]}),x?(0,J.jsx)(tt,{disabled:!c,collectionContextStore:l}):(0,J.jsx)(ot,{})]})}function dt(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({verticalDivider:{background:t.stroke.secondary,height:16,width:1,borderRadius:1,display:e?"none":"block"}})),[e])}var ut=()=>o(246826),pt=()=>o(840094),mt=()=>o(845715);const gt=(0,u().YK)({placeholder:{id:"automations.builderModal.buttonBuilderLabelInput.placeholder",defaultMessage:"Enter a name"},loading:{id:"automations.builderModal.buttonBuilderLabelInput.loading",defaultMessage:"Loading..."}}),ft=(0,n.forwardRef)((function(e,t){let{disabled:o,buttonName:a,handleNameChange:s,handleBlur:l,handleSubmit:c,...d}=e;const p=(0,u().tz)(),{isMobile:m}=(0,i().Y0)(),g=(0,r().IS)((e=>({buttonNamePropertyInput:{marginBlockEnd:0,boxShadow:"none"},buttonNameText:{marginInlineStart:m?12:0,marginInlineEnd:m?12:18},inputOuterStyle:{background:"transparent",boxShadow:"unset"}})),[m]),f=(0,n.useCallback)((e=>{s(e)}),[s]),y=(0,n.useCallback)((e=>{l(e.target.value)}),[l]),h=(0,n.useCallback)((()=>{c(a)}),[c,a]);return(0,J.jsx)(we().Ay,{style:g.buttonNamePropertyInput,...d,value:a??p.formatMessage(gt.loading),onChange:f,disabled:o,ref:t,inputOuterStyle:g.inputOuterStyle,format:je().C.ExtraLarge,textWrapperStyle:g.buttonNameText,placeholder:p.formatMessage(gt.placeholder),onBlur:y,onSubmit:h,autoFocus:!a})}));var yt=()=>o(390518);const ht=(0,u().YK)({saveButton:{defaultMessage:"Save",id:"database.buttonProperty.saveButtonLabel"},noEditError:{defaultMessage:"You don't have full access to edit this button",id:"database.buttonProperty.noEditError"}});function vt(e){const{collectionContextStore:t,propertySchema:o}=e,i=(0,a().K8)((()=>t.collectionStore()),[t]),r=(0,a().K8)((()=>null==i?void 0:i.getSpaceId()),[i]),s=(0,n.useMemo)((()=>{const e=o.automation_id;if(e&&r)return{id:e,spaceId:r,table:d().yB}}),[o.automation_id,r]);return(0,mt().K)(i,s)?(0,J.jsx)(bt,{...e}):(0,J.jsx)(yt().A,{})}function bt(e){const{collectionContextStore:t,collectionSettingsStore:o,propertyId:s,propertySchema:l}=e,{isMobile:d}=(0,i().Y0)(),p=(0,i().v3)(),[m,g]=(0,n.useState)([]),f=(0,a().K8)((()=>t.collectionStore()),[t]),y=(0,a().K8)((()=>null==f?void 0:f.getSpaceId()),[f]),{maybePersistedAutomationStore:h,maybePersistedTransactionActions:A}=(0,ke().t)({automationId:l.automation_id,spaceId:y,defaultValue:void 0,persist:!0}),k=(0,a().K8)((()=>null==h?void 0:h.getTrigger()),[h]),T=(0,pt().Qj)({automationStore:h,propertyId:s,propertySchema:l,collectionContextStore:t}),I=(0,a().K8)((()=>{var e;return"sufficient"===(null==T||null===(e=T.state)||void 0===e?void 0:e.editPermissionStatus)}),[T]),j=(0,a().K8)((()=>{var e;return!(null==T||null===(e=T.state)||void 0===e||!e.typecheckResult)&&(0,Se().h)({environment:p,typecheckResult:T.state.typecheckResult,automationStore:h})}),[T,p,h]),w=(0,a().K8)((()=>(null==h?void 0:h.getNameStore().getValue())??l.name),[h,l.name]),P=(0,a().K8)((()=>"collectionTypedView"===t.contextType),[t]),_=(0,n.useCallback)((e=>{if(!h)return;const t=e.currentTarget.value;A.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:e=>{ut().KY({store:h.getNameStore(),transaction:e,value:t})}})}),[h,A]),B=(0,n.useCallback)((e=>{g((t=>[...t,e.id]))}),[]),R=(0,Me().c)(),E=function(){const{isMobile:e}=(0,i().Y0)();return(0,r().IS)((t=>({header:{backgroundColor:"transparent",borderBottom:`1px solid ${t.stroke.secondary}`,paddingBottom:8,paddingTop:kt,position:"absolute",top:0,width:`calc(100% - ${2*Mt}px)`,zIndex:100,...e&&{paddingBottom:0,paddingTop:0,width:"100%"}},buttons:{backgroundColor:"dark"===t.mode?t.accentColors.gray[100]:t.white,display:"flex",gap:4,paddingBlock:`${kt}px ${Mt}px`,position:"absolute",bottom:0,width:`calc(100% - ${2*Mt}px)`,zIndex:100,...e&&{paddingLeft:Mt,paddingRight:Mt,flexDirection:"column-reverse",width:"100%"}},label:{paddingTop:e?"10px":0},closeButtonContainer:{position:"absolute",top:10,right:10,zIndex:101},closeButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:t.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:t.buttonPressedBackground},closeButtonIcon:{width:16,fill:t.text.secondary},wrap:{overflowY:"auto",overflowX:"hidden",marginTop:e?At:xt,marginBottom:e?Ct:St,paddingInline:e?0:2,width:"100%"},desktopButtonLabelNameContainer:{paddingLeft:0,paddingRight:0,color:t.text.tertiary},mobileButtonLabelNameContainer:{paddingTop:kt,paddingBottom:4,paddingLeft:Mt,paddingRight:Mt,color:t.text.tertiary},buttonLabelNameTextWrapperStyle:{marginLeft:e?Mt:0,marginRight:e?Mt:0},footerButton:{height:32,width:"100%"},inputStyle:{background:"transparent"},inputOuterStyle:{background:"transparent"}})),[e])}(),D=(0,n.useCallback)((()=>{F().V({environment:p,collectionSettingsStore:o})}),[p,o]),O=(0,n.useCallback)((()=>{$().K(p,{from:"button_property_automation_header_message",upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"}})}),[p]);pe({shouldInvokeHandler:!0,onClick:D,isMobile:d});const W=(0,n.useCallback)((e=>{h&&A.createAndCommit({userAction:"ButtonBuilderModal.setName",perform:t=>{ut().KY({store:h.getNameStore(),transaction:t,value:e})}})}),[h,A]),z=(0,n.useMemo)((()=>f&&h&&k&&"button"===k.type?(0,J.jsx)(L().u,{automationStore:h,contextType:"button_property",children:(0,J.jsxs)(xe().v,{value:{collectionStore:f,disabled:!I,editorPlacement:{type:"inline"},editorWidth:b().vE,maybePersistedTransactionActions:A,onActionAdded:B,suppressActionErrors:m,hideDragHandle:j,...R},defaultCollapseActions:j,children:[!d&&(0,J.jsx)("div",{style:E.closeButtonContainer,children:(0,J.jsx)(x().A,{onClick:D,style:E.closeButton,hoveredStyle:E.closeButtonHover,children:(0,c().V)(E.closeButtonIcon)})}),(0,J.jsx)("div",{style:E.header,children:(0,J.jsx)(S().Ay,{type:S().Oh.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,J.jsx)(ft,{...e,disabled:P,buttonName:w,handleNameChange:_,handleBlur:W,handleSubmit:W})}],render:e=>(0,J.jsx)(M().A,{...e,disableMobilePadding:!0,shouldShowBottomDivider:!0,desktopStyle:{paddingTop:0}})}]})}),(0,J.jsxs)("div",{style:E.wrap,children:[j&&(0,J.jsx)(N().j,{onUpsellClick:O}),!I&&(0,J.jsx)(V().z,{children:(0,J.jsx)(u().sA,{...ht.noEditError})}),(0,J.jsx)(v().U3,{areActionsEditable:!j,areTriggersEditable:!1})]})]})}):null),[h,w,f,P,_,D,W,I,d,A,B,E,m,k,R,j,O]),K=d?(0,J.jsx)(n.Fragment,{}):(0,J.jsx)(M().A,{mobileStyle:E.buttons,style:E.buttons,children:(0,J.jsx)(C().A,{onClick:D,disabled:!I,style:E.footerButton,children:(0,J.jsx)(u().sA,{...ht.saveButton})})});return f&&h&&k&&"button"===k.type?(0,J.jsxs)(Be().i,{handleOnDismiss:D,canSave:!0,mode:"button_property",handleOnSave:D,children:[z,K]}):null}const xt=60,St=60,At=60,Ct=60,Mt=16,kt=12},89849:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>a,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_9098_13290)",children:[(0,n.jsx)("path",{d:"M10 13.504a3.5 3.5 0 1 0-.001-7.002A3.5 3.5 0 0 0 10 13.504m1.167-3.502a1.168 1.168 0 1 1-2.335.002 1.168 1.168 0 0 1 2.335-.002"}),(0,n.jsx)("path",{d:"M10 3.895c-4.093 0-7.662 2.189-9.351 5.408-.231.44-.231.964 0 1.404 1.689 3.22 5.258 5.408 9.351 5.408s7.662-2.189 9.351-5.408c.231-.44.231-.964 0-1.404-1.689-3.22-5.258-5.408-9.351-5.408m-8.245 5.99C3.218 7.096 6.347 5.144 10 5.144s6.782 1.952 8.245 4.74a.26.26 0 0 1 0 .24c-1.463 2.788-4.592 4.74-8.245 4.74s-6.782-1.952-8.245-4.74a.26.26 0 0 1 0-.24"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_9098_13290",children:(0,n.jsx)("path",{d:"M0 0h20v20H0z"})})})]})},a=(0,o(340498).wt)("eye",i)},90907:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,lockIcon:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 0 0 1.1 0z"}),(0,n.jsx)("path",{d:"M10 1.95a4 4 0 0 0-4 4v1.433a2.426 2.426 0 0 0-2.025 2.392v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.426 2.426 0 0 0 14 7.383V5.95a4 4 0 0 0-4-4m2.75 5.4h-5.5v-1.4a2.75 2.75 0 0 1 5.5 0zM5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},a=(0,o(340498).wt)("lock",i)},95441:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){const{title:t,href:i,analyticsFrom:a}=e,r=(0,o(484714).v3)();return(0,n.jsx)(o(187485).A,{href:i,onClick:()=>o(148024).FH(r,{from:a}),external:!0,children:(0,n.jsx)(o(497222).A,{icon:o(406533).questionMarkCircleIcon,title:t,isGray:!0})})}},101209:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("boltFilled",{svg:(0,n.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},105819:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineIcon:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},i=(0,o(340498).wt)("pencilLine",n)},112698:(e,t,o)=>{o.d(t,{B:()=>y});o(296540);var n=()=>o(484714),i=()=>o(847249),a=()=>o(401497),r=()=>o(959013),s=()=>o(100622),l=()=>o(534177),c=()=>o(284371),d=()=>o(824160),u=()=>o(859428),p=()=>o(962730),m=()=>o(351360),g=()=>o(991249),f=o(474848);function y(e){let{upsell:t,mobileStyle:o,desktopStyle:y,analyticsName:h,onClick:v,disableTooltip:b}=e;const x=(0,a().DP)(),S=(0,n().v3)(),{device:A}=S,C=(0,i().K8)((()=>{const{currentSpaceStore:e}=m().default.state;return null==e?void 0:e.canAdmin()}),[]),M=(0,i().K8)((()=>function(e,t){if("product"!==e.type)return{};switch(e.product){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?s().Ay.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:c().Wy.medium};default:return{}}}(t,x)),[t,x]);if("product"!==t.type)return null;if(A.isMobileNative)return null;const k=(()=>{switch(t.product){case"personal":return(0,f.jsx)(r().sA,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"});case"plus":return(0,f.jsx)(r().sA,{defaultMessage:"Plus ↗",id:"upgradeButton.plus.textWithArrow"});case"business":return(0,f.jsx)(r().sA,{defaultMessage:"Business ↗",id:"upgradeButton.business.textWithArrow"});case"enterprise":return(0,f.jsx)(r().sA,{defaultMessage:"Enterprise ↗",id:"upgradeButton.enterprise.textWithArrow"});case"ai":return(0,f.jsx)(r().sA,{defaultMessage:"AI ↗",id:"upgradeButton.ai.textWithArrow"});case"sites_custom_hostnames":return(0,f.jsx)(r().sA,{defaultMessage:"Custom Hostnames ↗",id:"upgradeButton.sites_custom_hostnames.textWithArrow"});default:(0,l().HB)(t.product)}})();return A.isMobile||!C?(0,f.jsx)(d().A,{mobileStyle:o,children:k}):(0,f.jsx)(u().A,{delayThreshold:120,disableTooltip:b,placement:p().W.Bottom,renderTooltip:()=>(0,f.jsx)("div",{style:{maxWidth:500},children:(0,f.jsx)(r().sA,{defaultMessage:"Upgrade to use this feature.",id:"premiumFeatureUpgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,f.jsx)(d().A,{desktopStyle:y,innerStyle:M,onClick:e=>function(e,t,o,n,i){g().K(n,{from:t,upsell:o}),i&&i(e)}(e,h,t,S,v),...e,children:k})})}},113474:(e,t,o)=>{o.d(t,{_:()=>d});o(296540);var n=()=>o(484714),i=()=>o(401497),a=()=>o(668725),r=()=>o(704152),s=()=>o(678553),l=()=>o(125565),c=o(474848);function d(e){const t=(0,i().DP)(),o=(0,n().v3)(),{device:d}=o;return(0,c.jsx)(r().A,{mobileFeedback:d.isMobile,onClick:e.onClick,hovered:e.focused,disabled:e.disabled,style:{width:"100%",...!d.isMobile&&{borderRadius:6},...e.buttonStyle},hoveredStyle:e.hoveredButtonStyle,pressedStyle:e.pressedButtonStyle,children:(0,c.jsx)(s().Ay,{...e,dontShrinkTitle:!0,right:(0,c.jsxs)("div",{style:{display:"flex",whiteSpace:"nowrap"},children:[e.right&&(0,c.jsx)(l().A,{isSecondaryColor:!0,isMobile:d.isMobile,children:e.right}),!d.isMobile&&(0,c.jsx)("div",{style:{flexShrink:0},children:(0,a().b)({width:10,marginLeft:4,fill:t.lightIconColor,transform:"right"===e.chevronType?"rotate(-90deg)":void 0,transition:"transform 0.2s ease"})})]})})})}},118849:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var n=()=>o(847249),i=()=>o(979340),a=()=>o(959013),r=()=>o(100622),s=()=>o(284371),l=()=>o(824160),c=()=>o(991249),d=o(474848);const u=function(e){let{subscriptionTier:t,mobileStyle:u,desktopStyle:p,analyticsName:m,onClick:g,disableTooltip:f,tooltipContent:y}=e;const h=(0,o(401497).DP)(),v=(0,o(484714).v3)(),{device:b}=v,x=(0,n().K8)((()=>{const{currentSpaceStore:e}=o(351360).default.state;return null==e?void 0:e.canAdmin()}),[]),S=(0,n().K8)((()=>function(e,t){switch(e){case"plus":case"business":case"enterprise":return{color:t.blueColor,background:"light"===t.mode?r().Ay.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:s().Wy.medium};default:return{}}}(t,h)),[t,h]);if(b.isMobileNative)return null;let A;return"personal"===t?A=(0,d.jsx)(a().sA,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"}):(0,i().$P)(t)?A=(0,d.jsx)(a().sA,{defaultMessage:"Plus ↗",id:"upgradeButton.plus.textWithArrow"}):(0,i().tL)(t)?A=(0,d.jsx)(a().sA,{defaultMessage:"Business ↗",id:"upgradeButton.business.textWithArrow"}):(0,i().OX)(t)?A=(0,d.jsx)(a().sA,{defaultMessage:"Enterprise ↗",id:"upgradeButton.enterprise.textWithArrow"}):(0,o(534177).HB)(t),b.isMobile||!x?(0,d.jsx)(l().A,{mobileStyle:u,children:A}):(0,d.jsx)(o(859428).A,{delayThreshold:120,disableTooltip:f,placement:o(962730).W.Bottom,renderTooltip:()=>(0,d.jsx)("div",{style:{maxWidth:500},children:y?(0,d.jsx)(a().sA,{defaultMessage:"{tooltipText}",id:"upgradeButton.upgrade.custom.tooltip",values:{tooltipText:y}}):(0,d.jsx)(a().sA,{defaultMessage:"Upgrade to use this feature.",id:"upgradeButton.upgrade.tooltip"})}),originGap:6,render:e=>(0,d.jsx)(l().A,{desktopStyle:p,innerStyle:S,onClick:e=>function(e,t,o,n,i){c().K(n,{from:t,upsell:{type:"product",product:o,limit:{type:"none"},trialability:"none"}}),i&&i(e)}(e,m,t,v,g),...e,children:A})})}},126617:(e,t,o)=>{o.d(t,{Y:()=>i});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M3.2 6.725a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55"})},i=(0,o(340498).wt)("ellipsisSmall",n)},132389:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);function i(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},135221:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){let{style:t,styleParentContainer:i,isTriColored:a}=e;const r=(0,o(959013).tz)();return(0,n.jsxs)("div",{"aria-valuetext":r.formatMessage({id:"loadingDots.label",defaultMessage:"Loading..."}),role:"progressbar",className:"loading-dots",style:{...i},children:[(0,n.jsx)("div",{className:"loading-dot",style:{...t,...a&&{backgroundColor:"#F6C050"}}}),(0,n.jsx)("div",{className:"loading-dot",style:{...t,...a&&{backgroundColor:"#ED6A5F"}}}),(0,n.jsx)("div",{className:"loading-dot",style:{...t,...a&&{backgroundColor:"#5F9CDB"}}})]})}},150987:(e,t,o)=>{o.d(t,{A:()=>g});o(898992),o(354520),o(581454),o(737550);var n=o.n(o(844751)),i=o(296540),a=()=>o(970013),r=()=>o(713998),s=()=>o(959013),l=()=>o(496603),c=()=>o(722872),d=()=>o(939740),u=()=>o(89924),p=()=>o(250202),m=o(474848);const g=function(e){let{selectedProperty:t,onAccept:g,schema:f,onClose:y,allowProperty:h,isRelationProperty:v}=e;const b=(0,o(484714).v3)(),x=(0,s().tz)(),[S,A]=(0,i.useState)("");let C=Object.keys(f);const M=C.some(o(443239).u);C=l().Ul(C,(e=>{const t=(0,r()._g)({schema:f,property:e});return t?t.name:""}));const k=M?a().Ho:a().rn;if(C=l().FF(C,k),C.unshift(k),h&&(C=C.filter((e=>{const t=(0,r()._g)({schema:f,property:e});return t&&h(t)}))),S){let e=C.map((e=>{const t=(0,r()._g)({schema:f,property:e});return t&&t.name}));e=n().filter(S,e).map((e=>{let{original:t}=e;return t})),C=C.filter((t=>{const o=(0,r()._g)({schema:f,property:t});return o&&o.name&&e.includes(o.name)}))}const T=S||C.length>o(525432).R8,I=l().oE(C.map((e=>{const o=(0,r()._g)({schema:f,property:e});if(!o)return null;return{key:e,render:n=>(0,m.jsx)(p().G,{...n,propertySchema:o,format:p().e.Name,isChecked:e===t}),action:()=>g(e)}}))),j=[{key:0,render:e=>(0,m.jsx)(u().A,{...e}),items:I}],{device:w}=b,P=T?(0,m.jsx)(u().A,{isInput:!0,children:(0,m.jsx)(o(419357).Ay,{focus:!w.isMobile||void 0,focusAfterAnimation:!0,value:S,onChange:e=>A(e.target.value),placeholder:v?x.formatMessage({defaultMessage:"Search for a relation property…",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):x.formatMessage({defaultMessage:"Search for a property…",id:"propertySelectMenu.searchForProperty.default.placeholder"})})}):null;let _;return _=w.isMobile?{menuType:c().gu.Modal,title:v?x.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):x.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:(0,m.jsx)(o(480095).CancelMenuText,{}),onClickRight:y,header:P}:{menuType:c().gu.Popup,width:280,maxHeight:480,header:P},(0,m.jsx)(o(928600).A,{..._,children:0===I.length?(0,m.jsx)(u().A,{children:(0,m.jsx)(o(64e3).A,{title:(0,m.jsx)(s().sA,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})}):(0,m.jsx)(d().Ay,{type:d().Oh.Vertical,sections:j,onAccept:y,initialFocus:S.length>0?0:void 0})})}},173019:(e,t,o)=>{o.d(t,{r:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("pencil",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M3.926 13.307H14.11c.183 0 .34-.066.472-.199a.644.644 0 00.198-.471.652.652 0 00-.198-.479.644.644 0 00-.472-.198H5.272l-1.346 1.347zm-.704-.636l7.683-7.684-1.312-1.319-7.69 7.684-.67 1.606c-.037.1-.017.191.06.273.083.082.174.105.274.069l1.655-.63zm8.34-8.326l.738-.732c.182-.187.278-.376.287-.567.009-.192-.068-.374-.232-.547l-.267-.267c-.169-.168-.351-.246-.547-.232-.196.014-.385.11-.567.287l-.739.732 1.327 1.326z"})})},175116:(e,t,o)=>{o.d(t,{ET:()=>l,Ks:()=>c,RI:()=>s,p2:()=>r});o(16280);var n=o(296540);const i="collectionContextStore",a=(0,o(446943).C)({displayName:i,legacyContextKey:i,modernContextDefaultValue:void 0}),r=a.context,s=a.Provider;function l(){const e=n.useContext(r);if(void 0===e)throw new Error(`No context provided: ${i}`);return e}function c(){return n.useContext(r)}},200582:(e,t,o)=>{o.d(t,{m:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M11.633 1.812c.263.096.43.354.41.632l-.392 5.51h3.099a.625.625 0 0 1 .506.992l-6.18 8.54a.625.625 0 0 1-1.13-.412l.402-5.5H5.25a.625.625 0 0 1-.507-.99l6.17-8.55a.625.625 0 0 1 .72-.222m-5.161 8.513H9.02a.625.625 0 0 1 .623.67l-.29 3.976 4.173-5.766H10.98a.625.625 0 0 1-.623-.67l.284-3.987z"})},i=(0,o(340498).wt)("lightning",n)},241319:(e,t,o)=>{o.d(t,{y:()=>a});o(898992),o(672577);var n=()=>o(534177),i=()=>o(977345);function a(e){var t;const{actionModels:o,id:a}=e,r=(0,i().y5)(a),s="action"===r.source?o.find((e=>e.id===r.action_id)):void 0,l=(0,n().O9)(s)&&s.isType("create_page")?null===(t=s.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:r,collectionPointer:l,actionModel:s}}},250202:(e,t,o)=>{o.d(t,{G:()=>s,e:()=>r});var n=o(296540),i=()=>o(401497),a=o(474848);let r=function(e){return e[e.Name=0]="Name",e[e.Type=1]="Type",e}({});const s=n.forwardRef((function(e,t){const{propertySchema:n,format:s,locked:l}=e,{name:c,type:d,icon:u}=n,p=(0,o(963589).X)("nds_default_property_noticon"),{isMobile:m}=(0,o(484714).Y0)(),g=(0,i().IS)((e=>({propertyIcon:{fill:e.regularIconColor,marginLeft:6,marginRight:2}})),[]),f=(0,i().DP)(),y=s===r.Name?c:o(682146).dC[d];return(0,a.jsx)(o(760217).A,{title:y,icon:(0,a.jsx)(o(743176).zB,{icon:u,type:d,size:m?18:16,theme:f,style:g.propertyIcon,isDefaultNoticonEnabled:p}),disabled:l,...e})}))},256863:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(847249),i=()=>o(824862),a=o(474848);const r=function(e){const{botValue:t,botStore:r,showActiveDot:s,style:l,size:c}=e,d=(0,o(959013).tz)(),u=(0,n().K8)((()=>{if(r){const e=r.getIcon();if(e)return{pointer:{table:i().GP,id:r.id,spaceId:r.getSpaceId()},icon:e}}else if(null!=t&&t.icon)return{pointer:{table:i().GP,id:t.id,spaceId:t.space_id},icon:t.icon}}),[r,t]),p=(0,n().K8)((()=>(null==r?void 0:r.getDisplayName(d))??(0,o(799288).Hg)(t)),[r,t,d]),{activeDotStyle:m}=(0,o(401497).IS)((e=>({activeDotStyle:{height:10,width:10,backgroundColor:e.accentColors.green[400],border:"2px solid white",borderRadius:"50%",position:"absolute",left:11,top:11}})),[]);return(0,a.jsxs)("div",{style:l,children:[(0,a.jsx)(o(614505).B,{icon:u,title:p,size:c||18,disabled:!0,isEmptyPage:!1,useInvertedColors:!0}),s?(0,a.jsx)("div",{style:m}):void 0]})}},274570:(e,t,o)=>{o.r(t),o.d(t,{clockIcon:()=>a,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.625 5.725a.625.625 0 1 0-1.25 0v3.65H6.4a.625.625 0 1 0 0 1.25H10c.345 0 .625-.28.625-.625z"}),(0,n.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},a=(0,o(340498).wt)("clock",i)},276936:(e,t,o)=>{o.d(t,{h:()=>r});o(898992),o(737550);var n=()=>o(973647),i=()=>o(534177),a=()=>o(527871);function r(e){const{environment:t,typecheckResult:o,automationStore:r}=e,s=null==r?void 0:r.getTriggerType();if((0,i().O9)(s)){if(!(0,a().V)({triggerType:s,environment:t,automationStore:r}))return!0}return!n().Q.isFail(o)&&Object.values(o.value.actionValidationFailures).some((e=>null==e?void 0:e.some((e=>"requires_subscription_upgrade"===e.type))))}},288739:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"m4.148 2.661-.23-.269a.55.55 0 1 0-.836.716L4.1 4.294C2.727 5.017 1.61 6.113.914 7.44a1.21 1.21 0 0 0 0 1.128c1.282 2.443 3.987 4.1 7.086 4.1a8.4 8.4 0 0 0 2.854-.493l1.228 1.433a.55.55 0 0 0 .84-.71L4.152 2.666zm1.227 5.34c0-.598.2-1.15.537-1.591l.963 1.123q-.092.218-.094.469a1.22 1.22 0 0 0 1.511 1.184l.963 1.123a2.626 2.626 0 0 1-3.88-2.307m7.475 3.122a7.4 7.4 0 0 0 2.236-2.556 1.21 1.21 0 0 0 0-1.128C13.804 4.997 11.099 3.34 8 3.34a8.5 8.5 0 0 0-1.68.166l1.605 1.87H8a2.626 2.626 0 0 1 2.582 3.101z"})},i=(0,o(340498).wt)("eyeSlashFillSmall",n)},300985:(e,t,o)=>{o.d(t,{Z:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M7.154 3.625h1.23a.625.625 0 1 0 0-1.25h-1.23A2.625 2.625 0 0 0 4.529 5v2.069c0 .9-.508 1.722-1.313 2.124l-.317.159a.725.725 0 0 0 0 1.297l.317.158a2.38 2.38 0 0 1 1.313 2.124V15a2.625 2.625 0 0 0 2.625 2.625h1.23a.625.625 0 1 0 0-1.25h-1.23c-.76 0-1.375-.616-1.375-1.375v-2.069c0-1.17-.564-2.256-1.492-2.931a3.63 3.63 0 0 0 1.492-2.931V5c0-.76.615-1.375 1.375-1.375m5.692 12.75h-1.23a.625.625 0 1 0 0 1.25h1.23A2.625 2.625 0 0 0 15.471 15v-2.069c0-.9.508-1.722 1.313-2.124l.317-.159a.725.725 0 0 0 0-1.296l-.317-.159a2.38 2.38 0 0 1-1.313-2.124V5a2.625 2.625 0 0 0-2.625-2.625h-1.23a.625.625 0 1 0 0 1.25h1.23c.76 0 1.375.616 1.375 1.375v2.069c0 1.17.564 2.256 1.492 2.931a3.63 3.63 0 0 0-1.492 2.931V15c0 .76-.615 1.375-1.375 1.375"})},i=(0,o(340498).wt)("curlyBraces",n)},301782:(e,t,o)=>{o.d(t,{CM:()=>p,UB:()=>u,zc:()=>d});o(898992),o(354520),o(581454);var n=()=>o(890409),i=()=>o(973647),a=()=>o(534177),r=()=>o(862292),s=()=>o(989423),l=()=>o(909470),c=()=>o(546461);function d(e){const{automationActionStore:t,automationStore:o,formulaAnalyticsModule:r,formulasModule:s,simpleFormulasModule:d}=e,u=t.getModel(),p=o??t.getParentStore();if(!u||!p)return;const m=p.getActionStores().map((e=>e.getModel())).filter(a().O9),g=(0,c().To)(p);let f=[];return g&&i().Q.isSuccess(g)&&(f=g.value.valueTypes),(0,n()._f)({automationActionModel:u,automationActionModels:m,formulaAnalyticsModule:r,formulasModule:s,simpleFormulasModule:d,formulaTypecheckContextValues:f,getRecordModel:t.getRecordModel,featureGates:(0,l().i)()})}function u(e,t){const{automationStore:o,automationActionStore:n}=t;o.isTriggerType("event")||p(((t,i,a)=>{const r=d({automationActionStore:n,automationStore:o,formulaAnalyticsModule:i,formulasModule:t,simpleFormulasModule:a});r&&(0,s().pM)(e,"automation_action_update",n.id,1,{automation_action:r,automation_action_id:n.id,automation_id:o.id})}))}function p(e){return Promise.all([r().T.formulas.load(),r().T.formulaAnalytics.load(),r().T.simpleFormulas.load()]).then((t=>{let[o,n,i]=t;e(o,n,i)})).catch((e=>{console.error("Error sending analytics for automations",e)}))}},315564:(e,t,o)=>{o.d(t,{S:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("locked",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M4.79395 14.7227H11.1992C12.252 14.7227 12.7783 14.1963 12.7783 13.0479V8.20801C12.7783 7.19629 12.3682 6.66992 11.541 6.56055V4.96094C11.541 2.36328 9.81152 1.1123 7.99316 1.1123C6.18164 1.1123 4.45215 2.36328 4.45215 4.96094V6.56055C3.625 6.66992 3.21484 7.19629 3.21484 8.20801V13.0479C3.21484 14.1963 3.73438 14.7227 4.79395 14.7227ZM5.75098 4.83105C5.75098 3.22461 6.76953 2.35645 7.99316 2.35645C9.2168 2.35645 10.2422 3.22461 10.2422 4.83105V6.54004H5.75098V4.83105ZM4.99219 13.5059C4.69141 13.5059 4.54102 13.3623 4.54102 13V8.25586C4.54102 7.89355 4.69141 7.76367 4.99219 7.76367H11.0078C11.3086 7.76367 11.4521 7.89355 11.4521 8.25586V13C11.4521 13.3623 11.3086 13.5059 11.0078 13.5059H4.99219Z"})})},324587:(e,t,o)=>{o.r(t),o.d(t,{addAutomationAction:()=>L,clearInvalidVariables:()=>G,createAutomation:()=>N,deleteAutomation:()=>Q,disableAutomation:()=>J,duplicateAutomation:()=>z,duplicateAutomationAction:()=>K,enableAutomation:()=>$,insertEmptyTextInDuplicateBlockAction:()=>X,messages:()=>V,removeAutomationAction:()=>H,reorderAutomationActions:()=>U,restartAutomation:()=>W});o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454);var n=o.n(o(794148)),i=()=>o(244641),a=()=>o(908006),r=()=>o(422540),s=()=>o(890409),l=()=>o(192845),c=()=>o(390527),d=()=>o(522328),u=()=>o(433519),p=()=>o(247331),m=()=>o(134025),g=()=>o(696706),f=()=>o(912720),y=()=>o(199378),h=()=>o(161479),v=()=>o(919709),b=()=>o(496603),x=()=>o(183558),S=()=>o(973647),A=()=>o(534177),C=()=>o(722101),M=()=>o(44729),k=()=>o(246826),T=()=>o(725614),I=()=>o(751156),j=()=>o(780054),w=()=>o(183324),P=()=>o(989423),_=()=>o(909470),B=()=>o(594794),R=()=>o(695625),E=()=>o(546461),D=()=>o(301782),O=()=>o(770586),F=()=>o(190019);const V=(0,o(959013).YK)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function N(e){const{actionIds:t,automationId:o,automationName:i,environment:a,inMemoryRecordCache:r,parentPointer:s,transaction:l,trigger:c}=e,d=o??(0,B().Z1)({environment:a,table:f().yB,spaceId:s.spaceId}),u=k().eC({environment:a,inMemoryRecordCache:r??a.defaultRecordCache.inMemoryRecordCache,table:f().yB,transaction:l,value:{action_ids:t,alive:!0,id:d,parent_id:s.id,parent_table:s.table,properties:{name:i},space_id:s.spaceId,status:"active",trigger:c}});return n()(u.isTriggerType(c.type),"Trigger type mismatch"),u}function L(e){const{actionId:t,environment:o,intl:i,automationStore:r,actionType:l,transaction:c,insertionPoint:d,config:u,createDuplicateBlocksContainer:p=!0,builderType:m="sidebar"}=e,h=r.getSpaceId();if(!h)return;let b;if("duplicate_blocks"===l&&p){b=k().Wv({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,transaction:c,type:"text"});const e=X({environment:o,contentStore:b.getContentStore(),transaction:c});a().default.afterNextFlush((()=>{const t=R().T.find((t=>g().L3.isEqual(t.props.store.pointer,e.pointer)));t&&T().setSelectionAtStart({store:t.props.store.getBlockTitleStore()})}))}const S=u??function(e){const{actionType:t,automationStore:o,intl:n}=e;if("modal_confirmation"===t)return{continue_button:{text:n.formatMessage(V.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(V.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,v().x9d)(n.formatMessage(V.defaultConfirmationWorkflowText))}};if("define_variables"===t){const e=(0,x().Ay)();return{values:{[e]:{name:(0,O().v)(o.getActionStores(),n.formatMessage(y().xC)),value:{type:"simple",value:[[""]]}}},variableIds:[e]}}}({actionType:l,automationStore:r,intl:i})??{},M=k().eC({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,table:y().SC,transaction:c,value:{id:t,type:l,parent_id:r.id,parent_table:f().yB,alive:!0,space_id:h,config:S,blocks:b?[b.id]:[]}});return b&&C().BC({transaction:c,parentStore:M.getKeyStore("blocks"),appendStore:b}),!d||"afterActionId"in d?C().BC({transaction:c,parentStore:r.getActionIdsStore(),appendStore:M,after:null==d?void 0:d.afterActionId}):"beforeActionId"in d?C().Hs({transaction:c,parentStore:r.getActionIdsStore(),prependStore:M,before:d.beforeActionId}):(0,A().HB)(d),Y({transaction:c,automationStore:r}),(0,D().CM)(((e,t,n)=>{const i=(0,P().ik)(o),a=(0,D().zc)({automationActionStore:M,formulaAnalyticsModule:t,formulasModule:e,simpleFormulasModule:n});(0,A().O9)(a)&&(0,s().dW)(i,{automation_action:a,automation_action_id:M.id,automation_id:M.getParentId(),builder_type:m}),M.isDefined()&&(0,s().c_)(i,{automation_action_id:M.id,automation_action_type:M.getType(),automation_id:r.id,builder_type:m})})),n()(M.isType(l),"Action type mismatch"),M}function W(e){var t,o;const{automationStore:n,transaction:a}=e,r=n.getRecurrence();if(!r)return;const s=i().c9.now().plus({day:1}).startOf("day"),l={...r,start_date:s.toMillis(),end_condition:"date"===(null===(t=r.end_condition)||void 0===t?void 0:t.type)?{type:"date",end_at:(0,c().getNewEndTimestamp)(s,r.start_date,null===(o=r.end_condition)||void 0===o?void 0:o.end_at).toMillis()}:r.end_condition};k().zv({store:n,transaction:a,data:{status:"active"}}),k().zv({store:n.getKeyStore("trigger"),transaction:a,data:{recurrence:(0,c().convertFromUnpersistedRecurrenceConfig)(l)}})}function z(e){const{actorPointer:t,environment:o,includeParenting:n,sourceAutomationStore:i,targetAutomationId:a,transaction:r}=e,s=i.getParentStore();if(!s||!s.isReady())throw new Error("Automation parent store not ready");const l=i.getValue(),c=i.getSpaceId();if(!(0,A().O9)(l)||!(0,A().O9)(c))throw new Error("Undefined automation value or space id");const d={},p={...(0,b().mg)(l),id:a??(0,B().Z1)({environment:o,table:f().yB,spaceId:(0,h().e)(c)})};d[i.id]=p.id,(0,A().O9)(p.action_ids)&&(0,A().EI)(p.action_ids)&&p.action_ids.forEach((e=>d[e]=(0,B().Z1)({environment:o,table:y().SC,spaceId:(0,h().e)(c)})));const m=e=>{let{requested:t}=e;const o=d[t.id];return(0,A().O9)(o)?{...t,id:o}:t};(0,u().i)({actor:t,duplicateRecord:p,options:{},mapper:m,originalRecord:l});const g=k().eC({environment:o,inMemoryRecordCache:i.inMemoryRecordCache,table:f().yB,transaction:r,value:p});n&&M().NI({childStore:g,parentStore:s,transaction:r});const v=i.getActionStores(),x=Promise.all(v.map((e=>{const t=d[e.id],{automationActionStore:n,onComplete:i}=K({environment:o,includeParenting:!1,mapper:m,sourceActionStore:e,targetAutomationActionId:t,transaction:r});return M().NI({childStore:n,parentStore:g,transaction:r}),i}))),S=x.then((e=>e.flat()));return{automationStore:g,onComplete:S}}function K(e){const{environment:t,includeParenting:o,insertionPoint:n,mapper:i,sourceActionStore:a,targetAutomationActionId:r,transaction:l}=e,c=a.getParentStore();if(!c||!c.isReady())throw new Error("Automation store is not ready");const u=a.getValue(),p=a.getSpaceId();if(!(0,A().O9)(u)||!(0,A().O9)(p))throw new Error("Undefined action value or space id");const m={...(0,b().mg)(u),id:r??(0,B().Z1)({environment:t,table:y().SC,spaceId:(0,h().e)(p)})},g=t.currentUser.id,f=a.inMemoryRecordCache.makeGetRecordRoleFn(g);(0,d().I)({duplicateRecord:m,getRecordRole:f,originalRecord:u,mapper:e=>(null==i?void 0:i(e))??e.requested,options:{},originOptions:{baseUrl:j().A.domainBaseUrl,publicDomainName:j().A.publicDomainName},duplicateBlocks:!1});const v=k().eC({environment:t,inMemoryRecordCache:a.inMemoryRecordCache,table:y().SC,transaction:l,value:m});o&&(!n||"afterActionId"in n?M().NI({after:null==n?void 0:n.afterActionId,childStore:v,parentStore:c,transaction:l}):"beforeActionId"in n?M().Ti({before:null==n?void 0:n.beforeActionId,childStore:v,parentStore:c,transaction:l}):(0,A().HB)(n),Y({transaction:l,automationStore:c}));const x=Promise.all(a.getBlockStores().map((e=>{const{blockStores:o,onComplete:n}=w().duplicateBlock({environment:t,preferDuplicateLocation:"local",stores:[e],targetSpaceId:(0,h().e)(e.pointer.spaceId),transaction:l,options:{addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1}}),i=o[0];return M().NI({childStore:i,parentStore:v,transaction:l}),n}))),S=v.getModel();return(0,A().O9)(S)&&(0,D().CM)(((e,o,n)=>{const i=(0,P().ik)(t),a=(0,D().zc)({automationActionStore:v,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:n});(0,A().O9)(a)&&(0,s().dW)(i,{automation_action:a,automation_action_id:S.id,automation_id:S.parent_id,from:"duplicate"}),(0,s().c_)(i,{automation_action_id:S.id,automation_action_type:S.type,automation_id:c.id,from:"duplicate"})})),{automationActionStore:v,onComplete:x}}function U(e){const{automationStore:t,automationTypecheckModule:o,contextType:n,environment:i,formulasModule:a,from:r,intl:s,isSubscribed:l,movedActionId:c,newActionIds:d,transaction:u}=e;k().zv({store:t,transaction:u,data:{action_ids:d}}),Y({automationStore:t,transaction:u});q({automationStore:t,transaction:u,typecheckResult:(0,F().Z)({environment:i,automationStore:t,automationTypecheckModule:o,contextType:n,formulasModule:a,intl:s,isSubscribed:l})}),(0,P().u4)({environment:i,event:{eventName:"automation_action_move",eventProperties:{automation_id:t.id,automation_action_id:c,from:r}}})}function H(e){const{actionStore:t,automationStore:o,automationTypecheckModule:n,contextType:i,environment:a,formulasModule:r,intl:l,isSubscribed:c,transaction:d}=e,u=(0,F().Z)({environment:a,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:l,isSubscribed:c});!function(e){const{automationActionStore:t,automationStore:o,environment:n,transaction:i,hasError:a=!1}=e;let r=t.getParentStore();if((0,A().O9)(o)){const e=t.getParentPointer();if(!(0,A().O9)(e))throw new Error("Automation action does not have a parent pointer");if(!g().L3.isEqual(e,o.pointer))throw new Error(`Automation action parent pointer does not match argument: ${g().L3.toKey(e)}, ${g().L3.toKey(o.pointer)}`);r=o}else if(!(0,A().O9)(r))throw new Error("Automation store is undefined");M().zz({childStore:t,parentStore:r,transaction:i});const l=t.getModel();(0,A().O9)(l)&&(0,D().CM)(((e,o,i)=>{const c=(0,P().ik)(n),d=(0,D().zc)({automationActionStore:t,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:i});(0,A().O9)(d)&&(0,s().YO)(c,{automation_action:d,automation_action_id:l.id,automation_id:l.parent_id,has_error:a}),(0,s().gW)(c,{automation_action_id:l.id,automation_action_type:l.type,automation_id:r.id,has_error:a})}))}({automationActionStore:t,environment:a,transaction:d,hasError:(S().Q.isSuccess(u)&&u.value.actionValidationFailures[t.id]||[]).length>0}),q({automationStore:o,transaction:d,typecheckResult:u})}function G(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,isSubscribed:s,transaction:l}=e;q({automationStore:o,transaction:l,typecheckResult:(0,F().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,isSubscribed:s})})}function Y(e){const{automationStore:t,transaction:o}=e;t.getSpaceId()&&t.getActionStores().forEach(((e,t)=>{var n;if(!e.isDefined())return;const i=e.getModel();i.isType("open_page")&&"url"===(null===(n=i.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,r().cQ)(t)&&k().zv({store:e.getConfigStore(),transaction:o,data:{target:null}})}))}function q(e){const{automationStore:t,transaction:o,typecheckResult:n}=e,i=t.getSpaceId(),a=t.getModel();if(i&&a&&!S().Q.isFail(n))for(const r of a.getActionIds()){const e=t.getRecordStore(t,{table:y().SC,id:r,spaceId:i});if(!e.isDefined())continue;const a=e.getModel(),s=new Set(n.value.actionInputValueTypes[r].map((e=>{if(e.kind===p().FormulaContextValueKind.Binding||e.kind===p().FormulaContextValueKind.ContextValue)return e.id;e.kind!==p().FormulaContextValueKind.ThisRow&&(0,A().HB)(e)})).filter(A().O9)),{value:c}=(0,l().G)({automationActionModel:a,baseUrl:j().A.domainBaseUrl,preventClearingConfig:!0,publicDomainName:j().A.publicDomainName,sourceSpaceId:i,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:e=>s.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),d=m().op.update({pointer:e.pointer,path:["config"],args:c.getConfig()??{}});I().applyOperation({store:e,operation:d,transaction:o})}}function X(e){const{environment:t,contentStore:o,transaction:n}=e,i=k().Wv({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});return C().BC({parentStore:o,appendStore:i,transaction:n}).childStore}function $(e){const{automationStore:t,environment:o,transaction:n}=e;k().zv({store:t,data:{status:"active"},transaction:n});const i=t.getModel();(0,A().O9)(i)&&(0,D().CM)(((e,n,a)=>{const r=(0,E().To)(t);let l=[];r&&S().Q.isSuccess(r)&&(l=r.value.valueTypes);const c=(0,P().ik)(o),d=(0,s().sp)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,_().i)(),simpleFormulasModule:a});(0,s().Ah)(c,d)}))}function J(e){const{automationStore:t,environment:o,status:n,transaction:i}=e,a=n??"disabled";k().zv({store:t,data:{status:a},transaction:i}),t.isTriggerType("recurrence")&&k().zv({store:t,data:{run_at:void 0},transaction:i});const r=t.getModel();(0,A().O9)(r)&&(0,D().CM)(((e,n,i)=>{const a=(0,E().To)(t);let l=[];a&&S().Q.isSuccess(a)&&(l=a.value.valueTypes);const c=(0,P().ik)(o),d=(0,s().sp)({automationModel:r,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,_().i)(),simpleFormulasModule:i});(0,s().vN)(c,d)}))}function Q(e){const{automationStore:t,environment:o,transaction:n}=e;k().zv({store:t,data:{alive:!1},transaction:n});const i=t.getModel();(0,A().O9)(i)&&(0,D().CM)(((e,n,a)=>{const r=(0,E().To)(t);let l=[];r&&S().Q.isSuccess(r)&&(l=r.value.valueTypes);const c=(0,P().ik)(o),d=(0,s().sp)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:l,getRecordModel:t.getRecordModel,featureGates:(0,_().i)(),simpleFormulasModule:a});(0,s().Iv)(c,d)}))}},348501:(e,t,o)=>{o.d(t,{A:()=>l,q:()=>s});var n=o(296540),i=()=>o(959013),a=()=>o(59364),r=o(474848);const s=300,l=(0,n.forwardRef)((function(e,t){const l=(0,i().tz)(),c=(0,o(444570).Jj)(),d=(0,o(401497).IS)((t=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",cursor:e.disableDrag?"pointer":"grab",width:e.width??a().Z,height:e.height??a().S,borderRadius:4,fill:c?t.icon.secondary:t.lightIconColor,...e.style},text:{color:t.text.contrastSecondary}})),[e.disableDrag,e.width,e.height,e.style,c]);const{onClick:u}=e,p=(0,n.useCallback)((e=>{u&&(e.preventDefault(),u(e))}),[u]);return(0,r.jsx)(o(859428).A,{placement:e.tooltipPlacement??o(962730).W.Bottom,delayThreshold:s,renderTooltip:function(){return(0,r.jsxs)("div",{style:{textAlign:"center"},children:[!e.disableDrag&&(0,r.jsx)(i().sA,{defaultMessage:"Drag <medium>to move</medium>",id:"dragHandleButton.dragPrompt.text",values:{medium:e=>(0,r.jsx)("span",{style:d.text,children:e})}}),!e.hideClickMessage&&(0,r.jsx)("div",{children:(0,r.jsx)(i().sA,{defaultMessage:"Click <medium>to open menu</medium>",id:"dragHandleButton.clickPrompt.text",values:{medium:e=>(0,r.jsx)("span",{style:d.text,children:e})}})})]})},render:n=>(0,r.jsx)(o(704152).A,{ref:t,ariaLabel:l.formatMessage({id:"dragHandleButton.ariaLabel",defaultMessage:"Drag"}),role:e.role,style:d.buttonStyle,onClick:e.onClick,onContextMenu:p,disallowTabbing:e.disallowTabbing,...n,children:(0,o(887146).i)({width:14,height:14,...e.iconStyle})})})}))},352759:(e,t,o)=>{o.d(t,{p:()=>v,t:()=>b});o(581454),o(296540);var n=()=>o(484714),i=()=>o(847249),a=()=>o(584262),r=()=>o(959013),s=()=>o(857783),l=()=>o(255018),c=()=>o(939740),d=()=>o(958378),u=()=>o(89924),p=()=>o(900967),m=()=>o(728611),g=()=>o(211716),f=()=>o(592968),y=()=>o(551619),h=o(474848);function v(e){let{store:t}=e;return(0,h.jsx)("div",{style:{width:"100%",maxWidth:"100%",margin:"0 auto 6px auto"},onMouseDown:y().NV,onClick:y().sx,children:(0,h.jsx)(l().A,{type:"page",store:t,headerText:(0,h.jsx)(r().sA,{defaultMessage:"Linked to this page",id:"page.expandedBacklinks.label"}),disableCurrentPageToken:!0,disableInaccessiblePages:!0})})}function b(e){let{store:t}=e;const o=(0,n().v3)(),r=(0,i().K8)((()=>(0,p().c)(t,o)),[t,o]),l=(0,i().K8)((()=>r.backlinks.map((e=>e.backlinkStore))),[r]).map(((e,t)=>({key:e.id,render:t=>(0,h.jsx)(d().A,{...t,store:e,hidePath:!1}),action:t=>{let{event:n}=t;f().F.setState({isOpen:!1});const i=m().Vr(n);s().uK({environment:o,store:e,openInNew:i,visitType:g().ig.Link,pageVisitSource:a().y8.Backlinks})}})));return(0,h.jsx)(c().Ay,{type:c().Oh.Vertical,initialFocus:void 0,sections:[{key:"all",items:l,render:e=>(0,h.jsx)(u().A,{...e})}]})}},380468:(e,t,o)=>{o.d(t,{A:()=>y});o(944114),o(898992),o(354520),o(581454);var n=o.n(o(844751)),i=o(296540),a=()=>o(959013),r=()=>o(496603),s=()=>o(760217),l=()=>o(939740),c=()=>o(8980),d=()=>o(89924),u=()=>o(250202),p=()=>o(972435),m=o(474848);const g=(0,a().YK)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});function f(e){let{currentProperty:t,showNoneOption:f,showRemoveOption:y,getProperties:h,onAccept:v,inputPlaceholder:b,defaultShowPropertyCount:x,disableSortByPageFormat:S,schema:A,format:C,renderProperty:M}=e;const k=(0,o(484714).Y0)(),[T,I]=(0,i.useState)(""),[j,w]=(0,i.useState)(!1),P=(0,o(847249).uB)(void 0,o(970585).A),_=(0,o(963589).X)("db_ux_mobile_filter_sheet"),B=(0,o(401497).IS)((e=>({menuItem:{color:e.text.secondary}})),[]),[R,E]=(0,o(857437).$)(),D=(0,o(390066).L)(C,A,void 0,o(651124).jf.Page).collection_page_properties||[],O=!x||j,F=p().A.formatMessage(g.none),V=f?{key:"none",render:e=>(0,m.jsx)(s().A,{...e,isChecked:!t,title:F}),action:()=>{v(void 0)}}:void 0,N=y?{key:"remove",render:e=>(0,m.jsx)(s().A,{...e,icon:(0,m.jsx)(c().I,{icon:o(236262).trashIcon}),title:p().A.formatMessage(g.remove)}),action:()=>{v(void 0)}}:void 0,L=h();let W=L;if(S||(W=r().Ul(L,(e=>D.findIndex((t=>t.property===e))))),T){const e=new Map;let t=W.map((t=>{const n=A[t],i=n?`${n.name} ${o(682146).dC[n.type]}`:"";return e.set(t,i),i}));t=n().filter(T,t).map((e=>{let{original:t}=e;return t})),W=W.filter((o=>t.includes(e.get(o)||"")))}else!O&&x&&(W=W.slice(0,x));const z=r().oE([!T||n().test(T,F)?V:void 0,...W.map((e=>function(e,t,o,n,i){const a=t[e];if(!a)return;const r={key:e,render:t=>{const o=e===n;return i?i(t,e,o,a):(0,m.jsx)(u().G,{...t,propertySchema:a,format:u().e.Name,isChecked:o})},action:()=>{o(e)}};return r}(e,A,v,t,M)))]);if(!O&&L.length>W.length&&!T){const e={key:"show_more",render:e=>(0,m.jsx)(s().A,{...e,icon:(0,m.jsx)(c().I,{icon:o(589407).L}),style:B.menuItem,title:(0,m.jsx)(a().sA,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:L.length-W.length}})}),action:()=>{w(!0)}};z.push(e)}const K=z.length>0,U=Boolean(T),H=!N||K||U;H&&!K&&z.push({action:r().lQ,key:"noResults",render:e=>(0,m.jsx)(o(736767).A,{...e,caption:(0,m.jsx)(a().sA,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});const G=[];if(H){const e=(0,m.jsx)(o(419357).Ay,{focusInitial:!k.isMobile||void 0,focus:!k.isMobile||void 0,value:T,onChange:e=>{I(e.target.value),P.setState({...P.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}}),w(!1)},placeholder:b||p().A.formatMessage(g.inputPlaceholder),...R});k.isMobile&&_?z.unshift({key:"input",render:()=>e,action:r().lQ}):G.push({key:"input",comp:(0,m.jsx)(d().A,{isInput:!0,children:e})})}return(z.length>0||N)&&G.push({key:"properties",comp:(0,m.jsx)(l().Ay,{type:l().Oh.Vertical,initialFocus:0,comboboxProps:H?E:void 0,sections:[...z.length>0?[{key:"results",render:e=>(0,m.jsx)(d().A,{...e}),items:z}]:[],...N?[{key:"remove",render:e=>(0,m.jsx)(d().A,{topBorder:z.length>0,...e}),items:[N]}]:[]],store:P})}),(0,m.jsx)(m.Fragment,{children:G.map((e=>{let{key:t,comp:o}=e;return(0,m.jsx)(i.Fragment,{children:o},t)}))})}const y=i.memo(f,o(821062).A)},381138:(e,t,o)=>{o.d(t,{q:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("search",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M.281 6.438c0-.875.164-1.696.492-2.461a6.484 6.484 0 011.375-2.032A6.237 6.237 0 016.64.078 6.2 6.2 0 019.11.57c.77.328 1.447.787 2.03 1.375a6.374 6.374 0 011.368 2.032c.333.765.5 1.586.5 2.46 0 .688-.107 1.342-.32 1.961a6.28 6.28 0 01-.868 1.696l3.563 3.578c.11.104.19.226.242.367.057.14.086.29.086.445 0 .22-.05.417-.149.594a1.122 1.122 0 01-1 .57c-.156 0-.307-.028-.453-.086a1.058 1.058 0 01-.382-.25l-3.586-3.585c-.5.333-1.047.596-1.641.789a6.089 6.089 0 01-1.86.28 6.237 6.237 0 01-2.468-.491 6.4 6.4 0 01-2.024-1.367A6.509 6.509 0 01.773 8.913a6.256 6.256 0 01-.492-2.476zm1.664 0c0 .65.12 1.26.36 1.828a4.775 4.775 0 001.015 1.5c.433.427.933.763 1.5 1.007a4.548 4.548 0 001.82.368c.652 0 1.261-.123 1.829-.368a4.747 4.747 0 002.508-2.507 4.567 4.567 0 00.367-1.829c0-.645-.123-1.252-.367-1.82a4.776 4.776 0 00-1.016-1.5A4.578 4.578 0 008.469 2.11a4.567 4.567 0 00-1.828-.367c-.646 0-1.253.123-1.82.367a4.667 4.667 0 00-1.5 1.008c-.433.432-.772.932-1.016 1.5a4.633 4.633 0 00-.36 1.82z"})})},387712:(e,t,o)=>{o.d(t,{A:()=>a});class n extends(()=>o(757695))().default{getInitialState(){return{open:!1}}}const i=new n;(0,o(604341).exposeDebugValue)("AutomationModalStore",i);const a=i},390518:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(331542),i=o(474848);function a(){return(0,i.jsx)("div",{style:{alignItems:"center",display:"flex",justifyContent:"center",minHeight:200,overflow:"hidden"},children:(0,i.jsx)(n().A,{})})}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>_,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>C,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>A,MAX_RECURRENCE_INTERVAL:()=>h,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>k,areRecurrenceSchedulesEqual:()=>O,convertFromUnpersistedRecurrenceConfig:()=>D,convertToUnpersistedRecurrenceConfig:()=>B,getFormattedEndCondition:()=>P,getFormattedNextRecurrenceTime:()=>w,getNewEndTimestamp:()=>R,getNextDateUtc:()=>j,getRecurrenceAfter:()=>T,isRunningBetweenMidnightAnd3AM:()=>I,isValidRecurrenceInterval:()=>b,isValidRecurrenceNumberOfRuns:()=>x,rruleFromRecurrence:()=>S,templateAncestorsViolateRecurrenceNesting:()=>M});o(898992),o(354520),o(581454);var n=()=>o(244641);o(944114);function i(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const a=[];for(const r of e)a.push(...i(o[0],...o.slice(1)).map((e=>[r,...e])));return a}var a=()=>o(496603),r=()=>o(534177),s=()=>o(720665),l=()=>o(597777),c=()=>o(869190),d=()=>o(416504),u=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const g=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},y={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},h=99,v=999;function b(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function x(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function S(e){const{start_date:t,frequency:o,interval:n,weekdays:a,timezone:s,hour:c,minute:d}=e,u="week"===o&&a?a.map((e=>y[e])):void 0,m={};return(0,r().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,l().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,r().HB)(e.end_condition)),"month"===e.frequency&&(0,r().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return y[t].nth(o)})):(0,r().HB)(e.monthly_restriction)),new p({freq:f[o],dtstart:(0,l().eU)(t),interval:n,byweekday:u,tzid:s,byhour:c??0,byminute:d??0,bysecond:0,...m})}const A=1,C=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=n>A,r=o.length>=C;return{violatesConstraint:a||r,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:r,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:i}}function k(e){var t;const{recurrence:o,afterDate:i}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=i)return o;let a=n().c9.fromMillis(o.start_date,{zone:"utc"});const r=n().c9.fromMillis(i,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(r.diff(a,"years").years/o.interval);a=a.plus({years:e*o.interval});break}case"month":{const e=Math.floor(r.diff(a,"months").months/o.interval);a=a.plus({months:e*o.interval});break}case"week":{const e=Math.floor(r.diff(a,"weeks").weeks/o.interval);a=a.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(r.diff(a,"days").days/o.interval);a=a.plus({days:e*o.interval});break}}return{...o,start_date:(0,l().DH)(a.toMillis())}}function T(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,l().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=S(k({recurrence:t,afterDate:o})).after((0,l().eU)(o));if(!e)return;return(0,l().h1)(e)}}function I(e){return 0===e.hour||1===e.hour||2===e.hour}function j(e){return S(e).after((0,l().eU)((0,l().Rz)()))||void 0}function w(e){const{recurrence:t,intl:o}=e,i=j(D(t));if(!i)return;const a=I(t),r=n().c9.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(o)).setZone(t.timezone),s=(0,c().Yq)({date:r,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(a)return o.formatMessage(g.dateBetweenMidnightAnd3AM,{date:s});{let e=r.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${r.toFormat("ZZZZ")}`),o.formatMessage(g.dateAtTime,{date:s,time:e})}}function P(e,t){return(0,r().O9)(e)?"number"===e.type?t.formatMessage(g.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,r().HB)(e):t.formatMessage(g.noEndCondition)}const _=100;function B(e){return{...e,start_date:(0,l().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,l().l1)(e.end_condition.end_at)}:(0,r().HB)(e.end_condition):void 0}}function R(e,t,o){return e.plus(o-t)}function E(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,l().Rz)(o.toJSDate())}}function D(e){return{...e,start_date:(0,l().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?E(e,e.end_condition):(0,r().HB)(e.end_condition):void 0}}function O(e,t){const o=a().fN(e,(e=>void 0!==e)),n=a().fN(t,(e=>void 0!==e));return a().n4(o,n)}},398842:(e,t,o)=>{o.d(t,{Jv:()=>v,Zr:()=>b,Rl:()=>x,mA:()=>h});var n=o(296540),i=()=>o(484714),a=()=>o(847249),r=()=>o(401497),s=()=>o(970013),l=()=>o(743176),c=()=>o(68465),d=()=>o(159588),u=()=>o(963589),p=()=>o(331542),m=o(474848);function g(){const e=(0,r().DP)();return(0,m.jsx)("span",{style:{marginLeft:6,fontSize:11,padding:"1px 4px",borderRadius:4,display:"inline-flex",flexDirection:"row",alignItems:"center",gap:4,marginTop:1,color:"light"===e.mode?e.accentColors.blue[500]:e.accentColors.blue[600]},children:(0,m.jsx)(p().A,{legacySize:14})})}var f=()=>o(399275);const y=function(){return(0,m.jsx)(o(464708).A,{color:"purple",style:{marginLeft:6,padding:"1px 4px",display:"inline-flex",flexDirection:"row",alignItems:"center",gap:4,marginTop:1},content:(0,m.jsx)(o(959013).sA,{defaultMessage:"AI",id:"database.property.aiAutofillEnabledIndicator"})})};const h=n.memo((function(e){const{propertySchema:t,showIcon:n,showDragIcon:a,hideName:s,badge:l,style:c,iconStyle:u,iconSize:p,dragHandleStyle:g,className:f,labelSizeVariant:y}=e,h=(0,i().v3)(),{device:v}=h,b=v.isMobile?16:14,S=(0,r().IS)((e=>({container:{display:"flex",alignItems:"center",lineHeight:"120%",minWidth:0,fontSize:b,...c},iconWrapper:{display:"grid",justifyContent:"center",alignItems:"center",marginRight:s?void 0:"small"===y||a?4:6,...u},dragHandle:{gridColumn:1,gridRow:1,opacity:a?1:0,transition:`opacity ${d().bM}`},itemIcon:{gridColumn:1,gridRow:1,opacity:a?0:1,transition:`opacity ${d().bM}`},dragIcon:{fill:e.icon.secondary}})),[b,s,u,y,a,c]);return(0,m.jsxs)("div",{className:f,style:S.container,children:[n&&(0,m.jsxs)("div",{style:S.iconWrapper,children:[(0,m.jsx)("div",{style:S.itemIcon,children:(0,m.jsx)(x,{propertySchema:t,iconSize:p,iconStyle:u})}),(0,m.jsx)("div",{style:S.dragHandle,children:(0,m.jsx)(o(57232).A,{style:g,iconSize:12,iconStyle:S.dragIcon})})]}),!s&&(0,m.jsx)("div",{style:{...o(284371).RC},children:t.name}),l]})}));function v(e){const{propertySchema:t}=e,o=(0,i().v3)();return(0,a().K8)((()=>(0,c().O0)(o)&&s().$M(t)&&s().om(t)),[o,t])?(0,m.jsx)(y,{}):null}function b(e){let{propertyId:t,collectionContextStore:o}=e;return(0,a().K8)((()=>{var e;const n=null===(e=o.collectionStore())||void 0===e?void 0:e.id;if(!n)return!1;const i=f().d.state.collectionsProperties[n];return!!i&&"Loading"===i[t]}),[o,t])?(0,m.jsx)(g,{}):null}function x(e){const{propertySchema:t,iconSize:o,iconStyle:n}=e,{isMobile:a}=(0,i().Y0)(),s=(0,r().DP)(),c=(0,u().X)("nds_default_property_noticon"),d=a?18:16;return(0,m.jsx)(l().zB,{type:t.type,icon:t.icon,size:o||d,theme:s,style:n,isDefaultNoticonEnabled:c})}},399275:(e,t,o)=>{o.d(t,{d:()=>i});o(898992),o(354520);class n extends(()=>o(757695))().default{getInitialState(){return{flowId:void 0,type:"connected_properties_setup",collectionsProperties:{}}}createNewFlowId(){const e=(0,o(206267).JW)();return this.setState({...this.state,flowId:e}),e}getFlowId(){return this.state.flowId?this.state.flowId:this.createNewFlowId()}addCollectionProperties(e,t){const o=this.state.collectionsProperties[e],n=o?{...o,...t}:t;this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}removeCollectionProperties(e,t){const o=this.state.collectionsProperties[e];if(!o)return;const n=Object.fromEntries(Object.entries(o).filter((e=>{let[o]=e;return!t.has(o)})));if(0===Object.keys(n).length){const{[e]:t,...o}=this.state.collectionsProperties;this.setState({...this.state,collectionsProperties:o})}else this.setState({...this.state,collectionsProperties:{...this.state.collectionsProperties,[e]:n}})}}const i=new n;(0,o(604341).exposeDebugValue)("ConnectedPropertiesSyncStore",i)},406533:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,questionMarkCircleIcon:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},a=(0,o(340498).wt)("questionMarkCircle",i)},427636:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){const{botStore:t,avatarSize:i,shouldShowBadge:a,style:r,inline:s}=e,l=(0,o(959013).tz)(),c=(0,o(484714).Y0)(),d=(0,o(847249).K8)((()=>null==t?void 0:t.getDisplayName(l)),[t,l]),{outerStyle:u,avatarWrapStyle:p,badgeStyle:m}=(0,o(401497).IS)((e=>({outerStyle:{display:"flex",alignItems:"center",minWidth:0,...r},avatarWrapStyle:s?{width:"none",minHeight:"none",marginRight:6}:{marginRight:6},badgeStyle:{padding:"2px 6px",borderRadius:4,color:e.text.secondary,background:e.legacyDefaultSelectColor,fontSize:c.isMobile?11:9,lineHeight:c.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",marginLeft:8,marginTop:1}})),[r,s,c]);return(0,n.jsxs)("div",{style:u,children:[(0,n.jsx)("div",{style:p,children:(0,n.jsx)(o(256863).A,{botStore:t,size:i})}),(0,n.jsx)("div",{style:{...o(284371).RC},children:d}),a&&(0,n.jsx)("div",{style:m,children:"Bot"})]})}},442277:(e,t,o)=>{o.d(t,{B:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},495408:(e,t,o)=>{o.d(t,{p:()=>S});var n=o(296540),i=()=>o(484714),a=()=>o(401497),r=()=>o(30626),s=()=>o(173019),l=()=>o(959013),c=()=>o(100622),d=()=>o(522945),u=()=>o(962730),p=()=>o(397248),m=()=>o(630116),g=()=>o(704152),f=()=>o(406699),y=()=>o(285790),h=()=>o(839010),v=()=>o(904694),b=()=>o(24611),x=o(474848);function S(e){const{height:t,padding:o,padding_top:S,iframe_url:A,hoverData:C,store:M,token:k,href:T,onDismiss:I}=e,j=(0,l().YK)({editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),w=(0,i().v3)(),P=(0,l().tz)(),_=(0,n.useRef)(null),B=(0,a().IS)((e=>({content:{width:340,height:"100%",aspectRatio:"auto",position:"relative"},container:{width:340,maxHeight:420,flexDirection:"column",alignItems:"flex-start"},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:(0,b().FF)(w)}})),[w]),R=M&&M.recordStoreUIParentStore&&M.recordStoreUIParentStore instanceof m().Bv?M.recordStoreUIParentStore:M instanceof m().Bv?M:void 0;return(0,x.jsxs)("div",{style:B.container,children:[e.showEditButton&&(0,x.jsx)(y().A,{onClick:e.handleEditClick,icon:s().r,isDarkIconColor:!0,ariaLabel:P.formatMessage(j.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:8,zIndex:1}}),k&&R&&C&&(0,x.jsx)("div",{style:{position:"absolute",top:8,right:8,zIndex:2},children:(0,x.jsx)(f().Ay,{popupType:f().z7.Popup,placementToOrigin:u().W.Right,alignmentToOrigin:u().C.Start,originGap:4,onClose:()=>{let e=!1;const t=_.current;t&&(e=(0,p().ux)(t.getBoundingClientRect(),d().$C.x,d().$C.y)),e||null==I||I()},renderOrigin:e=>(0,x.jsx)(g().A,{style:B.buttonStyle,...e,children:(0,r()._)({width:14,fill:c().Ay.white})}),render:e=>(0,x.jsx)(v().A,{parentBlockStore:R,store:M,token:k,href:T,hoverData:C,onAccept:()=>e.close()})})}),(0,x.jsx)(h().A,{source:A,style:B.content,preserveScale:!!(t&&t<1||o),background:!1,height:t&&t>0?t:void 0,aspectRatio:o?o/100:.75,paddingTop:S||void 0})]})}},514608:(e,t,o)=>{o.r(t),o.d(t,{eyeFillSmallIcon:()=>a,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.219 8.002a1.22 1.22 0 1 1-2.439 0 1.22 1.22 0 0 1 2.439 0"}),(0,n.jsx)("path",{d:"M.914 7.44a1.21 1.21 0 0 0 0 1.128c1.282 2.442 3.987 4.1 7.086 4.1s5.804-1.658 7.086-4.1a1.21 1.21 0 0 0 0-1.128C13.804 4.997 11.099 3.34 8 3.34S2.196 4.997.914 7.44M8 10.628a2.626 2.626 0 1 1 .001-5.251A2.626 2.626 0 0 1 8 10.627"})]})},a=(0,o(340498).wt)("eyeFillSmall",i)},519143:(e,t,o)=>{o.d(t,{D:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m3.625 11.151 1.187-1.187a.625.625 0 1 1 .884.884l-2.254 2.254a.625.625 0 0 1-.884 0L.304 10.848a.625.625 0 0 1 .884-.884l1.187 1.187V10a7.625 7.625 0 0 1 12.814-5.587.625.625 0 1 1-.851.915A6.375 6.375 0 0 0 3.625 10zm14-2.302 1.187 1.187a.625.625 0 1 0 .884-.884l-2.254-2.254a.625.625 0 0 0-.884 0l-2.254 2.254a.625.625 0 1 0 .884.884l1.187-1.187V10a6.375 6.375 0 0 1-10.713 4.672.625.625 0 0 0-.85.915A7.625 7.625 0 0 0 17.625 10z"})},i=(0,o(340498).wt)("arrowCircleLoop",n)},546806:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("chevronDownThin",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M8 11.4795C7.77214 11.4795 7.56478 11.3883 7.37793 11.2061L2.17578 5.88086C2.09831 5.80794 2.03906 5.72591 1.99805 5.63477C1.96159 5.53906 1.94336 5.43652 1.94336 5.32715C1.94336 5.17676 1.97754 5.04004 2.0459 4.91699C2.11882 4.79395 2.21452 4.69824 2.33301 4.62988C2.4515 4.55697 2.58594 4.52051 2.73633 4.52051C2.95508 4.52051 3.14648 4.60254 3.31055 4.7666L8.33496 9.91406H7.67188L12.6895 4.7666C12.8535 4.60254 13.0449 4.52051 13.2637 4.52051C13.4141 4.52051 13.5485 4.55697 13.667 4.62988C13.7855 4.69824 13.8789 4.79395 13.9473 4.91699C14.0202 5.04004 14.0566 5.17676 14.0566 5.32715C14.0566 5.54134 13.9792 5.72591 13.8242 5.88086L8.62207 11.2061C8.53548 11.2972 8.43978 11.3656 8.33496 11.4111C8.23014 11.4567 8.11849 11.4795 8 11.4795Z"})})},551619:(e,t,o)=>{o.d(t,{Hy:()=>P,NV:()=>j,O9:()=>B,Rg:()=>_,Sm:()=>E,dK:()=>D,f7:()=>R,l8:()=>O,n$:()=>F,no:()=>V,sx:()=>w});var n=()=>o(484714),i=()=>o(792485),a=()=>o(847249),r=()=>o(700500),s=()=>o(651124),l=()=>o(519831),c=()=>o(620689),d=()=>o(591197),u=()=>o(835066),p=()=>o(964345),m=()=>o(68465),g=()=>o(753199),f=()=>o(504836),y=()=>o(478726),h=()=>o(747100),v=()=>o(963589),b=()=>o(665579),x=()=>o(351360),S=()=>o(525569),A=()=>o(508496),C=()=>o(375447),M=()=>o(66496),k=()=>o(548821),T=()=>o(712505),I=()=>o(302022);function j(e){(0,g().SQ)({event:e,context:g().y$.EditorMouseDown,callback:()=>{}})}function w(e){(0,g().SQ)({event:e,context:g().y$.EditorClick,callback:()=>{}})}function P(e){return(0,a().K8)((()=>Boolean(I().A.state.pageMap[e.id])||M().A.state.pages.has(e.id)),[e.id])}function _(e,t){const o=(0,n().v3)(),r=(0,i().S)(),s=P(e),l=(0,a().K8)((()=>{var o,n;return t===k().Rr.Frame?Boolean(null===(o=x().default.state.currentLoadingContainerStore)||void 0===o?void 0:o.state.ready):t===k().Rr.PeekView&&T().default.state.open?Boolean(null===(n=T().default.state.loadingContainerStore)||void 0===n?void 0:n.state.ready):t===k().Rr.CollectionPageView||t===k().Rr.CollectionPageViewFullScreen?e.isReady():void 0}),[t,e]),c=R(e);return(0,a().K8)((()=>{if(!l)return!1;const t=o.currentUser.isLoggedIn(),n=r&&r.publicEditModeStore.state;return Boolean(e&&e.isDefined()&&!e.isNonEditableState()&&e.canEdit()&&!e.hasContent()&&t&&(!(null!=n&&n.hasPublicPermission)||"edit"===(null==n?void 0:n.permission))&&!s&&!c&&(!(0,m().ZE)(n)||"completionPopup"!==S().default.state.type))}),[o.currentUser,c,l,r,s,e])}function B(e,t){const o=(0,n().v3)(),r=(0,i().S)(),{isTablet:s}=(0,n().Y0)(),l=(0,v().X)("tablet_refresh_template_pills_gate");return(0,a().K8)((()=>{if(t===k().Rr.SitePreview)return!1;if(o.device.isMobile&&(!s||!l))return!1;if(!o.currentUser.isLoggedIn())return!1;const n=r&&r.publicEditModeStore.state;if(null!=n&&n.hasPublicPermission&&"edit"!==(null==n?void 0:n.permission))return!1;if(e.getContentLength()>1)return!1;if(!e.canEdit()||e.isNonEditableState())return!1;const i=e.getContentStores()[0];if(i&&!i.isEmptyTextBlock())return!1;if(e.getAssociatedCollectionStore())return!1;const a=p().gZ.state,c=p().Di.state;if(a&&e.id===c)return!1;return!((0,y().L5)(t)?d().VY.state:d().u3.state)}),[o,r,e,t,s,l])}function R(e){return(0,a().K8)((()=>{if(e.isCollectionView()){const t=e.getCollectionStoreIfSingleSource();return!!t&&t.isSyncedCollection()}return e.isType(r().xd.externalObjectInstancePage)}),[e])}function E(e){return(0,a().K8)((()=>{if(!(0,f().vL)())return!1;const t=e.getParentStore();if((null==t?void 0:t.table)===l().Vl){return!!t.getFormatStore().getKeyStore("external_collection_type").getValue()}return!1}),[e])}function D(e){return(0,a().K8)((()=>{if(!(0,f().pB)())return!1;var t;return!!e.isCollectionView()&&((null===(t=e.getCollectionStore())||void 0===t?void 0:t.getFormatStore().getKeyStore("external_collection_type").getValue())??!1)}),[e])}function O(e){return(0,a().K8)((()=>{if(!A().default.checkGate({gateName:"csvimport_faster_navigate_to_page_enabled"}))return!1;var t;return!!e.isCollectionView()&&(null===(t=e.getCollectionStore())||void 0===t?void 0:t.getFormatStore().getKeyStore("static_import_collection_type").getValue())===s().IE.CsvImport}),[e])}function F(e){const t=(0,n().v3)(),{device:o,WindowSizeStore:i}=t,r=(0,a().K8)((()=>{const e=i.state.height,n=o.isMobile&&C().A.state.open?e:0;return c().C6(t)+n}),[t,i,o.isMobile]);return(0,a().K8)((()=>"home-phone"===e?b().q3:o.isTablet?380:o.isIOS?Math.max(350,r):o.isMobile?400:"side-peek"===e||"center-peek"===e?h().ln:"home"===e?b().wH:"30vh"),[o,r,e])}function V(e){const t=(0,n().v3)(),o=(0,a().K8)((()=>(0,u().dC)(t,e)),[t,e]);return(0,a().K8)((()=>o&&!e.isFullWidth()?(0,u().Zy)(t,(0,h().cq)(e),(0,h().RX)(e)):0),[t,o,e])}},551882:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var n=()=>o(484714),i=()=>o(847249),a=()=>o(959013),r=()=>o(68465),s=()=>o(351360),l=()=>o(411671),c=()=>o(464708),d=o(474848);function u(e){const{message:t}=e,o=(0,n().v3)();return(0,i().K8)((()=>{const e=s().default.state.mainEditorCurrentBlockStore,t=e&&l().A.getMode(o,e);return(0,r().ZE)(t)}),[o])?(0,d.jsx)(c().A,{color:"purple",style:{padding:"1px 4px",display:"inline-flex",flexDirection:"row",alignItems:"center",gap:4,...e.style},content:t??(0,d.jsx)(a().sA,{id:"aiBadgeComponent.label",defaultMessage:"AI"})}):null}},556048:(e,t,o)=>{o.d(t,{C8:()=>p,Dz:()=>l,GC:()=>g,GL:()=>f,YY:()=>m,dM:()=>d,h9:()=>c,jX:()=>s,oF:()=>u,uj:()=>r});var n=()=>o(645873);const i={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(75134),o.e(68744)]).then(o.bind(o,408453)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(75134),o.e(2686)]).then(o.bind(o,484967)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await o.e(28763).then(o.bind(o,992567)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await o.e(98288).then(o.bind(o,984289)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020))))},a={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>o.e(56188).then(o.bind(o,604698))))},r=(0,n()._h)(a.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,n()._h)(i.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),l=(0,n()._h)(i.JiraDCAuthModal,(e=>e.default)),c=(0,n()._h)(i.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n()._h)(i.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n()._h)(i.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(i.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),m=(0,n()._h)(i.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,n()._h)(i.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),f=(0,n()._h)(i.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,o(340498).xh)("jira",{default:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:20},small:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:16},mini:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:14},large:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:24}})},559419:(e,t,o)=>{o.d(t,{c:()=>i});var n=o(296540);function i(){const[e,t]=(0,n.useState)(void 0),o=(0,n.useCallback)((e=>t(e.id)),[]),i=(0,n.useCallback)((()=>t(void 0)),[]);return(0,n.useMemo)((()=>({currentDraggingActionId:e,onActionDragStart:o,onActionDragEnd:i})),[e,i,o])}},563015:(e,t,o)=>{o.d(t,{eJ:()=>f,ew:()=>g,ml:()=>d,rA:()=>p,yI:()=>m,zf:()=>u});o(581454);var n=()=>o(496603),i=()=>o(534177),a=()=>o(708685),r=()=>o(145076),s=()=>o(349835),l=()=>o(977345);function c(e){switch(e){case"checkbox":return"boolean";case"number":return"number";case"text":return"text";case"date":return"date";case"array":return"array";case"block":return"block";case"person":return"person";case"select":return"select";case"function":return"function";case"unknown":return"unknown";case"undefined":return"undefined";default:(0,i().HB)(e)}}function d(e){switch(e.type){case s().M9.InvalidCharacter:return{...r().x0.InvalidCharacter,values:{errorCharacter:e.character}};case s().M9.UnclosedStringLiteral:return r().x0.UnclosedStringLiteral;case s().M9.UnclosedComment:return r().x0.UnclosedComment;case s().M9.TokenExpected:return{...r().x0.TokenExpected,values:{expectedToken:e.token}};case s().M9.StringLiteralContainsToken:return r().x0.StringLiteralContainsToken;case s().M9.ExpressionExpected:return r().x0.ExpressionExpected;case s().M9.PropertyTokenOrFunctionExpected:return r().x0.PropertyTokenOrFunctionExpected;case s().M9.EndOfInputExpected:return r().x0.EndOfInputExpected;case s().M9.UnexpectedError:return r().x0.UnexpectedError;case s().M9.TooDeeplyNested:return r().x0.TooDeeplyNested;default:(0,i().HB)(e)}}function u(e){switch(e.type){case s().IA.FunctionCallArgumentWrongType:case s().IA.FunctionCallUnexpectedArgument:return e.argument;default:return e.node}}function p(e,t){let o;switch(t.type){case s().IA.ThisRowTypeNotFound:o=r().Xz.ThisRowTypeNotFound;break;case s().IA.ThisRowNotBlockWithCollection:o=r().Xz.ThisRowNotBlockWithCollection;break;case s().IA.MissingPropertyOnThisRow:o={...r().Xz.MissingPropertyOnThisRow,values:{propertyName:t.property}};break;case s().IA.MissingContextVariable:{const e=(0,l().ix)(t.token)?t.token.contextValueId:t.token.valueId;o={...r().Xz.MissingContextVariable,values:{valueId:e}}}break;case s().IA.MissingBlock:o={...r().Xz.MissingBlock,values:{blockId:t.token.blockId}};break;case s().IA.CallingNotFunction:o={...r().Xz.CallingNotFunction,values:{expressionType:c(t.callee.type.type)}};break;case s().IA.FunctionCallTooFewArguments:o={...r().Xz.FunctionCallTooFewArguments,values:{minNumParameters:t.minNumParameters,functionName:t.libraryFunction.name,numArguments:t.numArguments}};break;case s().IA.FunctionCallUnexpectedArgument:o={...r().Xz.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().IA.FunctionCallArgumentWrongType:o={...r().Xz.FunctionCallArgumentWrongType,values:{argumentType:c(t.argument.type.type),functionName:t.libraryFunction.name}};break;case s().IA.MemberPropertyMismatchCollection:o={...r().Xz.MemberPropertyMismatchCollection,values:{propertyName:t.token.property}};break;case s().IA.MemberPropertyMissing:o={...r().Xz.MemberPropertyMissing,values:{propertyName:t.property}};break;case s().IA.MemberPropertyTargetNotBlock:o=r().Xz.MemberPropertyTargetNotBlock;break;case s().IA.MemberPropertyTypeInvalid:o={...r().Xz.MemberPropertyTypeInvalid,values:{propertyName:t.propertyName,propertyType:t.propertyType}};break;case s().IA.UndefinedIdentifier:o={...r().Xz.UndefinedIdentifier,values:{identifier:t.node.text}};break;case s().IA.UnifiedFunctionCannotFindFunction:o={...r().Xz.UnifiedFunctionCannotFindFunction,values:{functionName:t.name}};break;case s().IA.UnifiedFunctionNoArguments:o={...r().Xz.UnifiedFunctionNoArguments,values:{functionName:t.libraryFunction.name}};break;case s().IA.UnifiedFunctionTargetWrongType:o={...r().Xz.UnifiedFunctionTargetWrongType,values:{functionName:t.libraryFunction.name,targetType:c(t.expression.type.type)}};break;case s().IA.CannotRelativelyCompareTypes:o={...r().Xz.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().IA.CannotDoMathOnType:o={...r().Xz.CannotDoMathOnType,values:{lhsType:c(t.lhsType.type),rhsType:c(t.rhsType.type)}};break;case s().IA.UnaryMinusOnNonNumber:o={...r().Xz.UnaryMinusOnNonNumber,values:{type:c(t.expression.type.type)}};break;case s().IA.IdentifierExpected:o=r().Xz.IdentifierExpected;break;case s().IA.FunctionCallExpected:o={...r().Xz.FunctionCallExpected,values:{functionName:t.functionName}};break;case s().IA.RenamedIdentifier:o={...r().Xz.RenamedIdentifier,values:{identifier:t.identifier,renamedTo:t.renamedTo}};break;case s().IA.RemovedFunction:o={...r().Xz.RemovedFunction,values:{functionName:t.functionName,alternative:t.alternative}};break;case s().IA.ContextVariableNotBlockWithCollection:o={...r().Xz.ContextVariableNotBlockWithCollection,values:{valueId:t.token.contextValueId}};break;case s().IA.MissingPropertyOnContextVariable:o={...r().Xz.MissingPropertyOnContextVariable,values:{propertyName:t.property,valueId:t.token.contextValueId}};break;case s().IA.BlockPropertyTypeInvalid:o={...r().Xz.BlockPropertyTypeInvalid,values:{propertyName:t.propertyName}};break;case s().IA.DisallowedReturnType:{const n=t.allowedReturnTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...r().Xz.DisallowedReturnType,values:{allowedReturnType:e.formatList(n,{style:"long",type:"conjunction"}),allowedReturnTypeCount:t.allowedReturnTypes.length,returnType:e.formatMessage((0,a().getHumanReadableType)(t.returnType)).toLocaleLowerCase()}};break}case s().IA.CrossSpacePropertyNotSupported:o={...r().Xz.CrossSpacePropertyNotSupported};break;default:(0,i().HB)(t)}return{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}}function m(e,t){let o;switch(t.type){case s().uW.MissingThisRow:o=r().X8.MissingThisRow;break;case s().uW.MissingSchemaPropertyOnThisRow:o={...r().X8.MissingSchemaPropertyOnThisRow,values:{propertyName:t.property}};break;case s().uW.ThisRowBlockPropertyMismatchCollection:o=r().X8.ThisRowBlockPropertyMismatchCollection;break;case s().uW.MissingContextVariable:o={...r().X8.MissingContextVariable,values:{valueId:t.valueId}};break;case s().uW.IdentifierNotFound:o={...r().X8.IdentifierNotFound,values:{identifier:t.node.text}};break;case s().uW.CannotRelativelyCompareTypes:o={...r().X8.CannotRelativelyCompareTypes,values:{lhsType:c(t.lhsType),rhsType:c(t.rhsType)}};break;case s().uW.CannotDoMathOnType:o={...r().X8.CannotDoMathOnType,values:{valueType:c(t.valueType)}};break;case s().uW.CannotCallNonFunction:o={...r().X8.CannotCallNonFunction,values:{calleeType:c(t.calleeType)}};break;case s().uW.UnifiedFunctionPropertyNotFound:o={...r().X8.UnifiedFunctionPropertyNotFound,values:{functionName:t.node.name}};break;case s().uW.LibraryFunctionExecutionError:const n=t.error instanceof s().x4?t.error:void 0;o=(null==n?void 0:n.info.type)===s().v3.DateInvalidDurationUnit?{...r().gW.DateInvalidDurationUnit,values:{functionName:t.libraryFunction.name,invalidUnit:n.info.invalidUnit}}:(null==n?void 0:n.info.type)===s().v3.CannotUseToNumberOnList?{...r().gW.CannotUseToNumberOnList}:(null==n?void 0:n.info.type)===s().v3.CannotRoundToNonInteger?{...r().gW.CannotRoundToNonInteger,values:{precision:n.info.precision}}:(null==n?void 0:n.info.type)===s().v3.CannotRoundToTooManyDecimalPlaces?{...r().gW.CannotRoundToTooManyDecimalPlaces,values:{precision:n.info.precision}}:{...r().X8.LibraryFunctionExecutionError,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallTooFewArguments:o={...r().X8.FunctionCallTooFewArguments,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallUnexpectedArgument:o={...r().X8.FunctionCallUnexpectedArgument,values:{functionName:t.libraryFunction.name}};break;case s().uW.FunctionCallArgumentWrongType:o={...r().X8.FunctionCallArgumentWrongType,values:{functionName:t.libraryFunction.name,argumentType:c(t.argumentType)}};break;case s().uW.AccessingPropertyOnNonBlock:o=r().X8.AccessingPropertyOnNonBlock;break;case s().uW.MissingDataDependencyBlock:o={...r().X8.MissingDataDependencyBlock,values:{blockId:t.blockPointer.id}};break;case s().uW.MissingDataDependencyPerson:o={...r().X8.MissingDataDependencyPerson,values:{personId:t.personPointer.id}};break;case s().uW.MemberPropertyMismatchCollection:o=r().X8.MemberPropertyMismatchCollection;break;case s().uW.MissingPropertyOnSchemaForMemberProperty:o=r().X8.MissingPropertyOnSchemaForMemberProperty;break;case s().uW.UnaryMinusOnNonNumber:o={...r().X8.UnaryMinusOnNonNumber,values:{expressionType:c(t.expressionType)}};break;case s().uW.UnexpectedRecoveryNode:o=r().X8.UnexpectedRecoveryNode;break;case s().uW.UnexpectedError:o=r().X8.UnexpectedError;break;case s().uW.DepthExceeded:o=r().X8.DepthExceeded;break;case s().uW.CycleDetected:o=r().X8.CycleDetected;break;case s().uW.DownstreamParseFailure:o=r().X8.DownstreamParseFailure;break;case s().uW.MaxEvaluationTimeExceeded:o=r().X8.MaxEvaluationTimeExceeded;break;case s().uW.MissingSchemaPropertyOnCollection:o={...r().X8.MissingSchemaPropertyOnCollection,values:{collectionId:t.collectionId,propertyName:t.property}};break;case s().uW.ContextVariableWrongType:o={...r().X8.ContextVariableWrongType,values:{expectedType:t.expectedType,propertyType:t.resultType,valueId:t.valueId}};break;case s().uW.DisallowedValueType:{const n=t.allowedValueTypes.map((t=>e.formatMessage((0,a().getHumanReadableType)(t)).toLocaleLowerCase()));o={...r().Xz.DisallowedReturnType,values:{allowedValueType:e.formatList(n,{style:"long",type:"conjunction"}),allowedValueTypeCount:t.allowedValueTypes.length,valueType:e.formatMessage((0,a().getHumanReadableValueType)(t.expressionValue)).toLocaleLowerCase()}};break}default:(0,i().HB)(t)}return(0,l().li)(t)?{...o,values:{...o.values,startOffset:t.node.startOffset,endOffset:t.node.endOffset+1}}:o}function g(e){const t=null==e?void 0:e.values;return[n().cJ(e,"values"),t]}function f(e){return e.type===s().uW.DepthExceeded||e.type===s().uW.CycleDetected||e.type===s().uW.MaxEvaluationTimeExceeded||e.type===s().uW.LibraryFunctionExecutionError}},591197:(e,t,o)=>{o.d(t,{VY:()=>s,ZJ:()=>a,u3:()=>r});var n=()=>o(496506);class i extends(()=>o(757695))().default{getInitialState(){return{popupRenderedInPage:!1,popupRenderedInPeekView:!1}}}const a=new i,r=new(n().default)((()=>!1!==a.state.popupRenderedInPage),{debugName:"AssistantWriterRenderedInPageStore"}),s=new(n().default)((()=>!1!==a.state.popupRenderedInPeekView),{debugName:"AssistantWriterRenderedInPeekViewStore"})},592968:(e,t,o)=>{o.d(t,{F:()=>i});class n extends(()=>o(757695))().default{getInitialState(){return{isOpen:!1}}}const i=new n},603815:(e,t,o)=>{o.d(t,{A$:()=>k,JQ:()=>T,Vn:()=>C,s4:()=>M});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949),o(581454);var n=()=>o(857639),i=()=>o(585515),a=()=>o(577449),r=()=>o(388821),s=()=>o(179034),l=()=>o(545285),c=()=>o(534177),d=()=>o(449506),u=()=>o(780054),p=()=>o(989423),m=()=>o(870618),g=()=>o(303626),f=()=>o(14307),y=()=>o(245865),h=()=>o(540758),v=()=>o(670631),b=()=>o(508496),x=()=>o(571963),S=()=>o(603815),A=()=>o(108944);async function C(e){const{environment:t,request:o,abortSignal:n,prefetchCacheKey:i,headers:a}=e;return(0,x().updateLoadCachedPageChunkCalledAt)(),f().isConnected()||f().isConnecting()?d().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:i,headers:a}):d().callApi({eventName:"loadPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:i,headers:a})}async function M(e){const{mode:t,environment:o,request:c,isFirstChunk:d,abortSignal:f}=e,y={...c,limit:30,cursor:c.cursor||{stack:[]},baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await S().A$(o,{id:c.page.id,table:s().ev}),null!=f&&f.aborted))throw new Error("Abort signal received");const b=r().RecordMapWithRole.create(),x=[];let A=!1;const C=new Set,M=await i().T(y,a().h.fromMonomorphicFunctionUnsafe((async e=>{const n=await m().h7({environment:o,pointer:e,abortSignal:f,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=f&&f.aborted)throw new Error("Abort signal received");if(n)return b.setModelAndRole(e,n.model,n.role),n.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,l().u)(e)&&!C.has(e.id)&&d){if(void 0===v().A.state.offlinePages)return x.push(e),void(A=!0);if(void 0===v().A.state.offlinePages||!h().Bd(c.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);x.push(e)}})),((e,t,o,n)=>{g().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${o})`),null!=n&&n.suppressErrorOnClient&&C.add(t.id)}));if(A&&(await v().A.waitUntil((()=>void 0!==v().A.state.offlinePages)),!h().Bd(c.page.id))){const[e]=x;throw new Error(`Record not found: ${e.table},${e.id}`)}if(x.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:o,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&n().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:c.page.id,missingRecords:x}})})),null!=f&&f.aborted)throw new Error("Abort signal received");return{recordMap:b.toJson(),cursor:M.cursorValue}}async function k(e,t){const o=e.currentUser.id;if(!o||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:o})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),y().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function T(e){if(!b().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=r().RecordMapPolymorphic.create();let o=0;const n=()=>o>=50,i=e=>{"space"!==(null==e?void 0:e.table)&&(n()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),o++))};if(e.isReady())for(const r of(0,A().E)(e))i(r);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);i(t.getModel({table:"notion_user",id:e.userId}));let o=0;for(const e of t.getPointersByTable("notion_user")){if(n()||o>=10)break;o++,i(t.getModel(e))}}const a=Array.from(t).map((e=>{let{pointer:t,value:o}=e;if(void 0!==o)return{pointer:t,version:o}})).filter(c().O9);return a.length?a:void 0}},617668:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,plusIcon:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10.625 3.75a.625.625 0 1 0-1.25 0v5.625H3.75a.625.625 0 1 0 0 1.25h5.625v5.625a.625.625 0 1 0 1.25 0v-5.625h5.625a.625.625 0 1 0 0-1.25h-5.625z"})},i=(0,o(340498).wt)("plus",n)},636740:(e,t,o)=>{function n(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:n}=e;n.dateRangeStartStore.setState(t),n.dateRangeEndStore.setState(o)}o.d(t,{r:()=>n})},642054:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("addPage",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 0c3.861 0 7 3.139 7 7s-3.139 7-7 7-7-3.139-7-7 3.139-7 7-7zM3.561 5.295a1.027 1.027 0 1 0 2.054 0 1.027 1.027 0 0 0-2.054 0zm5.557 1.027a1.027 1.027 0 1 1 0-2.054 1.027 1.027 0 0 1 0 2.054zm1.211 2.816a.77.77 0 0 0-.124-1.087.786.786 0 0 0-1.098.107c-.273.407-1.16.958-2.254.958-1.093 0-1.981-.55-2.244-.945a.788.788 0 0 0-1.107-.135.786.786 0 0 0-.126 1.101c.55.734 1.81 1.542 3.477 1.542 1.668 0 2.848-.755 3.476-1.541z"})})},644484:(e,t,o)=>{o.d(t,{g:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("addPerson",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M9.48242 7.91211C10.8076 7.91211 11.8352 6.77783 11.8352 5.35718C11.8352 4.00391 10.7908 2.84717 9.48242 2.84717C8.17407 2.84717 7.12964 4.00952 7.13525 5.36279C7.14087 6.77783 8.16284 7.91211 9.48242 7.91211ZM9.48242 8.87231C8.7356 8.87231 8.04492 8.99585 7.44409 9.22046C8.23022 9.95044 8.72437 10.9836 8.72437 12.1235C8.72437 12.511 8.66821 12.8872 8.55591 13.2466H12.8684C13.969 13.2466 14.3171 12.8479 14.3171 12.2302C14.3171 10.804 12.3967 8.87231 9.48242 8.87231ZM4.74316 15.1895C6.42212 15.1895 7.80347 13.7969 7.80347 12.1235C7.80347 10.4558 6.42212 9.06885 4.74316 9.06885C3.06982 9.06885 1.68286 10.4558 1.68286 12.1235C1.68286 13.7969 3.06982 15.1895 4.74316 15.1895ZM4.74316 14.1675C4.41187 14.1675 4.18726 13.9429 4.18726 13.6172V12.6907H3.27197C2.94629 12.6907 2.72168 12.4661 2.71606 12.1292C2.71045 11.7979 2.93506 11.5732 3.27197 11.5732H4.18726V10.6636C4.18726 10.3379 4.41187 10.1133 4.74316 10.1077C5.08008 10.1021 5.30469 10.3267 5.30469 10.6636V11.5732H6.22559C6.55127 11.5732 6.77588 11.7979 6.77588 12.1292C6.77588 12.4661 6.55127 12.6907 6.22559 12.6907H5.30469V13.6172C5.30469 13.9429 5.08008 14.1675 4.74316 14.1675Z"})})},654734:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=()=>o(869190),a=()=>o(604995),r=()=>o(416504),s=o(474848);const l=function(e){const t=(0,o(959013).tz)(),l=(0,o(401497).DP)(),u=(0,o(396182).I)(),p=(0,n.useRef)(),m=(0,n.useCallback)((()=>{const t=e.value;if(!t)return;const n=a().q8(t,(0,r().P)());if(!n)return;const i=n.valueOf(),s=i-Date.now();s<0||s>o(720665).nD||p.current&&p.current.timestamp===i||(p.current&&clearTimeout(p.current.timer),p.current={timestamp:i,timer:setTimeout((()=>u("DateBox","DateBox/createReminderTimer")),s)})}),[u,e.value]),g=(0,n.useCallback)((()=>{p.current&&(clearTimeout(p.current.timer),p.current=void 0)}),[]);(0,n.useEffect)((()=>{m()}),[m]),(0,n.useEffect)((()=>()=>{g()}),[g]);const{value:f,withComma:y}=e,h=(0,o(847249).K8)((()=>f?(0,i().ZF)({value:f,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,r().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:e.shortenDateAndRange,displayInUserTimezone:e.displayInUserTimezone,getToday:o(838924).x1}):void 0),[t,e.dateFormat,e.displayInUserTimezone,e.shortenDateAndRange,e.timeFormat,f]);if(!f)return null;const v=a().AA(f,(0,r().P)(),o(662303).locale);let b;if(f.reminder){const e=a().Zs(f,(0,r().P)());b=e?{color:l.errorText}:{color:o(100622).Ay.blue}}const x=(0,s.jsxs)(s.Fragment,{children:[h,f.reminder&&(0,o(599987).P)({display:"inline-block",width:"1em",marginLeft:6,marginRight:2,paddingBottom:4,verticalAlign:"middle"}),y?", ":null]});return e.disableTooltip?(0,s.jsx)("div",{className:e.className,style:{...e.style,...b},children:x}):(0,s.jsx)(o(859428).A,{renderTooltip:()=>(0,s.jsxs)(s.Fragment,{children:[e.tooltipHeader,(0,s.jsxs)("div",{style:d(l,e.tooltipHeader),children:[c(v.start),v.end?` → ${c(v.end)}`:""]})]}),render:t=>(0,s.jsx)("div",{className:e.className,style:{...e.style,...b},...t,children:x}),placement:e.tooltipPlacement})};function c(e){return(0,i().eV)({value:e,preset:"medium"})}function d(e,t){return t?{color:e.text.contrastSecondary}:{}}},655923:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10.625 3a.625.625 0 1 0-1.25 0v12.491l-4.333-4.333a.625.625 0 1 0-.884.884l5.4 5.4a.62.62 0 0 0 .884 0l5.4-5.4a.625.625 0 0 0-.884-.884l-4.333 4.333z"})},i=(0,o(340498).wt)("arrowStraightDown",n)},665579:(e,t,o)=>{o.d(t,{$E:()=>I,$L:()=>s,BZ:()=>d,EC:()=>g,EI:()=>x,E_:()=>T,Ed:()=>p,Fq:()=>h,Lu:()=>A,Mk:()=>m,O0:()=>k,UO:()=>j,V$:()=>M,VQ:()=>f,Xx:()=>S,Xy:()=>c,YS:()=>y,_g:()=>b,dd:()=>u,pW:()=>l,q3:()=>r,wH:()=>a});var n=()=>o(496603),i=()=>o(534177);const a=160,r=40,s=24,l=20,c=600,d=270,u=405,p=480,m=500,g=void 0,f=16,y=10,h=8,v=(o(69447).nh,{backdropFilter:"blur(48px)",WebkitBackdropFilter:"blur(48px)"}),b=4;function x(e){return{icon:e.mediumIconColor,text:e.text.secondary}}function S(e){return{width:48,height:48,fill:e.lightIconColor}}function A(e){let{theme:t,isPhone:o}=e;return o?t.personalHomeBackgroundPhone:t.surface.page}const C=1;function M(e){let{isPhone:t,theme:o}=e;return{zIndex:1,position:"relative",display:"flex",flexDirection:"column",borderRadius:12,background:o.home.tile.background,boxShadow:T({isPhone:t,theme:o}),...v}}function k(e){let{mode:t}=e;switch(t){case"dark":return 0;case"light":return C;default:return(0,i().ub)(t),0}}function T(e){let{isPhone:t,theme:o,borderOnly:i}=e;if("dark"===o.mode)return"unset";o.mode;const a=k({mode:o.mode});return(0,n().oE)([i||t?void 0:"0 12px 32px rgba(0, 0, 0, 0.02)",`0 0 0 ${a}px rgba(0, 0, 0, 0.05)`]).join(", ")}function I(e){return{display:"flex",flexDirection:"column",width:"100%",gap:24}}function j(e){const{isPhone:t,theme:o,borderOnly:n}=e;return{unhoveredBoxShadow:T({isPhone:t,theme:o,borderOnly:n}),hoveredBoxShadow:"light"===o.mode?["0 12px 32px rgba(0, 0, 0, 0.03)","0 0 0 1px rgba(0, 0, 0, 0.085)"].join(", "):o.homeShadow.card.hovered}}},673724:(e,t,o)=>{o.d(t,{I:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("loop",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M5.80371 3.12305C5.81006 3.50391 6.05762 3.74512 6.47656 3.74512H11.3643C11.9546 3.74512 12.2783 4.0498 12.2783 4.66553V11.2925L11.377 10.3149L10.8628 9.80078C10.5962 9.54688 10.2344 9.52783 9.96777 9.78809C9.71387 10.0483 9.72021 10.4229 9.98047 10.6831L12.145 12.8413C12.6211 13.311 13.167 13.311 13.6431 12.8413L15.8076 10.6831C16.0679 10.4229 16.0742 10.0483 15.8203 9.78809C15.5537 9.52783 15.1919 9.54688 14.9253 9.80078L14.4111 10.3149L13.5161 11.2861V4.56396C13.5161 3.20557 12.8052 2.50098 11.4341 2.50098H6.47656C6.05762 2.50098 5.79736 2.74219 5.80371 3.12305ZM0.186035 7.05859C0.446289 7.3252 0.808105 7.30615 1.07471 7.0459L1.59521 6.53809L2.48389 5.56689V12.2891C2.48389 13.6475 3.19482 14.3521 4.56592 14.3521H9.52344C9.94238 14.3521 10.2026 14.1108 10.1963 13.73C10.1899 13.3428 9.94238 13.1079 9.52344 13.1079H4.64209C4.05176 13.1079 3.72803 12.7969 3.72803 12.1812V5.5542L4.62305 6.53809L5.14355 7.0459C5.40381 7.30615 5.77197 7.3252 6.03223 7.05859C6.29248 6.79834 6.28613 6.43018 6.01953 6.16992L3.85498 4.01172C3.37891 3.53564 2.83936 3.53564 2.36328 4.01172L0.19873 6.16992C-0.0678711 6.43018 -0.0742188 6.79834 0.186035 7.05859Z"})})},701545:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("checkMarkLine",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M6.79297 13.2871C6.48047 13.2871 6.21484 13.1523 5.99609 12.8828L2.96094 9.14453C2.875 9.04297 2.8125 8.94336 2.77344 8.8457C2.73828 8.74805 2.7207 8.64648 2.7207 8.54102C2.7207 8.30664 2.79883 8.11328 2.95508 7.96094C3.11133 7.80859 3.30859 7.73242 3.54688 7.73242C3.81641 7.73242 4.04297 7.84766 4.22656 8.07812L6.76953 11.3008L11.7324 3.4375C11.834 3.28125 11.9395 3.17188 12.0488 3.10938C12.1582 3.04297 12.2949 3.00977 12.459 3.00977C12.6973 3.00977 12.8926 3.08398 13.0449 3.23242C13.1973 3.38086 13.2734 3.57031 13.2734 3.80078C13.2734 3.89453 13.2578 3.98828 13.2266 4.08203C13.1953 4.17578 13.1465 4.27344 13.0801 4.375L7.5957 12.8594C7.4082 13.1445 7.14062 13.2871 6.79297 13.2871Z"})})},709687:(e,t,o)=>{o.d(t,{r:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("bell",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M1.36914 11.7627C1.36914 12.3369 1.80664 12.7266 2.51074 12.7266H5.32031C5.38184 14.0322 6.44824 15.2285 8 15.2285C9.55176 15.2285 10.6182 14.0391 10.6797 12.7266H13.4893C14.2002 12.7266 14.6309 12.3369 14.6309 11.7627C14.6309 11.0381 13.9678 10.416 13.3457 9.81445C12.8672 9.34277 12.751 8.39941 12.6621 7.46289C12.5732 4.87207 11.8213 3.14258 10.0371 2.49316C9.77734 1.59082 9.01855 0.900391 8 0.900391C6.98145 0.900391 6.22266 1.59082 5.96289 2.49316C4.17871 3.14258 3.42676 4.87207 3.33789 7.46289C3.24902 8.39941 3.13965 9.34277 2.6543 9.81445C2.03906 10.416 1.36914 11.0381 1.36914 11.7627ZM3.00293 11.4756V11.3936C3.18066 11.1953 3.57715 10.833 3.91211 10.4434C4.38379 9.90332 4.60254 8.92578 4.6709 7.62695C4.75293 4.85156 5.60059 3.92871 6.70801 3.62793C6.87207 3.58691 6.96777 3.50488 6.98145 3.32031C7.01562 2.62305 7.39844 2.1582 8 2.1582C8.60156 2.1582 8.99121 2.62305 9.01855 3.32031C9.03223 3.50488 9.12793 3.58691 9.29883 3.62793C10.3994 3.92871 11.2539 4.85156 11.3291 7.62695C11.3975 8.92578 11.623 9.90332 12.0879 10.4434C12.4297 10.833 12.8125 11.1953 12.9834 11.3936V11.4756H3.00293ZM6.6123 12.7266H9.3877C9.33984 13.5811 8.7793 14.1348 8 14.1348C7.22754 14.1348 6.66699 13.5811 6.6123 12.7266Z"})})},721479:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,questionMarkCircleSmallIcon:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.98 4.456c-1.044 0-2.053.604-2.298 1.584a.575.575 0 1 0 1.116.279c.083-.334.513-.713 1.183-.713.79 0 1.204.49 1.204.85 0 .219-.134.47-.443.658l-.011.006-.67.458-.003.002a1.82 1.82 0 0 0-.803 1.488.575.575 0 1 0 1.15 0c0-.193.102-.4.306-.541l.642-.44c.554-.342.982-.92.982-1.63 0-1.22-1.179-2-2.354-2m-.118 5.688a.775.775 0 1 0 0 1.55.775.775 0 0 0 0-1.55"}),(0,n.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},a=(0,o(340498).wt)("questionMarkCircleSmall",i)},725649:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function i(e){if(!e||!("askUserToPick"in e))return e}function a(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>i,K$:()=>n,j6:()=>a})},736767:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(296540),i=o(474848);function a(e,t){return(0,i.jsx)(o(678553).Ay,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const r=(0,n.forwardRef)(a)},755535:(e,t,o)=>{o.d(t,{A:()=>v});o(581454);var n=o(296540),i=()=>o(484714),a=()=>o(847249),r=()=>o(401497),s=()=>o(668725),l=()=>o(722872);class c extends(()=>o(757695))().default{getInitialState(){return{}}}const d=c;var u=()=>o(493823),p=()=>o(406699),m=()=>o(113474),g=()=>o(928600),f=()=>o(939740),y=o(474848);function h(e,t){let{isMenuItem:i,style:s,labelStyle:l,alignmentToOrigin:c,renderMenuSections:u,label:p,selectedTitle:m,focused:g,disabled:f,innerButtonStyle:h,buttonPopupStore:v,downIconStyle:x}=e;const C=(0,r().DP)(),M=(0,a().uB)(void 0,d),k=(0,a().uB)(v,o(463830).A);return(0,n.useImperativeHandle)(t,(()=>({closeMenu:()=>{k.setState({...k.state,open:!1})}})),[k]),i?(0,y.jsx)(A,{alignmentToOrigin:c,isMenuItem:i,renderMenuSections:u,buttonPopupStore:k,SelectButtonStore:M,renderOrigin:e=>(0,y.jsx)(b,{events:e,style:s,isMenuItem:i,label:p,selectedTitle:m,focused:g,disabled:f})}):(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",height:32,...s},children:[p&&(0,y.jsx)("div",{style:{marginRight:"auto",color:C.text.tertiary,fontSize:14,...l},children:p}),(0,y.jsx)(A,{alignmentToOrigin:c,isMenuItem:i,renderMenuSections:u,buttonPopupStore:k,SelectButtonStore:M,renderOrigin:e=>(0,y.jsx)(S,{events:e,innerButtonStyle:h,disabled:f,selectedTitle:m,downIconStyle:x})})]})}const v=n.forwardRef(h);function b(e){let{events:t,style:o,isMenuItem:n,label:i,selectedTitle:a,focused:r,disabled:s}=e;if(n){const e=i?{title:i,right:a}:{title:a};return(0,y.jsx)(m()._,{...t,focused:Boolean(r),disabled:s,style:o,...e})}return null}function x(e){let{downIconStyle:t}=e;const{device:o}=(0,i().v3)(),n=(0,r().DP)();return(0,y.jsx)(y.Fragment,{children:(0,s().b)({width:o.isMobile?14:10,marginLeft:4,fill:n.lightIconColor,...t})})}function S(e){let{events:t,innerButtonStyle:o,downIconStyle:n,disabled:i,selectedTitle:a}=e;return(0,y.jsxs)(u().p,{disabled:i,disabledFeedback:!0,style:{marginRight:-6,...o},...t,children:[a,(0,y.jsx)(x,{downIconStyle:n})]})}function A(e){let{renderOrigin:t,alignmentToOrigin:o,isMenuItem:n,renderMenuSections:a,buttonPopupStore:r,SelectButtonStore:s}=e;const c=(0,i().v3)(),{device:d}=c;return(0,y.jsx)(p().Ay,{popupType:d.isMobile?p().z7.SlideUp:p().z7.Popup,buttonPopupStore:r,alignmentToOrigin:void 0!==o?o:p().yP.End,renderOrigin:t,placementToOrigin:n?p().sx.Right:p().sx.Bottom,render:e=>{let t;t=d.isMobile?{menuType:l().gu.ActionSheet}:{menuType:l().gu.Popup};const{focusedIndex:o,menuSections:n}=function(e,t,o){let n,i=0;const a=t(e).map((e=>({...e,items:e.items.map((e=>(e.key===o.state.selectedKey&&(n=i),i++,{...e,action:t=>{e.action(t),function(e,t){t.setState({selectedKey:e})}(e.key,o)}})))})));return{menuSections:a,focusedIndex:n}}(e,a,s);return(0,y.jsx)(g().A,{...t,children:(0,y.jsx)(f().Ay,{type:f().Oh.Vertical,initialFocus:o,sections:n})})}})}},770586:(e,t,o)=>{o.d(t,{v:()=>n});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(908872);function n(e,t){const o=e.reduce(((e,t)=>{if(t.isType("define_variables")){var o;const n=null===(o=t.getModel())||void 0===o?void 0:o.getVariables();if(n)for(const t of Object.values(n))e.add(t.name)}return e}),new Set),n=t.replace(/\s*\d+$/,"");let i=1,a=`${n} ${i}`;for(;o.has(a);)a=`${n} ${i}`,i++;return a}},774256:(e,t,o)=>{o.d(t,{z:()=>s});o(296540);var n=()=>o(484714),i=()=>o(401497),a=()=>o(449552),r=o(474848);function s(e){const{children:t,icon:o}=e,s=function(){const{isMobile:e}=(0,n().Y0)();return(0,i().IS)((t=>({iconWrap:{flexGrow:0,flexShrink:0},messageWrap:{flexGrow:1},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGraySecondary,borderRadius:4,height:20,padding:2,width:20},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},wrap:{alignItems:"center",display:"flex",flexDirection:"row",marginBottom:6,gap:10},wrapWrap:{padding:e?"0 12px 12px":"0 0 6px 0"}})),[e])}();return(0,r.jsx)("div",{style:s.wrapWrap,children:(0,r.jsxs)("div",{style:s.wrap,children:[(0,r.jsx)("div",{style:s.iconWrap,children:(0,r.jsx)("div",{style:s.lockedIconWrap,children:o||(0,a().g)(s.lockedIcon)})}),(0,r.jsx)("div",{style:s.messageWrap,children:(0,r.jsx)("p",{style:s.paragraph,children:t})})]})})}},811979:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),i=()=>o(847249),a=()=>o(592678),r=o(474848);function s(e,t){const{onClose:s,persistOnClose:l,render:u,stopClickPropagation:p,onClick:m,disablePopup:g,disabled:f,forceInitialInbound:y,renderOrigin:h,originGap:v,borderRadius:b,popupWrapStyle:x}=e,S=(0,i().uB)(e.buttonPopupStore,o(463830).A);(0,n.useEffect)((()=>()=>{S.setState({open:!1})}),[S]);const A=(0,n.useCallback)((()=>c(s,l,S)),[s,l,S]),C=(0,n.useCallback)((()=>(0,r.jsx)(d,{onClose:s,persistOnClose:l,render:u,buttonPopupStore:S})),[s,l,u,S]),M=(0,n.useCallback)((e=>function(e,t,o,n,i){t&&(null==e||e.stopPropagation());if(e&&a().Vt(e))return;o&&o(e);n||i.setState({...i.state,open:!0})}(e,p,m,g,S)),[p,m,g,S]),k=(0,i().K8)((()=>h({...e,onClick:f?o(496603).D_:M})),[f,M,e,h]),T=(0,i().K8)((()=>S.state.open),[S]);return(0,r.jsx)(o(897119).Ay,{ref:t,...e,forceInitialInbound:Boolean(y),render:C,open:T,onDismiss:A,origin:k,originGap:v,borderRadius:b,popupWrapStyle:x,trapFocus:!0})}const l=n.forwardRef(s);function c(e,t,o){e&&e(),t||o.reset()}function d(e){let{onClose:t,persistOnClose:o,render:a,buttonPopupStore:s}=e;const l=(0,n.useCallback)((()=>c(t,o,s)),[t,o,s]),d=(0,i().K8)((()=>a({close:l})),[a,l]);return(0,r.jsx)(r.Fragment,{children:d})}},820579:(e,t,o)=>{o.d(t,{f:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10 2.4c.345 0 .625.28.625.625v9.966l3.333-3.333a.625.625 0 1 1 .884.884l-4.4 4.4a.625.625 0 0 1-.884 0l-4.4-4.4a.625.625 0 0 1 .884-.884l3.333 3.333V3.025c0-.345.28-.625.625-.625M4.15 16.35a.625.625 0 1 0 0 1.25h11.7a.625.625 0 0 0 0-1.25z"})},i=(0,o(340498).wt)("arrowLineDown",n)},824160:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(484714),i=()=>o(401497),a=()=>o(704152),r=o(474848);function s(e){const t=(0,n().Y0)(),o=(0,i().IS)((e=>({sharedStyle:{display:"flex",alignItems:"center",borderRadius:4},innerStyle:{padding:"2px 6px",borderRadius:4,color:e.text.secondary,background:e.defaultBadgeBackground,fontSize:t.isMobile?11:9,lineHeight:t.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",whiteSpace:"nowrap"}})),[t.isAndroid,t.isMobile]);return t.isMobile?(0,r.jsx)(a().A,{style:{...o.sharedStyle,...e.mobileStyle},disabled:void 0===e.onClick,children:(0,r.jsx)("div",{style:{...o.innerStyle,...e.innerStyle},children:e.children})}):(0,r.jsx)(a().A,{style:{...o.sharedStyle,...e.desktopStyle},disabled:void 0===e.onClick,...e,children:(0,r.jsx)("div",{style:{...o.innerStyle,...e.innerStyle},children:e.children})})}},826352:(e,t,o)=>{o.d(t,{j:()=>u});o(296540);var n=()=>o(401497),i=()=>o(959013),a=()=>o(284371),r=()=>o(84817),s=()=>o(493823),l=()=>o(546461),c=o(474848);const d=(0,i().YK)({automationRequiresSubscription:{defaultMessage:"To edit or run this automation, upgrade your plan.",id:"AutomationHeaderView.automationRequiresSubscription"},automationRequiresSubscriptionButton:{defaultMessage:"To edit or run this automation, upgrade your plan or remove any connected action steps.",id:"AutomationHeaderView.automationRequiresSubscriptionButton"},automationRequiresSubscriptionTitle:{defaultMessage:"Upgrade to use connected actions",id:"AutomationHeaderView.automationRequiresSubscriptionTitle"},automationRequiresSubscriptionUpgradeButton:{defaultMessage:"Upgrade",id:"AutomationHeaderView.automationRequiresSubscriptionUpgradeButton"}});function u(e){const{onUpsellClick:t}=e,{contextType:o}=(0,l().EC)(),u="button_block"===o||"button_property"===o,p=u?d.automationRequiresSubscriptionButton:d.automationRequiresSubscription,m=(0,n().IS)((e=>({wrap:{fontSize:14,background:e.surface.wash,border:`1px solid ${e.surface.wash}`,borderRadius:6,padding:12,marginBottom:12},button:{fontWeight:a().Wy.medium,borderRadius:6,border:`1px solid ${e.stroke.primary}`,alignSelf:"flex-start"},title:{color:e.text.primary,fontWeight:a().Wy.medium,margin:0},text:{color:e.text.secondary,margin:0}})),[]);return(0,c.jsxs)(r().Y1,{direction:"vertical",gap:4,style:m.wrap,children:[u&&(0,c.jsx)("p",{style:m.title,children:(0,c.jsx)(i().sA,{...d.automationRequiresSubscriptionTitle})}),(0,c.jsx)("p",{style:m.text,children:(0,c.jsx)(i().sA,{...p})}),(0,c.jsx)(s().p,{onClick:t,style:m.button,children:(0,c.jsx)(i().sA,{...d.automationRequiresSubscriptionUpgradeButton})})]})}},828973:(e,t,o)=>{o.d(t,{A:()=>p});o(898992),o(672577),o(581454);var n=o(296540),i=()=>o(847249),a=()=>o(496603),r=()=>o(406699),s=()=>o(939740),l=()=>o(897119),c=()=>o(89924),d=()=>o(722872),u=o(474848);const p=function(e){let{icon:t,iconStyle:p,title:m,selectedKey:g,onChange:f,onClick:y,popupStyle:h,menuItemOptionsStyle:v,menuStyle:b,disabled:x,collectionContextStore:S,openButtonPopup:A,hideCheck:C,children:M,disableParentClose:k,inputPlaceholder:T,...I}=e;const j=(0,o(484714).Y0)(),w="options"in I?I.options:a().Bq(I.sections),P=w.find((e=>a().n4(e.key,g))),_=(0,i().uB)(void 0,o(463830).A),B=(0,i().O$)(_);return(0,n.useEffect)((()=>{S&&A&&(_.setState({..._.state,open:A}),S.settingsStore.setState({...S.settingsStore.state,openButtonPopup:void 0})),P||o(857639).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(502800).convertErrorToLog)("Selected key is invalid.")})})),(0,u.jsx)(r().Ay,{popupType:j.isMobile?l().nl.SlideUp:l().nl.Popup,alignmentToOrigin:r().yP.End,placementToOrigin:r().sx.Bottom,style:h,originGap:0,buttonPopupStore:_,disabled:x,onClick:y,renderOrigin:e=>(0,u.jsx)(o(497222).A,{title:m,showChevron:!0,right:(0,u.jsx)("span",{style:o(284371).RC,children:"input"===(null==P?void 0:P.type)?P.inputValue:null==P?void 0:P.title}),rotateChevron:B.open,disabled:x,icon:t,iconStyle:p,...(0,o(553965).A)(e,I)}),render:e=>{let t;t=j.isMobile?{menuType:d().gu.ActionSheet}:{menuType:d().gu.Popup,width:250,...b};const n=(t,n)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:n,render:n=>(0,u.jsx)(o(419357).Ay,{...n,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var n;null===(n=t.onSubmit)||void 0===n||n.call(t,t.key,e,t.inputValue),e.close()},placeholder:T,isChecked:!C&&a().n4(t.key,g)}),action:()=>{}}:{key:n,render:e=>(0,u.jsx)(o(760217).A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:v,isChecked:!C&&a().n4(t.key,g)}),action:()=>{f(t.key,e),k||e.close()}},i},i="sections"in I?I.sections.map(((e,t)=>({key:t,render:e=>(0,u.jsx)(c().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:a().oE(e.map(n))}))):[{key:0,render:e=>(0,u.jsx)(c().A,{enableActionSheetTitle:!0,...e}),items:a().oE(w.map(n))}];return(0,u.jsxs)(o(928600).A,{...t,children:[(0,u.jsx)(s().Ay,{type:s().Oh.Vertical,sections:i,initialFocus:0,resetFocusOnMouseOut:!0}),M||null]})}})}},863330:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,plusSmallIcon:()=>i});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M8 2.3a.7.7 0 0 0-.7.7v4.3H3a.7.7 0 1 0 0 1.4h4.3V13a.7.7 0 1 0 1.4 0V8.7H13a.7.7 0 1 0 0-1.4H8.7V3a.7.7 0 0 0-.7-.7"})},i=(0,o(340498).wt)("plusSmall",n)},864779:(e,t,o)=>{o.d(t,{Me:()=>s,Vv:()=>i,Z3:()=>a,wI:()=>r});var n=()=>o(244641);function i(e){if("week"===e.frequency&&e.weekdays&&1===e.weekdays.length)return{weekday:e.weekdays[0],duration:e.interval}}function a(e){const{currentSprintEndDate:t,sprintSchedule:o}=e;return l({startDate:d({dateToAdjust:n().c9.fromISO(t),weekday:o.weekday,wrapForEqualDays:!0}),duration:o.duration})}function r(e){const{userTimeZone:t,sprintSchedule:o}=e;return l({startDate:n().c9.local({zone:t}),duration:o.duration})}function s(e){const{currentSprintStartDate:t,sprintSchedule:o}=e,i=d({dateToAdjust:n().c9.fromISO(t),weekday:o.weekday,wrapForEqualDays:!1}),{end_date:a}=l({startDate:i,duration:o.duration});let r=n().c9.fromISO(a);const s=n().c9.now().startOf("day");for(;r.diff(s,"days").days<0;)r=r.plus({weeks:1});return{type:"daterange",start_date:r.plus({days:1}).minus({weeks:o.duration}).toISODate(),end_date:r.toISODate()}}function l(e){const{startDate:t,duration:o}=e,n=t.plus({weeks:o}).minus({days:1});return{type:"daterange",start_date:t.toISODate(),end_date:n.toISODate()}}const c={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};function d(e){const{dateToAdjust:t,weekday:o,wrapForEqualDays:n}=e,i=u({currentWeekday:t.weekday%7,nextWeekday:c[o],wrapForEqualDays:n});return t.plus({days:i})}function u(e){const{currentWeekday:t,nextWeekday:o,wrapForEqualDays:n}=e,i="number"==typeof t?t:c[t],a="number"==typeof o?o:c[o];if(i===a)return n?7:0;let r=i,s=0;for(;r!==a;)r===c.SA?r=0:r+=1,s+=1;return s}},881254:(e,t,o)=>{o.d(t,{R:()=>P});var n=o(296540),i=()=>o(908006),a=()=>o(484714),r=()=>o(401497),s=()=>o(925907),l=()=>o(30626),c=()=>o(657222),d=()=>o(173019),u=()=>o(959013),p=()=>o(100622),m=()=>o(284371),g=()=>o(884107),f=()=>o(522945),y=()=>o(115512),h=()=>o(962730),v=()=>o(397248),b=()=>o(630116),x=()=>o(704152),S=()=>o(406699),A=()=>o(854672),C=()=>o(285790),M=()=>o(807683),k=()=>o(710149),T=()=>o(21140),I=()=>o(904694),j=()=>o(24611),w=o(474848);function P(e){const t=(0,a().v3)(),{hoverData:o,href:P,handleEditClick:_,showEditButton:B,loading:R,store:E,token:D,onDismiss:O}=e,F=(0,r().IS)((e=>({newWrapper:{width:280,flexDirection:"column",alignItems:"flex-start"},coverContainer:{width:280,height:120},contentNew:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"12px 16px",gap:12,width:280},titleAndDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,gap:2,width:248},linkTitle:{...(0,y().pA)(2),fontStyle:"normal",fontWeight:m().Wy.semibold,fontSize:14,letterSpacing:-.154,lineHeight:"143%",fontFeatureSettings:"'case' on",textOverflow:"ellipsis",color:e.text.primary},newDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,...(0,y().pA)(3),textOverflow:"ellipsis",width:248},newText:{fontSize:12,fontWeight:400,whiteSpace:"normal",wordBreak:"break-word",color:e.text.primary},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:e.lightIconColor,background:o?(0,j().FF)(t):"dark"===e.mode?e.accentColors.gray[100]:e.buttonBackground,border:o?void 0:"1px solid var(--Stroke-Deemphasized, rgba(227, 226, 224, 0.50))"},iconBoxImageStyle:{margin:1}})),[t,o]),V=(0,u().tz)(),N=(0,n.useRef)(null),L=(0,u().YK)({copyLink:{defaultMessage:"Copy link",id:"hoverPreviewOverlay.copyLink"},editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),W=(0,n.useCallback)((async()=>{await i().default.afterNextFlush();const e=await g().R.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=P;e.copyString({environment:t,stringValue:n,copiedMessage:o})}),[t,P]),z=E&&E.recordStoreUIParentStore&&E.recordStoreUIParentStore instanceof b().Bv?E.recordStoreUIParentStore:E instanceof b().Bv?E:void 0,K=(null==o?void 0:o.thumbnail_url)??((null==o?void 0:o.images)&&o.images.length>0&&o.images[0].url);return(0,w.jsxs)(T().wt,{style:F.newWrapper,children:[B&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(C().A,{onClick:W,icon:s().n,isDarkIconColor:!0,ariaLabel:V.formatMessage(L.copyLink),hasBackground:!0,style:{position:"absolute",top:8,right:8}}),(0,w.jsx)(C().A,{onClick:_,icon:d().r,isDarkIconColor:!0,ariaLabel:V.formatMessage(L.editLink),hasBackground:!0,style:{position:"absolute",top:8,right:35}})]}),D&&z&&!B&&(0,w.jsx)("div",{style:{position:"absolute",top:8,right:8},children:(0,w.jsx)(S().Ay,{popupType:S().z7.Popup,placementToOrigin:h().W.Right,alignmentToOrigin:h().C.Start,originGap:4,onClose:()=>{let e=!1;const t=N.current;t&&(e=(0,v().ux)(t.getBoundingClientRect(),f().$C.x,f().$C.y)),e||null==O||O()},renderOrigin:e=>(0,w.jsx)(x().A,{style:F.buttonStyle,...e,children:(0,l()._)({width:14,fill:o?p().Ay.white:p().Ay.uiGray})}),render:e=>(0,w.jsx)(I().A,{parentBlockStore:z,store:E,token:D,href:P,hoverData:o,onAccept:()=>e.close()})})}),K&&(0,w.jsx)(T().Ye,{style:F.coverContainer,children:(0,w.jsx)(M().Ay,{src:K,style:{width:"100%",height:"100%",left:0,top:"calc(50% - 280px/2)"}})}),(0,w.jsxs)(T().wt,{style:F.contentNew,children:[((null==o?void 0:o.title)||(null==o?void 0:o.description))&&(0,w.jsxs)(T().wt,{style:F.titleAndDescription,children:[(null==o?void 0:o.title)&&(0,w.jsx)(T().Ye,{gap:2,children:(0,w.jsx)("div",{style:F.linkTitle,children:null==o?void 0:o.title})}),(null==o?void 0:o.description)&&(0,w.jsx)(T().Ye,{gap:2,children:(0,w.jsx)("div",{style:F.newDescription,children:(0,w.jsx)("div",{spellCheck:!1,style:F.newText,children:(0,w.jsx)("div",{children:null==o?void 0:o.description})})})})]}),R?(0,w.jsx)(k().A,{style:{width:200,height:16}}):(0,w.jsxs)(T().Ye,{alignItems:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,width:205,height:16},children:[null!=o&&o.favicon_url?(0,w.jsx)(A().A,{type:"image_url",imageURL:null==o?void 0:o.favicon_url,size:16,style:F.iconBoxImageStyle}):null!=o&&o.icon_url?(0,w.jsx)(A().A,{type:"image_url",imageURL:null==o?void 0:o.icon_url,size:16,style:F.iconBoxImageStyle}):(0,w.jsx)(C().A,{icon:c().w,isDarkIconColor:!0,disabled:!0}),(0,w.jsx)("div",{style:{flexGrow:0,fontWeight:m().Wy.medium,color:"#787774",fontSize:12,...m().RC},children:(null==o?void 0:o.provider_name)||(null==o?void 0:o.link_provider)||P})]})]})]})}},890409:(e,t,o)=>{o.d(t,{Ah:()=>y,Dk:()=>m,Iv:()=>f,SF:()=>g,YO:()=>b,_f:()=>S,c_:()=>u,dW:()=>v,gW:()=>p,sp:()=>A,vN:()=>h});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var n=()=>o(496603),i=()=>o(973647),a=()=>o(534177),r=()=>o(842599),s=()=>o(977345),l=()=>o(798880),c=()=>o(919709),d=()=>o(241319);function u(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function b(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function x(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:n,getRecordModel:r,spaceId:l,value:c,featureGates:d}=e;if("formula"===c.type){if(!(0,a().O9)(c.value))return;const e=i().Q.unwrapOr(o.parseFormulaInputToAst(c.value),void 0);if(e){const i=o.addTypesToFormulaAST(e,{handleDataRequest:(0,s().zg)(r),spaceId:l,valueTypes:n,featureGates:d});return{...t.getFormulaAnalytics(e,{getRecordModel:r,typecheckContextValues:n}),formula_return_type:i.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:r,typecheckContextValues:n})}}}else{if("simple"===c.type){if(!(0,a().O9)(c.value))return;return t.getSimpleFormulaAnalytics(c.value,{getRecordModel:r,typecheckContextValues:n})}(0,a().HB)(c.type)}}function S(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g,simpleFormulasModule:f}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:s}=e,l=t.getConfig();let c,d=[];const u=null==l?void 0:l.collection,p=null==l?void 0:l.properties;if((0,a().O9)(u)&&(0,a().O9)(p)&&p.length>0){const e=r(u),g=null==e?void 0:e.getNormalizedSchema();(0,a().O9)(g)&&(d=p.map((e=>{var t;return(null===(t=g[e])||void 0===t?void 0:t.type)??"unknown"})));const f=null==l?void 0:l.values;if(n&&(0,a().O9)(f)){c=[];for(const e of p){var m;const a=null===(m=f[e])||void 0===m?void 0:m.value;if(!a)continue;const l=x({formulaAnalyticsModule:o,formulasModule:n,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:a,featureGates:s});l&&c.push(l)}}}return{automation_action_id:t.pointer.id,property_formula_stats:c,property_types:d,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:s}=e,l=t.getConfig(),c=[];if(n&&(0,a().O9)(l)&&l.text){const e=x({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:l.text,featureGates:s});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:s,featureGates:l,simpleFormulasModule:d}=e,u={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,a().O9)(p))return u;if((0,a().O9)(p.target))if("formula"===p.target.type&&(0,a().O9)(p.target.value)){if(u.targetData={type:"formula",numUserFormulaTargets:(0,c().Fbh)(p.target.value.value).length,numFormulaContextTargets:d.getReferencedContextValueIds(p.target.value).length},i){const e=x({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:s,formulaTypecheckContextValues:r,spaceId:o.spaceId,value:p.target.value,featureGates:l});e&&(u.formula_stats??=[],u.formula_stats.push(e))}}else if("property"===p.target.type&&(0,a().O9)(p.target.propertyId)&&(0,a().O9)(p.target.collectionPointer)){const e=s(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,a().O9)(t)&&(u.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,a().O9)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(u.messageCharacterCount=(0,c().FAw)(p.notification_message.value),i)){const e=x({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:s,formulaTypecheckContextValues:r,spaceId:o.spaceId,value:p.notification_message,featureGates:l});e&&(u.formula_stats??=[],u.formula_stats.push(e))}return u}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g,simpleFormulasModule:f}):t.isType("send_gmail_notification")?function(e){var t,o,i,s,d,u,p;const{automationActionModel:m,formulaAnalyticsModule:g,formulasModule:f,formulaTypecheckContextValues:y,getRecordModel:h,featureGates:v}=e,b=m.getConfig();if(!(0,a().O9)(b))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const S=Object.fromEntries(Object.entries(b||{}).map((e=>{let[t,o]=e;var n;return"formula"===(null==o?void 0:o.type)?[t,Boolean(null==o||null===(n=o.value)||void 0===n?void 0:n.value)]:"simple"===(null==o?void 0:o.type)?[t,Boolean(null==o?void 0:o.value)]:[t,Boolean(o)]}))),{to:A,cc:C,bcc:M}=b,k=[...(null==A||null===(t=A.value)||void 0===t?void 0:t.value)||[],...(null==C||null===(o=C.value)||void 0===o?void 0:o.value)||[],...(null==M||null===(i=M.value)||void 0===i?void 0:i.value)||[]],T=[...(0,c().Fbh)(k).map((e=>h({table:l().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(a().O9),...(0,r().C3)((0,c().k4p)(k))],I=n().Tr(T.map((e=>e.split("@")[1]))),j=[null===(s=b.to)||void 0===s?void 0:s.value,null===(d=b.cc)||void 0===d?void 0:d.value,null===(u=b.bcc)||void 0===u?void 0:u.value,null===(p=b.reply_to)||void 0===p?void 0:p.value,b.from_name,b.email_subject,b.email_body].map((e=>{if(f&&(0,a().O9)(e))return x({formulaAnalyticsModule:g,formulasModule:f,getRecordModel:h,formulaTypecheckContextValues:y,spaceId:m.spaceId,value:e,featureGates:v})})).filter(a().O9);return{automation_action_id:m.pointer.id,fields:S,formula_stats:j,recipient_domains:I,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:l,featureGates:c}=e,u=t.getConfig(),p=[],m=[],g=[];if((0,a().O9)(u)&&(0,a().O9)(u.target)&&(0,a().O9)(u.properties)&&u.properties.length>0){let e;if("variable"===u.target.type){const t=(0,s().y5)(u.target.id);if("action"===t.source){const t=(0,d().y)({actionModels:o,id:u.target.id}).collectionPointer;if((0,a().O9)(t)){const o=l(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,s().IV)(r,u.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,a().O9)(t.type.collection)){const o=l(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===u.target.type){const t=l(u.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,a().O9)(e)&&u.properties.forEach((o=>{const s=e[o];if((0,a().O9)(s)&&(p.push(s.type),i&&(0,a().O9)(u.values))){const e=u.values[o];if((0,a().O9)(e)&&(m.push({type:s.type,operator:e.action}),e.value)){const o=x({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:e.value,featureGates:c});o&&g.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:g,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:s}=e,l=t.getConfig(),c=[];if(n&&(0,a().O9)(l)&&l.values)for(const a of Object.values(l.values))if(a.value){const e=x({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:a.value,featureGates:s});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:u,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:g}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:void(0,a().HB)(t)}function A(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:s,featureGates:l,simpleFormulasModule:c,source:d}=e,u=[],p=t.getActionPointers().map((e=>s(e))).filter(a().O9);for(const b of t.getActionPointers()){const e=s(b);(0,a().O9)(e)&&u.push(S({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:s,featureGates:l,simpleFormulasModule:c}))}const m=[];let g,f,y;if(t.isEventType()){var h;const e=t.getEventConfiguration(),o=s(t.getParentPointer());g=t.getParentId();const n=t.getEventConfiguration();if("collection_view"===(null===(h=n.source)||void 0===h?void 0:h.type)){const e=s(n.source.pointer);y=null==e?void 0:e.parent_id,f=null==n?void 0:n.source.pointer.id}const i=null==o?void 0:o.getNormalizedSchema();if((0,a().O9)(i)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&m.push({type:"page"}),"any"===o.type)m.push({condition:"any",type:"property"});else if("none"===o.type)m.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],n=[];e.forEach((e=>{var o;const r=null===(o=i[e.property])||void 0===o?void 0:o.type;(0,a().O9)(r)&&(t.push({type:r,operator:e.filter.operator}),n.push(r))})),m.push({condition:o.type,property_configs:t,property_types:n,type:"property"})}}}else if(t.isButtonType())m.push({type:"button"});else if(t.isRecurrenceType()){var v;m.push({type:"recurrence",frequency:null===(v=t.getTrigger().recurrence)||void 0===v?void 0:v.frequency})}else(0,a().HB)(t);return{automation_actions:u,automation_id:t.id,automation_triggers:m,collection_id:g,collection_view_id:f,collection_view_block_id:y,builder_type:o,source:d}}},904694:(e,t,o)=>{o.d(t,{A:()=>b});o(944114),o(296540);var n=()=>o(484714),i=()=>o(700500),a=()=>o(925907),r=()=>o(673724),s=()=>o(919709),l=()=>o(959013),c=()=>o(443120),d=()=>o(884107),u=()=>o(246826),p=()=>o(751156),m=()=>o(722872),g=()=>o(575143),f=()=>o(928600),y=()=>o(939740),h=()=>o(89924),v=o(474848);function b(e){const{store:t,parentBlockStore:o,onAccept:b,token:x,href:S,hoverData:A}=e,C=(0,n().v3)(),M=[];return M.push({key:0,render:e=>(0,v.jsx)(h().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"copy link",render:e=>(0,v.jsx)(g().A,{...e,title:(0,v.jsx)(l().sA,{id:"linkMention.copyLink",defaultMessage:"Copy Link"}),svg:a().n}),action:async()=>{if(!t)return;if(!x)return;const e=await d().R.clipboardActions.load(),o=e.clipboardMessages.copiedLinkToClipboard,n=S;e.copyString({environment:C,stringValue:n,copiedMessage:o})}}]}),M.push({key:1,render:e=>(0,v.jsx)(h().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"convert to bookmark",render:e=>(0,v.jsx)(g().A,{...e,title:(0,v.jsx)(l().sA,{id:"linkMention.convertToBookmark",defaultMessage:"Turn into preview"}),svg:r().I}),action:()=>{t&&x&&p().createAndCommit({userAction:"LinkMentionMenu.convertToBookmark",environment:C,canUndo:!0,perform:e=>{if(A){const n=u().Wv({environment:C,type:i().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:A&&A.title?s().x9d(A.title):s().x9d(S),link:s().x9d(S),description:A&&A.description?s().x9d(A.description):void 0},format:{bookmark_cover:A.thumbnail_url,bookmark_icon:A.favicon_url?A.favicon_url:A.icon_url},transaction:e,spaceId:t.pointer.spaceId});c().ed({environment:C,parentBlockStore:o,blockStore:n,token:x,transaction:e})}else{const n=u().Wv({environment:C,type:i().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:s().x9d(S),link:s().x9d(S)},transaction:e,spaceId:t.pointer.spaceId});c().ed({environment:C,parentBlockStore:o,blockStore:n,token:x,transaction:e})}}})}}]}),(0,v.jsx)(f().A,{menuType:m().gu.Popup,children:(0,v.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:void 0,onAccept:b,sections:M,style:{paddingTop:3,paddingBottom:3}})})}},911706:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(401497),i=()=>o(30626),a=()=>o(704152),r=o(474848);function s(e){let{onClick:t,className:o,isMobile:s,style:l,onFocus:c,onBlur:d,onMouseDown:u,onMouseEnter:p,onMouseLeave:m}=e;const{buttonStyle:g,iconStyle:f}=(0,n().IS)((e=>({buttonStyle:{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,borderRadius:6,width:s?45:24,height:s?45:24,marginRight:s?-8:-6,...l},iconStyle:{width:s?18:14,height:s?18:14,fill:e.mediumIconColor}})),[s,l]);return(0,r.jsx)(a().A,{onClick:t,style:g,className:o,mobileFeedback:s,onFocus:c,onBlur:d,onMouseDown:u,onMouseEnter:p,onMouseLeave:m,children:(0,i()._)(f)})}},950914:(e,t,o)=>{o.d(t,{AL:()=>a,Q6:()=>s,vt:()=>r});o(898992),o(672577);var n=()=>o(66689),i=()=>o(254947);const a={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}};function r(e){const{eventTracker:t,properties:o}=e;t.DO_NOT_USE_commonTrackEvent({eventName:"complete_sprint_action",properties:o})}function s(e,t){var o;return null===(o=t.groups)||void 0===o||null===(o=o.find((t=>t.id===n().nl||(null==t?void 0:t.name)===i().P0||(null==t?void 0:t.name)===e.formatMessage(i().oz.statusGroupNameComplete))))||void 0===o?void 0:o.name}},972261:(e,t,o)=>{o.d(t,{Fl:()=>s,KI:()=>d,PI:()=>i,S:()=>l,Tq:()=>m,_u:()=>a,e5:()=>r,fK:()=>u,fl:()=>n,lF:()=>c});o(898992),o(672577);const n=["slack","google_drive","github","jira","sharepoint","microsoftTeams","gmail","linear"],i=["slack","googleDrive","github","jira","microsoftTeams","sharepoint","gmail","linear","web","githubCode"],a="7c57d10c-00cc-48bc-a552-fb3911dd7745",r="1031cb6c-4935-4cc1-9c08-c9a4ecaae323",s="65683ef9-c923-4a14-8c5b-bfcf591cf5a1",l="c1f230b1-6635-4ab0-a3f5-f7eb105a87c3",c="c91548d4-25d0-44a2-ab2e-19f6f0b11d96",d="1724f2a1-f543-43a7-82af-8a0f85bda112",u="07351274-83bb-4118-9f5b-9d75f0453999",p=[{regex:/https:\/\/(?<workspace>[\w-]+)\.slack\.com\/archives\/(?<channel>[^\/]+)\/p(?<timestamp>\d+)(\?thread_ts=(?<thread_ts>\d+\.\d+)&cid=(?<cid>[^\/]+))?/,type:"slack"},{regex:/https:\/\/docs\.google\.com\/(?<fileType>document|spreadsheets|presentation)\/d\/(?<fileId>[a-zA-Z0-9_-]+)(?:\/\S*)?/,type:"googleDrive"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?:blob|tree|blame)\/(?<branchName>[^\/]+)\/(?<codePath>[^#]+)(#(?<lineNumber>L\d+(?:C\d+)?(?:-L\d+)?))?/,type:"githubCode"},{regex:/https:\/\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/pull\/(?<prNumber>\d+)(\/(files|commits|checks)?)?/,type:"github"},{regex:/https:\/\/app\.graphite\.dev\/github\/pr\/(?<orgName>[^\/]+)\/(?<repoName>[^\/]+)\/(?<prNumber>\d+)(?:\/\S*)?/,type:"github"},{regex:/https:\/\/(?:[^\.]+)\.sourcegraphcloud\.com\/github\.com\/(?<orgName>[^\/]+)\/(?<repoName>[^\/@]+)(?:@(?<branchName>[a-f0-9]+))?\/-\/blob\/(?<codePath>[^?]+)\?(?<lineNumbers>L\d+|l\d+)?/,type:"githubCode"},{regex:/https:\/\/(?<site>[^/]+\.atlassian\.net).*?(?:browse\/|[?&]selectedIssue=)(?<issueKey>[A-Z0-9]+-\d+).*?/,type:"jira"}];function m(e){const t=p.find((t=>t.regex.test(e)));return(null==t?void 0:t.type)??"web"}},987017:(e,t,o)=>{o.d(t,{Ay:()=>c,Jy:()=>l,vU:()=>s});o(581454);var n=o(296540),i=()=>o(722872),a=o(474848);function r(e){let{tabs:t,selectedIndex:r,onChange:c,separatorIndexes:d,right:u,style:p,rightStyle:m,tabStyle:g,tabTitleStyle:f,selectedTabTitleStyle:y,tabBorderStyle:h,selectedTabStyle:v,readOnly:b,hideTabBorder:x,idPrefix:S,hideTabIndexes:A}=e;const C=(0,n.useContext)(i().xu),{device:M,WindowSizeStore:k}=(0,o(484714).v3)(),{safePaddingLeft:T,safePaddingRight:I}=(0,o(847249).K8)((()=>({safePaddingLeft:k.getSafePaddingLeftCSS(16),safePaddingRight:k.getSafePaddingRightCSS(16)})),[k]),j=(0,o(401497).IS)((e=>{const t={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.text.secondary,...g},o=`inset 0 -1px 0 ${e.regularDividerColor}`,n=C.menuType===i().gu.Popup,a={fontSize:16,paddingTop:2,paddingLeft:n?16:T,paddingRight:n?16:I,zIndex:2,height:44,background:e.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:x?void 0:o,...M.isMobile?a:{fontSize:14,paddingLeft:8,paddingRight:8,zIndex:1},...p},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:e.regularDividerColor},tab:t,selectedTab:{...t,position:"relative",color:e.text.primary,...v},border:{borderBottom:`2px solid ${e.text.primary}`,position:"absolute",bottom:0,left:8,right:8,...h},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:e.text.secondary,...m}}}),[C.menuType,M.isMobile,m,T,I,v,p,h,g,x]);return(0,a.jsxs)("div",{className:"hide-scrollbar",style:j.container,role:"tablist",children:[t.map(((e,t)=>{if(null!=A&&A.includes(t))return null;const i=t===r;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("div",{style:i?j.selectedTab:j.tab,children:[(0,a.jsx)(o(493823).p,{style:{...f,...i?y:{}},onClick:()=>c(t),disabled:b,mobileFeedback:M.isMobile,isLightGray:!Boolean(i),role:"tab","aria-selected":i,id:s(S,t),"aria-controls":l(S,t),children:e}),i&&(0,a.jsx)("div",{style:j.border})]},`tabButton-${t}`),d&&d.includes(t)&&(0,a.jsx)("div",{style:j.separator,className:"notranslate",children:"|"},`${t}-separator`)]},t)})),u&&(0,a.jsx)("div",{style:j.rightContainer,children:u})]})}function s(e,t){if(e)return`${e}-tab-${t}`}function l(e,t){if(e)return`${e}-tabpanel-${t}`}const c=n.memo(r)},992510:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(959013),i=()=>o(250202),a=o(474848);const r=function(e){const t=(0,o(484714).v3)(),{device:r}=t;if(r.isMobile)return e.propertySchema?(0,a.jsx)(i().G,{propertySchema:e.propertySchema,onClick:e.onClick,focused:!1,format:i().e.Name,showExtensionArrow:!e.disabled}):(0,a.jsx)(o(760217).A,{focused:!1,title:(0,a.jsx)(n().sA,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const t=e.propertySchema&&(0,a.jsx)(o(398842).mA,{propertySchema:e.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),i=(0,a.jsx)(n().sA,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return(0,a.jsx)(o(272630).A,{title:t,placeholder:i,onClick:e.onClick,disabled:e.disabled,disableMargins:e.disableMargins,desktopStyle:e.textWrapperStyle})}}}}]);