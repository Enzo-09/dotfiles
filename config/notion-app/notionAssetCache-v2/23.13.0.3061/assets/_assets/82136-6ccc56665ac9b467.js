"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[82136,97651],{3867:(e,t,o)=>{o.d(t,{cI:()=>M,mk:()=>k,w$:()=>C});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(791089),l=()=>o(974967),s=()=>o(959013),u=()=>o(496603),c=()=>o(534177),p=()=>o(284371),d=()=>o(425497),m=()=>o(399762),g=()=>o(881690),y=()=>o(496401),h=()=>o(214973),f=()=>o(741310),v=()=>o(929531),x=()=>o(529135),S=()=>o(16707),b=o(474848);function C(e){const{actionMenu:t,buttonPopupStore:o,disabled:i,onClick:u,propertySchema:c,value:d}=e,m=(0,s().tz)(),g=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...p().RC,fontWeight:p().Wy.medium}})),[]),y=(0,r().K8)((()=>k({intl:m,propertySchema:c,styles:g,value:d})),[m,c,g,d]),h=(0,r().K8)((()=>M({intl:m,propertySchema:c,value:d})),[m,c,d]),x=(0,n.useCallback)((e=>(0,b.jsx)(v().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:i,icon:l().n,onClick:u,children:(0,b.jsx)("div",{style:g.content,children:y})})),[t,o,i,u,g.content,y]);return(0,b.jsx)(f().P,{renderOrigin:x,title:h})}function A(e,t){if(!e)return[];let o=(0,i().fromSimpleFormulaArrayValue)(e).filter((e=>(0,u().Kg)(e)));return"select"===t.type&&(o=o.slice(0,1)),o}function k(e){const{intl:t,limit:o,operator:n,propertySchema:r,styles:a,tokenFormat:i,value:l}=e,u=(0,d().Ug)(i),p=(0,b.jsx)("span",{style:a.propertyName,children:r.name});if("formula"===(null==l?void 0:l.type))return(0,b.jsx)(s().sA,{...h()._M({propertyName:p,propertyValue:(0,b.jsx)(S().g,{returnType:{type:"text"}})})});const y=h().kN({limit:o,propertySchema:r,optionValues:A(null==l?void 0:l.value,r)}).map((e=>"deleted"===e.type?(0,b.jsx)(x().A,{tokenFormat:u},`missing_option_value_${e.value}`):"option"===e.type?(0,b.jsx)(m().O,{color:e.value.color,format:u,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,b.jsx)(g().A,{format:u,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,c().HB)(e)));return"replace"===n||"append"===n||"remove"===n||"toggle"===n?(0,b.jsx)(s().sA,{...h().f4({...h().f_({elements:y,intl:t}),operator:n,propertyName:p})}):0===y.length?(0,b.jsx)(s().sA,{...h().NW({propertyName:p})}):(0,b.jsx)(s().sA,{...h()._M({propertyName:p,propertyValue:y[0]})})}function M(e){const{intl:t,limit:o,propertySchema:n,value:r,operator:a}=e,i=n.name;if("formula"===(null==r?void 0:r.type))return(0,b.jsx)(s().sA,{...h()._M({propertyName:i,propertyValue:(0,b.jsx)(S().L,{})})});const l=h().kN({limit:o,propertySchema:n,optionValues:A(null==r?void 0:r.value,n)}).map((e=>"deleted"===e.type?h().iy(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,c().HB)(e)));return"replace"===a||"append"===a||"remove"===a||"toggle"===a?(0,b.jsx)(s().sA,{...h().f4({propertyName:i,propertyValue:(0,y().d)(t.formatList(l,{style:"long",type:"conjunction"})),operator:a})}):0===l.length?(0,b.jsx)(s().sA,{...h().NW({propertyName:i})}):(0,b.jsx)(s().sA,{...h()._M({propertyName:i,propertyValue:l[0]})})}},5269:(e,t,o)=>{o.d(t,{y:()=>u});var n=()=>o(847249),r=()=>o(179034),a=()=>o(534177),i=()=>o(175116),l=()=>o(108944),s=()=>o(630116);function u(e,t){const o=(0,i().Ks)();return(0,n().K8)((()=>{const n=e.getParentStore();if("button_block"===t){const t=function(e){const t=(0,l().g7)(e);for(const o of t)if(o.table===r().ev&&o.isPageBlock())return o;return}(e);return null==t?void 0:t.getAssociatedCollectionStore()}if("button_property"===t)return null==o?void 0:o.collectionStore();if("event"===t){if(n&&n instanceof s().md)return n}else{if("recurrence"===t)return;if("assistant"===t){if(n&&n instanceof s().md)return n}else(0,a().HB)(t)}}),[e,t,o])}},7868:(e,t,o)=>{o.d(t,{A:()=>C});o(944114),o(581454);var n=o(296540),r=()=>o(484714),a=(o(898992),o(354520),()=>o(401497)),i=()=>o(247331),l=()=>o(791089),s=()=>o(919709),u=()=>o(959013),c=()=>o(496603),p=()=>o(419357),d=()=>o(742971),m=()=>o(258804),g=o(474848);var y=()=>o(722872),h=()=>o(928600),f=()=>o(939740),v=()=>o(480095),x=()=>o(89924),S=()=>o(996027),b=()=>o(231713);function C(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:C,onChange:A,onClose:k,showGenericHeader:M=!1,value:j,parentRecordStore:T}=e,I=(0,r().Y0)(),{footer:P,header:w,numberInput:_,valueItems:V}=function(e){const{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,onChange:y,onClose:h,value:f}=e,v=(0,u().tz)(),{isMobile:x}=(0,r().Y0)(),S=(0,a().IS)((e=>({inputOuterStyle:{fontSize:"12px",...x?{boxShadow:"none",background:"light"===e.mode?e.white:e.selectLightGray[200],borderRadius:0,minHeight:"45px"}:{}}})),[x]),b=o.filter((e=>"number"===e.type.type)),C=(0,n.useCallback)((e=>{y({type:"simple",value:e})}),[y]),A=(0,n.useCallback)((e=>{C(e),h()}),[C,h]),k=(0,n.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],C(o)}),[C]),M=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,l().toSimpleFormulaSingleValue)(e[0]):void 0;A(t)}),[A]),j=c().oE(b.map((e=>{if(e.kind===i().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:M,value:e}}))),T=(0,n.useMemo)((()=>{const e=t[0],o="string"==typeof e?e:(0,s().q4_)(null==f?void 0:f.value);return(0,g.jsx)(p().Ay,{focusInitial:!x,onChange:k,value:o,type:"number",inputOuterStyle:S.inputOuterStyle,placeholder:v.formatMessage(d().D.propertyValuePlaceholder)})}),[t,k,v,x,S.inputOuterStyle,null==f?void 0:f.value]);return{footer:(0,g.jsx)(m().A,{value:f,onChange:y}),header:v.formatMessage(d().D.genericMenuHeader),numberInput:T,valueItems:j}}({formulaTypecheckContextValues:o,onChange:A,onClose:k,currentSimpleFormulaValueTokens:t,value:j})||{},R=(0,n.useMemo)((()=>V.map((e=>{const{annotation:t,itemAction:n}=(0,b().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,g.jsx)(S().A,{annotation:t,disabled:!1,formulaTypecheckContextValues:o,menuArgs:e,parentRecordStore:T}),action:n}}))),[o,V,T]),B=[];let E;R.length>0&&B.push({key:"textbox",render:e=>(0,g.jsx)(x().A,{...e}),items:R}),E=I.isMobile?{menuType:y().gu.Modal,minWidth:260,onClickRight:k,right:(0,g.jsx)(v().DoneMenuText,{})}:{menuType:y().gu.Popup,maxHeight:"50vh",width:260,footer:P&&(0,g.jsx)(x().A,{topBorder:!0,children:P}),disableHeaderBorder:!0};const F=M&&(0,g.jsx)(x().A,{style:{paddingBottom:0},title:w}),N=(0,g.jsxs)("div",{children:[!I.isMobile&&((null==C?void 0:C.header)||F),_]}),O=(0,g.jsx)(f().Ay,{initialFocus:0,sections:B,type:f().Oh.Vertical});return{headerDiv:N,innerComponents:O,numberMenu:(0,g.jsx)(h().A,{...E,...C,header:N,children:O})}}},16707:(e,t,o)=>{o.d(t,{L:()=>c,g:()=>u});o(296540);var n=()=>o(401497),r=()=>o(572438),a=()=>o(977345),i=()=>o(959013),l=()=>o(214973),s=o(474848);function u(e){const{returnType:t}=e,o=(0,n().DP)(),u=(0,n().IS)((e=>({iconWrap:{display:"inline-block",fill:e.icon.secondary,height:"1em",position:"relative",verticalAlign:"-0.15em",width:"1em"},icon:{width:"100%"}})),[]),c=(0,a().Ix)(t);return(0,s.jsx)(r().R,{icon:(0,s.jsx)("span",{style:u.iconWrap,children:c(u.icon)}),index:0,theme:o,children:(0,s.jsx)(i().sA,{...l().CV.inlineCustomFormulaDefaultName})})}function c(){return(0,s.jsx)(i().sA,{...l().CV.inlineCustomFormulaDefaultName})}},27511:(e,t,o)=>{o.d(t,{a:()=>b,y:()=>v});o(898992),o(354520),o(672577),o(581454),o(296540);var n=()=>o(401497),r=()=>o(289915),a=()=>o(713998),i=()=>o(784892),l=()=>o(959013),s=()=>o(534177),u=()=>o(284371),c=()=>o(399762),p=()=>o(881690),d=()=>o(496401),m=()=>o(214973),g=()=>o(529135),y=()=>o(989064),h=o(474848);const f=5;function v(e){const t=(0,l().tz)(),{filter:o,limit:n=f,propertySchema:a,onClick:i}=e,u=a.name,c=(0,r().V6)(o),p=c.map((e=>"is_group"===e.type?e.value:void 0)).filter(s().O9),d=c.map((e=>"is_option"===e.type?e.value:void 0)).filter(s().O9),m=b({intl:t,groupValues:p,limit:n,optionValues:d,propertySchema:a}),g=b({intl:t,isText:!0,groupValues:p,limit:n,optionValues:d,propertySchema:a});return(0,h.jsx)(y().z,{onClick:i,tooltip:(0,h.jsx)(S,{propertyName:u,statusValues:g}),children:(0,h.jsx)(x,{propertyName:u,statusValues:m})})}function x(e){let{propertyName:t,statusValues:o}=e;const r=(0,l().tz)(),a=(0,n().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),i=r.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)("div",{style:a.content,children:(0,m().Yx)(r,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().d)(i)})})}function S(e){let{propertyName:t,statusValues:o}=e;const r=(0,l().tz)(),a=(0,n().IS)((()=>({propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),i=r.formatList(o,{style:"long",type:"disjunction"});return(0,h.jsx)(h.Fragment,{children:(0,m().Yx)(r,{propertyName:(0,h.jsx)("span",{style:a.propertyName,children:t}),propertyValues:(0,d().d)(i)})})}function b(e){let{groupValues:t,intl:o,isText:n,limit:r,optionValues:l,propertySchema:u,tokenFormat:d=i().NY.Medium}=e;const y=u.groups||[],f=u.options||[],v=t.map((e=>{const t=y.find((t=>t.name===e));if(t)return n?t.name:(0,h.jsx)(c().q,{format:d,isSingle:!0,value:t.name,color:t.color,groupColor:null==t?void 0:t.color,showRemoveButton:!1,showEllipsis:!1},t.id)})).filter(s().O9),x=l.map((e=>{const t=(0,a().jy)(f,e);if(void 0===t)return n?(0,m().iy)(o):(0,h.jsx)(g().A,{tokenFormat:d},`missing_option_value_${e}`);if(n)return t.value;const r=y.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,h.jsx)(c().q,{format:d,isSingle:!0,value:t.value,color:t.color,groupColor:null==r?void 0:r.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),S=[...v,...x];let b=[];if(void 0!==r&&S.length>r){const e=x.length-r,t=n?`+${e}`:(0,h.jsx)(p().A,{format:i().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");b=[...x.slice(0,r),t]}else b=S;return b}},36697:(e,t,o)=>{o.d(t,{P:()=>i});o(296540);var n=()=>o(401497),r=()=>o(743176),a=o(474848);function i(e){let{style:t={},propertySchema:o}=e;const i=(0,n().DP)();return(0,a.jsx)(r().zB,{size:16,theme:i,icon:o.icon,style:{...t,overflow:"visible"},type:o.type})}},38440:(e,t,o)=>{o.d(t,{LN:()=>i,W:()=>l,lD:()=>s,zQ:()=>u});o(296540);var n=()=>o(959013),r=()=>o(214973),a=o(474848);const i={checkbox_is_not:"checkbox",checkbox_is:"checkbox",enum_contains:"multi_select",enum_does_not_contain:"multi_select",enum_contains_all:"multi_select",enum_is_not:"select",enum_is:"select",number_does_not_equal:"number",number_equals:"number",number_greater_than_or_equal_to:"number",number_greater_than:"number",number_less_than_or_equal_to:"number",number_less_than:"number",person_contains:"person",person_does_not_contain:"person",relation_contains:"relation",relation_does_not_contain:"relation",status_is_not:"status",status_is:"status",string_contains:"text",string_does_not_contain:"text",string_ends_with:"text",string_is_not:"text",string_is:"text",string_starts_with:"text"},l={phone_number:"text",title:"text",url:"text",email:"text"},s={relation:["relation"],checkbox:["checkbox"],number:["number"],person:["person"],multi_select:["multi_select"],select:["select"],status:["status"],text:["email","phone_number","text","url"]};function u(e){return(0,a.jsx)(n().sA,{...r().o7({propertyName:e.name})})}},50401:(e,t,o)=>{o.d(t,{F:()=>d});var n=o(296540),r=()=>o(401497),a=()=>o(514503),i=()=>o(959013),l=()=>o(962730),s=()=>o(285790),u=()=>o(859428),c=o(474848);const p=(0,i().YK)({simpleFormulaFormulaActionButtonAriaLabel:{id:"formulas.simpleFormulaFormulaActionButton.ariaLabel",defaultMessage:"Formulas"},simpleFormulaFormulaActionButtonFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.formula.tooltip",defaultMessage:"Edit as formula"},simpleFormulaFormulaActionButtonSimpleFormulaTooltip:{id:"formulas.simpleFormulaFormulaActionButton.simpleFormula.tooltip",defaultMessage:"Edit as text"}});function d(e){const{disabled:t,onClick:o,value:d}=e,m="formula"===(null==d?void 0:d.type),g=(0,i().tz)(),y=(0,r().IS)((e=>({formulaIcon:{fill:m?e.icon.uiBluePrimary:e.mediumIconColor,height:16,width:16},button:{height:20,width:20}})),[m]),h=(0,n.useCallback)((()=>m?g.formatMessage(p.simpleFormulaFormulaActionButtonSimpleFormulaTooltip):g.formatMessage(p.simpleFormulaFormulaActionButtonFormulaTooltip)),[g,m]),f=(0,n.useCallback)((e=>(0,c.jsx)(s().A,{...e,ariaLabel:g.formatMessage(p.simpleFormulaFormulaActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:a().n,iconStyle:y.formulaIcon,onClick:o,style:y.button})),[t,g,o,y]);return(0,c.jsx)(u().A,{renderTooltip:h,placement:l().W.Bottom,render:f})}},71634:(e,t,o)=>{o.d(t,{xB:()=>re,Kn:()=>ce,ck:()=>le,vV:()=>ie});o(898992),o(737550);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(863330),s=()=>o(340498),u=()=>o(959013),c=()=>o(534177),p=()=>o(284371),d=()=>o(406699),m=()=>o(285790),g=()=>o(8980),y=(o(354520),o(581454),()=>o(760217)),h=()=>o(89924),f=()=>o(755535),v=o(474848);function x(e){let{disabled:t,handleSelectOperator:o,selectedItem:a}=e;const l=(0,r().Y0)(),s=(0,i().IS)((e=>({buttonWrap:{height:"initial"},buttonStyle:{fontSize:l.isMobile?14:12,height:18,lineHeight:"unset",marginRight:2,marginLeft:2,paddingLeft:2,paddingRight:2,textTransform:"lowercase",fontWeight:p().Wy.semibold,...t?{opacity:"unset",color:"unset"}:{color:e.text.tertiary}},downIconStyle:{...t?{fill:"unset",opacity:"unset"}:{fill:e.text.tertiary}}})),[l.isMobile,t]),c=Object.values(b).filter((e=>e.shown)),m=(0,n.useMemo)((()=>b[a].shown?b[a]:b.all),[a]);return(0,v.jsx)(f().A,{disabled:t,alignmentToOrigin:d().yP.Start,style:s.buttonWrap,innerButtonStyle:s.buttonStyle,downIconStyle:s.downIconStyle,selectedTitle:(0,v.jsx)(u().sA,{...m.text}),renderMenuSections:e=>[{key:"selectTriggerOperator",render:e=>(0,v.jsx)(h().A,{...e}),items:c.map((t=>({key:t.value,action:()=>{o(t.value),e.close()},render:e=>(0,v.jsx)(y().A,{...e,title:(0,v.jsx)(u().sA,{...t.text})})})))}]})}const S=(0,u().YK)({all:{id:"automations.builderModal.propertyTrigger.all",defaultMessage:"All"},any:{id:"automations.builderModal.propertyTrigger.any",defaultMessage:"Any"}}),b={all:{text:S.all,value:"all",shown:!0},some:{text:S.any,value:"some",shown:!0},none:{shown:!1,value:"none"},any:{shown:!1,value:"any"}};var C=()=>o(546461),A=()=>o(656134),k=()=>o(813716),M=()=>o(142755);const j={viewBox:"0 0 20 20",svg:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 1.067 15.176 1.5 1.5 0 0 1-.315-.52l-.246-.676q-.25.02-.506.02a6.375 6.375 0 1 1 6.288-5.318l.439.222c.301.152.519.38.654.64A7.625 7.625 0 0 0 10 2.375"}),(0,v.jsx)("path",{d:"m13.684 15.203-.532-.582-.437 1.149-.32.838a.25.25 0 0 1-.468-.004L9.315 9.418a.25.25 0 0 1 .347-.308l6.501 3.285a.249.249 0 0 1-.027.458l-.534.191-1.4.505 2.852 3.12a.748.748 0 1 1-1.108 1.008l-1.413-1.545z"}),(0,v.jsx)("path",{d:"M14.75 10q0 .14-.008.276l-1.26-.637a3.5 3.5 0 1 0-4.03 3.819l.47 1.291A4.75 4.75 0 1 1 14.75 10"})]})},T=(0,s().wt)("cursorClick",j);var I=()=>o(214973),P=()=>o(997939);function w(){const e=(0,u().tz)(),{automationStore:t}=(0,C().EC)();if(!V(t))return null;const o=e.formatMessage(I().CV.triggerButtonClicked,{b:_});return(0,v.jsx)(P().X,{icon:T,tooltip:o,children:o})}function _(e){return(0,v.jsx)("span",{style:{fontWeight:p().Wy.medium},children:e})}function V(e){return(0,a().K8)((()=>Boolean(null==e?void 0:e.isTriggerType("button"))),[e])}function R(){const{automationStore:e}=(0,C().EC)(),{removePageAddedTrigger:t}=(0,k().p)(),o=(0,u().tz)(),n=(0,i().IS)((()=>({title:{fontWeight:p().Wy.medium}})),[]);if(!B(e))return null;const r=I().CH(o);return(0,v.jsx)(P().X,{icon:l().plusSmallIcon,onDelete:t,tooltip:r,children:(0,v.jsx)("div",{style:n.title,children:r})})}function B(e){return(0,a().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.pagesAdded)}),[e])}var E=()=>o(897499),F=()=>o(555005);const N={viewBox:"0 0 16 16",svg:(0,v.jsx)("path",{d:"M8.708 1.978a.625.625 0 0 0-.884.884l.914.913H3.84c-1.14 0-2.065.925-2.065 2.065v4.78a.625.625 0 0 0 1.25 0V5.84c0-.45.365-.815.815-.815h4.898l-.914.913a.625.625 0 0 0 .884.884l1.98-1.98a.625.625 0 0 0 0-.884zM13.6 4.755a.625.625 0 0 0-.625.625v4.78c0 .45-.365.815-.815.815H7.263l.913-.913a.625.625 0 0 0-.884-.884l-1.98 1.98a.625.625 0 0 0 0 .884l1.98 1.98a.625.625 0 1 0 .884-.884l-.913-.913h4.897c1.14 0 2.065-.924 2.065-2.065V5.38a.625.625 0 0 0-.625-.625"})},O=(0,s().wt)("arrowSquareLeftRightSmall",N);var D=()=>o(464708),W=()=>o(104636),L=()=>o(548526),K=()=>o(131276);function H(){const{automationStore:e}=(0,C().EC)(),{removeRecurrenceTrigger:t}=(0,k().p)(),o=(0,i().IS)((e=>({title:{fontWeight:p().Wy.medium,display:"flex",gap:6,alignItems:"center"},badgeContainer:{alignItems:"center",display:"flex"},badge:{backgroundColor:e.tint.regular,color:e.text.secondary,marginLeft:8}})),[]),n=function(e){return(0,a().K8)((()=>Boolean(null==e?void 0:e.isTriggerType("recurrence"))),[e])}(e),r=(0,a().K8)((()=>(0,W().NH)(e)),[e]);return n?(0,v.jsx)(P().X,{icon:O,onDelete:t,children:(0,v.jsxs)("div",{style:o.title,children:[(0,v.jsx)(u().sA,{id:"RecurrenceTrigger.title",defaultMessage:"<span>Every </span>{frequency}",values:{frequency:(0,v.jsx)(z,{}),span:e=>(0,v.jsx)("span",{style:{flex:0},children:e})}}),r&&(0,v.jsx)(D().A,{style:o.badge,content:(0,v.jsx)("div",{style:o.badgeContainer,children:(0,v.jsx)(u().sA,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})})]})}):null}function z(){const e=(0,u().tz)(),{isMobile:t}=(0,r().Y0)(),{automationStore:o}=(0,C().EC)(),{changeRecurrenceSchedule:n}=(0,k().p)(),i=(0,a().K8)((()=>o.getRecurrence()),[o]),l=i?(0,W().LS)({intl:e,recurrence:i}):(0,v.jsx)(u().sA,{id:"RecurrenceTrigger.frequency",defaultMessage:"frequency"}),s=(0,K().$)({recurrence:i,onChange:n,disabled:!1,autoFocusIfNew:!0});return(0,v.jsx)(d().Ay,{...s,popupType:t?d().z7.SlideUp:d().z7.Popup,placementToOrigin:d().sx.Bottom,renderOrigin:e=>(0,v.jsx)(L().x,{...e,isCompact:!0,dropdownButtonType:"dropdown",hasActionRequired:!(0,c().O9)(i),children:l})})}o(16280);var U=()=>o(181088),Y=()=>o(301948),q=()=>o(928600),$=()=>o(939740),G=()=>o(864943),Q=()=>o(722872),X=()=>o(366360),Z=()=>o(61661);const J=(0,u().YK)({hours:{defaultMessage:"hours",id:"RelativeDateTrigger.hours"},days:{defaultMessage:"days",id:"RelativeDateTrigger.days"}}),ee=["hours","days"];function te(e){let{currentValue:t,onSelect:o}=e;const n=(0,u().tz)();return(0,v.jsx)(q().A,{menuType:Q().gu.Popup,children:(0,v.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:ee.indexOf(t),sections:[{key:"main",items:ee.map((e=>({key:e,action:()=>o(e),render:t=>(0,v.jsx)(y().A,{...t,title:n.formatMessage(J[e])})}))),render:e=>(0,v.jsx)(h().A,{...e})}]})})}function oe(){const{automationStore:e,collectionStore:t}=(0,X().k)(),{disabled:o}=(0,X().b)(),{updateRelativeDateTrigger:r,removeRelativeDateTrigger:l}=(0,k().p)(),s=(0,u().tz)(),c=(0,a().K8)((()=>{var o;const n=t.getModel();if(!n||!e.isTriggerType("event"))return;const r=n.getNormalizedSchema(),a=null===(o=e.getEventConfiguration())||void 0===o||null===(o=o.relativeDate)||void 0===o?void 0:o.property;if(!a)return;const i=r[a];return i?i.name:void 0}),[e,t]),m=(0,i().IS)((e=>({container:{display:"flex",alignItems:"center",gap:8},button:{padding:"0 12px"},numberInput:{width:70},before:{color:e.text.secondary},propertyName:{fontWeight:p().Wy.medium}})),[]),g=(0,i().IS)((e=>({headerWrap:{alignItems:"center"}})),[]),y=(0,a().K8)((()=>{var t;return null!=e&&e.isTriggerType("event")?null===(t=e.getEventConfiguration())||void 0===t?void 0:t.relativeDate:null}),[e]),h=(0,n.useCallback)((e=>{if(!y)throw new Error("Relative date trigger not found");const{timeIncrement:t,timeValue:o}=e;let n;n="hours"===t?{type:"hours",hours:-o}:{type:"days",days:-o},r({propertyId:y.property,offset:n})}),[y,r]),f=(0,n.useCallback)((e=>{if(!y)throw new Error("Relative date trigger not found");void 0!==e&&h({timeIncrement:y.offset.type,timeValue:e})}),[h,y]),x=(0,a().K8)((()=>{if(!y)throw new Error("Relative date trigger not found");return-1*(("hours"===y.offset.type?y.offset.hours:y.offset.days)||0)}),[y]),S=(0,n.useCallback)((e=>{if(!y)throw new Error("Relative date trigger not found");h({timeIncrement:e,timeValue:x})}),[h,y,x]),b=(0,n.useCallback)((e=>void 0!==e&&!(e<-1e3||e>1e3)),[]);if(!ne(e)||!y)return null;const C=I().vH(s);return(0,v.jsx)(P().X,{icon:U().clockSmallIcon,onDelete:l,tooltip:C,styles:g,children:(0,v.jsxs)("div",{style:m.container,children:[(0,v.jsx)(Z().b,{style:m.numberInput,currentValue:x,onChange:f,extraValidation:b}),(0,v.jsx)(d().Ay,{popupType:d().z7.Popup,render:e=>(0,v.jsx)(te,{currentValue:y.offset.type,onSelect:t=>{S(t),e.close()}}),renderOrigin:e=>(0,v.jsx)(G().A,{...e,size:"lg",style:m.button,disabled:o,children:s.formatMessage(J[y.offset.type])}),disabled:o}),(0,v.jsx)("span",{style:m.before,children:(0,v.jsx)(u().sA,{id:"automations.RelativeDateTrigger.before",defaultMessage:"before"})}),(0,v.jsx)("span",{style:m.propertyName,children:c}),(0,v.jsx)(Y().A,{})]})})}function ne(e){return(0,a().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration();return Boolean(null==t?void 0:t.relativeDate)}),[e])}const re="automation-list-item automation-list-item-modal",ae=(0,u().YK)({newTriggerLabel:{defaultMessage:"New trigger",id:"collectionSettings.editAutomationView.triggerSection.newPlaceholder"},addTriggerLabel:{defaultMessage:"Add trigger",id:"collectionSettings.editAutomationView.triggerSection.placeholder"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},builderModalTriggerTitleWithOperatorButton:{defaultMessage:"When {operatorButton} triggers occur",id:"builderModal.editAutomationView.triggerSection.titleWithOperator"},buttonBuilderTriggerTitleOrNoTriggers:{defaultMessage:"When",id:"builderModal.editAutomationView.buttonBuilderTriggerSection.title"}});function ie(){return(0,i().IS)((e=>({wrap:{position:"relative",paddingInline:1},list:{display:"flex",flexDirection:"column"}})),[])}function le(e){const{children:t}=e;return(0,v.jsx)("div",{className:re,children:t})}function se(e){const{children:t}=e,o=ie();return(0,v.jsx)("div",{style:o.wrap,children:(0,v.jsx)("div",{style:o.list,children:t})})}function ue(e){const{variant:t,hasAnyTriggers:o}=e,r=(0,A().j)(),a=(0,u().tz)(),i=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]);return(0,v.jsx)(d().Ay,{alignmentToOrigin:d().yP.Start,placementToOrigin:d().sx.Bottom,popupType:r,render:e=>(0,v.jsx)(F().A,{initialState:i,buttonPopupParent:e}),renderOrigin:e=>"icon"===t?(0,v.jsx)(m().A,{...e,ariaLabel:a.formatMessage(o?ae.addTriggerLabel:ae.newTriggerLabel),icon:l().plusSmallIcon,iconStyle:{height:s().Ev.sm,width:s().Ev.sm}}):(0,v.jsx)(M().F,{...e,ariaLabel:a.formatMessage(ae.addTriggerAriaLabel),icon:(0,v.jsx)(g().I,{icon:l().plusSmallIcon,size:"sm"}),title:(0,v.jsx)(u().sA,{...o?ae.addTriggerLabel:ae.newTriggerLabel})})})}function ce(e){const{isEditable:t}=e,{isMobile:o}=(0,r().Y0)(),{showAnyPropertyTriggers:n,showButtonClickedTrigger:l,showPageAddedTrigger:s,showRecurrenceTrigger:c,showRelativeDateTrigger:d}=function(){const{automationStore:e}=(0,C().EC)(),t=V(e),o=B(e),n=(0,E().CD)(e),r=(0,a().K8)((()=>Boolean(e.isTriggerType("recurrence"))),[e]),i=ne(e);return{showAnyPropertyTriggers:n,showPageAddedTrigger:o,showButtonClickedTrigger:t,showRecurrenceTrigger:r,showRelativeDateTrigger:i}}(),m=n||l||s||c||d,g=!c,y=(0,i().IS)((e=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%"},header:{alignItems:"center",display:"flex",flexDirection:"row"},title:{color:e.text.tertiary,fontSize:o?14:12,lineHeight:1.3,fontWeight:p().Wy.medium}})),[o]),{contextType:h}=(0,C().EC)(),f="button_property"===h||"button_block"===h;return(0,v.jsxs)("section",{style:y.section,children:[(0,v.jsx)("header",{style:y.header,children:(0,v.jsx)("div",{style:y.title,children:f?(0,v.jsx)(u().sA,{...ae.buttonBuilderTriggerTitleOrNoTriggers}):(0,v.jsx)(pe,{disabled:!t})})}),(0,v.jsxs)(se,{children:[l&&(0,v.jsx)(w,{}),s&&(0,v.jsx)(R,{}),n&&(0,v.jsx)(E().Js,{}),d&&(0,v.jsx)(oe,{}),t&&g&&(0,v.jsx)(ue,{hasAnyTriggers:m,variant:"button"}),c&&(0,v.jsx)(H,{})]})]})}function pe(e){let{disabled:t}=e;const{automationStore:o}=(0,C().EC)(),{updateTriggerOperator:r}=(0,k().p)(),l=(0,a().K8)((()=>{if(null==o||!o.isTriggerType("event"))return"some";const e=o.getEventConfiguration();return(null==e?void 0:e.pagePropertiesEdited.type)||"all"}),[o]),s=(0,a().K8)((()=>{if(null==o||!o.isTriggerType("event"))return 0;const e=o.getEventConfiguration(),t=null==e?void 0:e.pagePropertiesEdited;return t?"any"===t.type||"none"===t.type?0:"all"===t.type?(null===(n=t.all)||void 0===n?void 0:n.length)??0:"some"===t.type?(null===(r=t.some)||void 0===r?void 0:r.length)??0:void(0,c().HB)(t):0;var n,r}),[o]),p=(0,n.useCallback)((e=>{r(e)}),[r]),d=(0,i().IS)((e=>({title:{alignItems:"center",display:"flex",flexWrap:"wrap",height:24}})),[]);return(0,v.jsx)("div",{style:d.title,children:(0,v.jsx)(u().sA,{...s>0?ae.builderModalTriggerTitleWithOperatorButton:ae.buttonBuilderTriggerTitleOrNoTriggers,values:{operatorButton:(0,v.jsx)(x,{disabled:t,handleSelectOperator:p,selectedItem:l})}})})}},79118:(e,t,o)=>{o.d(t,{Eo:()=>v,Fz:()=>m,KI:()=>l,M4:()=>u,YW:()=>b,iY:()=>C,mO:()=>g,qE:()=>c,vm:()=>h});var n=()=>o(604995),r=()=>o(247331),a=()=>o(977345);const i=(0,o(959013).YK)({buttonAutomationCurrentUserDescription:{defaultMessage:"The user who clicked this button",id:"automations.contextValue.buttonAutomationCurrentUserDescription"},buttonAutomationCurrentUserName:{defaultMessage:"Whoever clicked",id:"automations.contextValue.buttonAutomationCurrentUserName"},buttonAutomationCurrentUserTooltip:{defaultMessage:"The person who clicked the button",id:"automations.contextValue.buttonAutomationCurrentUserTooltip"},buttonAutomationThisPageDescription:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageDescription"},buttonAutomationThisPageName:{defaultMessage:"This page",id:"automations.contextValue.buttonAutomationThisPageName"},buttonAutomationThisPageTooltip:{defaultMessage:"The page containing this button",id:"automations.contextValue.buttonAutomationThisPageTooltip"},eventAutomationCurrentUserDescription:{defaultMessage:"The user who made the edit that triggered this automation to run.",id:"automations.contextValue.eventAutomationCurrentUserDescription"},eventAutomationCurrentUserName:{defaultMessage:"Whoever triggered",id:"automations.contextValue.eventAutomationCurrentUserName"},eventAutomationCurrentUserTooltip:{defaultMessage:"The person whose action triggered this automation",id:"automations.contextValue.eventAutomationCurrentUserTooltip"},eventAutomationThisPageDescription:{defaultMessage:"The page that was edited to trigger this automation to run.",id:"automations.contextValue.eventAutomationThisPageDescription"},eventAutomationThisPageName:{defaultMessage:"Trigger page",id:"automations.contextValue.eventAutomationThisPageName"},eventAutomationThisPageTooltip:{defaultMessage:"The page that triggered this automation",id:"automations.contextValue.eventAutomationThisPageTooltip"},now:{id:"automations.triggers.now.label",defaultMessage:"Time triggered"},nowDescription:{id:"automations.triggers.now.description",defaultMessage:"The time when this automation begins to run."},nowTooltip:{id:"automations.triggers.now.tooltip",defaultMessage:"The time this automation was triggered"},pageCreator:{id:"automations.triggers.pageCreator.label",defaultMessage:"Page creator"},pageCreatorDescription:{id:"automations.triggers.pageCreator.description",defaultMessage:"The user who created the page that was edited to trigger this automation to run."},pageCreatorTooltip:{id:"automations.triggers.pageCreator.tooltip",defaultMessage:"Person who created page"},today:{id:"automations.triggers.today.label",defaultMessage:"Date triggered"},todayDescription:{id:"automations.triggers.today.description",defaultMessage:"The date when this automation begins to run."},todayTooltip:{id:"automations.triggers.today.tooltip",defaultMessage:"The date this automation was triggered"}});function l(){return(0,a().$y)({source:"global",global:"button_page"})}function s(e,t,o){return{description:o,name:e,tooltip:t,compile:(n,a)=>({description:o?n.formatMessage(o):void 0,id:l(),kind:r().FormulaContextValueKind.ContextValue,name:n.formatMessage(e),tooltipName:n.formatMessage(t),type:{collection:a,type:"block"}}),evaluate:e=>({kind:r().FormulaContextValueKind.ContextValue,id:l(),value:{type:"block",value:e}})}}const u=s(i.buttonAutomationThisPageName,i.buttonAutomationThisPageTooltip,i.buttonAutomationThisPageDescription),c=s(i.eventAutomationThisPageName,i.eventAutomationThisPageTooltip,i.eventAutomationThisPageDescription);function p(){return(0,a().$y)({source:"global",global:"current_user"})}function d(e,t,o){return{description:o,name:e,tooltip:t,compile:n=>({description:o?n.formatMessage(o):void 0,id:p(),kind:r().FormulaContextValueKind.ContextValue,name:n.formatMessage(e),tooltipName:n.formatMessage(t),type:{type:"person"}}),evaluate:e=>({id:p(),kind:r().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const m=d(i.buttonAutomationCurrentUserName,i.buttonAutomationCurrentUserTooltip,i.buttonAutomationCurrentUserDescription),g=d(i.eventAutomationCurrentUserName,i.eventAutomationCurrentUserTooltip,i.eventAutomationCurrentUserDescription);function y(){return(0,a().$y)({source:"global",global:"now"})}const h={description:i.nowDescription,name:i.now,tooltip:i.nowTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:y(),kind:r().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:y(),kind:r().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,n().KQ)(Date.now(),e)}})};function f(){return(0,a().$y)({source:"global",global:"today"})}const v={description:i.todayDescription,name:i.today,tooltip:i.todayTooltip,compile(e){return{description:this.description?e.formatMessage(this.description):void 0,id:f(),kind:r().FormulaContextValueKind.ContextValue,name:e.formatMessage(this.name),tooltipName:this.tooltip?e.formatMessage(this.tooltip):void 0,type:{type:"date"}}},evaluate:e=>({id:f(),kind:r().FormulaContextValueKind.ContextValue,value:{type:"date",value:(0,n().p6)(Date.now(),e)}})};function x(){return(0,a().$y)({source:"global",global:"page_creator"})}function S(e,t){return{description:i.pageCreatorDescription,name:e,tooltip:t,compile(o){return{description:this.description?o.formatMessage(this.description):void 0,id:x(),kind:r().FormulaContextValueKind.ContextValue,name:o.formatMessage(e),tooltipName:o.formatMessage(t),type:{type:"person"}}},evaluate:e=>({id:x(),kind:r().FormulaContextValueKind.ContextValue,value:{type:"person",value:e}})}}const b=S(i.pageCreator,i.pageCreatorTooltip),C=S(i.pageCreator,i.pageCreatorTooltip)},95199:(e,t,o)=>{o.d(t,{Ud:()=>K});o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(422540),s=()=>o(462618),u=()=>o(352271),c=()=>o(80979),p=()=>o(791089),d=()=>o(519831),m=()=>o(959013),g=()=>o(496603),y=()=>o(534177),h=()=>o(246826),f=()=>o(725614),v=()=>o(84817),x=()=>o(760217),S=()=>o(406699),b=()=>o(623580),C=()=>o(928600),A=()=>o(939740),k=()=>o(89924),M=()=>o(521732),j=()=>o(678350),T=()=>o(909470),I=()=>o(508496),P=()=>o(546461),w=()=>o(653417),_=()=>o(301782),V=()=>o(366360),R=()=>o(858163),B=()=>o(133518),E=()=>o(781697),F=()=>o(656134),N=()=>o(548526),O=()=>o(464004),D=()=>o(938818),W=o(474848);const L=(0,m().YK)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},toggleActionLabel:{id:"automations.AutomationActionSetPropertiesSection.toggleAction.label",defaultMessage:"Toggle"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"},automationActionPropertyDeleted:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyDeleted",defaultMessage:"This property was deleted"},automationActionPropertyUnsupported:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyUnsupported",defaultMessage:"This property is unsupported"}});function K(e){const{actionStore:t,collectionStore:o,disabled:i,showSetPropertyActions:l}=e,s=(0,r().v3)(),{automationStore:u}=(0,P().EC)(),{maybePersistedTransactionActions:c}=(0,V().b)(),p=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.values)??{}}),[t]),d=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.properties)??[]}),[t]),m=(0,n.useCallback)((e=>{const o=d.concat([e]),n={...p,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{H({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,_().UB)(s,{automationActionStore:t,automationStore:u})}),[d,p,c,s,u,t]),g=(0,n.useCallback)(((e,o)=>{const n=d.indexOf(e);if(-1===n)return;const r=d.slice(0);r[n]=o;const a={...p,[o]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{H({configStore:t.getConfigStore(),properties:r,transaction:e,values:a})}}),(0,_().UB)(s,{automationActionStore:t,automationStore:u})}),[d,p,c,s,u,t]),y=(0,n.useCallback)((e=>{const o=d.filter((t=>t!==e)),n={...p,[e]:void 0};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{H({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,_().UB)(s,{automationActionStore:t,automationStore:u})}),[d,p,c,s,u,t]),h=(0,n.useCallback)(((e,o)=>{const n={...p,[e]:o};c.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{H({configStore:t.getConfigStore(),properties:d,transaction:e,values:n})}}),(0,_().UB)(s,{automationActionStore:t,automationStore:u})}),[p,c,s,t,u,d]);return(0,W.jsx)(z,{actionStore:t,collectionStore:o,disabled:i,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,showSetPropertyActions:l})}function H(e){const{configStore:t,properties:o,transaction:n,values:r}=e;h().zv({store:t,data:{properties:o,values:r},transaction:n})}function z(e){const{actionStore:t,collectionStore:o,onPropertyAdd:n,onPropertyChange:r,onPropertyRemove:s,onPropertyValueChange:u,disabled:c,showSetPropertyActions:p}=e,d=(0,i().IS)((e=>({addPropertyRow:{display:"flex",alignItems:"center"}})),[]),m=(0,a().K8)((()=>t.getConfigStore().getKeyStore("properties").getValue()??[]),[t]),g=(0,a().K8)((()=>(0,l().m7)({collectionFormat:o.getFormat(),collectionSchema:o.getSchema(),filter:e=>{let[t]=e;return!m.includes(t)},spaceId:o.getSpaceId(),restrictCrossSpace:I().default.checkGate({gateName:"collections_xws"})})),[o,m]),y=0===g.length;return(0,W.jsxs)(W.Fragment,{children:[m.length>0&&(0,W.jsx)(U,{actionStore:t,availablePropertyIds:g,collectionStore:o,disabled:c,onPropertyChange:r,onPropertyRemove:s,onPropertyValueChange:u,showSetPropertyActions:p}),!c&&!y&&(0,W.jsx)("div",{style:d.addPropertyRow,children:(0,W.jsx)(O().l,{availablePropertyIds:g,currentValue:void 0,collectionStore:o,onChange:n,disabled:c,alreadyHaveProperties:m.length>0})})]})}function U(e){const{actionStore:t,availablePropertyIds:o,collectionStore:n,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:u,showSetPropertyActions:c,disabled:p}=e,{isMobile:d}=(0,r().Y0)(),m=d,g=(0,i().IS)((()=>({wrap:{alignItems:"start",columnGap:4,display:"grid",gridTemplateColumns:m?"100%":"160px 1fr",minWidth:0,rowGap:m?4:8},propertyValue:{...m?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...m?{fontSize:14,marginBlockEnd:0}:{}}})),[m]),[y,h]=(0,a().K8)((()=>{const e=t.getConfig();return[(null==e?void 0:e.properties)??[],(null==e?void 0:e.values)??{}]}),[t]);return(0,W.jsx)("div",{style:g.wrap,children:y.map(((e,r)=>{const a=r===y.length-1;return(0,W.jsx)(Y,{actionStore:t,availablePropertyIds:o,collectionStore:n,disabled:p,onPropertyChange:l,onPropertyRemove:s,onPropertyValueChange:u,property:e,showSetPropertyActions:c,value:h[e],valueStyle:a?g.lastPropertyValue:g.propertyValue},e)}))})}function Y(e){const{actionStore:t,availablePropertyIds:o,collectionStore:r,disabled:g,onPropertyChange:y,onPropertyRemove:h,onPropertyValueChange:f,property:x,showSetPropertyActions:S,value:C,valueStyle:A}=e,k={type:"collection",collectionStore:r,property:x},M=(0,m().tz)(),j=(0,i().IS)((e=>({propertyName:{display:"flex"},propertyValue:{display:"flex",gap:4,minWidth:50,...A},propertyValueInput:{minWidth:50}})),[A]),I=(0,n.useMemo)((()=>{if("title"===x)return M.formatMessage(L.titlePlaceholder)}),[M,x]),_=(0,a().K8)((()=>r.getSchema()[x]||r.getDeletedSchema()[x]),[r,x]),R=(0,a().K8)((()=>Boolean(!r.getSchema()[x])),[r,x]),E=(0,a().K8)((()=>{if(_)return(0,p().setPropertyValueToSimpleFormulaReturnType)({table:d().Vl,id:r.id,spaceId:r.getSpaceId()},x,_)}),[r,_,x]),F=(0,n.useMemo)((()=>{if(_&&(0,l().I3)(_))return _.type}),[_]),N=(0,n.useMemo)((()=>_&&!(0,l().I3)(_)),[_]),K=null==C?void 0:C.value,H=(0,a().K8)((()=>(0,u().tz)(C)),[C]),{automationStore:z}=(0,P().EC)(),U=(0,a().K8)((()=>z.getSpaceId()),[z]),Y=(0,B().F)({actionId:t.id}),$=(0,a().K8)((()=>{if(F&&U)return(0,p().analyzeSimpleFormulaOrFormulaSync)({context:{allowedReturnTypes:l().Yy[F],handleDataRequest:(0,c().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:U,valueTypes:Y.slice(0),featureGates:(0,T().i)()},value:null==C?void 0:C.value})}),[t.getRecordModel,Y,U,F,null==C?void 0:C.value]),{suppressActionErrors:G}=(0,V().b)(),X=(0,n.useMemo)((()=>!G.includes(t.id)),[G,t]),{errorMessage:Z}=(0,w().useErrorComponentForAction)({actionId:t.id,errorKey:x,shouldShow:X}),J=(0,n.useCallback)((e=>{y(x,e)}),[y,x]),ee=(0,n.useCallback)((()=>h(x)),[h,x]),te=(0,n.useCallback)((e=>{f(x,e)}),[f,x]),oe=(0,n.useCallback)((e=>{te({action:e,value:K})}),[K,te]),ne=(0,n.useCallback)((e=>{te({action:H,value:e})}),[H,te]);if(!U)return null;const re=function(e){if("email"===e||"phone_number"===e||"url"===e)return{disableEmojiCommands:!0,disableFormattingAndMentions:!0};return{}}(F);let ae;return R?ae=(0,W.jsx)(m().sA,{...L.automationActionPropertyDeleted}):N?ae=(0,W.jsx)(m().sA,{...L.automationActionPropertyUnsupported}):Z&&(ae=Z),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:j.propertyName,children:(0,W.jsx)(O().l,{availablePropertyIds:o,currentValue:x,collectionStore:r,onChange:J,disabled:g,onRemove:ee,errorMessage:ae})}),(0,W.jsxs)("div",{style:j.propertyValue,children:[!R&&S&&_&&s().M[_.type]&&(0,W.jsx)(q,{disabled:g,onChange:oe,value:H}),R?(0,W.jsx)(b().A,{disabled:!0,placeholder:M.formatMessage(L.automationActionPropertyDeleted)}):N?(0,W.jsx)(b().A,{disabled:!0,placeholder:M.formatMessage(L.automationActionPropertyUnsupported)}):F&&E?(0,W.jsxs)(v().Y1,{direction:"vertical",gap:7,style:j.propertyValueInput,children:[(0,W.jsx)(Q,{...re,analyzedFormulaOutput:$,automationActionStore:t,disabled:g,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,simpleFormulaContext:k,formulaTypecheckContextValues:Y,onChange:ne,parentRecordStore:t,placeholder:I,propertyType:F,spaceId:U,type:E,value:null==C?void 0:C.value}),$&&(0,W.jsx)(D().J,{analyzedFormulaOutput:$})]}):null]})]})}function q(e){const{disabled:t,onChange:o,value:n}=e,r=(0,i().IS)((e=>({button:{boxShadow:e.inputBoxShadow,minWidth:120}})),[]),a=(0,F().j)();return(0,W.jsx)(S().Ay,{popupType:a,alignmentToOrigin:S().yP.End,placementToOrigin:S().sx.Bottom,originGap:0,disabled:t,renderOrigin:e=>(0,W.jsx)(N().x,{...e,disabled:t,style:r.button,dropdownButtonType:"button",children:(0,W.jsx)(G,{action:n})}),render:e=>(0,W.jsx)($,{onChange:o,parent:e,value:n})})}function $(e){const{value:t,onChange:o,parent:n}=e,r=(0,E().e)({width:250}),a=g().oE(u().Au.map(((e,r)=>({key:r,render:o=>(0,W.jsx)(x().A,{...o,disabled:!1,title:(0,W.jsx)(G,{action:e}),isChecked:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,W.jsx)(C().A,{...r,children:(0,W.jsx)(A().Ay,{type:A().Oh.Vertical,sections:[{key:0,render:e=>(0,W.jsx)(k().A,{enableActionSheetTitle:!0,...e}),items:a}],initialFocus:0})})}function G(e){const{action:t}=e;return"replace"===t?(0,W.jsx)(m().sA,{...L.replaceActionLabel}):"append"===t?(0,W.jsx)(m().sA,{...L.appendActionLabel}):"remove"===t?(0,W.jsx)(m().sA,{...L.removeActionLabel}):"toggle"===t?(0,W.jsx)(m().sA,{...L.toggleActionLabel}):void(0,y().HB)(t)}function Q(e){const{analyzedFormulaOutput:t={},automationActionStore:o,disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:u,disableMobileActionBar:c,disableTemplateVariableMentions:p,formulaTypecheckContextValues:d,onChange:m,parentRecordStore:g,placeholder:y,propertyType:h,simpleFormulaContext:v,spaceId:x,type:S,value:b}=e,{parseErrors:C=[],typeErrors:A=[]}=t,k=C.length>0||A.length>0,{onTextStoreSelect:T,onTextStoreUnselect:I}=(0,R().W)(o),P=(0,i().IS)((e=>({input:{width:"100%"}})),[]),w=(0,r().v3)(),_=(0,n.useCallback)((()=>{f().clear({environment:w})}),[w]);return"text"===S.type?(0,W.jsx)(M().Y,{allowedReturnTypes:l().Yy[h],disabled:a,disableEmojiCommands:s,disableMobileActionBar:c,disableTemplateVariableMentions:p,formulaTypecheckContextValues:d,onChange:m,onTextStoreSelect:T,onTextStoreUnselect:I,onTextEsc:_,parentRecordStore:g,spaceId:x,placeholder:y,style:P.input,shouldShowErrorStyles:k,value:b}):"number"===S.type?(0,W.jsx)(M().Y,{allowedReturnTypes:l().Yy[h],disabled:a,disableEmojiCommands:!0,disableInsertedDeletedAnnotations:!0,disableMentions:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,formulaTypecheckContextValues:d,onChange:m,onTextStoreSelect:T,onTextStoreUnselect:I,onTextEsc:_,parentRecordStore:g,spaceId:x,style:P.input,shouldShowErrorStyles:k,value:b}):(0,W.jsx)(j().U,{allowedReturnTypes:l().Yy[h],disabled:a,disableEmojiCommands:s,disableFormattingAndMentions:u,disableMobileActionBar:c,disableTemplateVariableMentions:p,formulaTypecheckContextValues:d,onChange:m,parentRecordStore:g,placeholder:y,simpleFormulaContext:v,spaceId:x,type:S,value:b})}},103966:(e,t,o)=>{o.d(t,{Z:()=>c});var n=()=>o(496603),r=()=>o(534177),a=()=>o(416504),i=()=>o(519831),l=()=>o(79118);const s={type:"button",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,contextType:a,getRecordModel:s,intl:u}=e,c=l().Fz.compile(u),p=l().vm.compile(u),d=l().Eo.compile(u),m=t.getParentPointer();let g,y;if("button_block"===a){if(e.pageBlockModel){const t=(0,o(236162).SH)({block:e.pageBlockModel,getRecordModel:s});t&&(g=l().M4.compile(u,t.pointer),y=l().YW.compile(u))}}else if("button_property"===a){const e=s(m);if((null==e?void 0:e.table)!==i().Vl)return{error:new(o(322867).N9)(`Unable to load automation parent: ${o(696706).L3.toKey(m)}`)};g=l().M4.compile(u,e.pointer),y=l().YW.compile(u)}else(0,r().HB)(a);return{value:{valueTypes:(0,n().oE)([c,p,d,g,y])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:r,thisPageBlockModel:i}=t??{},s=i?l().M4.evaluate(i.pointer):void 0,u=null==i?void 0:i.getCreatedByPointer(),c=u?l().YW.evaluate(u):void 0,p=o?l().Fz.evaluate(o):void 0,d=(0,a().P)(),m=l().vm.evaluate(r??d),g=l().Eo.evaluate(r??d);return{value:{values:(0,n().oE)([s,c,p,m,g])}}},isAvailableForContext:e=>!0};o(944114);const u={button:s,event:{type:"event",getCreatePermissions(e){const{parentPointer:t,spacePointer:o}=e;return[{minimumRole:"editor",pointer:t,type:"record_permission"},{minimumRole:"read_and_write",pointer:o,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e,n=[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}],a=t.getTrigger();if("event"===a.type){const e=a.event;(0,r().O9)(e.source)&&"filter"!==e.source.type&&(e.source.type===i().Vl||e.source.type===o(869558).Gy?n.push({minimumRole:"reader",pointer:e.source.pointer,type:"record_permission"}):(0,r().HB)(e.source))}return n},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"editor",pointer:t.getParentPointer(),type:"record_permission"},{minimumRole:"read_and_write",pointer:t.getSpacePointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{automationModel:t,intl:o}=e,r=l().mO.compile(o),a=l().iY.compile(o),s=l().vm.compile(o),u=l().Eo.compile(o),c=t.getParentPointer();let p;return c.table===i().Vl&&(p=l().qE.compile(o,c)),{value:{valueTypes:(0,n().oE)([r,a,s,u,p])}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserPointer:o,executingUserTimeZone:i,thisPageBlockModel:s}=t??{},u=s?l().qE.evaluate(s.pointer):void 0,c=o?l().mO.evaluate(o):void 0,p=(0,a().P)(),d=l().vm.evaluate(i??p),m=null==s?void 0:s.getCreatedByPointer(),g=(0,r().O9)(m)?l().iY.evaluate(m):void 0,y=l().Eo.evaluate(i??p);return{value:{values:(0,n().oE)([u,c,d,y,g])}}},isAvailableForContext:e=>!0},recurrence:{type:"recurrence",getCreatePermissions(e){const{parentPointer:t}=e;return[{minimumRole:"read_and_write",pointer:t,type:"record_permission"}]},getEditPermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getManagePermissions(e){const{automationModel:t}=e;return[{minimumRole:"read_and_write",pointer:t.getParentPointer(),type:"record_permission"}]},getExecutePermissions(e){const{automationModel:t}=e;return[{minimumRole:"reader",pointer:t.getParentPointer(),type:"record_permission"}]},typecheck(e){const{intl:t}=e;return{value:{valueTypes:[l().vm.compile(t),l().Eo.compile(t)]}}},execute(e){const{formulaVariableResolution:t}=e,{executingUserTimeZone:o}=t??{},n=(0,a().P)();return{value:{values:[l().vm.evaluate(o??n),l().Eo.evaluate(o??n)]}}},isAvailableForContext(e){const{automation:t,automationActions:n,hasPremiumAutomations:a}=e;if(t.parent_table===o(179034).ev)return!0;if(t.parent_table===i().Vl){const e=o(388821).RecordMap.create();for(const t of n)e.addModel(t);return!!t.isCompleteSprintAutomation({getRecordModel:o(792071).b4_.fromRecordMap(e)})||a}(0,r().HB)(t.parent_table)}}};function c(e){return u[e]}},104636:(e,t,o)=>{o.d(t,{Is:()=>p,LS:()=>g,NH:()=>y,QA:()=>m,_b:()=>d});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(244641),r=(o(296540),()=>o(390527)),a=()=>o(604995),i=()=>o(959013),l=()=>o(488887),s=()=>o(534177),u=()=>o(108944),c=o(474848);function p(e){const t=u().g7(e)??[],o=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r().templateAncestorsViolateRecurrenceNesting)(o)}}function d(e){switch(e){case"day":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,c.jsx)(i().sA,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,s().HB)(e)}}function m(){return{start_date:n().c9.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,a().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function g(e){const{recurrence:t,intl:o,leadingPhrase:n}=e;return(0,r().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===n)return"";if("every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,s().HB)(n);break;case"day":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":{const e=(null==t?void 0:t.weekdays)||[];return 5===e.length&&(0,l()._)(new Set(e),new Set(["MO","TU","WE","TH","FR"]))?o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weekday",defaultMessage:"weekday"}):o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"})}case"weeks":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function y(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},112588:(e,t,o)=>{o.d(t,{Y:()=>p,h:()=>c});o(944114),o(898992),o(354520),o(908872),o(296540);var n=()=>o(847249),r=()=>o(764880),a=()=>o(289915),i=()=>o(546461),l=()=>o(397785),s=()=>o(989064),u=o(474848);function c(e){const{filter:t,propertySchema:o,onClick:r}=e,{automationStore:a}=(0,i().EC)(),c=(0,n().K8)((()=>p(t,a.getRecordModel)),[a.getRecordModel,t]),{title:d,tooltipTitle:m,styles:g}=(0,l().oG)({actorModels:c,messageType:"trigger",operator:t.operator,propertySchema:o});return(0,u.jsx)(s().z,{onClick:r,tooltip:(0,u.jsx)("span",{children:m}),children:(0,u.jsx)("div",{style:g.content,children:d})})}function p(e,t){return(0,a().Wf)(e).reduce(((e,o)=>("exact"===o.type&&o.value&&e.push((0,r().xC)({pointer:o.value,getRecordModel:t})),e)),[])}},120423:(e,t,o)=>{o.d(t,{A:()=>d});o(581454),o(296540);var n=()=>o(484714),r=()=>o(401497),a=()=>o(352271),i=()=>o(959013),l=()=>o(760217),s=()=>o(406699),u=()=>o(89924),c=()=>o(755535),p=o(474848);function d(e){let{action:t,handleOnChange:o}=e;const d=(0,n().Y0)(),m=(0,r().IS)((e=>({buttonStyle:{fontSize:d.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,color:d.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[d.isMobile]),y=g[t||a().yP];return(0,p.jsx)(c().A,{alignmentToOrigin:s().yP.Start,innerButtonStyle:m.buttonStyle,selectedTitle:(0,p.jsx)(i().sA,{...y.text}),renderMenuSections:e=>[{key:"ReplaceAddRemoveToggleOperator",render:e=>(0,p.jsx)(u().A,{...e}),items:Object.values(g).map((t=>({key:t.value,action:()=>{e.close(),o(void 0,t.value)},render:e=>(0,p.jsx)(l().A,{...e,title:(0,p.jsx)(i().sA,{...t.text})})})))}]})}const m=(0,i().YK)({replace:{id:"automations.propertyAction.button.replaceWith",defaultMessage:"Replace with..."},append:{id:"automations.propertyAction.button.add",defaultMessage:"Add..."},remove:{id:"automations.propertyAction.button.remove",defaultMessage:"Remove..."},toggle:{id:"automations.propertyAction.button.toggle",defaultMessage:"Toggle..."}}),g={replace:{text:m.replace,value:"replace"},append:{text:m.append,value:"append"},remove:{text:m.remove,value:"remove"},toggle:{text:m.toggle,value:"toggle"}}},133518:(e,t,o)=>{o.d(t,{F:()=>l});var n=o(296540),r=()=>o(310109),a=()=>o(534177),i=()=>o(546461);function l(e){const{actionId:t}=e??{},o=(0,i().YC)();return(0,n.useMemo)((()=>{if(!o.defined)return[];return(0,a().O9)(t)?(0,r().getContextValuesForAction)(o.typecheckResult,t):(0,r().getAllContextValues)(o.typecheckResult)}),[o.defined,o.typecheckResult,t])}},142755:(e,t,o)=>{o.d(t,{F:()=>i});o(296540);var n=()=>o(401497),r=()=>o(704152),a=o(474848);function i(e){const{ariaLabel:t,disabled:o,icon:i,onClick:l,title:s}=e,u=(0,n().IS)((e=>({button:{alignItems:"center",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,color:e.text.secondary,display:"flex",gap:8,justifyContent:"flex-start",padding:12},buttonHoveredStyle:{background:e.outlineButtonHoveredBackground},buttonPressedStyle:{background:e.buttonPressedBackground},iconContainer:{fill:e.icon.secondary,width:20,height:20,display:"flex",justifyContent:"center",alignItems:"center"},title:{fontSize:14,lineHeight:"20px"}})),[]);return(0,a.jsxs)(r().A,{ariaLabel:t,disabled:o,disabledFeedback:o,onClick:l,style:u.button,hoveredStyle:u.buttonHoveredStyle,pressedStyle:u.buttonPressedStyle,children:[i&&(0,a.jsx)("div",{"aria-hidden":"true",style:u.iconContainer,children:i}),(0,a.jsx)("div",{style:u.title,children:s})]})}},158661:(e,t,o)=>{o.r(t),o.d(t,{exclamationMarkTriangleFillSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M9.516 2.825c-.674-1.167-2.358-1.167-3.031 0l-4.677 8.1c-.673 1.167.168 2.625 1.516 2.625h9.353c1.347 0 2.189-1.458 1.515-2.625zM7.9 5.356a.55.55 0 0 1 .55.55v2.5a.55.55 0 0 1-1.1 0v-2.5a.55.55 0 0 1 .55-.55m0 6a.65.65 0 1 1 0-1.3.65.65 0 0 1 0 1.3"})},r=(0,o(340498).wt)("exclamationMarkTriangleFillSmall",n)},170356:(e,t,o)=>{o.d(t,{NS:()=>p,Pq:()=>g,Z3:()=>c,sw:()=>d});o(296540);var n=()=>o(484714),r=()=>o(297872),a=()=>o(928600),i=()=>o(678553),l=()=>o(480095),s=()=>o(722872),u=o(474848);const c=8,p=8,d=32,m={height:d+c-2,paddingTop:c-2};function g(e){let{title:t,helpButton:o,onCancel:i,desktopMinWidth:c,desktopMaxWidth:p,desktopWidth:d,children:m}=e;const{device:g}=(0,n().v3)();return(0,u.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:s().gu.Modal,title:t,right:(0,u.jsx)(l().DoneMenuText,{}),onClickRight:i,...e}:{menuType:s().gu.Popup,...c&&{minWidth:c},...p&&{maxWidth:p},...d&&{width:d},...e},(0,u.jsx)(a().A,{...n,header:t&&(0,u.jsx)(y,{title:t,helpButton:o}),children:m})}})}function y(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,u.jsx)(i().Ay,{style:m,title:t,right:o})}},181088:(e,t,o)=>{o.r(t),o.d(t,{clockSmallIcon:()=>a,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M8 3.955a.625.625 0 0 0-.625.625v2.795H5.12a.625.625 0 1 0 0 1.25H8c.345 0 .625-.28.625-.625V4.58A.625.625 0 0 0 8 3.955"}),(0,n.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},a=(0,o(340498).wt)("clockSmall",r)},194373:(e,t,o)=>{o.d(t,{_:()=>G});o(16280),o(944114),o(898992),o(354520),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(700500),s=()=>o(247331),u=()=>o(977345),c=()=>o(187174),p=()=>o(12193),d=()=>o(206267),m=()=>o(179034),g=()=>o(519831),y=()=>o(959013),h=()=>o(778078),f=()=>o(496603),v=()=>o(534177),x=()=>o(736767),S=()=>o(760217),b=()=>o(419357),C=()=>o(928600),A=()=>o(678553),k=()=>o(939740),M=()=>o(8980),j=()=>o(958378),T=()=>o(89924),I=()=>o(859428),P=()=>o(996027),w=()=>o(320865),_=()=>o(175116),V=()=>o(186445),R=()=>o(156988),B=()=>o(553965),E=()=>o(645873),F=()=>o(106628),N=()=>o(361330),O=()=>o(962730),D=()=>o(351360),W=()=>o(970585),L=()=>o(630116),K=()=>o(546461),H=()=>o(781697),z=o(474848);const U=(0,y().YK)({searchInputPlaceholder:{defaultMessage:"Type to search…",id:"automations.AutomationTargetPickerMenu.search.placeholder"},searchInputPlaceholderUrlsAllowed:{defaultMessage:"Type to search or paste a link…",id:"automations.AutomationTargetPickerMenu.search.placeholderUrlsAllowed"}}),Y=5,q=20,$=20;function G(e){const t=(0,H().e)({maxWidth:360,width:280}),o=(0,n.useMemo)((()=>d().JW()),[]);return(0,z.jsx)(C().A,{...t,children:(0,z.jsx)(Z,{...e,searchSessionId:o})})}const Q=Object.values(l().xd).filter((e=>e!==l().xd.form)),X=[l().xd.form];function Z(e){const{formulaTypecheckContextValues:t,includeThisPage:o,onChange:i,onClose:l,parentRecordStore:d,selectedTarget:m,skipCollections:b,skipPages:C,skipVariables:H,spaceId:U,urlBehavior:q}=e,G=(0,a().uB)(void 0,W().A),Z=(0,K().YC)(),ae=(0,a().K8)((()=>{if(H)return[];if((0,v().O9)(t)&&t.length>0){return Object.values(t).filter((e=>{if(!(0,u().o5)(e.type,{type:"block"}))return!1;if(!o&&"event"===(null==Z?void 0:Z.contextType)&&e.kind===s().FormulaContextValueKind.ContextValue){const t=(0,u().y5)(e.id);return!("global"===t.source&&"button_page"===t.global)}return!0}))}return[]}),[o,H,t,null==Z?void 0:Z.contextType],{useDeepEqual:!0}),[ie]=(0,n.useState)((()=>"url"===(null==m?void 0:m.type)?m.url:"")),[le,se]=(0,n.useReducer)(te,{automationVariables:[],collectionQueryLimit:Y,pageQueryLimit:Y,formQueryLimit:Y,searchTerm:ie});(0,n.useEffect)((()=>{if(le.searchTerm){const e=(0,h().Ay)(le.searchTerm,ae,(e=>e.kind===s().FormulaContextValueKind.ContextValue?e.name:""));se({type:"set_variables",variables:e})}else se({type:"set_variables",variables:ae})}),[le.searchTerm,ae]);const ue=function(e){const{limit:t,searchTerm:o,skip:i}=e,l=(0,r().v3)(),s=(0,a().K8)((()=>(0,V().ao)()),[]),u=(0,a().O$)(D().AppStoreCurrentSpaceStore),p=(0,_().Ks)(),d=(0,a().K8)((()=>null==p?void 0:p.collectionViewBlockStore()),[p]),[m,g]=(0,n.useReducer)(oe,{error:void 0,isLoading:Boolean(i),results:void 0,total:void 0}),y=(0,E().fJ)(F().T.searchActions),[h]=(0,c().Yb)((async()=>{if(i||!s||"resolved"!==y.status)return;const e=y.value,n=await e.searchCollectionsWithRecents({collectionViewBlockStore:d,environment:l,spaceStore:u,limit:t,parentStore:s,query:o,requireEditPermissions:!0,searchSessionId:void 0});return{results:n.results,total:n.total}}),[i,s,y.status,y.value,d,l,u,t,o],{debounce:N().tu});return(0,n.useEffect)((()=>{if("pending"===h.status||"idle"===h.status)g({type:"query_loadstart"});else if("resolved"===h.status){var e,t;g({results:null===(e=h.value)||void 0===e?void 0:e.results,total:null===(t=h.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===h.status?g({error:h.error,type:"query_error"}):(0,v().HB)(h)}),[h]),m}({limit:le.collectionQueryLimit,searchTerm:le.searchTerm,skip:b}),ce=ne({limit:le.pageQueryLimit,searchTerm:le.searchTerm,skip:C,spaceId:U,blockTypes:Q}),pe=ne({limit:le.pageQueryLimit,searchTerm:le.searchTerm,skip:C,spaceId:U,blockTypes:X}),de=(0,v().O9)(q)?(0,R().KX)(le.searchTerm):void 0,me=(0,n.useCallback)((e=>{m&&!f().n4(m,e)?i(e):m?l():i(e)}),[m,i,l]),ge=(0,n.useCallback)((e=>{const t=e.target.value;se({searchTerm:t,type:"set_search_term"}),G.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[G]),ye=(0,n.useCallback)((()=>{se({queryLimit:le.collectionQueryLimit+$,type:"set_collection_query_limit"})}),[le.collectionQueryLimit]),he=(0,n.useCallback)((()=>{se({queryLimit:le.pageQueryLimit+$,type:"set_page_query_limit"})}),[le.pageQueryLimit]),fe=(0,n.useCallback)((()=>{se({queryLimit:le.formQueryLimit+$,type:"set_form_query_limit"})}),[le.formQueryLimit]),ve="variable"===(null==m?void 0:m.type)?m.id:void 0,xe="collection"===(null==m?void 0:m.type)?m.collection.id:void 0,Se="page"===(null==m?void 0:m.type)?m.page.id:void 0,be=[],Ce=function(e){const{automationVariables:t,onClick:o,selectedVariableId:n,parentRecordStore:r}=e,a=t.map((e=>{if(e.kind!==s().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,z.jsx)(P().A,{contextValue:e,isChecked:e.id===n,menuArgs:t,parentRecordStore:r})}}));if(0===a.length)return;return{key:"variable_results",items:a,render:e=>(0,z.jsx)(T().A,{...e,title:(0,z.jsx)(y().sA,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:le.automationVariables,onClick:me,selectedVariableId:ve,parentRecordStore:d});Ce&&be.push(Ce);const Ae=function(e){const{urlResult:t,urlBehavior:o,onMenuItemClick:n}=e;if(!t||!o)return;if("notion"===t.type);else{if("web"===t.type||"other"===t.type){const e=[],r={title:t.url,icon:(0,z.jsx)(M().I,{icon:p().globeIcon})};return"allow"===o?e.push({action:()=>{n({type:"url",url:t.url})},key:"url",render:e=>(0,z.jsx)(S().A,{...e,...r})}):"disallow_with_message"===o?e.push({action:()=>{},key:"url",render:e=>(0,z.jsx)(I().A,{placement:O().W.Right,render:t=>(0,z.jsx)(S().A,{...(0,B().A)(t,e),disabled:!0,disabledFeedback:!0,...r}),renderTooltip:()=>(0,z.jsx)(y().sA,{defaultMessage:"Linking to a URL is only allowed if it is the first action in an automation.",id:"automations.AutomationTargetPickerMenu.urlSection.disabledMessage"})})}):(0,v().HB)(o),{key:"url_results",items:e,render:e=>(0,z.jsx)(T().A,{...e,title:(0,z.jsx)(y().sA,{defaultMessage:"Link",id:"automations.AutomationTargetPickerMenu.urlSection.sectionTitle"})})}}(0,v().HB)(t.type)}}({urlResult:de,urlBehavior:q,onMenuItemClick:me});Ae&&be.push(Ae);const ke=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:r,selectedCollectionId:a}=e;if(t.isLoading)return;let i=[];if(t.error)i.push({action:n,key:"show_more_collection_results",render:e=>(0,z.jsx)(x().A,{...e,caption:(0,z.jsx)(y().sA,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],l=e.length;i=e.map((e=>{const t=L().md.createChildStore(r,{table:g().Vl,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,z.jsx)(j().A,{...o,isChecked:e===a,store:t})}}));const s=t.total??0,u=Math.max(0,s-l);u>0&&i.push({action:n,key:"show_more_collection_results",render:e=>(0,z.jsx)(ee,{...e,showMoreCount:u})})}if(0===i.length)return;return{key:"collection_results",items:i,render:e=>(0,z.jsx)(T().A,{...e,title:(0,z.jsx)(y().sA,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})})}}({collectionQueryResult:ue,onCollectionMenuItemClick:me,onShowMoreItemClick:ye,parentRecordStore:d,selectedCollectionId:xe});ke&&be.push(ke);const Me=re({type:"page",onPageMenuItemClick:me,onShowMoreItemClick:he,queryResult:ce,parentRecordStore:d,selectedPageId:Se});Me&&be.push(Me);const je=re({type:"form",onPageMenuItemClick:me,onShowMoreItemClick:fe,queryResult:pe,parentRecordStore:d,selectedPageId:Se});je&&be.push(je);const Te=ue.isLoading||ce.isLoading||pe.isLoading;let Ie;if(be.length>0)Ie=(0,z.jsx)(k().Ay,{initialFocus:0,sections:be,store:G,type:k().Oh.Vertical});else if(Te){const e=Y+2;Ie=(0,z.jsxs)(T().A,{children:[(0,z.jsx)(w().A,{}),[...Array(e)].map(((e,t)=>(0,z.jsx)(A().Ay,{},t)))]})}else Ie=(0,z.jsx)(x().A,{caption:(0,z.jsx)(y().sA,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})});return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(J,{onChange:ge,value:le.searchTerm,urlsAllowed:"allow"===q}),Ie]})}function J(e){const{onChange:t,value:o,urlsAllowed:n}=e,{isMobile:a}=(0,r().Y0)(),l=(0,y().tz)(),s=(0,i().IS)((()=>({section:{paddingBlockStart:0,marginTop:12}})),[]);return(0,z.jsx)(T().A,{style:s.section,children:(0,z.jsx)(b().Ay,{focusInitial:!a||void 0,onChange:t,placeholder:l.formatMessage(n?U.searchInputPlaceholderUrlsAllowed:U.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const ee=(0,n.forwardRef)((function(e,t){const{showMoreCount:n}=e,r=(0,i().IS)((e=>({showMoreButton:{color:e.text.secondary,fill:e.mediumIconColor}})),[]);return(0,z.jsx)(S().A,{...e,icon:(0,z.jsx)(M().I,{icon:o(589407).L}),ref:t,style:r.showMoreButton,title:(0,z.jsx)(y().sA,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(n,$)}})})}));function te(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?q:Y;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else if("set_form_query_limit"===t.type){if(e.formQueryLimit!==t.queryLimit)return{...e,formQueryLimit:t.queryLimit}}else(0,v().HB)(t);return e}function oe(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,v().HB)(t)}return e}function ne(e){const{limit:t,searchTerm:o,skip:a,spaceId:i,blockTypes:l}=e,s=(0,r().v3)(),[u,p]=(0,n.useReducer)(oe,{error:void 0,isLoading:Boolean(a),results:void 0,total:void 0}),[d]=(0,c().Yb)((async()=>{if(a||!i)return;const e=await F().T.searchActions.load(),n=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:s,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:i,filterOverrides:{blockTypes:l}});return{results:n.results.map((e=>e.id)),total:n.total}}),[l,s,t,o,a,i],{debounce:N().tu});return(0,n.useEffect)((()=>{if("pending"===d.status||"idle"===d.status)p({type:"query_loadstart"});else if("resolved"===d.status){var e,t;p({results:null===(e=d.value)||void 0===e?void 0:e.results,total:null===(t=d.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===d.status?p({error:d.error,type:"query_error"}):(0,v().HB)(d)}),[d]),u}function re(e){const{type:t,queryResult:o,onPageMenuItemClick:n,onShowMoreItemClick:r,selectedPageId:a,parentRecordStore:i}=e;if(o.isLoading)return;const l=[];if(o.error)l.push({action:r,key:"show_more_page_results",render:e=>(0,z.jsx)(x().A,{...e,caption:(0,z.jsx)(y().sA,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=(o.results??[]).length;for(const r of o.results??[]){const e=L().Bv.createChildStore(i,{table:m().ev,id:r}),t={key:r,render:t=>(0,z.jsx)(j().A,{...t,isChecked:r===a,store:e}),action:()=>n({page:e.getSpaceShardedPointer(),type:"page"})};l.push(t)}const t=o.total??0,s=Math.max(0,t-e);s>0&&l.push({action:r,key:"show_more_page_results",render:e=>(0,z.jsx)(ee,{...e,showMoreCount:s})})}return 0!==l.length?{key:"page"===t?"page_results":"form_results",items:l,render:e=>(0,z.jsx)(T().A,{...e,title:"page"===t?(0,z.jsx)(y().sA,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"}):(0,z.jsx)(y().sA,{defaultMessage:"Forms",id:"automations.AutomationTargetPickerMenu.formsSection.title"})})}:void 0}},214973:(e,t,o)=>{o.d(t,{$B:()=>p,CH:()=>k,CV:()=>a,Ee:()=>V,Fp:()=>L,HG:()=>M,JQ:()=>f,LK:()=>C,NW:()=>l,Od:()=>T,Oo:()=>s,Pb:()=>d,Pg:()=>j,Q$:()=>B,Re:()=>E,Rn:()=>w,SV:()=>x,T2:()=>I,TF:()=>h,Xr:()=>i,Yx:()=>F,_M:()=>S,_d:()=>D,_f:()=>v,a9:()=>O,cC:()=>A,dd:()=>W,f4:()=>g,f_:()=>m,iy:()=>N,kN:()=>K,n1:()=>R,o7:()=>c,qx:()=>b,rh:()=>_,uW:()=>y,vC:()=>u,vH:()=>H,yR:()=>P});o(898992),o(354520),o(581454);var n=()=>o(713998),r=()=>o(496401);const a=(0,o(959013).YK)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.numberPropertySet.title"},actionTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.action.textPropertySet.title"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPropertyReplaceWith:{defaultMessage:"Replace {propertyName} with {propertyValue}",id:"automations.action.property.replaceWith"},actionPropertyReplaceWithOthers:{defaultMessage:"Replace {propertyName} with {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}}",id:"automations.action.property.replaceWithOthers"},actionPropertyAdd:{defaultMessage:"Add {propertyValue} to {propertyName}",id:"automations.action.property.add"},actionPropertyAddWithOthers:{defaultMessage:"Add {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} to {propertyName}",id:"automations.action.property.addWithOthers"},actionPropertyRemove:{defaultMessage:"Remove {propertyValue} from {propertyName}",id:"automations.action.property.remove"},actionPropertyRemoveWithOthers:{defaultMessage:"Remove {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} from {propertyName}",id:"automations.action.property.removeWithOthers"},actionPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.property.clear"},actionPropertyToggle:{defaultMessage:"Toggle {propertyValue} in {propertyName}",id:"automations.action.property.toggle"},actionPropertyToggleWithOthers:{defaultMessage:"Toggle {propertyValue} and {numOthers} {numOthers, plural, one {other} other {others}} in {propertyName}",id:"automations.action.property.toggleWithOthers"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerAnyPropertyClear:{defaultMessage:"{propertyName} is cleared",id:"automations.trigger.propertyCleared.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerNumberPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.numberPropertySet.title"},triggerTextPropertySet:{defaultMessage:"{propertyName} {operator} {propertyValues}",id:"automations.trigger.textPropertySet.title"},triggerSelectPropertyIs:{id:"automations.trigger.selectPropertyIs.title",defaultMessage:"{propertyName} is set to {propertyValues}"},triggerSelectPropertyIsNot:{id:"automations.trigger.selectPropertyIsNot.title",defaultMessage:"{propertyName} is not set to {propertyValues}"},triggerMultiSelectPropertyContains:{id:"automations.trigger.multiSelectPropertyContains.title",defaultMessage:"{propertyName} contains {propertyValues}"},triggerMultiSelectPropertyDoesNotContain:{id:"automations.trigger.multiSelectPropertyDoesNotContain.title",defaultMessage:"{propertyName} does not contain {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerPersonPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.personPropertySet.singleProperty"},triggerPersonPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValues}",id:"automations.trigger.personPropertySet.multipleProperties"},triggerPersonPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.personPropertyDoesNotContain.singleProperty"},triggerPersonPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValues}",id:"automations.trigger.personPropertyDoesNotContain.multipleProperties"},triggerRelationPropertyDoesNotContainSingle:{defaultMessage:"{propertyName} does not contain {propertyValue}",id:"automations.trigger.relationProperty.singleDoesNotContain"},triggerRelationPropertyDoesNotContainMultiple:{defaultMessage:"{propertyName} does not contain any of {propertyValue}",id:"automations.trigger.relationProperty.multipleDoesNotContain"},triggerRelationPropertyContainsMultiple:{defaultMessage:"{propertyName} contains any of {propertyValue}",id:"automations.trigger.relationProperty.multiple"},triggerRelationPropertyContainsSingle:{defaultMessage:"{propertyName} contains {propertyValue}",id:"automations.trigger.relationProperty.single"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"},unknownValue:{defaultMessage:"Unknown value",id:"automations.values.unknownValue"},unknownPropertyTitle:{defaultMessage:"a property",id:"database.viewSettings.automationTab.unknownPropertyTitle"},triggerInvalidConfigurationTitle:{defaultMessage:"Invalid {propertyName} property configuration",id:"automations.trigger.invalidConfiguration"},inlineCustomFormulaDefaultName:{defaultMessage:"My value",id:"automations.formulas.inlineCustomFormulaDefaultName"},triggerRelativeDate:{defaultMessage:"Relative date trigger",id:"automations.trigger.relativeDate.title"}});function i(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function l(e){const{propertyName:t}=e;return{...a.actionPropertyClear,values:{propertyName:t}}}function s(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function u(e){const{propertyName:t,propertyValues:o,operator:n}=e;return{...a.actionNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:n}}}function c(e){const{propertyName:t}=e;return{...a.triggerInvalidConfigurationTitle,values:{propertyName:t}}}function p(e){const{propertyName:t,propertyValues:o,operator:n}=e;return{...a.actionTextPropertySet,values:{propertyName:t,propertyValues:o,operator:n}}}function d(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){let{elements:t,intl:o}=e;const n=t.length>3?t.length-2:0,a=n>0?2:3,i=o.formatList(t.slice(0,a),{style:"long",type:n>0?"unit":"conjunction"});return{numOthers:n,propertyValue:(0,r().d)(i,{display:"flex"})}}function g(e){const{numOthers:t=0,operator:o,propertyName:n,propertyValue:r}=e;let i;return i=!r||Array.isArray(r)&&0===r.filter((e=>Boolean(e))).length?a.actionPropertyClear:"append"===o?t>0?a.actionPropertyAddWithOthers:a.actionPropertyAdd:"remove"===o?t>0?a.actionPropertyRemoveWithOthers:a.actionPropertyRemove:"toggle"===o?t>0?a.actionPropertyToggleWithOthers:a.actionPropertyToggle:t>0?a.actionPropertyReplaceWithOthers:a.actionPropertyReplaceWith,{...i,values:{propertyName:n,propertyValue:r,numOthers:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyContainsMultiple,values:{propertyName:t,propertyValue:o}}}function v(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function x(e){const{propertyName:t,propertyValue:o}=e;return{...a.triggerRelationPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValue:o}}}function S(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function b(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function C(e){const{propertyName:t,propertyValue:o}=e;return{...a.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function A(e){return e.formatMessage(a.actionDeletedProperty)}function k(e){return e.formatMessage(a.triggerAnyPageAdded)}function M(e){return e.formatMessage(a.triggerAnyPagePropertyEdit)}function j(e){return e.formatMessage(a.triggerDeletedPropertyEdit)}function T(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyEdit,{propertyName:o})}function I(e,t){return e.formatMessage(a.triggerCheckboxPropertySet,t)}function P(e,t){const{propertyName:o}=t;return e.formatMessage(a.triggerAnyPropertyClear,{propertyName:o})}function w(e){const{propertyName:t,propertyValues:o,operator:n}=e;return{...a.triggerNumberPropertySet,values:{propertyName:t,propertyValues:o,operator:n}}}function _(e){const{propertyName:t,propertyValues:o,operator:n}=e;return{...a.triggerTextPropertySet,values:{propertyName:t,propertyValues:o,operator:n}}}function V(e,t){return e.formatMessage(a.triggerSelectPropertyIs,t)}function R(e,t){return e.formatMessage(a.triggerSelectPropertyIsNot,t)}function B(e,t){return e.formatMessage(a.triggerMultiSelectPropertyContains,t)}function E(e,t){return e.formatMessage(a.triggerMultiSelectPropertyDoesNotContain,t)}function F(e,t){return e.formatMessage(a.triggerStatusPropertySet,t)}function N(e){return e.formatMessage(a.deletedPropertyOption)}function O(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsSingle,values:{propertyName:t,propertyValue:o}}}function D(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyContainsMultiple,values:{propertyName:t,propertyValues:o}}}function W(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainSingle,values:{propertyName:t,propertyValue:o}}}function L(e){const{propertyName:t,propertyValues:o}=e;return{...a.triggerPersonPropertyDoesNotContainMultiple,values:{propertyName:t,propertyValues:o}}}function K(e){const{limit:t,optionValues:o,propertySchema:r}=e,a=r.options??[],i=a.length>0,l=o.map((e=>{const t=i?(0,n().jy)(a,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let s=l;if(void 0!==t&&l.length>t){const e=l.length-t;s=[...l.slice(0,t),{type:"truncation",value:`+${e}`}]}return s}function H(e){return e.formatMessage(a.triggerRelativeDate)}},217028:(e,t,o)=>{o.d(t,{RY:()=>S,cn:()=>k,gI:()=>C,m9:()=>A,z$:()=>b});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(743176),l=()=>o(693954),s=()=>o(959013),u=()=>o(534177),c=()=>o(284371),p=()=>o(406699),d=()=>o(682146),m=()=>o(963589),g=()=>o(463830),y=()=>o(656134),h=()=>o(741310),f=()=>o(929531),v=()=>o(541172),x=o(474848);function S(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertySchema:i}=e,l=(0,m().X)("automation_updated_error_states"),s=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),u=A({propertySchema:i,styles:s,hasAutomationUpdatedErrorStatesEnabled:l}),c=k({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:l});return(0,x.jsx)(b,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertyType:i.type,styles:s,tooltip:c,children:u})}function b(e){const{actionMenu:t,buttonPopupStore:o,children:r,disabled:s,onClick:p,propertyType:d,styles:g,tooltip:y,tooltipPlacement:v}=e,S=(0,m().X)("automation_updated_error_states"),b=(0,a().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:S?c().Wy.regular:c().Wy.medium,whiteSpace:"normal"}})),[S]),C=(0,n.useCallback)((e=>(0,x.jsx)(f().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:s,icon:S&&(0,u().O9)(d)?i().LE[d]:l().Q,onClick:p,styles:g,hideDragHandle:!0,children:(0,x.jsx)("div",{style:b.content,children:r})})),[t,o,r,s,S,p,g,d,b]);return(0,x.jsx)(h().P,{renderOrigin:C,title:y,tooltipPlacement:v})}function C(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,y().j)(),l=(0,r().uB)(void 0,g().A),s=(0,n.useCallback)((()=>l.reset()),[l]);return(0,x.jsx)(p().Ay,{buttonPopupStore:l,popupType:i,render:()=>(0,x.jsx)(v().qM,{actionId:t,closeMenu:s,propertyId:o}),renderOrigin:a})}function A(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:n}=e,r=t.type,a=d().dC[r];return n?(0,x.jsx)(s().sA,{defaultMessage:'"{propertyTypeDisplayName}" property type is not supported',id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.titleElement",values:{propertyTypeDisplayName:a}}):(0,x.jsx)(s().sA,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:(0,x.jsx)("span",{style:o.propertyType,children:a})}})}function k(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e,n=t.type,r=d().dC[n];return o?(0,x.jsx)(s().sA,{defaultMessage:"Change property type or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedUnsupportedProperty.title"}):(0,x.jsx)(s().sA,{defaultMessage:"{propertyTypeDisplayName} property type is not supported",id:"updateThisPageUnsupportedPropertyAction.unsupportedProperty.title",values:{propertyTypeDisplayName:r}})}},217827:(e,t,o)=>{o.d(t,{A:()=>a});var n=()=>o(821062);class r extends(()=>o(757695))().default{getInitialState(){return{automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0}}blur(e){void 0!==this.state.automationStore&&(void 0===e||(0,n().A)(this.state,e))&&this.setState({automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0})}focus(e){(0,n().A)(this.instanceState,e)||this.setState(e)}}const a=new r;(0,o(604341).exposeDebugValue)("AutomationFocusStore",r)},231713:(e,t,o)=>{o.d(t,{E:()=>i});o(16280),o(898992),o(672577);var n=()=>o(247331),r=()=>o(791089),a=()=>o(919709);function i(e){const{action:t,currentSimpleFormulaValueTokens:o,onCheckboxClick:i,setCurrentTokens:l,value:s}=e;if(s.kind!==n().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const u=Boolean(o.find((e=>(0,r().isAnnotationSimpleValueToken)(e)&&(0,a().s1Y)(e)&&(0,a().iVq)(e).id===s.id))),c=(0,a().CA$)({id:s.id});return{annotation:c,isChecked:u,itemAction:()=>{l("append"===t?u?(0,r().simpleFormulaValueWithoutToken)(o,c):[...o,c]:[c]),null==i||i()}}}},237985:(e,t,o)=>{o.d(t,{II:()=>h,qC:()=>f});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(791089),l=()=>o(164153),s=()=>o(959013),u=()=>o(284371),c=()=>o(214973),p=()=>o(741310),d=()=>o(929531),m=()=>o(27511),g=()=>o(16707),y=o(474848);function h(e){const{actionMenu:t,buttonPopupStore:o,disabled:h,onClick:v,propertySchema:x,value:S}=e,b=(0,s().tz)(),C=(0,a().IS)((()=>({content:{alignItems:"baseline"},propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),A=(0,r().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:r}=e;if(!r)return;const a=(0,y.jsx)("span",{style:n.propertyName,children:o.name});if("formula"===r.type)return(0,y.jsx)(s().sA,{...(0,c().qx)({propertyName:a,propertyValue:(0,y.jsx)(g().g,{returnType:{type:"text"}})})});const l=(0,i().fromSimpleFormulaArrayValue)(null==r?void 0:r.value)[0];if("string"!=typeof l)return;const u=(0,m().a)({intl:t,groupValues:[],optionValues:[l],propertySchema:o});if(0===u.length)return;return(0,y.jsx)(s().sA,{...(0,c().qx)({propertyName:a,propertyValue:u})})}({intl:b,propertySchema:x,styles:C,value:S})),[b,x,C,S]),k=(0,r().K8)((()=>f({intl:b,propertySchema:x,value:S})),[b,x,S]),M=(0,n.useCallback)((e=>(0,y.jsx)(d().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:h,icon:l().T,onClick:v,children:(0,y.jsx)("div",{style:C.content,children:A})})),[t,o,h,v,C.content,A]);return A&&k?(0,y.jsx)(p().P,{renderOrigin:M,title:k}):null}function f(e){const{intl:t,propertySchema:o,value:n}=e;if(!n)return;const r=o.name;if("formula"===n.type)return(0,y.jsx)(s().sA,{...(0,c().qx)({propertyName:r,propertyValue:(0,y.jsx)(g().L,{})})});const a=(0,i().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0];if("string"!=typeof a)return;const l=(0,m().a)({intl:t,isText:!0,groupValues:[],optionValues:[a],propertySchema:o});return 0!==l.length?(0,y.jsx)(s().sA,{...(0,c().qx)({propertyName:r,propertyValue:l})}):void 0}},239633:(e,t,o)=>{o.d(t,{O:()=>n});const n=(0,o(959013).YK)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}})},253809:(e,t,o)=>{o.d(t,{A:()=>S,r:()=>k});var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(149375),s=()=>o(274609),u=()=>o(340498),c=()=>o(959013),p=()=>o(284371),d=()=>o(493823),m=()=>o(285790),g=()=>o(928600),y=()=>o(939740),h=()=>o(480095),f=()=>o(722872),v=o(474848);const x=(0,c().YK)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function S(e){const{automationTriggerActionMenuStore:t,customMenuProps:o,headerTitle:n,onClose:r,onDone:a,subHeaderComponent:i,type:l,width:s}=e,u=k({automationTriggerActionMenuStore:t,customMenuProps:o,onClose:r,onDone:a,subHeaderComponent:i,title:n,width:s});return"custom"===l?(0,v.jsx)(C,{...e,menuProps:u}):(0,v.jsx)(b,{...e,menuProps:u})}function b(e){const{sections:t,menuProps:o}=e;return(0,v.jsx)(g().A,{...o,children:(0,v.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:0,sections:t})})}function C(e){const{children:t,menuProps:o}=e;return(0,v.jsx)(g().A,{...o,children:t})}function A(e){const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n,subHeaderComponent:r}=e,s=(0,c().tz)(),g=(0,a().K8)((()=>t.state.stack.length>1),[t]),y=(0,i().IS)((e=>({header:{display:"flex",alignItems:"center",color:e.text.secondary,fontWeight:p().Wy.medium,fontSize:p().J.UISmall.desktop,padding:8,justifyContent:"space-between"},leadingItems:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",whiteSpace:"nowrap"},iconButtonStyle:{height:u().Ev.default,width:u().Ev.default},iconButtonIconStyle:{width:u().Ev.sm,height:u().Ev.sm}})),[]);return void 0!==o||g?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{style:y.header,children:[(0,v.jsxs)("div",{style:y.leadingItems,children:[g&&(0,v.jsx)(m().A,{ariaLabel:s.formatMessage(x.backButtonAriaLabel),icon:l().v,style:y.iconButtonStyle,iconStyle:y.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o]}),n&&(0,v.jsx)(d().p,{onClick:n,isBlue:!0,size:"xs",children:(0,v.jsx)(c().sA,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}),r]}):null}function k(e){const{automationTriggerActionMenuStore:t,customMenuProps:o={},onClose:a,onDone:i,subHeaderComponent:l,title:u,width:p}=e,{isMobile:d}=(0,r().Y0)(),g=(0,c().tz)(),y=(0,n.useCallback)((()=>{1===t.getState().stack.length?a():t.popSettingsItem()}),[t,a]);return(0,n.useMemo)((()=>{let e;return e=d?{...o,minWidth:260,menuType:f().gu.Modal,title:u,left:(0,v.jsx)(m().A,{ariaLabel:g.formatMessage(x.backButtonAriaLabel),icon:s().L,onClick:y}),right:(0,v.jsx)(h().DoneMenuText,{}),onClickRight:()=>{null==i||i(),a()},header:l}:{width:p??266,menuType:f().gu.Popup,maxHeight:"50vh",header:(0,v.jsx)(A,{automationActionMenuStore:t,menuHeaderTitle:u,subHeaderComponent:l,onDone:i})},e}),[t,o,g,d,a,i,y,l,u,p])}},258804:(e,t,o)=>{o.d(t,{A:()=>c});var n=o(296540),r=()=>o(311894),a=()=>o(959013),i=()=>o(760217),l=()=>o(8980),s=()=>o(742971),u=o(474848);function c(e){const{value:t,onChange:o}=e,c=(0,n.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return(0,u.jsx)(i().A,{icon:(0,u.jsx)(l().I,{icon:r().K,color:"secondary"}),title:(0,u.jsx)(a().sA,{...s().D.customFormula}),focused:!1,showExtensionArrow:!0,onClick:c})}},274652:(e,t,o)=>{o.d(t,{A:()=>a});var n=o(296540),r=o(474848);const a=n.forwardRef((function(e,t){const n=(0,o(401497).IS)((t=>({base:{color:e.isBlue?o(100622).Ay.blue:t.text.secondary},buttonMenuItem:{...e.style,...e.disabled?{cursor:"not-allowed"}:{}}})),[e.disabled,e.isBlue,e.style]),{color:a}=n.base;return(0,r.jsx)(o(760217).A,{ref:t,...e,title:(0,r.jsx)("div",{style:{color:a,fill:a},children:e.title}),icon:(0,r.jsx)(o(8980).I,{icon:o(617668).plusIcon,style:{fill:a}}),style:n.buttonMenuItem})}))},277871:(e,t,o)=>{o.d(t,{A:()=>M});o(944114),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(401497),i=(o(898992),o(354520),()=>o(247331)),l=()=>o(791089),s=()=>o(959013),u=()=>o(496603),c=()=>o(38337),p=()=>o(521732),d=()=>o(742971),m=()=>o(524702),g=()=>o(847743),y=()=>o(792540),h=()=>o(47170),f=o(474848);var v=()=>o(722872),x=()=>o(928600),S=()=>o(939740),b=()=>o(480095),C=()=>o(89924),A=()=>o(996027),k=()=>o(231713);function M(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormulas:M,disableFormattingAndMentions:j,disableMobileActionBar:T,disableTemplateVariableMentions:I,formulaTypecheckContextValues:P,menuProps:w,onChange:_,onClose:V,parentRecordStore:R,showGenericHeader:B=!1,value:E}=e,{isMobile:F}=(0,r().Y0)(),{header:N,textInput:O,valueItems:D}=function(e){const{currentSimpleFormulaValueTokens:t,disableEmojiCommands:o,disableFormattingAndMentions:v,disableFormulas:x,disableMobileActionBar:S,disableTemplateVariableMentions:b,formulaTypecheckContextValues:C,onChange:A,onClose:k,parentRecordStore:M,value:j}=e,T=(0,s().tz)(),I=(0,n.useMemo)((()=>C.filter((e=>"text"===e.type.type))),[C]),P=(0,h().O)(),w=(0,n.useCallback)((e=>{A({type:"simple",value:e})}),[A]),_=(0,n.useCallback)((e=>{w(e),k()}),[w,k]),V=(0,n.useCallback)((e=>{const t=void 0!==e[0]?(0,l().toSimpleFormulaSingleValue)(e[0]):void 0;_(t)}),[_]),{store:R}=(0,g().AI)({initialValue:null==j?void 0:j.value,onChange:w}),{isMobile:B}=(0,r().Y0)(),E=(0,a().IS)((e=>({textWrap:{borderRadius:6,lineHeight:"24px",padding:1,...B?{boxShadow:"unset"}:{boxShadow:e.inputBoxShadow,margin:"0 12px"}},simpleFormulaText:{fontSize:12,width:"100%",...B?{padding:"10px"}:{padding:"0px 8px 8px 8px"}},text:{fontSize:12,maxHeight:120,overflow:"auto",...B?{background:"light"===e.mode?e.white:e.selectLightGray[200],margin:0,padding:"10px"}:{background:e.inputBackground,padding:"4px 10px"}}})),[B]),F=u().oE(I.map((e=>{if(e.kind===i().FormulaContextValueKind.ContextValue)return{action:"replace",currentSimpleFormulaValueTokens:t,id:e.id||"",setCurrentTokens:V,value:e}})));let N;return N=P&&M?(0,f.jsx)(p().Y,{...v?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},disabled:!1,disableEmojiCommands:o,disableFormulas:x,disableMobileActionBar:S,disableTemplateVariableMentions:b,formulaTypecheckContextValues:C,onChange:A,onTextEnter:k,parentRecordStore:M,spaceId:P,placeholder:T.formatMessage(d().D.propertyValuePlaceholder),style:E.simpleFormulaText,value:j}):(0,f.jsx)("div",{className:c().CCX,style:E.textWrap,children:(0,f.jsx)(m().A,{disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:o,disableMobileActionBar:S,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:b,...v?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0}:{},onEnter:k,pasteBehavior:"inline",store:R,style:E.text,inPageFind:y().Os.none,placeholder:T.formatMessage(d().D.propertyValuePlaceholder)})}),{header:T.formatMessage(d().D.genericMenuHeader),textInput:N,valueItems:F}}({currentSimpleFormulaValueTokens:t,disableFormulas:M,disableEmojiCommands:o,disableFormattingAndMentions:j,disableMobileActionBar:T,disableTemplateVariableMentions:I,formulaTypecheckContextValues:P,onChange:_,onClose:V,parentRecordStore:R,value:E})||{},W=(0,a().IS)((e=>({header:{...F&&{borderBlockEnd:`1px solid ${e.lightDividerColor}`}}})),[F]),L=(0,n.useMemo)((()=>D.map((e=>{const{annotation:t,itemAction:o}=(0,k().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,f.jsx)(A().A,{annotation:t,disabled:!1,menuArgs:e,parentRecordStore:R}),action:o}}))),[D,R]),K=[];let H;L.length>0&&K.push({key:"textbox",render:e=>(0,f.jsx)(C().A,{...e}),items:L}),H=F?{menuType:v().gu.Modal,right:(0,f.jsx)(b().DoneMenuText,{}),onClickRight:V,minWidth:260}:{menuType:v().gu.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0};const z=B&&(0,f.jsx)(C().A,{style:{paddingBottom:0},title:N}),U=(0,f.jsxs)("div",{style:W.header,children:[!F&&((null==w?void 0:w.header)||z),(0,f.jsx)(C().A,{children:O})]}),Y=(0,f.jsx)(S().Ay,{initialFocus:0,sections:K,type:S().Oh.Vertical});return{headerDiv:U,innerComponents:Y,textMenu:(0,f.jsx)(x().A,{...H,...w,header:U,children:Y})}}},294852:(e,t,o)=>{o.d(t,{A:()=>G});o(944114),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(401497),i=()=>o(100622),l=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(908872),()=>o(908006)),s=()=>o(847249),u=()=>o(970013),c=()=>o(247331),p=()=>o(977345),d=()=>o(791089),m=()=>o(187174),g=()=>o(792071),y=()=>o(919709),h=()=>o(959013),f=()=>o(778078),v=()=>o(496603),x=()=>o(419830),S=()=>o(742971),b=()=>o(258804),C=()=>o(856952),A=()=>o(106628),k=()=>o(361330),M=()=>o(970585),j=()=>o(120423),T=()=>o(674300),I=()=>o(576241),P=o(474848);var w=()=>o(722872),_=()=>o(928600),V=()=>o(939740),R=()=>o(64e3),B=()=>o(480095),E=()=>o(89924),F=()=>o(320865),N=()=>o(996027),O=()=>o(231713),D=()=>o(764880),W=()=>o(798880),L=()=>o(962730),K=()=>o(760217),H=()=>o(625830),z=()=>o(859428),U=()=>o(448693),Y=()=>o(239633),q=()=>o(629203);function $(e){let{annotation:t,disabled:o,getRecordModel:n,isSelected:a,menuArgs:i,showPersonCheckbox:l}=e;const u=(0,r().Y0)(),c=(0,q().U)(),p=(0,s().K8)((()=>{if((0,d().isAnnotationSimpleValueToken)(t)&&(0,y().rie)(t)){const e=(0,y().NcG)(t);return e?(0,D().xC)({pointer:{table:W().oo,id:e},getRecordValue:n}):void 0}}),[t,n]);return null!=p&&p.asActor&&p.table===W().oo?(0,P.jsx)(K().A,{...i,...l?{icon:(0,P.jsx)(H().A,{checked:a,size:14,onClick:i.onClick})}:{},title:o?(0,P.jsx)(z().A,{renderTooltip:()=>(0,P.jsx)(h().sA,{...Y().O.maximumPeopleSelectedTooltip}),placement:L().W.Right,render:e=>(0,P.jsx)("div",{style:{width:"100%"},...e,children:(0,P.jsx)(U().t_,{isSingle:!0,shouldShrink:!0,format:u.isMobile?U().t_.Format.Large:U().t_.Format.Medium,userValue:p.asActor})})}):(0,P.jsx)(U().t_,{isSingle:!0,shouldShrink:!0,format:u.isMobile?U().t_.Format.Large:U().t_.Format.Medium,userValue:p.asActor}),disabled:o,style:o?c.disabledMenuItem:void 0,isTokenTitle:!0}):null}function G(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:D,formulaValueContext:W,getRecordModel:L,isDisabled:K,limit:H,menuProps:z,onChange:U,onClose:Y,showClearButton:q=!1,showFormulaValueItems:G=!1,showGenericHeader:Q=!1,showInputMenuItem:X=!1,showPersonCheckbox:Z=!1,showReplaceAddRemoveToggle:J=!1,value:ee,parentRecordStore:te}=e,oe=(0,r().Y0)(),ne=(0,a().IS)((e=>({genericHeader:{paddingBottom:0},headerDiv:{paddingBlockEnd:oe.isMobile?0:6,borderBlockEnd:oe.isMobile?"none":`1px solid ${i().Ay.dividerColor}`},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[oe.isMobile]),{errorMessage:re,footer:ae,header:ie,isLoading:le,menuListStore:se,noResultsMessage:ue,replaceAddRemoveToggleButton:ce,searchInput:pe,userItems:de,valueItems:me}=function(e){var t,o;const{action:a,formulaTypecheckContextValues:i,formulaValueContext:w,isDisabled:_=!1,limit:V,onChange:R,onClose:B,showClearButton:E,showReplaceAddRemoveToggle:F,showSelectedPeople:N,unlimitedCurrentSimpleFormulaValueTokens:O,value:D}=e,W=(0,r().v3)(),L=(0,r().Y0)(),K=(0,h().tz)(),H="collection"===(null==w?void 0:w.type)?w.collectionStore.getRecordModel:g().b4_.constant(void 0),z=(0,x().pg)(w),U=z(O,"first"),Y=(0,n.useMemo)((()=>i.filter((e=>(0,p().o5)(e.type,{type:"person"})))),[i]),[q,$]=(0,n.useState)(""),G=(0,s().uB)(void 0,M().A),Q=(0,s().K8)((()=>{if("collection"!==w.type)return!1;const e=w.collectionStore.getSchema()[w.property];return e&&(0,u().sO)(e)?1===e.limit:void 0}),[w]),[X]=(0,m().Yb)((async()=>{const e=q?(0,f().Ay)(q,Y,(e=>e.kind===c().FormulaContextValueKind.ContextValue?e.name:"")):Y,t=await A().T.searchActions.load(),o=await t.searchVisibleSpaceUsers({environment:W,query:q,membersOnly:!1}),n=(0,d().fromSimpleFormulaArrayValue)(null==D?void 0:D.value).reduce(((e,t)=>(t&&(0,d().isAnnotationSimpleValueToken)(t)&&(0,y().rie)(t)&&e.push(t[1]),e)),[]);let r=0,a=o[r];const i=[];for(;a&&i.length<20;)n.includes(a.id)&&!N||i.push(a.id),r+=1,a=o[r];return{valueResults:e,userResults:i}}),[W,q,N,Y,null==D?void 0:D.value],{debounce:k().tu}),Z=(0,n.useCallback)((()=>{$(""),G.setState({...G.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[G]),J=(0,n.useCallback)(((e,t)=>{R(e||D,t||a)}),[a,R,D]),ee=(0,n.useCallback)((e=>{const t=z(e,"last");J({type:"simple",value:(0,d().toSimpleFormulaArrayValue)(t)}),Z()}),[z,J,Z]),te=(0,n.useCallback)((()=>{ee(U.slice(0,U.length-1))}),[U,ee]),oe=(0,n.useCallback)((e=>{null==ee||ee((0,d().simpleFormulaValueWithoutToken)(U,e))}),[U,ee]),ne=Boolean(V&&U.length>=V),re=v().oE(U.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,y().rie)(e)?(0,P.jsx)(I().A,{handleRemoveToken:oe,token:e},t):(0,y().s1Y)(e)?(0,P.jsx)(T().A,{formulaTypecheckContextValues:i,handleRemoveToken:oe,isDisabled:_||ne,token:e},t):null))),ae=new Set(v().oE(U.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,y().s1Y)(e)&&(0,y().iVq)(e).id)))),ie=new Set(v().oE(U.map((e=>(0,d().isAnnotationSimpleValueToken)(e)&&(0,y().rie)(e)&&(0,y().NcG)(e))))),le=v().oE(((null===(t=X.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===c().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!ae.has(t)||N)return{action:"append",currentSimpleFormulaValueTokens:U,isDisabled:_||ne,id:t,getRecordModel:H,setCurrentTokens:ee,value:e}}))),se=v().oE(((null===(o=X.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=ie.has(e);if(t&&!N)return;const o=(0,y().P4h)(e);return{action:()=>{t?oe(o):ee([...U,o]),Q&&l().default.afterNextFlush((()=>{B()}))},annotation:o,getRecordModel:H,id:e,isDisabled:_||ne,userId:e,isSelected:t}}))),ue=[...le,...se],ce=(0,P.jsx)("div",{style:{...!L.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,P.jsx)(C().Ay,{style:{maxHeight:6*parseInt(C().sA,10)},disabled:_||ne,dontShowBorderBottom:L.isAndroid,focus:!L.isMobile||void 0,focusAfterAnimation:!0,format:C().le.FilterValue,onChange:e=>$(e.target.value),onClearButtonClick:()=>ee([]),onRemoveLastToken:te,placeholder:K.formatMessage(S().D.personSearchPlaceholder),showClearButton:E,tokens:re,value:q})}),pe=(0,P.jsx)(b().A,{value:D,onChange:J}),de=(0,P.jsx)(j().A,{action:a,handleOnChange:J});return{errorMessage:X.error&&K.formatMessage(S().D.somethingWentWrong),footer:pe,header:K.formatMessage(S().D.genericMenuHeader),isLoading:!X.value&&!X.error,menuListStore:G,noResultsMessage:0===ue.length&&X.value&&K.formatMessage(S().D.noResults),replaceAddRemoveToggleButton:Boolean(F)&&de,searchInput:ce,userItems:se,valueItems:le}}({action:t,formulaTypecheckContextValues:D,formulaValueContext:W,isDisabled:K,limit:H,onChange:U,onClose:Y,showClearButton:q,showReplaceAddRemoveToggle:J,showSelectedPeople:Z,unlimitedCurrentSimpleFormulaValueTokens:o,value:ee})||{},ge=[...(0,n.useMemo)((()=>me&&G?me.map((e=>{const{annotation:t,itemAction:o}=(0,O().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,P.jsx)(N().A,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:D,menuArgs:o,parentRecordStore:te}),action:o}})):[]),[D,G,me,te]),...(0,n.useMemo)((()=>de?de.map((e=>({key:e.userId,render:t=>(0,P.jsx)($,{annotation:e.annotation,disabled:e.isDisabled,getRecordModel:L||e.getRecordModel,isSelected:e.isSelected,menuArgs:t,showPersonCheckbox:Z}),action:e.action}))):[]),[L,Z,de])],ye=[];let he;ge.length>0&&ye.push({key:"users",render:e=>(0,P.jsx)(E().A,{...e}),items:ge}),he=oe.isMobile?{menuType:w().gu.Modal,minWidth:260,right:(0,P.jsx)(B().DoneMenuText,{}),onClickRight:Y,footer:ae&&(0,P.jsx)(E().A,{topBorder:!0,children:ae})}:{menuType:w().gu.Popup,maxHeight:"50vh",width:260,footer:ae&&(0,P.jsx)(E().A,{topBorder:!0,children:ae}),disableHeaderBorder:!0};const fe=Q&&(0,P.jsx)(E().A,{style:ne.genericHeader,title:ie}),ve=(0,P.jsxs)("div",{style:ne.headerDiv,children:[!oe.isMobile&&((null==z?void 0:z.header)||fe),X&&pe]}),xe=(0,P.jsxs)(P.Fragment,{children:[re&&(0,P.jsx)(E().A,{children:(0,P.jsx)(R().A,{title:re})}),!le&&!re&&ce&&(0,P.jsx)("div",{style:ne.replaceAddRemoveToggleButton,children:ce}),ue&&(0,P.jsx)(E().A,{children:(0,P.jsx)(R().A,{title:ue})}),le&&(0,P.jsx)(E().A,{children:(0,P.jsx)(F().A,{})}),ge.length>0&&(0,P.jsx)(V().Ay,{type:V().Oh.Vertical,initialFocus:0,sections:ye,store:se})]});return{headerDiv:ve,innerComponents:xe,personArrayMenu:(0,P.jsx)(_().A,{...he,...z,header:ve,children:xe})}}},307159:(e,t,o)=>{o.d(t,{A:()=>T,m:()=>j});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(784892),l=()=>o(869190),s=()=>o(977345),u=()=>o(791089),c=()=>o(416504),p=()=>o(758219),d=()=>o(919709),m=()=>o(959013),g=()=>o(534177),y=()=>o(284371),h=()=>o(684125),f=()=>o(419830),v=()=>o(881690),x=()=>o(214973),S=()=>o(133518),b=()=>o(741310),C=()=>o(929531),A=()=>o(436876),k=()=>o(16707),M=o(474848);function j(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:j,disabled:P,onClick:w,propertySchema:_,value:V,valueContext:R}=e,B=(0,m().tz)(),E=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...y().RC,fontWeight:y().Wy.medium}})),[]),F=(0,S().F)({actionId:o.id}),N=(0,r().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,typecheckContextValues:r,value:a,valueContext:p}=e,S=(0,M.jsx)("span",{style:n.propertyName,children:o.name});if(void 0===(null==a?void 0:a.value))return(0,M.jsx)(m().sA,{...x().NW({propertyName:S})});let b;const C="formula"===a.type,j=(0,u().fromSimpleFormulaArrayValue)(null==a?void 0:a.value)[0];if(C)b=(0,M.jsx)(k().g,{returnType:{type:"date"}});else if(!(0,g().O9)(j)||"string"==typeof j||"boolean"==typeof j||(0,d().rie)(j)||(0,d().jIt)(j))b=(0,M.jsx)(v().A,{format:i().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:y().RC,children:(0,M.jsx)(m().sA,{...x().CV.unknownValue})})});else if((0,d().s1Y)(j)){const e=(0,d().iVq)(j).id,t=(0,s().IV)(r,e);b=t?(0,M.jsx)(h().F,{value:t,format:i().NY.Medium,isSingle:!1,shouldShrink:!0}):(0,M.jsx)(v().A,{format:i().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,M.jsx)("span",{style:y().RC,children:(0,M.jsx)(m().sA,{...x().CV.unknownValue})})})}else if((0,d().qsB)(j)){const e=(0,f().aS)(p),o=(0,d().K7D)(j);b=o?(0,l().zV)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,c().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,g().O9)(o)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(I,{value:n})," → ",(0,M.jsx)(I,{value:o})]}):(0,g().O9)(t)?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(I,{value:n})," → ",(0,M.jsx)(I,{value:t})]}):(0,M.jsx)(I,{value:n})}}):null}else{if((0,d().iz3)(j))return(0,M.jsx)(A().A,{token:j});(0,g().HB)(j)}return void 0===b?void 0:(0,M.jsx)(m().sA,{...x().Oo({propertyName:S,propertyValue:b})})}({intl:B,propertySchema:_,styles:E,typecheckContextValues:F,value:V,valueContext:R})),[B,_,E,F,V,R]),O=(0,r().K8)((()=>T({intl:B,propertySchema:_,typecheckContextValues:F,value:V,valueContext:R})),[B,_,F,V,R]),D=(0,n.useCallback)((e=>(0,M.jsx)(C().aX,{...e,actionMenu:t,buttonPopupStore:j,disabled:P,icon:p().Z,onClick:w,children:(0,M.jsx)("div",{style:E.content,children:N})})),[t,j,P,w,E.content,N]);return N&&O?(0,M.jsx)(b().P,{disable:P,renderOrigin:D,title:O}):null}function T(e){const{intl:t,propertySchema:o,typecheckContextValues:n,value:r,valueContext:a}=e,i=o.name;if(void 0===(null==r?void 0:r.value))return(0,M.jsx)(m().sA,{...x().NW({propertyName:i})});let p;const y="formula"===r.type,h=(0,u().fromSimpleFormulaArrayValue)(r.value)[0];if(y)p=(0,M.jsx)(k().L,{});else if(!(0,g().O9)(h)||"string"==typeof h||"boolean"==typeof h||(0,d().rie)(h)||(0,d().jIt)(h)||(0,d().iz3)(h))p=(0,M.jsx)(m().sA,{...x().CV.unknownValue});else if((0,d().s1Y)(h)){const e=(0,d().iVq)(h).id,t=(0,s().IV)(n,e);p=t?(0,s().sM)(t):(0,M.jsx)(m().sA,{...x().CV.unknownValue})}else if((0,d().qsB)(h)){const e=(0,f().aS)(a),o=(0,d().K7D)(h);p=o?(0,l().ZF)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,c().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,g().HB)(h);return void 0===p?void 0:(0,M.jsx)(m().sA,{...x().Oo({propertyName:i,propertyValue:p})})}function I(e){const{value:t}=e,o=(0,a().IS)((e=>({token:{marginBlockEnd:4},tokenBackgroundColor:{backgroundColor:e.accentColors.gray[75]}})),[]);return(0,M.jsx)(v().A,{backgroundColor:o.tokenBackgroundColor.backgroundColor,format:i().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:o.token,value:t})}},310109:(e,t,o)=>{o.r(t),o.d(t,{getAllContextValues:()=>f,getContextValueForActionById:()=>x,getContextValuesForAction:()=>v,typecheckAutomation:()=>y,typecheckAutomationAsync:()=>h});o(944114),o(898992),o(581454),o(737550);var n=()=>o(496603),r=()=>o(973647),a=()=>o(534177),i=()=>o(999515),l=()=>o(977345),s=()=>o(81768),u=()=>o(638458),c=()=>o(322867),p=()=>o(281994),d=()=>o(648651),m=()=>o(103966);function*g(e){const{actionModels:t,automationModel:o,contextType:g,formulasModule:y,runtimeStats:h}=e,f={valueTypes:e.valueTypes,actionInputValueTypes:{},actionValidationFailures:{}},v=performance.now();let x,S,b;if("button_block"===g||"button_property"===g){if(!o.isButtonType())return{error:new(c().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();b=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else if("event"===g){if(!o.isEventType())return{error:new(c().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();b=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else if("recurrence"===g){if(!o.isRecurrenceType())return{error:new(c().N9)(`Automation trigger (${o.getTriggerType()}) does not match context type (${g}).`)};const t=o.getTrigger();b=(0,m().Z)(o.getTriggerType()).typecheck(e,t)}else(0,a().HB)(e);if(r().Q.isFail(b))return b;f.valueTypes.push(...n().o8(b.value.valueTypes));for(const a of t){x=void 0,h&&(x=d().hs.getOrCreateAction(h,a.pointer,a.getType()));const t=(0,s().getActionRegistryItem)(a.getType());if(!t){S={error:new(c().oM)({actionId:a.id,message:`Unsupported action type: ${a.getType()}`})};break}const m=performance.now(),g=(0,u().Q)({automationModel:o,formulasModule:y,formulaValueTypes:f.valueTypes}),v=(0,p().HI)(yield*t.resolveExecutionDependencies(g,a));yield*i().q.fetchRecords(v.map((e=>e.pointer))),x&&(x.totalDependencies=v.length,x.getDependenciesDurationMs=Math.trunc(performance.now()-m));const b=t.typecheck(e,a),C=n().o8(f.valueTypes);if(f.actionInputValueTypes[a.id]=C,r().Q.isFail(b)){S=b;break}for(const e of b.value.valueTypes??[]){f.valueTypes.some((t=>(0,l().oH)(e,t)))||f.valueTypes.push(e)}b.value.validationFailures&&b.value.validationFailures.length>0&&(f.actionValidationFailures[a.id]=b.value.validationFailures)}const C=Math.trunc(performance.now()-v);return h&&(h.typecheckStartTime=v,h.typecheckDurationMs=C,h.typecheckSuccess=!(0,a().O9)(S)),S??{value:f}}function y(e){return i().q.runSync(e.getRecordModel,g(e))}async function h(e){return await i().q.runAsync(e.loadRecordModel,g(e))}function f(e){return r().Q.isFail(e)?[]:e.value.valueTypes.slice(0)}function v(e,t){return r().Q.isFail(e)?[]:e.value.actionInputValueTypes[t]??[]}function x(e,t,o){const n=v(e,t);return(0,l().IV)(n,o)}},324254:(e,t,o)=>{o.r(t),o.d(t,{arrowChevronSingleDownSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"m12.76 6.52-4.32 4.32a.62.62 0 0 1-.44.18.62.62 0 0 1-.44-.18L3.24 6.52a.63.63 0 0 1 0-.88c.24-.24.64-.24.88 0L8 9.52l3.88-3.88c.24-.24.64-.24.88 0s.24.64 0 .88"})},r=(0,o(340498).wt)("arrowChevronSingleDownSmall",n)},340743:(e,t,o)=>{o.d(t,{G:()=>l});o(296540);var n=()=>o(401497),r=()=>o(100622),a=()=>o(284371),i=o(474848);function l(e){const{children:t,icon:o,shouldTruncateChildren:l}=e,s=(0,n().IS)((e=>{const t=(0,r().LD)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...l?a().RC:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:l?50:void 0,padding:"0 8px"}}}),[l]);return(0,i.jsxs)("span",{style:s.wrap,children:[o&&(0,i.jsx)("span",{"aria-hidden":"true",style:s.iconWrap,children:o}),(0,i.jsx)("span",{style:s.textWrap,children:t})]})}},347114:(e,t,o)=>{o.d(t,{S:()=>m,j:()=>g});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(281067),l=()=>o(959013),s=()=>o(284371),u=()=>o(741310),c=()=>o(929531),p=()=>o(3867),d=o(474848);const m=5;function g(e){const{action:t,actionMenu:o,buttonPopupStore:g,disabled:y,limit:h=m,onClick:f,propertySchema:v,value:x}=e,S=(0,l().tz)(),b=(0,a().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().RC,fontWeight:s().Wy.medium}})),[]),C=(0,r().K8)((()=>(0,p().mk)({intl:S,limit:h,propertySchema:v,styles:b,operator:t,value:x})),[S,h,v,b,t,x]),A=(0,r().K8)((()=>(0,p().cI)({intl:S,limit:h,propertySchema:v,operator:t,value:x})),[t,S,h,v,x]),k=(0,n.useCallback)((e=>(0,d.jsx)(c().aX,{...e,actionMenu:o,buttonPopupStore:g,disabled:y,icon:i().v,onClick:f,children:(0,d.jsx)("div",{style:b.content,children:C})})),[o,g,y,f,b.content,C]);return(0,d.jsx)(u().P,{renderOrigin:k,title:A})}},359186:(e,t,o)=>{o.d(t,{EJ:()=>T,Jx:()=>V,T7:()=>_,Vj:()=>w,Zd:()=>I,ef:()=>P,hF:()=>j});var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(617073),s=()=>o(966098),u=()=>o(818256),c=()=>o(523872),p=()=>o(263931),d=()=>o(352064),m=()=>o(161479),g=()=>o(959013),y=()=>o(284371),h=()=>o(712030),f=()=>o(921855),v=()=>o(546461),x=()=>o(214973),S=()=>o(133518),b=()=>o(741310),C=()=>o(929531),A=()=>o(16707),k=o(474848);function M(e){const{actionMenu:t,automationActionStore:o,buttonPopupStore:l,disabled:s,icon:u,onClick:c,propertySchema:p,value:d}=e,{automationStore:M}=(0,v().EC)(),T=(0,r().v3)(),I=(0,i().DP)(),P=(0,i().IS)((()=>({propertyName:{...y().RC,fontWeight:y().Wy.medium,flexShrink:0}})),[]),w=(0,S().F)({actionId:o.id}),_=(0,a().K8)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:r,theme:a,typecheckContextValues:i,value:l}=e,s=(0,k.jsx)("span",{style:r.propertyName,children:n.name}),u=void 0===(null==l?void 0:l.value);if(u)return(0,k.jsx)(g().sA,{...x().NW({propertyName:s})});let c;const p="formula"===l.type;if(p)c=(0,k.jsx)(A().g,{returnType:{type:"text"}});else{const e=(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,h().FN)(o),environment:o,formulaValueTypes:i,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:l.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:a});c=(0,k.jsxs)(k.Fragment,{children:['"',(0,k.jsx)("span",{style:y().RC,children:e}),'"']})}return(0,k.jsx)(g().sA,{...x().LK({propertyName:s,propertyValue:c})})}({automationStore:M,environment:T,propertySchema:p,styles:P,theme:I,typecheckContextValues:w,value:d})),[M,T,p,P,I,w,d]),V=(0,a().K8)((()=>j({automationStore:M,environment:T,propertySchema:p,theme:I,typecheckContextValues:w,value:d})),[M,T,p,I,w,d]),R=(0,n.useCallback)((e=>(0,k.jsx)(C().aX,{...e,actionMenu:t,buttonPopupStore:l,disabled:s,icon:u,onClick:c,children:_})),[t,l,s,u,c,_]);return _&&V?(0,k.jsx)(b().P,{renderOrigin:R,title:V}):null}function j(e){const{automationStore:t,environment:o,propertySchema:n,theme:r,typecheckContextValues:a,value:i}=e,l=n.name;if(void 0===(null==i?void 0:i.value))return(0,k.jsx)(g().sA,{...x().NW({propertyName:l})});let s;return s="formula"===i.type?(0,k.jsx)(A().L,{}):(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableFormulaVariableStyles:!0,disableHover:!0,disableInsertedDeletedAnnotations:!0,disableLinks:!0,disableStyleAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,h().FN)(o),environment:o,formulaValueTypes:a,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:i.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:r}),(0,k.jsx)(g().sA,{...x().LK({propertyName:l,propertyValue:s})})}function T(e){return(0,k.jsx)(M,{...e,icon:p().D})}function I(e){return(0,k.jsx)(M,{...e,icon:c().U})}function P(e){return(0,k.jsx)(M,{...e,icon:l().J})}function w(e){return(0,k.jsx)(M,{...e,icon:d().I})}function _(e){return(0,k.jsx)(M,{...e,icon:s().E})}function V(e){return(0,k.jsx)(M,{...e,icon:u().C})}},366360:(e,t,o)=>{o.d(t,{b:()=>l,k:()=>s});o(16280);var n=o(296540),r=()=>o(847249),a=()=>o(546461),i=()=>o(911724);function l(){return(0,n.useContext)(i().A)}function s(){const{automationStore:e}=(0,a().EC)(),{collectionStore:t,...o}=l(),n=(0,r().K8)((()=>{if(!(null!=e&&e.isTriggerType("event")||null!=e&&e.isTriggerType("recurrence")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return e}),[e]);if(!t)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...o,collectionStore:t,automationStore:n}}},383574:(e,t,o)=>{o.d(t,{V:()=>s});o(898992),o(354520);var n=()=>o(847249),r=()=>o(81768),a=()=>o(352271),i=()=>o(157857),l=()=>o(546461);function s(){const{automationStore:e,contextType:t}=(0,l().EC)(),o=(0,n().K8)((()=>(0,i().Z6)(e,t)),[e,t]);return(0,n().K8)((()=>{if(!o)return[];const{automation:e,automationActions:t}=o,n=e.getTriggerType(),i=(0,a().ad)({isGenericRecurrenceAllowed:!0})[n],l="default_bound"===i.max?a().x3:i.max;if(t.length>=l)return[];return function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.hasSideEffects)-t(e.hasSideEffects)))}((0,r().getActionRegistryItemsWithConcern)("display").filter((e=>e.isAvailableForContext({...o,isSubscribed:!0}))))}),[o])}},383688:(e,t,o)=>{o.d(t,{Hk:()=>g,ZZ:()=>d});o(898992),o(354520),o(296540);var n=()=>o(401497),r=()=>o(834368),a=()=>o(486521),i=()=>o(959013),l=()=>o(284371),s=()=>o(340743),u=()=>o(214973),c=()=>o(989064),p=o(474848);function d(e){const t=(0,i().tz)(),{propertySchema:o,filter:n,onClick:r}=e;return(0,p.jsx)(c().z,{onClick:r,tooltip:g({filter:n,intl:t,propertySchema:o}),children:(0,p.jsx)(m,{propertySchema:o,filter:n})})}function m(e){let{propertySchema:t,filter:o}=e;const r=(0,i().tz)(),a=(0,n().IS)((()=>({propertyName:{...l().RC,fontWeight:l().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),s=function(e){const{filter:t,intl:o,propertySchema:n,styles:r}=e,a=n.name,i=t.value,l={propertyName:(0,p.jsx)("span",{style:r.propertyName,children:a}),propertyValues:(0,p.jsx)(y,{checkboxValue:i.value??!1})};return(0,u().T2)(o,l)}({filter:o,intl:r,propertySchema:t,styles:a});return(0,p.jsx)("span",{style:a.wrap,children:s})}function g(e){const{filter:t,intl:o,propertySchema:n}=e,r={propertyName:n.name,propertyValues:!0===t.value.value?(0,p.jsx)(i().sA,{...u().CV.actionCheckboxPropertyChecked}):(0,p.jsx)(i().sA,{...u().CV.actionCheckboxPropertyUnchecked})};return(0,u().T2)(o,r)}function y(e){const{checkboxValue:t}=e,o=!0===t?(0,a().v)({width:12}):(0,r().K)({width:10}),n=!0===t?(0,p.jsx)(i().sA,{...u().CV.actionCheckboxPropertyChecked}):(0,p.jsx)(i().sA,{...u().CV.actionCheckboxPropertyUnchecked});return(0,p.jsx)(s().G,{icon:o,children:n})}},397785:(e,t,o)=>{o.d(t,{H:()=>b,hs:()=>S,oG:()=>v});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),o(296540);var n=()=>o(847249),r=()=>o(401497),a=()=>o(764880),i=()=>o(713998),l=()=>o(784892),s=()=>o(247331),u=()=>o(919709),c=()=>o(959013),p=()=>o(534177),d=()=>o(284371),m=()=>o(448693),g=()=>o(684125),y=()=>o(16707),h=()=>o(214973),f=o(474848);function v(e){const{messageType:t}=e,o=(0,c().tz)(),a=(0,r().IS)((()=>({content:{display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...d().RC,fontWeight:d().Wy.medium},propertyValue:{...d().RC},propertyValueList:{display:"flex",flexBasis:"100%",listStyle:"none",margin:0,padding:0,width:"100%",columnGap:4,rowGap:4},inlineActorTokenContainer:{...d().RC,paddingBlockStart:1},inlineActorToken:{margin:0,paddingRight:0}})),[]),i=(0,n().K8)((()=>"action"===t?function(e){const{getRecordModel:t,contextValues:o,intl:n,operator:r,propertySchema:a,styles:i,value:l}=e;let s;const u=(0,f.jsx)("span",{style:i.propertyName,children:a.name});if("formula"===(null==l?void 0:l.type))s=r?h().f4({operator:r,propertyName:u,propertyValue:(0,f.jsx)(y().g,{returnType:{type:"person"}})}):h().Pb({propertyName:u,propertyValue:(0,f.jsx)(y().g,{returnType:{type:"person"}})});else{const e=x({getRecordModel:t,propertySchema:a,value:l}),c=A(l,o),p=C({actors:e,values:c,showAsList:!1,styles:i}),d=e.length+c.length;s=r?h().f4({...h().f_({elements:Array.isArray(p)?p:[p],intl:n}),operator:r,propertyName:u}):0===d?h().NW({propertyName:u}):h().Pb({propertyName:u,propertyValue:p})}return(0,f.jsx)(c().sA,{...s})}({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value,operator:e.operator}):"trigger"===t?function(e){const{actorModels:t,propertySchema:o,styles:n,operator:r}=e;if(!t)return null;const a=(0,f.jsx)("span",{style:n.propertyName,children:o.name}),i=C({actors:t,values:[],styles:n,showAsList:!0});let l;if(1===t.length){l=("person_contains"===r?h().a9:h().dd)({propertyName:a,propertyValues:i})}else{l=("person_contains"===r?h()._d:h().Fp)({propertyName:a,propertyValues:i})}return(0,f.jsx)(c().sA,{...l})}({actorModels:e.actorModels,propertySchema:e.propertySchema,operator:e.operator,styles:a}):void(0,p().HB)(t)),[t,e,o,a]);return{tooltipTitle:(0,n().K8)((()=>"action"===t?S({getRecordModel:e.getRecordModel,contextValues:e.contextValues,intl:o,propertySchema:e.propertySchema,styles:a,value:e.value}):"trigger"===t?b({actorModels:e.actorModels,intl:o,operator:e.operator,propertySchema:e.propertySchema,styles:a}):void(0,p().HB)(t)),[t,e,o,a]),title:i,styles:a}}function x(e){const{getRecordModel:t,propertySchema:o,value:n}=e;return(0,i().e5)({blockCreatorPointer:void 0,propertySchema:o,textValue:null==n?void 0:n.value}).map((e=>(0,a().xC)({getRecordModel:t,pointer:e}))).filter(p().O9)}function S(e){const{getRecordModel:t,contextValues:o,intl:n,operator:r,propertySchema:i,styles:l,value:s}=e;let u;const p=(0,f.jsx)("span",{style:null==l?void 0:l.propertyName,children:i.name});if("formula"===(null==s?void 0:s.type))u=r?h().f4({operator:r,propertyName:p,propertyValue:(0,f.jsx)(y().L,{})}):h().Pb({propertyName:p,propertyValue:(0,f.jsx)(y().L,{})});else{const e=x({getRecordModel:t,propertySchema:i,value:s}),l=e.map((e=>(0,a().lR)(n,e))),c=A(s,o),d=c.map((e=>e.tooltipName??e.name)),m=n.formatList([...l,...d],{style:"long",type:"conjunction"}),g=e.length+c.length;u=r?h().f4({propertyName:p,propertyValue:m,operator:r}):0===g?h().NW({propertyName:p}):h().Pb({propertyName:p,propertyValue:m})}return(0,f.jsx)(c().sA,{...u})}function b(e){const{actorModels:t,intl:o,propertySchema:n,styles:r,operator:i}=e;if(!t)return null;const l=(0,f.jsx)("span",{style:null==r?void 0:r.propertyName,children:n.name}),s=t.map((e=>(0,a().lR)(o,e))),u=o.formatList(s,{style:"long",type:"conjunction"});let p;if(1===t.length){p=("person_contains"===i?h().a9:h().dd)({propertyName:l,propertyValues:u})}else{p=("person_contains"===i?h()._d:h().Fp)({propertyName:l,propertyValues:u})}return(0,f.jsx)(c().sA,{...p})}function C(e){const{actors:t,styles:o,showAsList:n=!0,values:r}=e,a=[...t.map(((e,t)=>(0,f.jsx)(m().Ay,{style:o.inlineActorToken,actor:e,showRemoveButton:!1,format:l().NY.Medium,isSingle:!1},t))),...r.map(((e,t)=>(0,f.jsx)(g().F,{style:o.inlineFormulaValue,format:l().NY.Medium,isSingle:!1,value:e},t)))];return 1===a.length?(0,f.jsx)("div",{style:o.propertyValue,children:a[0]}):n?(0,f.jsx)("ul",{style:o.propertyValueList,children:a.map(((e,t)=>(0,f.jsx)("li",{children:(0,f.jsx)("div",{style:o.propertyValue,children:e},t)},t)))}):a.map(((e,t)=>(0,f.jsx)("div",{style:o.inlineActorTokenContainer,children:e},t)))}function A(e,t){const o=new Set(u().kNd(null==e?void 0:e.value).map((e=>e.id))),n=s().FormulaContextValueKind.ContextValue;return t.filter((e=>e.kind===n)).filter((e=>o.has(e.id)))}},404412:(e,t,o)=>{o.d(t,{AK:()=>r,ew:()=>a});class n extends(()=>o(757695))().default{getInitialState(){return{insertionPoint:void 0,stack:[]}}getCurrentTab(){return o(496603).HV(this.getState().stack)}getInsertionPoint(){return this.getState().insertionPoint}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({...e,stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}setInsertionPoint(e){this.update((t=>({...t,insertionPoint:e})))}}class r extends n{}class a extends n{}},413194:(e,t,o)=>{o.d(t,{L:()=>Pe,g:()=>M});o(898992),o(672577);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(970013),l=()=>o(713998),s=()=>o(784892),u=()=>o(977345),c=()=>o(791089),p=()=>o(919709),d=()=>o(973647),m=()=>o(534177),g=()=>o(529135),y=()=>o(436876),h=()=>o(576241),f=()=>o(546461),v=()=>o(625830),x=()=>o(654734),S=()=>o(566081),b=()=>o(399762),C=()=>o(684125),A=()=>o(419830),k=o(474848);function M(e){const{token:t,disabled:o,setCurrentTokens:n,currentSimpleFormulaValueTokens:M,context:j,parentRecordStore:T}=e,I=(0,r().Y0)(),{typecheckResult:P}=(0,f().YC)(),w=(0,a().K8)((()=>{if("collection"===j.type)return(0,A().aS)(j)}),[j]),_=(0,a().K8)((()=>{if("collection"===j.type)return j.collectionStore.getSchema()[j.property]}),[j]);if("string"==typeof t){if(!_||!(0,i().DQ)(_))return null;const e=(0,l().jy)((null==_?void 0:_.options)??[],t);if(!e)return(0,k.jsx)(g().A,{isSingle:!1,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,c().simpleFormulaValueWithoutToken)(M,t))}},`deleted_option_value_${t}`);const r={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!o,format:I.isMobile?s().NY.Medium:s().NY.Small,onClickRemove:()=>{null==n||n((0,c().simpleFormulaValueWithoutToken)(M,t))}};if((0,i().DD)(_)){var V;const t=null===(V=_.groups)||void 0===V||null===(V=V.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===V?void 0:V.color;return(0,k.jsx)(b().q,{...r,groupColor:t})}return(0,k.jsx)(b().O,{...r})}if("boolean"==typeof t)return(0,k.jsx)(v().A,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,p().rie)(t))return(0,k.jsx)(h().A,{handleRemoveToken:o?void 0:()=>{null==n||n((0,c().simpleFormulaValueWithoutToken)(M,t))},token:t});if((0,p().s1Y)(t)){const e=(0,p().iVq)(t).id,r=P&&d().Q.isSuccess(P)?(0,u().IV)(P.value.valueTypes,e):void 0;return r?(0,k.jsx)(C().F,{value:r,format:s().NY.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,c().simpleFormulaValueWithoutToken)(M,t))},style:{margin:"0 6px 6px 0"}}):null}if((0,p().qsB)(t)){const e=M[0],t=e&&(0,c().isAnnotationSimpleValueToken)(e)&&(0,p().qsB)(e)?(0,p().K7D)(e):void 0;return t&&w?(0,k.jsx)(x().A,{value:t,dateFormat:w.dateFormat,timeFormat:w.timeFormat,style:{marginBottom:6}}):null}if((0,p().jIt)(t)){const e=(0,p().v55)(t);return e?(0,k.jsx)(S().A,{format:I.isMobile?s().NY.Medium:s().NY.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:T,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,c().simpleFormulaValueWithoutToken)(M,t))}},e):null}if((0,p().iz3)(t))return(0,k.jsx)(y().A,{token:t});(0,m().HB)(t)}o(18107),o(967357);var j=()=>o(217827),T=()=>o(542339);function I(){const e=(0,f().YC)(),{menuStore:t}=(0,n.useContext)(T().S),{automationActionId:o,insertionPoint:r}=(0,a().K8)((()=>{const e=null==t?void 0:t.getCurrentTab();return{automationActionId:"eventActionProperty"===(null==e?void 0:e.type)?e.actionId:void 0,insertionPoint:null==t?void 0:t.getInsertionPoint()}}),[t]),i=(0,a().K8)((()=>{var t;return o?null===(t=e.automationStore)||void 0===t?void 0:t.findActionStoreById(o):function(e,t){if(!e)return;const o=e.getActionIds(),n=e.getActionStores();if(!t)return;if("beforeActionId"in t){const e=o.indexOf(t.beforeActionId)-1;return e<=0?n.at(0):n.at(e)}if("afterActionId"in t){const e=o.indexOf(t.afterActionId);if(-1===e)return;return n.at(e+1)}(0,m().HB)(t)}(e.automationStore,r)}),[o,r,e.automationStore]);(0,n.useEffect)((()=>{if(e.defined&&d().Q.isSuccess(e.typecheckResult)){const{automationStore:t,contextType:o,typecheckResult:n}=e;return j().A.focus({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:i}),function(){j().A.blur({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:i})}}}),[i,e])}var P=()=>o(47170),w=()=>o(963589),_=()=>o(999638),V=()=>o(7868),R=()=>o(294852),B=()=>o(621314),E=(o(944114),o(581454),()=>o(401497)),F=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(354520),o(908872),()=>o(908006)),N=()=>o(247331),O=()=>o(959013),D=()=>o(778078),W=()=>o(496603),L=()=>o(742971),K=()=>o(258804),H=()=>o(856952),z=()=>o(970585),U=()=>o(120423);function Y(e){let{disabled:t,handleRemoveToken:o,propertySchema:a,token:u}=e;const c=(0,r().Y0)(),p=(0,n.useCallback)((()=>{o&&o(u)}),[o,u]);if("string"!=typeof u||!a||!(0,i().DQ)(a))return null;const d=(0,l().jy)((null==a?void 0:a.options)??[],u);if(!d)return(0,k.jsx)(g().A,{isSingle:!1,showRemoveButton:!t,onClickRemove:p},`deleted_option_value_${u}`);if((0,i().DD)(a)){var m;const e=null===(m=a.groups)||void 0===m||null===(m=m.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(d.id)})))||void 0===m?void 0:m.color;return(0,k.jsx)(b().q,{color:d.color,format:c.isMobile?s().NY.Medium:s().NY.Small,groupColor:e,isSingle:!1,onClickRemove:p,showRemoveButton:!t,value:d.value})}return(0,k.jsx)(b().O,{color:d.color,format:c.isMobile?s().NY.Medium:s().NY.Small,isSingle:!1,onClickRemove:p,showRemoveButton:!t,value:d.value})}var q=()=>o(722872),$=()=>o(928600),G=()=>o(939740),Q=()=>o(64e3),X=()=>o(480095),Z=()=>o(89924),J=()=>o(996027),ee=()=>o(231713),te=()=>o(760217);function oe(e){let{isChecked:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:i}=e;const l=(0,r().Y0)();return(0,k.jsx)(te().A,{...n,..."single"===o?{isChecked:t}:{},..."multi"===o?{icon:(0,k.jsx)(v().A,{checked:t,size:14,onClick:a})}:{},title:(0,k.jsx)(b().O,{value:i.value,color:i.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:l.isMobile?s().NY.Large:s().NY.Small}),isTokenTitle:!0})}function ne(e){let{isChecked:t,checkType:o,menuArgs:n,onCheckboxClick:a,option:i,group:l}=e;const u=(0,r().Y0)();return(0,k.jsx)(te().A,{...n,..."single"===o?{isChecked:t}:{},..."multi"===o?{icon:(0,k.jsx)(v().A,{checked:t,size:14,onClick:a})}:{},title:(0,k.jsx)(b().q,{color:i.color,format:u.isMobile?s().NY.Large:s().NY.Small,groupColor:null==l?void 0:l.color,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:i.value},i.value),isTokenTitle:!0})}function re(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:d,menuProps:g,onChange:y,onClose:h,showClearButton:f=!1,showInputMenuItem:v=!1,showReplaceAddRemoveToggle:x=!1,type:S,value:b,parentRecordStore:C}=e,A=(0,r().Y0)(),M=(0,E().IS)((e=>({replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[]),{footer:j,groupedItems:T,menuListStore:I,noResultsMessage:P,replaceAddRemoveToggleButton:w,searchInput:_,selectItems:V,valueItems:R}=function(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:d,onChange:g,onClose:y,showClearButton:h,showReplaceAddRemoveToggle:f,type:v,value:x}=e,[S,b]=(0,n.useState)(""),C=(0,a().uB)(void 0,z().A),A=(0,r().Y0)(),M=(0,O().tz)(),{collectionStore:j,property:T}=s,I=(0,a().K8)((()=>j.getSchema()[T]),[j,T]),P=I&&(0,i().DD)(I),w=(0,a().K8)((()=>P?I.groups??[]:[]),[P,I]),_=(0,a().K8)((()=>I&&(0,i().DQ)(I)&&I.options||[]),[I]),V=(0,n.useMemo)((()=>l.filter((e=>(0,u().o5)(e.type,{type:"select",collection:v.collection,property:v.property})))),[l,v.collection,v.property]),R=(0,a().K8)((()=>({valueResults:S?(0,D().Ay)(S,V,(e=>e.kind===N().FormulaContextValueKind.ContextValue?e.name:"")):V,selectResults:S?(0,D().Ay)(S,_,(e=>e.value)):_})),[S,V,_]),B=(0,n.useCallback)((()=>{b(""),C.setState({...C.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[C]),E=(0,n.useCallback)(((e,o)=>{g(e||x,o||t)}),[t,g,x]),q=(0,n.useCallback)((()=>{d&&F().default.afterNextFlush((()=>{y()}))}),[d,y]),$=(0,n.useCallback)((e=>{E({type:"simple",value:d?(0,c().toSimpleFormulaSingleValue)(e[0]):(0,c().toSimpleFormulaArrayValue)(e)}),q(),B()}),[E,d,q,B]),G=(0,n.useCallback)((()=>{$(o.slice(0,o.length-1))}),[o,$]),Q=(0,n.useCallback)((e=>{$((0,c().simpleFormulaValueWithoutToken)(o,e))}),[o,$]),X=(0,n.useMemo)((()=>W().oE(o.map(((e,t)=>(0,k.jsx)(Y,{disabled:!1,handleRemoveToken:Q,propertySchema:I,token:e},`select_option_token_${t}`))))),[o,Q,I]),Z=(0,n.useMemo)((()=>new Set(W().oE(o.map((e=>(0,c().isAnnotationSimpleValueToken)(e)&&(0,p().s1Y)(e)&&(0,p().iVq)(e).id))))),[o]),J=(0,n.useMemo)((()=>W().oE((R.valueResults??[]).map((e=>{const t=e.kind===N().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!Z.has(t))return{action:d?"replace":"append",currentSimpleFormulaValueTokens:o,onCheckboxClick:q,id:t,isStatusProperty:Boolean(P),setCurrentTokens:$,value:e}})))),[Z,o,q,d,P,R.valueResults,$]),ee=d?"single":"multi",te=(0,n.useMemo)((()=>W().oE(R.selectResults??[]).reduce(((e,t)=>{const n=Boolean(o.find((e=>"string"==typeof e&&e===t.value)));return e[t.id]={isChecked:n,checkType:ee,group:void 0,id:t.id,isStatusProperty:Boolean(P),onCheckboxClick:()=>{$(d?n?[]:[t.value]:n?(0,c().simpleFormulaValueWithoutToken)(o,t.value):[...o,t.value]),d&&F().default.afterNextFlush((()=>{y()}))},option:t},e}),{})),[ee,o,d,P,y,R.selectResults,$]),oe=(0,n.useMemo)((()=>Object.values(te)),[te]),ne=(0,n.useMemo)((()=>w.map((e=>({items:(e.optionIds??[]).map((e=>te[e])).filter(m().O9),group:e})))),[te,w]),re=w.length>0&&0===ne.length||0===w.length&&0===oe.length,ae=(0,k.jsx)("div",{style:{...!A.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,k.jsx)(H().Ay,{dontShowBorderBottom:A.isAndroid,focus:!A.isMobile||void 0,focusAfterAnimation:!0,format:H().le.FilterValue,onChange:e=>b(e.target.value),onClearButtonClick:()=>$([]),onRemoveLastToken:G,placeholder:M.formatMessage(L().D.searchPlaceHolder),showClearButton:h,tokens:X,value:S})}),ie=(0,k.jsx)(K().A,{value:x,onChange:E}),le=(0,k.jsx)(U().A,{action:t,handleOnChange:E});return{footer:ie,groupedItems:ne,menuListStore:C,noResultsMessage:re&&M.formatMessage(L().D.noResults),replaceAddRemoveToggleButton:Boolean(f)&&le,searchInput:ae,selectItems:oe,valueItems:J}}({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:l,formulaValueContext:s,isSingle:d,onChange:y,onClose:h,showClearButton:f,showReplaceAddRemoveToggle:x,type:S,value:b})||{},B=(0,n.useMemo)((()=>R.map((e=>{const{annotation:t,itemAction:o}=(0,ee().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,k.jsx)(J().A,{annotation:t,disabled:!1,formulaTypecheckContextValues:l,menuArgs:e,parentRecordStore:C}),action:o}}))),[l,R,C]),{groupedMenuItems:te,selectMenuItems:re}=(0,n.useMemo)((()=>{let e=[],t=[];return T.length>0?e=T.map((e=>{let{group:t,items:o}=e;return{key:t.name,render:e=>(0,k.jsx)(Z().A,{...e,title:t.name,topBorder:!0}),items:o.map((e=>({key:e.id,render:t=>(0,k.jsx)(ne,{...t,isChecked:e.isChecked,checkType:e.checkType,group:e.group,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick})))}})):t=V.map((e=>({key:e.id,render:t=>(0,k.jsx)(oe,{...t,isChecked:e.isChecked,checkType:e.checkType,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick}))),{groupedMenuItems:e,selectMenuItems:t}}),[T,V]),ae=[...B,...re];let ie,le=[];ae.length>0&&le.push({key:"options",render:e=>(0,k.jsx)(Z().A,{...e}),items:ae}),te.length>0&&(le=[...le,...te]),ie=A.isMobile?{menuType:q().gu.Modal,right:(0,k.jsx)(X().DoneMenuText,{}),onClickRight:h,footer:j&&(0,k.jsx)(Z().A,{topBorder:!0,children:j})}:{menuType:q().gu.Popup,maxHeight:"50vh",width:260,footer:j&&(0,k.jsx)(Z().A,{topBorder:!0,children:j}),disableHeaderBorder:!0};const se=(0,k.jsxs)(k.Fragment,{children:[!A.isMobile&&(null==g?void 0:g.header),v&&(0,k.jsx)(Z().A,{children:_})]});return(0,k.jsxs)($().A,{...ie,header:se,children:[w&&(0,k.jsx)("div",{style:M.replaceAddRemoveToggleButton,children:w}),P&&(0,k.jsx)(Z().A,{children:(0,k.jsx)(Q().A,{title:P})}),le.length>0&&(0,k.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:0,sections:le,store:I})]})}var ae=()=>o(277871),ie=(o(737550),o(16280),()=>o(764880)),le=()=>o(179034),se=()=>o(798880),ue=()=>o(962730),ce=()=>o(630116),pe=()=>o(958378),de=()=>o(859428),me=()=>o(448693);const ge=(0,O().YK)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}});function ye(e){const{args:t,isChecked:o,checkType:n,context:g,disabled:h,onCheckboxClick:x,parentRecordStore:S,token:C}=e,A=(0,r().Y0)(),M=(0,a().K8)((()=>{if((0,c().isAnnotationSimpleValueToken)(C)&&(0,p().rie)(C)){const e=(0,p().NcG)(C);if(e)return(0,ie().xC)({pointer:{table:se().oo,id:e},getRecordValue:S.getRecordModel})}}),[S.getRecordModel,C]),j=(0,a().K8)((()=>g.collectionStore.getSchema()[g.property]),[g]),T=(0,a().K8)((()=>j&&(0,i().DQ)(j)?j.options??[]:[]),[j]),I=(0,a().K8)((()=>j&&(0,i().DD)(j)?j.groups??[]:[]),[j]),{typecheckResult:P}=(0,f().YC)(),w=(0,E().IS)((e=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[]),_=Boolean(j&&(0,i().DD)(j)),V="single"===n?{isChecked:o}:"multi"===n?{icon:(0,k.jsx)(v().A,{style:h?w.disabledMenuItem:void 0,checked:o,size:14,onClick:x,disabled:h})}:{};if("string"==typeof C){if(_){const e=(0,l().jy)(T,C),o=I.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,k.jsx)(te().A,{...t,...V,title:(0,k.jsx)(b().q,{format:A.isMobile?s().NY.Large:s().NY.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},C),isTokenTitle:!0,disabled:h,style:h?w.disabledMenuItem:void 0,...t}):null}{const e=(0,l().jy)(T,C);return e?(0,k.jsx)(te().A,{...t,...V,title:(0,k.jsx)(b().O,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:A.isMobile?s().NY.Large:s().NY.Small}),isTokenTitle:!0,disabled:h,style:h?w.disabledMenuItem:void 0,...t}):null}}if("boolean"==typeof C)return null;if((0,p().rie)(C))return null!=M&&M.asActor&&M.table===se().oo?(0,k.jsx)(te().A,{...t,...V,title:h?(0,k.jsx)(de().A,{renderTooltip:()=>(0,k.jsx)(O().sA,{...ge.maximumPeopleSelectedTooltip}),placement:ue().W.Right,render:e=>(0,k.jsx)("div",{style:{width:"100%"},...e,children:(0,k.jsx)(me().t_,{isSingle:!0,shouldShrink:!0,format:A.isMobile?me().t_.Format.Large:me().t_.Format.Medium,userValue:M.asActor})})}):(0,k.jsx)(me().t_,{isSingle:!0,shouldShrink:!0,format:A.isMobile?me().t_.Format.Large:me().t_.Format.Medium,userValue:M.asActor}),disabled:h,style:h?w.disabledMenuItem:void 0,isTokenTitle:!0}):null;if((0,p().s1Y)(C)){const e=(0,p().iVq)(C).id,n=P&&d().Q.isSuccess(P)?(0,u().IV)(P.value.valueTypes,e):void 0;return n?(0,k.jsx)(J().A,{isChecked:o,contextValue:n,disabled:Boolean(h),menuArgs:t,parentRecordStore:S}):null}if((0,p().qsB)(C))return null;if((0,p().jIt)(C)){const e=(0,p().v55)(C);if(!e)return null;const n=ce().Bv.createChildStore(S,{id:e,table:le().ev});return(0,k.jsx)(pe().A,{store:n,isChecked:o,hidePath:!0,...t})}if((0,p().iz3)(C))return(0,k.jsx)(y().A,{token:C});(0,m().HB)(C)}function he(e){const{currentSimpleFormulaValueTokens:t,value:o,setCurrentTokens:n,action:r,context:a,checkType:i,onCheckboxClick:l,isDisabled:s,parentRecordStore:u}=e;if(o.kind!==N().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const d=Boolean(t.find((e=>(0,c().isAnnotationSimpleValueToken)(e)&&(0,p().s1Y)(e)&&(0,p().iVq)(e).id===o.id))),m=(0,p().CA$)({id:o.id}),g=()=>{n("append"===r?d?(0,c().simpleFormulaValueWithoutToken)(t,m):[...t,m]:[m]),null==l||l()};return{key:o.id,render:e=>(0,k.jsx)(ye,{disabled:s,token:m,args:e,isChecked:d,checkType:i,context:a,onCheckboxClick:g,parentRecordStore:u}),action:g}}function fe(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:i,onChange:l,onClose:s,parentRecordStore:u,value:p}=e,d=(0,O().tz)(),m=(0,r().Y0)(),g=a.filter((e=>"checkbox"===e.type.type)),y=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,c().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),h=(0,n.useCallback)((e=>{y(e),s()}),[y,s]),f=W().oE(g.map((e=>he({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:h,action:"replace",context:t,checkType:"single",parentRecordStore:u})))),v=[],x=o.some((e=>!0===e)),S=[...f,...[{key:0,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...L().D.unchecked}),isChecked:!x,...e}),action:()=>{h([!1])}},{key:1,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...L().D.checked}),isChecked:x,...e}),action:()=>{h([!0])}}]],b=void 0!==(null==i?void 0:i.header)?i.header:(0,k.jsx)(Z().A,{style:{paddingBottom:0},title:d.formatMessage(L().D.genericMenuHeader)}),C=Boolean(b);v.push({key:"checkbox",render:e=>(0,k.jsx)(Z().A,{...e,topBorder:C}),items:S});const A=(0,k.jsx)(Z().A,{topBorder:!0,children:(0,k.jsx)(K().A,{onChange:l,value:p})});let M;M=m.isMobile?{menuType:q().gu.Modal,right:(0,k.jsx)(X().DoneMenuText,{}),onClickRight:s,footer:A}:{menuType:q().gu.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0,header:b,footer:A};const j={...M,...i,header:m.isMobile?null:b};return(0,k.jsx)($().A,{...j,children:(0,k.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:0,sections:v})})}var ve=()=>o(42583),xe=()=>o(8980),Se=()=>o(597777),be=()=>o(274609),Ce=()=>o(896780),Ae=()=>o(186445),ke=()=>o(645873),Me=()=>o(493823),je=()=>o(285790);function Te(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:r,onClose:i,setCurrentTokens:l,setInDatePicker:s}=e,u=o[0],d=u&&(0,c().isAnnotationSimpleValueToken)(u)&&p().qsB(u)?p().K7D(u):void 0,m=(0,O().tz)(),g=(0,a().O$)(Ae().XX),y=(0,n.useCallback)((()=>{s(!1)}),[s]),h=(0,n.useCallback)((e=>{e&&(0,Se().kC)(e)?l([p().Ww9(e)]):l([])}),[l]),f=(0,E().IS)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.text.secondary,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),v=(0,a().K8)((()=>(0,A().aS)(t)),[t]);return(0,k.jsx)(ke().u2,{dependency:Ce().cm,children:e=>{let{DatePropertyMenu:t}=e;return(0,k.jsx)(t,{firstDayOfWeek:g,value:d,canConfigureCollection:!1,onChangeValue:h,dateFormat:v.dateFormat,timeFormat:v.timeFormat,onDismiss:i,disabled:r,shouldShowReminder:!1,header:(0,k.jsxs)("div",{style:f.header,children:[(0,k.jsx)(je().A,{ariaLabel:m.formatMessage(L().D.back),icon:be().L,onClick:y,style:f.iconWrap,iconStyle:f.icon}),(0,k.jsx)("span",{style:f.title,children:(0,k.jsx)(O().sA,{...L().D.pickADate})}),(0,k.jsx)(Me().p,{onClick:i,isBlue:!0,children:(0,k.jsx)(X().DoneMenuText,{})})]}),isTemplatePage:!1})}})}function Ie(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,menuProps:i,onChange:l,onClose:s,parentRecordStore:u,value:p}=e,d=(0,O().tz)(),m=(0,r().Y0)(),[g,y]=(0,n.useState)(!1),h=a.filter((e=>"date"===e.type.type)),f=(0,n.useCallback)((e=>{l({type:"simple",value:void 0!==e[0]?(0,c().toSimpleFormulaSingleValue)(e[0]):void 0})}),[l]),v=(0,n.useCallback)((e=>{f(e),s()}),[f,s]),x=(0,n.useCallback)((()=>{y(!0)}),[]),S=(0,n.useCallback)((()=>{f([]),s()}),[f,s]);if(g)return(0,k.jsx)(Te,{context:t,currentSimpleFormulaValueTokens:o,disabled:!1,onClose:s,setCurrentTokens:f,setInDatePicker:y});const b=void 0!==(null==i?void 0:i.header)?i.header:(0,k.jsx)(Z().A,{style:{paddingBottom:0},title:d.formatMessage(L().D.genericMenuHeader)}),C=W().oE(h.map((e=>he({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:v,parentRecordStore:u,action:"replace",context:t,checkType:"single"})))),A=[];if(C.length>0){const e=Boolean(b);A.push({key:"values",render:t=>(0,k.jsx)(Z().A,{topBorder:e,...t}),items:C})}const M=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(Z().A,{topBorder:!0,children:[(0,k.jsx)(te().A,{icon:(0,k.jsx)(xe().I,{icon:ve().D,color:"secondary"}),title:(0,k.jsx)(O().sA,{...L().D.pickADate}),focused:!1,showExtensionArrow:!0,onClick:x}),(0,k.jsx)(K().A,{onChange:l,value:p})]}),o.length>0&&(0,k.jsx)(Z().A,{topBorder:!0,children:(0,k.jsx)(te().A,{title:(0,k.jsx)(O().sA,{...L().D.clear}),focused:!1,onClick:S})})]});let j;j=m.isMobile?{menuType:q().gu.Modal,right:(0,k.jsx)(X().DoneMenuText,{}),onClickRight:s,footer:M}:{menuType:q().gu.Popup,maxHeight:"50vh",width:260,footer:M,disableHeaderBorder:!0};const T={...j,...i,header:m.isMobile?null:b};return(0,k.jsx)($().A,{...T,children:(0,k.jsx)(G().Ay,{type:G().Oh.Vertical,initialFocus:0,sections:A})})}function Pe(e){const{action:t,allowedFormulaReturnTypes:o,currentSimpleFormulaValueTokens:r,disableEmojiCommands:a,disableFormattingAndMentions:i,disableMobileActionBar:l,disableTemplateVariableMentions:s,formulaTypecheckContextValues:u,formulaValueContext:c,limit:p,menuProps:d,onChange:g,onClose:y,parentRecordStore:h,showClearButton:f,showInputMenuItem:v,showReplaceAddRemoveToggle:x,type:S,value:b}=e;I();const C="formula"===(null==b?void 0:b.type),A=(0,P().O)(),M=n.useCallback((()=>{g({type:"simple",value:null==b?void 0:b.value})}),[g,null==b?void 0:b.value]),j=(0,w().X)("collections_xws")?"cross_space_and_read_permissions":"read_permissions_only";return C&&A?(0,k.jsx)(_().A,{allowedReturnTypes:o,disabled:!1,formulaTypecheckContextValues:u,onBack:M,onChange:g,onClose:y,parentRecordStore:h,restrictUnaccessibleProperties:j,spaceId:A,value:b}):"person_array"===S.type?(0,k.jsx)(Ve,{action:t,currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,formulaValueContext:c,limit:p,menuProps:d,onChange:g,onClose:y,showClearButton:f??!0,showInputMenuItem:v??!0,showFormulaValueItems:!0,showGenericHeader:!0,showReplaceAddRemoveToggle:x,showPersonCheckbox:x,getRecordModel:h.getRecordModel,value:b,parentRecordStore:h}):"collection"!==c.type?null:"text"===S.type?(0,k.jsx)(_e,{currentSimpleFormulaValueTokens:r,disableEmojiCommands:a,disableFormattingAndMentions:i,disableMobileActionBar:l,disableTemplateVariableMentions:s,formulaTypecheckContextValues:u,menuProps:d,onChange:g,onClose:y,parentRecordStore:h,showGenericHeader:!0,value:b}):"number"===S.type?(0,k.jsx)(we,{currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,menuProps:d,onChange:g,onClose:y,showGenericHeader:!0,value:b,parentRecordStore:h}):"checkbox"===S.type?(0,k.jsx)(fe,{context:c,currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,menuProps:d,onChange:g,onClose:y,parentRecordStore:h,value:b}):"date"===S.type?(0,k.jsx)(Ie,{context:c,currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,menuProps:d,onChange:g,onClose:y,parentRecordStore:h,value:b}):"block_array"===S.type?(0,k.jsx)(Re,{action:t,collection:"block_array"===S.type?S.collection:void 0,currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,formulaValueContext:c,menuProps:d,onChange:g,onClose:y,showClearButton:f??!0,showFormulaValueItems:!0,showGenericHeader:!0,showInputMenuItem:v??!0,showReplaceAddRemoveToggle:x,value:b,parentRecordStore:h}):"select"===S.type?(0,k.jsx)(re,{currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,formulaValueContext:c,isSingle:!0,menuProps:d,onChange:g,onClose:y,showClearButton:f??!0,showInputMenuItem:v??!0,type:S,value:b,parentRecordStore:h}):"select_array"===S.type?(0,k.jsx)(re,{action:t,currentSimpleFormulaValueTokens:r,formulaTypecheckContextValues:u,formulaValueContext:c,isSingle:!1,menuProps:d,onChange:g,onClose:y,showClearButton:f??!0,showInputMenuItem:v??!0,showReplaceAddRemoveToggle:x,type:S,value:b,parentRecordStore:h}):void(0,m().HB)(S)}function we(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:r,onClose:a,showGenericHeader:i,value:l,parentRecordStore:s}=e;const{numberMenu:u}=(0,V().A)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:r,onClose:a,showGenericHeader:i,value:l,parentRecordStore:s});return u}function _e(e){let{currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:r,onClose:a,parentRecordStore:i,showGenericHeader:l,value:s}=e;const{textMenu:u}=(0,ae().A)({currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,menuProps:n,onChange:r,onClose:a,parentRecordStore:i,showGenericHeader:l,value:s});return u}function Ve(e){let{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:r,limit:a,menuProps:i,onChange:l,onClose:s,showClearButton:u,showInputMenuItem:c,showFormulaValueItems:p,showGenericHeader:d,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:y,value:h,parentRecordStore:f}=e;const{personArrayMenu:v}=(0,R().A)({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:r,limit:a,menuProps:i,onChange:l,onClose:s,showClearButton:u,showInputMenuItem:c,showFormulaValueItems:p,showGenericHeader:d,showReplaceAddRemoveToggle:m,showPersonCheckbox:g,getRecordModel:y,value:h,parentRecordStore:f});return v}function Re(e){let{action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,formulaValueContext:a,menuProps:i,onChange:l,onClose:s,showClearButton:u,showFormulaValueItems:c,showGenericHeader:p,showInputMenuItem:d,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:y}=e;const{relationMenu:h}=(0,B().A)({action:t,collection:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,formulaValueContext:a,menuProps:i,onChange:l,onClose:s,showClearButton:u,showFormulaValueItems:c,showGenericHeader:p,showInputMenuItem:d,showReplaceAddRemoveToggle:m,value:g,parentRecordStore:y});return h}},419830:(e,t,o)=>{o.d(t,{Cp:()=>v,aS:()=>h,pG:()=>f,pg:()=>y});o(944114),o(898992),o(354520),o(908872);var n=o(296540),r=()=>o(847249),a=()=>o(970013),i=()=>o(597777),l=()=>o(523872),s=()=>o(681873),u=()=>o(919709),c=()=>o(959013),p=()=>o(534177),d=()=>o(284371),m=()=>o(901389),g=o(474848);function y(e){const t=(0,r().K8)((()=>{if("collection"!==e.type)return;const t=e.collectionStore.getSchema()[e.property];let o;return t&&(0,a().sO)(t)&&(o=t.limit),o}),[e]);return(0,n.useCallback)(((e,o)=>(0,p().O9)(t)?"first"===o?e.slice(0,t):"last"===o?e.slice(-t):void(0,p().HB)(o):e),[t])}function h(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||i().vz,timeFormat:o.time_format||i().CE}:{dateFormat:i().vz,timeFormat:i().CE}}function f(e){if("simple"===(null==e?void 0:e.type)&&e.value){const t=e.value.reduce(((e,t)=>{const o=e.length>0;if((0,u().bHQ)(t))!o&&(0,u()._g9)(t)||e.push((0,u().Ey_)(`"${t[0]}"`));else if((0,u().BEe)(t))e.push((0,u().Ey_)(`"${t[0]}"`));else if((0,u().qXl)(t)){const o=(0,u().uPN)(t),n=(0,u().jhx)(o);if(n){const t=o.filter((e=>!(0,u().jcO)(e)));e.push((0,u().wmz)(n,t))}}return e}),[]),o=(0,u().__s)((0,s().A)(t,(()=>(0,u().Ey_)(" + "))));return o.length>0?o:void 0}return null==e?void 0:e.value}async function v(){const{accept:e}=await m().Gh({acceptButtonType:"outline",acceptColor:void 0,acceptLabel:(0,g.jsx)(c().sA,{id:"formulaInputMenu.handleBack.convert",defaultMessage:"Convert"}),cancelButtonType:"outline",description:(0,g.jsx)(c().sA,{id:"formulaInputMenu.handleBack.description",defaultMessage:"Existing formula content will be lost"}),icon:(0,l().U)({fontWeight:d().Wy.semibold,height:36,width:36}),message:(0,g.jsx)(c().sA,{id:"formulaInputMenu.handleBack.message",defaultMessage:"Convert this variable from a formula to plain text?"})});return e}},436876:(e,t,o)=>{o.d(t,{A:()=>p});o(296540);var n=()=>o(401497),r=()=>o(784892),a=()=>o(576250),i=()=>o(617073),l=()=>o(234194),s=()=>o(919709),u=()=>o(848401),c=o(474848);function p(e){let{handleRemoveToken:t,token:o,type:p,format:d,style:m,isDisabled:g}=e;const y=(0,s().GCe)(o).name,h=(0,n().DP)();if(!y)return null;let f;switch(p){case"person":f=l().M;break;case"email":f=i().J;break;default:f=a().y}return(0,c.jsx)(u().Ay,{title:y,renderAvatar:e=>f({width:e,height:e,padding:2,marginRight:6}),style:{background:h.accentColors.gray[75],padding:"2px 4px",...m},showRemoveButton:Boolean(t)&&!g,onClickRemove:e=>{null==e||e.stopPropagation(),t&&t(o)},format:d??r().NY.Small,shouldShrink:!0,isSingle:!1})}},438873:(e,t,o)=>{o.d(t,{bK:()=>i,mK:()=>r});const n=["string_is","string_is_not","string_contains","string_does_not_contain","string_starts_with","string_ends_with","is_empty","changes_to_any"];function r(e){const t=e;return n.includes(t)?t:"string_is"}const a=(0,o(959013).YK)({changesToAny:{id:"automations.propertyTrigger.textField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.textField.isEmpty",defaultMessage:"Is cleared"},stringIs:{id:"automations.propertyTrigger.textField.stringIsOption",defaultMessage:"Is set to"},stringIsNot:{id:"automations.propertyTrigger.textField.stringIsNotOption",defaultMessage:"Is not set to"},stringContains:{id:"automations.propertyTrigger.textField.stringContainsOption",defaultMessage:"Contains"},stringDoesNotContain:{id:"automations.propertyTrigger.textField.stringDoesNotContain",defaultMessage:"Does not contain"},stringStartsWith:{id:"automations.propertyTrigger.textField.stringStartsWithOption",defaultMessage:"Starts with"},stringEndsWith:{id:"automations.propertyTrigger.textField.stringEndsWithOption",defaultMessage:"Ends with"}}),i={string_is:{hasInput:!0,text:a.stringIs,value:"string_is"},string_is_not:{hasInput:!0,text:a.stringIsNot,value:"string_is_not"},string_contains:{hasInput:!0,text:a.stringContains,value:"string_contains"},string_does_not_contain:{hasInput:!0,text:a.stringDoesNotContain,value:"string_does_not_contain"},string_starts_with:{hasInput:!0,text:a.stringStartsWith,value:"string_starts_with"},string_ends_with:{hasInput:!0,text:a.stringEndsWith,value:"string_ends_with"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},439616:(e,t,o)=>{o.d(t,{A:()=>V});o(944114),o(581454);var n=o(296540),r=()=>o(662303),a=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(869190),u=()=>o(68263),c=()=>o(959013),p=()=>o(720665),d=()=>o(760217),m=()=>o(406699),g=()=>o(928600),y=()=>o(939740),h=()=>o(8980),f=()=>o(89924),v=()=>o(125565),x=()=>o(573351),S=()=>o(662971),b=()=>o(186445),C=()=>o(722872),A=()=>o(700250),k=()=>o(991249),M=()=>o(118849),j=()=>o(134217),T=o(474848);function I(e,t){const{permissionItem:n,hideIcon:r,onChange:i,buttonStyle:l}=e,s=(0,a().Y0)();return(0,T.jsx)(o(811979).A,{...e,popupType:s.isMobile?m().z7.SlideUp:m().z7.Popup,renderOrigin:a=>(0,T.jsx)(o(585293).a,{...(0,o(553965).A)(e,a),ref:t,title:(0,T.jsx)(c().sA,{defaultMessage:"Link expires",id:"publishSiteSettings.linkExpiration.settingTitle"}),icon:!r&&(0,T.jsx)(h().I,{icon:o(274570).clockIcon,color:"secondary"}),right:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(P,{permissionItem:n}),(0,T.jsx)(h().I,{icon:o(324254).arrowChevronSingleDownSmallIcon,size:"sm",color:"tertiary"})]}),buttonStyle:l}),alignmentToOrigin:A().MY.End,placementToOrigin:A().UV.Bottom,render:e=>(0,T.jsx)(w,{value:n.expiration_timestamp,onChange:i,onClose:()=>{e.close()}})})}function P(e){const{permissionItem:t}=e,o=(0,c().tz)(),n=(0,l().IS)((e=>({container:{color:e.text.secondary}})),[]);if(!t.expiration_timestamp||(0,u().OA)(t))return(0,T.jsx)(v().A,{style:n.container,children:(0,T.jsx)(c().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})});const a=s().jE(t.expiration_timestamp,r().locale,o);return(0,T.jsx)(v().A,{style:n.container,children:a})}function w(e){const{value:t,onChange:o,onClose:s}=e,u=(0,a().v3)(),m=u.device,h=(0,i().K8)((()=>!j().qC()),[]),v=(0,i().K8)((()=>j().Si(u)),[u]),x=(0,n.useCallback)((e=>{void 0!==e&&e<=(new Date).getTime()||(o(e),s())}),[o,s]),S=(0,l().IS)((e=>({disabledContainer:{display:"flex",gap:6},disabledText:{color:e.text.tertiary}})),[]),b=function(){const e=Date.now(),t=e+p().pT,o=e+p().nD,n=e+7*p().nD;return[{key:"none",time:void 0,title:(0,T.jsx)(c().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})},{key:"hour",time:t,title:(0,T.jsx)(c().sA,{defaultMessage:"In an hour",id:"publishSiteSettings.linkExpiration.oneHour"}),caption:new Intl.DateTimeFormat(r().locale,{hour:"numeric",minute:"numeric"}).format(t)},{key:"day",time:o,title:(0,T.jsx)(c().sA,{defaultMessage:"In a day",id:"publishSiteSettings.linkExpiration.oneDay"}),caption:new Intl.DateTimeFormat(r().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(o)},{key:"week",time:n,title:(0,T.jsx)(c().sA,{defaultMessage:"In a week",id:"publishSiteSettings.linkExpiration.oneWeek"}),caption:new Intl.DateTimeFormat(r().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(n)}]}().map((e=>({key:e.key,action:()=>{x(e.time)},render:t=>(0,T.jsx)(d().A,{...t,title:e.title,titleStyle:h?S.disabledText:{},caption:e.caption,captionStyle:h?S.disabledText:{},disabled:h})}))),A=[{key:"predefined-expiration",render:e=>(0,T.jsx)(f().A,{...e}),items:b},{key:"custom-expiration",render:e=>(0,T.jsx)(f().A,{...e,topBorder:!0}),items:[_(x,t,h,S.disabledText)]}];return v&&h&&A.push({key:"upgrade-for-expiration",render:e=>(0,T.jsx)(f().A,{...e,topBorder:!0}),items:[{key:"upsell",action:()=>{k().K(u,{from:"public_permission_item_expiration",upsell:{type:"product",product:v,limit:{type:"none"},trialability:"none"}})},render:e=>(0,T.jsx)(d().A,{...e,focused:e.focused,title:(0,T.jsxs)("div",{style:S.disabledContainer,children:[(0,T.jsx)(c().sA,{defaultMessage:"Unlock link expiration",id:"publishSiteSettings.linkExpiration.upgrade"}),(0,T.jsx)(M().A,{subscriptionTier:v,analyticsName:"public_permission_item_expiration"})]})})}]}),(0,T.jsx)(g().A,{menuType:m.isMobile?C().gu.ActionSheet:C().gu.Popup,width:271,children:(0,T.jsx)(y().Ay,{type:y().Oh.Vertical,initialFocus:void 0,sections:A})})}function _(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return{key:"custom",action:()=>{window.parent.close()},render:(r,a)=>(0,T.jsx)(S().A,{...r,renderOrigin:e=>(0,T.jsx)(d().A,{...e,disabled:o,title:(0,T.jsx)(c().sA,{id:"publicPermissionItem.expiration.chooseDate",defaultMessage:"Choose date"}),titleStyle:o?n:{}}),onFocus:a.onFocus,disableDefaultClick:!0,renderExtension:(n,r)=>(0,T.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,T.jsx)(x().A,{...n,firstDayOfWeek:b().XX.state,value:t||Date.now(),onChange:t=>{e(t),r.close()},disabledDays:o||{before:new Date}})})})}}const V=n.forwardRef(I)},457050:(e,t,o)=>{o.d(t,{Iq:()=>I,UW:()=>M,WE:()=>_,eg:()=>w,oE:()=>j,xL:()=>k});o(898992),o(354520),o(581454),o(737550),o(296540);var n=()=>o(484714),r=()=>o(847249),a=()=>o(401497),i=()=>o(289915),l=()=>o(713998),s=()=>o(784892),u=()=>o(977345),c=()=>o(791089),p=()=>o(179034),d=()=>o(919709),m=()=>o(959013),g=()=>o(534177),y=()=>o(284371),h=()=>o(684125),f=()=>o(566081),v=()=>o(71304),x=()=>o(630116),S=()=>o(16707),b=()=>o(529135),C=()=>o(214973),A=o(474848);function k(e){const{automationContextValues:t,messageType:o,propertySchema:i,value:l}=e,s=(0,m().tz)(),u=(0,n().v3)(),c=(0,r().K8)((()=>l?I({automationContextValues:t,limit:i.limit,value:l}):[]),[t,i.limit,l]),p=(0,a().IS)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",flexWrap:"wrap",minWidth:0,whiteSpace:"pre",lineHeight:1.6},operatorContent:{alignItems:"center",flexWrap:"wrap",gridGap:"1px"},propertyName:{...y().RC,fontWeight:y().Wy.semibold,minWidth:20},propertyValue:{...y().RC,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10,width:"100%"},propertyValueListItem:{display:"flex"},and:{marginRight:"4px",marginLeft:"4px"}})),[]),d=(0,r().K8)((()=>{if("action"===o)return function(e){const{intl:t,collectionStore:o,operator:n,propertySchema:r,relationPages:a,styles:i,value:l}=e,s=(0,A.jsx)("span",{style:i.propertyName,children:r.name});let u;const c="formula"===(null==l?void 0:l.type);u=c?(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...C().uW({propertyName:s,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(S().g,{returnType:{type:"block"}})})})})}):"replace"===n||"append"===n||"remove"===n||"toggle"===n?(0,A.jsx)("div",{style:{...i.content,...i.operatorContent},children:(0,A.jsx)(m().sA,{...C().f4({...C().f_({elements:a.map(((e,t)=>(0,A.jsx)(T,{propertySchema:r,collectionStore:o,value:e},t))),intl:t}),operator:n,propertyName:s})})}):0===a.length?(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...C().NW({propertyName:s})})}):(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...C().uW({propertyName:s,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(T,{collectionStore:o,value:a[0],propertySchema:r})})})})});return u}({collectionStore:e.collectionStore,intl:s,operator:e.operator,propertySchema:e.propertySchema,relationPages:c,styles:p,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:n}=e;return function(e){const{availableTokens:t,collectionStore:o,operator:n,propertySchema:r,relationPages:a,styles:i}=e,l=(0,A.jsx)("span",{style:i.propertyName,children:r.name});let s;if(1===a.length){const e="relation_contains"===n?C().TF:C()._f;s=(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...e({propertyName:l,propertyValue:(0,A.jsx)("span",{style:i.propertyValue,children:(0,A.jsx)(T,{availableTokens:t,collectionStore:o,propertySchema:r,value:a[0]})})})})})}else{const e="relation_contains"===n?C().JQ:C().SV;s=(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{style:i.content,children:(0,A.jsx)(m().sA,{...e({propertyName:l,propertyValue:[]})})}),(0,A.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,n)=>(0,A.jsx)("li",{style:i.propertyValueListItem,children:(0,A.jsx)(T,{availableTokens:t,collectionStore:o,propertySchema:r,value:e})},n)))})]})}return s}({availableTokens:o?w({collectionStore:t,filter:o,propertySchema:n}):void 0,collectionStore:e.collectionStore,operator:e.operator,propertySchema:e.propertySchema,relationPages:c,styles:p})}(0,g().HB)(o)}),[e,s,o,c,p]);return{tooltipTitle:(0,r().K8)((()=>{if("action"===o)return M({collectionStore:e.collectionStore,environment:u,intl:s,operator:e.operator,propertySchema:i,relationPages:c,value:e.value});if("trigger"===o){const{collectionStore:t,filter:o,propertySchema:n}=e;return j({availableTokens:o?w({collectionStore:t,filter:o,propertySchema:n}):void 0,collectionStore:e.collectionStore,environment:u,intl:s,operator:e.operator,propertySchema:e.propertySchema,relationPages:c})}(0,g().HB)(o)}),[e,u,s,o,i,c]),title:d,styles:p}}function M(e){const{collectionStore:t,environment:o,intl:n,operator:r,propertySchema:a,relationPages:i,value:l}=e,s=a.name;if("formula"===(null==l?void 0:l.type))return(0,A.jsx)(m().sA,{...C().uW({propertyName:s,propertyValue:(0,A.jsx)(S().L,{})})});const c=i.map((e=>{if("string"==typeof e){const r=x().Bv.createChildStore(t,{id:e,table:p().ev});return(0,v().tS)({environment:o,intl:n,store:r})}return(0,u().sM)(e)})).filter(g().O9),d=1===c.length?c[0]:n.formatList(c,{style:"long",type:"conjunction"});let y;return y="replace"===r||"append"===r||"remove"===r||"toggle"===r?C().f4({propertyName:s,propertyValue:d,operator:r}):0===c.length?C().NW({propertyName:s}):C().uW({propertyName:s,propertyValue:d}),(0,A.jsx)(m().sA,{...y})}function j(e){const{availableTokens:t,collectionStore:o,environment:n,intl:r,operator:a,propertySchema:i,relationPages:l}=e,s=l.map((e=>{if("string"==typeof e){if(!t||t.some((t=>t.id===e))){const t=x().Bv.createChildStore(o,{id:e,table:p().ev});return(0,v().tS)({environment:n,intl:r,store:t})}return C().iy(r)}return(0,u().sM)(e)})).filter(g().O9),c=i.name,d=1===s.length?s[0]:r.formatList(s,{style:"long",type:"conjunction"});let y;if(1===s.length){y=("relation_contains"===a?C().TF:C()._f)({propertyName:c,propertyValue:d})}else{y=("relation_contains"===a?C().JQ:C().SV)({propertyName:c,propertyValue:d})}return(0,A.jsx)(m().sA,{...y})}function T(e){const{availableTokens:t,collectionStore:o,value:n}=e;return!t||t.some((e=>e.id===n))?"string"==typeof n?(0,A.jsx)(f().A,{blockId:n,format:s().NY.Medium,isSingle:!0,noUnderline:!0,parentStore:o,shouldShrink:!0}):(0,A.jsx)(h().F,{format:s().NY.Medium,isSingle:!0,shouldShrink:!0,value:n}):(0,A.jsx)(b().A,{tokenFormat:s().NY.Medium},`missing_option_value_${n}`)}function I(e){const{automationContextValues:t,limit:o,value:n}=e;if(!n)return[];return(0,c().fromSimpleFormulaArrayValue)(n.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,d().s1Y)(e)){const o=(0,d().iVq)(e).id,n=(0,u().IV)(t,o);if(!n)return;return n}if((0,d().jIt)(e)){var o;const t=null===(o=(0,d().i$F)(e))||void 0===o?void 0:o.id;if(!t)return;return t}}})).filter(g().O9)}function P(e){const{collectionStore:t,filter:o}=e,n=(0,i().Rh)(o),r=t.getSpaceId();return n.map((e=>{if(e.value&&"string"==typeof e.value)return{table:"block",id:e.value,spaceId:r}})).filter(g().O9)}function w(e){const{collectionStore:t,filter:o,propertySchema:n}=e,r=P({collectionStore:t,filter:o});return(0,l().bG)({getRecordModel:t.getRecordModel,propertySchema:n,relationValue:r,includeNoAccess:!0})}function _(e){const{collectionStore:t,filter:o}=e,n=P({collectionStore:t,filter:o});return{action:"replace",value:{type:"simple",value:(0,l().Ap)(n)}}}},463562:(e,t,o)=>{o.d(t,{Ay:()=>it,yp:()=>mt,TM:()=>dt,B6:()=>pt,e_:()=>ct});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454),o(737550);var n=o.n(o(844751)),r=o(296540),a=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(764880),u=()=>o(422540),c=()=>o(81768),p=()=>o(352271),d=()=>o(289915),m=()=>o(970013),g=()=>o(713998),y=()=>o(791089),h=()=>o(709687),f=()=>o(101209),v=()=>o(563884),x=()=>o(920713),S=()=>o(813572),b=()=>o(133033),C=()=>o(173019),A=()=>o(689094),k=()=>o(751109),M=()=>o(292643),j=()=>o(46472),T=o(474848);const I=(0,o(340498).wt)("typesLocation",{viewBox:"0 0 25 25",svg:(0,T.jsxs)("g",{children:[(0,T.jsx)("path",{d:"M12.105 24.21C18.7369 24.21 24.2121 18.7273 24.2121 12.105C24.2121 5.47312 18.7273 0 12.0954 0C5.47523 0 0 5.47312 0 12.105C0 18.7273 5.48484 24.21 12.105 24.21ZM12.105 21.8255C6.71085 21.8255 2.39412 17.4991 2.39412 12.105C2.39412 6.71085 6.70124 2.38452 12.0954 2.38452C17.4895 2.38452 21.8276 6.71085 21.8276 12.105C21.8276 17.4991 17.4991 21.8255 12.105 21.8255Z"}),(0,T.jsx)("path",{d:"M6.75703 16.5939C6.75703 17.4355 7.28742 17.9479 8.17266 17.9479H16.0416C16.9247 17.9479 17.4476 17.4355 17.4476 16.5939V12.0109L12.4683 7.82758C12.236 7.63047 11.9686 7.64008 11.7363 7.82758L6.75703 12.0013V16.5939ZM13.6692 16.7148H10.5429V12.9969C10.5429 12.7178 10.7283 12.5366 11.0128 12.5366H13.2014C13.4977 12.5366 13.6692 12.7178 13.6692 12.9969V16.7148ZM4.81055 11.2199C4.81055 11.5316 5.04469 11.8138 5.43211 11.8138C5.62593 11.8138 5.78554 11.7083 5.9271 11.5806L11.8111 6.65687C12.0145 6.47477 12.2093 6.49609 12.4052 6.65687L18.2775 11.5806C18.4383 11.7083 18.5883 11.8138 18.7725 11.8138C19.1194 11.8138 19.3941 11.5818 19.3941 11.2391C19.3941 11.0315 19.3228 10.873 19.1653 10.7336L13.0078 5.5661C12.4605 5.10508 11.7558 5.10508 11.2181 5.5661L5.03929 10.7357C4.89141 10.8751 4.81055 11.0507 4.81055 11.2199ZM15.8079 8.35282L17.4623 9.75391V6.88399C17.4623 6.62618 17.3004 6.44501 17.033 6.44501H16.249C15.9912 6.44501 15.8079 6.62618 15.8079 6.88399V8.35282Z"})]})});var P=()=>o(281067),w=()=>o(164153),_=()=>o(523872),V=()=>o(166883),R=()=>o(696706),B=()=>o(959013),E=()=>o(534177),F=()=>o(284371),N=()=>o(686526),O=()=>o(436572),D=()=>o(837570),W=()=>o(741310),L=()=>o(546461),K=()=>o(104636),H=()=>o(735695),z=()=>o(493823),U=()=>o(419357),Y=()=>o(187485),q=()=>o(204063),$=()=>o(89924),G=()=>o(859428),Q=()=>o(989423),X=()=>o(682146),Z=()=>o(726483),J=()=>o(731320),ee=()=>o(963589),te=()=>o(962730),oe=()=>o(351360),ne=()=>o(227440),re=()=>o(508496),ae=()=>o(577437),ie=()=>o(898125),le=()=>o(507354),se=()=>o(310109),ue=()=>o(784892),ce=()=>o(842599),pe=()=>o(977345),de=()=>o(519831),me=()=>o(798880),ge=()=>o(919709),ye=()=>o(500071),he=()=>o(656476),fe=()=>o(307159),ve=()=>o(347114),xe=()=>o(3867),Se=()=>o(237985),be=()=>o(359186),Ce=()=>o(217028),Ae=()=>o(383688),ke=()=>o(880264),Me=()=>o(112588),je=()=>o(477329),Te=()=>o(27511),Ie=()=>o(214973),Pe=()=>o(38440),we=()=>o(133518),_e=()=>o(798941),Ve=()=>o(397785),Re=()=>o(457050),Be=()=>o(967823),Ee=()=>o(71304),Fe=()=>o(630116);const Ne=(0,B().YK)({automationSingleTargetDefault:{defaultMessage:"1 person",id:"database.viewSettings.automationTab.automationSingleTargetDefault"},recurrenceAutomationSummary:{defaultMessage:"Every {frequency}, {actions}",id:"automation.summaryCard.recurrenceCaption"}});function Oe(e){const{intl:t,triggerConfig:o}=e;if(o){if("event"===o.type){const n=function(e){const{hasAutomationUpdatedErrorStatesEnabled:t,collectionStore:o,environment:n,getRecordModel:r,intl:a,schema:i,typecheckResult:l,triggerConfig:s}=e,{event:c}=s,p=o.getSpaceId(),g=[];c.pagesAdded&&g.push(Ie().CH(a));if("none"===c.pagePropertiesEdited.type);else if("any"===c.pagePropertiesEdited.type)g.push(Ie().HG(a));else if("some"===c.pagePropertiesEdited.type||"all"===c.pagePropertiesEdited.type){let e=[];"all"===c.pagePropertiesEdited.type?e=c.pagePropertiesEdited.all??[]:"some"===c.pagePropertiesEdited.type&&(e=c.pagePropertiesEdited.some??[]);for(const s of e){const e=i[s.property];if(!e){g.push(Ie().Pg(a));continue}if(!u().tj[e.type]){g.push((0,Ce().cn)({propertySchema:e,hasAutomationUpdatedErrorStatesEnabled:t}));continue}const{filter:c}=s;if("changes_to_any"===c.operator)g.push(Ie().Od(a,{propertyName:e.name}));else if(d().fZ(c))g.push(Ie().yR(a,{propertyName:e.name}));else if(u().nq(e))if("status"===e.type){if(!d().H$(c)||!d().gc(c)){g.push((0,Pe().zQ)(e));continue}const t=d().V6(c),o=(0,Te().a)({intl:a,groupValues:t.map((e=>"is_group"===e.type?e.value:void 0)).filter(E().O9),isText:!0,optionValues:t.map((e=>"is_option"===e.type?e.value:void 0)).filter(E().O9),propertySchema:e,tokenFormat:ue().NY.Small}),n=a.formatList(o,{style:"long",type:"disjunction"});g.push(Ie().Yx(a,{propertyName:e.name,propertyValues:n}))}else if("select"===e.type||"multi_select"===e.type){if(d().fZ(c)||!d().v0(c)&&!d().as(c)||"select"===e.type&&d().as(c)||"multi_select"===e.type&&d().v0(c)){g.push((0,Pe().zQ)(e));continue}const t=Array.isArray(c.value)?c.value:[c.value],o=(0,je().$5)({intl:a,isText:!0,optionValues:t.map((e=>e.value)).filter(E().O9),propertySchema:e,tokenFormat:ue().NY.Small}),n=a.formatList(o,{style:"long",type:"disjunction"}),r=(0,je().l5)({filter:c,propertySchema:e});if(r){const t=(0,je().JI)(r);g.push(t(a,{propertyName:e.name,propertyValues:n}))}}else if("checkbox"===e.type){if(!d().Ui(c)){g.push((0,Pe().zQ)(e));continue}g.push((0,Ae().Hk)({filter:c,propertySchema:e,intl:a}))}else if("person"===e.type){if(!d().I_(c)){g.push((0,Pe().zQ)(e));continue}g.push((0,Ve().H)({actorModels:(0,Me().Y)(c,r),operator:c.operator,propertySchema:e,intl:a}))}else if("number"===e.type){if(!d().My(c)){g.push((0,Pe().zQ)(e));continue}g.push((0,_e().VW)({messageType:"trigger",numberValue:c.value.value,operator:c.operator,propertySchema:e,intl:a}))}else if("email"===e.type||"url"===e.type||"text"===e.type||"phone_number"===e.type||"title"===e.type){if(!d().YH(c)){g.push((0,Pe().zQ)(e));continue}"string_is"!==c.operator&&"string_is_not"!==c.operator&&"string_contains"!==c.operator&&"string_does_not_contain"!==c.operator&&"string_starts_with"!==c.operator&&"string_ends_with"!==c.operator||g.push((0,Be().zl)({messageType:"trigger",textValue:c.value.value,operator:c.operator,propertySchema:e,intl:a}))}else if("relation"===e.type){if(!d().Pq(c)){g.push((0,Pe().zQ)(e));continue}if(m().o2(p,e)){g.push((0,ke().Mh)({propertySchema:e}));continue}const t=(0,Re().WE)({collectionStore:o,filter:c}),r=(0,se().getAllContextValues)(l),i=(0,Re().eg)({collectionStore:o,filter:c,propertySchema:e});g.push((0,Re().oE)({availableTokens:i,collectionStore:o,environment:n,operator:c.operator,propertySchema:e,intl:a,relationPages:(0,Re().Iq)({value:t.value,automationContextValues:r})}))}else(0,E().HB)(e)}}return a.formatList(g,{style:"long",type:"all"===c.pagePropertiesEdited.type?"conjunction":"disjunction"})}({...e,triggerConfig:o}),r=De(e);return t.formatMessage({defaultMessage:"When {triggers}, {actions}",id:"automation.summaryCard.caption"},{actions:r,triggers:n})}if("recurrence"===o.type){if(!o.recurrence)return;const n=(0,K().LS)({intl:t,recurrence:o.recurrence}),r=De(e);return t.formatMessage(Ne.recurrenceAutomationSummary,{frequency:n,actions:r})}"button"!==o.type&&(0,E().HB)(o)}}function De(e){var t,o;const{actionStores:n,collectionStore:r,environment:a,intl:i,schema:l,typecheckResult:c,hasAutomationUpdatedErrorStatesEnabled:p}=e,d=[];for(const M of n)if(M.isType("slack_notification"))d.push((0,T.jsx)(B().sA,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:(0,T.jsx)(ye().D,{actionStore:M})}}));else if(M.isType("update_pages")){const e=M.getConfig(),t=null==e?void 0:e.properties,o=null==e?void 0:e.values,n=null==e?void 0:e.target;if(!t||0===t.length||!n)continue;if("collection"===n.type)if((0,R().Z2)(n.collection,r.pointer))d.push((0,T.jsx)(B().sA,{defaultMessage:"edit pages in this collection",id:"automation.summaryCard.updatePages.sameCollection"}));else{const e=Fe().md.createChildStore(r,n.collection),t=(0,Ee().tS)({environment:a,intl:i,store:e});d.push((0,T.jsx)(B().sA,{defaultMessage:"edit pages in {collectionTitle}",id:"automation.summaryCard.updatePages.differentCollection",values:{collectionTitle:t}}))}else if("variable"===n.type){const e=t[0],a=null==o?void 0:o[e],s=qe({collectionSchema:l,propertyId:e,variableId:n.id,typecheckResult:c,actionStore:M});if(!s){d.push(Ie().cC(i));continue}if(!a)continue;if(u().I3(s))if("person"===s.type)d.push((0,T.jsx)(Ye,{collectionStore:r,contextValues:(0,se().getAllContextValues)(c),propertyActionValue:a,propertySchema:s}));else if("status"===s.type){const e=(0,T.jsx)(We,{propertyActionValue:a,propertySchema:s});e&&d.push(e)}else if("select"===s.type||"multi_select"===s.type)d.push((0,T.jsx)(Le,{propertyActionValue:a,propertySchema:s}));else if("checkbox"===s.type)d.push((0,T.jsx)(Ke,{propertyActionValue:a,propertySchema:s}));else if("relation"===s.type)d.push((0,T.jsx)(He,{collectionStore:r,propertyActionValue:a,propertySchema:s}));else if("date"===s.type){const t=(0,T.jsx)(ze,{automationActionId:M.id,collectionStore:r,propertyActionValue:a,propertyId:e,propertySchema:s});t&&d.push(t)}else"number"===s.type||"phone_number"===s.type||"text"===s.type||"title"===s.type||"email"===s.type||"url"===s.type?d.push((0,T.jsx)(Ue,{automationActionId:M.id,propertyActionValue:a,propertySchema:s})):(0,E().HB)(s);else d.push((0,Ce().cn)({propertySchema:s,hasAutomationUpdatedErrorStatesEnabled:p}))}}else if(M.isType("create_page")){var m;const e=null===(m=M.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===r.pointer.id?d.push((0,T.jsx)(B().sA,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):d.push((0,T.jsx)(B().sA,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}else if(M.isType("define_variables")){var g;d.push((0,T.jsx)(B().sA,{defaultMessage:"define {numVariables} custom {numVariables, plural, one {variable} other {variables}}",values:{numVariables:(null===(g=M.getConfig())||void 0===g||null===(g=g.variableIds)||void 0===g?void 0:g.length)??0},id:"automation.summaryCard.defineVariables"}))}else if(M.isType("send_in_app_notification")){var y;const e=null===(y=M.getConfig())||void 0===y?void 0:y.target;if(!e)continue;const n=e.type;switch(n){case"formula":const a=(0,ge().Fbh)(null===(t=e.value)||void 0===t?void 0:t.value),l=(0,ge().kNd)(null===(o=e.value)||void 0===o?void 0:o.value),u=e=>{const t=M.getSpaceId()??"";return{table:me().oo,id:e,spaceId:t}},c=a.map((e=>u(e))),p=c.map((e=>(0,s().xC)({getRecordModel:r.getRecordModel,pointer:e}))).filter(E().O9).map((e=>(0,s().lR)(i,e)));d.push((0,T.jsx)(B().sA,{defaultMessage:"{numTargets, plural, one {send a notification to {singleTarget}} other {send a notification to {numTargets} people}}",values:{numTargets:c.length+l.length,singleTarget:c.length>0?p[0]:X().dC.created_by},id:"automation.summaryCard.sendNotificationUserTarget"}));break;case"property":if(!e.propertyId)break;let m;const g=r.getSchema()[e.propertyId];m=g?g.name??X().dC[g.type]:Ie().CV.unknownPropertyTitle.defaultMessage,d.push((0,T.jsx)(B().sA,{defaultMessage:"send a notification to {propertyDisplayName}",values:{propertyDisplayName:m},id:"automation.summaryCard.sendNotificationPropertyTarget"}));break;default:(0,E().HB)(n)}}else if(M.isType("send_gmail_notification")){var h,f,v,x;const e=M.getConfig()??{},{to:t,cc:o,bcc:n}=e;if(null==t||null===(h=t.value)||void 0===h||!h.value)continue;if("formula"===(null==t||null===(f=t.value)||void 0===f?void 0:f.type)||"formula"===(null==o||null===(v=o.value)||void 0===v?void 0:v.type)||"formula"===(null==n||null===(x=n.value)||void 0===x?void 0:x.type))d.push((0,T.jsx)(B().sA,{defaultMessage:"send an email to recipients based on a formula",id:"automation.summaryCard.sendGmailNotificationUserFormulaTarget"}));else{var S,b,C,A,k;const e=[...null===(S=t.value)||void 0===S?void 0:S.value,...(null==o||null===(b=o.value)||void 0===b?void 0:b.value)||[],...(null==n||null===(C=n.value)||void 0===C?void 0:C.value)||[]],a=(0,ge().Fbh)(e),l=(0,ge().kNd)(null===(A=t.value)||void 0===A?void 0:A.value),u=(0,ge().IQD)(e),c=e=>{const t=M.getSpaceId()??"";return{table:me().oo,id:e,spaceId:t}},p=a.map((e=>(0,s().xC)({getRecordModel:r.getRecordModel,pointer:c(e)}))).filter(E().O9).map((e=>(0,s().lR)(i,e))),m=(0,ce().C3)((0,ge().k4p)(e));p.push(...m);const g=p[0]||(null===(k=u[0])||void 0===k?void 0:k.name)||i.formatMessage(Ne.automationSingleTargetDefault);d.push((0,T.jsx)(B().sA,{defaultMessage:"{numTargets, plural, one {send an email to {singleTarget}} other {send an email to {numTargets} people}}",values:{numTargets:new Set(p).size+l.length+u.length,singleTarget:g},id:"automation.summaryCard.sendGmailNotificationUserTarget"}))}}else M.isType("http_request")&&d.push((0,T.jsx)(B().sA,{defaultMessage:"send a webhook",id:"automation.summaryCard.sendWebRequest"}));return i.formatList(d,{style:"long",type:"conjunction"})}function We(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,B().tz)(),r=(0,Se().qC)({intl:n,propertySchema:o,value:t.value});return r||null}function Le(e){const{propertyActionValue:t,propertySchema:o}=e,n=(0,B().tz)();return(0,i().K8)((()=>(0,xe().cI)({intl:n,limit:ve().S,propertySchema:o,operator:null==t?void 0:t.action,value:t.value})),[n,null==t?void 0:t.action,t.value,o])}function Ke(e){const{propertyActionValue:t,propertySchema:o}=e;return(0,he().rD)({propertySchema:o,value:t.value})}function He(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,r=(0,B().tz)(),l=(0,a().v3)(),{typecheckResult:s}=(0,L().EC)(),u=o.value,c=(0,se().getAllContextValues)(s),p=(0,Re().Iq)({automationContextValues:c,limit:n.limit,value:u});return(0,i().K8)((()=>(0,Re().UW)({collectionStore:t,environment:l,intl:r,operator:null==o?void 0:o.action,propertySchema:n,relationPages:p,value:u})),[t,l,r,null==o?void 0:o.action,n,p,u])}function ze(e){const{automationActionId:t,collectionStore:o,propertyActionValue:n,propertyId:a,propertySchema:l}=e,s=(0,B().tz)(),u=n.value,c=(0,we().F)({actionId:t}),p=(0,r.useMemo)((()=>({type:"collection",collectionStore:o,property:a})),[o,a]),d=(0,i().K8)((()=>(0,fe().A)({intl:s,propertySchema:l,typecheckContextValues:c,value:u,valueContext:p})),[s,l,c,u,p]);return d||null}function Ue(e){const{automationActionId:t,propertyActionValue:o,propertySchema:n}=e,r=(0,a().v3)(),s=(0,l().DP)(),{automationStore:u}=(0,L().EC)(),c=(0,we().F)({actionId:t}),p=(0,i().K8)((()=>(0,be().hF)({automationStore:u,environment:r,propertySchema:n,theme:s,typecheckContextValues:c,value:o.value})),[u,r,o.value,n,s,c]);return p||null}function Ye(e){const{collectionStore:t,propertyActionValue:o,propertySchema:n,contextValues:r}=e,a=(0,B().tz)(),l=(0,i().K8)((()=>(0,Ve().hs)({getRecordModel:t.getRecordModel,contextValues:r,intl:a,operator:o.action,propertySchema:n,value:o.value})),[t.getRecordModel,a,o.action,o.value,n,r]);return l||null}function qe(e){let{collectionSchema:t,propertyId:o,variableId:n,typecheckResult:r,actionStore:a}=e;const i=(0,pe()._H)((0,se().getAllContextValues)(r),n),l=i?(0,pe().XZ)(i.type):void 0;let s=t;if(l&&l.table===de().Vl){s=Fe().md.createChildStore(a,l).getSchema()}return s[o]}var $e=()=>o(244641),Ge=()=>o(556927),Qe=()=>o(66913),Xe=()=>o(751156),Ze=()=>o(755199),Je=()=>o(704152),et=()=>o(460292),tt=()=>o(554283);const ot=(0,B().YK)({tryRepeatingTriggersTitle:{defaultMessage:"Try repeating triggers",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersTitle"},tryRepeatingTriggersBody:{defaultMessage:"Automatically create and edit items on a schedule",id:"database.viewSettings.automationTab.automationWhatsNew.tryRepeatingTriggersBody"},dismissButtonAriaLabel:{defaultMessage:"Close",id:"database.viewSettings.automationTab.automationWhatsNew.dismissButtonAriaLabel"}}),nt={try_repeating_triggers:{title:ot.tryRepeatingTriggersTitle,body:ot.tryRepeatingTriggersBody,url:"https://www.notion.com/help/database-automations#database-automation-triggers"}};function rt(e){let{collectionStoreId:t,surface:o,type:n}=e;const[s,u]=(0,r.useState)(!0),[c,p]=(0,tt().B)(),d=(0,a().v3)(),m=(0,B().tz)(),g=(0,i().K8)((()=>{const{currentUserSettingsStore:e}=oe().default.state;if(!e||!e.isReady())return!1;const t=e.getSettingsStore().getKeyStore(`has_clicked_${n}_prompt`).getValue(),o=e.getSettingsStore().getKeyStore(`has_clicked_close_${n}_prompt`).getValue();if(t||o)return!1;const r=e.getSettingsStore().getKeyStore(`seen_${n}_prompt_at`).getValue();if((0,E().O9)(r)){const e=$e().c9.fromMillis(r),t=$e().c9.fromMillis($e().c9.now().toMillis()).diff(e,["weeks"]),o=t.toObject().weeks??0;return(0,E().O9)(t.toObject().weeks)&&o<=5}return Xe().createAndCommit({userAction:"AutomationsView.markPromptFirstSeen",environment:d,canUndo:!0,perform:t=>{Ze().mJ({userSettingsStore:e,transaction:t,data:{[`seen_${n}_prompt_at`]:$e().c9.now().toMillis()}})}}),!0}),[d,n]),y=(0,l().IS)((e=>({button:{borderRadius:10,display:"flex",flexDirection:"column",position:"relative",background:e.tint.regular,padding:"9px 12px"},hoveredButton:{background:e.tint.primaryHover},pressedButton:{backgroundColor:e.tint.primaryPressed},title:{fontWeight:F().Wy.medium,fontSize:F().J.UIRegular.desktop,alignItems:"center",display:"flex",color:e.text.primary,lineHeight:"20px",flexDirection:"row",gap:"2px",marginBottom:6},description:{fontWeight:F().Wy.regular,color:e.text.secondary,fontSize:"14px",lineHeight:"20px"},dismissButton:{position:"absolute",right:6,top:6,borderRadius:4,display:"flex",height:20,justifyContent:"center",alignItems:"center",width:20,visibility:p?"visible":"hidden"},dismissIcon:{width:14,height:14,color:e.icon.secondary}})),[p]),h=(0,r.useCallback)((()=>{if(!t)return;(0,Q().u4)({environment:d,event:{eventName:"automation_learn_click",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:e}=oe().default.state;e&&e.isReady()&&Xe().createAndCommit({userAction:"AutomationsView.markPromptLinkClicked",environment:d,canUndo:!0,perform:t=>{Ze().mJ({userSettingsStore:e,transaction:t,data:{[`has_clicked_${n}_prompt`]:!0}})}})}),[t,n,o,d]),f=(0,r.useCallback)((e=>{if(e.preventDefault(),e.stopPropagation(),u(!1),!t)return;(0,Q().u4)({environment:d,event:{eventName:"automation_close_learn_prompt",eventProperties:{collection_id:t,specific_feature:n,surface:o}}});const{currentUserSettingsStore:r}=oe().default.state;r&&r.isReady()&&Xe().createAndCommit({userAction:"AutomationsView.markPromptDismissed",environment:d,canUndo:!0,perform:e=>{Ze().mJ({userSettingsStore:r,transaction:e,data:{[`has_clicked_close_${n}_prompt`]:!0}})}})}),[t,d,o,n]);return s&&g?(0,T.jsxs)(Je().A,{style:y.button,hoveredStyle:y.hoveredButton,pressedStyle:y.pressedButton,ref:c,href:nt[n].url,external:!0,onClick:h,children:[(0,T.jsxs)("div",{style:y.title,children:[(0,T.jsx)(B().sA,{...nt[n].title}),(0,T.jsx)(et().Q,{iconGroup:Ge().j,variantName:"mini",colorName:"secondary"})]}),(0,T.jsx)("div",{style:y.description,children:(0,T.jsx)(B().sA,{...nt[n].body})}),(0,T.jsx)(z().p,{size:"sm",style:y.dismissButton,onClick:f,"aria-label":m.formatMessage(ot.dismissButtonAriaLabel),children:(0,Qe().V)(y.dismissIcon)})]}):null}const at=(0,B().YK)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically edit properties, create pages, send updates, and more",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentEditor:{defaultMessage:"You're a content editor. Content editors can edit pages, but you need full access to create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentEditor"},automationSearchPlaceholder:{defaultMessage:"Search automations…",id:"database.viewSettings.automationTab.automationSearchPlaceholder"},automationInvalidPausedCaption:{defaultMessage:"Fix any errors or remove failing steps to enable this automation",id:"database.viewSettings.automationTab.automationInvalidPausedCaption"},automationInvalidActiveCaption:{defaultMessage:"Fix any errors or remove failing steps to prevent this automation from pausing on failure",id:"database.viewSettings.automationTab.automationInvalidActiveCaption"},automationRestartSuccessMessage:{defaultMessage:"Restarted automation successfully",id:"automations.buttonTrigger.restartSuccessMessage"}});function it(e){const{collectionContextStore:t,collectionSettingsStore:o,fullHeight:s,tabSettings:u}=e,c=(0,a().v3)(),p=(0,B().tz)(),{isMobile:d}=(0,a().Y0)(),[m,g]=(0,r.useState)(""),y=(0,i().K8)((()=>t.collectionStore()),[t]),h=(0,i().K8)((()=>t.collectionViewBlockStore()),[t]),f=(0,i().K8)((()=>y&&y.id),[y]),v=(0,i().K8)((()=>null==y?void 0:y.getSchema()),[y]),x=(0,i().K8)((()=>null==y?void 0:y.getFormat()),[y]),S=(0,i().K8)((()=>mt({collectionStore:y,collectionViewBlockStore:h})),[y,h]),C=(0,i().K8)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:r}=e,a=new Map,i=[];for(const n of t){var l;if(!n.isDefined())continue;const e=[],t=n.getName();void 0!==t&&e.push(t);const s=null===(l=n.getOwnerStore())||void 0===l?void 0:l.getDisplayName(r);if(void 0!==s&&e.push(s),n.isTriggerType("event")){const t=n.getEventConfiguration(),a=null==t?void 0:t.pagePropertiesEdited;let i;if("some"===(null==a?void 0:a.type)?i=a.some:"all"===(null==a?void 0:a.type)&&(i=a.all),i)for(const n of i){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${X().dC[t.type]}`)}const l=yt(n.getActionStores(),o,r);e.push(...l)}else if(n.isTriggerType("recurrence")){const t=n.getRecurrence();t&&e.push((0,K().LS)({recurrence:t,intl:r,leadingPhrase:"every"}));const a=yt(n.getActionStores(),o,r);e.push(...a)}const u=e.join(" ");a.set(n.id,u),i.push(u)}return function(e){const o=new Set(n().filter(e,i).map((e=>{let{original:t}=e;return t})));return t.filter((0,E().u0)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("recurrence"))return{false:e};const t=a.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:S,collectionSchema:v,intl:p})),[S,v,p]),k=(0,i().K8)((()=>C(m)),[C,m]),M=(0,i().K8)((()=>Z().rc({collectionStore:y})),[y]),j=(0,r.useCallback)((()=>{N().js({environment:c,collectionSettingsStore:o,collectionContextStore:t})}),[c,o,t]),I=(0,r.useCallback)((e=>g(e.target.value)),[]),P=(0,r.useCallback)((()=>{f&&(0,Q().u4)({environment:c,event:{eventName:"automation_learn_click",eventProperties:{collection_id:f}}})}),[c,f]);(0,r.useEffect)((()=>{f&&((0,Q().u4)({environment:c,event:{eventName:"automation_list_view",eventProperties:{source:u.source,collection_id:f}}}),re().default.logEvent("automation_list_view","true"))}),[c,f,u]);const[w,_]=r.useState(!1),V=(0,i().K8)((()=>function(e){var t;const o=null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],r=[];for(const a of e){const e=a.getCreatedByPointer();o&&e&&R().L3.isEqual(o,e)?n.push(a):r.push(a)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),r.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:r}}(k)),[k]),F=(0,r.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=V;return w?[...e,...t]:e.length>0?e:t}),[V,w]),O=k.length-F.length,D=!w&&O>0,W=F.length>0,J=!W&&!(""!==m),{currentSpaceStoreId:ee,currentUserStoreId:ie}=(0,i().K8)((()=>{var e,t;return{currentSpaceStoreId:null===(e=oe().default.state.currentSpaceStore)||void 0===e?void 0:e.id,currentUserStoreId:null===(t=oe().default.state.currentUserStore)||void 0===t?void 0:t.id}}),[]),le=(0,ae().P9)({name:"premium_automations",spaceId:ee,userId:ie}),se=(0,i().K8)((()=>Z().rc({collectionStore:y})),[y]),ue=(0,i().O$)(ne().e),ce=le&&se&&ue,pe=(0,l().IS)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:d?0:12,paddingBlockStart:d?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:12,paddingInline:12},menuScrollerStyle:{marginBlockStart:d?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0},createSection:{paddingBlock:20},createButtonWrapper:{paddingInline:12},createButton:{width:"100%",display:"flex",gap:6},headerContainer:{alignItems:"center",display:"flex",gap:4},headerInfoIcon:{fill:e.mediumIconColor,height:14,width:14}})),[d]);return y&&v&&x&&h?(0,T.jsx)(H().Ay,{...e,fullHeight:s,header:!J&&(0,T.jsx)($().A,{children:(0,T.jsx)(U().Ay,{focusInitial:!d,onChange:I,placeholder:p.formatMessage(at.automationSearchPlaceholder),showClearButton:!0,value:m})}),footer:(0,T.jsx)($().A,{style:pe.createSection,topBorder:!1,children:M&&(0,T.jsx)("div",{style:pe.createButtonWrapper,children:(0,T.jsxs)(q().A,{style:pe.createButton,onClick:j,disabled:!ue,children:[(0,A().W)({width:14,height:14}),(0,T.jsx)(B().sA,{...at.automationNewAutomationTitle})]})})}),menuScrollerStyle:pe.menuScrollerStyle,title:W||m?(0,T.jsxs)("div",{style:pe.headerContainer,children:[(0,T.jsx)(B().sA,{...at.automationTabTitle}),(0,T.jsx)(G().A,{placement:te().W.Right,renderTooltip:()=>(0,T.jsx)(B().sA,{...at.automationLearnAutomationTitle}),render:e=>(0,T.jsx)(Y().A,{...e,href:"https://www.notion.so/help/database-automations",external:!0,onClick:P,children:(0,b().$)(pe.headerInfoIcon)})})]}):null,children:(0,T.jsx)("div",{style:pe.wrap,children:J?(0,T.jsxs)("div",{style:pe.emptyViewWrap,children:[(0,T.jsx)(lt,{collectionStore:y}),ce&&(0,T.jsx)(rt,{surface:"empty_automations_view",type:"try_repeating_triggers",collectionStoreId:f})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{style:pe.buttonList,children:[ce&&(0,T.jsx)(rt,{surface:"list_automations_view",type:"try_repeating_triggers",collectionStoreId:f}),F.length>0?F.map(((e,n)=>(0,T.jsx)(L().or,{automationStore:e,children:(0,T.jsx)(ut,{collectionContextStore:t,collectionStore:y,collectionSettingsStore:o,focused:!1,schema:v})},e.id))):(0,T.jsx)("p",{style:pe.noResultsTitle,children:(0,T.jsx)(B().sA,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"})})]}),D&&(0,T.jsx)(z().p,{isGray:!0,size:"xs",style:pe.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),_(!0)},children:(0,T.jsx)("div",{style:pe.showMoreButtonContent,children:(0,T.jsx)(B().sA,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:O}})})})]})})}):null}function lt(e){const{collectionStore:t}=e,o=(0,a().v3)(),n=(0,l().IS)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellowPrimary,height:24,width:24},title:{fontSize:17,fontWeight:F().Wy.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),r=(0,i().K8)((()=>t.getRole()),[t]);let s;return s=(0,i().K8)((()=>Boolean((0,J().qb)(o,t))),[t,o])||!r||"editor"===r?at.automationEmptyViewEditorPublic:"reader"===r||"comment_only"===r?at.automationEmptyViewReadOnly:"content_only_editor"===r||"read_and_write"===r?at.automationEmptyViewContentEditor:at.automationEmptyViewEditorPublic,(0,T.jsxs)("div",{style:n.wrap,children:[(0,T.jsx)("div",{"aria-hidden":!0,children:(0,f().v)(n.icon)}),(0,T.jsx)("p",{style:n.title,children:(0,T.jsx)(B().sA,{...at.automationTabTitle})}),(0,T.jsx)("p",{style:n.copy,children:(0,T.jsx)(B().sA,{...s})})]})}const st={text:_().U,number:o(966098).E,url:o(352064).I,file:o(504709).J,date:o(758219).Z,person:o(234194).M,email:o(617073).J,phone_number:o(818256).C,checkbox:o(263178).S,select:o(974967).n,multi_select:P().v,status:w().T,relation:o(365683).H,rollup:o(735925).h,formula:o(514503).n,created_time:M().w,created_by:j().E,title:o(263931).D,last_edited_time:M().w,last_edited_by:j().E,last_visited_time:M().w,button:w().T,auto_increment_id:o(786386).A,location:I,verification:o(372160).E,geo_point:I,ai_summary:o(727706).G,ai_custom_prompt:o(806411).x,ai_extract:P().v,ai_translate:o(318890).K,ai_keywords:o(981714).u};function ut(e){const{collectionContextStore:t,collectionStore:o,collectionSettingsStore:n,focused:l,schema:s}=e,u=(0,B().tz)(),c=(0,a().v3)(),{automationStore:p}=(0,L().EC)(),{actionIcons:d,actionStores:m,canUserManageAutomation:g,canUserRemoveAutomation:y,isAutomationEnabled:h,isPersistedStateComplete:f,title:v,triggerConfig:x,triggerIcons:S}=ct({collectionStore:o,schema:s}),b=pt({collectionStore:o,isAutomationEnabled:h,isPersistedStateComplete:f}),{caption:C,tooltipCaption:A}=dt({actionStores:m,automationStatus:b,collectionStore:o,isAutomationEnabled:h,schema:s,triggerConfig:x}),k=(0,i().O$)(t.aliveAutomationCountStore),M=(0,r.useCallback)((async()=>{await ie().lg({collectionStore:o,environment:c,existingAutomationStore:p,intl:u,onDelete:()=>{1===k&&N().R8({collectionSettingsStore:n,item:{type:"main"}})}})}),[u,c,o,n,p,k]),j=(0,r.useCallback)((()=>{ie().WA({automationStore:p,environment:c})}),[c,p]),I=(0,r.useCallback)((()=>{D().h({environment:c,mode:"edit_automation",collectionSettingsStore:n,collectionContextStore:t,automationId:p.id,source:"collection_settings_automation_view"})}),[c,n,t,p]),P=(0,r.useCallback)((()=>{ie().HJ({automationStore:p,environment:c})}),[c,p]),w=(0,r.useCallback)((()=>{ie().vH({automationStore:p,collectionStore:o,environment:c})}),[p,o,c]),_=(0,r.useCallback)((()=>{if(!p.isTriggerType("recurrence"))return;ie().be({automationStore:p,collectionStore:o,environment:c});const e=u.formatMessage(at.automationRestartSuccessMessage);O().D6({label:e})}),[p,o,c,u]),V=(0,r.useCallback)((e=>(0,r.createElement)(le().k,{...e,key:p.id,actions:d,caption:C,focused:l,status:b,onClick:I,onDelete:y?M:void 0,onDisable:h&&y&&f?j:void 0,onRestart:"expired"===b?_:void 0,onDuplicate:g?w:void 0,onEdit:g?I:void 0,onEnable:!h&&y&&f?P:void 0,title:v,triggers:S})),[d,p.id,g,y,C,l,b,h,f,M,j,w,I,P,_,v,S]);return(0,T.jsx)(W().P,{caption:A,renderOrigin:V,title:v,tooltipAlignment:te().C.Start,tooltipPlacement:te().W.Left})}function ct(e){let{collectionStore:t,schema:o}=e;const n=(0,B().tz)(),{automationStore:r,typecheckResult:a}=(0,L().EC)(),l=(0,i().K8)((()=>Z().Qn({automationStore:r,collectionStore:t,typecheckResult:a})),[r,t,a]),c=(0,i().K8)((()=>r.getActionStores()),[r]),p=(0,i().K8)((()=>r.getTriggerStore().getValue()),[r]),f=(0,i().K8)((()=>p?function(e){const{schema:t,triggerConfig:o,collectionStore:n}=e,r=[];if("event"===o.type){o.event.pagesAdded&&r.push({color:"blue",icon:A().W,type:"page"});const e=o.event.pagePropertiesEdited;if("any"===e.type)r.push({color:"blue",icon:C().r,type:"misc"});else if("some"===e.type||"all"===e.type){let o=[];"some"===e.type?o=e.some??[]:"all"===e.type&&(o=e.all??[]);for(const e of o){const o=t[e.property],a=e.filter;if(!o)continue;if(!u().tj[o.type]){r.push({color:"gray",icon:gt(o.type),type:"property"});continue}const i=m().DD(o),l=m().lx(o),c=m().E(o),p=m().AM(o),y=(0,g().DY)(o.type),h=m().nC(o);if("changes_to_any"===a.operator)r.push({color:i||l?"gray":"blue",icon:gt(o.type),type:"property"});else if(i&&!d().fZ(a)&&d().H$(a)){const e=d().V6(a);if(e.length>1)r.push({color:"gray",icon:gt(o.type),type:"property"});else if(1===e.length){const t=e[0];if("is_group"===t.type){const e=(o.groups??[]).find((e=>e.name===t.value));e&&r.push({color:e.color??"gray",icon:gt(o.type),type:"property"})}else{const e=(o.options??[]).find((e=>e.value===t.value));e&&r.push({color:e.color??"gray",icon:gt(o.type),type:"property"})}}}else if(l&&(d().v0(a)||d().as(a))){const e=d().fZ(a)?[]:d().v0(a)?d().Zl(a):d().SM(a);if(1===e.length){const t=e[0],n=(o.options??[]).find((e=>e.value===t.value));n&&r.push({color:n.color??"gray",icon:gt(o.type),type:"property"})}else(e.length>1||0===e.length)&&r.push({color:"gray",icon:gt(o.type),type:"property"})}else if(c&&d().I_(a)){const e=d().fZ(a)?[]:d().Wf(a);if(1===e.length){if(!d().fZ(a)){const e=d().Wf(a)[0];if("exact"===e.type&&e.value){const t=(0,s().xC)({pointer:e.value,getRecordValue:n.getRecordValue});r.push({actor:t,type:"person"})}}}else(e.length>1||0===e.length)&&r.push({color:"gray",icon:gt(o.type),type:"property"})}else(p&&d().My(a)||y&&d().YH(a)||h&&d().Pq(a))&&r.push({color:"is_empty"===a.operator?"gray":"blue",icon:gt(o.type),type:"property"})}}}else"recurrence"===o.type?r.push({color:"blue",icon:v().k,type:"misc"}):"button"===o.type||(0,E().HB)(o);return r}({schema:o,triggerConfig:p,collectionStore:t}):[]),[o,p,t]),b=(0,i().K8)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,r=[];for(const p of t)if(p.isType("slack_notification"))r.push({icon:k().z,type:"app"});else if(p.isType("update_pages")){const e=p.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var a,i;const c=t[0],p=n[c],d=null==e||null===(a=e.values)||void 0===a?void 0:a[c];if(!p||!d)continue;if(!u().I3(p)){r.push({color:"gray",icon:gt(p.type),type:"property"});continue}const h=(0,y().fromSimpleFormulaArrayValue)(null===(i=d.value)||void 0===i?void 0:i.value);if(m().DD(p)){const e=(p.options||[]).find((e=>e.value===h[0]));e&&r.push({color:e.color??"gray",icon:gt(p.type),type:"property"})}else if(m().lx(p))if(1===h.length){const e=(p.options||[]).find((e=>e.value===h[0]));e&&r.push({color:e.color??"gray",icon:gt(p.type),type:"property"})}else h.length>1&&r.push({color:"gray",icon:gt(p.type),type:"property"});else if(m().E(p)){var l;const e=(0,g().e5)({textValue:null===(l=d.value)||void 0===l?void 0:l.value,propertySchema:p,blockCreatorPointer:void 0}).map((e=>(0,s().xC)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?r.push({actor:e[0],type:"person"}):r.push({color:"gray",icon:gt(p.type),type:"property"})}else r.push({color:"gray",icon:gt(p.type),type:"property"})}else t.length>1&&r.push({color:"gray",icon:C().r,type:"misc"})}else if(p.isType("create_page")){var c;(null===(c=p.getConfig())||void 0===c?void 0:c.collection)&&r.push({color:"blue",icon:A().W,type:"page"})}else p.isType("send_in_app_notification")?r.push({color:"blue",icon:h().r,type:"misc"}):p.isType("define_variables")?r.push({color:"gray",icon:_().U,type:"misc"}):p.isType("send_gmail_notification")?r.push({icon:S().Y,type:"app"}):p.isType("http_request")&&r.push({color:"gray",icon:e=>(0,x().B)({transform:"scale(1.35)",...e}),type:"misc"});return r}({actionStores:c,collectionStore:t,schema:o})),[o,t,c]),M=(0,i().K8)((()=>r.getNameWithDefault(n)),[n,r]),j=(0,i().K8)((()=>r.isActive()),[r]),T=(0,i().K8)((()=>Z().Gz({automationStore:r,collectionStore:t})),[r,t]),I=(0,i().K8)((()=>Z().TT({actionStores:c,automationStore:r,collectionStore:t})),[c,r,t]);return{isPersistedStateComplete:l,actionStores:c,triggerConfig:p,title:M,isAutomationEnabled:j,canUserManageAutomation:I,canUserRemoveAutomation:T,triggerIcons:f,actionIcons:b}}function pt(e){let{isPersistedStateComplete:t,isAutomationEnabled:o,collectionStore:n}=e;const{automationStore:a,typecheckResult:l}=(0,L().EC)(),s=(0,i().K8)((()=>{if(a.isTriggerType("event")){return!a.getTrigger()||Z().l({automationStore:a,collectionStore:n})}return!1}),[a,n]),u=(0,r.useMemo)((()=>{if(l.error)return!0;const e=l.value.actionValidationFailures;return Object.values(e).flat().length>0}),[l]),c=(0,ee().X)("automation_updated_error_states");return(0,i().K8)((()=>{var e,n;const r=null===(e=a.getModel())||void 0===e?void 0:e.getLastFailedTime(),i=null===(n=a.getModel())||void 0===n?void 0:n.getLastExecutedTime();if(c){if(u||s||!t)return"invalid";if(r&&i&&r>=i&&!o)return"failing";if(!o)return(0,K().NH)(a)?"expired":"paused"}else{if(u||s)return"error";if(!o)return"warning"}return"success"}),[a,c,u,s,t,o])}function dt(e){let{actionStores:t,automationStatus:o,collectionStore:n,isAutomationEnabled:r,schema:l,triggerConfig:s}=e;const u=(0,a().v3)(),c=(0,B().tz)(),{automationStore:p,typecheckResult:d}=(0,L().EC)(),m=(0,ee().X)("automation_updated_error_states");return(0,i().K8)((()=>{const e=r||m?Oe({actionStores:t,collectionStore:n,environment:u,getRecordModel:p.getRecordModel,intl:c,schema:l,triggerConfig:s,typecheckResult:d,hasAutomationUpdatedErrorStatesEnabled:m}):c.formatMessage(at.automationDisabledCaption);return{caption:e,tooltipCaption:m&&"invalid"===o?(0,T.jsx)(B().sA,{...r?at.automationInvalidActiveCaption:at.automationInvalidPausedCaption}):e}}),[r,m,c,t,n,u,p.getRecordModel,l,s,d,o])}function mt(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),r=[];for(const a of n){const e=a.getModel();null!=e&&e.getAlive()&&(a.isDisplayableInCollectionSettings()&&r.push(a))}return r}function gt(e){return(0,E().O9)(e)?st[e]??V().x:V().x}function yt(e,t,o){const n=[];for(const a of e){const e=a.getType();if(e){const t=(0,c().getActionRegistryItem)(e);(0,p().qe)(t)&&n.push(o.formatMessage(t.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var r;const e=a.getConfig();null==e||null===(r=e.properties)||void 0===r||r.forEach((e=>{const o=null==t?void 0:t[e];o&&n.push(`${o.name} ${X().dC[o.type]}`)}))}}return n}},464004:(e,t,o)=>{o.d(t,{l:()=>f});var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(743176),s=()=>o(959013),u=()=>o(284371),c=()=>o(380468),p=()=>o(406699),d=()=>o(928600),m=()=>o(781697),g=()=>o(656134),y=()=>o(548526),h=o(474848);function f(e){const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:f,currentValue:v,disabled:x,onChange:S,onRemove:b,placeholderMessage:C,errorMessage:A,hideErrorMessageTooltip:k}=e,M=(0,r().v3)(),j=(0,i().DP)(),{device:T}=M,I=(0,a().K8)((()=>f.getSchema()??{}),[f]),P=(0,a().K8)((()=>f.getFormat()??{}),[f]),w=(0,a().K8)((()=>v?f.getSchema()[v]:void 0),[v,f]),_=(0,a().K8)((()=>v?f.getDeletedSchema()[v]:void 0),[v,f]),V=(0,i().IS)((e=>{const t={fill:e.text.tertiary,height:"auto",marginRight:4,width:16};return{propertyIcon:t,deletedPropertyIcon:{...t,fill:e.text.uiRedPrimary},propertyTitle:{fontWeight:u().Wy.regular,...u().RC},deletedPropertyTitle:{color:e.text.uiRedPrimary,fontWeight:u().Wy.regular,...u().RC}}}),[]),R=(0,n.useCallback)((()=>o),[o]),B=(0,g().j)(),E=(0,a().K8)((()=>w?function(e){return(0,h.jsx)(l().zB,{icon:void 0,size:16,style:{...e,...V.propertyIcon},theme:j,type:w.type})}:_?function(e){return(0,h.jsx)(l().zB,{icon:void 0,type:_.type,size:16,theme:j,style:{...e,...V.deletedPropertyIcon}})}:void 0),[_,w,V.deletedPropertyIcon,V.propertyIcon,j]),F=Boolean(A),N=!Boolean(w)&&!Boolean(t),O=!Boolean(t);return(0,h.jsx)(p().Ay,{popupType:B,alignmentToOrigin:p().yP.Center,placementToOrigin:p().sx.Bottom,originGap:0,disabled:x,renderOrigin:e=>(0,h.jsx)(y().x,{...e,disabled:x,icon:E,isError:F,hasActionRequired:N,isSecondary:O,tooltipMessage:!k&&A,dropdownButtonType:"button",children:w?(0,h.jsx)("div",{style:V.propertyTitle,children:w.name}):_?(0,h.jsx)("div",{style:V.deletedPropertyTitle,children:_.name}):C?(0,h.jsx)(s().sA,{...C}):t?(0,h.jsx)(s().sA,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit property"}):(0,h.jsx)(s().sA,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,m().v)({device:T,width:280,paddingTop:4});return(0,h.jsx)(d().A,{...t,children:(0,h.jsx)(c().A,{schema:I,format:P,showRemoveOption:Boolean(b),currentProperty:v,getProperties:R,onAccept:t=>{t&&t!==v?S(t):void 0===t&&(null==b||b(v)),e.close()}})})}})}},475679:(e,t,o)=>{o.d(t,{z:()=>N});o(898992),o(354520),o(737550);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(655923),s=()=>o(112282),u=()=>o(457056),c=()=>o(334003),p=()=>o(764781),d=()=>o(105819),m=()=>o(406533),g=()=>o(236262),y=()=>o(340498),h=()=>o(959013),f=()=>o(534177),v=()=>o(813297),x=()=>o(760217),S=()=>o(187485),b=()=>o(135221),C=()=>o(928600),A=()=>o(939740),k=()=>o(89924),M=()=>o(862292),j=()=>o(645873),T=()=>o(324587),I=()=>o(546461),P=()=>o(366360),w=()=>o(76190),_=()=>o(781697),V=()=>o(383574),R=()=>o(686169),B=()=>o(542339),E=o(474848);const F=(0,h().YK)({learnAboutVariablesMenuItemLabel:{defaultMessage:"Learn about variables",id:"automations.actionContextMenu.learnAboutVariablesMenuItemLabel"},learnAboutWebhooksMenuItemLabel:{defaultMessage:"Learn about webhooks",id:"automations.actionContextMenu.learnAboutWebhooksMenuItemLabel"},addStepAboveMenuItemLabel:{defaultMessage:"Add action above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add action below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateMenuItemLabel:{defaultMessage:"Duplicate",id:"automations.actionContextMenu.duplicateMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicating…",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function N(e){const{actionStore:t,closeMenu:o}=e,{maybePersistedTransactionActions:i}=(0,P().b)(),{automationStore:l,contextType:s}=(0,I().EC)(),u=(0,h().tz)(),c=(0,r().v3)(),{value:p}=(0,j().fJ)(M().T.formulas),{value:d}=(0,j().fJ)(v().QV.automationTypecheck),[m,g]=(0,n.useState)(),y=(0,a().K8)((()=>l.getActionIds()),[l]),f=(0,a().K8)((()=>y.indexOf(t.id)),[t.id,y]),x=(0,a().K8)((()=>(0,R().J)(s,t)),[t,s]),S=(0,a().K8)((()=>{if(!x||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,x]),b=0===f,C=f===y.length-1,A=(0,n.useCallback)((()=>{g(void 0),null==o||o()}),[o]),k=(0,V().V)(),_=(0,a().K8)((()=>k.some((e=>e.type===t.getType()))),[t,k]),N=(0,w().n)(l),D=(0,n.useMemo)((()=>{if(l&&_)return async()=>{const e=i.createAndCommit({perform:e=>T().duplicateAutomationAction({sourceActionStore:t,environment:c,includeParenting:!0,insertionPoint:{afterActionId:t.id},transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,A()}}),[t,l,c,A,i,_]),L=(0,n.useCallback)((()=>{if(p&&d)return i.createAndCommit({perform:e=>{T().removeAutomationAction({actionStore:t,automationStore:l,automationTypecheckModule:d,contextType:s,environment:c,formulasModule:p,intl:u,isSubscribed:N,transaction:e})},userAction:"ActionContextMenu.removeAction"}),A(),Promise.resolve()}),[t,l,d,s,c,p,A,u,i,N]),K=(0,n.useMemo)((()=>{if(!b&&p&&d)return()=>{i.createAndCommit({perform:e=>{const o=W(y,f-1,f);T().reorderAutomationActions({environment:c,automationStore:l,automationTypecheckModule:d,contextType:s,formulasModule:p,intl:u,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id,isSubscribed:N})},userAction:"ActionContextMenu.moveAction"}),A()}}),[b,i,A,y,p,f,l,s,u,c,t,d,N]),H=(0,n.useMemo)((()=>{if(!C&&p&&d)return()=>{i.createAndCommit({perform:e=>{const o=W(y,f+1,f);T().reorderAutomationActions({environment:c,automationStore:l,automationTypecheckModule:d,contextType:s,formulasModule:p,intl:u,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id,isSubscribed:N})},userAction:"ActionContextMenu.moveAction"}),A()}}),[C,i,A,y,f,l,s,u,p,c,t,d,N]),z=(0,n.useMemo)((()=>{if(x&&S)return function(){g({initialState:{actionId:t.id,propertyId:S,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,x,S]),U=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{g({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}}),[k.length,t.id]),Y=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{g({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}}),[k.length,t.id]),q=(0,a().K8)((()=>"define_variables"===t.getType()?{link:"https://www.notion.so/help/database-automations#database-automation-actions",label:F.learnAboutVariablesMenuItemLabel}:"http_request"===t.getType()?{link:"https://www.notion.so/help/webhook-actions",label:F.learnAboutWebhooksMenuItemLabel}:void 0),[t]);return(0,E.jsxs)(E.Fragment,{children:[!m&&(0,E.jsx)(O,{onAddStepAbove:U,onAddStepBelow:Y,onDelete:L,onDuplicate:D,onEdit:z,onMoveDown:H,onMoveUp:K,learnAbout:q}),m&&(0,E.jsx)(B().A,{initialState:m.initialState,insertionPoint:m.insertionPoint,onClose:A})]})}function O(e){const{onAddStepAbove:t,onAddStepBelow:o,onDelete:r,onDuplicate:a,onEdit:v,onMoveDown:x,onMoveUp:b,learnAbout:M}=e,j=(0,_().e)();let T=!1;const I=function(e){const{hasSeparator:t,onEdit:o}=e,r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"edit",render:e=>(0,E.jsx)(D,{...e,icon:(0,d().pencilLineIcon)({width:y().Ev.default}),children:(0,E.jsx)(h().sA,{...F.editMenuItemLabel})})}}),[o]),a=[r].filter(f().O9);if(0===a.length)return;return{items:a,key:"editActions",render:e=>(0,E.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onEdit:v});T||=Boolean(I);const P=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:r}=e,a=(0,n.useMemo)((()=>{if(r)return{action:r,key:"moveUp",render:e=>(0,E.jsx)(D,{...e,icon:(0,s().s)({width:y().Ev.default}),children:(0,E.jsx)(h().sA,{...F.moveUpMenuItemLabel})})}}),[r]),i=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,E.jsx)(D,{...e,icon:(0,l().v)({width:y().Ev.default}),children:(0,E.jsx)(h().sA,{...F.moveDownMenuItemLabel})})}}),[o]),u=[a,i].filter(f().O9);if(0===u.length)return;return{items:u,key:"moveSteps",render:e=>(0,E.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onMoveDown:x,onMoveUp:b});T||=Boolean(P);const w=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:r}=e,a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,E.jsx)(D,{...e,icon:(0,c().F)({width:y().Ev.default}),children:(0,E.jsx)(h().sA,{...F.addStepAboveMenuItemLabel})})}}),[o]),i=(0,n.useMemo)((()=>{if(r)return{action:r,key:"addStepBelow",render:e=>(0,E.jsx)(D,{...e,icon:(0,u().o)({width:y().Ev.default}),children:(0,E.jsx)(h().sA,{...F.addStepBelowMenuItemLabel})})}}),[r]),l=[a,i].filter(f().O9);if(0===l.length)return;return{items:l,key:"addSteps",render:e=>(0,E.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onAddStepAbove:t,onAddStepBelow:o});T||=Boolean(w);const V=function(e){const{hasSeparator:t,onDuplicate:o,onDelete:r}=e,[a,i]=(0,n.useState)(!1),l=(0,n.useMemo)((()=>{if(o)return{action:async()=>{i(!0);try{await o()}finally{i(!1)}},key:"duplicate",render:e=>(0,E.jsx)(D,{...e,icon:(0,p().V)({width:y().Ev.default}),isLoading:a,children:a?(0,E.jsx)(h().sA,{...F.duplicatingMenuItemLabel}):(0,E.jsx)(h().sA,{...F.duplicateMenuItemLabel})})}}),[a,o]),s=(0,n.useMemo)((()=>{if(r)return{action:r,key:"delete",render:e=>(0,E.jsx)(D,{...e,icon:(0,g().trashIcon)({width:y().Ev.default}),isRedOnHover:!0,children:(0,E.jsx)(h().sA,{...F.deleteMenuItemLabel})})}}),[r]),u=[l,s].filter(f().O9);if(0===u.length)return;return{items:u,key:"otherActions",render:e=>(0,E.jsx)(k().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onDuplicate:a,onDelete:r});T||=Boolean(V);const R=function(e){const{hasSeparator:t,learnAbout:o}=e,n=(0,i().IS)((e=>({icon:{height:16,width:16,fill:e.text.secondary},textWrapper:{color:e.text.secondary}})),[]);if(!o)return;return{items:[{action:()=>{},key:"learnAbout",render:e=>(0,E.jsx)(D,{...e,icon:(0,m().questionMarkCircleIcon)(n.icon),textWrapperStyle:n.textWrapper,children:(0,E.jsx)(S().A,{href:o.link,external:!0,children:(0,E.jsx)(h().sA,{...o.label})})})}],key:"learnSteps",render:e=>(0,E.jsx)(k().A,{topBorder:t,...e})}}({hasSeparator:T,learnAbout:M});return T||=Boolean(R),(0,E.jsx)(C().A,{...j,children:(0,E.jsx)(A().Ay,{type:A().Oh.Vertical,sections:[I,P,w,V,R].filter(f().O9),initialFocus:0})})}function D(e){const{children:t,icon:o,isLoading:n,...r}=e,a=n?(0,E.jsx)(b().A,{}):o;return(0,E.jsx)(x().A,{...r,disabled:n,disabledFeedback:n,icon:a,title:t})}function W(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},477329:(e,t,o)=>{o.d(t,{$5:()=>S,JI:()=>x,Ww:()=>f,l5:()=>b});o(898992),o(354520),o(581454),o(296540);var n=()=>o(401497),r=()=>o(713998),a=()=>o(784892),i=()=>o(959013),l=()=>o(534177),s=()=>o(284371),u=()=>o(399762),c=()=>o(881690),p=()=>o(496401),d=()=>o(214973),m=()=>o(529135),g=()=>o(989064),y=o(474848);const h=5;function f(e){const t=(0,i().tz)(),{filter:o,propertySchema:n,onClick:r}=e,a={...s().RC,fontWeight:s().Wy.medium},u=o.value,c=n.name,d=(Array.isArray(u)?u:[u]).map((e=>e.value)).filter(l().O9),m=S({intl:t,isText:!0,limit:h,optionValues:d,propertySchema:n}),f=t.formatList(m,{style:"long",type:"disjunction"}),C=b({filter:o,propertySchema:n});if(!C)return null;const A=x(C)(t,{propertyName:(0,y.jsx)("span",{style:a,children:c}),propertyValues:(0,p().d)(f)});return(0,y.jsx)(g().z,{tooltip:A,onClick:r,children:(0,y.jsx)(v,{...C})})}function v(e){const{filter:t,propertySchema:o}=e,r=(0,i().tz)(),a=t.value,u=o.name,c=(Array.isArray(a)?a:[a]).map((e=>e.value)).filter(l().O9),d=S({intl:r,limit:h,optionValues:c,propertySchema:o}),m=r.formatList(d,{style:"long",type:"disjunction"}),g=(0,n().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().RC,fontWeight:s().Wy.medium}})),[]),f=b({filter:t,propertySchema:o});if(!f)return null;const v=x(f)(r,{propertyName:(0,y.jsx)("span",{style:g.propertyName,children:u}),propertyValues:(0,p().d)(m)});return(0,y.jsx)("div",{style:g.content,children:v})}function x(e){let{filter:t,propertySchema:o}=e;return"select"===o.type?"enum_is"===t.operator?d().Ee:d().n1:"enum_contains"===t.operator?d().Q$:d().Re}function S(e){let{intl:t,isText:o,limit:n,optionValues:i,propertySchema:l,tokenFormat:s=a().NY.Medium}=e;const p=l.options??[],g=i.map((e=>{const n=(0,r().jy)(p,e);return n?o?n.value:(0,y.jsx)(u().O,{value:n.value,color:n.color,format:s,isSingle:!0,showRemoveButton:!1},n.id):o?(0,d().iy)(t):(0,y.jsx)(m().A,{tokenFormat:s},`missing_option_value_${e}`)}));let h;if(void 0!==n&&g.length>n){const e=g.length-n,t=o?`+${e}`:(0,y.jsx)(c().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...g.slice(0,n),t]}else h=g;return h}function b(e){const{filter:t,propertySchema:o}=e;if("select"===o.type){if("enum_is"===t.operator||"enum_is_not"===t.operator)return{filter:t,propertySchema:o}}else if("multi_select"===o.type&&("enum_contains"===t.operator||"enum_does_not_contain"===t.operator))return{filter:t,propertySchema:o};return!1}},486521:(e,t,o)=>{o.d(t,{v:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("checkboxSquareChecked",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{d:"M2.85742 13.4561H11.1357C12.6123 13.4561 13.3779 12.6904 13.3779 11.2344V2.91504C13.3779 1.45215 12.6123 0.693359 11.1357 0.693359H2.85742C1.38086 0.693359 0.615234 1.45215 0.615234 2.91504V11.2344C0.615234 12.6973 1.38086 13.4561 2.85742 13.4561ZM2.93945 12.1162C2.30371 12.1162 1.95508 11.7812 1.95508 11.1182V3.02441C1.95508 2.36133 2.30371 2.0332 2.93945 2.0332H11.0537C11.6826 2.0332 12.0381 2.36133 12.0381 3.02441V11.1182C12.0381 11.7812 11.6826 12.1162 11.0537 12.1162H2.93945ZM6.26855 10.3115C6.51465 10.3115 6.72656 10.1885 6.87012 9.96973L9.92578 5.19141C10.0146 5.04785 10.0967 4.88379 10.0967 4.72656C10.0967 4.3916 9.7959 4.16602 9.47461 4.16602C9.26953 4.16602 9.08496 4.27539 8.94141 4.50781L6.24121 8.8418L4.96973 7.22168C4.80566 7.00977 4.6416 6.93457 4.43652 6.93457C4.10156 6.93457 3.8418 7.20117 3.8418 7.54297C3.8418 7.70703 3.90332 7.85742 4.01953 8.00098L5.63281 9.96973C5.81738 10.209 6.01562 10.3115 6.26855 10.3115Z"})})},488887:(e,t,o)=>{function n(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}o.d(t,{_:()=>n})},496401:(e,t,o)=>{o.d(t,{d:()=>r});o(944114),o(296540);var n=o(474848);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))return[e];const o=[];for(const r of e)if("string"==typeof r&&" "!==r[0]){const e=o.pop();o.push((0,n.jsxs)("div",{style:t,children:[e,r]}))}else o.push(r);return o}},500071:(e,t,o)=>{o.d(t,{D:()=>Y,y9:()=>H});o(898992),o(672577);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(81768);const s=2e3;var u=()=>o(977345),c=()=>o(791089),p=()=>o(315564),d=()=>o(919709),m=()=>o(959013),g=()=>o(496603),y=()=>o(534177),h=()=>o(284371),f=()=>o(246826),v=()=>o(725614),x=()=>o(84817),S=()=>o(406699),b=()=>o(628864),C=()=>o(186445),A=()=>o(909470),k=()=>o(731320),M=()=>o(963589),j=()=>o(463830),T=()=>o(53137),I=()=>o(829e3),P=()=>o(546461),w=()=>o(653417),_=()=>o(301782),V=()=>o(366360),R=()=>o(858163),B=()=>o(133518),E=()=>o(656134),F=()=>o(475679),N=()=>o(542339),O=()=>o(548526),D=()=>o(929531),W=()=>o(616175),L=o(474848);const K=(0,m().YK)({slackCustomMessageLabel:{defaultMessage:"Custom message",id:"automations.SlackNotificationAction.customMessageLabel"},invalidChannelLabel:{defaultMessage:"Invalid channel",id:"slackNotificationAction.slackTargetChannel.invalidChannel"},hiddenChannelLabel:{defaultMessage:"Hidden channel",id:"slackNotificationAction.slackTargetChannel.hiddenName"},noTargetChannelLabel:{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"}});function H(e){const{actionStore:t}=e,o=oe(t),{automationStore:i}=(0,P().EC)(),{disabled:p,maybePersistedTransactionActions:g,suppressActionErrors:h}=(0,V().b)(),S=(0,l().getActionRegistryItem)("slack_notification"),b=Boolean(p),C=ee(i)?(0,L.jsx)(w().TooltipWithSubtitle,{content:(0,L.jsx)(m().sA,{...w().automationErrorMessages.slackNotificationAuthenticationError})}):null,k=(0,a().uB)(void 0,j().A),T=(0,n.useCallback)((()=>k.reset()),[k]),I=(0,n.useMemo)((()=>(0,L.jsx)(F().z,{actionStore:t,closeMenu:T})),[t,T]),E=(0,n.useMemo)((()=>!h.includes(t.id)),[h,t]),{errorMessage:N}=(0,w().useErrorComponentForAction)({actionId:t.id,errorKey:"external_bot_id",shouldShow:E}),{errorMessage:O}=(0,w().useErrorComponentForAction)({actionId:t.id,errorKey:"target",shouldShow:E}),H=(0,a().K8)((()=>t.getSpaceId()),[t]),U=(0,a().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.custom_message}),[t]),Y=(0,B().F)({actionId:t.id}),q=(0,a().K8)((()=>{if(H)return(0,c().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,u().zg)(t.getRecordModel),spaceId:H,valueTypes:Y.slice(0),featureGates:(0,A().i)()},value:U})}),[t.getRecordModel,U,Y,H]),$=(0,M().X)("automation_slack_fast_processor"),{onTextStoreSelect:G,onTextStoreUnselect:Q}=(0,R().W)(t),X=(0,r().v3)(),Z=(0,n.useCallback)((()=>{v().clear({environment:X})}),[X]),J=(0,n.useCallback)((e=>{const o=null==e?void 0:e.value;(!(0,y().O9)(o)||(0,d().AhH)(o)<=s)&&(g.createAndCommit({perform:o=>{f().zv({data:{custom_message:e},store:t.getConfigStore(),transaction:o})},userAction:"SlackNotificationAction.setCustomMessage"}),(0,_().UB)(X,{automationStore:i,automationActionStore:t}))}),[t,i,X,g]);return H&&q?(0,L.jsxs)(D().OT,{actionMenu:I,buttonPopupStore:k,disabled:b,actionId:t.id,canCollapse:!1,children:[(0,L.jsx)(D().h3,{actionId:t.id,actionRegistryItem:S,disabled:b,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,L.jsx)(z,{actionStore:t,automationStore:i,disabled:b,errorMessage:C??N??O})}),$&&(0,y().O9)(o)&&(0,L.jsx)(D().qt,{children:(0,L.jsx)(x().Y1,{direction:"vertical",gap:16,children:(0,L.jsx)(W().M,{analyzedFormulaOutput:q,labelMessageDescriptor:K.slackCustomMessageLabel,disabled:b,disableMobileActionBar:!0,disableStyleAnnotations:!1,disableFormulas:!1,disableMentions:!1,isOptional:!0,formulaTypecheckContextValues:Y,parentRecordStore:t,rows:5,spaceId:H,value:U,onChange:J,onTextStoreSelect:G,onTextStoreUnselect:Q,onTextEsc:Z})})})]}):null}function z(e){const{actionStore:t,automationStore:o,disabled:n,errorMessage:r}=e;return(0,L.jsx)(m().sA,{defaultMessage:"Notify{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{slackTargetPicker:(0,L.jsx)(U,{actionStore:t,automationStore:o,disabled:n,errorMessage:r})}})}function U(e){const{actionStore:t,automationStore:o,disabled:r,errorMessage:i}=e,l=(0,a().K8)((()=>{const e=t.getConfigStore(),o=e.getKeyStore("external_bot_id").getValue();if((0,g().Im)(o))return!1;const n=e.getKeyStore("target").getValue();return!(0,g().Im)(null==n?void 0:n.id)}),[t]),s=(0,a().uB)(void 0,j().A),u=(0,n.useCallback)((()=>s.reset()),[s]),c=function(e){const{actionStore:t,automationStore:o}=e,[n,r]=(0,a().K8)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),i=ee(o),{currentExternalAuthentication:l}=J(t),s=(0,a().K8)((()=>T().A.completeSlackAuthentications.state.length??0),[]);if((0,y().O9)(n)&&(0,y().O9)(r))return i?{actionStore:t,externalBotId:r,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,y().O9)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===s?{actionStore:t,type:"connectToSlackDefault"}:s>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),p=(0,E().j)();return(0,L.jsx)(S().Ay,{alignmentToOrigin:S().yP.End,buttonPopupStore:s,disabled:r,originGap:0,placementToOrigin:S().sx.Bottom,popupType:p,renderOrigin:e=>(0,L.jsx)(O().x,{...e,disabled:r,isCompact:!0,isError:Boolean(i),hasActionRequired:!l,dropdownButtonType:"dropdown",children:l?(0,L.jsx)(Y,{actionStore:t}):(0,L.jsx)(m().sA,{...K.noTargetChannelLabel})}),render:()=>(0,L.jsx)(N().A,{initialState:c,onClose:u})})}function Y(e){const{actionStore:t}=e,o=(0,r().v3)(),n=(0,a().K8)((()=>{const e=(0,C().ZO)();return!(0,y().O9)(e)||Boolean((0,k().qb)(o,e))}),[o]),i=oe(t),{authenticationState:l}=J(t);return"invalid_channel"===l?(0,L.jsx)(Z,{}):n||!(0,y().O9)(i)?(0,L.jsx)(X,{}):"me"===i.type?(0,L.jsx)(G,{channelName:i.name}):"private"===i.type?(0,L.jsx)($,{channelName:i.name}):"public"===i.type?(0,L.jsx)(q,{channelName:i.name}):"im"===i.type?(0,L.jsx)(Q,{channelName:i.name}):void(0,y().HB)(i.type)}function q(e){return(0,L.jsx)("span",{style:h().RC,children:`#${e.channelName}`})}function $(e){const{channelName:t}=e,o=te();return(0,L.jsxs)("div",{style:o.container,children:[(0,p().S)(o.lockIcon),(0,L.jsx)("span",{style:h().RC,children:t})]})}function G(e){const{channelName:t}=e;return(0,L.jsx)("span",{style:h().RC,children:`@${t}`})}function Q(e){const{channelName:t}=e;return(0,L.jsx)("span",{style:h().RC,children:`@${t}`})}function X(){const e=te();return(0,L.jsxs)("div",{style:e.container,children:[(0,p().S)(e.lockIcon),(0,L.jsx)("span",{style:h().RC,children:(0,L.jsx)(m().sA,{...K.hiddenChannelLabel})})]})}function Z(){const e=te();return(0,L.jsx)("div",{style:e.container,children:(0,L.jsx)("span",{style:h().RC,children:(0,L.jsx)(m().sA,{...K.invalidChannelLabel})})})}function J(e){return(0,a().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return{authenticationState:"invalid_channel",currentExternalAuthentication:void 0};const o=T().A.completeSlackAuthentications.state.find((e=>t===e.id));return(0,y().O9)(o)?{authenticationState:"selected_channel",currentExternalAuthentication:o}:{authenticationState:"hidden_channel",currentExternalAuthentication:void 0}}),[e])}function ee(e){return(0,a().K8)((()=>"disabled_auth"===e.getStatus()),[e])}function te(){const{isMobile:e}=(0,r().Y0)(),t=e?h().J.UISmall.mobile:h().J.UISmall.desktop;return(0,i().IS)((()=>({container:{alignItems:"baseline",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:t}})),[t])}function oe(e){const t=(0,r().v3)(),o=(0,a().K8)((()=>{var t;return null===(t=e.getConfig())||void 0===t||null===(t=t.target)||void 0===t?void 0:t.id}),[e]),{currentExternalAuthentication:i}=J(e);return n.useEffect((()=>{i&&(0,b().Hn)({environment:t,spaceId:i.space_id,externalAuthConfig:{type:"external",botId:i.id}})}),[t,i]),(0,a().K8)((()=>{if(i&&o){const e=I().c.getStateForBot({type:"external",botId:i.id}).channels[o];if(e)return e}}),[o,i])}},507354:(e,t,o)=>{o.d(t,{k:()=>U,y:()=>ee});o(944114),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(819121),i=()=>o(588316),l=()=>o(847249),s=()=>o(401497),u=()=>o(442277),c=()=>o(340498),p=o(474848);const d=(0,c().wt)("pause",{viewBox:"0 0 6 8",svg:(0,p.jsx)("path",{d:"M1.008 7.473q-.294 0-.442-.149t-.144-.441V1.477q0-.29.148-.438.15-.148.438-.148h.937q.29.003.438.148.148.144.148.438v5.406q0 .292-.148.441-.15.15-.438.149zm3.047 0q-.297 0-.446-.149-.144-.149-.144-.441V1.477q0-.29.148-.438.149-.148.442-.148h.933q.293 0 .438.148.148.144.148.438v5.406q0 .292-.148.441-.145.15-.438.149z"})});var m=()=>o(693954),g=()=>o(558842),y=()=>o(959013),h=()=>o(534177),f=()=>o(284371),v=(o(898992),o(354520),()=>o(519143)),x=()=>o(764781),S=()=>o(126617),b=()=>o(200582),C=()=>o(105819),A=()=>o(236262),k=()=>o(760217),M=()=>o(406699),j=()=>o(285790),T=()=>o(928600),I=()=>o(939740),P=()=>o(8980),w=()=>o(89924),_=()=>o(574036),V=()=>o(463830),R=()=>o(781697),B=()=>o(656134);const E=(0,y().YK)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"},automationSummaryCardMoreMenuActiveTitle:{defaultMessage:"Active",id:"automations.AutomationSummaryCard.MoreActionsMenu.Active.title"},automationSummaryCardMoreMenuRestartTitle:{defaultMessage:"Restart",id:"automations.AutomationSummaryCard.MoreActionsMenu.Restart.title"}});function F(e){const{focused:t,style:o,onEdit:r,onDelete:a,onDuplicate:i,onDisable:u,onEnable:d,onRestart:m}=e,g=(0,y().tz)(),h=(0,l().uB)(void 0,V().A),f=(0,B().j)();(0,n.useEffect)((()=>{t||h.setState({open:!1})}),[t,h]);const v=(0,s().IS)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:c().Ev.sm,height:c().Ev.sm}})),[o]);return(0,p.jsx)(M().Ay,{stopClickPropagation:!0,popupType:f,alignmentToOrigin:M().yP.Center,placementToOrigin:M().sx.Bottom,originGap:0,renderOrigin:e=>(0,p.jsx)(j().A,{ariaLabel:g.formatMessage(E.automationSummaryCardMoreButtonAriaLabel),icon:S().Y,iconStyle:v.iconButtonIcon,style:v.iconButton,hasBackground:!0,...e}),render:e=>(0,p.jsx)(N,{onClose:()=>e.close(),onEdit:r,onDelete:a,onDuplicate:i,onDisable:u,onEnable:d,onRestart:m}),buttonPopupStore:h})}function N(e){const{onClose:t,onEdit:o,onDelete:n,onDuplicate:r,onDisable:a,onEnable:i,onRestart:l}=e,s=(0,y().tz)(),u=(0,R().e)(),c=o?{action:()=>{t(),o()},key:"edit",render:e=>(0,p.jsx)(k().A,{...e,icon:(0,p.jsx)(P().I,{icon:C().pencilLineIcon}),title:s.formatMessage(E.automationSummaryCardMoreMenuEditTitle)})}:void 0,d=l?{action:()=>{t(),l()},key:"restart",render:e=>(0,p.jsx)(k().A,{...e,icon:(0,p.jsx)(P().I,{icon:v().D}),title:s.formatMessage(E.automationSummaryCardMoreMenuRestartTitle)})}:void 0,m=r?{action:()=>{t(),r()},key:"duplicate",render:e=>(0,p.jsx)(k().A,{...e,icon:(0,p.jsx)(P().I,{icon:x().V}),title:s.formatMessage(E.automationSummaryCardMoreMenuDuplicateTitle)})}:void 0,g=i||a?{action:()=>{t(),i?i():a&&a()},key:"active",render:e=>(0,p.jsx)(_().A,{...e,icon:(0,p.jsx)(P().I,{icon:b().m}),title:s.formatMessage(E.automationSummaryCardMoreMenuActiveTitle),on:(0,h().O9)(a)})}:void 0,f=n?{action:()=>{t(),n()},key:"delete",render:e=>(0,p.jsx)(k().A,{...e,icon:(0,p.jsx)(P().I,{icon:A().trashIcon}),title:s.formatMessage(E.automationSummaryCardMoreMenuDeleteTitle),isRedOnHover:!0})}:void 0,S=[];return(0,h().O9)(g)&&S.push({items:[g],key:"active-inactive",render:e=>(0,p.jsx)(w().A,{enableActionSheetTitle:!0,...e})}),S.push({items:[d,c,m,f].filter(h().O9),key:"items",render:e=>(0,p.jsx)(w().A,{enableActionSheetTitle:!0,topBorder:(0,h().O9)(g),...e})}),(0,p.jsx)(T().A,{...u,children:(0,p.jsx)(I().Ay,{type:I().Oh.Vertical,sections:S,initialFocus:0})})}var O=()=>o(464708),D=()=>o(704152),W=()=>o(448693),L=()=>o(115512),K=()=>o(963589),H=()=>o(227440);const z=6;function U(e){const{actions:t,caption:o,focused:u,status:c,maxIcons:d,onBlur:m,onClick:y,onDelete:h,onDisable:v,onDuplicate:x,onEdit:S,onRestart:b,onEnable:C,onFocus:A,onMouseDown:k,onMouseEnter:M,onMouseLeave:j,title:T,triggers:I}=e,{isMobile:P}=(0,r().Y0)(),w=(0,n.useRef)(null),[_,V]=(0,a().A)(),[R,B]=(0,i().A)(),[E,N]=(0,n.useState)(!1),O=P||E||V||B,W=(0,s().IS)((e=>({wrap:{background:e.surface.elevated,border:`1px solid ${e.regularDividerColor}`,borderRadius:10,display:"flex",flexDirection:"column",gap:11,paddingTop:16,paddingLeft:16,paddingRight:16,paddingBottom:13,position:"relative"},moreButtonWrap:{display:O?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:6,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:P?4:0},titleWrap:{..."success"!==c?{alignItems:"center",display:"inline-flex",gap:4}:(0,L().pA)(2),fontSize:P?16:14,fontWeight:f().Wy.medium,lineHeight:"20px"},title:{..."success"!==c?f().RC:{}},caption:{...(0,L().pA)(2),color:e.text.secondary,fontSize:P?14:12,fontWeight:f().Wy.regular,lineHeight:"16px",margin:0}})),[c,O,P]),K=(0,n.useCallback)((e=>{N(!0),M&&M(e)}),[M]),z=(0,n.useCallback)((e=>{N(!1),j&&j(e)}),[j]);(0,n.useEffect)((()=>{u&&null!==w.current&&w.current.focus()}),[u]);const U=(0,g().Px)(w,_,R),q=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,r=n.length,a=t.length,i=r>0&&a>0,l=Math.max(o,3),s=i?l-1:l;let u=Math.max(Math.floor(s/2),1),c=Math.max(Math.ceil(s/2),1);if(r<u&&a>c){c+=u-r,u=r}else if(a<c&&r>u){u+=c-a,c=a}const p=[];if(r>0)if(r>u)if(1===u)p.push({color:"gray",type:"truncate",value:r});else{const e=r-(u-1);p.push(...n.slice(0,u-1)),p.push({color:"gray",type:"truncate",value:e})}else p.push(...n);i&&p.push({type:"arrow"});if(a>0)if(a>c)if(1===c)p.push({color:"gray",type:"truncate",value:a});else{const e=a-(c-1);p.push(...t.slice(0,c-1)),p.push({color:"gray",type:"truncate",value:e})}else p.push(...t);return p}({actionIcons:t,maxIcons:Z(d),triggerIcons:I}),$=(0,l().O$)(H().e),G=$&&Boolean(h||v||C||x||S||b),Q=ee({status:c,titleSize:P?16:14});return(0,p.jsxs)(D().A,{onBlur:m,onClick:y,onFocus:A,onMouseDown:k,onMouseEnter:K,onMouseLeave:z,ref:U,style:W.wrap,disabled:!$,children:[(0,p.jsxs)("header",{children:[G&&(0,p.jsx)("div",{style:W.moreButtonWrap,children:(0,p.jsx)(F,{focused:O,onDelete:h,onDisable:v,onEnable:C,onDuplicate:x,onEdit:S,onRestart:b})}),(0,p.jsx)("ul",{"aria-hidden":"true",style:W.iconList,children:q.map(((e,t)=>(0,p.jsx)("li",{children:(0,p.jsx)(Y,{icon:e})},t)))})]}),(0,p.jsxs)("div",{style:W.body,children:[(0,p.jsxs)("div",{style:W.titleWrap,children:[(0,p.jsx)("span",{style:W.title,children:T}),Q]}),o&&(0,p.jsx)("p",{style:W.caption,children:o})]})]})}function Y(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?(0,p.jsx)(q,{color:t.color,icon:t.icon}):"person"===t.type?(0,p.jsx)(X,{actor:t.actor}):"app"===t.type?(0,p.jsx)(G,{color:"default",icon:t.icon}):"arrow"===t.type?(0,p.jsx)($,{}):"truncate"===t.type?(0,p.jsx)(Q,{color:t.color,value:t.value}):void(0,h().HB)(t.type)}function q(e){const{color:t,icon:o}=e,n=J(t);return(0,p.jsx)("div",{"aria-hidden":"true",style:n.iconWrap,children:o(n.icon)})}function $(){const e=J("default");return(0,p.jsx)("div",{style:{...e.iconWrap,...e.iconArrowWrap},children:(0,u().B)({...e.icon,...e.iconArrow})})}function G(e){const{icon:t}=e,o=J("default");return(0,p.jsx)("div",{"aria-hidden":"true",style:o.iconAppWrap,children:t(o.iconApp)})}function Q(e){const{color:t,value:o}=e,n=J(t);return(0,p.jsxs)("div",{style:{...n.iconWrap,...n.truncateWrap},children:["+",o]})}function X(e){const{actor:t}=e,o=J("default");return(0,p.jsx)("div",{"aria-hidden":"true",style:o.iconPersonWrap,children:(0,p.jsx)(W().Ay,{actor:t,avatarSize:26,format:W().Ay.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}})})}function Z(e){return void 0===e||e<0?z:e}function J(e){const t="default"===e?"gray":e;return(0,s().IS)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14,height:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.icon.secondary,width:14,height:14},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[n],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:f().Wy.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}function ee(e){let{status:t,titleSize:o}=e;const r=(0,K().X)("automation_updated_error_states"),a=(0,s().IS)((e=>({warning:{color:"error"===t?e.errorText:e.accentColors.orange[400],height:"auto",width:o},invalidBadge:{backgroundColor:e.tint.uiRed,color:e.icon.uiRedPrimary},failingBadge:{backgroundColor:e.accentColors.yellow[50],color:e.accentColors.yellow[400]},pausedBadge:{backgroundColor:e.tint.regular,color:e.text.secondary},badgeContainer:{alignItems:"center",display:"flex",fontSize:10},icon:{width:10,height:10,marginRight:"4px"}})),[t,o]);return(0,n.useMemo)((()=>{if(r){if("invalid"===t)return(0,p.jsx)(O().A,{style:a.invalidBadge,content:(0,p.jsxs)("div",{style:a.badgeContainer,children:[(0,m().Q)(a.icon),(0,p.jsx)(y().sA,{defaultMessage:"Invalid",id:"automationSummaryCard.invalidToken"})]})});if("paused"===t)return(0,p.jsx)(O().A,{style:a.pausedBadge,content:(0,p.jsxs)("div",{style:a.badgeContainer,children:[d(a.icon),(0,p.jsx)(y().sA,{defaultMessage:"Paused",id:"automationSummaryCard.pausedToken"})]})});if("failing"===t)return(0,p.jsx)(O().A,{style:a.failingBadge,content:(0,p.jsx)("div",{style:a.badgeContainer,children:(0,p.jsx)(y().sA,{defaultMessage:"Failing",id:"automationSummaryCard.failingToken"})})});if("expired"===t)return(0,p.jsx)(O().A,{style:a.pausedBadge,content:(0,p.jsx)("div",{style:a.badgeContainer,children:(0,p.jsx)(y().sA,{defaultMessage:"Completed",id:"automationSummaryCard.completedToken"})})});if("error"===t||"warning"===t||"success"===t)return;(0,h().HB)(t)}return"success"!==t?(0,m().Q)(a.warning):void 0}),[r,t,a])}},521732:(e,t,o)=>{o.d(t,{Y:()=>S});var n=o(296540),r=()=>o(908006),a=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(496603),u=()=>o(534177),c=()=>o(829300),p=()=>o(725614),d=()=>o(963589),m=()=>o(24157),g=()=>o(84817),y=()=>o(406699),h=()=>o(959013),f=o(474848);const v=(0,h().YK)({simpleFormulaMentionActionButtonAriaLabel:{id:"formulas.simpleFormulaMentionActionButton.ariaLabel",defaultMessage:"Mentions"},simpleFormulaMentionActionButtonTooltip:{id:"formulas.simpleFormulaMentionActionButton.tooltip",defaultMessage:"Mention a person, page, or date"}});function x(e){const{disabled:t,onClick:r}=e,a=(0,h().tz)(),i=(0,l().IS)((e=>({formulaIcon:{fill:e.mediumIconColor,height:16,width:16},button:{height:20,width:20,borderRadius:4}})),[]),s=(0,n.useCallback)((()=>a.formatMessage(v.simpleFormulaMentionActionButtonTooltip)),[a]),u=(0,n.useCallback)((e=>(0,f.jsx)(o(285790).A,{...e,ariaLabel:a.formatMessage(v.simpleFormulaMentionActionButtonAriaLabel),disabled:t,disabledFeedback:t,icon:o(617640).m,iconStyle:i.formulaIcon,onClick:r,style:i.button})),[t,a,r,i]);return(0,f.jsx)(o(859428).A,{disableTooltip:t,renderTooltip:s,placement:o(962730).W.Bottom,render:u})}const S=n.forwardRef((function(e,t){const{allowedReturnTypes:h,disabled:v,disabledMentionTypes:S,disableEmojiCommands:b,disableFilters:C,disableFormulas:A,disableInsertedDeletedAnnotations:k,disableMentions:M,disableMobileActionBar:j,disableNewLines:T,disableStyleAnnotations:I,formulaInputButtonPopupStore:P,formulaTypecheckContextValues:w,onChange:_,onTextEnter:V,onTextStoreSelect:R,onTextStoreUnselect:B,onTextEsc:E,parentRecordStore:F,placeholder:N,rows:O,shouldShowErrorStyles:D,spaceId:W,style:L,value:K}=e,H=Boolean(v),z=(0,a().v3)(),{isMobile:U}=(0,a().Y0)(),Y=(0,n.useRef)(null),q=(0,d().X)("automation_updated_error_states"),$=(0,i().uB)(P,o(463830).A),[G,Q,X]=n.useMemo((()=>{var e;const t=(null==K?void 0:K.type)??"simple",n=null==K?void 0:K.value;return[t,n,(0,u().O9)(n)?(null===(e=o(919709).q4_(n).match(/\n/g))||void 0===e?void 0:e.length)??0:0]}),[null==K?void 0:K.type,null==K?void 0:K.value]),Z="formula"===G,J=(0,n.useMemo)((()=>X>0||void 0!==O&&O>1),[X,O]),ee=n.useRef(!1),te=(0,n.useMemo)((()=>{if(_)return function(e){ee.current?ee.current=!1:_({type:G,value:e})}}),[_,G]),{automationStore:oe}=(0,o(546461).YC)(),ne=(0,n.useMemo)((()=>oe?{automation_id:[[oe.id]]}:void 0),[oe]),{setValue:re,store:ae}=(0,o(847743).AI)({initialValue:Q,onChange:te,properties:ne}),ie=(0,i().K8)((()=>ae.getValue()),[ae]);n.useEffect((()=>{(0,s().n4)(Q,ie)||(ee.current=!0,re(Q))}),[ie,re,Q]);const le=n.useRef(w);n.useEffect((()=>{(0,s().n4)(w,le.current)||(le.current=w,(0,s().n4)(Q,ie)||(ee.current=!0),re(Q))}),[w,ie,re,Q]);const se=(0,i().K8)((()=>!1!==(0,o(792002).j_)(ae)),[ae]);n.useEffect((()=>{if(se)return null==R||R(),function(){null==B||B()}}),[se,R,B]);const ue=(0,n.useMemo)((()=>({...S,reminder:!0})),[S]),ce=(0,n.useMemo)((()=>T?V:function(){const e=m().default.state;"editing"===e.mode&&o(751156).createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:z,canUndo:!0,perform:t=>{o(319975).$D({disableEmojiCommands:!0,disableMentions:!0,disableSlashCommands:!0,editorMode:"default",environment:z,multiSelection:e.multiSelection,string:"\n",transaction:t})}}),null==V||V()}),[z,T,V]),pe=(0,n.useCallback)((()=>{const e=m().default.state;"editing"===e.mode&&(0,o(231722).KP)(e.multiSelection)&&e.multiSelection.start.store===ae||(p().setSelectionAtEnd({store:ae}),r().default.afterNextFlush((()=>{const e=null==Y?void 0:Y.current,t=null==e?void 0:e.getNode();t&&t.scrollTo({top:t.scrollHeight})})))}),[Y,ae]),de=n.useRef(!1),me=n.useCallback((()=>{de.current||(c().VN(),o(393255).VN({dismissed:!1}),o(131581).VN()),de.current=!1,pe()}),[pe]),ge=(0,n.useCallback)((e=>null==_?void 0:_(e)),[_]),ye=(0,n.useCallback)((e=>{e.stopPropagation(),async function(){de.current=!0,c().VN(),null==R||R(),pe(),await r().default.afterNextFlush(),c().Gf({environment:z,mentionSectionOrdering:["custom-formula","formula"],mentionTypes:{bot:!0,createPage:!1,date:!0,formulaContextVariable:!0,group:!0,team:!0,heading:!0,inviteUserToPage:!1,inviteUserToWorkspace:!1,page:!0,reminder:!1,templateVariable:!1,user:!0,slackSpecialMention:!1}})}()}),[z,R,pe]),he=(0,n.useCallback)((e=>{pe(),e.stopPropagation()}),[pe]),fe=(0,n.useCallback)((e=>{if(e.relatedTarget&&(e.currentTarget.contains(e.relatedTarget)||(0,o(253579).Rp)(e.relatedTarget)))return;const t=m().default.getState();if("editing"!==t.mode)return;t.multiSelection.start.store.id===ae.id&&p().clear({environment:z})}),[z,ae.id]),ve=n.useCallback((async()=>{if("formula"===G){await(0,o(419830).Cp)()&&(null==_||_({type:"simple",value:null==K?void 0:K.value}))}else"simple"===G?$.setState({open:!0}):(0,u().HB)(G)}),[$,_,null==K?void 0:K.value,G]),xe=(0,n.useCallback)((()=>$.setState({open:!1})),[$]),Se=(0,n.useCallback)((()=>pe()),[pe]),be=(0,n.useCallback)((()=>{se&&p().clear({environment:z})}),[z,se]);n.useImperativeHandle(t,(()=>({blur:be,focus:Se})),[be,Se]);const Ce=(0,d().X)("collections_xws"),Ae=(0,l().IS)((e=>{const t={whiteSpace:"pre-wrap",lineHeight:"20px",padding:"2px 4px",fontSize:14};return{containerWrap:{width:200,...L},formulaText:{...t,cursor:"pointer"},scroller:{flexGrow:1,height:void 0!==O?`calc(1em * ${1.5*O})`:void 0,maxHeight:"calc(1em * 6)",width:void 0!==O&&O>1||J?"100%":"auto"},text:{...t},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",opacity:H?.4:void 0,width:"100%"},wrap:{background:e.inputBackground,borderRadius:6,boxShadow:e.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:2,...D&&q&&{border:`1px solid ${e.text.uiRedPrimary}`,boxShadow:"none"}},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end",padding:"2px 2px 2px 0px"}}}),[q,H,J,O,D,L]),ke=!M||!A,Me=M||Z,je=Ce?"cross_space_and_read_permissions":"read_permissions_only";return(0,f.jsx)(y().Ay,{buttonPopupStore:$,popupType:U?y().z7.SlideUp:y().z7.Popup,render:()=>(0,f.jsx)(o(999638).A,{allowedReturnTypes:h,disabled:H,formulaTypecheckContextValues:w??[],onChange:ge,onClose:xe,parentRecordStore:F,restrictUnaccessibleProperties:je,spaceId:W,value:K}),renderOrigin:e=>(0,f.jsx)("div",{onClick:he,style:Ae.containerWrap,onBlur:fe,children:(0,f.jsx)(g().Y1,{align:"center",className:o(38337).CCX,direction:"vertical",gap:4,style:Ae.wrap,children:(0,f.jsxs)("div",{style:Ae.textWrap,children:[(0,f.jsx)(o(2143).H,{ref:Y,style:Ae.scroller,type:o(756279).A.Y,children:"simple"===G?(0,f.jsx)(o(524702).A,{disableComment:!0,disabled:H,disabledMentionTypes:ue,disableEmbedMenu:!0,disableEmojiCommands:b,disableFilters:C,disableInsertedDeletedAnnotations:k,disableMentions:M,disableMobileActionBar:j,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableShiftEnter:T,disableSlashCommands:!0,disableStyleAnnotations:I,formulaValueTypes:w??[],inPageFind:o(792540).Os.none,mentionSectionOrdering:["custom-formula","formula"],onDown:s().D_,onEnter:ce,onFocus:me,onTab:s().D_,onUntab:s().D_,onUp:s().D_,onEsc:E,pasteBehavior:"inline",placeholder:N,store:ae,style:Ae.text}):(0,f.jsx)("div",{...e,style:Ae.formulaText,children:(0,f.jsx)(o(905209).$,{formulaTypecheckContextValues:w,parentRecordStore:F,spaceId:W,value:K})})}),ke&&(0,f.jsx)("div",{children:(0,f.jsxs)(g().Y1,{direction:"horizontal",gap:2,style:Ae.actionButtonGroup,children:[!Me&&(0,f.jsx)(x,{disabled:H,onClick:ye}),!A&&(0,f.jsx)(o(50401).F,{disabled:H,onClick:ve,value:K})]})})]})})})})}))},523389:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M11.243 3.457a.803.803 0 0 0-1.13 0l-.554.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .107 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.02-1.11m-2.246 1.22a.075.075 0 0 0-.106 0l-6.336 6.326a1.1 1.1 0 0 0-.237.393l-.27.87v.002c-.062.232.153.466.389.383l.863-.267q.221-.061.397-.239l6.332-6.331a.075.075 0 0 0 0-.106zm-3.355 6.898a.08.08 0 0 0-.053.022l-1.1 1.1a.075.075 0 0 0 .053.128h9.06a.625.625 0 1 0 0-1.25z"})},r=(0,o(340498).wt)("pencilLineSmall",n)},527871:(e,t,o)=>{o.d(t,{V:()=>l});o(898992),o(354520),o(581454);var n=()=>o(103966),r=()=>o(534177),a=()=>o(351360),i=()=>o(577437);function l(e){var t,o;const{triggerType:l,environment:s,automationStore:u}=e;if(null==u||!u.isDefined())return!0;const c=(0,n().Z)(l),p=a().default.state,d=(0,i().zD)(s,{name:"premium_automations",spaceId:null===(t=p.currentSpaceStore)||void 0===t?void 0:t.id,userId:null===(o=p.currentUserStore)||void 0===o?void 0:o.id});return c.isAvailableForContext({automation:u.getModel(),automationActions:u.getActionStores().map((e=>e.getModel())).filter(r().O9),hasPremiumAutomations:d})}},529135:(e,t,o)=>{o.d(t,{A:()=>p});o(296540);var n=()=>o(484714),r=()=>o(401497),a=()=>o(784892),i=()=>o(693954),l=()=>o(959013),s=()=>o(881690),u=()=>o(214973),c=o(474848);function p(e){let{key:t,tokenFormat:o=a().NY.Medium,isSingle:p,showRemoveButton:d,onClickRemove:m}=e;const{isMobile:g}=(0,n().Y0)(),y=(0,l().tz)(),h=(0,r().IS)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,n="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[n]}}}),[g]);return(0,c.jsx)(s().A,{format:o,isSingle:p??!0,showRemoveButton:d??!1,onClickRemove:m,style:h.token,value:(0,c.jsxs)("span",{style:h.tokenValueWrap,children:[(0,c.jsx)("span",{style:h.warningWrap,children:(0,i().Q)(h.warning)}),(0,c.jsx)("span",{style:h.textWrap,children:(0,u().iy)(y)})]})},t)}},541172:(e,t,o)=>{o.d(t,{A5:()=>_,Ol:()=>V,qM:()=>w});o(898992),o(354520),o(672577);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(454503),l=()=>o(105819),s=()=>o(236262),u=()=>o(959013),c=()=>o(534177),p=()=>o(813297),d=()=>o(686526),m=()=>o(760217),g=()=>o(928600),y=()=>o(939740),h=()=>o(8980),f=()=>o(89924),v=()=>o(175116),x=()=>o(898125),S=()=>o(862292),b=()=>o(525432),C=()=>o(645873),A=()=>o(324587),k=()=>o(546461),M=()=>o(366360),j=()=>o(76190),T=()=>o(781697),I=()=>o(813716),P=o(474848);function w(e){const{actionId:t,closeMenu:o,propertyId:i}=e,{maybePersistedTransactionActions:l}=(0,M().b)(),{automationStore:s,contextType:c}=(0,k().EC)(),m=(0,v().Ks)(),g=(0,r().v3)(),y=(0,u().tz)(),{value:h}=(0,C().fJ)(S().T.formulas),{value:f}=(0,C().fJ)(p().QV.automationTypecheck),T=(0,j().n)(s),I=(0,a().K8)((()=>null==m?void 0:m.settingsStore),[m]),w=(0,a().K8)((()=>m&&(0,b().ZI)({collectionContextStore:m,timelineViewTab:"timeline"})),[m]),_=(0,a().K8)((()=>{const e=s.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[s,t]),R=(0,n.useCallback)((()=>{_&&h&&f&&(l.createAndCommit({perform:e=>{A().removeAutomationAction({actionStore:_,automationStore:s,automationTypecheckModule:f,contextType:c,environment:g,formulasModule:h,intl:y,isSubscribed:T,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[_,s,o,c,g,y,l,h,f,T]),B=(0,n.useMemo)((()=>{if(I&&w&&i)return async function(){await(0,x().lT)({hasPendingChanges:!0})&&d().a2({collectionSettingsStore:I,item:{type:"property",formatKey:w,property:i}}),null==o||o()}}),[o,I,w,i]);return(0,P.jsx)(V,{onDelete:R,onEdit:B,stepType:"action"})}function _(e){const{closeMenu:t,propertyId:o}=e,r=(0,v().Ks)(),{removePropertyTrigger:i}=(0,I().p)(),l=(0,a().K8)((()=>null==r?void 0:r.settingsStore),[r]),s=(0,a().K8)((()=>r&&(0,b().ZI)({collectionContextStore:r,timelineViewTab:"timeline"})),[r]),u=(0,n.useCallback)((()=>{i(o),null==t||t()}),[t,o,i]),c=(0,n.useMemo)((()=>{if(l&&s&&o)return async function(){await(0,x().lT)({hasPendingChanges:!0})&&d().a2({collectionSettingsStore:l,item:{type:"property",formatKey:s,property:o}}),null==t||t()}}),[t,l,s,o]);return(0,P.jsx)(V,{onDelete:u,onEdit:c,stepType:"trigger"})}function V(e){const{onDelete:t,onEdit:o,onRestore:r,stepType:a}=e,p=(0,T().e)({width:266}),d=(0,n.useMemo)((()=>(0,c().O9)(o)?{action:o,key:"edit-property-menu-item",render:e=>(0,P.jsx)(m().A,{...e,icon:(0,P.jsx)(h().I,{icon:l().pencilLineIcon}),title:(0,P.jsx)(u().sA,{defaultMessage:"Edit property",id:"unsupportedPropertyMenu.editMenuItem.title"})})}:void 0),[o]),v=(0,n.useMemo)((()=>(0,c().O9)(r)?{action:r,key:"restore-property-menu-item",render:e=>(0,P.jsx)(m().A,{...e,icon:(0,P.jsx)(h().I,{icon:i().arrowUTurnUpLeftIcon}),title:(0,P.jsx)(u().sA,{defaultMessage:"Restore property",id:"unsupportedPropertyMenu.restoreMenuItem.title"})})}:void 0),[r]),x=(0,n.useMemo)((()=>(0,c().O9)(t)?{action:t,key:"delete-property-menu-item",render:e=>(0,P.jsx)(m().A,{...e,icon:(0,P.jsx)(h().I,{icon:s().trashIcon}),title:"action"===a?(0,P.jsx)(u().sA,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,P.jsx)(u().sA,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})}:void 0),[t,a]);return(0,P.jsx)(g().A,{...p,children:(0,P.jsx)(y().Ay,{initialFocus:0,sections:[{key:"actions-section",items:[d,v,x].filter(c().O9),render:e=>(0,P.jsx)(f().A,{...e})}],type:y().Oh.Vertical})})}},542339:(e,t,o)=>{o.d(t,{S:()=>Ye,A:()=>qe});var n=o(296540),r=()=>o(847249),a=()=>o(534177),i=()=>o(404412),l=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),o(908872),o.n(o(844751))),s=()=>o(484714),u=()=>o(401497),c=()=>o(890409),p=()=>o(556927),d=()=>o(340498),m=()=>o(199378),g=()=>o(411387),y=()=>o(959013),h=()=>o(496603),f=()=>o(813297),v=()=>o(760217),x=()=>o(928600),S=()=>o(939740),b=()=>o(460292),C=()=>o(147294),A=()=>o(89924),k=()=>o(859428),M=()=>o(989423),j=()=>o(594794),T=()=>o(972435),I=()=>o(47170),P=()=>o(645873);function w(){const e=(0,s().v3)();return(0,n.useMemo)((()=>(0,M().ik)(e)),[e])}var _=()=>o(962730),V=()=>o(351360),R=()=>o(991249),B=()=>o(577437),E=()=>o(324587),F=()=>o(546461),N=()=>o(5269),O=()=>o(366360),D=()=>o(781697),W=()=>o(383574),L=(o(430670),()=>o(422540)),K=()=>o(419357),H=()=>o(682146),z=()=>o(508496),U=o(474848);function Y(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,r=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),i=o.getFormat(),s=o.getSchema(),u=(0,L().m7)({collectionFormat:i,collectionSchema:s,filter:e=>{let[t]=e;return!r.has(t)},spaceId:o.getSpaceId(),restrictCrossSpace:z().default.checkGate({gateName:"collections_xws"})}),c=new Map,p=u.map((e=>{const t=s[e];if(t){const o=`${t.name} ${H().dC[t.type]}`;return c.set(e,o),o}})).filter(a().O9),d=new Set(l().filter(n,p).map((e=>{let{original:t}=e;return t})));return u.filter((e=>{const t=c.get(e);return t&&d.has(t)}))}function q(e){const{onChange:t,value:o,placeholder:n,isInput:r}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,U.jsx)($,{...e,onChange:t,value:o,placeholder:n})}],key:"search",render:e=>(0,U.jsx)(A().A,{...e,isInput:r})}}const $=(0,n.forwardRef)((function(e,t){const{onChange:o,value:n,placeholder:r,...a}=e,i=(0,y().tz)(),{isMobile:l}=(0,s().Y0)();return(0,U.jsx)(K().Ay,{...a,focus:!l,inputOuterStyle:{margin:0},onChange:o,placeholder:i.formatMessage(r),ref:t,value:n})}));var G=()=>o(253809);const Q=(0,y().YK)({searchInputPlaceholder:{id:"UpdateThisPagePropertiesActionMenu.searchInputPlaceholder ",defaultMessage:"Search for a property…"},editProperty:{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}});function X(e){const{automationActionMenuStore:t,onClose:o}=e,{automationStore:a,contextType:i}=(0,F().EC)(),l=(0,N().y)(a,i),[s,u]=(0,n.useState)(""),c=(0,r().K8)((()=>l&&a?Y({automationStore:a,collectionStore:l,searchInput:s}):[]),[a,l,s]),p=(0,r().K8)((()=>null==l?void 0:l.getSchema()),[l]),d=(0,n.useMemo)((()=>{const e=[];e.push(q({onChange:e=>u(e.target.value),value:s,placeholder:Q.searchInputPlaceholder}));const o=p&&Z({automationActionMenuStore:t,propertyIds:c,normalizedBlockSchema:p,includeTitle:!1});return o&&e.push(o),e}),[t,c,p,s]),m=(0,G().r)({automationTriggerActionMenuStore:t,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:o,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:(0,U.jsx)(y().sA,{...Q.editProperty})})});return(0,U.jsx)(x().A,{...m,children:(0,U.jsx)(S().Ay,{initialFocus:0,sections:d,type:S().Oh.Vertical})})}function Z(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:r,includeTitle:i}=e,l=r.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,U.jsx)(J,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(a().O9);if(0!==l.length)return{key:"automation_update_this_page_section",items:l,render:e=>(0,U.jsx)(A().A,{...e,title:i?(0,U.jsx)(y().sA,{...Q.editProperty}):void 0,topBorder:o})}}const J=(0,n.forwardRef)((function(e,t){const{propertySchema:o,...n}=e;return(0,U.jsx)(v().A,{...n,icon:(0,U.jsx)(ee,{propertySchema:o}),ref:t,showExtensionArrow:!0,title:o.name})}));function ee(e){const{propertySchema:t}=e,n=(0,u().DP)(),r=(0,u().IS)((e=>({icon:{fill:e.icon.secondary,width:d().Ev.sm},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,U.jsx)("div",{style:r.iconWrap,children:(0,U.jsx)(o(743176).zB,{icon:t.icon,size:16,style:r.icon,theme:n,type:t.type})})}const te=(0,y().YK)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search actions…"},updateThisPagePropertiesMenuItemCaption:{defaultMessage:"Edit property…",id:"automationEventActionMenu.updateThisPagePropertiesMenuItem.caption"},upgrade:{defaultMessage:"Upgrade to Plus",id:"automationEventActionMenu.upsellFeatures.title"},disabledActionTooltipHeader:{defaultMessage:"Disabled in your workspace",id:"automationEventActionMenu.disabledActionTooltipHeader"},disabledActionTooltipBody:{defaultMessage:"Contact a workspace admin to modify this setting.",id:"automationEventActionMenu.disabledActionTooltipBody"}}),oe=["automation_actions","update_this_page_actions"],ne=["update_this_page_actions","automation_actions"];function re(e){const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:i,onClose:d}=e,{isMobile:C}=(0,s().Y0)(),k=(0,s().v3)(),_=(0,y().tz)(),L=w(),{value:K}=(0,P().fJ)(f().QV.automationActionRegistry),{automationStore:H,contextType:z}=(0,F().EC)(),{maybePersistedTransactionActions:$,onActionAdded:G}=(0,O().b)(),Q=(0,N().y)(H,z),X=(0,W().V)(),J="event"===z,ee=(0,n.useMemo)((()=>J?ne:oe),[J]),re=(0,r().K8)((()=>t.getInsertionPoint()),[t]),[ie,le]=n.useState(""),se=(0,r().K8)((()=>o?function(e){const{automationActionRegistryModule:t,availableActions:o,searchInput:n}=e;if(!t||0===o.length)return[];const r=new Map,a=o.map((e=>{const t=T().A.formatMessage(e.display.name);return r.set(e.type,t),t})),i=new Set(l().filter(n,a).map((e=>{let{original:t}=e;return t})));return o.filter((e=>{const t=r.get(e.type);return t&&i.has(t)}))}({automationActionRegistryModule:K,availableActions:X,searchInput:ie}):X),[X,o,ie,K]),ue=(0,r().K8)((()=>H.getActionStores().map((e=>e.getType())).filter(a().O9)),[H]),pe=(0,n.useCallback)((e=>{if(!H)return;const t=H.getSpaceId(),{performResult:o}=$.createAndCommit({userAction:"AutomationActionList.addAction",perform:o=>E().addAutomationAction({actionId:(0,j().Z1)({environment:k,table:m().SC,spaceId:t}),actionType:e,automationStore:H,environment:k,insertionPoint:re,intl:_,transaction:o,builderType:"modal"})});o&&((0,c().c_)(L,{automation_id:H.id,automation_action_id:o.id,automation_action_type:e,builder_type:"modal"}),null==G||G(o)),d()}),[H,$,d,k,re,_,L,G]),de=(0,r().K8)((()=>i&&Q&&H?Y({automationStore:H,collectionStore:Q,searchInput:ie}):[]),[H,Q,i,ie]),me=(0,r().K8)((()=>Boolean(i&&Q&&H&&Y({automationStore:H,collectionStore:Q,searchInput:""}).length>0)),[H,Q,i]),ge=(0,r().K8)((()=>null==Q?void 0:Q.getSchema()),[Q]),ye=(0,I().O)(),he=(0,r().K8)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),fe=(0,B()._X)({name:"premium_automations",spaceId:ye,userId:null==he?void 0:he.id}),ve=function(e){let{onClose:t,upsell:o}=e;const r=(0,s().v3)();return(0,n.useCallback)((()=>{t(),o&&R().K(r,{from:"database_automation_modal_action_item",upsell:o})}),[r,t,o])}({onClose:d,upsell:null==fe?void 0:fe.upsell}),xe=(0,g().e2)(fe),Se=(0,u().IS)((e=>({unavailableHeader:{display:"inline-flex",minWidth:0,whiteSpace:"pre",cursor:"pointer",color:e.text.secondary},unavailableLinkIcon:{fill:e.icon.secondary}})),[]),be=(0,r().K8)((()=>{const e=[],n="button_block"===z||"button_property"===z,r=!n&&!xe,i=n&&!xe;o&&!r&&e.push(q({onChange:e=>le(e.target.value),value:ie,placeholder:te.searchInputPlaceholder,isInput:!0}));const l=ee.reduce(((e,o)=>{if("automation_actions"===o)if(r||i){const[o,n]=h().jB(se,(e=>r?"slack_notification"===e.type:i?"send_gmail_notification"!==e.type&&"http_request"!==e.type:void 0)),l=ae({key:"automation_actions_available_section",actionRegistryItems:o,hasTopBorder:e.length>0,onMenuItemClick:pe,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"button_property"===z}),s=ae({key:"automation_actions_unavailable_section",actionRegistryItems:n,hasTopBorder:(0,a().O9)(l),hideChevron:!0,onMenuItemClick:ve,onClick:ve,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:"event"===z,title:(0,U.jsxs)("div",{style:Se.unavailableHeader,onClick:ve,children:[(0,U.jsx)(y().sA,{...te.upgrade}),(0,U.jsx)(b().Q,{iconGroup:p().j,variantName:"small",style:Se.unavailableLinkIcon})]})});l&&e.push(l),s&&e.push(s)}else{const o=ae({actionRegistryItems:se,hasTopBorder:e.length>0,onMenuItemClick:pe,automationActionMenuStore:t,shouldShowUpdateThisPageProperties:me&&"button_block"!==z&&(!ie||ce(ie))});o&&e.push(o)}else if("update_this_page_actions"===o){const o=ge&&(xe||!J)&&ie.length>0&&Z({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:ge,propertyIds:de,includeTitle:!0});o&&e.push(o)}else(0,a().HB)(o);return e}),[]);return 0===l.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,U.jsx)(v().A,{...e,disabled:!0,disabledFeedback:!0,title:(0,U.jsx)(y().sA,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,U.jsx)(A().A,{...e})}):e.push(...l),e}),[t,xe,de,se,ge,z,o,me,J,pe,ve,ie,ee,Se.unavailableHeader,Se.unavailableLinkIcon]);(0,n.useEffect)((()=>{(0,M().u4)({environment:k,event:{eventName:"automation_action_menu_opened",eventProperties:{automation_id:H.id,automation_context_type:z,existing_action_types:ue,available_action_types:X.map((e=>e.type))}}})}),[X,z,ue,H,k]);let Ce=(0,D().e)({width:266});return C||(Ce={...Ce,maxHeight:"50vh"}),(0,U.jsx)(x().A,{...Ce,children:(0,U.jsx)(S().Ay,{initialFocus:0,sections:be,type:S().Oh.Vertical})})}function ae(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n,onClick:r,automationActionMenuStore:i,shouldShowUpdateThisPageProperties:l,key:s,title:u,hideChevron:c}=e,p=h().oE([l?se({hideChevron:c,onClick:()=>{(0,a().O9)(r)?r():i.pushSettingsItem({type:"updateThisPageProperties"})}}):void 0,...t.map((e=>function(e){const{actionRegistryItem:t,onClick:o}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,U.jsx)(ie,{...e,actionRegistryItem:t})}}({actionRegistryItem:e,onClick:n})))]);if(0!==p.length)return{key:s||"automation_actions_section",items:p,render:e=>(0,U.jsx)(A().A,{...e,topBorder:o,title:u})}}const ie=(0,n.forwardRef)((function(e,t){const{actionRegistryItem:i,...l}=e,s=i.display,{automationStore:c,contextType:p}=(0,F().EC)(),d=(0,r().K8)((()=>(0,o(157857).Z6)(c,p)),[c,p]),m=(0,I().O)(),g=(0,r().K8)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),h=(0,B().P9)({name:"premium_automations",spaceId:m,userId:null==g?void 0:g.id}),f=(0,n.useMemo)((()=>{if(h)return!1;return"button_block"===p||"button_property"===p?"send_gmail_notification"===i.type||"http_request"===i.type:"slack_notification"!==i.type}),[i.type,p,h]),x=(0,r().K8)((()=>!!((0,a().O9)(i)&&(0,a().O9)(d)&&(0,a().O9)(i.isDisabledForContext))&&i.isDisabledForContext(d)),[i,d]),S=(0,u().IS)((e=>({row:{display:"grid",gridTemplateColumns:"auto auto auto",justifyContent:"flex-start",...(f||x)&&{color:e.text.tertiary,cursor:"default"}},badge:{...(f||x)&&{color:e.text.tertiary,backgroundColor:e.accentColors.translucentGray[75]}},tooltipHeader:{width:200},tooltipBody:{color:e.text.secondary}})),[x,f]),b=(0,n.useMemo)((()=>{switch(i.type){case"send_gmail_notification":return(0,U.jsx)(o(515918).A,{style:S.badge});case"http_request":return(0,U.jsx)(C().E,{newBadgeKey:"http_request_automation_action",didUserEngage:!1,keyType:"date",style:S.badge});case"define_variables":return(0,U.jsx)(C().E,{newBadgeKey:"define_variables_automation_action",didUserEngage:!1,keyType:"date",style:S.badge});default:return}}),[i.type,S.badge]);return s?(0,U.jsx)(k().A,{textWrap:!0,placement:_().W.Right,alignment:_().C.End,disableTooltip:!x,renderTooltip:()=>(0,U.jsxs)("div",{style:S.tooltipHeader,children:[(0,U.jsx)("div",{children:(0,U.jsx)(y().sA,{...te.disabledActionTooltipHeader})}),(0,U.jsx)("div",{style:S.tooltipBody,children:(0,U.jsx)(y().sA,{...te.disabledActionTooltipBody})})]}),render:e=>(0,U.jsx)(v().A,{...l,...e,disabled:x,icon:(0,U.jsx)(le,{type:"actionRegistry",actionRegistryItem:i,disabled:x||f}),ref:t,right:b,title:(0,U.jsx)(y().sA,{...s.name}),style:S.row})}):null}));function le(e){const t="actionRegistry"===e.type&&"send_gmail_notification"===e.actionRegistryItem.type,o=(0,u().IS)((o=>({icon:{fill:e.disabled?o.text.tertiary:o.icon.secondary,height:"auto",width:d().Ev.default,opacity:t&&e.disabled?.4:1},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[t,e.disabled]);return(0,U.jsx)("div",{style:o.iconWrap,children:"actionRegistry"===e.type?e.actionRegistryItem.display.icon(o.icon):"icon"===e.type?e.icon(o.icon):(0,a().HB)(e)})}function se(e){const{onClick:t,hideChevron:o}=e;return{action:()=>t(),key:"update_this_page_properties",render:e=>(0,U.jsx)(ue,{...e,hideChevron:o})}}const ue=(0,n.forwardRef)((function(e,t){const{hideChevron:n}=e,{contextType:a}=(0,F().EC)(),i=(0,I().O)(),l=(0,r().K8)((()=>{var e;return null===(e=V().default.state.currentUserStore)||void 0===e?void 0:e.getModel()}),[]),s=(0,B().P9)({name:"premium_automations",spaceId:i,userId:null==l?void 0:l.id}),c=(0,u().IS)((e=>({row:{...!s&&"event"===a&&{color:e.text.tertiary}}})),[a,s]);return(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)(le,{type:"icon",icon:o(735790).M}),ref:t,showExtensionArrow:!n,title:(0,U.jsx)(y().sA,{...te.updateThisPagePropertiesMenuItemCaption}),style:c.row})}));function ce(e){const t=T().A.formatMessage(te.updateThisPagePropertiesMenuItemCaption);return l().test(e,t)}o(672577);var pe=()=>o(352271),de=()=>o(79118),me=()=>o(410486),ge=()=>o(970013),ye=()=>o(791089),he=()=>o(919709),fe=()=>o(284371),ve=()=>o(246826),xe=()=>o(413194),Se=()=>o(133518);const be=(0,y().YK)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"},menuHeaderEditTitle:{defaultMessage:"Edit {propertyName}",id:"automations.eventActionProperty.menuHeaderEditTitle"}});function Ce(e){var t;const{actionId:o,automationActionMenuStore:i,onClose:l,propertyId:u}=e,{automationStore:p,contextType:d}=(0,F().EC)(),g=(0,N().y)(p,d),{maybePersistedTransactionActions:h,onActionAdded:f}=(0,O().b)(),v=(0,y().tz)(),x=(0,s().v3)(),S=w(),b=(0,r().K8)((()=>i.getInsertionPoint()),[i]),C=(0,n.useMemo)((()=>g?{collectionStore:g,property:u,type:"collection"}:void 0),[g,u]),A=(0,r().K8)((()=>p.getSpaceId()),[p]),M=o??(0,j().Z1)({environment:x,table:m().SC,spaceId:A}),T=(0,r().K8)((()=>{const e=((null==p?void 0:p.getActionStores())??[]).find((e=>e.id===M));if(e&&e.isType("update_pages"))return e}),[p,M]),I=(0,r().K8)((()=>null==g?void 0:g.getSchema()[u]),[g,u]),P=(0,n.useMemo)((()=>{if(I&&(0,L().I3)(I))return L().Yy[I.type]}),[I]),V=(0,n.useMemo)((()=>!!I&&("multi_select"===I.type||(0,ge().sO)(I)&&1!==I.limit)),[I]),R=Boolean(I&&"button"!==I.type&&"rollup"!==I.type&&"formula"!==I.type&&"text"===(0,me().IS)(I.type)),B=Boolean(I&&"button"!==I.type&&"rollup"!==I.type&&"formula"!==I.type&&"number"===(0,me().IS)(I.type)),D=Boolean(I&&"date"===I.type),W=Boolean(I&&"status"===I.type),K=(0,r().K8)((()=>{if(g&&I)return(0,ye().setPropertyValueToSimpleFormulaReturnType)(g.getSpaceShardedPointer(),u,I)}),[g,I,u]),H=(0,r().K8)((()=>{if(T)return T.getConfigStore().getKeyStore("values").getKeyStore(u).getValue()}),[T,u]),[z,Y]=(0,n.useState)(H),q=(0,n.useRef)({action:(null==H?void 0:H.action)||pe().yP,value:null==H?void 0:H.value}),$=(0,n.useMemo)((()=>{var e;return(0,ye().fromSimpleFormulaArrayValue)(null==z||null===(e=z.value)||void 0===e?void 0:e.value)}),[null==z||null===(t=z.value)||void 0===t?void 0:t.value]),Q=(0,Se().F)({actionId:null==T?void 0:T.id}),X=(0,n.useCallback)((e=>{let{action:t,value:o}=e;if(!p)return;const{performResult:n}=h.createAndCommit({perform:e=>{if(!T)return E().addAutomationAction({actionId:M,actionType:"update_pages",automationStore:p,config:{properties:[u],target:{id:(0,de().KI)(),type:"variable"},values:{[u]:{action:t,value:o}}},environment:x,intl:v,insertionPoint:b,transaction:e,builderType:"modal"});ve().zv({data:{[u]:{action:t,value:o}},store:T.getConfigStore().getKeyStore("values"),transaction:e})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});n&&((0,c().c_)(S,{automation_id:p.id,automation_action_id:n.id,automation_action_type:"update_pages"}),null==f||f(n))}),[T,p,x,S,M,b,v,h,f,u]),Z=(0,n.useCallback)((()=>{X(q.current),l()}),[X,l]),J=(0,n.useCallback)(((e,t)=>{const o=t||pe().yP,n=q.current.value;q.current={value:e,action:o};if("formula"===(null==e?void 0:e.type))return void Y({action:o,value:e});if("formula"===(null==n?void 0:n.type))Y({action:o,value:e});else if(R||B||V||(0,a().O9)(t))Y({action:o,value:e});else if(D){const t=(0,ye().fromSimpleFormulaArrayValue)(null==e?void 0:e.value)[0];if((0,a().O9)(t)&&(0,ye().isAnnotationSimpleValueToken)(t)&&(0,he().qsB)(t))return void Y({action:o,value:e});Z()}}),[D,R,B,V,Z]),ee="person"===(null==I?void 0:I.type)||"relation"===(null==I?void 0:I.type)||"multi_select"===(null==I?void 0:I.type),te=ee?be.menuHeaderEditTitle:be.menuHeaderTitle,oe=(0,G().r)({automationTriggerActionMenuStore:i,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:Z,onDone:V||R||B||ee?Z:void 0,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:v.formatMessage(te,{propertyName:(0,U.jsx)(k().A,{placement:_().W.Bottom,render:e=>(0,U.jsx)("div",{...e,style:{...fe().RC},children:(null==I?void 0:I.name)??""}),renderTooltip:()=>(null==I?void 0:I.name)??""})})})});return I&&K&&C?(0,U.jsx)(xe().L,{allowedFormulaReturnTypes:P,formulaValueContext:C,currentSimpleFormulaValueTokens:$,formulaTypecheckContextValues:Q,menuProps:oe,onChange:J,onClose:Z,parentRecordStore:p,showClearButton:!W,type:K,value:null==z?void 0:z.value,action:(0,pe().tz)(z),showReplaceAddRemoveToggle:ee}):null}var Ae=()=>o(148307),ke=()=>o(617871),Me=()=>o(402904),je=()=>o(973647),Te=()=>o(510683),Ie=()=>o(493823),Pe=()=>o(204063),we=()=>o(881707),_e=()=>o(53137),Ve=()=>o(630116);function Re(e){const{type:t,automationActionMenuStore:o,onClose:n}=e,a=Oe(),i=(0,I().O)(),l=(0,r().K8)((()=>V().default.state.currentUserStore),[]),s="connectToSlackReconnect"===t?e.externalBotId:void 0,u=(0,r().K8)((()=>{if(void 0!==s&&l)return(0,Ve().Oo)(l,{table:Me().As,id:s,spaceId:i}).getValue()}),[s,l,i]);let c,p=Ne({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!u)return null;const{accountName:e,organizationName:t}=(0,we().qO)(u);c=(0,we().Dy)(u),p=Ne({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,U.jsx)(G().A,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,U.jsx)(A().A,{children:(0,U.jsxs)("div",{style:a.container,children:[(0,U.jsx)(Ee,{}),(0,U.jsxs)("div",{style:a.connectToSlackBody,children:[(0,U.jsx)("div",{style:a.connectToSlackTitleText,children:Fe(t)}),(0,U.jsx)("div",{style:a.connectToSlackDescriptionText,children:p})]}),(0,U.jsx)(Be,{...e,slackWorkspaceId:c})]})})})}function Be(e){const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,s().v3)(),i=Oe(),l=(0,I().O)(),u=(0,r().K8)((()=>_e().A.integrations.state.find((e=>e.id===ke().zG))),[]);return u&&l?(0,U.jsxs)("div",{style:i.buttonGroup,children:[(0,U.jsx)(Pe().A,{style:i.connectToSlackButton,size:"lg",onClick:async()=>{const r=await Te().Jq({environment:n,integration:u,spaceId:l,from:"collection_view_settings",options:{slackWorkspaceId:o}});je().Q.isFail(r)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?r.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:r.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,a().HB)(e))},children:(0,U.jsx)(y().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,U.jsx)(Ie().p,{style:i.cancelButton,size:"lg",onClick:()=>{t.popSettingsItem()},children:(0,U.jsx)(y().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function Ee(){const e=Oe();return(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:Ae().A.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function Fe(e){return"connectToSlackDefault"===e?(0,U.jsx)(y().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,U.jsx)(y().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,a().HB)(e)}function Ne(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,U.jsx)(y().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,U.jsx)(y().sA,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,a().O9)(e.organizationName),organizationName:e.organizationName}}):void(0,a().HB)(t)}function Oe(){return(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:fe().Wy.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.text.secondary},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.text.secondary,width:"100%",justifyContent:"center",fontWeight:fe().Wy.medium,fontSize:13,marginTop:8}})),[])}var De=()=>o(628864);function We(e){const{actionStore:t,automationActionMenuStore:o,onClose:r}=e,{maybePersistedTransactionActions:i}=(0,O().b)(),l=n.useCallback(((e,o)=>{t&&i.createAndCommit({perform:n=>{var r;ve().zv({data:{config:{external_bot_id:o,target:{id:e.id,name:"",type:e.type},custom_message:null===(r=t.getConfig())||void 0===r?void 0:r.custom_message}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),r()}),[t,i,r]),s=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]),u="selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,a().HB)(e),c=(0,n.useMemo)((()=>u?[u]:void 0),[u]);return(0,U.jsx)(De().pj,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannels:c,onClose:r,onNotificationChannelSelect:l,onNewSlackAccountAdded:s,renderMenu:e=>(0,U.jsx)(G().A,{type:"default",automationTriggerActionMenuStore:o,headerTitle:(0,U.jsx)(y().sA,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:r})})}var Le=()=>o(742117),Ke=()=>o(381138);const He=(0,y().YK)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function ze(e){const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:a,onNewSlackAccountAdded:i}=e,l=(0,s().v3)(),{isMobile:c}=(0,s().Y0)(),p=(0,I().O)(),d=(0,r().K8)((()=>(0,we().l$)(_e().A.completeSlackAuthentications.state,a)),[a]),m=(0,r().K8)((()=>_e().A.integrations.state.find((e=>e.id===ke().zG))),[]),[g,h]=n.useState(""),f=(0,u().IS)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!m)return null;const x=Object.entries((0,we().Os)(d,g)).map(((e,o)=>{let[n,r]=e;return{key:n,items:r.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,U.jsx)(v().A,{...e,title:o??(0,U.jsx)(y().sA,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,Le().V)(f.chevronRight)})}})),render:e=>(0,U.jsx)(A().A,{...e,title:n,topBorder:0!==o})}}));return x.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,U.jsx)("div",{children:(0,U.jsx)(K().Ay,{...e,inputLeft:(0,U.jsx)(K().Zf,{icon:Ke().q}),showClearButton:!0,placeholder:T().A.formatMessage(He.workspaceSearchPlaceholder),focus:!c||void 0,value:g,onChange:e=>{h(e.target.value)}})})}],render:e=>(0,U.jsx)(A().A,{...e})}),x.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!p)return;const e=await Te().Jq({environment:l,integration:m,spaceId:p,from:"collection_view_settings"});je().Q.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==i||i())},render:e=>(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)("img",{src:Ae().A.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,U.jsx)(y().sA,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,U.jsx)(A().A,{...e,topBorder:!0})}),(0,U.jsx)(U.Fragment,{children:o(x)})}function Ue(e){const{automationActionMenuStore:t,onClose:o}=e,r=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,U.jsx)(ze,{onWorkspaceSelect:r,renderMenu:e=>(0,U.jsx)(G().A,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,U.jsx)(y().sA,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}const Ye=(0,n.createContext)({menuStore:void 0});function qe(e){const{initialState:t,insertionPoint:o,onClose:l}=e,s=(0,r().K8)((()=>{const e=new(i().ew);return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),u=(0,r().K8)((()=>s.getCurrentTab()),[s]),c=(0,n.useCallback)((()=>null==l?void 0:l()),[l]);if(!u)return null;let p;if("connectToSlackDefault"===u.type)p=(0,U.jsx)(Re,{actionStore:u.actionStore,automationActionMenuStore:s,onClose:c,type:"connectToSlackDefault"});else if("connectToSlackReconnect"===u.type)p=(0,U.jsx)(Re,{actionStore:u.actionStore,automationActionMenuStore:s,externalBotId:u.externalBotId,notificationActionConfigStore:u.notificationActionConfigStore,onClose:c,type:"connectToSlackReconnect"});else if("selectWorkspace"===u.type)p=(0,U.jsx)(Ye.Provider,{value:{menuStore:s},children:(0,U.jsx)(Ue,{actionStore:u.actionStore,automationActionMenuStore:s,onClose:c})});else if("selectChannelNew"===u.type)p=(0,U.jsx)(We,{actionStore:u.actionStore,automationActionMenuStore:s,currentExternalAuthentication:u.currentExternalAuthentication,onClose:c,type:"selectChannelNew"});else if("selectChannelUpdate"===u.type)p=(0,U.jsx)(We,{actionStore:u.actionStore,automationActionMenuStore:s,currentExternalAuthentication:u.currentExternalAuthentication,currentNotificationChannel:u.currentNotificationChannel,onClose:c,type:"selectChannelUpdate"});else if("eventActions"===u.type)p=(0,U.jsx)(re,{automationActionMenuStore:s,hasUpdateThisPagePropertyActions:u.hasUpdateThisPagePropertyActions,hasSearch:u.hasSearch,onClose:c});else if("eventActionProperty"===u.type){const{propertyId:e,actionId:t}=u;p=(0,U.jsx)(Ce,{actionId:t,automationActionMenuStore:s,onClose:c,propertyId:e})}else"updateThisPageProperties"===u.type?p=(0,U.jsx)(X,{automationActionMenuStore:s,onClose:c}):(0,a().HB)(u);return(0,U.jsx)(Ye.Provider,{value:{menuStore:s},children:p})}Ye.displayName="AutomationActionMenuContext"},548526:(e,t,o)=>{o.d(t,{x:()=>u});var n=o(296540),r=()=>o(324254),a=()=>o(340498),i=()=>o(284371),l=o(474848);const s={height:"auto",maxWidth:"auto",paddingInline:4},u=(0,n.forwardRef)((function(e,t){const{children:u,disabled:p,hasActionRequired:d,errorIcon:m,icon:g,isCompact:y,isError:h,isSecondary:f,onClick:v,style:x,tooltipMessage:S,dropdownButtonType:b,dropdownIcon:C}=e,A=(0,o(484714).v3)(),k="dropdown"===b,M=(0,o(401497).IS)((e=>({button:{...c(e,{isError:h,hasActionRequired:d,isSecondary:f,dropdownButtonType:b}),gap:2,padding:"0 6px",...y?s:void 0,...k&&{alignItems:"center",height:20,paddingBlock:0,marginBlock:0},...x},children:{...i().RC,lineHeight:"20px",flex:"1 1 auto",display:"grid",gridTemplateColumns:"auto auto",gap:2,...k&&{padding:"0 2px"}},icon:{width:a().Ev.sm,height:a().Ev.sm,marginRight:2,...h?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,width:a().Ev.sm,height:a().Ev.sm,flex:"0 0 auto",marginRight:2},chevronIcon:{fill:e.icon.secondary,flex:"0 0 auto",height:a().Ev.sm,width:a().Ev.sm,...k&&{fill:"unset"}}})),[h,d,f,b,y,k,x]),j=(0,n.useMemo)((()=>g?()=>g(M.icon):void 0),[g,M.icon]),T=(0,n.useCallback)((()=>S??null),[S]),I=(0,n.useCallback)((e=>{o(725614).clear({environment:A}),o(778417).IU({environment:A}),null==v||v(e),e.stopPropagation()}),[A,v]),P=m||o(158661).exclamationMarkTriangleFillSmallIcon,w=h?()=>P(M.warningIcon):j;return(0,l.jsx)(o(859428).A,{delayThreshold:0,disableTooltip:!Boolean(S),placement:o(962730).W.Bottom,render:e=>"dropdown"===b?(0,l.jsxs)(o(890824).A,{...e,variant:h?"secondary":"lightGray",disabled:p,disabledFeedback:p,onClick:I,ref:t,style:M.button,children:[w&&w(),(0,l.jsx)("div",{style:M.children,children:u}),C?C(M.chevronIcon):(0,r().arrowChevronSingleDownSmallIcon)(M.chevronIcon)]}):(0,l.jsxs)(o(493823).p,{...e,icon:h?w:j,disabled:p,disabledFeedback:p,onClick:I,ref:t,shouldShrink:!0,style:M.button,isRed:h,children:[(0,l.jsx)("div",{style:M.children,children:u}),(0,r().arrowChevronSingleDownSmallIcon)(M.chevronIcon)]}),renderTooltip:T})}));function c(e,t){const{isError:o,hasActionRequired:n,isSecondary:r,dropdownButtonType:a}=t;return o?{color:e.errorText,..."dropdown"===a&&{boxShadow:"none"}}:n?{fontWeight:i().Wy.regular,color:e.text.secondary}:r?{color:e.text.secondary}:{fontWeight:i().Wy.regular,color:e.text.primary}}},555005:(e,t,o)=>{o.d(t,{A:()=>Ke});var n=o(296540),r=()=>o(847249),a=()=>o(534177),i=()=>o(404412),l=(o(898992),o(354520),o(672577),o(581454),o(737550),o.n(o(844751))),s=()=>o(484714),u=()=>o(401497),c=()=>o(422540),p=()=>o(970013),d=()=>o(743176),m=o(474848);const g={viewBox:"0 0 20 20",svg:(0,m.jsx)("path",{d:"m10.775 2.583 2.475 2.475a.625.625 0 0 1 0 .884l-2.475 2.475a.625.625 0 1 1-.884-.884l1.408-1.408H4.8c-.649 0-1.175.526-1.175 1.175v5.975a.625.625 0 1 1-1.25 0V7.3A2.425 2.425 0 0 1 4.8 4.875h6.499L9.891 3.467a.625.625 0 0 1 .884-.884M17 6.1c.345 0 .625.28.625.625V12.7a2.425 2.425 0 0 1-2.425 2.425H8.7l1.408 1.408a.625.625 0 1 1-.884.884L6.75 14.942a.625.625 0 0 1 0-.884l2.475-2.475a.625.625 0 1 1 .884.884l-1.408 1.408H15.2c.649 0 1.175-.526 1.175-1.175V6.725c0-.345.28-.625.625-.625"})},y=(0,o(340498).wt)("arrowSquareLeftRight",g);var h=()=>o(274570),f=()=>o(105819),v=()=>o(617668),x=()=>o(959013),S=()=>o(496603),b=()=>o(901389),C=()=>o(301948),A=()=>o(760217),k=()=>o(419357),M=()=>o(928600),j=()=>o(939740),T=()=>o(8980),I=()=>o(89924),P=()=>o(662971),w=()=>o(42425),_=()=>o(726483),V=()=>o(722872),R=()=>o(963589),B=()=>o(991249),E=()=>o(527871),F=()=>o(366360),N=()=>o(781697),O=()=>o(813716);const D=(0,x().YK)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search triggers…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property edited"},recurrenceCopy:{id:"automationEventTriggerMenu.recurrence.title",defaultMessage:"Every…"}});function W(e){const{automationTriggerMenuStore:t,onClose:o}=e,{automationStore:i,collectionStore:g}=(0,F().k)(),y=(0,u().DP)(),h=(0,x().tz)(),C=(0,O().p)(),P=(0,R().X)("collections_xws"),w=(0,n.useMemo)((()=>({...C,closeMenu:o})),[C,o]),[V,B]=n.useState(""),E=(0,r().K8)((()=>g.getSpaceId()),[g]),W=(0,r().K8)((()=>g.getSchema()),[g]),K=(0,r().K8)((()=>i.getTrigger()),[i]),U=(0,r().K8)((()=>"event"===(null==K?void 0:K.type)&&K.event.pagesAdded),[K]),Y=(0,r().K8)((()=>{if(P)return e=>{const t=e[1];return!(0,p().nC)(t)||!(0,p().o2)(E,t)}}),[P,E]),q=(0,r().K8)((()=>(0,c().nv)({collectionFormat:g.getFormat(),collectionSchema:W,filter:Y})),[g,W,Y]),$=(0,_().iX)({collectionSchema:W,propertyIds:q,searchTerm:V}),G=(0,r().K8)((()=>"event"===(null==K?void 0:K.type)&&(U||"none"!==K.event.pagePropertiesEdited.type)),[K,U]),Q=(0,u().IS)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),X=(0,N().e)({maxHeight:"50vh",width:266}),Z=(0,s().v3)(),{isMobile:J}=(0,s().Y0)(),ee=(0,m.jsx)(I().A,{isInput:!0,children:(0,m.jsx)(k().Ay,{focus:!J,value:V,onChange:e=>{B(e.target.value)},placeholder:h.formatMessage(D.searchInputPlaceholder)})}),te=(0,r().K8)((()=>function(e){const{environment:t,intl:o,searchInput:n,actions:r,hasPageAddedTrigger:a,hasAnyEventConditions:i,automationStore:s}=e,u=s.getTrigger(),c=o.formatMessage(D.pageAddedCopy),p=o.formatMessage(D.recurrenceCopy),d=o.formatMessage(D.pagePropertiesEditedCopy),{hasAnyPageEditedTrigger:g,specificPropertyChangedFilters:y}=H(u),h=S().oE([g||!l().test(n,d)?void 0:{key:"any_property_edited",action:async()=>{const e=await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await b().Gh({message:(0,m.jsx)(x().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,m.jsx)(x().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,m.jsx)(x().sA,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})}).then((e=>e.accept))}({hasSpecificPropertyChangedFilters:y.length>0});e&&(r.addAnyPropertyEditedTrigger(),r.closeMenu())},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(T().I,{icon:f().pencilLineIcon,color:"secondary"}),title:d})},!a&&l().test(n,c)?{key:"page_added",action(){r.addPageAddedTrigger(),r.closeMenu()},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(T().I,{icon:v().plusIcon,color:"secondary"}),title:c})}:void 0,!i&&l().test(n,p)?L({actions:r,environment:t,automationStore:s}):void 0]);return h.length>0?{key:"event_section",items:h,render:e=>(0,m.jsx)(I().A,{...e,title:(0,m.jsx)(x().sA,{id:"automationEventTriggerMenu.eventSection.title",defaultMessage:"Event"})})}:void 0}({environment:Z,intl:h,searchInput:V,actions:w,styles:Q,hasPageAddedTrigger:U,hasAnyEventConditions:G,automationStore:i})),[U,G,h,w,V,Q,Z,i]),oe=(0,R().X)("automation_relative_date_trigger"),ne=(0,r().K8)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:r,collectionSchema:i,theme:l,actions:s,isRelativeDateTriggerEnabled:u}=e,{specificPropertyChangedFilters:p}=H(t),g=r.map((e=>{if(!p.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:r,actions:a,isRelativeDateTriggerEnabled:i}=e,l=n[o];if(!l)return;const s=(0,c().nq)(l),u=i&&"date"===l.type;return{key:o,action:()=>{u||(s?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(a.addPropertyTrigger({property:o,filter:{operator:"changes_to_any"}}),a.closeMenu()))},render:(e,t)=>u?(0,m.jsx)(z,{menuListItemProps:e,propertySchema:l,propertyId:o,actions:a,parent:t}):(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(d().zB,{icon:l.icon,type:l.type,size:16,theme:r,style:{overflow:"visible"}}),title:l.name,showExtensionArrow:s})}}({propertyId:e,collectionSchema:i,theme:l,automationTriggerMenuStore:o,actions:s,isRelativeDateTriggerEnabled:u})})).filter(a().O9);if(0===g.length)return;return{key:"property_section",items:g,render:e=>(0,m.jsx)(I().A,{...e,topBorder:n,title:(0,m.jsx)(x().sA,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property"})})}}({automationTriggerValue:K,automationTriggerMenuStore:t,showTopBorder:Boolean(te),properties:$,collectionSchema:W,theme:y,actions:w,isRelativeDateTriggerEnabled:oe})),[K,t,te,$,W,y,w,oe]),re=n.useMemo((()=>{const e=[te,ne].filter(a().O9);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,m.jsx)(A().A,{...e,disabled:!0,disabledFeedback:!0,title:(0,m.jsx)(x().sA,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,m.jsx)(I().A,{...e})}]:e}),[te,ne]);return(0,m.jsx)(M().A,{...X,header:ee,children:(0,m.jsx)(j().Ay,{type:j().Oh.Vertical,sections:re,initialFocus:0})})}function L(e){const{actions:t,environment:o,automationStore:n}=e,r=(0,E().V)({environment:o,automationStore:n,triggerType:"recurrence"});return{key:"recurrence",action(){r?t.addEmptyRecurrenceTrigger():B().K(o,{upsell:{type:"product",product:"plus",limit:{type:"none"},trialability:"none"},from:"recurrence_automation"}),t.closeMenu()},render:e=>(0,m.jsx)(K,{...e,automationStore:n})}}const K=n.forwardRef((function(e,t){var n;const{automationStore:a,...i}=e,l=(0,u().IS)((()=>({wrap:{display:"flex",alignItems:"center"},upsellWrap:{marginLeft:6}})),[]),c=(0,s().v3)(),p=(0,r().K8)((()=>(0,E().V)({triggerType:"recurrence",automationStore:a,environment:c})),[a,c]),{spaceId:d,userId:g}=(0,r().K8)((()=>{var e;return{spaceId:a.getSpaceId(),userId:null===(e=o(351360).default.state.currentUserStore)||void 0===e?void 0:e.id}}),[a]),h=null===(n=(0,o(577437)._X)({name:"premium_automations",spaceId:d,userId:g}))||void 0===n?void 0:n.upsell;return(0,m.jsx)(A().A,{...i,ref:t,icon:(0,m.jsx)(T().I,{icon:y,color:"secondary"}),title:(0,m.jsxs)("div",{style:l.wrap,children:[(0,m.jsx)(x().sA,{...D.recurrenceCopy}),p?(0,m.jsx)(o(147294).E,{newBadgeKey:"generalized_recurrence_automations",didUserEngage:!1,keyType:"date"}):h?(0,m.jsx)("div",{style:l.upsellWrap,children:(0,m.jsx)(o(112698).B,{upsell:h,analyticsName:"recurrence_automation"})}):null]})})}));function H(e){let t=!1,o=[];return"event"===(null==e?void 0:e.type)&&(t="any"===e.event.pagePropertiesEdited.type,t||("some"===e.event.pagePropertiesEdited.type?o=e.event.pagePropertiesEdited.some||[]:"all"===e.event.pagePropertiesEdited.type&&(o=e.event.pagePropertiesEdited.all||[]))),{hasAnyPageEditedTrigger:t,specificPropertyChangedFilters:o}}function z(e){const{propertyId:t,propertySchema:o,menuListItemProps:n,actions:r,parent:a}=e,i=(0,u().DP)();return(0,m.jsx)(P().A,{...n,onFocus:a.onFocus,alignmentToOrigin:w().C1.Start,renderOrigin:(e,t)=>(0,m.jsx)(A().A,{...e,ref:t,icon:(0,m.jsx)(d().zB,{icon:o.icon,type:o.type,size:16,theme:i,style:{overflow:"visible"}}),title:o.name}),renderExtension:(e,o)=>(0,m.jsx)(M().A,{...e,menuType:V().gu.Popup,children:(0,m.jsx)(j().Ay,{initialFocus:0,type:j().Oh.Vertical,sections:[{key:"section",render:e=>(0,m.jsx)(I().A,{...e}),items:[{key:"occurs",action:()=>{r.addRelativeDateTrigger({propertyId:t}),r.closeMenu()},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(T().I,{icon:h().clockIcon,color:"secondary"}),title:(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:["Occurs"," ",(0,m.jsx)(C().A,{})]})})},{key:"is_edited",action:()=>{r.addPropertyTrigger({property:t,filter:{operator:"changes_to_any"}}),r.closeMenu()},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(T().I,{icon:f().pencilLineIcon,color:"secondary"}),title:"Is edited"})}]}]})})})}var U=()=>o(289915),Y=()=>o(253809);function q(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:a,propertyChangedFilter:i,onClose:l}=e,{updatePropertyTrigger:s}=(0,O().p)(),u=(0,r().K8)((()=>"changes_to_any"===i.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,U().Ui)(i)&&(0,U().gc)(i)?Array.isArray(i.value)?i.value:[i.value]:[]),[i]),[c,p]=(0,n.useState)(u),d=(0,n.useMemo)((()=>1===c.length?{operator:"checkbox_is",value:c[0]}:{operator:"changes_to_any"}),[c]),g=(0,n.useMemo)((()=>2===c.length||1===c.length&&"partial"),[c]),y=(0,n.useCallback)((e=>{const t=Boolean(c.find((t=>t.value===e)));p(t?c.filter((t=>t.value!==e)):[...c,{type:"exact",value:e}])}),[c]),h=(0,n.useCallback)((()=>{s({anyOptionCheckState:g,propertyId:t,currentFilter:d}),l()}),[g,d,l,t,s]),f=Boolean(c.find((e=>!0===e.value))),v=Boolean(c.find((e=>!1===e.value)));return(0,m.jsx)(Y().A,{type:"default",automationTriggerActionMenuStore:o,onDone:h,onClose:l,sections:[{key:"select",render:e=>(0,m.jsx)(I().A,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,m.jsx)(A().A,{...e,isChecked:v,isTokenTitle:!0,title:(0,m.jsx)(x().sA,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>y(!1)},{key:"checked",render:e=>(0,m.jsx)(A().A,{...e,isChecked:f,isTokenTitle:!0,title:(0,m.jsx)(x().sA,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>y(!0)}]}],headerTitle:(0,m.jsx)(x().sA,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:a.name}})})}var $=()=>o(310109),G=()=>o(713998),Q=()=>o(284371),X=()=>o(859428),Z=()=>o(574299),J=()=>o(755535);function ee(e){let{handleSelectOperator:t,selectedItem:o}=e;const n=(0,s().Y0)(),r=(0,u().IS)((e=>({buttonStyle:{fontSize:n.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:n.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[n.isMobile]);return(0,m.jsx)(J().A,{style:{height:20},innerButtonStyle:r.buttonStyle,selectedTitle:(0,m.jsx)(x().sA,{...o.text}),renderMenuSections:e=>[{key:"selectNumberOperator",render:e=>(0,m.jsx)(I().A,{...e}),items:Object.values(Z().$R).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,m.jsx)(A().A,{...e,title:(0,m.jsx)(x().sA,{...o.text})})})))}]})}var te=()=>o(7868),oe=()=>o(962730),ne=()=>o(546461);function re(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:l,propertyId:s,shouldUseDefaultPropertyOperator:c}=e;const p=(0,n.useMemo)((()=>{if(c)return"number"===l.type?"number_equals":"changes_to_any"}),[l.type,c]),d=(0,r().K8)((()=>{if("changes_to_any"!==i.operator&&(0,U().My)(i)&&"is_empty"!==i.operator)return(0,U().gc)(i)?i.value.value:void 0}),[i]),[g,y]=(0,n.useState)((0,Z().Qy)(p||i.operator)),[h,f]=(0,n.useState)(d),v=(0,n.useMemo)((()=>{if((0,a().O9)(h))return{type:"simple",value:(0,G().hk)(h)}}),[h]),{updatePropertyTrigger:x}=(0,O().p)(),{typecheckResult:S,automationStore:b}=(0,ne().EC)(),C=(0,n.useMemo)((()=>(0,$().getAllContextValues)(S)),[S]),A=(0,n.useCallback)((e=>{const t=(0,G().Me)(null==e?void 0:e.value);f(t)}),[]),k=(0,n.useCallback)((e=>{y(e.value),Z().$R[e.value].hasInput||f(void 0)}),[]),M=(0,n.useCallback)((()=>{const e=(0,a().O9)(h)?{operator:g,value:{type:"exact",value:h}}:{operator:"is_empty"};let t="partial";"changes_to_any"===g?t=!0:"is_empty"===g&&(t=!1),x({anyOptionCheckState:t,propertyId:s,currentFilter:e,propertySchema:l}),o()}),[g,h,o,s,l,x]),j=Z().$R[g],T=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"4px",alignItems:"center"},propertyName:{...Q().RC}})),[]),{headerDiv:P}=(0,te().A)({currentSimpleFormulaValueTokens:[],formulaTypecheckContextValues:C,onChange:A,onClose:M,value:v,parentRecordStore:b});return(0,m.jsx)(Y().A,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,m.jsxs)("div",{style:T.header,children:[(0,m.jsx)(X().A,{placement:oe().W.Bottom,render:e=>(0,m.jsx)("div",{...e,style:T.propertyName,children:l.name}),renderTooltip:()=>l.name}),(0,m.jsx)(ee,{selectedItem:j,handleSelectOperator:k})]}),subHeaderComponent:j.hasInput&&(0,m.jsx)(I().A,{children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var ae=()=>o(791089),ie=()=>o(187174),le=()=>o(625830);const se=["person_contains","person_does_not_contain","is_empty","changes_to_any"];const ue=(0,x().YK)({changesToAny:{id:"automations.propertyTrigger.personField.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.personField.isEmpty",defaultMessage:"Is cleared"},personContains:{id:"automations.propertyTrigger.personField.personContainsOption",defaultMessage:"Contains"},personDoesNotContain:{id:"automations.propertyTrigger.personField.personDoesNotContainOption",defaultMessage:"Does not contain"}}),ce={person_contains:{hasInput:!0,text:ue.personContains,labelText:ue.personContains,value:"person_contains"},person_does_not_contain:{hasInput:!0,labelText:ue.personDoesNotContain,text:ue.personDoesNotContain,value:"person_does_not_contain"},changes_to_any:{hasInput:!1,text:ue.changesToAny,labelText:ue.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,labelText:ue.isEmpty,text:ue.isEmpty,value:"is_empty"}};function pe(e){let{handleSelectOperator:t,selectedItem:o}=e;const n=(0,s().Y0)(),r=(0,u().IS)((e=>({buttonStyle:{fontSize:n.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:n.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[n.isMobile]);return(0,m.jsx)(J().A,{style:{height:20},innerButtonStyle:r.buttonStyle,selectedTitle:(0,m.jsx)(x().sA,{...o.text}),renderMenuSections:e=>[{key:"selectPersonOperator",render:e=>(0,m.jsx)(I().A,{...e}),items:Object.values(ce).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,m.jsx)(A().A,{...e,title:(0,m.jsx)(x().sA,{...o.text})})})))}]})}var de=()=>o(294852),me=()=>o(106628),ge=()=>o(361330);function ye(e){var t,o;let{automationTriggerMenuStore:i,collectionStore:l,onClose:c,propertyChangedFilter:p,propertySchema:d,propertyId:g,shouldUseDefaultPropertyOperator:y}=e;const h=(0,n.useMemo)((()=>{if(y&&"person"===d.type)return"person_contains"}),[d.type,y]),f=(0,r().K8)((()=>{if("changes_to_any"!==p.operator)return(0,U().I_)(p)&&"is_empty"!==p.operator&&(0,U().gc)(p)?(0,U().Wf)(p):[]}),[p]),[v,S]=(0,n.useState)((()=>{if(f){const e=f.map((e=>{if("exact"===e.type)return e.value})).filter(a().O9);return{action:"replace",value:{type:"simple",value:(0,G().AH)(e)}}}})),[b,C]=(0,n.useState)(function(e){const t=e;return se.includes(t)?t:"person_contains"}(h||p.operator)),k=(0,s().v3)(),M=(0,s().Y0)(),[j]=(0,ie().Yb)((async()=>{const e=await me().T.searchActions.load();return(await e.searchVisibleSpaceUsers({environment:k,query:"",membersOnly:!1})).length}),[k],{debounce:ge().tu}),T=(0,n.useRef)(),P=(0,n.useRef)(),[w,_]=(0,n.useState)(!f),V=(0,n.useMemo)((()=>{var e;return(0,ae().fromSimpleFormulaArrayValue)(null==v||null===(e=v.value)||void 0===e?void 0:e.value)}),[null==v||null===(t=v.value)||void 0===t?void 0:t.value]),R=(0,r().K8)((()=>{var e;return function(e){const{formulaValue:t,allChecked:o,numTotalActors:n}=e;if(t&&t.length>0){return(0,ae().fromSimpleFormulaArrayValue)(t).length===n||"partial"}if(o)return!0;return!1}({propertySchema:d,formulaValue:null==v||null===(e=v.value)||void 0===e?void 0:e.value,allChecked:w,numTotalActors:j.value||0})}),[d,null==v||null===(o=v.value)||void 0===o?void 0:o.value,w,j.value]),{typecheckResult:B,automationStore:E}=(0,ne().EC)(),F=(0,n.useMemo)((()=>({collectionStore:l,property:g,type:"collection"})),[l,g]),N=(0,n.useMemo)((()=>(0,$().getAllContextValues)(B)),[B]),{updatePropertyTrigger:D}=(0,O().p)(),W=(0,n.useCallback)((()=>{const e=T.current||(null==v?void 0:v.value),t=P.current||b,o=e?(0,G().e5)({textValue:null==e?void 0:e.value,propertySchema:d,blockCreatorPointer:void 0}):void 0,n=o&&0!==o.length?{operator:t,value:o.map((e=>({type:"exact",value:e})))}:{operator:"person_contains"===t&&w?"changes_to_any":"is_empty"};let r="partial";"changes_to_any"===t?r=!0:"is_empty"===t&&(r=!1),D({anyOptionCheckState:r,propertyId:g,currentFilter:n,propertySchema:d}),c()}),[null==v?void 0:v.value,b,d,w,D,g,c]),L=(0,n.useCallback)((e=>{T.current=e,S({action:"replace",value:e}),1===d.limit&&W()}),[W,d.limit]),K=(0,n.useCallback)((()=>{R?(_(!1),V.length>0&&L(void 0)):_(!0)}),[R,V.length,L]),H=(0,n.useCallback)((e=>{P.current=e.value,C(e.value),ce[e.value].hasInput||L(void 0)}),[L]),z=ce[b],q=(0,u().IS)((e=>({header:{display:"flex",gap:"4px",alignItems:"center",overflow:"hidden"},propertyName:{...Q().RC}})),[]),Z=z.hasInput,J=!w||V.length>0,{headerDiv:ee,innerComponents:te}=(0,de().A)({currentSimpleFormulaValueTokens:V,formulaTypecheckContextValues:N,formulaValueContext:F,isDisabled:!J,limit:void 0,onChange:L,onClose:c,showClearButton:!0,showGenericHeader:!1,showInputMenuItem:!0,value:null==v?void 0:v.value,parentRecordStore:E});if(!F)return null;const re=[z.hasInput?{key:"any",items:[{key:"any-option-item",action:K,render:e=>(0,m.jsxs)(m.Fragment,{children:[ee,(0,m.jsx)(A().A,{onClick:K,focused:!0,icon:(0,m.jsx)(le().A,{checked:R,size:14,onClick:K}),title:(0,m.jsx)(x().sA,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})]})}],render:e=>(0,m.jsx)(I().A,{...e,topBorder:!1})}:void 0,Z?{key:"inner-components",items:[{key:"inner-components-item",action:K,render:e=>te}],render:e=>M.isMobile?te:(0,m.jsx)(I().A,{...e,topBorder:!0})}:void 0].filter(a().O9);return(0,m.jsx)(Y().A,{type:"default",automationTriggerActionMenuStore:i,onDone:W,onClose:c,headerTitle:(0,m.jsxs)("div",{style:q.header,children:[(0,m.jsx)(X().A,{placement:oe().W.Bottom,render:e=>(0,m.jsx)("div",{...e,style:q.propertyName,children:d.name}),renderTooltip:()=>d.name}),(0,m.jsx)(pe,{selectedItem:z,handleSelectOperator:H})]}),sections:re,customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var he=()=>o(696706),fe=()=>o(179034);const ve=["relation_contains","relation_does_not_contain","is_empty","changes_to_any"];const xe=(0,x().YK)({changesToAny:{id:"automations.propertyTrigger.relationOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.relationOperator.isEmpty",defaultMessage:"Is cleared"},relationContains:{id:"automations.propertyTrigger.relationOperator.relationContainsOption",defaultMessage:"Contains"},relationDoesNotContain:{id:"automations.propertyTrigger.relationOperator.relationDoesNotContain",defaultMessage:"Does not contain"}}),Se={relation_contains:{hasInput:!0,labelText:xe.relationContains,text:xe.relationContains,value:"relation_contains"},relation_does_not_contain:{hasInput:!0,labelText:xe.relationDoesNotContain,text:xe.relationDoesNotContain,value:"relation_does_not_contain"},changes_to_any:{hasInput:!1,text:xe.changesToAny,labelText:xe.changesToAny,value:"changes_to_any"},is_empty:{text:xe.isEmpty,labelText:xe.isEmpty,value:"is_empty",hasInput:!1}};function be(e){let{handleSelectOperator:t,selectedItem:o}=e;const n=(0,s().Y0)(),r=(0,u().IS)((e=>({buttonStyle:{fontSize:n.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:n.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[n.isMobile]);return(0,m.jsx)(J().A,{style:{height:20},innerButtonStyle:r.buttonStyle,selectedTitle:(0,m.jsx)(x().sA,{...o.text}),renderMenuSections:e=>[{key:"selectRelationOperator",render:e=>(0,m.jsx)(I().A,{...e}),items:Object.values(Se).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,m.jsx)(A().A,{...e,title:(0,m.jsx)(x().sA,{...o.text})})})))}]})}var Ce=()=>o(621314);function Ae(e){var t;let{automationTriggerMenuStore:o,collectionStore:i,onClose:l,propertyChangedFilter:s,propertySchema:c,propertyId:p,shouldUseDefaultPropertyOperator:d}=e;const g=(0,n.useMemo)((()=>{if(d)return"relation"===c.type?"relation_contains":"changes_to_any"}),[c.type,d]),y=(0,r().K8)((()=>"changes_to_any"===s.operator?[]:(0,U().Pq)(s)&&"is_empty"!==s.operator&&(0,U().gc)(s)?(0,U().Rh)(s):[]),[s]),h=(0,r().K8)((()=>{if(i&&c)return(0,ae().setPropertyValueToSimpleFormulaReturnType)(i.getSpaceShardedPointer(),p,c)}),[i,c,p]),f=(0,r().K8)((()=>i.getSpaceId()),[i]),[v,x]=(0,n.useState)(function(e){const t=e;return ve.includes(t)?t:"relation_contains"}(g||s.operator)),[S,b]=(0,n.useState)((()=>{const e=y.map((e=>{if(e.value&&"string"==typeof e.value)return he().L3.fromSpaceShardRecordId({id:e.value,spaceId:f},fe().ev)})).filter(a().O9);return{action:"replace",value:{type:"simple",value:(0,G().Ap)(e)}}})),C=(0,n.useMemo)((()=>{var e;return(0,ae().fromSimpleFormulaArrayValue)(null==S||null===(e=S.value)||void 0===e?void 0:e.value)}),[null==S||null===(t=S.value)||void 0===t?void 0:t.value]),A=(0,n.useRef)(),{updatePropertyTrigger:k}=(0,O().p)(),{typecheckResult:M,automationStore:j}=(0,ne().EC)(),T=(0,n.useMemo)((()=>({collectionStore:i,property:p,type:"collection"})),[i,p]),P=(0,n.useMemo)((()=>(0,$().getAllContextValues)(M)),[M]),w=(0,n.useCallback)((e=>{x(e.value),Se[e.value].hasInput||b(void 0)}),[]),_=Se[v],V=(0,n.useCallback)((()=>{const e=A.current||(null==S?void 0:S.value),t=(0,a().O9)(null==e?void 0:e.value)?(0,G().n)(null==e?void 0:e.value):void 0,o=t&&0!==t.length?{operator:_.value,value:t.map((e=>({type:"exact",value:e.id})))}:{operator:"is_empty"};k({anyOptionCheckState:"changes_to_any"===_.value,currentFilter:o,propertyId:p,propertySchema:c}),l()}),[null==S?void 0:S.value,l,p,c,_.value,k]),R=(0,n.useCallback)((e=>{A.current=e,b({action:"replace",value:e}),1===c.limit&&V()}),[V,c.limit]),B=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...Q().RC}})),[]),{headerDiv:E,innerComponents:F}=(0,Ce().A)({currentSimpleFormulaValueTokens:C,formulaTypecheckContextValues:P,formulaValueContext:T,onChange:R,onClose:l,showClearButton:!0,showInputMenuItem:!0,collection:"block_array"===(null==h?void 0:h.type)?h.collection:void 0,value:null==S?void 0:S.value,parentRecordStore:j});return(0,m.jsx)(Y().A,{type:"custom",automationTriggerActionMenuStore:o,onDone:V,onClose:l,headerTitle:(0,m.jsxs)("div",{style:B.header,children:[(0,m.jsx)(X().A,{placement:oe().W.Bottom,render:e=>(0,m.jsx)("div",{...e,style:B.propertyName,children:c.name}),renderTooltip:()=>c.name}),(0,m.jsx)(be,{selectedItem:_,handleSelectOperator:w})]}),subHeaderComponent:_.hasInput&&(0,m.jsx)(I().A,{children:E}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}},children:_.hasInput&&F})}var ke=()=>o(784892),Me=()=>o(859794);const je=["enum_contains","enum_does_not_contain","enum_is","enum_is_not","is_empty","changes_to_any"];const Te=(0,x().YK)({changesToAny:{id:"automations.propertyTrigger.selectOperator.changesToAnyOption",defaultMessage:"Is edited"},isEmpty:{id:"automations.propertyTrigger.selectOperator.isEmpty",defaultMessage:"Is cleared"},enumContains:{id:"automations.propertyTrigger.selectOperator.enumContainsOption",defaultMessage:"Contains"},enumDoesNotContain:{id:"automations.propertyTrigger.selectOperator.enumDoesNotContain",defaultMessage:"Does not contain"},enumIs:{id:"automations.propertyTrigger.selectOperator.enumIs",defaultMessage:"Is"},enumIsNot:{id:"automations.propertyTrigger.selectOperator.enumIsNot",defaultMessage:"Is not"}}),Ie={enum_contains:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:Te.enumContains,text:Te.enumContains,value:"enum_contains"},enum_does_not_contain:{hasInput:!0,isMulti:!0,isSingle:!1,labelText:Te.enumDoesNotContain,text:Te.enumDoesNotContain,value:"enum_does_not_contain"},enum_is:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:Te.enumIs,text:Te.enumIs,value:"enum_is"},enum_is_not:{hasInput:!0,isMulti:!1,isSingle:!0,labelText:Te.enumIsNot,text:Te.enumIsNot,value:"enum_is_not"},changes_to_any:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:Te.changesToAny,text:Te.changesToAny,value:"changes_to_any"},is_empty:{hasInput:!1,isMulti:!0,isSingle:!0,labelText:Te.isEmpty,text:Te.isEmpty,value:"is_empty"}};function Pe(e){let{handleSelectOperator:t,selectedItem:o,type:r}=e;const a=(0,s().Y0)(),i=(0,u().IS)((e=>({buttonStyle:{fontSize:a.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:a.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[a.isMobile]),l=(0,n.useMemo)((()=>{const e="multi_select"===r,t="select"===r;return Object.values(Ie).filter((o=>e?o.isMulti:t?o.isSingle:void 0))}),[r]);return(0,m.jsx)(J().A,{style:{height:20},innerButtonStyle:i.buttonStyle,selectedTitle:(0,m.jsx)(x().sA,{...o.text}),renderMenuSections:e=>[{key:"selectSelectOperator",render:e=>(0,m.jsx)(I().A,{...e}),items:l.map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,m.jsx)(A().A,{...e,title:(0,m.jsx)(x().sA,{...o.text})})})))}]})}var we=()=>o(399762),_e=()=>o(856952);function Ve(e){const{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertyId:l,propertySchema:c,shouldUseDefaultPropertyOperator:p}=e,{isMobile:d,isAndroid:g}=(0,s().Y0)(),y=(0,x().tz)(),{updatePropertyTrigger:h}=(0,O().p)(),f=(0,n.useMemo)((()=>{if(p)return"select"===c.type?"enum_is":"multi_select"===c.type?"enum_contains":"changes_to_any"}),[c.type,p]),v=(0,r().K8)((()=>{if("changes_to_any"===i.operator){return(c.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,U().v0)(i)&&!(0,U().as)(i))return[];if((0,U().gc)(i)){const e=(c.options??[]).map((e=>e.value));return(Array.isArray(i.value)?i.value:[i.value]).filter((t=>(0,a().O9)(t.value)&&e.includes(t.value)))}return[]}),[c,i]),[b,C]=n.useState(v),[k,M]=(0,n.useState)(function(e){const t=e;return je.includes(t)?t:"enum_contains"}(f||i.operator)),j=(0,n.useCallback)((e=>{M(e.value)}),[]),T=Ie[k],P=(0,r().K8)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,r=!0;const a=t.options??[];for(const i of a){const e=o.some((e=>e.value===i.value));n||=e,r&&=e}return!!r||!!n&&"partial"}({propertySchema:c,selectedOptions:b})),[c,b]),w=n.useMemo((()=>(c.options??[]).map((e=>({type:"exact",value:e.value})))),[c]),_=!0===P?[]:b.map((e=>{if(!e.value||!c.options)return;const t=(0,G().jy)(c.options,e.value);return t?(0,m.jsx)(we().O,{format:d?ke().NY.Large:ke().NY.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=S().FF(b,e);C(t)}},t.id):void 0})),[V,R]=n.useState(""),B=(0,Me().r9)({query:V,propertySchema:c,selectedValues:b,updateValue:e=>{R(""),C(e)},isMobile:d,styles:{},isFormEditorView:!1}),E=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...Q().RC}})),[]),F=(0,n.useCallback)((()=>{let e,t="partial";if("changes_to_any"===k)t=!0,e={operator:k};else if("is_empty"===k)t=!1,e={operator:k};else{const o=Array.isArray(b)?b:[b];0===o.length?(t=!1,e={operator:"is_empty"}):e={operator:k,value:o}}h({anyOptionCheckState:t,propertyId:l,currentFilter:e,propertySchema:c}),o()}),[o,l,c,k,b,h]),N=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,m.jsx)("div",{style:{...!d&&{paddingTop:0,paddingRight:8,paddingBottom:4,paddingLeft:8}},children:(0,m.jsx)(_e().Ay,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:_e().le.FilterValue,tokens:_,placeholder:P?y.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):y.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=b.slice(0,b.length-1);C(e)},onClearButtonClick:()=>{C([])},value:V,onChange:e=>{R(e.target.value)},dontShowBorderBottom:g,showClearButton:!0})})}],render:e=>(0,m.jsx)(I().A,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===P?C([]):!1===P||"partial"===P?C(w):(0,a().HB)(P),R("")},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(le().A,{checked:P,size:14,onClick:e.onClick}),title:(0,m.jsx)(x().sA,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,m.jsx)(I().A,{...e,topBorder:!0})},B.length>0?{key:"items",items:B,render:e=>(0,m.jsx)(I().A,{...e,topBorder:!0})}:void 0].filter(a().O9);return(0,m.jsx)(Y().A,{type:"default",automationTriggerActionMenuStore:t,onDone:F,onClose:o,sections:T.hasInput?N:[],headerTitle:(0,m.jsxs)("div",{style:E.header,children:[(0,m.jsx)(X().A,{placement:oe().W.Bottom,render:e=>(0,m.jsx)("div",{...e,style:E.propertyName,children:c.name}),renderTooltip:()=>c.name}),(0,m.jsx)(Pe,{handleSelectOperator:j,selectedItem:T,type:c.type})]}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}o(823215);var Re=()=>o(378864),Be=()=>o(873050);function Ee(e){const{propertyId:t,automationTriggerMenuStore:o,propertySchema:i,propertyChangedFilter:l,onClose:u}=e,{isMobile:c}=(0,s().Y0)(),{updatePropertyTrigger:p}=(0,O().p)(),d=(0,r().K8)((()=>{if("changes_to_any"===l.operator){return(i.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,U().H$)(l)&&(0,U().gc)(l)?(0,U().V6)(l):[]}),[i,l]),[g,y]=n.useState(d),h=(0,r().K8)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],r=t.options??[],a=n.map((e=>(0,Be().Ze)({group:e,options:r,filterValues:o}))),i=a.every((e=>!0===e.groupCheckState)),l=a.some((e=>!1!==e.groupCheckState));return!!i||!!l&&"partial"}({propertySchema:i,selectedStatusOptions:g})),[i,g]),f=n.useMemo((()=>(i.groups??[]).map((e=>({type:"is_group",value:e.name})))),[i]),v=(0,Re().T)({propertySchema:i,statusFilterValues:g,updateValue:e=>{y(e)},isMobile:c,styles:{},visibleOptions:i.options??[]}),S=(0,n.useCallback)((()=>{const e=0===g.length?{operator:"is_empty"}:{operator:"status_is",value:g};p({anyOptionCheckState:h,propertyId:t,currentFilter:e,propertySchema:i}),u()}),[h,u,t,i,g,p]);return(0,m.jsx)(Y().A,{type:"default",automationTriggerActionMenuStore:o,onDone:S,onClose:()=>{u()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===h?y([]):!1===h||"partial"===h?y(f):(0,a().HB)(h)},render:e=>(0,m.jsx)(A().A,{...e,icon:(0,m.jsx)(le().A,{checked:h,size:14,onClick:e.onClick}),title:(0,m.jsx)(x().sA,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,m.jsx)(I().A,{...e})},{key:"items",items:v,render:e=>(0,m.jsx)(I().A,{...e,topBorder:!0})}],headerTitle:(0,m.jsx)(x().sA,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:i.name}}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}var Fe=()=>o(919709),Ne=()=>o(438873);function Oe(e){let{handleSelectOperator:t,selectedItem:o}=e;const n=(0,s().Y0)(),r=(0,u().IS)((e=>({buttonStyle:{fontSize:n.isMobile?16:12,height:20,lineHeight:"unset",marginRight:0,paddingLeft:2,paddingRight:2,textTransform:"lowercase",color:n.isMobile?e.accentColors.gray[900]:e.accentColors.gray[500]}})),[n.isMobile]);return(0,m.jsx)(J().A,{style:{height:20},innerButtonStyle:r.buttonStyle,selectedTitle:(0,m.jsx)(x().sA,{...o.text}),renderMenuSections:e=>[{key:"selectTextOperator",render:e=>(0,m.jsx)(I().A,{...e}),items:Object.values(Ne().bK).map((o=>({key:o.value,action:()=>{t(o),e.close()},render:e=>(0,m.jsx)(A().A,{...e,title:(0,m.jsx)(x().sA,{...o.text})})})))}]})}var De=()=>o(277871);function We(e){let{automationTriggerMenuStore:t,onClose:o,propertyChangedFilter:i,propertySchema:l,propertyId:s,shouldUseDefaultPropertyOperator:c}=e;const p=(0,n.useMemo)((()=>{if(c)return(0,G().DY)(l.type)?"string_is":"changes_to_any"}),[l.type,c]),d=(0,r().K8)((()=>{if("changes_to_any"!==i.operator&&(0,U().YH)(i)&&"is_empty"!==i.operator)return(0,U().gc)(i)?i.value.value:void 0}),[i]),[g,y]=(0,n.useState)((()=>(0,Ne().mK)(p||i.operator))),[h,f]=(0,n.useState)(d),v=(0,n.useMemo)((()=>{if(h)return{type:"simple",value:Fe().x9d(h)}}),[h]),{updatePropertyTrigger:x}=(0,O().p)(),{typecheckResult:S,automationStore:b}=(0,ne().EC)(),C=(0,n.useMemo)((()=>(0,$().getAllContextValues)(S)),[S]),A=(0,n.useCallback)((e=>{const t=Fe().k4p(null==e?void 0:e.value);f(t.trim()?t:void 0)}),[]),k=(0,n.useCallback)((e=>{y(e.value),Ne().bK[e.value].hasInput||f(void 0)}),[]),M=(0,n.useCallback)((()=>{const e=(0,a().O9)(h)?{operator:g,value:{type:"exact",value:h}}:{operator:"is_empty"};let t="partial";"changes_to_any"===g?t=!0:"is_empty"===g&&(t=!1),x({anyOptionCheckState:t,propertyId:s,currentFilter:e,propertySchema:l}),o()}),[g,h,o,s,l,x]),j=Ne().bK[g],T=(0,u().IS)((e=>({header:{display:"grid",gridTemplateColumns:"auto auto",gridGap:"2px",alignItems:"center"},propertyName:{...Q().RC}})),[]),{headerDiv:P}=(0,De().A)({currentSimpleFormulaValueTokens:[],disableEmojiCommands:!0,disableFormulas:!0,disableFormattingAndMentions:!0,disableMobileActionBar:!0,disableTemplateVariableMentions:!0,formulaTypecheckContextValues:C,onChange:A,onClose:M,value:v,parentRecordStore:b});return(0,m.jsx)(Y().A,{type:"custom",automationTriggerActionMenuStore:t,onDone:M,onClose:o,headerTitle:(0,m.jsxs)("div",{style:T.header,children:[(0,m.jsx)(X().A,{placement:oe().W.Bottom,render:e=>(0,m.jsx)("div",{...e,style:T.propertyName,children:l.name}),renderTooltip:()=>l.name}),(0,m.jsx)(Oe,{selectedItem:j,handleSelectOperator:k})]}),subHeaderComponent:j.hasInput&&(0,m.jsx)(I().A,{children:P}),customMenuProps:{leftOuterStyle:{flex:"unset"},rightOuterStyle:{flex:"unset"},titleOuterStyle:{flex:"unset"},topbarStyle:{justifyContent:"space-between"}}})}function Le(e){const{propertyId:t,automationTriggerMenuStore:o,onClose:n}=e,{automationStore:i,collectionStore:l}=(0,F().k)(),s=(0,r().K8)((()=>l.getSchema()),[l])[t],u=(0,r().K8)((()=>i.getTrigger()),[i]);let p=[];"event"===(null==u?void 0:u.type)&&("some"===u.event.pagePropertiesEdited.type?p=u.event.pagePropertiesEdited.some||[]:"all"===u.event.pagePropertiesEdited.type&&(p=u.event.pagePropertiesEdited.all||[]));const d=p.find((e=>e.property===t)),g=d??{property:t,filter:{operator:"changes_to_any"}};if(!s)return null;if(!(0,c().nq)(s))return null;const y=!(0,a().O9)(d);return"multi_select"===s.type||"select"===s.type?(0,m.jsx)(Ve,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:y}):"status"===s.type?(0,m.jsx)(Ee,{propertyId:t,automationTriggerMenuStore:o,propertySchema:s,propertyChangedFilter:g.filter,onClose:n}):"checkbox"===s.type?(0,m.jsx)(q,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s}):"person"===s.type?(0,m.jsx)(ye,{automationTriggerMenuStore:o,collectionStore:l,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:y}):"number"===s.type?(0,m.jsx)(re,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:y}):"email"===s.type||"phone_number"===s.type||"text"===s.type||"title"===s.type||"url"===s.type?(0,m.jsx)(We,{automationTriggerMenuStore:o,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:y}):"relation"===s.type?(0,m.jsx)(Ae,{automationTriggerMenuStore:o,collectionStore:l,onClose:n,propertyChangedFilter:g.filter,propertyId:t,propertySchema:s,shouldUseDefaultPropertyOperator:y}):null}function Ke(e){const{initialState:t,buttonPopupParent:o}=e,l=(0,r().K8)((()=>{const e=new(i().AK);return e.setState({insertionPoint:void 0,stack:[t]}),e}),[t]),s=(0,r().K8)((()=>l.getCurrentTab()),[l]),u=(0,n.useCallback)((()=>o.close()),[o]);return s?"eventTriggers"===s.type?(0,m.jsx)(W,{automationTriggerMenuStore:l,onClose:u}):"propertyChangedFilter"===s.type?(0,m.jsx)(Le,{propertyId:s.property,automationTriggerMenuStore:l,onClose:u}):(0,a().HB)(s):null}},556927:(e,t,o)=>{o.d(t,{j:()=>n});const n=(0,o(340498).xh)("arrowUpRight",{default:{loader:()=>o.e(43274).then(o.bind(o,443274))},small:{loader:()=>o.e(30720).then(o.bind(o,230720))},mini:{loader:()=>o.e(37972).then(o.bind(o,315591))},large:{loader:()=>o.e(49172).then(o.bind(o,749172))}})},574299:(e,t,o)=>{o.d(t,{$R:()=>i,Qy:()=>r});const n=["number_does_not_equal","number_equals","number_greater_than","number_greater_than_or_equal_to","number_less_than","number_less_than_or_equal_to","is_empty","changes_to_any"];function r(e){const t=e;return n.includes(t)?t:"number_equals"}const a=(0,o(959013).YK)({changesToAny:{id:"automations.propertyTrigger.numberField.changesToAnyOption",defaultMessage:"Is edited"},numberEquals:{id:"automations.propertyTrigger.numberField.equalsOption",defaultMessage:"="},numberGreaterThanOrEqualTo:{id:"automations.propertyTrigger.numberField.greaterThanOrEqualTo",defaultMessage:"≥"},numberLessThanOrEqualTo:{id:"automations.propertyTrigger.numberField.lessThanOrEqualTo",defaultMessage:"≤"},isEmpty:{id:"automations.propertyTrigger.numberField.isEmpty",defaultMessage:"Is cleared"},numberGreaterThan:{id:"automations.propertyTrigger.numberField.greaterThan",defaultMessage:">"},numberLessThan:{id:"automations.propertyTrigger.numberField.lessThan",defaultMessage:"<"},numberDoesNotEqual:{id:"automations.propertyTrigger.numberField.doesNotEqualOption",defaultMessage:"≠"}}),i={number_equals:{hasInput:!0,text:a.numberEquals,value:"number_equals"},number_does_not_equal:{hasInput:!0,text:a.numberDoesNotEqual,value:"number_does_not_equal"},number_greater_than:{hasInput:!0,text:a.numberGreaterThan,value:"number_greater_than"},number_less_than:{hasInput:!0,text:a.numberLessThan,value:"number_less_than"},number_greater_than_or_equal_to:{hasInput:!0,text:a.numberGreaterThanOrEqualTo,value:"number_greater_than_or_equal_to"},number_less_than_or_equal_to:{hasInput:!0,text:a.numberLessThanOrEqualTo,value:"number_less_than_or_equal_to"},changes_to_any:{hasInput:!1,text:a.changesToAny,value:"changes_to_any"},is_empty:{text:a.isEmpty,value:"is_empty",hasInput:!1}}},576241:(e,t,o)=>{o.d(t,{A:()=>m});var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(764880),l=()=>o(791089),s=()=>o(798880),u=()=>o(919709),c=()=>o(448693),p=()=>o(546461),d=o(474848);function m(e){let{handleRemoveToken:t,token:o,style:m,isDisabled:g,preventOnClickPropagation:y}=e;const h=(0,r().Y0)(),{automationStore:f}=(0,p().EC)(),v=(0,a().K8)((()=>{if((0,l().isAnnotationSimpleValueToken)(o)&&(0,u().rie)(o)){const e=(0,u().NcG)(o);if(e)return(0,i().xC)({pointer:{table:s().oo,id:e},getRecordValue:f.getRecordModel})}}),[f.getRecordModel,o]),x=(0,n.useCallback)((()=>{t&&t(o)}),[t,o]);return null!=v&&v.asActor&&v.table===s().oo?(0,d.jsx)(c().Ay,{actor:v,format:h.isMobile?c().Ay.Format.Medium:c().Ay.Format.Small,showRemoveButton:Boolean(t)&&!g,onClickRemove:e=>{y&&(null==e||e.stopPropagation()),x()},shouldShrink:!0,isSingle:!1,style:m},v.id):null}},585293:(e,t,o)=>{o.d(t,{a:()=>a});var n=o(296540),r=o(474848);const a=n.forwardRef(((e,t)=>{const n=(0,o(401497).IS)((t=>({buttonStyle:{paddingLeft:8,paddingRight:8,paddingTop:2,paddingBottom:2,width:"100%",marginLeft:0,background:"transparent",...e.buttonStyle},menuItemStyle:{gap:6,background:"transparent",...e.style},innerContainer:{marginLeft:0,paddingLeft:0,minWidth:"auto",color:e.disabled?t.text.secondary:void 0,background:"transparent"},desktopIconStyle:{margin:0},rightStyle:{display:"flex",alignItems:"center",gap:6,color:t.text.secondary,margin:0,...e.rightStyle}})),[e.disabled,e.rightStyle,e.buttonStyle,e.style]);return(0,r.jsx)(o(760217).A,{role:"button",...e,ref:t,style:n.menuItemStyle,buttonStyle:n.buttonStyle,textWrapperStyle:n.innerContainer,desktopIconStyle:n.desktopIconStyle,rightStyle:n.rightStyle})}));a.displayName="SiteSettingButtonMenuItem"},616175:(e,t,o)=>{o.d(t,{M:()=>y,z:()=>h});o(296540);var n=()=>o(484714),r=()=>o(847249),a=()=>o(401497),i=()=>o(693954),l=()=>o(959013),s=()=>o(284371),u=()=>o(84817),c=()=>o(554509),p=()=>o(521732),d=()=>o(963589),m=()=>o(938818),g=o(474848);function y(e){const{analyzedFormulaOutput:t,labelMessageDescriptor:o,isOptional:y,errorMessageDescriptor:f}=e,v=(0,l().tz)(),x=(0,d().X)("automation_updated_error_states"),S=(0,r().K8)((()=>(0,m().L)(v,null==t?void 0:t.parseErrors,null==t?void 0:t.typeErrors)),[t,v]),{isMobile:b}=(0,n().Y0)(),C=(0,a().IS)((e=>({inputLabel:{display:"flex",alignItems:"center",color:e.text.secondary,fontSize:b?s().J.UIRegular.mobile:s().J.UIRegular.desktop,lineHeight:b?s().K_.UIRegular.mobile:s().K_.UIRegular.desktop,fontWeight:s().Wy.regular},messageInput:{width:"100%"},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",width:12,display:"flex",marginRight:4},inputLabelInner:{flex:"1 1 auto",...x&&(f||S)&&{color:e.text.uiRedPrimary,fontWeight:s().Wy.medium}},warningError:{color:e.text.uiRedPrimary}})),[f,S,x,b]);return(0,g.jsxs)(u().Y1,{direction:"vertical",gap:6,children:[(0,g.jsxs)("label",{style:C.inputLabel,children:[S&&(0,i().Q)(C.warningIcon),(0,g.jsxs)("div",{style:C.inputLabelInner,children:[(0,g.jsx)(l().sA,{...o}),y&&(0,g.jsx)(h,{})]})]}),(0,g.jsxs)(u().Y1,{direction:"vertical",gap:6,children:[(0,g.jsx)(p().Y,{...e,style:C.messageInput,shouldShowErrorStyles:Boolean(S)||e.shouldShowErrorStyles}),S&&(0,g.jsx)(m().J,{analyzedFormulaOutput:t}),!S&&f&&x&&(0,g.jsx)(c().D,{colorName:"secondary",styleName:"UISmall-12px/Regular",style:C.warningError,children:(0,g.jsx)(l().sA,{...f})})]})]})}function h(){const e=(0,a().IS)((e=>({optionalLabel:{color:e.text.tertiary,marginLeft:4}})),[]);return(0,g.jsx)("span",{style:e.optionalLabel,children:(0,g.jsx)(l().sA,{defaultMessage:"{openParenthesis}Optional{closeParenthesis}",id:"automations.SimpleFormulaTextInputWithError.optionalLabel",values:{openParenthesis:"(",closeParenthesis:")"}})})}},617640:(e,t,o)=>{o.d(t,{m:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("mention",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0.870117 8.40625C0.870117 4.01758 3.86426 1.09863 8.14355 1.09863C12.2109 1.09863 15.123 3.68945 15.123 7.6543C15.123 10.293 13.9131 12.1318 11.9443 12.1318C10.8506 12.1318 10.0439 11.5645 9.87988 10.6279H9.79785C9.4082 11.5781 8.62207 12.1318 7.57617 12.1318C5.77148 12.1318 4.53418 10.6143 4.53418 8.42676C4.53418 6.2666 5.76465 4.77637 7.52148 4.77637C8.52637 4.77637 9.36035 5.28906 9.70215 6.12305H9.79102V5.4668C9.79102 5.03613 10.0371 4.77637 10.4473 4.77637C10.8574 4.77637 11.0967 5.03613 11.0967 5.4668V9.85547C11.0967 10.5801 11.4932 11.0039 12.1904 11.0039C13.2363 11.0039 13.8926 9.69141 13.8926 7.74316C13.8926 4.26367 11.3223 2.28125 8.12988 2.28125C4.56836 2.28125 2.18262 4.81055 2.18262 8.44727C2.18262 12.2207 4.69141 14.4629 8.42383 14.4629C9.29883 14.4629 9.94141 14.3398 10.6797 14.1689C10.8164 14.1416 10.9326 14.1279 11.0283 14.1279C11.3428 14.1279 11.5547 14.3398 11.5547 14.6338C11.5547 14.9141 11.3975 15.1533 10.9463 15.3037C10.3242 15.5088 9.31934 15.6523 8.19824 15.6523C3.93262 15.6523 0.870117 12.8975 0.870117 8.40625ZM7.84277 10.9014C8.99805 10.9014 9.73633 9.93066 9.73633 8.41309C9.73633 6.92285 9.00488 5.98633 7.84961 5.98633C6.71484 5.98633 5.99707 6.93652 5.99707 8.44043C5.99707 9.95117 6.70801 10.9014 7.84277 10.9014Z"})})},621314:(e,t,o)=>{o.d(t,{A:()=>H});o(944114),o(581454);var n=o(296540),r=()=>o(484714),a=()=>o(401497),i=(o(898992),o(354520),o(672577),()=>o(847249)),l=()=>o(970013),s=()=>o(247331),u=()=>o(977345),c=()=>o(791089),p=()=>o(187174),d=()=>o(919709),m=()=>o(959013),g=()=>o(778078),y=()=>o(496603),h=()=>o(419830),f=()=>o(742971),v=()=>o(258804),x=()=>o(856952),S=()=>o(645873),b=()=>o(106628),C=()=>o(361330),A=()=>o(970585),k=()=>o(120423),M=()=>o(674300),j=()=>o(784892),T=()=>o(566081),I=()=>o(546461),P=o(474848);function w(e){let{handleRemoveToken:t,isDisabled:o,token:a}=e;const i=(0,r().Y0)(),{automationStore:l}=(0,I().EC)(),s=(0,n.useCallback)((()=>{t&&t(a)}),[t,a]),u=(0,d().i$F)(a);if(!u)return null;const c=u.id;return(0,P.jsx)(T().A,{blockId:c,format:i.isMobile?j().NY.Medium:j().NY.Small,isSingle:!1,onClickRemove:s,parentStore:l,shouldShrink:!0,shouldWrap:!1,showRemoveButton:!o},c)}var _=()=>o(722872),V=()=>o(928600),R=()=>o(939740),B=()=>o(64e3),E=()=>o(480095),F=()=>o(89924),N=()=>o(996027),O=()=>o(231713),D=()=>o(179034),W=()=>o(630116),L=()=>o(958378);function K(e){let{annotation:t,isChecked:o,menuArgs:n}=e;const{automationStore:r}=(0,I().EC)(),a=(0,i().K8)((()=>{if((0,c().isAnnotationSimpleValueToken)(t)&&(0,d().jIt)(t))return(0,d().i$F)(t)}),[t]);if(!a)return null;const l=a.id,s=W().Bv.createChildStore(r,{id:l,table:D().ev});return(0,P.jsx)(L().A,{store:s,isChecked:o,hidePath:!0,...n})}function H(e){const{action:t,collection:o,currentSimpleFormulaValueTokens:j,formulaTypecheckContextValues:T,formulaValueContext:I,menuProps:D,onChange:W,onClose:L,showClearButton:H=!1,showFormulaValueItems:z=!1,showGenericHeader:U=!1,showInputMenuItem:Y=!1,showReplaceAddRemoveToggle:q=!1,value:$,parentRecordStore:G}=e,Q=(0,r().Y0)(),X=(0,a().IS)((e=>({genericHeader:{paddingBottom:0},replaceAddRemoveToggleButton:{marginLeft:"8px",marginRight:"8px",marginTop:"8px"}})),[]),{footer:Z,header:J,menuListStore:ee,noResultsMessage:te,searchInput:oe,pageItems:ne,replaceAddRemoveToggleButton:re,valueItems:ae}=function(e){var t,o;const{action:a,collection:j,formulaTypecheckContextValues:T,formulaValueContext:I,onChange:_,onClose:V,showClearButton:R,showReplaceAddRemoveToggle:B,unlimitedCurrentSimpleFormulaValueTokens:E,value:F}=e,N=(0,r().v3)(),O=(0,r().Y0)(),D=(0,m().tz)(),{collectionStore:W,property:L}=I,K=(0,h().pg)(I),H=(0,i().K8)((()=>W.getSchema()[L]),[W,L]),z=(0,n.useMemo)((()=>{const e="relation"===(null==H?void 0:H.type)?(0,l().Nv)(H):void 0;return T.filter((t=>(0,u().o5)(t.type,{type:"block",collection:e},!0)))}),[T,H]),[U,Y]=(0,n.useState)(""),q=(0,i().uB)(void 0,A().A),$=(0,i().K8)((()=>!!(W&&L&&H&&(0,l().sO)(H))&&1===H.limit),[W,L,H]),G=(0,S().fJ)(b().T.searchActions),[Q]=(0,p().Yb)((async()=>{const e=U?(0,g().Ay)(U,z,(e=>e.kind===s().FormulaContextValueKind.ContextValue?e.name:"")):z;if("resolved"!==G.status||!j)return;const t=G.value,{results:o}=await t.searchPagesInCollection({environment:N,query:U,collectionId:j.id,limit:20,spaceId:j.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:o}}),[U,z,G.status,G.value,j,N],{debounce:C().tu}),X=K(E,"first").filter((e=>{if("string"!=typeof e&&"boolean"!=typeof e&&(0,d().jIt)(e)){var t,o;const n=null===(t=(0,d().i$F)(e))||void 0===t?void 0:t.id;if(n&&null!=Q&&null!==(o=Q.value)&&void 0!==o&&o.pageResults.includes(n))return!0}return!0})),Z=(0,n.useCallback)((()=>{Y(""),q.setState({...q.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[q]),J=(0,n.useCallback)(((e,t)=>{_(e||F,t||a)}),[a,_,F]),ee=(0,n.useCallback)((e=>{const t=K(e,"last");J({type:"simple",value:(0,c().toSimpleFormulaArrayValue)(t)}),Z(),$&&V()}),[K,J,Z,$,V]),te=(0,n.useCallback)((()=>{ee(X.slice(0,X.length-1))}),[X,ee]),oe=(0,n.useCallback)((e=>{null==ee||ee((0,c().simpleFormulaValueWithoutToken)(X,e))}),[X,ee]),ne=y().oE(X.map(((e,t)=>"string"==typeof e||"boolean"==typeof e?null:(0,d().s1Y)(e)?(0,P.jsx)(M().A,{formulaTypecheckContextValues:T,handleRemoveToken:oe,isDisabled:!1,token:e},t):(0,d().jIt)(e)?(0,P.jsx)(w,{handleRemoveToken:oe,isDisabled:!1,token:e},t):null))),re=(0,P.jsx)("div",{style:{...!O.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,P.jsx)(x().Ay,{focus:!O.isMobile||void 0,focusAfterAnimation:!0,format:x().le.FilterValue,tokens:ne,placeholder:D.formatMessage(f().D.pageSearchPlaceholder),onRemoveLastToken:te,onClearButtonClick:()=>ee([]),value:U,onChange:e=>Y(e.target.value),dontShowBorderBottom:O.isAndroid,showClearButton:R})}),ae=(0,P.jsx)(v().A,{value:F,onChange:J}),ie=(0,P.jsx)(k().A,{action:a,handleOnChange:J}),le=y().oE(((null===(t=Q.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===s().FormulaContextValueKind.ContextValue&&e.id||"",o=Boolean(X.find((e=>(0,c().isAnnotationSimpleValueToken)(e)&&(0,d().s1Y)(e)&&(0,d().iVq)(e).id===t)));return{action:"append",checkType:$?"single":"multi",isChecked:o,currentSimpleFormulaValueTokens:X,id:t,setCurrentTokens:ee,value:e}}))),se=y().oE(((null===(o=Q.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(X.find((t=>{var o;return(0,c().isAnnotationSimpleValueToken)(t)&&(0,d().jIt)(t)&&(null===(o=(0,d().i$F)(t))||void 0===o?void 0:o.id)===e})));if(j){const o=(0,d().ld4)(e,j.spaceId);return{action:()=>{ee(t?(0,c().simpleFormulaValueWithoutToken)(X,o):[...X,o])},isChecked:t,checkType:$?"single":"multi",annotation:o,id:e}}}))),ue=[...le,...se];return{footer:ae,header:D.formatMessage(f().D.genericMenuHeader),menuListStore:q,noResultsMessage:0===ue.length&&Q.value&&D.formatMessage(f().D.noResults),replaceAddRemoveToggleButton:Boolean(B)&&ie,searchInput:re,pageItems:se,valueItems:le}}({action:t,collection:o,formulaTypecheckContextValues:T,formulaValueContext:I,onChange:W,onClose:L,showClearButton:H,showReplaceAddRemoveToggle:q,unlimitedCurrentSimpleFormulaValueTokens:j,value:$})||{},ie=[...(0,n.useMemo)((()=>z?ae.map((e=>{const{annotation:t,itemAction:o}=(0,O().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,P.jsx)(N().A,{annotation:t,isChecked:e.isChecked,disabled:!1,formulaTypecheckContextValues:T,menuArgs:o,parentRecordStore:G}),action:o}})):[]),[T,z,ae,G]),...(0,n.useMemo)((()=>ne?ne.map((e=>({key:e.id,render:t=>(0,P.jsx)(K,{annotation:e.annotation,isChecked:e.isChecked,menuArgs:t}),action:e.action}))):[]),[ne])],le=[];let se;ie.length>0&&le.push({key:"values",render:e=>(0,P.jsx)(F().A,{...e}),items:ie}),se=Q.isMobile?{menuType:_().gu.Modal,right:(0,P.jsx)(E().DoneMenuText,{}),onClickRight:L,minWidth:260,footer:Z&&(0,P.jsx)(F().A,{topBorder:!0,children:Z})}:{menuType:_().gu.Popup,maxHeight:"50vh",width:260,footer:Z&&(0,P.jsx)(F().A,{topBorder:!0,children:Z}),disableHeaderBorder:!0};const ue=U&&(0,P.jsx)(F().A,{style:X.genericHeader,title:J}),ce=(0,P.jsxs)(P.Fragment,{children:[!Q.isMobile&&((null==D?void 0:D.header)||ue),Y&&(0,P.jsx)(F().A,{children:oe})]}),pe=(0,P.jsxs)(P.Fragment,{children:[re&&(0,P.jsx)("div",{style:X.replaceAddRemoveToggleButton,children:re}),te&&(0,P.jsx)(F().A,{children:(0,P.jsx)(B().A,{title:te})}),ie.length>0&&(0,P.jsx)(R().Ay,{type:R().Oh.Vertical,initialFocus:0,sections:le,store:ee})]});return{headerDiv:ce,innerComponents:pe,relationMenu:(0,P.jsx)(V().A,{...se,...D,header:ce,children:pe})}}},628864:(e,t,o)=>{o.d(t,{Hn:()=>N,XN:()=>F,pj:()=>_,qj:()=>O});o(944114),o(898992),o(354520),o(672577),o(581454),o(737550);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(401497),l=()=>o(148307),s=()=>o(617871),u=()=>o(353147),c=()=>o(315564),p=()=>o(381138),d=()=>o(966098),m=()=>o(959013),g=()=>o(496603),y=()=>o(973647),h=()=>o(534177),f=()=>o(449506),v=()=>o(510683),x=()=>o(972435),S=()=>o(881707),b=()=>o(47170),C=()=>o(62856),A=()=>o(53137),k=()=>o(829e3),M=()=>o(760217),j=()=>o(419357),T=()=>o(331542),I=()=>o(89924),P=o(474848);const w=(0,m().YK)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function _(e){const{currentNotificationChannels:t,onNotificationChannelSelect:o,onNotificationChannelSelectAll:i,onClose:u,onNewSlackAccountAdded:c,renderMenu:d,channelFilter:f,workflowExternalAuthenticationPointer:k,isMultiSelectMode:_,shouldHideSlackAccountSection:E,shouldShowSelectAllChannels:O,isAllChannels:D,shouldShowImChannels:W}=e,L=(0,r().v3)(),{isMobile:K}=(0,r().Y0)(),H=(0,a().O$)(A().A.completeSlackAuthentications),z=e.currentExternalAuthentication??g().$1(H),U=(0,n.useMemo)((()=>k?{type:"workflow",workflowExternalAuthenticationId:k.id}:z?{type:"external",botId:z.id}:void 0),[k,z]);n.useEffect((()=>{const e=k?null==k?void 0:k.spaceId:null==z?void 0:z.space_id;U&&e&&N({environment:L,spaceId:e,externalAuthConfig:U})}),[L,U,z,k]);const Y=(null==k?void 0:k.id)??(null==z?void 0:z.id),[q,$]=n.useState(""),{loadedChannelsForAccount:G,isLoading:Q}=F(U),X=(0,a().K8)((()=>A().A.integrations.state.find((e=>e.id===s().zG))),[]),Z=(0,b().O)(),J=n.useCallback((e=>{z?o(e,z.parent_id):k&&o(e,k.id),_||u()}),[o,z,k,u,_]),ee=n.useCallback((()=>{const e=z?z.parent_id:null==k?void 0:k.id;e&&i&&i(e),_&&O||u()}),[z,k,_,O,i,u]),te=V(),oe=n.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,P.jsx)(M().A,{...e,icon:B({channel:o,styles:te.icon}),desktopIconStyle:{width:8},title:o.name,isChecked:!D&&(null==t?void 0:t.some((e=>e.id===o.id)))}),action:()=>{J(o)}}}),[te,D,t,J]),{publicChannels:ne,privateChannels:re,personalChannels:ae,imChannels:ie}=n.useMemo((()=>function(e,t){const o=[],n=[],r=[],a=[];e.sort(((e,t)=>e.name.localeCompare(t.name)));for(const i of e)t&&!t(i)||("public"===i.type?o.push(i):"private"===i.type?n.push(i):"me"===i.type?r.push(i):"im"===i.type?a.push(i):(0,h().HB)(i.type));return{publicChannels:o,privateChannels:n,personalChannels:r,imChannels:a}}(G,f)),[f,G]),le=n.useCallback((()=>ne.map((e=>({menuListItem:oe({channel:e}),channelName:e.name})))),[ne,oe]),se=n.useCallback((()=>re.map((e=>({menuListItem:oe({channel:e}),channelName:e.name})))),[re,oe]),ue=n.useCallback((()=>ae.map((e=>({menuListItem:oe({channel:e}),channelName:e.name})))),[ae,oe]),ce=n.useCallback((()=>ie.map((e=>({menuListItem:oe({channel:e}),channelName:e.name})))),[ie,oe]),pe=n.useCallback((()=>le().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:q}))return t})).filter(h().O9)),[le,q]),de=n.useCallback((()=>se().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:q}))return t})).filter(h().O9)),[se,q]),me=n.useCallback((()=>ue().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:q}))return t})).filter(h().O9)),[ue,q]),ge=n.useCallback((()=>ce().map((e=>{let{menuListItem:t,channelName:o}=e;if(R({channelName:o,query:q}))return t})).filter(h().O9)),[ce,q]),ye=n.useCallback((()=>z?(0,S().qO)(z).organizationName:"Workflows organization"),[z]),he=n.useCallback((()=>{if(!Y)return[];const e=[],t=pe(),o=de(),n=me(),r=ge(),a=O&&_&&!q&&!Q;return a&&e.push({key:"select-all-channels",render:e=>(0,P.jsx)(I().A,{...e}),items:[{key:"all-channels",render:e=>(0,P.jsx)(M().A,{...e,title:(0,P.jsx)(m().sA,{id:"notificationRuleSettings.selectChannelView.selectAllChannels.label",defaultMessage:"All channels"}),isChecked:D}),action:ee}]}),n.length>0&&e.push({key:"personal-channels",render:e=>(0,P.jsx)(I().A,{...e,title:ye(),topBorder:a}),items:n}),t.length>0&&e.push({key:"public-channels",render:e=>(0,P.jsx)(I().A,{...e,topBorder:n.length>0||a,title:0===n.length&&ye()}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,P.jsx)(I().A,{...e,topBorder:t.length>0||a,title:0===n.length&&t.length>0&&ye()}),items:o}),W&&r.length>0&&e.push({key:"im-channels",render:e=>(0,P.jsx)(I().A,{...e,title:(0,P.jsx)(m().sA,{defaultMessage:"Direct Messages with Notion",id:"imChannels.title"})}),items:r}),e}),[Y,pe,de,me,ge,O,_,ee,D,ye,Q,q,W]),fe=(0,C().A)(Q,500,300);if(!Y)return null;const ve=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,P.jsx)("div",{children:(0,P.jsx)(j().Ay,{...e,inputLeft:(0,P.jsx)(j().Zf,{icon:p().q}),inputRight:fe&&(0,P.jsx)(T().A,{style:{marginRight:2}}),showClearButton:!0,placeholder:x().A.formatMessage(w.channelSearchPlaceholder),focusInitial:!K,value:q,onChange:e=>{$(e.target.value)}})})}],render:e=>(0,P.jsx)(I().A,{...e})},...he()];return t||E||!X||ve.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!Z)return;const e=await v().Jq({environment:L,integration:X,spaceId:Z,from:"collection_view_settings"});y().Q.isFail(e)||c()},render:e=>(0,P.jsx)(M().A,{...e,icon:(0,P.jsx)("img",{src:l().A.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,P.jsx)(m().sA,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,P.jsx)(I().A,{...e,topBorder:!0})}),(0,P.jsx)(P.Fragment,{children:d(ve)})}function V(){return(0,i().IS)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.text.tertiary},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[])}function R(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function B(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,c().S)(o):"me"===t.type||"im"===t.type?(0,u().b)(o):(0,d().E)(o)}const E=15e3;function F(e){return(0,a().K8)((()=>{if(!e)return{loadedChannelsForAccount:[],isLoading:!1};const t=k().c.getStateForBot(e);return{loadedChannelsForAccount:Object.values(t.channels),isLoading:t.fetching}}),[e])}async function N(e){const{environment:t,externalAuthConfig:o,spaceId:n}=e,r=k().c.getStateForBot(o);if(!(r.fetching||Date.now()-r.lastRefreshed<E)){if(k().c.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()}),"workflow"===o.type){const e=await f().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:n,cursor:void 0,...o}});if("success"===e.type){const t={};for(const o of e.data.channels)t[o.id]=o;k().c.addChannelsForBot(o,t)}}else{let e;for(;;){const r=await f().callApi({eventName:"getExternalNotificationChannels",environment:t,data:{spaceId:n,cursor:e,...o}});if("success"!==r.type){console.error(r.error);break}{const t={};for(const e of r.data.channels)t[e.id]=e;if(k().c.addChannelsForBot(o,t),e=r.data.cursor,!e)break}await new Promise((e=>setTimeout(e,0)))}}k().c.updateStateForBot(o,{fetching:!1})}}const O=n.forwardRef(((e,t)=>{const{channel:o,currentNotificationChannels:n,...r}=e,a=V();return(0,P.jsx)(M().A,{ref:t,...r,icon:B({channel:o,styles:a.icon}),desktopIconStyle:{width:8},title:o.name,isChecked:null==n?void 0:n.some((e=>e.id===o.id))})}));O.displayName="SlackChannelMenuItem"},629203:(e,t,o)=>{o.d(t,{U:()=>r});var n=()=>o(401497);function r(){return(0,n().IS)((e=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[])}},630550:(e,t,o)=>{o.d(t,{a:()=>x,c:()=>S});o(898992),o(672577);var n=o(296540),r=()=>o(484714),a=()=>o(847249),i=()=>o(959013),l=()=>o(813297),s=()=>o(175116),u=()=>o(862292),c=()=>o(645873),p=()=>o(324587),d=()=>o(546461),m=()=>o(366360),g=()=>o(76190),y=()=>o(813716),h=()=>o(7667),f=()=>o(541172),v=o(474848);function x(e){const{actionId:t,closeMenu:o,propertyId:s}=e,{maybePersistedTransactionActions:y}=(0,m().b)(),{automationStore:x,contextType:S}=(0,d().EC)(),b=(0,r().v3)(),C=(0,i().tz)(),{value:A}=(0,c().fJ)(u().T.formulas),{value:k}=(0,c().fJ)(l().QV.automationTypecheck),M=(0,g().n)(x),j=(0,a().K8)((()=>{const e=x.getActionStores().find((e=>e.id===t));if(null!=e&&e.isDefined())return e}),[x,t]),T=(0,n.useCallback)((()=>{j&&A&&k&&(y.createAndCommit({perform:e=>{p().removeAutomationAction({actionStore:j,automationStore:x,automationTypecheckModule:k,contextType:S,environment:b,formulasModule:A,intl:C,isSubscribed:M,transaction:e})},userAction:"UnsupportedPropertyMenu.removeAction"}),null==o||o())}),[j,x,k,o,S,b,A,C,M,y]),I=(0,h().A)(),P=(0,n.useMemo)((()=>()=>{I&&I(s),null==o||o()}),[o,I,s]);return(0,v.jsx)(f().Ol,{onDelete:T,onRestore:P,stepType:"action"})}function S(e){const{closeMenu:t,propertyId:o}=e,r=(0,s().Ks)(),{removePropertyTrigger:i}=(0,y().p)(),l=(0,a().K8)((()=>null==r?void 0:r.settingsStore),[r]),u=(0,a().K8)((()=>{const e=null==r?void 0:r.collectionStore();return Boolean(!(null!=e&&e.getSchema()[o]))&&Boolean(!(null!=e&&e.getDeletedSchema()[o]))}),[r,o]),c=(0,n.useCallback)((()=>{i(o),null==t||t()}),[t,o,i]),p=(0,h().A)(),d=(0,n.useMemo)((()=>()=>{l&&!u&&(p&&p(o),null==t||t())}),[t,l,p,u,o]);return(0,v.jsx)(f().Ol,{onDelete:c,onRestore:d,stepType:"trigger"})}},656134:(e,t,o)=>{o.d(t,{j:()=>i});var n=()=>o(484714),r=()=>o(847249),a=()=>o(897119);function i(e){const t=(0,n().Y0)();return(0,r().K8)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?a().nl.SlideUp:a().nl.Popup),[t,null==e?void 0:e.tabletBehavior])}},656476:(e,t,o)=>{o.d(t,{rD:()=>v,zH:()=>f});var n=o(296540),r=()=>o(401497),a=()=>o(791089),i=()=>o(834368),l=()=>o(486521),s=()=>o(263178),u=()=>o(959013),c=()=>o(284371),p=()=>o(340743),d=()=>o(214973),m=()=>o(741310),g=()=>o(929531),y=()=>o(16707),h=o(474848);function f(e){const{actionMenu:t,buttonPopupStore:o,disabled:f,onClick:x,propertySchema:S,value:b}=e,C=(0,r().IS)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...c().RC,fontWeight:c().Wy.medium}})),[]),A=function(e){const{propertySchema:t,styles:o,value:n}=e,r=(0,h.jsx)("span",{style:o.propertyName,children:t.name});let s;const c="formula"===(null==n?void 0:n.type);if(c)s=(0,h.jsx)(y().g,{returnType:{type:"checkbox"}});else{const e=(0,a().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0],t=!0===e?(0,l().v)({width:12}):(0,i().K)({width:10});s=(0,h.jsx)(p().G,{icon:t,shouldTruncateChildren:!0,children:!0===e?(0,h.jsx)(u().sA,{...d().CV.actionCheckboxPropertyChecked}):(0,h.jsx)(u().sA,{...d().CV.actionCheckboxPropertyUnchecked})})}return(0,h.jsx)(u().sA,{...d().Xr({propertyName:r,propertyValue:s})})}({propertySchema:S,styles:C,value:b}),k=v({propertySchema:S,value:b}),M=(0,n.useCallback)((e=>(0,h.jsx)(g().aX,{...e,actionMenu:t,buttonPopupStore:o,disabled:f,icon:s().S,onClick:x,children:(0,h.jsx)("div",{style:C.content,children:A})})),[t,o,f,x,C.content,A]);return(0,h.jsx)(m().P,{renderOrigin:M,title:k})}function v(e){const{propertySchema:t,value:o}=e;let n;if("formula"===(null==o?void 0:o.type))n=(0,h.jsx)(y().L,{});else{n=!0===(0,a().fromSimpleFormulaArrayValue)(null==o?void 0:o.value)[0]?(0,h.jsx)(u().sA,{...d().CV.actionCheckboxPropertyChecked}):(0,h.jsx)(u().sA,{...d().CV.actionCheckboxPropertyUnchecked})}return(0,h.jsx)(u().sA,{...d().Xr({propertyName:t.name,propertyValue:n})})}},674300:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var n=()=>o(784892),r=()=>o(977345),a=()=>o(919709),i=()=>o(534177),l=()=>o(684125),s=o(474848);function u(e){let{formulaTypecheckContextValues:t,handleRemoveToken:o,isDisabled:u,token:c,style:p,iconSize:d,preventOnClickPropagation:m}=e;const g=(0,a().iVq)(c).id,y=(0,i().O9)(t)?(0,r().IV)(t,g):void 0;return y?(0,s.jsx)(l().F,{value:y,format:n().NY.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!u,style:p,onClickRemove:e=>{m&&(null==e||e.stopPropagation()),o(c,e)}}):null}},678350:(e,t,o)=>{o.d(t,{U:()=>A});o(296540);var n=()=>o(484714),r=()=>o(847249),a=()=>o(401497),i=()=>o(791089),l=()=>o(284371),s=()=>o(548526),u=()=>o(963589),c=()=>o(463830),p=()=>o(406699),d=()=>o(897119),m=()=>o(999638),g=()=>o(413194),y=(o(581454),()=>o(959013)),h=()=>o(534177),f=()=>o(905209),v=()=>o(419830),x=()=>o(742971),S=o(474848);function b(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:n,formulaTypecheckContextValues:r,parentRecordStore:i,placeholder:l,spaceId:s,type:u,value:c}=e,p=(0,a().IS)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),d=(0,v().pg)(t);if("formula"===(null==c?void 0:c.type)&&c.value)return(0,S.jsx)(f().$,{formulaTypecheckContextValues:r??[],parentRecordStore:i,spaceId:s,value:c});if("text"===u.type||"number"===u.type)return null;if("date"===u.type||"select"===u.type||"checkbox"===u.type){const e=o[0];return void 0===e?(0,S.jsx)(C,{placeholder:l}):(0,S.jsx)("div",{style:p.tokenWrap,children:(0,S.jsx)(g().g,{token:e,parentRecordStore:i,disabled:n,currentSimpleFormulaValueTokens:o,context:t})})}return"person_array"===u.type||"block_array"===u.type||"select_array"===u.type?0===o.length?(0,S.jsx)(C,{placeholder:l}):(0,S.jsx)("div",{style:p.tokenWrap,children:d(o,"first").map(((e,r)=>(0,S.jsx)(g().g,{token:e,parentRecordStore:i,disabled:n,currentSimpleFormulaValueTokens:o,context:t},r)))}):void(0,h().HB)(u)}function C(e){const{placeholder:t}=e,o=(0,a().IS)((e=>({placeholderText:{color:e.text.tertiary}})),[]);return(0,S.jsx)("div",{style:o.placeholderText,children:t?(0,S.jsx)(y().sA,{defaultMessage:"{placeholder}",values:{placeholder:t},id:"formulas.SimpleFormulaValuePicker.people.customPlaceholder"}):(0,S.jsx)(y().sA,{...x().D.personSelect})})}function A(e){const{allowedReturnTypes:t,disabled:o,disableEmojiCommands:y,disableFormattingAndMentions:h,disableMobileActionBar:f,disableTemplateVariableMentions:v,errorMessage:x,formulaTypecheckContextValues:C,limit:A,menuProps:k,onChange:M,parentRecordStore:j,placeholder:T,showClearButton:I,showInputMenuItem:P,simpleFormulaContext:w,spaceId:_,style:V,type:R,value:B}=e,E=(0,n().Y0)(),F=!B||"simple"===B.type,N=(0,r().K8)((()=>(0,i().fromSimpleFormulaArrayValue)(null==B?void 0:B.value)),[B]),O=(0,u().X)("collections_xws"),D=(0,a().IS)((e=>({button:{boxShadow:e.inputBoxShadow,flexGrow:1,flexShrink:1,fontSize:"inherit",fontWeight:l().Wy.regular,...V}})),[V]),W=(0,r().uB)(void 0,c().A),L=O?"cross_space_and_read_permissions":"read_permissions_only";return(0,S.jsx)(p().Ay,{alignmentToOrigin:p().yP.End,buttonPopupStore:W,disabled:o,originGap:0,placementToOrigin:p().sx.Bottom,popupType:E.isMobile?d().nl.SlideUp:d().nl.Popup,renderOrigin:e=>(0,S.jsx)(s().x,{...e,disabled:o,hasActionRequired:!Boolean(N.length>0),isError:Boolean(x),style:D.button,tooltipMessage:x,dropdownButtonType:"button",children:(0,S.jsx)(b,{currentSimpleFormulaValueTokens:N,context:w,disabled:!0,formulaTypecheckContextValues:C,parentRecordStore:j,placeholder:T,spaceId:_,type:R,value:B})}),render:e=>F?(0,S.jsx)(g().L,{currentSimpleFormulaValueTokens:N,disableEmojiCommands:y,disableFormattingAndMentions:h,disableMobileActionBar:f,disableTemplateVariableMentions:v,formulaTypecheckContextValues:C,formulaValueContext:w,limit:A,menuProps:k,onChange:M,onClose:e.close,parentRecordStore:j,showClearButton:I,showInputMenuItem:P,type:R,value:B}):(0,S.jsx)(m().A,{allowedReturnTypes:t,disabled:o,formulaTypecheckContextValues:C,onChange:M,onClose:e.close,parentRecordStore:j,restrictUnaccessibleProperties:L,spaceId:_,value:B})})}},684125:(e,t,o)=>{o.d(t,{F:()=>p});o(296540);var n=()=>o(401497),r=()=>o(494379),a=()=>o(247331),i=()=>o(977345),l=()=>o(534177),s=()=>o(931077),u=()=>o(848401),c=o(474848);function p(e){const{value:t,style:o}=e,p=(0,n().DP)(),d=e.iconStyle??{width:12,height:12,marginRight:4},m=(0,i().sM)(t);let g;if(t.kind===a().FormulaContextValueKind.ContextValue&&(0,l().O9)(t.stepNumberForDisplay)){const e=t.stepNumberForDisplay;g=()=>(0,c.jsx)(s().Q,{size:r().H.ExtraSmall,number:e,style:{marginRight:4}})}else{const e=(0,i().Ix)(t.type);if(e){const t=e;g=()=>t(d)}}return(0,c.jsx)(u().Ay,{...e,title:m,renderAvatar:g,shouldShrink:!0,style:{background:p.outlineBlueButtonPressedBackground,color:p.blueColor,padding:"2px 4px",margin:0,...o}})}},686169:(e,t,o)=>{o.d(t,{w:()=>ke,J:()=>Me});var n=o(296540),r=()=>o(847249),a=()=>o(977345),i=()=>o(546461),l=(o(16280),o(898992),o(354520),()=>o(484714)),s=()=>o(401497),u=()=>o(81768),c=()=>o(310109),p=()=>o(289915),d=()=>o(329199),m=()=>o(784892),g=()=>o(959013),y=()=>o(534177),h=()=>o(284371),f=()=>o(246826),v=()=>o(751156),x=()=>o(895876),S=()=>o(406699),b=()=>o(16006),C=()=>o(684125),A=()=>o(989423),k=()=>o(726483),M=()=>o(963589),j=()=>o(463830),T=()=>o(630116),I=()=>o(653417),P=()=>o(301782),w=()=>o(366360),_=()=>o(133518),V=()=>o(656134),R=()=>o(475679),B=()=>o(95199),E=()=>o(548526),F=()=>o(194373),N=()=>o(929531),O=()=>o(497222),D=()=>o(870988),W=()=>o(44935),L=()=>o(928600),K=()=>o(89924),H=()=>o(175116),z=()=>o(781697),U=o(474848);function Y(e){const{filter:t,onChange:o,onClose:a,collectionStore:i}=e,l=(0,H().Ks)(),s=(0,r().K8)((()=>i.getSchema()),[i]),u=(0,z().e)({minWidth:300,tabletBehavior:"actionSheet"}),c=(0,n.useCallback)(((e,t)=>o(t)),[o]),d=(0,n.useCallback)((()=>{o(void 0),a()}),[o,a]);return l?(0,U.jsxs)(L().A,{...u,children:[(0,U.jsx)(W().i,{children:(0,U.jsx)(D().tY,{collectionViewId:"Automation.FilterMenu",collectionContextStore:l,collectionViewType:"table",combinatorFilter:t||p().AY,index:0,level:0,onChange:c,parentStore:i,schema:s})}),(0,U.jsx)(K().A,{topBorder:!0,children:(0,U.jsx)(O().A,{title:(0,U.jsx)(g().sA,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:d})})]}):null}const q=(0,g().YK)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function $(e){const{actionStore:t}=e,o=(0,l().v3)(),{automationStore:a,typecheckResult:s}=(0,i().EC)(),{disabled:p,suppressActionErrors:m}=(0,w().b)(),h=(0,M().X)("automation_updated_error_states"),x=(0,r().K8)((()=>t.getTargetStore()),[t]),S=(0,r().K8)((()=>J(t,(0,c().getAllContextValues)(s))),[t,s]),b=(0,r().K8)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,d().SK)(n,(null==S?void 0:S.getSchema())||{})}),[t,S]),C=(0,r().K8)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),A=(0,r().K8)((()=>{if(!C||"variable"!==C.type)return!1;const e=(0,c().getContextValueForActionById)(s,t.id,C.id),o=null==e?void 0:e.type;return!!o&&("block"===o.type||"array"===o.type&&"block"===o.of.type)}),[t.id,C,s]),T=(0,r().uB)(void 0,j().A),_=(0,n.useCallback)((()=>T.reset()),[T]),V=(0,n.useMemo)((()=>(0,U.jsx)(R().z,{actionStore:t,closeMenu:_})),[t,_]),E=(0,n.useMemo)((()=>!m.includes(t.id)),[m,t]),F=(0,r().K8)((()=>{if(S&&h)return E&&!(0,k().bI)({actionStore:t,collectionStore:S,typecheckResult:s})?(0,U.jsx)(g().sA,{...I().automationErrorMessages.actionIncompleteErrorMessage}):void 0}),[t,S,h,E,s]),{errorMessage:O,errorIcon:D}=(0,I().useErrorComponentForAction)({actionId:t.id,shouldShow:E,errorKeys:["target","collection","block"]}),{errorMessage:W,errorIcon:L}=(0,I().useErrorComponentForAction)({actionId:t.id,errorKey:"filter",shouldShow:E}),K=(0,r().K8)((()=>(0,y().O9)(t.getConfigStore().getKeyStore("target").getValue())),[t]),H=(0,n.useCallback)((e=>{v().createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:o,canUndo:!0,perform:t=>{f().zv({data:{filter:e},store:x,transaction:t})}}),(0,P().UB)(o,{automationStore:a,automationActionStore:t})}),[t,a,o,x]),z=(0,n.useCallback)((e=>{let n;if("collection"===e.type)n="UpdatePageAction.updateCollection";else if("variable"===e.type)n="UpdatePageAction.updateVariable";else{if("page"===e.type||"property"===e.type||"formula"===e.type||"url"===e.type)throw new Error("Not implemented yet.");(0,y().HB)(e)}v().createAndCommit({userAction:n,environment:o,canUndo:!0,perform:o=>{f().zv({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}}),(0,P().UB)(o,{automationStore:a,automationActionStore:t})}),[o,a,t]),Y=Boolean(p),q=(0,u().getActionRegistryItem)("update_pages");return(0,U.jsxs)(N().OT,{actionMenu:V,buttonPopupStore:T,disabled:Y,actionId:t.id,canCollapse:K,children:[(0,U.jsx)(N().h3,{actionId:t.id,actionRegistryItem:q,disabled:Y,styles:{headerWrap:{paddingRight:32},titleWrap:{display:"grid",gridTemplateColumns:"auto 1fr"}},errorMessage:h?O||W||F:void 0,children:A||!S?(0,U.jsx)(G,{actionStore:t,disabled:Y,errorMessage:O,errorIcon:D,onTargetChange:z,value:C}):(0,U.jsx)(Q,{actionStore:t,collectionStore:S,disabled:Y,errorMessage:O,errorIcon:D,filterErrorIcon:L,filterErrorMessage:W,filter:b,onFilterChange:H,onTargetChange:z,value:C})}),S&&(0,U.jsx)(N().qt,{disabled:Y,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,U.jsx)(B().Ud,{actionStore:t,collectionStore:S,disabled:Y,showSetPropertyActions:!0})})]})}function G(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:r,value:a,errorIcon:i}=e,l=(0,M().X)("automation_updated_error_states"),u=(0,s().IS)((()=>({b:{fontWeight:h().Wy.medium},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsx)("div",{style:u.title,children:(0,U.jsx)(g().sA,{...q.singleTarget,values:{b:e=>(0,U.jsx)("b",{style:u.b,children:e}),targetPicker:(0,U.jsx)(Z,{actionStore:t,disabled:o,errorMessage:n,errorIcon:l?i:void 0,onChange:r,value:a}),span:e=>(0,U.jsx)("span",{style:u.span,children:e})}})})}function Q(e){const{actionStore:t,collectionStore:o,disabled:n,errorMessage:r,errorIcon:a,filterErrorMessage:i,filterErrorIcon:l,filter:u,onFilterChange:c,onTargetChange:p,value:d}=e,m=(0,s().IS)((()=>({span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{style:m.title,children:[(0,U.jsx)(g().sA,{...q.multipleTargetsFilter,values:{filterPicker:(0,U.jsx)(X,{collectionStore:o,disabled:n,errorMessage:i,errorIcon:l,filter:u,onChange:c}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})," "]}),(0,U.jsx)("div",{style:m.title,children:(0,U.jsx)(g().sA,{...q.multipleTargetsPicker,values:{targetPicker:(0,U.jsx)(Z,{actionStore:t,disabled:n,errorMessage:r,errorIcon:a,onChange:p,value:d}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})})]})}function X(e){var t;const{collectionStore:o,disabled:a,errorMessage:i,filter:l,onChange:s,errorIcon:u}=e,c=(0,r().uB)(void 0,j().A),d=(0,V().j)({tabletBehavior:"slideUp"}),m=(0,n.useCallback)((()=>c.reset()),[c]),y=(0,r().K8)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,x().oj)(t)}),[o]),h=(null==l||null===(t=l.filters)||void 0===t?void 0:t.length)||0;return(0,U.jsx)(S().Ay,{alignmentToOrigin:S().yP.Center,disabled:a,originGap:0,placementToOrigin:S().sx.Bottom,popupType:d,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:a,isCompact:!0,errorIcon:u,onClick:t=>{e.onClick(t),0===h&&s(p().Lx)},dropdownButtonType:"dropdown",isError:Boolean(i),tooltipMessage:i,children:h>0?(0,U.jsx)(g().sA,{defaultMessage:"{itemType} that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{itemType:y,ruleCount:h}}):(0,U.jsx)(g().sA,{defaultMessage:"all {itemType}",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{itemType:y}})}),render:()=>(0,U.jsx)(Y,{collectionStore:o,disabled:a,filter:l,onChange:s,onClose:m})})}function Z(e){const{actionStore:t,disabled:o,errorMessage:a,onChange:s,value:u,errorIcon:p}=e,d=(0,l().v3)(),{automationStore:h,typecheckResult:f}=(0,i().EC)(),v=(0,_().F)({actionId:t.id}),x=(0,r().K8)((()=>{if("collection"===(null==u?void 0:u.type))return T().md.createChildStore(t,u.collection)}),[t,u]),k=(0,r().K8)((()=>{if(f&&u&&"variable"===u.type)return(0,c().getContextValueForActionById)(f,t.id,u.id)}),[f,u,t.id]),I=(0,r().uB)(void 0,j().A),w=(0,V().j)(),R=(0,n.useCallback)((()=>I.reset()),[I]),B=(0,n.useCallback)((e=>{s(e),R(),(0,P().CM)(((o,n,r)=>{const a=(0,P().zc)({automationActionStore:t,formulasModule:o,formulaAnalyticsModule:n,simpleFormulasModule:r});(0,y().O9)(a)&&(0,A().u4)({environment:d,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})}))}),[s,R,t,d]),N=(0,M().X)("automation_updated_error_states");return(0,U.jsx)(S().Ay,{buttonPopupStore:I,popupType:w,alignmentToOrigin:S().yP.Center,placementToOrigin:S().sx.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:o,isCompact:!0,isError:Boolean(a),tooltipMessage:!N&&a,errorIcon:p,hasActionRequired:!Boolean(u||k),dropdownButtonType:"dropdown",children:(0,y().O9)(x)?(0,U.jsx)(b().A,{store:x,style:{paddingBlock:1}}):k?(0,U.jsx)(C().F,{format:m().NY.Medium,isSingle:!0,value:k,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,U.jsx)(g().sA,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})}),render:e=>(0,U.jsx)(F()._,{formulaTypecheckContextValues:v,onChange:B,onClose:R,parentRecordStore:h,selectedTarget:u,skipPages:!0})})}function J(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return T().md.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=(0,a().IV)(t,o.id);if(n)return(0,k().A8)(n,e)}else{if("page"===o.type)return;(0,y().HB)(o)}}}var ee=()=>o(422540),te=()=>o(352271),oe=()=>o(970013),ne=()=>o(542339),re=()=>o(656476),ae=()=>o(541172),ie=()=>o(217028);function le(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertySchema:a}=e,i=(0,s().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=function(e){const{propertySchema:t,styles:o}=e,n=t.name;return(0,U.jsx)(g().sA,{defaultMessage:"{propertyName} is a cross-workspace relation",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.title",values:{propertyName:(0,U.jsx)("span",{style:o.propertyType,children:n})}})}({propertySchema:a,styles:i}),u=function(e){const{propertySchema:t}=e,o=t.name;return(0,U.jsx)(g().sA,{defaultMessage:"{propertyName} is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.text",values:{propertyName:o}})}({propertySchema:a});return(0,U.jsx)(ie().z$,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertyType:a.type,styles:i,tooltip:u,children:l})}function se(e){const{actionId:t,renderOrigin:o}=e,a=(0,V().j)(),i=(0,r().uB)(void 0,j().A),l=(0,n.useCallback)((()=>i.reset()),[i]);return(0,U.jsx)(S().Ay,{buttonPopupStore:i,popupType:a,render:()=>(0,U.jsx)(ae().qM,{actionId:t,closeMenu:l}),renderOrigin:o})}var ue=()=>o(307159),ce=()=>o(984714),pe=()=>o(347114),de=(o(581454),()=>o(234194)),me=()=>o(397785),ge=()=>o(741310);function ye(e){const{action:t,actionMenu:o,buttonPopupStore:r,disabled:a,onClick:l,propertySchema:s,value:u}=e,{automationStore:p,typecheckResult:d}=(0,i().EC)(),m=(0,n.useMemo)((()=>(0,c().getAllContextValues)(d)),[d]),{title:g,tooltipTitle:y,styles:h}=(0,me().oG)({getRecordModel:p.getRecordModel,contextValues:m,messageType:"action",operator:t,propertySchema:s,value:u}),f=(0,n.useCallback)((e=>(0,U.jsx)(N().aX,{...e,actionMenu:o,buttonPopupStore:r,disabled:a,icon:de().M,onClick:l,children:(0,U.jsx)("div",{style:h.content,children:g})})),[o,r,a,l,h.content,g]);return(0,U.jsx)(ge().P,{renderOrigin:f,title:y})}var he=()=>o(365683),fe=()=>o(457050);function ve(e){const{action:t,actionMenu:o,automationActionStore:r,buttonPopupStore:a,collectionStore:i,disabled:l,onClick:s,propertySchema:u,value:c}=e,p=(0,_().F)({actionId:r.id}),{tooltipTitle:d,title:m}=(0,fe().xL)({automationContextValues:p,collectionStore:i,messageType:"action",operator:t,propertySchema:u,value:c}),g=(0,n.useCallback)((e=>(0,U.jsx)(N().aX,{...e,actionMenu:o,buttonPopupStore:a,disabled:l,icon:he().H,onClick:s,children:m})),[o,a,l,s,m]);return(0,U.jsx)(ge().P,{renderOrigin:g,title:d})}var xe=()=>o(3867),Se=()=>o(237985),be=()=>o(359186);function Ce(e){var t;const{actionStore:o}=e,{disabled:a}=(0,w().b)(),[i,l]=(0,r().K8)((()=>[o.id,o.getConfig()]),[o]),s=(0,_().F)({actionId:i}),u=(0,r().K8)((()=>J(o,s)),[o,s]),c=(0,r().K8)((()=>null==u?void 0:u.getSchema()),[u]),p=(0,r().K8)((()=>null==u?void 0:u.getDeletedSchema()),[u]),d=(0,r().uB)(void 0,j().A),m=(0,n.useCallback)((()=>d.reset()),[d]),g=(0,n.useMemo)((()=>(0,U.jsx)(R().z,{actionStore:o,closeMenu:m})),[o,m]),y=(0,M().X)("collections_xws"),h=((null==l?void 0:l.properties)??[])[0],f=null==c?void 0:c[h],v=null==p?void 0:p[h],x=null==l||null===(t=l.values)||void 0===t?void 0:t[h],S=Boolean(a),b={automationActionStore:o,actionMenu:g,buttonPopupStore:d,disabled:S,value:null==x?void 0:x.value};return!f&&v?(0,U.jsx)(ce().sF,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(ce().vu,{...e,...b,propertySchema:v})}):f||v?f&&u?(0,ee().I3)(f)?"person"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(ye,{...e,...b,propertySchema:f,action:(0,te().tz)(x)})}):"status"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(Se().II,{...e,...b,propertySchema:f})}):"select"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(xe().w$,{...e,...b,propertySchema:f})}):"multi_select"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(pe().j,{...e,...b,propertySchema:f,action:(0,te().tz)(x)})}):"date"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(ue().m,{...e,...b,propertySchema:f,valueContext:{collectionStore:u,property:h,type:"collection"}})}):"relation"===f.type&&y&&(0,oe().o2)(u.pointer.spaceId,f)?(0,U.jsx)(se,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(le,{...e,...b,propertySchema:f})}):"relation"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(ve,{...e,...b,collectionStore:u,propertySchema:f,action:(0,te().tz)(x)})}):"checkbox"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(re().zH,{...e,...b,propertySchema:f})}):"title"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().EJ,{...e,...b,propertySchema:f})}):"text"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().Zd,{...e,...b,propertySchema:f})}):"email"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().ef,{...e,...b,propertySchema:f})}):"url"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().Vj,{...e,...b,propertySchema:f})}):"number"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().T7,{...e,...b,propertySchema:f})}):"phone_number"===f.type?(0,U.jsx)(Ae,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(be().Jx,{...e,...b,propertySchema:f})}):null:(0,U.jsx)(ie().gI,{actionId:o.id,propertyId:h,renderOrigin:e=>(0,U.jsx)(ie().RY,{...e,...b,propertySchema:f})}):null:(0,U.jsx)(ce().sF,{actionId:o.id,renderOrigin:e=>(0,U.jsx)(ce().qR,{...e,...b})})}function Ae(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,V().j)(),l=(0,r().uB)(void 0,j().A),s=(0,n.useCallback)((()=>l.reset()),[l]),u=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,U.jsx)(S().Ay,{buttonPopupStore:l,popupType:i,render:()=>(0,U.jsx)(ne().A,{initialState:u,onClose:s}),renderOrigin:a})}function ke(e){const{actionStore:t}=e,{contextType:o}=(0,i().YC)();return(0,r().K8)((()=>Me(o,t)),[t,o])?(0,U.jsx)(Ce,{...e}):(0,U.jsx)($,{...e})}function Me(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),r="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,a().y5)(n.target.id):void 0;return"event"===e&&r&&"global"===r.source&&"button_page"===r.global}},741310:(e,t,o)=>{o.d(t,{P:()=>s});var n=o(296540),r=()=>o(401497),a=()=>o(859428),i=()=>o(962730),l=o(474848);function s(e){const{caption:t,disable:o,renderOrigin:s,title:u,tooltipAlignment:c,tooltipPlacement:p,disableTooltip:d}=e,m=(0,r().IS)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.text.contrastSecondary,margin:0}})),[]),g=(0,n.useCallback)((()=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{style:m.tooltipTitle,children:u}),(0,l.jsx)("p",{style:m.tooltipCaption,children:t})]})),[t,u,m.tooltipCaption,m.tooltipTitle]);return(0,l.jsx)(a().A,{alignment:c||i().C.Center,delayThreshold:800,disableTooltip:o||d,placement:p||i().W.Bottom,render:s,renderTooltip:g,textWrap:!0})}},742971:(e,t,o)=>{o.d(t,{D:()=>n});const n=(0,o(959013).YK)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},propertyValuePlaceholder:{defaultMessage:"Enter a value",id:"formulas.SimpleFormulaValuePicker.general.propertyValuePlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},798941:(e,t,o)=>{o.d(t,{VW:()=>g,aR:()=>m});o(296540);var n=()=>o(847249),r=()=>o(401497),a=()=>o(784892),i=()=>o(959013),l=()=>o(534177),s=()=>o(284371),u=()=>o(881690),c=()=>o(214973),p=()=>o(574299),d=o(474848);function m(e){const{numberValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().tz)(),f=(0,r().IS)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().RC,fontWeight:s().Wy.medium},propertyValue:{...s().RC,paddingBlockStart:4}})),[]),v=(0,n().K8)((()=>function(e){const{numberValue:t,operator:o,propertySchema:n,styles:r,messageType:s,intl:m}=e,g=(0,d.jsx)("span",{style:r.propertyName,children:n.name});let y;const h=m.formatMessage(p().$R[o].text).toLocaleLowerCase();"action"===s?y=c().vC({propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):"trigger"===s?y=c().Rn({propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1,style:{flex:"none"}}),operator:h}):(0,l().HB)(s);return(0,d.jsx)(i().sA,{...y})}({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m,styles:f})),[y,t,o,m,f,h]);return{tooltipTitle:(0,n().K8)((()=>g({intl:h,messageType:y,numberValue:t,operator:o,propertySchema:m})),[h,y,t,o,m]),title:v,styles:f}}function g(e){const{numberValue:t,operator:o,propertySchema:n,messageType:r,intl:a}=e,s=n.name;let u;const m=a.formatMessage(p().$R[o].text).toLocaleLowerCase();return"action"===r?u=c().vC({propertyName:s,propertyValues:t,operator:m}):"trigger"===r?u=c().Rn({propertyName:s,propertyValues:t,operator:m}):(0,l().HB)(r),(0,d.jsx)(i().sA,{...u})}},813716:(e,t,o)=>{o.d(t,{p:()=>b});o(944114),o(898992),o(354520),o(672577),o(581454),o(737550);var n=o(296540),r=()=>o(484714),a=()=>o(390527),i=()=>o(970013),l=()=>o(206267),s=()=>o(959013),u=()=>o(534177),c=()=>o(813297),p=()=>o(246826),d=()=>o(751156),m=()=>o(862292),g=()=>o(989423),y=()=>o(726483),h=()=>o(645873),f=()=>o(324587),v=()=>o(366360),x=()=>o(76190);const S="all";function b(){const{automationStore:e,collectionStore:t,maybePersistedTransactionActions:o}=(0,v().k)(),{value:b}=(0,h().fJ)(c().QV.automationTypecheck),{value:A}=(0,h().fJ)(m().T.formulas),k=(0,r().v3)(),M=(0,s().tz)(),j=(0,x().n)(e),T=(0,n.useMemo)((()=>({automation_id:e.id,collection_id:t.id,builder_type:"modal"})),[e.id,t.id]),I=(0,n.useCallback)((()=>{var t;if(e.isTriggerType("recurrence"))return{currentPropertyTriggers:[],triggerOperator:S};const o=null===(t=e.getTrigger())||void 0===t?void 0:t.event.pagePropertiesEdited,n="some"===(null==o?void 0:o.type)&&o.some,r="all"===(null==o?void 0:o.type)&&o.all,a=(null==o?void 0:o.type)||"some";return n||r?{currentPropertyTriggers:n||r||[],triggerOperator:a}:{currentPropertyTriggers:[],triggerOperator:a}}),[e]),P=(0,n.useCallback)((function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,r=n||S;("none"===n||"any"===n&&t.length>0)&&(r=S),o.createAndCommit({userAction:"automations.removePropertyTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:0===t.length?{type:"none"}:{type:r,[r]:t}}},transaction:o})}})}),[e,o]),w=(0,n.useCallback)((t=>{const{currentPropertyTriggers:n}=I();o.createAndCommit({userAction:"automations.updatePropertyTriggerOperator",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:t,[t]:n}}},transaction:o})}})}),[e,I,o]);return{addPropertyTrigger:(0,n.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:n}=I();P([...o,e],n);const r=t.getSchema()[e.property];(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:n,property_types:null!=r&&r.type?[r.type]:[],property_configs:(0,u().O9)(e.filter.operator)&&(0,u().O9)(null==r?void 0:r.type)?[{operator:e.filter.operator,type:null==r?void 0:r.type}]:[]},...T}}})}),[T,t,k,I,P]),updatePropertyTrigger:(0,n.useCallback)((e=>{const{anyOptionCheckState:o,propertyId:n,currentFilter:r,propertySchema:a}=e,{currentPropertyTriggers:l,triggerOperator:s}=I();P((()=>{switch(o){case"partial":return C(l,(e=>e.property===n),(e=>({...e,filter:r})),{property:n,filter:r});case!0:return C(l,(e=>e.property===n),(e=>({...e,filter:{operator:"changes_to_any"}})),{property:n,filter:{operator:"changes_to_any"}});case!1:return(0,i().sS)(a)?C(l,(e=>e.property===n),(e=>({...e,filter:r})),{property:n,filter:r}):l.filter((e=>e.property!==n))}})(),s);const c=t.getSchema()[n];(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:s,property_types:null!=c&&c.type?[c.type]:[],property_configs:(0,u().O9)(r.operator)&&(0,u().O9)(null==c?void 0:c.type)?[{operator:r.operator,type:null==c?void 0:c.type}]:[]},...T}}})}),[T,t,k,I,P]),removePropertyTrigger:(0,n.useCallback)((e=>{const{currentPropertyTriggers:o,triggerOperator:n}=I();P(o.filter((t=>t.property!==e)),n);const r=t.getSchema()[e],a=o.find((t=>t.property===e));(0,g().u4)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:n,property_types:null!=r&&r.type?[r.type]:[],property_configs:(0,u().O9)(a)&&(0,u().O9)(a.filter.operator)&&(0,u().O9)(null==r?void 0:r.type)?[{operator:a.filter.operator,type:null==r?void 0:r.type}]:[]},...T}}})}),[T,t,k,I,P]),addPageAddedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.addPageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!0}},transaction:t})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"page"},...T}}})}),[T,e,k,o]),removePageAddedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removePageAddedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagesAdded:!1}},transaction:t})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"page"},...T}}})}),[T,e,k,o]),addAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.addAnyPagePropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{pagePropertiesEdited:{type:"any"}}},transaction:t})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"property",condition:"any"},...T}}})}),[T,e,k,o]),removeAnyPropertyEditedTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeAnyPropertyEditedTrigger",perform:t=>{d().applyOperation({store:e,operation:{path:["trigger","event"],args:{pagePropertiesEdited:{type:"none"}},pointer:e.pointer,command:"update"},transaction:t})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"property",condition:"any"},...T}}})}),[T,e,k,o]),updateTriggerOperator:w,addEmptyRecurrenceTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.addEmptyRecurrenceTrigger",perform:t=>{p().KY({transaction:t,store:e.getKeyStore("trigger"),value:{type:"recurrence",id:l().JW()}}),b&&A&&(0,f().clearInvalidVariables)({environment:k,automationStore:e,automationTypecheckModule:b,contextType:"recurrence",formulasModule:A,intl:M,isSubscribed:j,transaction:t}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"recurrence"},...T}}})}})}),[e,b,A,M,o,T,k,j]),changeRecurrenceSchedule:(0,n.useCallback)((t=>{o.createAndCommit({userAction:"automations.changeRecurrenceSchedule",perform:o=>{p().zv({store:e.getKeyStore("trigger"),data:{recurrence:t?(0,a().convertFromUnpersistedRecurrenceConfig)(t):void 0},transaction:o})}})}),[e,o]),removeRecurrenceTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeRecurrenceTrigger",perform:o=>{p().KY({transaction:o,store:e.getKeyStore("trigger"),value:{type:"event",id:l().JW(),event:(0,y().B0)(t)}})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"recurrence"},...T}}})}),[T,e,t,k,o]),removeRelativeDateTrigger:(0,n.useCallback)((()=>{o.createAndCommit({userAction:"automations.removeRelativeDateTrigger",perform:t=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{relativeDate:void 0}},transaction:t})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_delete",eventProperties:{automation_trigger:{type:"relative_date"},...T}}})}),[T,e,k,o]),addRelativeDateTrigger:(0,n.useCallback)((t=>{o.createAndCommit({userAction:"automations.addRelativeDateTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{relativeDate:{property:t.propertyId,offset:{type:"days",hours:0}}}},transaction:o})}}),(0,g().u4)({environment:k,event:{eventName:"automation_trigger_create",eventProperties:{automation_trigger:{type:"relative_date"},...T}}})}),[T,e,k,o]),updateRelativeDateTrigger:(0,n.useCallback)((t=>{o.createAndCommit({userAction:"automations.updateRelativeDateTrigger",perform:o=>{d().applyOperation({store:e,operation:{pointer:e.pointer,command:"update",path:["trigger","event"],args:{relativeDate:{property:t.propertyId,offset:t.offset}}},transaction:o})}})}),[e,o])}}function C(e,t,o,n){let r=!1;const a=e.map((e=>t(e)?(r=!0,o(e)):e));return r||a.push(n),a}},829e3:(e,t,o)=>{o.d(t,{c:()=>i,m:()=>r});function n(e){switch(e.type){case"external":return`external-${e.botId}`;case"workflow":return`workflow-${e.workflowExternalAuthenticationId}`;case"universal":return`universal-${e.app}-${e.spaceId}`;default:throw(0,o(534177).HB)(e)}}const r={channels:{},fetching:!1,lastRefreshed:0};class a extends(()=>o(757695))().default{getStateForBot(e){const t=n(e);return this.state[t]??r}updateStateForBot(e,t){this.setState({...this.state,[n(e)]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[n(e)]:{...o,channels:{...o.channels,...t}}})}}const i=new a;(0,o(604341).exposeDebugValue)("ExternalNotificationChannelsStore",i)},858163:(e,t,o)=>{o.d(t,{W:()=>l});var n=o(296540),r=()=>o(973647),a=()=>o(217827),i=()=>o(546461);function l(e){const t=(0,i().YC)();return{onTextStoreSelect:(0,n.useMemo)((()=>{if(t.defined&&r().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:r}=t;return function(){a().A.focus({automationStore:o,contextType:n,typecheckResult:r.value,automationActionStore:e})}}}),[e,t]),onTextStoreUnselect:(0,n.useMemo)((()=>{if(t.defined&&r().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:r}=t;return function(){a().A.blur({automationStore:o,contextType:n,typecheckResult:r.value,automationActionStore:e})}}}),[e,t])}}},880264:(e,t,o)=>{o.d(t,{Mh:()=>x,Zr:()=>f});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(693954),l=()=>o(959013),s=()=>o(284371),u=()=>o(406699),c=()=>o(463830),p=()=>o(656134),d=()=>o(813716),m=()=>o(541172),g=()=>o(997939),y=()=>o(897499),h=o(474848);function f(e){const{propertySchema:t}=e,{property:o}=(0,n.useContext)(y()._B),{removePropertyTrigger:m}=(0,d().p)(),f=(0,a().IS)((e=>({content:{...s().RC,color:e.text.uiRedPrimary,fontWeight:s().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},propertyName:{color:e.accentColors.red[700],fontWeight:s().Wy.semibold,whiteSpace:"nowrap"}})),[]),x=(0,p().j)(),b=(0,r().uB)(void 0,c().A),C=(0,n.useCallback)((()=>b.reset()),[b]),A=(0,n.useCallback)((()=>{m(o)}),[o,m]),k=function(e){const{propertySchema:t,styles:o}=e;return(0,h.jsx)(l().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:(0,h.jsx)("span",{style:o.propertyName,children:t.name})}})}({propertySchema:t,styles:f}),M=function(e){const{propertySchema:t}=e;return(0,h.jsx)(l().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"crossWorkspaceRelationPropertyTrigger.tooltip",values:{propertyName:S({maxLength:20,text:t.name})}})}({propertySchema:t});return(0,h.jsx)(u().Ay,{buttonPopupStore:b,popupType:x,render:()=>(0,h.jsx)(v,{closeMenu:C,propertyId:o}),renderOrigin:e=>(0,h.jsx)(g().X,{...e,icon:i().Q,onDelete:A,styles:f,tooltip:M,children:(0,h.jsx)("div",{style:f.content,children:k})})})}function v(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:r}=(0,d().p)(),a=(0,n.useCallback)((()=>{r(o),null==t||t()}),[t,o,r]);return(0,h.jsx)(m().Ol,{onDelete:a,stepType:"trigger"})}function x(e){const{propertySchema:t}=e;return(0,h.jsx)(l().sA,{defaultMessage:"{propertyName} property is a cross-workspace relation",id:"crossWorkspaceRelationPropertyTrigger.title",values:{propertyName:t.name}})}function S(e){const{maxLength:t,text:o,truncateCharacter:n}=e,r=n??"…",a=Array.from(o);return a.length<=t?o:`${a.slice(0,t-1).join("")}${r}`}},890824:(e,t,o)=>{o.d(t,{A:()=>p});var n=o(296540),r=()=>o(100622),a=()=>o(534177),i=o(474848);function l(e,t){switch(e){case"primary":return{background:r().Ay.frontBlueButtonBackground,boxShadow:t.buttonBoxShadow,color:"white"};case"secondary":return{background:r().Ay.frontSecondaryButtonBackground,boxShadow:`\n\t\t\t\t\t0 1px 2px rgba(15, 15, 15, 0.1),\n\t\t\t\t\tinset 0 0 0 1px ${r().Ay.redWithAlpha(.3)}`,color:r().Ay.red};case"tertiary":case"aiTertiary":return{background:r().Ay.white,color:r().Ay.frontTextDark,border:"1px solid rgba(15, 15, 15, 0.15)",width:"100%",boxShadow:"0 1px 2px rgba(15, 15, 15, 0.05)"};case"quaternary":return{background:r().Ay.frontQuaternaryButtonBackground,border:`1px solid ${r().Ay.frontQuaternaryButtonBorder}`,boxShadow:"0 1px 2px rgba(15, 15, 15, 0.1)",color:"white"};case"aiPrimary":return{background:"#CA59FF",color:"white"};case"lightGray":return{background:t.tint.regular,color:t.text.secondary};default:(0,a().HB)(e)}}function s(e,t){switch(e){case"primary":return{background:r().Ay.frontBlueButtonHoveredBackground};case"secondary":return{background:r().Ay.frontSecondaryButtonBackgroundHovered};case"tertiary":return{background:"light"===t.mode?t.buttonHoveredBackground:r().Ay.whiteWithAlpha(.8)};case"quaternary":return{background:r().Ay.frontQuaternaryButtonBackgroundHovered};case"aiPrimary":case"aiTertiary":return{background:"#C592DD"};case"lightGray":return{background:t.tint.regular,color:t.text.primary};default:(0,a().HB)(e)}}function u(e,t){switch(e){case"primary":return{background:r().Ay.frontBlueButtonPressedBackground};case"secondary":return{background:t.buttonPressedBackground};case"tertiary":return{background:"light"===t.mode?t.buttonPressedBackground:r().Ay.whiteWithAlpha(.85)};case"quaternary":return{background:r().Ay.frontQuaternaryButtonBackgroundPressed};case"aiPrimary":case"aiTertiary":return{background:"#946EA6"};case"lightGray":return{background:t.state.pressed,color:t.text.primary};default:(0,a().HB)(e)}}function c(e,t){const{id:n,children:r,disabledFeedback:a,isFullWidth:c,isLoading:p,onClick:d,style:m,variant:g,...y}=e,h=(0,o(401497).DP)(),f={display:"inline-grid",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",height:36,borderRadius:4,fontSize:14,lineHeight:1,paddingLeft:12,paddingRight:12,fontWeight:o(284371).Wy.medium,...p&&{gridTemplateColumns:"1fr auto 1fr"},transition:"background-color color 150ms ease"};return(0,i.jsx)(o(704152).A,{ref:t,id:n,onClick:d,style:{...f,...l(g,h),...m,...c&&{width:"100%",justifyContent:"center"}},hoveredStyle:s(g,h),pressedStyle:u(g,h),loadingSpinnerStyle:{marginLeft:"auto"},isLoading:p,disabledFeedback:a,...y,children:(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",textAlign:"center",justifyContent:"center"},children:r})})}const p=n.memo(n.forwardRef(c),o(821062).A)},897499:(e,t,o)=>{o.d(t,{Js:()=>he,_B:()=>ye,CD:()=>fe});o(898992),o(354520),o(581454),o(737550);var n=o(296540),r=()=>o(847249),a=()=>o(546461),i=()=>o(5269),l=()=>o(401497),s=()=>o(523389),u=()=>o(959013),c=()=>o(284371),p=()=>o(214973),d=()=>o(813716),m=()=>o(997939),g=o(474848);function y(){const{removeAnyPropertyEditedTrigger:e}=(0,d().p)(),t=(0,u().tz)(),o=(0,l().IS)((()=>({title:{fontWeight:c().Wy.medium}})),[]),n=p().HG(t);return(0,g.jsx)(m().X,{icon:s().pencilLineSmallIcon,onDelete:e,tooltip:n,children:(0,g.jsx)("div",{style:o.title,children:n})})}var h=()=>o(422540),f=()=>o(289915),v=()=>o(970013),x=()=>o(963589),S=()=>o(38440),b=()=>o(366360),C=()=>o(406699),A=()=>o(656134),k=()=>o(555005);function M(e){const{renderOrigin:t,property:o}=e,n=(0,A().j)();return(0,g.jsx)(C().Ay,{popupType:n,renderOrigin:t,render:e=>(0,g.jsx)(k().A,{initialState:{type:"propertyChangedFilter",property:o},buttonPopupParent:e})})}var j=()=>o(383688),T=()=>o(880264),I=()=>o(36697),P=()=>o(989064);function w(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(P().z,{onClick:o,icon:e=>(0,g.jsx)(I().P,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(V,{propertyName:t.name}),children:(0,g.jsx)(_,{propertyName:t.name})})}function _(e){let{propertyName:t}=e;const o=(0,u().tz)(),n=(0,l().IS)((()=>({propertyName:{...c().RC,fontWeight:c().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),r=p().yR(o,{propertyName:(0,g.jsx)("span",{style:n.propertyName,children:t})});return(0,g.jsx)("span",{style:n.wrap,children:r})}function V(e){let{propertyName:t}=e;const o=(0,u().tz)();return(0,g.jsx)(g.Fragment,{children:p().yR(o,{propertyName:t})})}function R(e){let{propertySchema:t,onClick:o}=e;return(0,g.jsx)(P().z,{onClick:o,icon:e=>(0,g.jsx)(I().P,{propertySchema:t,style:e}),tooltip:(0,g.jsx)(E,{propertyName:t.name}),children:(0,g.jsx)(B,{propertyName:t.name})})}function B(e){let{propertyName:t}=e;const o=(0,u().tz)(),n=(0,l().IS)((()=>({propertyName:{...c().RC,fontWeight:c().Wy.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),r=p().Od(o,{propertyName:(0,g.jsx)("span",{style:n.propertyName,children:t})});return(0,g.jsx)("span",{style:n.wrap,children:r})}function E(e){let{propertyName:t}=e;const o=(0,u().tz)();return(0,g.jsx)(g.Fragment,{children:p().Od(o,{propertyName:t})})}var F=()=>o(798941);function N(e){const{filter:t,propertySchema:o,onClick:n}=e,{title:r,tooltipTitle:a,styles:i}=(0,F().aR)({numberValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(P().z,{onClick:n,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:r})})}var O=()=>o(112588),D=()=>o(743176),W=()=>o(693954),L=()=>o(534177),K=()=>o(463830),H=()=>o(984714),z=()=>o(630550);function U(e){const{deletedPropertySchema:t}=e,o=null==t?void 0:t.type,{property:a}=(0,n.useContext)(ye),{removePropertyTrigger:i}=(0,d().p)(),s=(0,x().X)("automation_updated_error_states"),u=(0,l().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:s?c().Wy.regular:c().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...s&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[s]),p=(0,A().j)(),y=(0,r().uB)(void 0,K().A),h=(0,n.useCallback)((()=>y.reset()),[y]),f=(0,n.useCallback)((()=>{i(a)}),[a,i]),v=(0,L().O9)(t)?(0,H().AJ)({propertySchema:t,styles:u,hasAutomationUpdatedErrorStatesEnabled:s}):(0,H().Xl)(),S=(0,L().O9)(t)?(0,H().CH)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:s}):(0,H().Xl)();return(0,g.jsx)(C().Ay,{buttonPopupStore:y,popupType:p,render:()=>(0,g.jsx)(z().c,{closeMenu:h,propertyId:a}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:s&&(0,L().O9)(o)?D().LE[o]:W().Q,onDelete:f,styles:u,tooltip:S,children:(0,g.jsx)("div",{style:u.content,children:v})})})}var Y=()=>o(133518),q=()=>o(457050);function $(e){const{filter:t,propertySchema:o,onClick:n}=e,a=(0,Y().F)(),{collectionStore:i}=(0,b().k)(),l=(0,x().X)("collections_xws"),s=(0,r().K8)((()=>i.getSpaceId()),[i]),u=(0,r().K8)((()=>l&&(0,v().o2)(s,o)),[l,o,s]),c=(0,r().K8)((()=>(0,q().WE)({collectionStore:i,filter:t})),[i,t]),{title:p,tooltipTitle:d,styles:m}=(0,q().xL)({automationContextValues:a,filter:t,collectionStore:i,operator:t.operator,propertySchema:o,messageType:"trigger",value:null==c?void 0:c.value});return u?(0,g.jsx)(T().Zr,{propertySchema:o}):(0,g.jsx)(P().z,{onClick:n,tooltip:(0,g.jsx)("span",{children:d}),children:(0,g.jsx)("div",{style:m.content,children:p})})}var G=()=>o(477329),Q=()=>o(27511),X=()=>o(967823);function Z(e){const{filter:t,propertySchema:o,onClick:n}=e,{title:r,tooltipTitle:a,styles:i}=(0,X().w5)({textValue:t.value.value,operator:t.operator,propertySchema:o,messageType:"trigger"});return(0,g.jsx)(P().z,{onClick:n,tooltip:(0,g.jsx)("span",{children:a}),children:(0,g.jsx)("div",{style:i.content,children:r})})}var J=()=>o(682146),ee=()=>o(236262),te=()=>o(760217),oe=()=>o(928600),ne=()=>o(939740),re=()=>o(8980),ae=()=>o(89924),ie=()=>o(781697);function le(e){const{closeMenu:t,propertyId:o}=e,{removePropertyTrigger:r}=(0,d().p)(),a=(0,n.useCallback)((()=>{r(o),null==t||t()}),[t,o,r]),i=(0,ie().e)({width:266}),l=(0,n.useMemo)((()=>({action:a,key:"delete-property-menu-item",render:e=>(0,g.jsx)(te().A,{...e,icon:(0,g.jsx)(re().I,{icon:ee().trashIcon}),title:(0,g.jsx)(u().sA,{id:"automationUnsupportedOperatorMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})})})),[a]);return(0,g.jsx)(oe().A,{...i,children:(0,g.jsx)(ne().Ay,{initialFocus:0,sections:[{key:"actions-section",items:[l],render:e=>(0,g.jsx)(ae().A,{...e})}],type:ne().Oh.Vertical})})}function se(e){let{filter:t,propertySchema:o}=e;const a=(0,u().tz)(),{property:i}=(0,n.useContext)(ye),{removePropertyTrigger:s}=(0,d().p)(),p=(0,x().X)("automation_updated_error_states"),y=(0,l().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:p?c().Wy.regular:c().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...p&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[p]),h=(0,A().j)(),f=(0,r().uB)(void 0,K().A),v=(0,n.useCallback)((()=>f.reset()),[f]),b=(0,n.useCallback)((()=>{s(i)}),[i,s]),k=function(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:n}=e,r=t.type,a=t.name||J().dC[r];if(n)return(0,g.jsx)(u().sA,{defaultMessage:'"{propertyTypeDisplayName}" property type is incompatible with this step',id:"updateThisPageUnsupportedOperatorAction.updatedUnsupportedOperator.title",values:{propertyTypeDisplayName:a}});return(0,g.jsx)(u().sA,{defaultMessage:"{propertyTypeDisplayName} property type is incompatible with this step",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.title",values:{propertyTypeDisplayName:(0,g.jsx)("span",{style:o.propertyType,children:a})}})}({propertySchema:o,styles:y,hasAutomationUpdatedErrorStatesEnabled:p}),M=function(e){const{filter:t,intl:o}=e,n=S().LN[t.operator],r=(S().lD[n]||[]).map((e=>J().dC[e])),a=o.formatList(r,{style:"long",type:"disjunction"});return(0,g.jsx)(u().sA,{defaultMessage:"Remove step or restore property to a valid type: {propertiesSupportedList}",id:"updateThisPageUnsupportedOperatorAction.unsupportedOperator.titleList",values:{propertiesSupportedList:a}})}({intl:a,filter:t}),j=o.type;return(0,g.jsx)(C().Ay,{buttonPopupStore:f,popupType:h,render:()=>(0,g.jsx)(le,{closeMenu:v,propertyId:i}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:p&&(0,L().O9)(j)?D().LE[j]:W().Q,onDelete:b,styles:y,tooltip:M,children:(0,g.jsx)("div",{style:y.content,children:k})})})}var ue=()=>o(217028),ce=()=>o(541172);function pe(e){let{propertySchema:t}=e;const{property:o}=(0,n.useContext)(ye),{removePropertyTrigger:a}=(0,d().p)(),i=(0,x().X)("automation_updated_error_states"),s=(0,l().IS)((e=>({content:{color:e.text.uiRedPrimary,fontWeight:i?c().Wy.regular:c().Wy.medium,whiteSpace:"normal"},icon:{fill:e.text.uiRedPrimary},iconWrap:{...i&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[i]),u=(0,A().j)(),p=(0,r().uB)(void 0,K().A),y=(0,n.useCallback)((()=>p.reset()),[p]),h=(0,n.useCallback)((()=>{a(o)}),[o,a]),f=(0,ue().m9)({propertySchema:t,styles:s,hasAutomationUpdatedErrorStatesEnabled:i}),v=(0,ue().cn)({propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:i}),S=t.type;return(0,g.jsx)(C().Ay,{buttonPopupStore:p,popupType:u,render:()=>(0,g.jsx)(ce().A5,{closeMenu:y,propertyId:o}),renderOrigin:e=>(0,g.jsx)(m().X,{...e,icon:i&&(0,L().O9)(S)?D().LE[S]:W().Q,onDelete:h,styles:s,tooltip:v,children:(0,g.jsx)("div",{style:s.content,children:f})})})}function de(e){const{collectionStore:t}=(0,b().k)(),{property:o,filter:n}=e,[a,i]=(0,r().K8)((()=>{var e,n;return[null===(e=t.getSchema())||void 0===e?void 0:e[o],null===(n=t.getDeletedSchema())||void 0===n?void 0:n[o]]}),[t,o]);if(!a)return(0,g.jsx)(U,{deletedPropertySchema:i});if(!(0,h().$0)(a))return(0,g.jsx)(pe,{propertySchema:a});const l=S().W[a.type]||a.type;return"changes_to_any"!==n.operator&&"is_empty"!==n.operator&&n.operator&&S().LN[n.operator]!==l?(0,g.jsx)(se,{propertySchema:a,filter:n}):(0,h().nq)(a)?(0,g.jsx)(ge,{property:o,propertySchema:a,filter:n}):(0,g.jsx)(R,{propertySchema:a})}function me(e){const{filter:t,onClick:o,propertySchema:n}=e,{collectionStore:a}=(0,b().k)(),i=(0,x().X)("collections_xws"),l=(0,r().K8)((()=>i&&(0,v().nC)(n)&&(0,v().o2)(a.getSpaceId(),n)),[a,n,i]);return(0,v().nC)(n)&&l?(0,g.jsx)(T().Zr,{propertySchema:n}):"is_empty"===t.operator?(0,g.jsx)(w,{...e,propertySchema:n}):"changes_to_any"!==t.operator&&(0,f().gc)(t)?"checkbox"===n.type&&(0,f().Ui)(t)?(0,g.jsx)(j().ZZ,{filter:t,onClick:o,propertySchema:n}):"status"===n.type&&(0,f().H$)(t)?(0,g.jsx)(Q().y,{filter:t,onClick:o,propertySchema:n}):"select"===n.type&&(0,f().v0)(t)||"multi_select"===n.type&&(0,f().as)(t)?(0,g.jsx)(G().Ww,{filter:t,onClick:o,propertySchema:n}):"person"===n.type&&(0,f().I_)(t)?(0,g.jsx)(O().h,{filter:t,onClick:o,propertySchema:n}):"number"===n.type&&(0,f().My)(t)?(0,g.jsx)(N,{filter:t,onClick:o,propertySchema:n}):"email"!==n.type&&"phone_number"!==n.type&&"text"!==n.type&&"title"!==n.type&&"url"!==n.type||!(0,f().YH)(t)?"relation"===n.type&&(0,f().Pq)(t)?(0,g.jsx)($,{filter:t,onClick:o,propertySchema:n}):(0,g.jsx)(R,{onClick:o,propertySchema:n}):(0,g.jsx)(Z,{filter:t,onClick:o,propertySchema:n}):(0,g.jsx)(R,{onClick:o,propertySchema:n})}function ge(e){const{filter:t,propertySchema:o,property:r}=e,a=(0,n.useCallback)((e=>(0,g.jsx)(me,{filter:t,onClick:e.onClick,propertySchema:o})),[t,o]);return(0,g.jsx)(M,{renderOrigin:a,property:r})}const ye=(0,n.createContext)({pagePropertiesEdited:[],property:""});function he(){const{automationStore:e,contextType:t}=(0,a().EC)(),o=(0,i().y)(e,t),n=fe(e),l=(0,r().K8)((()=>{var t;if(!e||!e.isTriggerType("event"))return;const o=null===(t=e.getEventConfiguration())||void 0===t?void 0:t.pagePropertiesEdited;return"none"===(null==o?void 0:o.type)?void 0:o}),[e]),s=(0,r().K8)((()=>null==o?void 0:o.getSchema()),[o]);if(!n||!l)return null;if("any"===l.type)return(0,g.jsx)(y,{});if(!s)return null;let u=[];return"all"===l.type?u=l.all??[]:"some"===l.type&&(u=l.some??[]),u?(0,g.jsx)(g.Fragment,{children:u.map((e=>{let{property:t,filter:o}=e;return(0,g.jsx)(ye.Provider,{value:{property:t,pagePropertiesEdited:u},children:(0,g.jsx)(de,{property:t,filter:o})},t)}))}):null}function fe(e){return(0,r().K8)((()=>{if(null==e||!e.isTriggerType("event"))return!1;const t=e.getEventConfiguration(),o=Boolean("none"!==(null==t?void 0:t.pagePropertiesEdited.type)),n=Boolean("all"===(null==t?void 0:t.pagePropertiesEdited.type)&&Boolean(null==t?void 0:t.pagePropertiesEdited.all)),r=Boolean("some"===(null==t?void 0:t.pagePropertiesEdited.type)&&Boolean(null==t?void 0:t.pagePropertiesEdited.some)),a=Boolean("any"===(null==t?void 0:t.pagePropertiesEdited.type));return o&&(n||r||a)}),[e])}ye.displayName="PropertyEditedTriggerContext"},905209:(e,t,o)=>{o.d(t,{$:()=>f});var n=o(296540),r=()=>o(662303),a=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(534177),u=()=>o(284371),c=()=>o(354584),p=()=>o(712030),d=()=>o(921855),m=()=>o(645873),g=()=>o(562800),y=()=>o(509144),h=o(474848);function f(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:f,value:v}=e,x=(0,l().IS)((()=>({overflowWrap:{whiteSpace:"inherit"},textWrap:{alignItems:"center",display:"flex",fontFamily:u().vc(r().locale).githubMono}})),[]),S=function(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:r,value:u}=e,f=(0,a().v3)(),v=(0,a().Y0)(),x=(0,i().K8)((()=>f.KatexStore.getKatex()),[f]),S=(0,p().Ol)(),b=(0,l().DP)(),{value:C}=(0,m().fJ)(c().y),[A,k]=(0,n.useMemo)((()=>[null==u?void 0:u.value,(null==u?void 0:u.type)??"simple"]),[u]);return(0,i().K8)((()=>{if(!A)return"";if("simple"===k)return(0,d().S5)({disabled:!0,disableDateStyleAnnotations:!1,disableHover:!1,disableInsertedDeletedAnnotations:!1,disableStyleAnnotations:!1,disableSuggestionAnnotations:!1,emojiType:S,environment:f,formulaValueTypes:t,katex:x,parentBlockId:void 0,parentStore:o,renderedPageBlockId:void 0,textValue:{value:A,spaceId:r},theme:b});if("formula"===k){if(C){const e=(0,y()._)({currentUserId:f.currentUser.id,errorRanges:[],getPublicBaseUrlForPage:g().SN(f),isAndroid:v.isAndroid,isMobileNative:v.isMobileNative,isSafariOrIOS:v.isSafari||v.isIOS,isWindows:v.isWindows,parentSpaceId:r,Prism:C,store:o,textValue:A,theme:b,valueTypes:t,hoveredErrorRange:void 0});return(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:e}})}return""}(0,s().HB)(k)}),[C,v.isAndroid,v.isIOS,v.isMobileNative,v.isSafari,v.isWindows,S,f,t,x,o,r,b,k,A])}({formulaTypecheckContextValues:t??[],parentRecordStore:o,spaceId:f,value:v});return(0,h.jsx)("div",{style:x.textWrap,children:(0,h.jsx)("div",{style:x.overflowWrap,children:S})})}},920713:(e,t,o)=>{o.d(t,{B:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("codeFile",{viewBox:"0 0 23 24",svg:(0,n.jsx)("path",{d:"M4.195 11.86c0-.266.078-.488.235-.665.156-.182.38-.3.672-.351.494-.089.849-.271 1.062-.547.214-.281.32-.73.32-1.344V6.961c0-1.115.263-1.938.79-2.469.525-.536 1.333-.804 2.421-.804.203 0 .375.023.516.07.177.057.31.146.398.265a.646.646 0 01.141.422c0 .339-.148.558-.445.657a1.14 1.14 0 01-.157.039l-.171.015c-.625.047-1.066.222-1.32.524-.256.302-.384.8-.384 1.492v2.414c0 .672-.182 1.198-.546 1.578-.36.38-.86.604-1.5.672-.032 0-.047.013-.047.039.005.02.02.034.047.04.64.062 1.14.283 1.5.663.364.38.546.906.546 1.578v2.414c0 .693.128 1.19.383 1.492.255.303.696.48 1.32.532.053 0 .1.002.141.008l.133.03c.333.09.5.308.5.657a.68.68 0 01-.14.43.816.816 0 01-.407.273 1.48 1.48 0 01-.437.063c-1.12 0-1.948-.266-2.485-.797-.531-.526-.797-1.352-.797-2.477V14.79c0-.614-.106-1.062-.32-1.344-.213-.28-.568-.463-1.062-.547-.292-.062-.516-.182-.672-.359-.157-.177-.235-.404-.235-.68zm15.602 0c0 .275-.078.502-.235.68-.156.176-.382.296-.68.358-.5.084-.856.266-1.07.547-.208.282-.312.73-.312 1.344v1.992c0 1.125-.266 1.95-.797 2.477-.531.531-1.36.797-2.484.797-.151 0-.297-.021-.438-.063a.757.757 0 01-.414-.265.715.715 0 01-.133-.438c0-.182.042-.328.125-.437a.674.674 0 01.383-.22l.117-.03c.047-.006.097-.008.149-.008.625-.052 1.065-.23 1.32-.532.255-.302.383-.799.383-1.492v-2.414c0-.672.182-1.208.547-1.61.364-.405.864-.616 1.5-.632.026-.005.039-.018.039-.039 0-.026-.013-.04-.04-.04-.635-.015-1.135-.226-1.5-.632-.364-.406-.546-.945-.546-1.617V7.172c0-.693-.128-1.193-.383-1.5-.255-.307-.695-.48-1.32-.516l-.18-.015a1.233 1.233 0 01-.148-.04c-.297-.109-.446-.328-.446-.656 0-.166.045-.307.133-.422a.777.777 0 01.414-.265c.14-.047.31-.07.508-.07 1.089 0 1.896.268 2.422.804.526.531.789 1.354.789 2.469v1.992c0 .615.107 1.06.32 1.336.214.276.568.461 1.063.555.297.052.523.169.68.351a.967.967 0 01.234.664z"})})},929531:(e,t,o)=>{o.d(t,{aX:()=>G,OT:()=>Q,qt:()=>J,h3:()=>Z,ot:()=>$,M0:()=>ee});var n=o.n(o(32485)),r=o(296540),a=()=>o(484714),i=()=>o(819121),l=()=>o(588316),s=()=>o(847249),u=()=>o(401497),c=()=>o(352271),p=()=>o(558842),d=()=>o(725614),m=()=>o(704152),g=()=>o(348501),y=()=>o(859428),h=()=>o(614415),f=()=>o(115512),v=()=>o(645873),x=()=>o(554283),S=()=>o(962730),b=()=>o(463830),C=()=>o(366360),A=()=>o(959013),k=()=>o(973647),M=()=>o(963589),j=()=>o(546461),T=()=>o(653417),I=o(474848);function P(e){let{actionId:t}=e;const{typecheckResult:o}=(0,j().EC)(),{suppressActionErrors:n}=(0,C().b)(),r=(0,M().X)("automation_updated_error_states"),a=(0,s().K8)((()=>{if(r&&k().Q.isSuccess(o)&&!n.includes(t)){return(o.value.actionValidationFailures[t]||[]).length>0}return!1}),[t,r,n,o]);return{hasTypecheckErrors:a,typecheckErrorMessage:a?(0,I.jsx)(A().sA,{...T().automationErrorMessages.generalErrorMessage}):null}}o(898992),o(354520),o(581454);var w=()=>o(534177);function _(e){let{disabled:t}=e;const{automationStore:o}=(0,j().EC)(),{hideDragHandle:n}=(0,C().b)(),r=(0,s().K8)((()=>o.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(w().Pe)),[o]);return n||1===r.length||t}var V=()=>o(126617),R=()=>o(340498);const B={viewBox:"0 0 20 20",svg:(0,I.jsx)("path",{d:"m10.6 5.241 1.458-1.458a.625.625 0 1 1 .884.884l-2.5 2.5a.625.625 0 0 1-.884 0l-2.5-2.5a.625.625 0 0 1 .884-.884L9.35 5.191V1.72a.625.625 0 1 1 1.25 0zM2.375 10c0 1.036.84 1.875 1.875 1.875h11.5a1.875 1.875 0 0 0 0-3.75H4.25c-1.036 0-1.875.84-1.875 1.875m1.875-.625h11.5a.625.625 0 1 1 0 1.25H4.25a.625.625 0 0 1 0-1.25m5.308 3.458a.625.625 0 0 1 .884 0l2.5 2.5a.625.625 0 1 1-.884.884l-1.408-1.408v3.466a.625.625 0 1 1-1.25 0v-3.516l-1.458 1.458a.625.625 0 1 1-.884-.884z"})},E=(0,R().wt)("rectangleCompressVertical",B),F={viewBox:"0 0 20 20",svg:(0,I.jsx)("path",{d:"M10.442 1.278a.625.625 0 0 0-.884 0l-2.5 2.5a.625.625 0 1 0 .884.884L9.4 3.204v3.52a.625.625 0 0 0 1.25 0v-3.47l1.408 1.408a.625.625 0 1 0 .884-.884zM9.35 13.275v3.466l-1.408-1.408a.625.625 0 1 0-.884.884l2.5 2.5c.244.244.64.244.884 0l2.5-2.5a.625.625 0 0 0-.884-.884L10.6 16.791v-3.516a.625.625 0 1 0-1.25 0M4.5 6.125H8v1.25H4.5a.875.875 0 0 0-.875.875v3.5c0 .483.392.875.875.875H8v1.25H4.5a2.125 2.125 0 0 1-2.125-2.125v-3.5c0-1.174.951-2.125 2.125-2.125m11 6.5H12v1.25h3.5a2.125 2.125 0 0 0 2.125-2.125v-3.5A2.125 2.125 0 0 0 15.5 6.125H12v1.25h3.5c.483 0 .875.392.875.875v3.5a.875.875 0 0 1-.875.875"})},N=(0,R().wt)("rectangleExpandVertical",F);var O=()=>o(406699),D=()=>o(285790),W=()=>o(897119);const L=(0,A().YK)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"},collapseLabel:{id:"automationBaseStepElement.moreActionsMenu.collapseLabel",defaultMessage:"Collapse"},expandLabel:{id:"automationBaseStepElement.moreActionsMenu.expandLabel",defaultMessage:"Expand"}});function K(e){const{actionMenu:t,disabled:o,buttonPopupStore:n}=e,{device:r}=(0,a().v3)(),i=(0,A().tz)(),l=(0,u().IS)((e=>({container:{display:"flex",gap:1,padding:2,borderRadius:6,boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,backgroundColor:e.surface.elevated},iconButton:{height:24,width:24,flexShrink:0,borderRadius:4},moreIcon:{height:R().Ev.sm,width:R().Ev.sm},collapseToggleIcon:{height:R().Ev.default,width:R().Ev.default}})),[]);return(0,I.jsxs)("div",{style:l.container,children:[e.collapsible&&(0,I.jsx)(y().A,{renderTooltip:()=>(0,I.jsx)(A().sA,{...H(e.isCollapsed)}),render:t=>(0,I.jsx)(D().A,{...t,ariaLabel:i.formatMessage(H(e.isCollapsed)),disabled:o,disabledFeedback:o,hasBackground:!0,icon:e.isCollapsed?N:E,iconStyle:l.collapseToggleIcon,style:l.iconButton,onClick:e.onCollapseToggled})}),(0,I.jsx)(O().Ay,{alignmentToOrigin:O().yP.Center,buttonPopupStore:n,originGap:0,placementToOrigin:O().sx.Bottom,popupType:r.isMobile?W().nl.SlideUp:W().nl.Popup,render:()=>t,renderOrigin:e=>(0,I.jsx)(D().A,{...e,ariaLabel:i.formatMessage(L.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:V().Y,iconStyle:l.moreIcon,style:l.iconButton})})]})}function H(e){return e?L.expandLabel:L.collapseLabel}const z="automation-list-item-base-step",U="automation-list-item-base-step--drag-disabled",Y="automation-list-item-icon",q="automation-list-item-drag-handle";function $(e){const{actionMenu:t,buttonPopupStore:o,children:n,disabled:i,icon:u,onClick:c,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,subtitle:y,styles:h}=e,{isMobile:f}=(0,a().Y0)(),v=(0,s().uB)(o,b().A),[S,C]=(0,l().A)(),[A,k]=(0,x().B)(),M=(0,s().K8)((()=>v.getState()),[v]),j=!i&&(f||k||C||M.open),T=ee({disabled:i,hasActionMenu:Boolean(t),isActionMenuVisible:j,overrideStyles:h}),P=(0,p().Px)(S,A),w=(0,r.useMemo)((()=>({...T.componentWrap,...T.border})),[T.border,T.componentWrap]);return(0,I.jsxs)("div",{className:z,onClick:c,onMouseDown:d,onMouseEnter:m,onMouseLeave:g,ref:P,style:w,children:[(0,I.jsxs)("div",{style:T.headerWrap,children:[u&&(0,I.jsx)("div",{"aria-hidden":"true",style:T.iconContainer,children:(0,I.jsx)("div",{style:T.iconWrap,children:u(T.icon)})}),(0,I.jsx)("div",{style:T.titleWrap,children:n})]}),y&&(0,I.jsx)("div",{style:T.subtitleWrap,children:y}),t&&(0,I.jsx)("div",{style:T.actionMenuWrap,children:(0,I.jsx)(K,{actionMenu:t,buttonPopupStore:v,disabled:i})})]})}function G(e){const{actionMenu:t,buttonPopupStore:o,children:u,disabled:c,icon:y,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:C,onMouseLeave:A,styles:k,subtitle:M,hideDragHandle:j}=e,{isMobile:T}=(0,a().Y0)(),[P,w]=(0,i().A)(),[V,R]=(0,l().A)(),[B,E]=(0,x().B)(),F=(0,s().uB)(o,b().A),N=(0,s().K8)((()=>F.getState().open),[F]),O=(0,p().Px)(B,V),D=!c&&(T||E||w||R||N);(0,r.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return F.addListener(e),()=>{F.removeListener(e)}}),[F]);const W=ee({disabled:c,hasActionMenu:Boolean(t),isActionMenuVisible:D,overrideStyles:k}),L=_({disabled:c}),H=Boolean(j||L);return(0,I.jsxs)("div",{className:n()(z,{[U]:c||T||H}),ref:O,style:W.buttonWrap,children:[(0,I.jsxs)(m().A,{disabled:c,disabledFeedback:c,ignoreLocalHoverState:!0,ignoreLocalPressedState:!0,onBlur:h,onClick:f,onFocus:v,onMouseDown:S,onMouseEnter:C,onMouseLeave:A,ref:P,style:W.componentWrap,children:[(0,I.jsxs)("div",{style:W.headerWrap,children:[y&&(0,I.jsxs)("div",{"aria-hidden":"true",style:W.iconContainer,children:[(0,I.jsx)("div",{className:Y,style:W.iconWrap,children:y(W.icon)}),!H&&(0,I.jsx)("div",{className:q,style:W.iconWrap,children:(0,I.jsx)(g().A,{width:20,height:20,hideClickMessage:!0})})]}),(0,I.jsx)("div",{style:W.titleWrap,children:u})]}),M&&(0,I.jsx)("div",{style:W.subtitleWrap,children:M})]}),t&&(0,I.jsx)("div",{style:W.actionMenuWrap,children:(0,I.jsx)(K,{actionMenu:t,buttonPopupStore:F,disabled:c})})]})}function Q(e){return(0,I.jsx)(re,{actionId:e.actionId,canCollapse:e.canCollapse,children:(0,I.jsx)(X,{...e})})}function X(e){const{actionId:t,actionMenu:o,buttonPopupStore:i,children:u,disabled:c,forceShowActionMenu:m,onMouseEnter:g,onMouseLeave:y,styles:h,hideDragHandle:f}=e,{hasTypecheckErrors:v}=P({actionId:t}),S=_({disabled:c}),A=Boolean(f||S),{isMobile:k}=(0,a().Y0)(),[M,j]=(0,l().A)(),[T,w]=(0,x().B)(),V=(0,s().uB)(i,b().A),R=(0,s().K8)((()=>V.getState().open),[V]),{currentDraggingActionId:B}=(0,C().b)(),{isCollapsed:E,canCollapse:F,toggleCollapsed:N}=ne(),O=(0,p().Px)(T,M),D=!c&&(m||k||w||j||R);(0,r.useEffect)((()=>{function e(e){e.state.open||d().blurActiveElement()}return V.addListener(e),()=>{V.removeListener(e)}}),[V]);const W=ee({disabled:c,hasActionMenu:Boolean(o),isActionMenuVisible:D,overrideStyles:h}),L=(0,r.useMemo)((()=>({...W.componentWrap,...W.border,...B&&!A?{cursor:"grabbing"}:{}})),[B,W.border,W.componentWrap,A]);return(0,I.jsxs)("div",{className:n()(z,{[U]:c||k||A||v}),onMouseEnter:g,onMouseLeave:y,ref:O,style:L,children:[o&&(0,I.jsx)("div",{style:W.actionMenuWrap,children:(0,I.jsx)(K,{actionMenu:o,buttonPopupStore:V,disabled:c,...F?{collapsible:!0,isCollapsed:E,onCollapseToggled:N}:{collapsible:!1}})}),u]})}function Z(e){const{actionId:t,actionRegistryItem:o,children:n,disabled:a,errorMessage:i,onMouseEnter:l,onMouseLeave:s,styles:u}=e,{typecheckErrorMessage:p}=P({actionId:t}),d=i||p,m=_({disabled:a}),h=Boolean(d||m),{canCollapse:f,toggleCollapsed:v}=ne(),x=ee({disabled:a,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:{...u,...f?{headerWrap:{cursor:"pointer"}}:{}}}),b=(0,r.useCallback)((()=>{!a&&f&&v()}),[f,a,v]),C=(0,c().qe)(o)?o.display:void 0;return(0,I.jsx)(y().A,{disableTooltip:!d,renderTooltip:()=>d,render:e=>(0,I.jsxs)("header",{onClick:b,onMouseEnter:l,onMouseLeave:s,...e,onFocus:e=>e.stopPropagation(),style:x.headerWrap,role:"button",children:[C&&(0,I.jsxs)("div",{"aria-hidden":"true",style:x.iconContainer,children:[(0,I.jsx)("div",{className:Y,style:x.iconWrap,children:(0,I.jsx)(te,{display:C,isError:Boolean(d),hasSideEffects:o.hasNewReversableEffect})}),!h&&(0,I.jsx)("div",{className:q,style:x.iconWrap,children:(0,I.jsx)(g().A,{width:20,height:20,hideClickMessage:!0})})]}),(0,I.jsx)("div",{style:x.titleWrap,children:n})]}),placement:S().W.Bottom,delayThreshold:0})}function J(e){const{children:t,disabled:o,styles:n}=e,{isCollapsed:a}=ne(),{value:i}=(0,v().fJ)(h().fM),l=ee({disabled:o,hasActionMenu:!1,isActionMenuVisible:!1,overrideStyles:n}),[s,u]=(0,r.useState)(!1);if((0,r.useEffect)((()=>{u(!0)}),[a]),!i)return null;const{AnimatePresence:c,motion:p}=i;return(0,I.jsx)(c,{children:!a&&(0,I.jsxs)(p.div,{style:{display:"flex",flexDirection:"column"},initial:!!s&&{height:0},animate:{height:"auto"},exit:{height:0},children:[(0,I.jsx)("div",{style:l.collapsedDivider}),(0,I.jsx)("div",{style:l.bodyWrap,children:t})]})})}function ee(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:n,overrideStyles:r}=e;return(0,u().IS)((e=>({border:{border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`},buttonWrap:{background:e.surface.elevated,border:"unset",boxShadow:`0px 0px 0px 1px ${e.stroke.secondary}, 0px 2px 4px 0px rgba(0, 0, 0, ${"dark"===e.mode?.08:.04})`,overflow:"hidden",position:"relative",...null==r?void 0:r.buttonWrap},componentWrap:{background:e.surface.elevated,display:"flex",flexDirection:"column",paddingInline:12,paddingBlock:12,position:"relative",overflow:"hidden",...t?{cursor:"default",pointerEvents:"none"}:{},...null==r?void 0:r.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:8,marginInlineEnd:o?64:0,...t?{opacity:.4}:{},...null==r?void 0:r.headerWrap},iconContainer:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",flexShrink:0},iconWrap:{display:"flex",justifyContent:"center",alignItems:"center",width:20,height:20,...null==r?void 0:r.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==r?void 0:r.icon},titleWrap:{display:"flex",alignItems:"start",flex:"1 1 auto",fontSize:14,lineHeight:"20px",minWidth:0,whiteSpace:"pre",flexWrap:"wrap",...null==r?void 0:r.titleWrap},subtitleWrap:{...null==r?void 0:r.subtitleWrap},bodyWrap:{fontSize:14,marginBlockStart:12,marginBlockEnd:2,marginInline:2,marginTop:22,...null==r?void 0:r.bodyWrap},collapsedDivider:{borderTop:`1px solid ${e.stroke.secondary}`,left:0,marginTop:12,position:"absolute",width:"100%"},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:8,top:8,zIndex:2,...n?{}:f().Qg}})),[12,t,o,n,r])}function te(e){const{display:t,hasSideEffects:o,isError:n}=e,r=(0,u().IS)((e=>({iconWrap:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,background:n?e.tint.uiRed:o?e.tint.uiBlue:e.tint.regular,flexShrink:0},icon:{width:14,height:14,fill:n?e.icon.uiRedPrimary:o?e.icon.uiBluePrimary:e.icon.secondary,margin:"0 auto"}})),[o,n]);return(0,I.jsx)("div",{style:r.iconWrap,children:t.icon(r.icon)})}const oe=(0,r.createContext)({canCollapse:!1,isCollapsed:!1,toggleCollapsed:()=>{}});function ne(){return(0,r.useContext)(oe)}function re(e){const{actionId:t,children:o,canCollapse:n}=e,{collapsedActionIds:a,toggleActionIdCollapsed:i}=(0,C().b)(),l=(0,r.useMemo)((()=>a.includes(t)),[t,a]),s=(0,r.useCallback)((()=>{i(t)}),[t,i]);return(0,I.jsx)(oe.Provider,{value:{canCollapse:n,isCollapsed:l,toggleCollapsed:s},children:o})}oe.displayName="BaseStepElementCollapseContext"},938818:(e,t,o)=>{o.d(t,{J:()=>c,L:()=>p});o(18107),o(967357);var n=o(296540),r=()=>o(563015),a=()=>o(959013),i=()=>o(534177),l=()=>o(554509),s=()=>o(963589),u=o(474848);function c(e){const{analyzedFormulaOutput:t}=e,{parseErrors:o,typeErrors:r}=t,c=(0,a().tz)(),d=(0,s().X)("automation_updated_error_states"),m=(0,n.useMemo)((()=>p(c,o??[],r??[])),[c,o,r]);return(0,i().O9)(m)?(0,u.jsx)(l().D,{colorName:d?"uiRedPrimary":"secondary",styleName:"UISmall-12px/Regular",children:(0,u.jsx)(a().sA,{...m})}):null}function p(e,t,o){const n=null==t?void 0:t.at(0);if((0,i().O9)(n))return(0,r().ml)(n);const a=null==o?void 0:o.at(0);return(0,i().O9)(a)?(0,r().rA)(e,a):void 0}},967823:(e,t,o)=>{o.d(t,{w5:()=>m,zl:()=>g});o(296540);var n=()=>o(847249),r=()=>o(401497),a=()=>o(784892),i=()=>o(959013),l=()=>o(534177),s=()=>o(284371),u=()=>o(881690),c=()=>o(214973),p=()=>o(438873),d=o(474848);function m(e){const{textValue:t,operator:o,propertySchema:m,messageType:y}=e,h=(0,i().tz)(),f=(0,r().IS)((()=>({content:{alignItems:"center",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...s().RC,fontWeight:s().Wy.medium},propertyValue:{...s().RC,paddingBlockStart:4}})),[]),v=(0,n().K8)((()=>function(e){const{textValue:t,operator:o,propertySchema:n,styles:r,messageType:s,intl:m}=e,g=(0,d.jsx)("span",{style:r.propertyName,children:n.name});let y;const h=m.formatMessage(p().bK[o].text).toLocaleLowerCase();"action"===s?y=c().$B({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):"trigger"===s?y=c().rh({operator:h,propertyName:g,propertyValues:(0,d.jsx)(u().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,value:t,showRemoveButton:!1})}):(0,l().HB)(s);return(0,d.jsx)(i().sA,{...y})}({messageType:y,operator:o,propertySchema:m,styles:f,textValue:t,intl:h})),[y,t,o,m,f,h]);return{tooltipTitle:(0,n().K8)((()=>g({messageType:y,operator:o,propertySchema:m,textValue:t,intl:h})),[y,o,m,t,h]),title:v,styles:f}}function g(e){const{textValue:t,operator:o,propertySchema:n,messageType:r,intl:a}=e,s=n.name;let u;const m=a.formatMessage(p().bK[o].text).toLocaleLowerCase();return"action"===r?u=c().$B({operator:m,propertyName:s,propertyValues:t}):"trigger"===r?u=c().rh({operator:m,propertyName:s,propertyValues:t}):(0,l().HB)(r),(0,d.jsx)(i().sA,{...u})}},984714:(e,t,o)=>{o.d(t,{AJ:()=>v,CH:()=>x,Xl:()=>S,qR:()=>h,sF:()=>f,vu:()=>y});var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(959013),l=()=>o(406699),s=()=>o(963589),u=()=>o(962730),c=()=>o(463830),p=()=>o(656134),d=()=>o(630550),m=()=>o(217028),g=o(474848);function y(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertySchema:i}=e,l=(0,s().X)("automation_updated_error_states"),c=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},iconWrap:{...l&&{background:e.tint.uiRed,borderRadius:4}},propertyType:{color:e.accentColors.red[700]}})),[l]),p=v({propertySchema:i,styles:c,hasAutomationUpdatedErrorStatesEnabled:l}),d=x({propertySchema:i,hasAutomationUpdatedErrorStatesEnabled:l});return(0,g.jsx)(m().z$,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,propertyType:i.type,styles:c,tooltip:d,tooltipPlacement:l?u().W.Bottom:u().W.Left,children:p})}function h(e){const{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r}=e,i=(0,a().IS)((e=>({icon:{fill:e.text.uiRedPrimary},propertyType:{color:e.accentColors.red[700]}})),[]),l=S();return(0,g.jsx)(m().z$,{actionMenu:t,buttonPopupStore:o,disabled:n,onClick:r,styles:i,tooltip:l,children:l})}function f(e){const{actionId:t,propertyId:o,renderOrigin:a}=e,i=(0,p().j)(),s=(0,r().uB)(void 0,c().A),u=(0,n.useCallback)((()=>s.reset()),[s]);return(0,g.jsx)(l().Ay,{buttonPopupStore:s,popupType:i,render:()=>(0,g.jsx)(d().a,{actionId:t,closeMenu:u,propertyId:o}),renderOrigin:a})}function v(e){const{propertySchema:t,styles:o,hasAutomationUpdatedErrorStatesEnabled:n}=e;return n?(0,g.jsx)(i().sA,{defaultMessage:'"{propertyName}" property was deleted',id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.elementTitleText",values:{propertyName:t.name}}):(0,g.jsx)(i().sA,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:(0,g.jsx)("span",{style:o.propertyType,children:t.name})}})}function x(e){const{propertySchema:t,hasAutomationUpdatedErrorStatesEnabled:o}=e;return o?(0,g.jsx)(i().sA,{defaultMessage:"Restore property or delete to enable this automation",id:"updateThisPageUnsupportedPropertyAction.updatedDeletedProperty.title"}):(0,g.jsx)(i().sA,{defaultMessage:"{propertyName} property was deleted",id:"updateThisPageUnsupportedPropertyAction.deletedProperty.title",values:{propertyName:t.name}})}function S(){return(0,g.jsx)(i().sA,{defaultMessage:"The property was permanently deleted",id:"updateThisPageUnsupportedPropertyAction.permanentlyDeleted.title"})}},989064:(e,t,o)=>{o.d(t,{z:()=>p});var n=o(296540),r=()=>o(847249),a=()=>o(366360),i=()=>o(813716),l=()=>o(997939),s=()=>o(36697),u=()=>o(897499),c=o(474848);function p(e){const{property:t}=(0,n.useContext)(u()._B),{collectionStore:o}=(0,a().k)(),{removePropertyTrigger:p}=(0,i().p)(),d=(0,n.useCallback)((()=>{p(t)}),[t,p]),m=(0,r().K8)((()=>o.getSchema()),[o])[t],g=m?e=>(0,c.jsx)(s().P,{propertySchema:m,style:e}):void 0;return(0,c.jsx)(l().X,{icon:g,onDelete:d,...e,children:e.children})}},996027:(e,t,o)=>{o.d(t,{A:()=>x});o(296540);var n=()=>o(484714),r=()=>o(494379),a=()=>o(977345),i=()=>o(919709),l=()=>o(959013),s=()=>o(534177),u=()=>o(931077),c=()=>o(553965),p=()=>o(962730),d=()=>o(630116),m=()=>o(760217),g=()=>o(16006),y=()=>o(859428),h=()=>o(239633),f=()=>o(629203),v=o(474848);function x(e){var t;const{isChecked:o=!1,disabled:x,menuArgs:S,parentRecordStore:b}=e,{isMobile:C}=(0,n().Y0)(),A=(0,f().U)();let k;if("annotation"in e){const{annotation:t,formulaTypecheckContextValues:o}=e,n=(0,i().iVq)(t).id;k=(0,s().O9)(o)?(0,a().IV)(o,n):void 0}else k=e.contextValue;const M=(null===(t=k)||void 0===t?void 0:t.associatedCollectionForDisplay)&&d().md.createChildStore(b,k.associatedCollectionForDisplay),j=k&&(0,a().Ix)(k.type),T=C?24:20;return k?(0,v.jsx)(y().A,{renderTooltip:()=>x?(0,v.jsx)(l().sA,{...h().O.maximumPeopleSelectedTooltip}):(0,a().E9)(k),placement:p().W.Right,render:e=>(0,v.jsx)(m().A,{isChecked:o,title:(0,v.jsx)("div",{style:{display:"flex"},children:k.name}),disabled:x,style:x?A.disabledMenuItem:void 0,icon:(0,s().O9)(k.stepNumberForDisplay)?(0,v.jsx)(u().Q,{number:k.stepNumberForDisplay,size:r().H.Medium}):j?j({width:T,height:T,padding:2}):void 0,caption:M&&(0,v.jsx)(l().sA,{defaultMessage:"to {database}",id:"automations.AutomationTargetPickerMenu.VariableMenuItem.databaseCaption",values:{database:(0,v.jsx)(g().A,{store:M,style:{display:"inline"}})}}),...(0,c().A)(S,e)})}):null}},997939:(e,t,o)=>{o.d(t,{X:()=>A});o(16280),o(898992),o(354520);var n=o(296540),r=()=>o(847249),a=()=>o(401497),i=()=>o(105819),l=()=>o(236262),s=()=>o(959013),u=()=>o(534177),c=()=>o(760217),p=()=>o(928600),d=()=>o(939740),m=()=>o(8980),g=()=>o(89924),y=()=>o(962730),h=()=>o(463830),f=()=>o(366360),v=()=>o(781697),x=()=>o(71634),S=()=>o(741310),b=()=>o(929531),C=o(474848);function A(e){const{onDelete:t,styles:o}=e,{disabled:i}=(0,f().b)(),l=Boolean(i),s=(0,r().uB)(void 0,h().A),c=(0,n.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(),s.setState({open:!1})}),[s,t]),p=(0,n.useMemo)((()=>t?(0,C.jsx)(k,{onDelete:c}):null),[t,c]),d=(0,a().IS)((e=>({componentWrap:{borderRadius:10},buttonWrap:{borderRadius:10}})),[]),m=(0,n.useCallback)((t=>{const n=e.onClick?b().aX:b().ot;return(0,C.jsx)(n,{...t,actionMenu:p,buttonPopupStore:s,disabled:l,icon:e.icon,onClick:e.onClick,styles:{...o,...d},hideDragHandle:!0,children:e.children})}),[e.onClick,e.icon,e.children,p,s,l,o,d]);return(0,C.jsx)(x().ck,{children:(0,C.jsx)(S().P,{disable:l,renderOrigin:m,title:e.tooltip,tooltipPlacement:e.tooltipPlacement||y().W.Bottom,disableTooltip:!(0,u().O9)(e.tooltip)})})}function k(e){const{onClose:t,onEdit:o,onDelete:n}=e,r=(0,v().e)(),a=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,C.jsx)(c().A,{...e,icon:(0,C.jsx)(m().I,{icon:i().pencilLineIcon}),title:(0,C.jsx)(s().sA,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,n?{action:()=>{null==t||t(),n()},key:"delete",render:e=>(0,C.jsx)(c().A,{...e,icon:(0,C.jsx)(m().I,{icon:l().trashIcon}),title:(0,C.jsx)(s().sA,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(u().O9);return(0,C.jsx)(p().A,{...r,children:(0,C.jsx)(d().Ay,{type:d().Oh.Vertical,sections:[{items:a,key:"items",render:e=>(0,C.jsx)(g().A,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},999638:(e,t,o)=>{o.d(t,{A:()=>s});var n=o(296540),r=()=>o(847249),a=()=>o(722872),i=()=>o(419830),l=o(474848);const s=(0,o(645873).Qz)(o(862292).T.formulas,((e,t)=>(0,l.jsx)(u,{...t,formulas:e})));function u(e){const{allowedReturnTypes:t,disabled:s,formulas:u,formulaTypecheckContextValues:c,onBack:p,onChange:d,onClose:m,parentRecordStore:g,restrictUnaccessibleProperties:y,spaceId:h,value:f}=e,v=(0,o(484714).Y0)(),x=(0,n.useCallback)((async()=>{if(p)return void p();if("simple"===(null==f?void 0:f.type))return void m();await(0,i().Cp)()?(d({type:"simple",value:null==f?void 0:f.value}),m()):m()}),[m,d,p,f]),S=(0,n.useCallback)((e=>{void 0!==e&&e[0][0].length?d({type:"formula",value:e}):d(void 0),m()}),[d,m]),b=(0,r().K8)((()=>{const e=(0,o(909470).i)(),n=(0,o(502856).MC)({collectionFeatureGates:e,experimentService:o(508496).default,getRecordModel:g.getRecordModel,loadRecordModel:g.loadRecordModel});return{allowedReturnTypes:t,handleDataRequest:n,restrictUnaccessibleProperties:y,spaceId:h,valueTypes:c,featureGates:e}}),[t,c,g.getRecordModel,g.loadRecordModel,h,y]),C=(0,r().K8)((()=>(0,i().pG)(f)),[f]);return b?(0,l.jsx)(o(928600).A,{disableBottomPadding:!0,disableHeaderBorder:!0,disableScroller:!0,hideMobileTopbar:!0,maxHeight:"unset",menuType:v.isMobile?a().gu.Modal:a().gu.Popup,width:v.isMobile?void 0:740,children:(0,l.jsx)(o(833682).v,{formulas:u,initialCode:C,typecheckContext:b,handleClose:S,handleCancel:x,parentSpaceId:h,disabled:s,focus:!0,evaluationErrors:[],getRecordModel:g.getRecordModel})}):null}}}]);