"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[94387],{7667:(e,t,o)=>{o.d(t,{A:()=>y});o(898992),o(737550),o(296540);var n=()=>o(484714),i=()=>o(847249),r=()=>o(959013),a=()=>o(534177),l=()=>o(901389),s=()=>o(751156),u=()=>o(254497),d=()=>o(312296),p=()=>o(519839),c=()=>o(175116),m=o(474848);function y(){const e=(0,c().Ks)(),t=(0,n().v3)(),o=(0,i().K8)((()=>null==e?void 0:e.settingsStore),[e]);return function(n){if(!o||!n||!e)return;const i=e.collectionStore();if((0,a().O9)(i)){const e=p().KA({deletedSchema:i.getDeletedSchema(),property:n});if(e){var c;if("verification"===(null===(c=i.getDeletedSchema()[n])||void 0===c?void 0:c.type)){const e=i.getSchema(),t=Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)}));if(t)return void l().ui({message:(0,m.jsx)(r().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,m.jsx)(r().sA,{id:"deletedPropertyMenu.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}s().createAndCommit({userAction:"deletedPropertyMenu.handleRestoreDeletedPropertyClick",environment:t,canUndo:!0,perform:o=>{(0,d().F)({environment:t,collectionStore:i,update:e.updateSchema,transaction:o}),(0,u().E)({collectionStore:i,update:e.updateDeletedSchema,transaction:o})}})}}}}},102777:(e,t,o)=>{o.d(t,{b:()=>i});o(296540);var n=o(474848);const i=(0,o(340498).wt)("sendArrow",{viewBox:"0 0 20 20",svg:(0,n.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})},112282:(e,t,o)=>{o.d(t,{s:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M9.792 2.41a.6.6 0 0 0-.234.148l-5.4 5.4a.625.625 0 1 0 .884.884l4.333-4.333V17a.625.625 0 1 0 1.25 0V4.509l4.333 4.333a.625.625 0 1 0 .884-.884l-5.4-5.4a.62.62 0 0 0-.65-.147"})},i=(0,o(340498).wt)("arrowStraightUp",n)},141768:(e,t,o)=>{o.d(t,{YH:()=>s,bi:()=>a});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(803949),o(581454),o(908872);var n=()=>o(919709),i=()=>o(496603),r=()=>o(713972);function a(e){let t="";const o=document.createElement("div");o.innerHTML=e;const n=r().zn(o);for(const r of n){const e=i().ih(r.data);if(null!==r.parentElement&&r.parentElement!==o){t+=`<span class="${l({parent:r.parentElement,root:o}).join(" ")}">${e}</span>`}else t+=e}return t}function l(e){const{parent:t,root:o}=e,n=new Set;let i=t;for(;i&&i!==o;)i.classList.forEach((e=>{n.add(e)})),i=i.parentElement??void 0;return Array.from(n)}function s(e,t){const o={text:u(e),syntax:u(t)},i=function(e){let t=0;return e.reduce(((e,o)=>(e.push([t,o]),t+=o,e)),[])}(function(e,t){const o=e.slice(),n=t.slice(),i=[];let r=0,a=0;for(;r<o.length&&a<n.length;){const e=o[r],t=n[a];e===t?(i.push(e),r+=1,a+=1):e<t?(i.push(e),r+=1,n[a]-=e):(i.push(t),o[r]-=t,a+=1)}return i}(o.text,o.syntax)),r={text:0,syntax:0},a={text:0,syntax:0},l=[],s=e.map(n().N8A).join("");for(const[n,u]of i){const e=n+u,i=t[r.syntax],p={value:s.substring(n,e),textTokenIndex:r.text,classNames:(d=i,d&&d[1])};l.push(p);const c=o.text[r.text],m=o.syntax[r.syntax];e>=a.text+c&&(r.text+=1,a.text+=c),e>=a.syntax+m&&(r.syntax+=1,a.syntax+=m)}var d;return l}function u(e){return e.map((e=>e[0].length))}},164891:(e,t,o)=>{o.d(t,{y:()=>r});var n=()=>o(847249),i=()=>o(508496);function r(e){const{experimentId:t,groups:o,disableExposureLogging:r}=e,a=function(e){const{experimentId:t,disableExposureLogging:o,defaultGroup:r}=e;return(0,n().K8)((()=>i().default.getEligibleGroup({experimentId:t,defaultGroup:r??"control",disableExposureLogging:o})),[t,o,r])}({experimentId:t,disableExposureLogging:r});return o[a]}},247345:(e,t,o)=>{o.d(t,{J:()=>c});o(296540);var n=()=>o(484714),i=()=>o(102777),r=()=>o(959013),a=()=>o(285790),l=()=>o(35392),s=()=>o(859428),u=()=>o(962730),d=()=>o(286088),p=o(474848);function c(e){const t=(0,r().tz)(),{onSubmit:o,canSend:c}=e,m=(0,d().q2)(),y=(0,n().WS)(),f=t.formatMessage({id:"completions.CompletionMenuActionBar.sendTooltip",defaultMessage:"Send to AI"});return(0,p.jsx)(s().A,{renderTooltip:()=>(0,p.jsxs)("div",{children:[f,(0,p.jsx)(l().A,{style:m.keyboardShortcutInverted,name:"enter"})]}),placement:u().W.Bottom,render:e=>(0,p.jsx)(a().A,{icon:i().b,onClick:o,isPurple:c,disabled:!c,iconStyle:{height:y?24:20,width:y?24:20},ariaLabel:f,style:{pointerEvents:"auto",height:y?24:20,width:y?24:20},...e})})}},311894:(e,t,o)=>{o.d(t,{K:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M4.78 3.524a.63.63 0 0 1 .583-.399h9.274a.625.625 0 0 1 0 1.25h-7.66l5.662 5.163a.625.625 0 0 1 0 .924l-5.663 5.163h7.661a.625.625 0 0 1 0 1.25H5.363a.625.625 0 0 1-.421-1.087L11.29 10 4.942 4.212a.625.625 0 0 1-.162-.688"})},i=(0,o(340498).wt)("formula",n)},450859:(e,t,o)=>{o.d(t,{mA:()=>C});o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=()=>o(329199),i=()=>o(416504),r=()=>o(696706),a=()=>o(179034),l=()=>o(973647),s=()=>o(534177),u=()=>o(862292),d=()=>o(186445),p=()=>o(909470),c=()=>o(972435),m=()=>o(508496),y=()=>o(38789),f=()=>o(630116),g=()=>o(449506);const v=1e3;class x extends Error{constructor(e,t){super(t),this.type=e}}class h extends x{constructor(){super("query_collection_limit_outside_range",`Query collection limit must be between 0 andÂ ${v}`)}}class b extends x{constructor(e){super("query_collection_failed",`Query collection failed: ${e.reason}`),this.data=e}}class k extends x{constructor(){super("query_collection_too_many_items","Query collection updating too many items")}}async function C(e,t){const{source:o,parentRecordStore:x,collectionPointer:C,filter:I,sort:S,limit:M}=t,T=M??v;if(T<0||T>v)return{error:new h};const P=f().md.createChildStore(x,C);await P.load();const A=P.getModel();if(!A)return{error:new b({reason:"no collection value"})};const w=P.getParentBlockStore();if(!w)return{error:new b({reason:"no collection parent"})};await w.load();const E=w.getCollectionViewStores()[0],F=E.getSpaceId();if(!E||!F)return{error:new b({reason:"no first collection view"})};const j="results",D={[j]:{type:"results",limit:T}},B=Object.keys(t.aggregations??{});for(const n of B){var R;if(n===j)return{error:new b({reason:`${j} is a reserved reducer keyword.`})};const e=null===(R=t.aggregations)||void 0===R?void 0:R[n];if(!e)return{error:new b({reason:`no aggregation provided for ${n}.`})};e&&(D[n]={type:"aggregation",aggregation:e})}const _=P.getSchema(),L={filter:I&&n().SK(I,_),sort:S&&n().g4(S,_),userId:e.currentUser.id,userTimeZone:(0,i().P)(),searchQuery:void 0,reducers:D},H=await g().callApi({eventName:"queryCollection",environment:e,data:{source:{type:"collection",id:C.id,spaceId:C.spaceId},collectionView:{id:E.id,spaceId:F},loader:L},tracking:{src:o}});if("failed"===H.type)return{error:new b({reason:"server query failed",cause:H.error})};const N=H.data.result.reducerResults[j];if(!N||"results"!==N.type)return{error:new b({reason:"unexpected server result"})};if(N.blockIds.length===v&&N.hasMore)return{error:new k};const{groupsReducerIds:Y,reducerIdsWithNoGroupDependencies:V}=n().M(L.reducers,L.reducerDependencies),U=m().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs"),K=Date.now(),W=await u().T.formulas.load(),z={pageSort:[],schema:_,loader:L,userId:e.currentUser.id,userStartOfWeek:d().XX.state,currentTime:K,getRecordModel:x.getRecordModel,getRecordRole:x.getRecordRole,intl:c().A.getIntl(),isSorted:!1,visibleProperties:void 0,relativeVariableResult:null==H?void 0:H.data.relativeVariableResult,currentPageInRelatedCollection:void 0,isSprintPlanningView:!1,collectionSourceType:"collection",groupsReducerIds:Y,reducerIdsWithNoGroupDependencies:V,formulaTimeoutMs:U,resultCache:new Map,regExpCache:new Map,experimentService:m().default,collectionFeatureGates:(0,p().i)(),formulasModule:W},O=n().zl(z);for(const i of N.blockIds){var $;const e=f().Bv.createChildStore(x,{table:a().ev,id:i}),t=null===($=e.getAssociatedCollectionStore())||void 0===$?void 0:$.pointer;if(!(t&&r().L3.isEqualIdTable(t,P.pointer)))continue;const o=x.getRecordModel(e);o&&n().UC(o,A,z,O)}const q=y().A.getEditedBlocksForCollection(A.id),G=new Set(N.blockIds);for(const i of q){if(G.has(i))continue;const e=x.getRecordModel({table:a().ev,id:i});e&&n().UC(e,A,z,O)}const{result:Q}=n().Mo(z,O),J=n().uX({result:Q}),Z={};for(const i of B){var X;const e=n().VI({expectedAggregator:null===(X=t.aggregations)||void 0===X||null===(X=X[i])||void 0===X?void 0:X.aggregator,aggregationReducerResult:H.data.result.reducerResults[i]});if(l().Q.isFail(e)){const t="no aggregation provided"===e.error?`no aggregation provided for ${i}`:"unexpected response returned for aggregation"===e.error?`unexpected response returned for aggregation ${i}`:(0,s().HB)(e.error);return{error:new b({reason:t})}}Z[i]=e.value}return{value:{blockIds:J,...Z}}}},457056:(e,t,o)=>{o.d(t,{o:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M4.375 4.75a.625.625 0 1 0-1.25 0v5c0 1.174.951 2.125 2.125 2.125h10.491l-3.333 3.333a.625.625 0 0 0 .884.884l4.4-4.4a.625.625 0 0 0 0-.884l-4.4-4.4a.625.625 0 0 0-.884.884l3.333 3.333H5.25a.875.875 0 0 1-.875-.875z"})},i=(0,o(340498).wt)("arrowTurnDownRight",n)},509144:(e,t,o)=>{o.d(t,{_:()=>v});o(581454);var n=o(296540),i=()=>o(416504),r=()=>o(379632),a=()=>o(919709),l=()=>o(191772),s=()=>o(496603),u=()=>o(780054),d=()=>o(267419),p=()=>o(713972),c=()=>o(972435),m=()=>o(141768),y=()=>o(508496),f=()=>o(53137),g=o(474848);function v(e){const{currentUserId:t,errorRanges:o,getPublicBaseUrlForPage:p,isAndroid:v,isMobileNative:h,isSafariOrIOS:b,isWindows:k,parentSpaceId:C,Prism:I,store:S,theme:M,valueTypes:T,textValue:P,hoveredErrorRange:A}=e,w=a().q4_(P),E="notion",F=I.languages[E],j=document.createElement("div"),D=I.highlight(w,F,E);j.innerHTML=m().bi(D);const B=s().oE(Array.from(j.childNodes).map(x));let R=P;for(const n of o)R=a().Mwp({annotation:[a().Ifu.FormulaError],selection:n,textValue:R});const _=function(e){let{syntaxTokens:t,textValue:o,store:n,parentSpaceId:r,valueTypes:s,theme:p,isAndroid:v,isSafariOrIOS:x,isWindows:h,isMobileNative:b,currentUserId:k,getPublicBaseUrlForPage:C,hoveredErrorRange:I}=e;const S=m().YH(o,t),M=o.map(a().uPN).map(((e,t)=>l().sT({annotations:e,theme:p,getRecordModel:n.getRecordModel,spaceId:r})));let T=0;return S.map(((e,t)=>{const m=o[e.textTokenIndex],S=M[e.textTokenIndex],P=e.value.length,A=T,w=T+P;T=w;let E=!1;if(I){const{startIndex:e,endIndex:t}=I;void 0!==e&&void 0!==t&&A<t&&w>e&&(E=!0)}if(a().qXl(m)){const e=[...S.classNames||[],...E?["formula-error-underline"]:[]];return(0,l().Au)({args:{textValue:{value:o,spaceId:r},getRecordModel:n.getRecordModel,getRecordRole:n.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,i().P)(),disabled:!1,isAndroid:v,isSafariOrIOS:x,isWindows:h,showEmojiInline:h,emojiType:"raw",highlightDiscussionId:void 0,theme:p,intl:c().A.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName,currentUserId:k,getPublicBaseUrlForPage:C,externalIntegrations:f().A.integrations.state,formulaValueTypes:s,emojiData:d().A.state,isMobileNative:b,isMobileNativeExternalLinkFixEnabled:y().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:S.style,classNames:e,index:t,token:m,tokenValue:a().N8A(m),tokenAnnotations:a().uPN(m)})}{const o=[e.classNames||"",...S.classNames||[],...E?["formula-error-underline"]:[]];return(0,g.jsx)("span",{className:o.join(" ").trim(),style:S.style,"data-token-index":e.textTokenIndex,children:e.value},t)}}))}({store:S,parentSpaceId:C,valueTypes:T,syntaxTokens:s().oE(B),textValue:P,theme:M,isAndroid:v,isSafariOrIOS:b,isWindows:k,isMobileNative:h,getPublicBaseUrlForPage:p,currentUserId:t,hoveredErrorRange:A}),L=(0,g.jsxs)(n.Fragment,{children:[_,(0,g.jsx)("span",{children:"\n"})]});return r().A.renderToStaticMarkup(L)}function x(e){return p().KH(e)?[e.data]:p().vq(e)?[e.textContent||"",e.className]:void 0}},633904:(e,t,o)=>{o.d(t,{l:()=>x,t:()=>h});o(16280);var n=o(296540),i=()=>o(484714),r=()=>o(847249),a=()=>o(912720),l=()=>o(534177),s=()=>o(751156),u=(o(898992),o(737550),()=>o(199378)),d=()=>o(496603),p=()=>o(630116);function c(e,t){var o,n;const i=null==e?void 0:e.getModel(),r=null==t?void 0:t.getModel();if(!t||!r)return!0;if(i&&(null===(o=i.getProperties())||void 0===o?void 0:o.name)!==(null===(n=r.getProperties())||void 0===n?void 0:n.name))return!0;return!(!i||i.getStatus()===r.getStatus())||(!!function(e,t){const o=null==e?void 0:e.getModel(),n=t.getModel();if(!n)return!0;if((0,l().O9)(o)){if(o.isEventType()&&n.isEventType()){const e=o.getEventConfiguration(),t=n.getEventConfiguration();return!(0,d().n4)(e,t)}if(o.isRecurrenceType()&&n.isRecurrenceType()){const e=o.getRecurrence(),t=n.getRecurrence();return!(0,d().n4)(e,t)}return!o.isButtonType()||!n.isButtonType()}if(n.isEventType()){const e=n.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(n.isRecurrenceType())return!0;if(n.isButtonType())return!1;(0,l().HB)(n)}(e,t)||!!function(e,t){const o=t.getSpaceId();if(!o)return!1;if((0,l().O9)(e)){const n=e.getActionIds(),i=t.getActionIds();return n.length!==i.length||!(0,d().n4)(n,i)||n.some((n=>{const i={id:n,spaceId:o,table:u().SC},r=p().bx.createChildStore(e,i).getModel(),a=p().bx.createChildStore(t,i).getModel();return!(0,l().O9)(r)||!(0,l().O9)(a)||!(0,d().n4)(r.getConfig(),a.getConfig())}))}return t.getActionIds().length>0}(e,t))}var m=()=>o(186445),y=()=>o(841696),f=()=>o(246125),g=()=>o(6731),v=()=>o(351360);function x(e){const t=new(y().Z)({deadlockTimeoutMs:s().DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve(void 0)}}function h(e){const{automationId:t,spaceId:o,defaultValue:u,persist:d}=e,y=(0,i().v3)(),x=(0,r().K8)((()=>{var e;return null===(e=v().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),h=(0,n.useMemo)((()=>{if(t&&o)return{id:t,table:a().yB,spaceId:o}}),[t,o]),b=(0,f().l)("useUnpersistedAutomationStore",{cacheFallback:y.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),k=(0,n.useMemo)((()=>{if(!h)return;const e=b.getEntry({pointer:h,userId:x});if(!(0,l().O9)(e)&&x){if(!u)throw new Error("create is true but no defaultValue provided");b.setRecord({pointer:h,userId:x},{role:"editor",value:u})}return new(p().dn)(y,h,{inMemoryRecordCache:b})}),[u,y,h,b,x]),C=(0,r().K8)((()=>{const e=m().ao();if(h&&e)return p().dn.createChildStore(e,h)}),[h]),I=d?C:k,S=(0,r().K8)((()=>!d&&c(C,k)),[d,C,k]),{createAndCommit:M}=(0,g().D)({unpersistedInMemoryRecordCache:b}),T=(0,n.useCallback)((e=>d?s().createAndCommit({...e,canUndo:!0,environment:y}):M(e)),[M,y,d]);return{maybePersistedTransactionActions:{createAndCommit:T},maybePersistedAutomationStore:I,hasUnpersistedChanges:S}}},647702:(e,t,o)=>{o.d(t,{K:()=>x,d:()=>v});o(898992),o(354520),o(672577),o(581454);var n=()=>o(221844),i=()=>o(792071),r=()=>o(519831),a=()=>o(869558),l=()=>o(234459),s=()=>o(743246),u=()=>o(725649),d=()=>o(496603),p=()=>o(166442),c=()=>o(890754),m=()=>o(921855),y=()=>o(630116),f=()=>o(94522),g=()=>o(269643);function v(e){const{environment:t,collectionStore:o,collectionViewBlockStore:v,freezeTitle:x}=e,h=t.currentUser.id;if(!h)return;const{propertyFilters:b,combinatorFilter:k}=function(e){var t,o,n;let{environment:i,collectionStore:a,collectionViewBlockStore:d}=e;const m=null==d||null===(t=d.getFormat())||void 0===t?void 0:t.workflow_id;if(!m)return;const g=y().NU.createChildStore(d,{table:s().C0,id:m,spaceId:null==d?void 0:d.getSpaceId()}),v=(0,c().getChatSidebarState)(i);if(!0!==(null==v?void 0:v.isOpen)||!0===v.isNewThread)return;const x=(0,f().n2)({clientStore:p().Kd,workflowStore:g,environment:i,threadStore:y().Ei.createChildStore(d,{table:l().To,id:v.threadId,spaceId:d.getSpaceId()}),store:d});if(!x)return;const h=null===(o=x.modules)||void 0===o?void 0:o.filter((e=>"database"===e.type)).find((e=>{var t;const o=null===(t=(0,u().DK)(e.state))||void 0===t?void 0:t.pointer;return(null==o?void 0:o.table)===r().Vl&&(null==o?void 0:o.id)===a.id})),b=null===(n=(0,u().DK)(null==h?void 0:h.state))||void 0===n?void 0:n.filter;if(!b)return;return{propertyFilters:b.propertyFilters,combinatorFilter:b.combinatorFilter}}({environment:t,collectionStore:o,collectionViewBlockStore:v})??{},C=function(e){var t,o;const{collectionStore:n,userId:i,spaceId:a,idCreator:l,propertyFilters:s,combinatorFilter:u,freezeTitle:p=!0}=e,c=n.getSchema(),y=Object.keys(c),f=null===(t=n.getModel())||void 0===t?void 0:t.parent_id;if(!f)return;const v=(0,d().Ul)(y,((e,t)=>"title"===e?-1:t)).map((e=>({property:e,visible:!0})));return{id:(0,g().D)(l,a,n.id),version:1,parent_id:f,parent_table:"block",alive:!0,space_id:a,created_by_id:i,created_by_table:"notion_user",last_edited_by_id:i,last_edited_by_table:"notion_user",type:"table",name:(0,m().r4)(null===(o=n.getModel())||void 0===o?void 0:o.getName(),n),format:{table_properties:v,table_wrap:!0,table_frozen_column_index:p?0:void 0,collection_pointer:{table:r().Vl,id:n.id,spaceId:a},collection_view_source:{type:"collection",id:n.id,spaceId:a},hide_linked_collection_name:!0,property_filters:s},query2:{sort:[],aggregations:[],filter:u},page_sort:[]}}({collectionStore:o,userId:t.currentUser.id,spaceId:o.getSpaceId(),idCreator:t.idCreator,propertyFilters:b,combinatorFilter:k,freezeTitle:x});if(!C)return;const I={table:a().Gy,id:C.id,spaceId:o.getSpaceId()},S=new(n().A)({name:"temporaryCache",isTemporaryData:!0});S.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),S.setModelAndRole({pointer:I,userId:h},i().Bj6.fromCollectionView(C),"editor");return new(y().pS)(t,{table:a().Gy,id:I.id},{inMemoryRecordCache:S})}function x(e){let{collectionContextStore:t,permissionScopes:o}=e;return!("collectionTypedView"!==t.contextType||!o.canConfigureBlock)||o.canConfigureCollection}},781697:(e,t,o)=>{o.d(t,{e:()=>l,v:()=>a});var n=()=>o(484714),i=()=>o(847249),r=()=>o(722872);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:r().gu.ActionSheet}:{menuType:r().gu.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,n().Y0)();return(0,i().K8)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},833682:(e,t,o)=>{o.d(t,{v:()=>Pt});o(944114),o(898992),o(354520),o(803949),o(581454);var n=o(296540),i=()=>o(484714),r=()=>o(847249),a=()=>o(401497),l=()=>o(563015),s=()=>o(106714),u=()=>o(977345),d=()=>o(416504),p=()=>o(591779),c=()=>o(450648),m=()=>o(919709),y=()=>o(959013),f=()=>o(496603),g=()=>o(973647),v=()=>o(534177),x=()=>o(284371),h=()=>o(884107),b=()=>o(725614),k=()=>o(862292),C=()=>o(989423),I=()=>o(847743),S=()=>o(231722),M=()=>o(645873),T=()=>o(351360),P=()=>o(24157),A=()=>o(164891),w=()=>o(545805),E=()=>o(206267),F=()=>o(386164),j=()=>o(532659),D=()=>o(449506),B=()=>o(901389),R=()=>o(319975),_=()=>o(751156);var L=()=>o(938987),H=()=>o(84817),N=()=>o(704152),Y=()=>o(805751),V=()=>o(623580),U=()=>o(554509),K=o(474848);const W=n.memo((function(e){const{formulaAssistantStore:t,onStop:o,onSubmit:i}=e,l=(0,y().tz)(),{prompt:s,inputMode:u}=(0,r().K8)((()=>{const{state:e}=t;return{prompt:e.prompt,inputMode:e.inputMode}}),[t]),d=(0,n.useCallback)((()=>{i(t.state.prompt)}),[t,i]),p=(0,n.useCallback)((e=>{t.update((t=>({...t,prompt:e})))}),[t]),c=(0,a().IS)((e=>({wrapper:{borderTop:`1px solid ${e.stroke.secondary}`,background:e.popoverBackground}})),[]);return(0,K.jsx)(Y().A,{capture:!0,debugName:"FormulaAssistantInput",priority:1,children:(0,K.jsxs)(H().Y1,{direction:"horizontal",align:"top-left",gap:6,padding:"9px 12px",style:c.wrapper,children:[(0,K.jsx)(H().Y1,{width:20,height:28,align:"center",children:(0,K.jsx)(L().iB,{})}),(0,K.jsx)(H().Y1,{width:"fill",children:"busy"===u?(0,K.jsx)($,{}):(0,K.jsx)(U().D,{styleName:"Body-14px/Regular",children:(0,K.jsx)(Y().A,{debugName:"FormulaAssistantInput_PromptInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:(0,K.jsx)(V().A,{format:V().C.Transparent,placeholder:l.formatMessage(q(u)),selectAll:!1,value:s,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:5,paddingBottom:3},onSubmit:e=>{s&&(e.stopPropagation(),d())},onChange:e=>{p(e.target.value)},focusInitial:!0})})})}),"busy"===u?(0,K.jsx)(z,{onStop:o}):(0,K.jsx)(O,{onSubmit:d,isEnabled:s.length>0})]})})}));function z(e){const{onStop:t}=e,o=(0,y().tz)(),{isPhone:n}=(0,i().Y0)(),r=(0,a().IS)((e=>({lightweightButton:{display:"flex",alignItems:"baseline",justifyContent:"center",fontSize:14,padding:"5px 8px",borderRadius:4,color:e.text.secondary,height:32,marginTop:2},keyboardShortcut:{textTransform:"uppercase",fontWeight:500,fontSize:11,marginLeft:6,color:e.text.tertiary,display:n?"none":void 0}})),[n]);return(0,K.jsx)(w().A,{debugName:"FormulaAssistantInput_StopButton",capture:!0,onEnter:t,onEsc:t,priority:1,children:(0,K.jsx)(H().Y1,{width:"hug",height:28,align:"center",children:(0,K.jsxs)(N().A,{style:r.lightweightButton,onClick:t,children:[o.formatMessage(G.cancel),(0,K.jsx)("span",{style:r.keyboardShortcut,children:o.formatMessage(G.cancelShortcut)})]})})})}function O(e){const{isEnabled:t,onSubmit:n}=e;return(0,K.jsx)(H().Y1,{width:"hug",height:28,align:"center",children:(0,K.jsx)(o(247345).J,{onSubmit:n,canSend:t})})}function $(){const e=(0,y().tz)();return(0,K.jsxs)(H().Y1,{direction:"horizontal",gap:6,height:28,align:"center-left",children:[(0,K.jsx)(U().D,{styleName:"Body-14px/Regular",colorName:"secondary",children:e.formatMessage(G.assistantIsBusy)}),(0,K.jsx)(o(135221).A,{isTriColored:!0})]})}function q(e){switch(e){case"initial":return G.initialPlaceholder;case"followUp":case"busy":return G.subsequentPlaceholder;default:(0,v().HB)(e)}}const G=(0,y().YK)({cancel:{id:"formulaAssistantInput.cancel",defaultMessage:"Cancel"},cancelShortcut:{id:"formulaAssistantInput.cancelShortcut",defaultMessage:"esc"},initialPlaceholder:{id:"formulaAssistantInput.initialPlaceholder",defaultMessage:"What do you want the formula to do?"},subsequentPlaceholder:{id:"formulaAssistantInput.subsequentPlaceholder",defaultMessage:"What do you want to do next?"},assistantIsBusy:{id:"formulaAssistantInput.assistantIsBusy",defaultMessage:"Notion AI is writing"}});class Q extends(()=>o(757695))().default{constructor(){super(...arguments),this.hideAssistant=()=>{this.update((e=>({...e,isAssistantVisible:!1})))},this.toggleAssistantVisible=()=>{this.update((e=>({...e,isAssistantVisible:!e.isAssistantVisible})))},this.didBeginRequest=()=>{this.update((e=>({...e,inputMode:"busy"})))},this.didFinishRequest=()=>{this.update((e=>({...e,prompt:"",inputMode:"followUp"})))}}getInitialState(){return{id:E().JW(),inputMode:"initial",isAssistantVisible:!1,prompt:""}}}var J=()=>o(743176),Z=()=>o(247331),X=()=>o(145076),ee=()=>o(307663);const te={true:{name:"true",type:{type:"checkbox"},description:X().Q$.true,examples:[{input:"true"},{input:[(0,ee().Py)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:X().Q$.false,examples:[{input:"false"},{input:[(0,ee().Py)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:X().Q$.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,ee().Py)("Naughty"),[" && "],(0,ee().Py)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:X().Q$.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,ee().Py)("Naughty"),[" || "],(0,ee().Py)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:X().Q$.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,ee().Py)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:X().Q$["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:X().Q$["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:X().Q$["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:X().Q$["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:X().Q$["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:X().Q$["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:X().Q$["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:X().Q$["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:X().Q$[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:X().Q$["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:X().Q$[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:X().Q$["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var oe=()=>o(972435),ne=()=>o(722872),ie=()=>o(970585),re=()=>o(736767),ae=()=>o(760217),le=()=>o(406699),se=()=>o(928600),ue=()=>o(939740),de=()=>o(89924),pe=()=>o(67657);const ce=(0,y().YK)({property:{id:"formula2Input.propertyHelper.descriptionGeneric",defaultMessage:"Database property."},titlePropertyDescription:{id:"formulaLibrary.property.title.description",defaultMessage:"Title property."},textPropertyDescription:{id:"formulaLibrary.property.text.description",defaultMessage:"Text property."},urlPropertyDescription:{id:"formulaLibrary.property.url.description",defaultMessage:"URL property."},emailPropertyDescription:{id:"formulaLibrary.property.email.description",defaultMessage:"Email property."},phoneNumberPropertyDescription:{id:"formulaLibrary.property.phoneNumber.description",defaultMessage:"Phone number property."},selectPropertyDescription:{id:"formulaLibrary.property.select.description",defaultMessage:"Select property."},multiSelectPropertyDescription:{id:"formulaLibrary.property.multiSelect.description",defaultMessage:"Multi-select property, list."},statusPropertyDescription:{id:"formulaLibrary.property.status.description",defaultMessage:"Status property."},checkboxPropertyDescription:{id:"formulaLibrary.property.checkbox.description",defaultMessage:"Checkbox property."},datePropertyDescription:{id:"formulaLibrary.property.date.description",defaultMessage:"Date property."},personPropertyDescription:{id:"formulaLibrary.property.person.description",defaultMessage:"Person property, list."},relationPropertyDescription:{id:"formulaLibrary.property.relation.description",defaultMessage:"Relation property, list."},rollupPropertyDescriptionList:{id:"formulaLibrary.property.rollup.description",defaultMessage:"Rollup property, list."},rollupPropertyDescription:{id:"formulaLibrary.property.rollup.descriptionWithList",defaultMessage:"Rollup property."},numberPropertyDescription:{id:"formulaLibrary.property.number.description",defaultMessage:"Number property."},formulaPropertyDescription:{id:"formulaLibrary.property.formula.description",defaultMessage:"Formula property."},formulaPropertyDescriptionList:{id:"formulaLibrary.property.formula.descriptionWithList",defaultMessage:"Formula property, list."},createdTimePropertyDescription:{id:"formulaLibrary.property.createdTime.description",defaultMessage:"Created time property."},lastEditedTimePropertyDescription:{id:"formulaLibrary.property.lastEditedTime.description",defaultMessage:"Last edited time property."},createdByPropertyDescription:{id:"formulaLibrary.property.createdBy.description",defaultMessage:"Created by property."},lastEditedByPropertyDescription:{id:"formulaLibrary.property.lastEditedBy.description",defaultMessage:"Last edited by property."},filePropertyDescription:{id:"formulaLibrary.property.file.description",defaultMessage:"File property, list."},autoincrementIdDescription:{id:"formulaLibrary.property.autoincrementId.description",defaultMessage:"ID property."}}),me={title:{name:"title",type:{type:"text"},description:ce.titlePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.style("b")']],isCopyable:!0},{input:[(0,ee().Py)("Full Name"),['.split(" ").at(0)']]}]:[{input:[(0,ee().Py)("Title")]},{input:[(0,ee().Py)("Title"),['.style("b")']]},{input:[(0,ee().Py)("Name"),['.split(" ").at(0)']]}]},text:{name:"text",type:{type:"text"},description:ce.textPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[["upper("],(0,ee().Y2)(e),[")"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.style("b", "red")']],isCopyable:!0}]:[{input:[["upper("],(0,ee().Py)("Name"),[")"]]},{input:[(0,ee().Py)("Name"),['.style("b", "red")']]}]},url:{name:"url",type:{type:"text"},description:ce.urlPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Link", '],(0,ee().Y2)(e),[').style("green") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("URL"),[' ? link("Link", '],(0,ee().Py)("URL"),[').style("green") : ""']]}]},email:{name:"email",type:{type:"text"},description:ce.emailPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Email", "mailto:" + '],(0,ee().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("Email"),[' ? link("Email", "mailto:" + '],(0,ee().Py)("Email"),[').style("blue") : ""']]}]},phone_number:{name:"phone_number",type:{type:"text"},description:ce.phoneNumberPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' ? link("Call", "tel:" + '],(0,ee().Y2)(e),[').style("blue") : ""']],isCopyable:!0}]:[{input:[(0,ee().Py)("Email"),[' ? link("Call", "tel:" + '],(0,ee().Py)("Email"),[').style("blue") : ""']]}]},number:{name:"number",type:{type:"number"},description:ce.numberPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,ee().Y2)(e),[" ^ 2"]],isCopyable:!0}]:[{input:[(0,ee().Py)("Cost"),[" / "],(0,ee().Py)("Total Units")]},{input:[["pi() * "],(0,ee().Py)("Radius"),[" ^ 2"]]}]},select:{name:"select",type:{type:"text"},description:ce.selectPropertyDescription,examples:e=>{const t=[{input:[(0,ee().Py)("Priority"),[' == "High"']]},{input:[['["Feature", "Bug"].includes('],(0,ee().Py)("Task Type"),[")"]]}];return e&&t.unshift({input:[(0,ee().Y2)(e)],isCopyable:!0}),t}},multi_select:{name:"select",type:{type:"array",of:{type:"text"}},description:ce.multiSelectPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Py)("Tags"),['.includes("Finance")']]}]:[{input:[(0,ee().Py)("Tags"),[".length()"]]},{input:[(0,ee().Py)("Tags"),['.includes("Finance")']]}]},status:{name:"status",type:{type:"text"},description:ce.statusPropertyDescription,examples:e=>"Status"===(null==e?void 0:e.name)?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[' == "Done"']],isCopyable:!0},{input:[['["Not started", "In progress"].includes('],(0,ee().Y2)(e),[")"]],isCopyable:!0}]:[{input:[(0,ee().Py)("Status"),[' == "Done"']]},{input:[['["Not started", "In progress"].includes('],(0,ee().Py)("Status"),[")"]]}]},checkbox:{name:"checkbox",type:{type:"checkbox"},description:ce.checkboxPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[["not "],(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Py)("Signed"),[" and "],(0,ee().Py)("Sealed"),[" and "],(0,ee().Py)("Delivered")]}]:[{input:[["not"],(0,ee().Py)("Done")]},{input:[(0,ee().Py)("Signed"),[" and "],(0,ee().Py)("Sealed"),[" and "],(0,ee().Py)("Delivered")]}]},date:{name:"date",type:{type:"date"},description:ce.datePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[" > now()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[["dateBetween("],(0,ee().Y2)(e),[', now(), "days")']],isCopyable:!0}]:[{input:[(0,ee().Py)("Due Date"),[" > now()"]]},{input:[["formatDate("],(0,ee().Py)("Date"),[', "YYYY/MM/DD HH:mm")']]},{input:[["dateBetween("],(0,ee().Py)("Birthday"),[', now(), "days")']]}]},person:{name:"person",type:{type:"array",of:{type:"text"}},description:ce.personPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".at(0)"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".map(current.email())"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.some(current.name() == "Alice")']]}]:[{input:[(0,ee().Py)("Participants"),[".at(0)"]]},{input:[(0,ee().Py)("Participants"),[".length()"]]},{input:[(0,ee().Py)("Participants"),['.some(current.name() == "Alice")']]}]},relation:{name:"relation",type:{type:"array",of:{type:"block"}},description:ce.relationPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Py)("Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' != "Done")']]}]:[{input:[(0,ee().Py)("Tasks"),[".length()"]]},{input:[(0,ee().Py)("Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' != "Done")']]}]},rollup:{name:"rollup",type:e=>{if("rollup"===(null==e?void 0:e.type)&&("show_unique"===e.aggregation||void 0===e.aggregation))return{type:"array",of:{type:"unknown"}};if(e&&"aggregation"in e&&void 0!==e.aggregation){return{type:(0,pe().ou)((0,pe().ZP)(e.aggregation))}}return{type:"unknown"}},description:e=>"rollup"!==(null==e?void 0:e.type)||"show_unique"!==e.aggregation&&void 0!==e.aggregation?ce.rollupPropertyDescription:ce.rollupPropertyDescriptionList,examples:(e,t)=>{let o;return o=!t||"rollup"!==(null==t?void 0:t.type)||"show_unique"!==t.aggregation&&void 0!==t.aggregation?[{input:[(0,ee().Py)("Average cost"),[" * 12"]]},{input:[(0,ee().Py)("Sum of customers"),[" > 100"]]}]:[void 0!==e?{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0}:{input:[(0,ee().Py)("Purchases"),[".length()"]]},{input:[["sum("],(0,ee().Py)("Purchases"),[".map(current."],(0,ee().Py)("Cost"),["))"]]}],e&&o.unshift({input:[(0,ee().Y2)(e)],isCopyable:!0}),o}},file:{name:"file",type:{type:"array",of:{type:"text"}},description:ce.filePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),['.filter(current.match(".pdf$"))']],isCopyable:!0},{input:[(0,ee().Y2)(e),['.map(link("File", current))']],isCopyable:!0}]:[{input:[(0,ee().Py)("Attachments"),[".length()"]]},{input:[(0,ee().Py)("Attachments"),['.filter(current.match(".pdf$"))']]},{input:[(0,ee().Py)("Attachments"),['.map(link("File", current))']]}]},formula:{name:"formula",type:e=>{var t,o,n;return e&&"formula2"in e&&null!==(t=e.formula2)&&void 0!==t&&null!==(t=t.result_type)&&void 0!==t&&t.type?e.formula2.result_type:e&&"formula"in e&&null!==(o=e.formula)&&void 0!==o&&o.result_type?{type:null===(n=e.formula)||void 0===n?void 0:n.result_type}:{type:"unknown"}},description:e=>{var t;return e&&"formula2"in e&&"array"===(null===(t=e.formula2)||void 0===t||null===(t=t.result_type)||void 0===t?void 0:t.type)?ce.formulaPropertyDescriptionList:ce.formulaPropertyDescription},examples:(e,t)=>{var o,n;let i={type:"unknown"};if(t&&"formula2"in t&&null!==(o=t.formula2)&&void 0!==o&&null!==(o=o.result_type)&&void 0!==o&&o.type)i=t.formula2.result_type;else if(t&&"formula"in t&&null!==(n=t.formula)&&void 0!==n&&n.result_type){var r;i={type:null===(r=t.formula)||void 0===r?void 0:r.result_type}}if(!e)return[];const a=[{input:[(0,ee().Y2)(e)],isCopyable:!0}];switch(i.type){case"array":switch(a.push({input:[(0,ee().Y2)(e),[".length()"]],isCopyable:!0}),i.of.type){case"text":a.push({input:[(0,ee().Y2)(e),['.join("\\n")']],isCopyable:!0});break;case"number":a.push({input:[(0,ee().Y2)(e),[".sum()"]],isCopyable:!0});break;case"date":a.push({input:[(0,ee().Y2)(e),['.map(dateBetween(now(), current, "days"))']],isCopyable:!0});break;case"person":a.push({input:[(0,ee().Y2)(e),[".map(current.name())"]],isCopyable:!0}),a.push({input:[(0,ee().Y2)(e),[".some(current.name() == 'Alice')"]],isCopyable:!0});break;case"checkbox":a.push({input:[(0,ee().Y2)(e),[".every(current == true)"]],isCopyable:!0});break;case"block":a.push({input:[(0,ee().Py)("Primary Tasks"),[".filter(current."],(0,ee().Py)("Status"),[' == "Done")']]})}break;case"number":a.push({input:[(0,ee().Y2)(e),[" * 2 > 100"]],isCopyable:!0});break;case"text":a.push({input:[(0,ee().Y2)(e),[".upper()"]],isCopyable:!0});break;case"date":a.push({input:[(0,ee().Y2)(e),[" > now()"]],isCopyable:!0});break;case"person":a.push({input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0});break;case"checkbox":a.push({input:[["not "],(0,ee().Y2)(e)],isCopyable:!0});break;case"block":a.push({input:[(0,ee().Y2)(e),[".map(current."],(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[")"]]})}return a}},created_time:{name:"created_time",type:{type:"date"},description:ce.createdTimePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,ee().Y2)(e),[' > dateSubtract(now(), 1, "years")']],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedTime),['.dateAdd(1, "weeks")']]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedTime),[' > dateSubtract(now(), 1, "years")']]}]},last_edited_time:{name:"last_edited_time",type:{type:"date"},description:ce.lastEditedTimePropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.dateAdd(1, "weeks")']],isCopyable:!0},{input:[(0,ee().Y2)(e),[' > dateSubtract(now(), 1, "month")']],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),['.dateAdd(1, "weeks")']]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedTime),[' > dateSubtract(now(), 1, "month")']]}]},created_by:{name:"created_by",type:{type:"person"},description:ce.createdByPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".name()"]]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy),[".email()"]]}]},last_edited_by:{name:"last_edited_by",type:{type:"person"},description:ce.lastEditedByPropertyDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),[".name()"]],isCopyable:!0},{input:[(0,ee().Y2)(e),[".email()"]],isCopyable:!0}]:[{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".name()"]]},{input:[(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.LastEditedBy),[".email()"]]}]},auto_increment_id:{name:"auto_increment_id",type:{type:"number"},description:ce.autoincrementIdDescription,examples:e=>e?[{input:[(0,ee().Y2)(e)],isCopyable:!0},{input:[(0,ee().Y2)(e),['.split("-").first() /* Prefix */']],isCopyable:!0},{input:[(0,ee().Y2)(e),['.split("-").last().toNumber() /* ID */']],isCopyable:!0}]:[{input:[(0,ee().Py)("ID Code")]},{input:[(0,ee().Py)("Task ID"),['.split("-").first() /* Prefix */']],output:'"TASK"'},{input:[(0,ee().Py)("Task ID"),['.split("-").last().toNumber() /* ID */']],output:"123"}]},button:null,location:null,last_visited_time:null,verification:null,geo_point:null},ye={text:{examples:e=>e?[{input:[(0,ee().HH)({id:e.id})]},{input:[["upper("],(0,ee().HH)({id:e.id}),[")"]]},{input:[(0,ee().HH)({id:e.id}),['.style("b", "red")']]}]:[]},number:{examples:e=>e?[{input:[(0,ee().HH)(e)],isCopyable:!0},{input:[(0,ee().HH)(e),[" / 2"]],isCopyable:!0},{input:[["pi() * "],(0,ee().HH)(e),[" ^ 2"]],isCopyable:!0}]:[]},checkbox:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[["not "],(0,ee().HH)(e)]}]:[]},date:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[" > now()"]]},{input:[(0,ee().HH)(e),['.dateAdd(1, "weeks")']]},{input:[["dateBetween("],(0,ee().HH)(e),[', now(), "days")']]}]:[]},block:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".format()"]]},{input:[(0,ee().HH)(e),["."],(0,ee().pC)(Z().FormulaTokenSupportedBlockSystemProperty.CreatedBy)]}]:[]},person:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".email()"]]},{input:[(0,ee().HH)(e),['.name() == "Alice"']]}]:[]},array:{examples:e=>e?[{input:[(0,ee().HH)(e)]},{input:[(0,ee().HH)(e),[".length()"]]},{input:[(0,ee().HH)(e),[".at(0).format()"]]}]:[]},select:null,function:null,unknown:null};var fe=()=>o(925907),ge=()=>o(979004),ve=()=>o(191772),xe=()=>o(780054),he=()=>o(354584),be=()=>o(712030),ke=()=>o(267419),Ce=()=>o(713972),Ie=()=>o(141768),Se=()=>o(47170),Me=()=>o(508496),Te=()=>o(285790);const Pe=n.memo((function(e){let{infoHelper:t,getRecordModel:o,style:n,typecheckContextValues:i}=e;const r=t;if(void 0===(null==r?void 0:r.kind))return null;switch(r.kind){case Z().FormulaEditorInfoCompletionKind.Token:return(0,K.jsx)(Ee,{completion:r,getRecordModel:o,style:n,typecheckContextValues:i});case Z().FormulaEditorInfoCompletionKind.LibraryFunction:{const e=Boolean(null==t?void 0:t.calledFromUnifiedFunctionProperty),i=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(r.libraryFunction,e),a=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(r.libraryFunction,e),l=r.libraryFunction.returnType;return(0,K.jsx)(we,{icon:Ve("function"==typeof l?l([]).type:l.type),name:i,description:oe().A.formatMessage(r.libraryFunction.description),examples:a.length>0?a.map(((e,t)=>(0,K.jsx)(Ae,{example:e,getRecordModel:o},t))):void 0,style:n})}case Z().FormulaEditorInfoCompletionKind.Binding:var a;return r.text===Z().CURRENT_VALUE_NAME?(0,K.jsx)(we,{icon:Ve(r.type.type),name:r.text,description:oe().A.formatMessage(Re.currentValueDescription),style:n}):r.text===Z().CURRENT_INDEX_NAME?(0,K.jsx)(we,{icon:Ve(r.type.type),name:r.text,description:oe().A.formatMessage(Re.currentIndexDescription),style:n}):(0,K.jsx)(we,{icon:Ve(r.type.type),name:r.text,description:oe().A.formatMessage("array"===(null==r||null===(a=r.type)||void 0===a?void 0:a.type)?Re.listVariableType:Re.variableType),style:n});case Z().FormulaEditorInfoCompletionKind.Builtin:{const e=te[r.builtin];return(0,K.jsx)(we,{icon:Ve(e.type.type),name:e.name,description:oe().A.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,t)=>(0,K.jsx)(Ae,{example:e,getRecordModel:o},t))):void 0,style:n})}default:return(0,v().HB)(r)}}));function Ae(e){let{example:t,getRecordModel:o,typecheckContextValues:l}=e;const s=(0,M().fJ)(he().y),u=(0,be().Ol)(),p=(0,i().v3)(),{device:g}=p,v=(0,Se().O)(),x=(0,a().DP)(),b=(0,y().tz)(),k=(0,ke()._)(),C=(0,r().K8)((()=>{var e;const n=document.createElement("div"),i="string"!=typeof t.input?m().q4_(t.input):t.input,r=(null===(e=s.value)||void 0===e?void 0:e.highlight(`${i}`,s.value.languages[ge().PrismLanguages.notion],ge().PrismLanguages.notion))??"";n.innerHTML=Ie().bi(r);const a=f().oE(Array.from(n.childNodes).map(De)),c="string"==typeof t.input?[[t.input],[" = "]]:t.input.concat([[" = "]]),y=Ie().YH(c,f().oE(a)),h=c.map(m().uPN).map(((e,t)=>ve().sT({annotations:e,theme:x,getRecordModel:o,spaceId:v})));return y.map(((e,t)=>{const n=h[e.textTokenIndex],i=c[e.textTokenIndex];return m().qXl(i)?(0,ve().Au)({args:{textValue:{value:c,spaceId:v},getRecordModel:o,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,d().P)(),disabled:!1,isAndroid:g.isAndroid,isSafariOrIOS:g.isSafari||g.isIOS,isWindows:g.isWindows,showEmojiInline:g.isWindows,emojiType:u,highlightDiscussionId:void 0,theme:x,intl:b,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:xe().A.domainBaseUrl,publicDomainName:xe().A.publicDomainName,currentUserId:p.currentUser.id,getPublicBaseUrlForPage:void 0,externalIntegrations:[],formulaValueTypes:l??[],emojiData:k,isMobileNative:g.isMobileNative,isMobileNativeExternalLinkFixEnabled:Me().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0},style:n.style,classNames:n.classNames,index:t,token:i,tokenValue:m().N8A(i),tokenAnnotations:m().uPN(i)}):(0,K.jsx)("span",{className:[e.classNames||"",...n.classNames].join(" "),style:n.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}),[t.input,s.value,x,o,v,g.isAndroid,g.isSafari,g.isIOS,g.isWindows,g.isMobileNative,u,b,p.currentUser.id,l,k]),I=(0,r().K8)((()=>Array.isArray(t.output)?(0,ve().S5)({textValue:{value:t.output,spaceId:v},getRecordModel:o,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disableLinks:!1,userTimeZone:(0,d().P)(),disabled:!1,isAndroid:g.isAndroid,isSafariOrIOS:g.isSafari||g.isIOS,isWindows:g.isWindows,showEmojiInline:g.isWindows,emojiType:u,theme:x,intl:b,katex:void 0,isClient:!0,baseUrl:xe().A.domainBaseUrl,publicDomainName:xe().A.publicDomainName,currentUserId:p.currentUser.id,getPublicBaseUrlForPage:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:k,isMobileNative:g.isMobileNative,isMobileNativeExternalLinkFixEnabled:Me().default.checkGate({gateName:"mobile_native_external_link_fix"}),displayInUserTimezone:!0}):t.output),[g.isAndroid,g.isIOS,g.isSafari,g.isWindows,g.isMobileNative,k,u,p.currentUser.id,t.output,o,b,v,x]),S=!1!==t.isCopyable&&("string"==typeof t.input||!0===t.isCopyable),T=(0,n.useCallback)((async()=>{if(S){const e=(Array.isArray(t.input)?(0,c().r4)({intl:b,textValue:t.input,getRecordModel:o,userTimeZone:(0,d().P)()}):t.input).replaceAll(/\/\*.*\*\//g,"").trim();(await h().R.clipboardActions.load()).copyString({stringValue:e,environment:p,copiedMessage:Be.copiedExampleMessage})}}),[p,t.input,o,b,S]),P=(0,a().IS)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.stroke.secondary}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:12,width:12}})),[]);return(0,K.jsxs)("div",{style:P.code,children:[(0,K.jsxs)("div",{style:P.left,children:[(0,K.jsx)("div",{children:C}),I?(0,K.jsxs)("div",{children:["= ",I]}):null]}),S?(0,K.jsx)("div",{style:P.right,children:(0,K.jsx)(Te().A,{ariaLabel:b.formatMessage(Be.copyToClipboard),onClick:T,icon:fe().n,style:P.copyButton,iconStyle:P.copyButtonIcon,disallowTabbing:!0})}):null]})}function we(e){let{name:t,icon:o,description:n,examples:i,style:r}=e;const l=(0,a().IS)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...r},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.text.secondary},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6},examples:{display:"flex",flexDirection:"column",gap:4}})),[r]);return(0,K.jsxs)("div",{style:l.helper,children:[(0,K.jsxs)("span",{style:l.name,children:[void 0!==o&&o(l.iconStyle),t]}),void 0!==n&&(0,K.jsx)("span",{style:l.description,children:n}),void 0!==i&&(0,K.jsx)("div",{style:l.examples,children:i})]})}function Ee(e){let{completion:t,getRecordModel:o,style:n,typecheckContextValues:i}=e;const{name:a,description:l,icon:s,examples:d}=(0,r().K8)((()=>{if(!o)return{};if(t.token.type===Z().FormulaTokenType.BlockProperty){var e;if((0,u().ix)(t.token))return{};if(Z().FormulaTokenSupportedBlockSystemPropertyList.includes(t.token.property)&&!t.token.collection){var n;const e=null===(n=Z().FormulaTokenSupportedBlockSystemPropertyToType[t.token.property])||void 0===n?void 0:n.type,i=e?J().LE[e]:void 0,r=me[t.token.property],a="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,l=t.name??t.token.property;return{name:l,icon:i,description:a?oe().A.formatMessage(a):void 0,examples:null!==r?Fe(r,o,{collection:t.token.collection,property:t.token.property,name:l},{name:l,type:t.token.property}):void 0}}if(!t.token.collection)return{};const i=(0,u().Yi)(t.token.property),r=o(t.token.collection),a=null==r||null===(e=r.getNormalizedSchema())||void 0===e?void 0:e[i];if(!a)return{};const l=me[a.type];return l?{name:t.name,icon:J().LE[a.type],description:oe().A.formatMessage("function"==typeof l.description?l.description(a):l.description),examples:Fe(l,o,{collection:t.token.collection,property:i,name:t.name},a)}:{}}if(t.token.type===Z().FormulaTokenType.ContextValue){const e=(0,u()._H)(i,(0,u().GH)(t.token.valueId));if(!e||e.kind!==Z().FormulaContextValueKind.ContextValue)return{};const n=e.type.type,r=ye[n];return{name:e.name,description:e.description??e.tooltipName,icon:Ve(e.type.type),examples:null!=r&&r.examples?je(r,o,i,e):void 0}}if(t.token.type===Z().FormulaTokenType.Block||t.token.type===Z().FormulaTokenType.Checkbox||t.token.type===Z().FormulaTokenType.Date||t.token.type===Z().FormulaTokenType.Person)return{};(0,v().HB)(t.token)}),[t.name,t.token,o,i]);return void 0===a?null:(0,K.jsx)(we,{name:a,icon:s,description:l,examples:d,style:n})}function Fe(e,t,o,n){const i=e.examples;let r=[];return r="function"==typeof i?i(o,n).map(((e,o)=>(0,K.jsx)(Ae,{example:e,getRecordModel:t},o))):i.map(((e,o)=>(0,K.jsx)(Ae,{example:e,getRecordModel:t},o))),r.length>0?r:void 0}function je(e,t,o,n){const i=e.examples;let r=[];return r="function"==typeof i?i(n).map(((e,n)=>(0,K.jsx)(Ae,{example:e,getRecordModel:t,typecheckContextValues:o},n))):i.map(((e,n)=>(0,K.jsx)(Ae,{example:e,getRecordModel:t,typecheckContextValues:o},n))),r.length>0?r:void 0}function De(e){return Ce().KH(e)?[e.data]:Ce().vq(e)?[e.textContent||"",e.className]:void 0}const Be=(0,y().YK)({copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),Re=(0,y().YK)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."}});function _e(e){const{store:t,selection:o,cursorEditorInfo:l,cursorEditorInfoRef:s,context:d,onChange:p,getRecordModel:c,setInfoHelper:y}=e,g=(0,a().IS)((()=>({menu:{top:0,left:0,right:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),x=(0,i().Y0)(),h=(0,r().uB)(void 0,ie().A),b=(0,n.useMemo)((()=>{const e=f().$z((null==l?void 0:l.completions)??[],"kind");let n=-1;return Object.entries(e).map(((e,i)=>{const[r,a]=e,l=a.map(((e,r)=>{n+=1;const a=n;return{key:`${i}-${r}`,render:t=>(0,K.jsx)(Le,{...t,completion:e,context:d,getRecordModel:c,menuListStore:h,indexGlobal:a,cursorEditorInfoRef:s,setInfoHelper:y}),action:()=>{var n;void 0!==e&&s.current&&(y({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(n=s.current.completionsInfo)||void 0===n?void 0:n.type)}),function(e){var t;const{completion:o,store:n,selection:i,onChange:r,cursorEditorInfo:a}=e,l=(null==i?void 0:i.startIndex)||0,s=(null==i?void 0:i.endIndex)||0,d=l!==s,p=(null===(t=a.completionsInfo)||void 0===t?void 0:t.prefix)||"",c="overridePrefixLength"in o?o.overridePrefixLength??0:p.length,y=d?l:s-c,f=n.getValue();if(o.kind===Z().FormulaEditorInfoCompletionKind.Token){if(o.token.type===Z().FormulaTokenType.Checkbox)return;if(o.token.type===Z().FormulaTokenType.BlockProperty){if((0,u().ix)(o.token))return;const e=(0,m().lzV)(f,y,s),t=o.token.collection?(0,u().Yi)(o.token.property):o.token.property,n=(0,m().wmz)((0,m().ESw)({collection:o.token.collection,property:t,name:o.name}));return void r({newValue:(0,m().xym)(e,[n],y),newSelection:{startIndex:y+1,endIndex:y+1}})}if(o.token.type===Z().FormulaTokenType.ContextValue){const e=(0,m().lzV)(f,y,s),t=(0,u().GH)(o.token.valueId),n=(0,m().wmz)((0,m().CA$)({id:t}));r({newValue:(0,m().xym)(e,[n],y),newSelection:{startIndex:y+1,endIndex:y+1}})}else{if(o.token.type===Z().FormulaTokenType.Date||o.token.type===Z().FormulaTokenType.Block||o.token.type===Z().FormulaTokenType.Person)return;(0,v().HB)(o.token)}}else if(o.kind===Z().FormulaEditorInfoCompletionKind.LibraryFunction){var g,x,h,b;const e=(0,m().lzV)(f,y,s),t=(0,m().Ey_)(`${o.libraryFunction.name}()`,[]),n=(0,m().xym)(e,[t],y);let i=y+o.libraryFunction.name.length+1;void 0!==(null===(g=o.libraryFunction)||void 0===g||null===(g=g.parameters)||void 0===g?void 0:g.varargs)||null!==(x=o.libraryFunction)&&void 0!==x&&null!==(x=x.parameters)&&void 0!==x&&null!==(x=x.expected)&&void 0!==x&&x.length&&(1!==(null===(h=o.libraryFunction)||void 0===h||null===(h=h.parameters)||void 0===h||null===(h=h.expected)||void 0===h?void 0:h.length)||"member dot receiver"!==(null===(b=a.completionsInfo)||void 0===b?void 0:b.type))||(i+=1);r({newValue:n,newSelection:{startIndex:i,endIndex:i}})}else if(o.kind===Z().FormulaEditorInfoCompletionKind.Binding||o.kind===Z().FormulaEditorInfoCompletionKind.Builtin){const e=(0,m().lzV)(f,y,s),t=o.kind===Z().FormulaEditorInfoCompletionKind.Binding?o.text:`${o.builtin} `,n=(0,m().Ey_)(t,[]),i=(0,m().xym)(e,[n],y),a=y+t.length;r({newValue:i,newSelection:{startIndex:a,endIndex:a}})}else(0,v().HB)(o)}({completion:e,store:t,selection:o,onChange:p,cursorEditorInfo:s.current}))}}}));return{key:r,render:e=>(0,K.jsx)(de().A,{...e,style:g.menuSection,title:oe().A.formatMessage(We[r])}),items:l}}))}),[d,null==l?void 0:l.completions,s,c,h,p,o,y,t,g.menuSection]),k=(0,n.useCallback)((e=>{var t;if(x.isMobile)return;const o=void 0!==e.indexGlobal?null===(t=s.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexGlobal]:void 0;var n;o&&y({...o,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(n=s.current)||void 0===n||null===(n=n.completionsInfo)||void 0===n?void 0:n.type)})}),[s,x.isMobile,y]);let C;return(0,n.useEffect)((()=>{if(x.isMobile)return;const e=e=>{var t,o;if(void 0!==e.state.focus.indexGlobal&&null!==(t=s.current)&&void 0!==t&&t.completions&&(null===(o=s.current)||void 0===o?void 0:o.completions.length)>0){var n;const t=null===(n=s.current)||void 0===n||null===(n=n.completions)||void 0===n?void 0:n[e.state.focus.indexGlobal];void 0!==t&&y((e=>{var o;return void 0===e||void 0===(null===(o=s.current)||void 0===o?void 0:o.callParameter)?t:e}))}};return h.addListener(e),()=>h.removeListener(e)}),[s,h,y,x.isMobile]),(0,n.useEffect)((()=>{var e,t,o,n;if(x.isMobile)return;const i="function"===(null==l||null===(e=l.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=l.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==l||null===(o=l.callParameter)||void 0===o?void 0:o.parameterIndex)&&(null==l||null===(n=l.callParameter)||void 0===n?void 0:n.parameterIndex)>-1&&y({kind:Z().FormulaEditorInfoCompletionKind.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==l?void 0:l.callParameter,x.isMobile,y]),(0,n.useEffect)((()=>{b.length>0&&h.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})))}),[b.length,h,y]),C=x.isPhone?{menuType:ne().gu.ActionSheet,disableBottomPadding:!0,maxHeight:"100%"}:{menuType:ne().gu.Popup,width:x.isPhone?180:228,minWidth:x.isPhone?180:228,maxWidth:x.isPhone?180:228},(0,K.jsx)(se().A,{...C,scrollerStyle:g.menu,children:(0,K.jsx)(ue().Ay,{type:ue().Oh.Vertical,initialFocus:0,priority:1,store:h,onKeyboardArrow:k,sections:f().oE([...b,0===b.length&&{key:"no-results",render:e=>(0,K.jsx)(de().A,{...e,disableDesktopPadding:!0,style:g.menuSection,children:(0,K.jsx)(Ue,{})}),items:[]}])})})}const Le=n.forwardRef((function(e,t){const{completion:l,context:s,getRecordModel:d,menuListStore:p,indexGlobal:c,cursorEditorInfoRef:m,setInfoHelper:f,onMouseEnter:g,...x}=e,h=(0,i().Y0)(),b=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.text.tertiary}})),[]),k=(0,n.useCallback)((e=>{if(!h.isMobile){var t;const e=null===(t=m.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[c];f(e)}null==g||g(e)}),[m,c,g,f,h.isMobile]),C=(0,r().K8)((()=>p.state.focus.indexGlobal===c),[p,c]),I=(0,n.useMemo)((()=>h.isMobile?(0,K.jsx)(le().Ay,{popupType:le().z7.SlideUp,renderOrigin:e=>(0,K.jsx)(N().A,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,o(166883).x)(b.icon)}),render:e=>{var t;let n;return n=h.isMobile?{menuType:ne().gu.Modal,title:(0,K.jsx)(y().sA,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,K.jsx)(o(480095).DoneMenuText,{}),onClickRight:e.close}:{menuType:ne().gu.Popup},(0,K.jsx)(se().A,{...n,children:(0,K.jsx)(de().A,{children:(0,K.jsx)(o(678553).Ay,{title:(0,K.jsx)(Pe,{infoHelper:{...l,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==m||null===(t=m.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:d,style:{padding:4},typecheckContextValues:s.valueTypes}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,K.jsx)(He,{visible:C})),[l,s.valueTypes,m,h.isMobile,d,C,b.icon]),S=(0,r().K8)((()=>{var e;if(l.kind!==Z().FormulaEditorInfoCompletionKind.Token||l.token.type!==Z().FormulaTokenType.BlockProperty||!d)return;if(Z().FormulaTokenSupportedBlockSystemPropertyList.includes(l.token.property))return l.token.property;if((0,u().ix)(l.token)||!l.token.collection)return;const t=(0,u().Yi)(l.token.property),o=d(l.token.collection);return null==o||null===(e=o.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[l,d]);if(l.kind===Z().FormulaEditorInfoCompletionKind.Token){if(l.token.type===Z().FormulaTokenType.Checkbox)return null;if(l.token.type===Z().FormulaTokenType.BlockProperty)return(0,K.jsx)(ae().A,{...x,icon:S?J().LE[S](b.icon):(0,K.jsx)(Ne,{type:"unknown"}),title:l.name??l.token.property,right:I,onMouseEnter:k,ref:t});if(l.token.type===Z().FormulaTokenType.ContextValue){const e=(0,u().IV)(s.valueTypes,(0,u().GH)(l.token.valueId));return e?(0,K.jsx)(ae().A,{...x,icon:(0,K.jsx)(Ye,{contextValue:e}),title:(0,K.jsx)("div",{style:{display:"flex"},children:e.name}),right:I,onMouseEnter:k,ref:t}):null}if(l.token.type===Z().FormulaTokenType.Date)return null;if(l.token.type===Z().FormulaTokenType.Block)return null;if(l.token.type===Z().FormulaTokenType.Person)return null;(0,v().HB)(l.token)}else{if(l.kind===Z().FormulaEditorInfoCompletionKind.LibraryFunction){const e=l.libraryFunction.returnType;return(0,K.jsx)(ae().A,{...x,icon:(0,K.jsx)(Ne,{type:"function"==typeof e?e([]).type:e.type}),title:(0,K.jsxs)(K.Fragment,{children:[l.libraryFunction.name,(0,K.jsx)("span",{style:b.lightParens,children:"()"})]}),right:I,onMouseEnter:k,ref:t})}if(l.kind===Z().FormulaEditorInfoCompletionKind.Builtin)return(0,K.jsx)(ae().A,{...x,title:l.builtin,icon:(0,K.jsx)(Ne,{type:te[l.builtin].type.type}),right:I,onMouseEnter:k,ref:t});if(l.kind===Z().FormulaEditorInfoCompletionKind.Binding)return(0,K.jsx)(ae().A,{...x,title:l.text,icon:(0,K.jsx)(Ne,{type:l.type.type}),right:I,onMouseEnter:k,ref:t});(0,v().HB)(l)}})),He=n.memo((function(e){let{visible:t}=e;const n=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 50ms 200ms",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return(0,o(356596).K)(n.icon)})),Ne=n.memo((function(e){var t;let{type:o}=e;const n=(0,a().IS)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=Ve(o))||void 0===t?void 0:t(n.icon)}));function Ye(e){const{contextValue:t}=e,n=(0,a().IS)((e=>({stepNumber:{color:e.mediumIconColor}})),[]);return(0,v().O9)(t.stepNumberForDisplay)?(0,K.jsx)(o(931077).Q,{size:o(494379).H.Small,number:t.stepNumberForDisplay,style:n.stepNumber}):(0,K.jsx)(Ne,{type:t.type.type})}function Ve(e){return"text"===e?J().LE.text:"number"===e?J().LE.number:"checkbox"===e?J().LE.checkbox:"date"===e?J().LE.date:"block"===e?J().LE.relation:"person"===e?J().LE.person:"select"===e?J().LE.select:"array"===e?J().LE.multi_select:"function"===e||void 0===e||"unknown"===e?J().LE.formula:void(0,v().HB)(e)}function Ue(){return(0,K.jsx)(re().A,{caption:(0,K.jsx)(y().sA,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}const Ke=(0,y().YK)({[Z().FormulaEditorInfoCompletionKind.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[Z().FormulaEditorInfoCompletionKind.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[Z().FormulaEditorInfoCompletionKind.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[Z().FormulaEditorInfoCompletionKind.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),We={[Z().FormulaEditorInfoCompletionKind.Token]:Ke[Z().FormulaEditorInfoCompletionKind.Token],[Z().FormulaEditorInfoCompletionKind.LibraryFunction]:Ke[Z().FormulaEditorInfoCompletionKind.LibraryFunction],[Z().FormulaEditorInfoCompletionKind.Binding]:Ke[Z().FormulaEditorInfoCompletionKind.Binding],[Z().FormulaEditorInfoCompletionKind.Builtin]:Ke[Z().FormulaEditorInfoCompletionKind.Builtin]};var ze=()=>o(962730),Oe=()=>o(493823),$e=()=>o(204063),qe=()=>o(859428);const Ge={height:24,padding:"0 8px"},Qe=(0,y().YK)({accept:{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"},cancel:{defaultMessage:"Cancel",id:"formulas.formulaInputHeader.cancel"},close:{id:"formula2Input.close",defaultMessage:"Close"},save:{id:"formula2Input.save",defaultMessage:"Save"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"},askAi:{id:"formulas.formulaInputHeader.askAi",defaultMessage:"Ask AI"}}),Je=n.memo((function(e){const{disabled:t,onClickAssistant:o,onClickCancel:n,onClickClose:i,onClickRevert:r,isAssistantVisible:l}=e,s=(0,a().IS)((e=>({headerRow:{color:e.text.secondary,flexWrap:"wrap",fontWeight:500,fontSize:14}})),[]),u=!t&&!l;return(0,K.jsxs)(H().Y1,{direction:"horizontal",padding:"10px 12px 0 12px",style:s.headerRow,children:[n&&!t?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(H().Y1,{width:"hug",children:(0,K.jsx)(Xe,{onClick:n})}),(0,K.jsx)(H().Y1,{width:"fill"})]}):(0,K.jsx)(H().Y1,{width:"fill",children:(0,K.jsx)(ot,{})}),(0,K.jsxs)(H().Y1,{width:"hug",direction:"horizontal",gap:6,align:"center",children:[r&&!t?(0,K.jsx)(nt,{onClick:r}):null,u?(0,K.jsx)(A().y,{experimentId:"formula_assistant",groups:{on:(0,K.jsx)(Ze,{onClick:o}),control:null}}):null,t?(0,K.jsx)(et,{onClick:i}):(0,K.jsx)(tt,{onClick:i})]})]})}));function Ze(e){const{onClick:t}=e,o=(0,y().tz)(),n=(0,a().IS)((()=>({label:{marginLeft:6,marginRight:2}})),[]),i=o.formatMessage(Qe.askAi);return(0,K.jsxs)(Oe().p,{"aria-label":i,size:"sm",onClick:t,children:[(0,K.jsx)(L().iB,{}),(0,K.jsx)("span",{style:n.label,children:i})]})}function Xe(e){const{onClick:t}=e,o=(0,y().tz)();return(0,K.jsx)(Oe().p,{isGray:!0,size:"sm",onClick:t,children:o.formatMessage(Qe.cancel)})}function et(e){const{onClick:t}=e,o=(0,y().tz)();return(0,K.jsx)($e().A,{onClick:t,style:Ge,children:o.formatMessage(Qe.close)})}function tt(e){const{onClick:t}=e,n=(0,i().v3)(),r=(0,y().tz)(),l=(0,a().IS)((e=>({commandText:{color:e.text.contrastSecondary}})),[]);return(0,K.jsx)(qe().A,{renderTooltip:()=>(0,K.jsxs)("div",{children:[(0,K.jsx)("span",{children:r.formatMessage(Qe.accept)})," ",(0,K.jsxs)("span",{style:l.commandText,children:[(0,o(251057)._w)({environment:n}).command,"+Enter"]})]}),render:e=>(0,K.jsx)($e().A,{onClick:t,style:Ge,...e,children:r.formatMessage(Qe.save)})})}function ot(){const e=(0,y().tz)(),t=(0,a().IS)((()=>({headerTitle:{fontSize:12,display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20}})),[]);return(0,K.jsxs)("span",{style:t.headerTitle,children:[e.formatMessage(Qe.formulaHeader),(0,K.jsx)(qe().A,{placement:ze().W.Top,render:n=>(0,K.jsx)(Te().A,{...n,ariaLabel:e.formatMessage(Qe.learnTooltip),icon:o(133033).$,href:(0,o(836251).xS)("guides.formulas"),external:!0,style:t.helpButton}),renderTooltip:()=>e.formatMessage(Qe.learnTooltip)})]})}function nt(e){const{onClick:t}=e,o=(0,y().tz)(),n=(0,a().IS)((e=>({revertButton:{color:e.mediumIconColor}})),[]);return(0,K.jsx)(qe().A,{placement:ze().W.Top,render:e=>(0,K.jsx)(Oe().p,{...e,"aria-label":o.formatMessage(Qe.revertTooltip),isGray:!0,size:"sm",style:n.revertButton,onClick:t,children:o.formatMessage(Qe.revert)}),renderTooltip:()=>o.formatMessage(Qe.revertTooltip)})}o(18107),o(967357),o(737550);var it=()=>o(908006),rt=()=>o(852507),at=()=>o(634201),lt=()=>o(558842),st=()=>o(495262),ut=()=>o(315097),dt=()=>o(659602),pt=()=>o(335722),ct=()=>o(921855),mt=()=>o(621979),yt=()=>o(792002),ft=()=>o(406792),gt=()=>o(562800),vt=()=>o(477450),xt=()=>o(682372),ht=()=>o(509144);const bt={borderRadius:4,flexGrow:1,flexShrink:1,fontFamily:x().vc(o(662303).locale).githubMono,fontSize:12,height:"100%",minHeight:"1em",paddingBlock:"11px 10px",paddingInline:"12px 13px",tabSize:2,textAlign:"left",whiteSpace:"pre-wrap",wordBreak:"break-all"},kt=(0,y().YK)({formulaPlaceholder:{id:"formulas.formulaPlaceholder",defaultMessage:"Your formula"}});function Ct(e){const{analyticsContext:t,clipboardActions:o,disabled:l,errorRanges:s,focus:u,formulasModule:d,handleSave:p,markdownLinkifyIt:c,parentSpaceId:y,Prism:g,store:v,tinyMceMicrosoftWordPasteFilter:x,valueTypes:h,hoveredErrorRange:k}=e,C=(0,n.useRef)(null),I=(0,a().DP)(),M=(0,i().v3)(),T=(0,r().K8)((()=>{var e;const t=P().default.state;return"editing"===t.mode&&(null===(e=(0,S().H7)(t.multiSelection))||void 0===e?void 0:e.store)===v}),[v]),A=(0,n.useCallback)((()=>{var e;return(null===(e=C.current)||void 0===e?void 0:e.getNode())||void 0}),[C]),w=(0,r().K8)((()=>v.getValue()||[]),[v],{debugName:"FormulaInputText.textValueStore"}),E=(0,n.useCallback)((()=>{var e;return null===(e=A())||void 0===e?void 0:e.blur()}),[A]),F=(0,n.useCallback)((()=>{const e=at().PE(m().q4_(w));return{endIndex:e.length,startIndex:e.length}}),[w]),j=(0,n.useCallback)((()=>{if(T)return(0,yt().Do)(v)}),[T,v]),D=(0,n.useCallback)((()=>{const e=window.getSelection();null!=e&&e.rangeCount&&it().default.afterNextFlush((()=>{var t;const o=e.getRangeAt(0).getClientRects()[0],n=null===(t=A())||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement,i=null==n?void 0:n.getBoundingClientRect();o&&n&&i&&(i.top>=o.top?n.scrollTo({top:n.scrollTop+(o.top-i.top)-6}):i.bottom<=o.bottom+o.height&&n.scrollTo({top:n.scrollTop+(o.bottom-i.bottom)+28}))}))}),[A]),B=(0,n.useCallback)((e=>{ct().HP({canEdit:!l,editorNode:A(),environment:M,event:e,store:v,textValue:w})}),[M,w,A,v,l]),L=(0,n.useCallback)((e=>{if(l)return;const t=P().default.state;"editing"===t.mode&&t.multiSelection.start.store===v&&(_().createAndCommit({userAction:"FormulaInputText.handleDelete",environment:M,canUndo:!0,perform:o=>{ut().wT({environment:M,multiSelection:t.multiSelection,deleteForwards:!0,transaction:o,event:e,editorMode:"default"})}}),D())}),[l,M,D,v]),H=(0,n.useCallback)((e=>{if(l)return;const t=P().default.state;if("editing"===t.mode&&t.multiSelection.start.store===v){if(ut().CZ({device:M.device,event:e,multiSelection:t.multiSelection}))return;_().createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:M,canUndo:!0,perform:o=>{ut().wT({environment:M,multiSelection:t.multiSelection,deleteForwards:!1,transaction:o,event:e,editorMode:"default"})}}),D()}}),[l,M,D,v]),N=(0,n.useCallback)((e=>{var t,o,n;if(l)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),C.current&&C.current.isComposing())return;const i=P().default.state,r="editing"===i.mode&&(0,S().H7)(i.multiSelection);if(!r)return;const a=at().PE(m().q4_(w)),s=null===(o=a.slice(0,r.selection.startIndex).join("").split("\n"))||void 0===o?void 0:o.at(-1),u=(null==s||null===(n=s.match(/^\t*/))||void 0===n?void 0:n[0].length)||0,d=(null==s?void 0:s.split("").reverse())||[];let p=0;const c=d.some((e=>{if(")"===e)p++;else if("("===e){if(0===p)return!0;p--}return!1}))?u+1:u;let y="\t".repeat(c);const f=")"===a[r.selection.endIndex],g=Boolean(null==s?void 0:s.endsWith("("))&&f;g&&(y+=`\n${"\t".repeat(c-1)}`),_().createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:M,canUndo:!0,perform:e=>{R().$D({environment:M,editorMode:"default",store:v,string:`\n${y}`,selection:r.selection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),g&&b().setSelection({store:v,selection:{startIndex:r.selection.startIndex+c+1,endIndex:r.selection.startIndex+c+1}})}}),D()}),[l,M,D,v,w]),V=(0,n.useCallback)((e=>{var t;const n=window.getSelection();null!=n&&n.anchorNode&&null!==(t=A())&&void 0!==t&&t.contains(n.anchorNode)&&o.copy({environment:M,event:e,markdownLinkifyIt:c})}),[M,A,c,o]),U=(0,n.useCallback)((e=>{l?e.preventDefault():(o.cutWithMaybeConfirmation({environment:M,event:e,markdownLinkifyIt:c}),D())}),[l,M,D,c,o]),W=(0,n.useCallback)((e=>{l?e.preventDefault():(_().createAndCommit({userAction:"FormulaInputText.handlePaste",environment:M,canUndo:!0,perform:t=>{o.paste({environment:M,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:o.pasteFilesForBlocks,formulasModule:d,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:x})}}),D())}),[l,M,D,c,x,d,o]),z=(0,n.useCallback)((e=>{ct().sp({environment:M,event:e,textValue:w,editorNode:A(),store:v,canEdit:!l})}),[M,w,A,v,l]),O=(0,n.useCallback)((e=>{ct().W5({environment:M,event:e,textValue:w,editorNode:A(),store:v,canEdit:!l})}),[M,w,A,v,l]),$=(0,n.useCallback)((e=>{l||e.preventDefault()}),[l]),q=(0,n.useCallback)((e=>{_().createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:M,canUndo:!0,perform:e=>{R().$P({environment:M,transaction:e,direction:"up"})}})}),[M]),G=(0,n.useCallback)((e=>{_().createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:M,canUndo:!0,perform:e=>{R().$P({environment:M,transaction:e,direction:"down"})}})}),[M]),Q=(0,n.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const o=st().li();(null==o||null===(t=o.getFirstStore())||void 0===t?void 0:t.id)===v.id&&st().tN({environment:M})}),[M,v.id]),J=(0,n.useCallback)((e=>{var t;e.preventDefault&&e.preventDefault();const o=st().Bl();(null==o||null===(t=o.getFirstStore())||void 0===t?void 0:t.id)===v.id&&st().ZS({environment:M})}),[M,v.id]),Z=(0,n.useCallback)((e=>{if(l)return;e.preventDefault();const t=P().default.state,o="editing"===t.mode&&(0,S().H7)(t.multiSelection);o&&_().createAndCommit({userAction:"FormulaInputText.handleTab",environment:M,canUndo:!0,perform:e=>{R().RJ({environment:M,store:v,editorMode:"default",selection:o.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}),[l,M,v]),X=(0,n.useCallback)((e=>{if(l)return;e.preventDefault();const t=P().default.state,o="editing"===t.mode&&(0,S().H7)(t.multiSelection);o&&_().createAndCommit({userAction:"FormulaInputText.handleUntab",environment:M,canUndo:!0,perform:e=>{R().Ye({environment:M,store:v,editorMode:"default",selection:o.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}),[l,M,v]),ee=(0,n.useCallback)((e=>{const{newValue:n}=e;ft().default.measureAfterNextFlush({metricName:"formulas_typing_lag",startTime:performance.now()},{environment:M,getData:()=>t}),_().createAndCommit({userAction:"FormulaInputText.handleMutation",environment:M,canUndo:!0,perform:e=>{R().dw({environment:M,editorMode:"default",store:v,newValue:n,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{_().createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:M,canUndo:!0,perform:e=>{R().wu({clipboardActions:o,formulasModule:d,store:v,transaction:e})}})}))}})}),[t,M,d,v,o]),te=(0,n.useCallback)(((e,t)=>{let{leafRef:o,wrapperRef:n,...i}=e;const{device:r}=M,a=w.length>0;return(0,K.jsxs)("div",{ref:n,...i,onKeyDown:e=>{!function(e,t,o){(0,mt().A)(o,e,"command+enter")&&(t(),e.stopPropagation())}(e,p,M),null==i||i.onKeyDown(e)},style:{flexGrow:1,display:"table",position:"relative"},children:[(0,K.jsx)(St,{hasText:a}),(0,K.jsx)(vt().A,{leafRef:(0,lt().Px)(C,o),style:bt,isDisabled:l,debugName:"FormulaInputText",store:v,getHtml:()=>(0,ht()._)({currentUserId:M.currentUser.id,errorRanges:s,hoveredErrorRange:k,getPublicBaseUrlForPage:gt().SN(M),isAndroid:r.isAndroid,isMobileNative:r.isMobileNative,isSafariOrIOS:r.isSafari||r.isIOS,isWindows:r.isWindows,parentSpaceId:y,Prism:g,store:v,textValue:w,theme:I,valueTypes:h}),getSelection:j,onMutation:ee,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:z,onMouseOut:O,suppressNewlineEvents:!1,expandSelectionOnTripleClick:!0,placeholder:" "})]})}),[M,w,j,ee,z,O,p,l,s,y,g,v,I,h,k]),oe=(0,n.useCallback)((()=>{u&&b().setSelectionAtEnd({store:v})}),[u,v]);return(0,rt().l)(oe),(0,K.jsxs)(Y().A,{debugName:"FormulaInputText",capture:!0,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:[" ",(0,K.jsx)(xt().F,{store:v,disabled:l,clearBrowserSelection:E,getEndSelection:F,onBlur:E,onClick:B,onDelete:L,onBackspace:H,onShiftEnter:N,onCommandShiftEnter:f().D_,onTab:Z,onUntab:X,onToggleBold:$,onToggleItalics:$,onToggleUnderline:$,onToggleStrike:$,onToggleCode:f().D_,onCopy:V,onCut:U,onPaste:W,onMoveUp:q,onMoveDown:G,onUndo:Q,onRedo:J,onEsc:p,render:te,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})]})}function It(e){const{value:t}=(0,M().fJ)(he().y),{value:o}=(0,M().fJ)(dt().g),{value:n}=(0,M().fJ)(pt().S),{value:i}=(0,M().fJ)(k().T.formulas),{value:r}=(0,M().fJ)(h().R.clipboardActions);return t&&i&&r?(0,K.jsx)(Ct,{...e,Prism:t,clipboardActions:r,formulasModule:i,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:n}):null}function St(e){const{hasText:t}=e,o=(0,y().tz)();return(0,K.jsx)(H().Y1,{direction:"horizontal",gap:8,padding:"10px 12px",style:{position:"absolute",inset:0,pointerEvents:"none",userSelect:"none"},children:t?null:(0,K.jsx)(H().Y1,{height:20,align:"center-left",children:(0,K.jsx)(U().D,{colorName:"quaternary",styleName:"Body-14px/Regular",children:o.formatMessage(kt.formulaPlaceholder)})})})}Ct.displayName="FormulaInputText";const Mt=!1,Tt=400;function Pt(e){const{evaluationErrors:t,initialCode:o,parentSpaceId:x,outputFooter:L,disabled:H,typecheckContext:N,formulas:Y,handleCancel:V,onCodeChange:U,onTypeChange:z,parentCollectionStore:O,handleClose:$,getRecordModel:q}=e,G=(0,y().tz)(),J=(0,i().Y0)(),Z=(0,i().v3)(),{value:X}=(0,M().fJ)(k().T.formulaEditor),[ee,te]=(0,n.useState)(void 0),oe=(0,n.useCallback)((e=>{te(e)}),[]),ne=(0,n.useCallback)((()=>{te(void 0)}),[]),ie=(0,n.useMemo)((()=>O?{collection_id:[[O.id]]}:void 0),[O]),{store:re,setValue:ae}=(0,I().AI)({initialValue:o,onChange:U,source:"formula",properties:ie}),le=(0,n.useCallback)((e=>{if(ae(e.newValue),e.newSelection){const t={start:{store:re,index:e.newSelection.startIndex},end:{store:re,index:e.newSelection.endIndex}};b().setMultiSelection({multiSelection:t})}}),[ae,re]),se=(0,r().K8)((()=>{var e;const t=P().default.state;if("editing"===t.mode&&(null===(e=(0,S().H7)(t.multiSelection))||void 0===e?void 0:e.store)===re)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[re],{useDeepEqual:!0}),ue=(0,r().K8)((()=>re.getValue()),[re]),de=(0,n.useMemo)((()=>!f().n4(ue,o)),[ue,o]),[pe,ce]=(0,r().K8)((()=>!ue||I().Pe?[void 0,void 0]:Y.processFormulaInput(ue)),[ue,Y]),me=(0,r().K8)((()=>{if(pe)return Y.parseFormulaInputToCst(pe,ce)}),[pe,Y,ce]),ye=(0,r().K8)((()=>{if(me)return Y.convertFormulaCSTToAST(me[0])}),[Y,me]),[fe,ge]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{!async function(){if(ye&&N&&g().Q.isSuccess(ye)){const e=await Y.addTypesToFormulaASTAsync(ye.value,N,ce);ge(e),null==z||z(e.node.type)}else ge(void 0)}()}),[ye,N,ce,me,Y,z]);const ve=(0,n.useMemo)((()=>void 0!==fe?[...(0,u().KH)(fe.node,!1),...fe.errors]:[]),[fe]),xe=(0,n.useMemo)((()=>({parseErrors:(null==me?void 0:me[1])??[],typeErrors:ve,evaluationErrors:t})),[t,me,ve]),he=(0,p().lW)(xe,Tt,Object.is),be=xe.parseErrors.length+xe.typeErrors.length+xe.evaluationErrors.length>0,ke=(0,r().K8)((()=>function(e){const{errors:t,intl:o,codeLength:n,formulas:i}=e,{parseErrors:r,typeErrors:a,evaluationErrors:s}=t,u=[];a&&a.length>0?a.forEach((e=>{const t=(0,l().ew)((0,l().rA)(o,e));u.push({msg:o.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}})})):s&&s.length>0&&s.forEach((e=>{const t=(0,l().ew)((0,l().yI)(o,e));u.push({msg:o.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0})}));r&&r.forEach((e=>{const t=(0,l().ew)((0,l().ml)(e));u.push({msg:o.formatMessage(...t),range:"eof"===e.offset?{startIndex:n-1,endIndex:n}:{startIndex:e.offset,endIndex:e.offset+1}})}));return u}({errors:he,codeLength:ce?(0,s().sE)(ce):(0,m().q4_)(ue).length,formulas:Y,intl:G})),[ue,he,Y,G,ce]),Ce=(0,n.useMemo)((()=>ke.map((e=>e.range)).filter(v().O9)),[ke]),Ie=(0,n.useCallback)((()=>{$(H?o:re.getValue())}),[H,$,o,re]),[Se,Me]=(0,n.useState)(void 0),Te=(0,n.useRef)(void 0),[Ae,we]=(0,n.useState)(void 0),Ee=(0,n.useRef)(1);(0,n.useEffect)((()=>{Ee.current++;const e=Ee.current;!async function(){if(X){const t=await X.getFormulaEditorInfoAtPosition({formula:ue??[],inputPosition:se&&se.startIndex===se.endIndex?se.startIndex:0,context:N,includeDeprecatedCompletions:!1});g().Q.isSuccess(t)&&Ee.current===e&&(Te.current=t.value,Me(t.value))}}()}),[se,X,N,ue]);const Fe=(0,n.useCallback)((()=>{ae(o)}),[o,ae]),je=(0,r().uB)(void 0,Q),De=(0,r().K8)((()=>{var e;return null==O||null===(e=O.getSchemaStore)||void 0===e||null===(e=e.call(O))||void 0===e?void 0:e.getValue()}),[O]),Be=(0,r().K8)((()=>je.state.isAssistantVisible),[je]),Re=(0,n.useCallback)((()=>(0,c().r4)({textValue:re.getValue(),intl:G,getRecordModel:q,userTimeZone:(0,d().P)()})),[re,G,q]),Le=null==O?void 0:O.id,He=ke.length>0,Ne=(0,n.useCallback)((()=>{var e;Be||(0,C().u4)({environment:Z,event:{eventName:"formula_assistant_open",eventProperties:{formula_assistant_session_id:je.state.id,has_existing_formula:(null===(e=Re())||void 0===e?void 0:e.length)>0,has_errors:He,collection_id:Le}}});je.toggleAssistantVisible()}),[Be,je,Z,Re,He,Le]),Ye=(0,n.useCallback)((async()=>{var e;const t=null===(e=T().default.state.currentSpaceStore)||void 0===e?void 0:e.id,o=je.state.prompt;if(!t||!o)return;je.didBeginRequest();const n=ke.map((e=>{if("string"==typeof e.msg)return e.range?`${e.msg} [${e.range.startIndex},${e.range.endIndex}]`:e.msg})).filter(v().O9),i=function(e){const{prompt:t,collectionSchema:o,typecheckContext:n,existingFormula:i,formulaErrors:r}=e,a=[];if(o){const{sourceProperty:e}=n;for(const[t,n]of Object.entries(o))t!==e&&void 0!==n&&a.push({name:n.name,type:n.type,example:void 0})}return{type:"formula",prompt:t,properties:a,existingFormula:i,formulaErrors:r}}({prompt:o,collectionSchema:De,typecheckContext:N,existingFormula:Re(),formulaErrors:n}),r=await async function(e){const{environment:t,spaceId:o,formulaInferenceContext:n}=e,i=E().JW();await D().callApi({eventName:"publishAiSession",environment:t,data:{inference_type:"formula",spaceId:o,id:i,metadata:{from:"formulaAssistant"}}});const r=E().JW(),a=await D().callStreamApi({eventName:"getCompletion",environment:t,data:{id:r,context:n,model:"openai-gpt-4o",spaceId:o,isSpacePermission:!1,aiSessionId:i,metadata:{}},headers:(0,F().WS)({spaceId:o})});if("success"!==a.type)return void B().Qg(a);let l="";if(j().hS.is(a.data))for await(const s of a.data)"success"===s.type&&(l+=s.completion);return{formula:l,inferenceId:r}}({environment:Z,spaceId:t,formulaInferenceContext:i});if(r){const e=await h().R.clipboardActions.load();!function(e){const{clipboardActions:t,environment:o,formulasModule:n,newValue:i,store:r}=e;_().createAndCommit({userAction:"FormulaInputText.handleMutation",environment:o,canUndo:!0,perform:e=>{R().kE({environment:o,store:r,newValue:i,editorMode:"default",disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{_().createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:o,canUndo:!0,perform:e=>{R().wu({clipboardActions:t,formulasModule:n,store:r,transaction:e})}})}))}})}({environment:Z,clipboardActions:e,formulasModule:Y,newValue:r.formula,store:re}),(0,C().u4)({environment:Z,event:{eventName:"formula_assistant_prompt",eventProperties:{formula_assistant_session_id:je.state.id,inference_id:r.inferenceId}}})}je.didFinishRequest()}),[je,ke,De,N,Re,Z,Y,re]),Ve=(0,n.useCallback)((()=>{}),[]),Ue=(0,n.useCallback)((()=>je.hideAssistant()),[je]);Mt&&console.log("FormulaInput",{currentValue:ue,cursorEditorInfo:Se,infoHelper:Ae,errorMessagesWithRange:ke,errorRanges:Ce,astWithTypes:fe});const Ke=(0,a().IS)((e=>({container:{display:"flex",height:"100%",paddingBottom:void 0,flexDirection:"column"},editorSection:{display:"flex",flexDirection:"column",backgroundColor:"light"===e.mode?e.cardBackground:e.accentColors.gray[30]},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto",maxHeight:"min(calc(90vh - 240px - 38px - 30px), 298px)",minHeight:"40px",cursor:"text",position:"relative"},bottomSection:{display:"flex",flexDirection:"row",height:J.isMobile?"100%":240,maxHeight:J.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.outlineButtonBorder}`},leftColumn:{position:"relative",borderRight:`1px solid ${e.outlineButtonBorder}`,width:J.isMobile?"100%":void 0},rightColumn:{display:"flex",flexDirection:"column",flexGrow:1},infoHelper:{padding:"12px 14px"},assistantOverlay:{position:"absolute",inset:0,background:"transparent"}})),[J.isMobile]);return(0,K.jsx)(w().A,{debugName:"FormulaInput",capture:!0,children:(0,K.jsxs)("div",{style:Ke.container,children:[(0,K.jsxs)("div",{style:Ke.editorSection,children:[(0,K.jsx)(Je,{disabled:H,onClickAssistant:Ne,onClickCancel:V,onClickClose:Ie,onClickRevert:de?Fe:void 0,isAssistantVisible:Be}),(0,K.jsxs)("div",{style:Ke.inputText,children:[(0,K.jsx)(It,{value:ue,focus:!Be,store:re,disabled:H||Be,parentSpaceId:x,valueTypes:N.valueTypes,errorRanges:Ce,handleSave:Ie,analyticsContext:{restrict_unaccessible_properties:N.restrictUnaccessibleProperties},hoveredErrorRange:ee},"input"),Be?(0,K.jsx)("div",{style:Ke.assistantOverlay,onClick:Ue}):null]})]}),be?(0,K.jsx)(At,{errorMessagesWithRange:ke,onHoverEnter:oe,onHoverLeave:ne,hoveredErrorRange:ee}):L,Be?(0,K.jsx)(A().y,{experimentId:"formula_assistant",groups:{on:(0,K.jsx)(W,{formulaAssistantStore:je,onStop:Ve,onSubmit:Ye}),control:null}}):null,!H&&!Be&&(0,K.jsxs)("div",{style:Ke.bottomSection,children:[(0,K.jsx)("div",{style:Ke.leftColumn,children:(0,K.jsx)(_e,{store:re,context:N,selection:se,cursorEditorInfo:Se,cursorEditorInfoRef:Te,onChange:le,getRecordModel:e.getRecordModel,setInfoHelper:we})}),!J.isMobile&&(0,K.jsx)("div",{style:Ke.rightColumn,children:(0,K.jsx)(Pe,{infoHelper:Ae,getRecordModel:e.getRecordModel,style:Ke.infoHelper,typecheckContextValues:N.valueTypes})})]})]})})}const At=n.memo((function(e){let{errorMessagesWithRange:t,onHoverEnter:n,onHoverLeave:i,hoveredErrorRange:r}=e;const l=(0,a().IS)((e=>({errors:{display:"flex",flexDirection:"row",alignItems:"start",padding:10,fontSize:x().J.UISmall.desktop,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,color:e.darkTextColor,flexShrink:0},icon:{width:14,height:14,fill:e.icon.uiRedPrimary,display:"inline",marginRight:3,marginTop:2},errorMessages:{color:e.text.uiRedPrimary}})),[]);return 0===t.length?null:(0,K.jsxs)("div",{style:l.errors,children:[(0,o(750559).f)(l.icon),(0,K.jsx)("span",{style:l.errorMessages,children:t.slice(0,3).map(((e,t)=>(0,K.jsx)(wt,{errorMessageWithRange:e,shouldAddLeadingSpace:t>0,onHoverEnter:n,onHoverLeave:i,hoveredErrorRange:r},t)))})]})})),wt=n.memo((function(e){let{errorMessageWithRange:t,shouldAddLeadingSpace:o,onHoverEnter:i,onHoverLeave:r,hoveredErrorRange:l}=e;const s=(0,a().IS)((e=>({errorRange:{opacity:.75},text:{color:e.text.uiRedPrimary,cursor:"pointer"}})),[]),{range:u}=t;(0,n.useEffect)((()=>()=>{u&&l&&u.startIndex===l.startIndex&&u.endIndex===l.endIndex&&r()}),[u,l,r]);const d=(0,n.useCallback)((()=>{u&&i(u)}),[u,i]),p=(0,n.useCallback)((()=>{r()}),[r]);return(0,K.jsxs)("span",{style:s.text,onMouseEnter:d,onMouseLeave:p,children:[o?" ":null,t.msg,void 0!==u&&(0,K.jsxs)(K.Fragment,{children:[" ",(0,K.jsx)("span",{style:s.errorRange,children:`[${u.startIndex},${u.endIndex}]`})]})]})}))},911724:(e,t,o)=>{o.d(t,{A:()=>p,v:()=>d});o(898992),o(354520);var n=o(296540),i=()=>o(484714),r=()=>o(847249),a=()=>o(989423),l=()=>o(546461),s=o(474848);const u=(0,n.createContext)({collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:o(633904).l},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[],collapsedActionIds:[],hideDragHandle:!1,cantSaveDueToError:!1,toggleActionIdCollapsed:()=>{}});function d(e){const t=(0,i().v3)(),{automationStore:o}=(0,l().EC)(),d=(0,r().K8)((()=>o.getActionIds()),[o]),[p,c]=(0,n.useReducer)(((e,n)=>{const i=e.includes(n);return(0,a().u4)({environment:t,event:{eventName:"automation_action_collapse_toggle",eventProperties:{collapsed:!i,automation_action_id:n,automation_id:o.id}}}),i?e.filter((e=>e!==n)):[...e,n]}),e.defaultCollapseActions?d:[]);return(0,s.jsx)(u.Provider,{value:{...e.value,collapsedActionIds:p,toggleActionIdCollapsed:c},children:e.children})}u.displayName="AutomationEditorContext";const p=u},931077:(e,t,o)=>{o.d(t,{Q:()=>l});o(296540);var n=()=>o(484714),i=()=>o(401497),r=()=>o(494379),a=o(474848);function l(e){const{isMobile:t}=(0,n().Y0)(),o=(0,i().DP)();return(0,a.jsx)(r().Q,{...e,theme:o,isMobile:t})}}}]);