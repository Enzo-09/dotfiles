"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[84341],{10323:(t,e,o)=>{o.d(e,{A:()=>te});var n=o(296540),r=()=>o(847249),i=()=>o(484714),s=()=>o(401497),l=()=>o(959013),a=()=>o(284371),c=()=>o(989423);function u(t,e){c().vd(t,"complete_sprint_action",e)}var d=()=>o(73223),p=()=>o(476492),S=()=>o(739135),m=()=>o(351360),g=()=>o(244091),f=(o(898992),o(354520),o(581454),()=>o(725252)),x=()=>o(757695),v=()=>o(584262),y=()=>o(66689),h=()=>o(784892),C=()=>o(597777),b=()=>o(869190),j=()=>o(668725),k=()=>o(212050),A=()=>o(689094),_=()=>o(643381),M=()=>o(696706),T=()=>o(179034),I=()=>o(864779),R=()=>o(919709),w=()=>o(100622),B=()=>o(496603),F=()=>o(534177),D=()=>o(720665),P=()=>o(857783),O=()=>o(42120),K=()=>o(813297),L=()=>o(862292),V=()=>o(722872),N=()=>o(71304),U=()=>o(685889),z=()=>o(645873),H=()=>o(764218),E=()=>o(630116),J=()=>o(29247),Y=()=>o(41459),W=()=>o(493823),$=()=>o(760217),G=()=>o(406699),q=()=>o(285790),Q=()=>o(710149),X=()=>o(928600),Z=()=>o(939740),tt=()=>o(480095),et=()=>o(204063),ot=()=>o(614505),nt=()=>o(16006),rt=()=>o(89924),it=()=>o(427711),st=()=>o(641514),lt=()=>o(719147),at=()=>o(881690),ct=o(474848);const ut=(0,l().YK)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function dt(t){let{onDismiss:e,...o}=t;const{isOpen:r}=o,s=(0,i().v3)(),l=(0,n.useId)(),a=t=>{e();let n=!1;(0,F().Gv)(t)&&(0,F().O9)(t.clickedCancel)&&(n=!0===t.clickedCancel),u(s,{...(0,p().sl)(o.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,ct.jsx)(st().A,{ariaLabelledBy:l,isOpen:r,onDismiss:()=>a(),render:()=>(0,ct.jsx)(pt,{...o,onDismiss:a,titleAriaId:l})})}function pt(t){var e;const{completeSprintAutomationContext:o,setIsLoading:s,taskCollectionContextStore:a,onDismiss:c,completeSprintAutomationState:u,onAutomationComplete:d,titleAriaId:p}=t,{currentSprintId:S,querySprintsResult:g,currentSprintTaskSummary:v}=u,y=(0,l().tz)(),h=(0,i().v3)(),{isMobile:b}=(0,i().Y0)(),{value:j}=(0,z().fJ)(L().T.formulas),{value:k}=(0,z().fJ)(K().QV.automationTypecheck),{value:A}=(0,z().fJ)(K().QV.automationActionRegistry),_=(0,r().K8)((()=>m().default.state.currentUserSettingsStore),[]),M=(0,r().K8)((()=>o.sprintCollectionStore),[o]),R=(0,r().K8)((()=>{var t;const e=null===(t=o.automationContext)||void 0===t?void 0:t.automationStore;return null==e?void 0:e.getRecurrence()}),[o]),w=(0,r().K8)((()=>{var t;return(null===(t=o.automationContext)||void 0===t||null===(t=t.automationActionStore.getConfig())||void 0===t?void 0:t.complete_sprint_action)??"complete_sprint_and_move_incomplete_tasks_to_next_sprint"}),[null===(e=o.automationContext)||void 0===e?void 0:e.automationActionStore]),B=(0,r().K8)((()=>M.getSpaceId()),[M]),F=(0,r().K8)((()=>{if(S)return E().Bv.createChildStore(M,{id:S,table:T().ev,spaceId:M.getSpaceId()})}),[S,M]),P=(0,r().K8)((()=>F?(0,N().tS)({intl:y,environment:h,store:F,untitledFallback:ut.fallbackSprintName}):y.formatMessage(ut.fallbackSprintName)),[F,y,h]),O=(0,r().K8)((()=>vt({sprintBlockStore:F,sprintCollectionStore:M})),[F,M]),V=(0,r().K8)((()=>yt({sprintDateRange:O,intl:y})),[O,y]),[U,H]=n.useState(),J=(0,r().K8)((()=>x().default.createValue(w)),[w]),Y=n.useMemo((()=>{if(!R||null==O||!O.end_date)return;const t=(0,I().Vv)(R);return t?(0,I().Z3)({currentSprintEndDate:O.end_date,sprintSchedule:t}):void 0}),[R,null==O?void 0:O.end_date]),$=(0,r().K8)((()=>{if("pointer"!==(null==U?void 0:U.type))return;return vt({sprintBlockStore:E().Bv.createChildStore(M,U.pointer),sprintCollectionStore:M})}),[U,M]),[G,q]=n.useState(void 0),Q=n.useMemo((()=>{if(G&&(0,C().oM)(G))return G}),[G]),X=n.useMemo((()=>{if(!g)return;const{nextSprintIds:t,futureSprintIds:e}=g;return t.length>0?t:e}),[g]),Z=(0,r().K8)((()=>{if(void 0===X)return;const t=X[0];return t?{type:"pointer",pointer:{id:t,table:T().ev,spaceId:B}}:{type:"actionId"}}),[X,B]),tt=(0,r().K8)((()=>{var t;return!Boolean(null==_||null===(t=_.getSettings())||void 0===t?void 0:t.seen_sprint_settings_engagement_banner)}),[_]);n.useEffect((()=>{Z&&H(Z)}),[Z,H]),n.useEffect((()=>{q($??Y)}),[$,Y,q]);const ot=n.useCallback((async()=>{if(c(),!(j&&k&&A&&U&&Q&&o.automationContext))return;s(!0);const t=0===(null==v?void 0:v.incompleteTaskCount)?"complete_sprint":J.state;if(!o.automationContext)return;const e={type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:t,nextSprintDateRange:Q},automationStore:o.automationContext.automationStore,intl:y,parentRecordStore:o.currentCollectionViewBlockStore,formulasModule:j,isLoggedIn:h.currentUser.isLoggedIn(),automationTypecheckModule:k,automationActionRegistryModule:A},n=()=>{d()},{automationExecutionActions:r}=await K().QV.automations.load();await r.executeClientAutomation({environment:h,clientContext:e,onUndo:()=>{s(!0),n(),s(!1)}}),n(),s(!1)}),[c,j,U,Q,o.automationContext,o.currentCollectionViewBlockStore,k,A,s,null==v?void 0:v.incompleteTaskCount,J,y,h,d]),nt=gt({isMobile:b}),{status:rt}=(0,f().L)({value:u,validateLoaded:t=>!1===t.isLoading,waitTimeInMs:Number(D().Xb)});if("pending"!==rt&&u.isLoading)return(0,ct.jsx)(St,{titleAriaId:p,onDismiss:c,sprintCollectionStore:M});if(u.isLoading)return(0,ct.jsx)(mt,{titleAriaId:p,onDismiss:c});const{incompleteTaskCount:it}=u.currentSprintTaskSummary,st=Boolean(U)&&Boolean(Q),lt=void 0!==X&&X.length>0;return(0,ct.jsxs)("div",{style:nt.modalContainer,children:[(0,ct.jsx)("div",{style:nt.header,id:p,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:P}})}),(0,ct.jsx)(xt,{currentSprintFormattedDateRange:V,currentSprintTaskSummary:v}),tt&&(0,ct.jsx)(ft,{collectionContextStore:a,userSettingsStore:_,onDismissModal:c}),lt&&(0,ct.jsxs)("div",{style:nt.flexRow,children:[y.formatMessage(ut.selectNextSprintLabel),(0,ct.jsx)(kt,{nextSprintInput:U,setNextSprintInput:H,completeSprintAutomationContext:o,sprintPageIds:X})]}),(0,ct.jsxs)("div",{style:nt.flexRow,children:[lt?y.formatMessage(ut.selectDatesForNextSprintLabel):y.formatMessage(ut.nextSprintDatesLabel),(0,ct.jsx)(_t,{sprintDateRange:G,setSprintDateRange:q})]}),it>0&&(0,ct.jsxs)("div",{style:nt.flexRow,children:[(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:it}}),(0,ct.jsx)(Ct,{actionTypeStore:J})]}),(0,ct.jsx)(et().A,{disabled:!st,onClick:()=>{ot()},style:nt.button,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:P}})}),(0,ct.jsx)(W().p,{onClick:()=>c({clickedCancel:!0}),style:nt.button,children:y.formatMessage(ut.cancelButton)})]})}function St(t){const{onDismiss:e,sprintCollectionStore:o,titleAriaId:n}=t,s=(0,i().v3)(),a=(0,l().tz)(),{isMobile:c}=(0,i().Y0)(),u=(0,r().K8)((()=>o.getParentBlockStore()),[o]),d=gt({isMobile:c});return(0,ct.jsxs)("div",{style:d.modalContainer,children:[(0,ct.jsx)("div",{style:d.header,id:n,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,ct.jsx)(et().A,{onClick:()=>{u&&P().uK({environment:s,store:u,pageVisitSource:v().y8.LinkInPage})},style:{...d.button,marginTop:24},children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,ct.jsx)(W().p,{onClick:e,style:d.button,children:a.formatMessage(ut.cancelButton)})]})}function mt(t){const{onDismiss:e,titleAriaId:o}=t,n=(0,l().tz)(),{isMobile:r}=(0,i().Y0)(),s=gt({isMobile:r});return(0,ct.jsxs)("div",{style:s.modalContainer,children:[(0,ct.jsx)("div",{style:s.header,id:o,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,ct.jsx)("div",{style:s.subheader,children:(0,ct.jsx)(Q().A,{style:s.subheaderShimmer})}),(0,ct.jsxs)("div",{style:s.flexRow,children:[n.formatMessage(ut.selectNextSprintLabel),(0,ct.jsx)(Q().A,{style:s.flexRowShimmerBox1})]}),(0,ct.jsxs)("div",{style:s.flexRow,children:[n.formatMessage(ut.selectDatesForNextSprintLabel),(0,ct.jsx)(Q().A,{style:s.flexRowShimmerBox2})]}),(0,ct.jsxs)("div",{style:s.flexRow,children:[(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,ct.jsx)(Q().A,{style:s.flexRowShimmerBox3})]}),(0,ct.jsx)(et().A,{disabled:!0,onClick:B().lQ,style:s.button,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,ct.jsx)(W().p,{onClick:e,style:s.button,children:n.formatMessage(ut.cancelButton)})]})}function gt(t){let{isMobile:e}=t;return(0,s().IS)((t=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:e?a().J.UIRegular.mobile:a().J.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:e?18:16,fontWeight:a().Wy.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:t.text.tertiary,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:t.lightIconColor},flexRow:{display:"flex",...e?{flexDirection:"column",fontSize:14,color:t.text.secondary}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...e&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...e&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...e&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...e&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...e&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...e&&{...n,border:`1px solid ${t.stroke.secondary}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:t.lightIconColor,width:12,height:"auto"}}}),[e])}function ft(t){const e=(0,l().tz)(),{collectionContextStore:o,userSettingsStore:n,onDismissModal:r}=t,c=(0,i().v3)(),u=(0,s().IS)((t=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:t.accentColors.blue["light"===t.mode?50:300],borderRadius:4,padding:12,marginBottom:12,fontSize:12,lineHeight:1.5,gap:8},bannerContent:{flex:"1 1 auto",color:t.text.primary},bannerTitle:{fontWeight:a().Wy.regular},icon:{width:12,color:t.blueColor},repeatIcon:{flex:"0 0 auto",marginBlockStart:3},closeButton:{marginTop:-3,borderRadius:"50%"},link:{color:t.text.uiBluePrimary}})),[]);return(0,ct.jsxs)("div",{style:u.banner,children:[(0,ct.jsx)("div",{style:u.repeatIcon,children:(0,_().l)(u.icon)}),(0,ct.jsx)("div",{style:u.bannerContent,children:(0,ct.jsx)("div",{style:u.bannerTitle,children:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.turnOnAutomaticSprints.banner.title",defaultMessage:"Complete your sprints automatically. Turn on Automated sprints in <linkToSprintSettings>Settings</linkToSprintSettings>.",values:{linkToSprintSettings:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return(0,ct.jsx)(lt().A,{onClick:()=>{n&&(r(),O().cJ({environment:c,userSettingsStore:n}),O().Dl(o))},disableUnderline:!0,style:u.link,children:e})}}})})}),(0,ct.jsx)(q().A,{icon:k().u,ariaLabel:e.formatMessage({id:"completeAutomationSprintModal.dismissBannerButton",defaultMessage:"Dismiss banner button"}),style:u.closeButton,onClick:()=>{n&&O().cJ({environment:c,userSettingsStore:n})}})]})}function xt(t){const{currentSprintFormattedDateRange:e,currentSprintTaskSummary:o}=t,{isMobile:n}=(0,i().Y0)(),r=(0,l().tz)(),s=gt({isMobile:n}),a=o?r.formatMessage(ut.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=e&&o?(0,ct.jsxs)(ct.Fragment,{children:[e,(0,ct.jsx)("div",{style:s.separator}),a]}):e||a;return void 0===c?null:(0,ct.jsx)("div",{style:s.subheader,children:c})}function vt(t){const{sprintBlockStore:e,sprintCollectionStore:o}=t;if(!e)return;const n=o.getPropertyMapping(),r=null==n?void 0:n[y().Hx.Dates];if(!r)return;const i=e.getPropertyValue(r);if(!i)return;const s=(0,R().Cok)(i)[0];return s?(0,C().HB)(s):void 0}function yt(t){const{sprintDateRange:e,intl:o}=t;if(e&&(0,C().oM)(e))return(0,b().ZF)({value:e,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const ht={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ct(t){const{actionTypeStore:e}=t,{isMobile:o}=(0,i().Y0)(),n=(0,r().O$)(e),s=gt({isMobile:o});return(0,ct.jsx)(G().Ay,{popupType:o?G().z7.SlideUp:G().z7.Popup,alignmentToOrigin:G().yP.Start,placementToOrigin:G().sx.Bottom,render:t=>(0,ct.jsx)(jt,{actionTypeStore:e,buttonPopupParent:t}),renderOrigin:t=>(0,ct.jsxs)(W().p,{...t,style:s.dropdownButton,children:[ht[n],(0,j().b)(s.dropdownChevronIcon)]})})}const bt=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function jt(t){const{actionTypeStore:e,buttonPopupParent:o}=t,{isMobile:n}=(0,i().Y0)(),s=(0,r().K8)((()=>bt.map((t=>{const n=t===e.state;return{key:t,action:()=>{e.setState(t),o.close()},render:e=>(0,ct.jsx)($().A,{...e,title:ht[t],isChecked:n})}}))),[e,o]);let l;return l=n?{menuType:V().gu.ActionSheet}:{menuType:V().gu.Popup,maxHeight:"50vh",minWidth:230},(0,ct.jsx)(X().A,{...l,children:(0,ct.jsx)(Z().Ay,{type:Z().Oh.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:s,render:t=>(0,ct.jsx)(rt().A,{...t})}]})})}function kt(t){const{nextSprintInput:e,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:a}=t,{sprintCollectionStore:c}=o,{isMobile:u}=(0,i().Y0)(),d=(0,i().v3)(),p=(0,l().tz)(),S=(0,r().K8)((()=>{if(void 0===e)return(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===e.type)return(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===e.type){const t=E().Bv.createChildStore(c,e.pointer);return(0,N().tS)({intl:p,environment:d,store:t,untitledFallback:ut.fallbackSprintName})}(0,F().HB)(e)}),[e,p,c,d]),m=gt({isMobile:u}),g=(0,s().IS)((t=>({button:{...void 0===e&&{color:t.text.tertiary}}})),[e]),f={...m.dropdownButton,...g.button};return 0===a.length||1===a.length?(0,ct.jsx)(W().p,{style:f,disabled:!0,children:S}):(0,ct.jsx)(G().Ay,{popupType:u?G().z7.SlideUp:G().z7.Popup,alignmentToOrigin:G().yP.Start,placementToOrigin:G().sx.Bottom,render:t=>(0,ct.jsx)(At,{buttonPopupParent:t,completeSprintAutomationContext:o,sprintPageIds:a,nextSprintInput:e,setNextSprintInput:n}),renderOrigin:t=>(0,ct.jsxs)(W().p,{...t,style:f,children:[S,(0,j().b)(m.dropdownChevronIcon)]})})}function At(t){const{sprintPageIds:e,completeSprintAutomationContext:o,buttonPopupParent:a,nextSprintInput:c,setNextSprintInput:u}=t,{sprintCollectionStore:d}=o,{isMobile:p}=(0,i().Y0)(),S=(0,r().K8)((()=>d.getSpaceId()),[d]),m=(0,r().K8)((()=>(0,U().B7)({collectionStore:o.taskCollectionStore,property:y().yx.TaskToSprintRelation}).filter((t=>t.visible&&("title"===t.property||o.sprintCollectionSchema[t.property])))),[o]),g=(0,r().K8)((()=>new(H().A)),[]),f=(0,s().IS)((t=>({plusIcon:{color:t.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...p&&{marginRight:12}}})),[p]),x="purple",v=(0,s().DP)(),C=(0,w().LD)(v,x),b=n.useMemo((()=>{const t="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{u({type:"actionId"}),a.close()},render:e=>(0,ct.jsx)($().A,{...e,icon:(0,A().W)(f.plusIcon),title:(0,ct.jsxs)("div",{style:f.createSprintRow,children:[(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,ct.jsx)(at().A,{isRound:!0,showRemoveButton:!1,value:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:h().NY.Medium,isSingle:!0,color:C.textColor,backgroundColor:C.backgroundColor,showColoredDot:x})]}),isChecked:t})}}),[c,a,u,f,C]),j=(0,r().K8)((()=>e.map((t=>{const e={id:t,table:T().ev,spaceId:S},o=E().Bv.createChildStore(d,e),n=o.getIcon(),r="pointer"===(null==c?void 0:c.type)&&M().L3.isEqual(c.pointer,e);return{key:t,action:()=>{u({type:"pointer",pointer:e}),a.close()},render:t=>(0,ct.jsx)($().A,{...t,icon:n&&(0,ct.jsx)(ot().B,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,ct.jsx)("div",{style:f.sprintRow,children:m.map((t=>"title"===t.property?(0,ct.jsx)(nt().A,{store:o,style:f.recordTitle},"title"):(0,ct.jsx)(J().m,{store:o,property:t.property,disabled:!1,locked:!1,format:Y().j.Relation,tableWrap:!1,blockPropertyValueOverlayStore:g,collectionStore:d},t.property))).filter(F().O9)}),isChecked:r})}}))),[d,g,a,c,m,S,u,f,e]),k=[{key:"sprints",items:n.useMemo((()=>j.length>0?j:[b]),[j,b]),render:t=>(0,ct.jsx)(rt().A,{...t})}];let _;return _=p?{menuType:V().gu.ActionSheet}:{menuType:V().gu.Popup,maxHeight:"50vh",minWidth:230},(0,ct.jsx)(X().A,{..._,children:(0,ct.jsx)(Z().Ay,{type:Z().Oh.Vertical,initialFocus:0,sections:k})})}function _t(t){const{sprintDateRange:e,setSprintDateRange:o}=t,a=(0,l().tz)(),{isMobile:c}=(0,i().Y0)(),u=n.useMemo((()=>yt({sprintDateRange:e,intl:a})),[e,a]),d=gt({isMobile:c}),p=(0,s().IS)((t=>({button:{...!u&&{color:t.text.tertiary}}})),[u]),S=(0,r().K8)((()=>u||(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[u]);return(0,ct.jsx)(G().Ay,{popupType:c?G().z7.SlideUp:G().z7.Popup,alignmentToOrigin:G().yP.Start,placementToOrigin:G().sx.Bottom,render:t=>(0,ct.jsx)(Mt,{sprintDateRange:e,setSprintDateRange:o,onDismiss:()=>{t.close()}}),renderOrigin:t=>(0,ct.jsxs)(W().p,{...t,style:{...d.dropdownButton,...p.button},children:[S,(0,j().b)(d.dropdownChevronIcon)]})})}function Mt(t){const{sprintDateRange:e,setSprintDateRange:o,onDismiss:r}=t,{isMobile:s}=(0,i().Y0)(),a=n.useMemo((()=>({starting:null!=e&&e.start_date?{type:"date",start_date:e.start_date}:void 0,ending:null!=e&&e.end_date?{type:"date",start_date:e.end_date}:void 0})),[e]);let c;return c=s?{menuType:V().gu.Modal,right:(0,ct.jsx)(tt().DoneMenuText,{}),onClickRight:r}:{menuType:V().gu.Popup,maxHeight:"50vh",paddingTop:6},(0,ct.jsxs)(X().A,{...c,children:[(0,ct.jsx)(rt().A,{children:(0,ct.jsx)(it().A,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:a,onUpdate:t=>{var e,n;if(t.error)return;const r={...a,...t.value},i=null===(e=r.starting)||void 0===e?void 0:e.start_date,s=null===(n=r.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:i,end_date:s})},onDismiss:r})}),(0,ct.jsx)(rt().A,{topBorder:!0,children:(0,ct.jsx)($().A,{focused:!1,onClick:()=>{o(void 0)},title:(0,ct.jsx)(l().sA,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}o(672577);var Tt=()=>o(416504),It=()=>o(187174),Rt=()=>o(799829),wt=()=>o(449506),Bt=()=>o(950914),Ft=()=>o(374562);function Dt(t){if(!t)return;if("aggregation"!==t.type)return;if("text"!==t.aggregationResult.type)return;const e=t.aggregationResult.value,o=null==e?void 0:e.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),r=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:r-n,totalTaskCount:r,completedTaskPercent:0===r?0:n/r}}function Pt(t){if(!t)return;const e=t.getPropertyMapping(),o=null==e?void 0:e[y().yx.TaskToSprintRelation];if(!o)return;return Ft().jj.filter.property=o,{...Ft().jj.filter,property:o}}function Ot(t,e){if(!e)return;const o=e.getPropertyMapping(),n=Pt(e);if(!n)return;const r=null==o?void 0:o[y().yx.Status];if(!r)return;const i=e.getSchema()[r];if(!i||"status"!==i.type)return;const s=(0,Bt().Q6)(t,i);return s?{type:"aggregation",filter:{operator:"and",filters:[n]},aggregation:{aggregator:{operator:"count_per_group",groupName:s},property:r}}:void 0}class Kt extends x().default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(t){const{querySprintsResult:e,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):t?this.setState({...this.state,currentSprintId:t}):this.setState({...this.state,isLoading:!0,currentSprintId:t})}updateNextAndFutureSprints(t){const{currentSprintId:e,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):t?this.setState({...this.state,querySprintsResult:t}):this.setState({...this.state,isLoading:!0,querySprintsResult:t})}updateCurrentSprintTaskSummary(t){const{currentSprintId:e,querySprintsResult:o}=this.state;void 0!==e&&void 0!==o&&void 0!==t?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:o,currentSprintTaskSummary:t}):t?this.setState({...this.state,currentSprintTaskSummary:t}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:t})}}const Lt=Kt;function Vt(t){const{taskCollectionContextStore:e,completeSprintAutomationContext:o,children:s,isModalOpen:a}=t,{sprintCollectionStore:c}=o,u=c.id,d=(0,i().v3)(),p=(0,r().K8)((()=>new Lt),[]),S=(0,r().K8)((()=>p.state),[p]),m=(0,r().K8)((()=>{var t;const o=e.relativeVariableStore.state;return null==o||null===(t=o[u])||void 0===t?void 0:t.current}),[u,e]);n.useEffect((()=>{p.updateCurrentSprint(m)}),[m,p]);const[{value:g}]=(0,It().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n}=t,{sprintCollectionStore:r}=n,i=function(t){var e,o;const{sprintCollectionStore:n,sprintCollectionSchema:r}=t,i=n.getPropertyMapping(),s=null==i?void 0:i[y().Hx.StatusV2];if(!s)return;const l=r[s];if(!l||"status"!==l.type)return;const a=null===(e=l.options)||void 0===e||null===(e=e.find((t=>t.id===y().tO)))||void 0===e?void 0:e.value,c=null===(o=l.options)||void 0===o||null===(o=o.find((t=>t.id===y().Jd)))||void 0===o?void 0:o.value;if(!a||!c)return;const u=Rt().n$[y().av].next.reducer.getCombinatorFilter(r);if(!u)return;const d={type:"results",filter:u,limit:Nt},p={type:"results",filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:Nt};return{[y().tO]:d,[y().Jd]:p}}(n),s=r.getPropertyMapping(),l=null==s?void 0:s[y().Hx.Dates],a=null==s?void 0:s[y().Hx.UniqueId];if(!i||!l||!a)return;const c={userId:o.currentUser.id,userTimeZone:(0,Tt().P)(),searchQuery:void 0,sort:[{property:l,direction:"ascending"},{property:a,direction:"ascending"}],reducers:i},u=null===(e=r.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],d=r.getSpaceId();if(!u)return;const p=await wt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:r.id,spaceId:d},collectionView:{id:u.id,spaceId:d},loader:c},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==p.type)return;const S=p.data.result.reducerResults[y().tO],m=p.data.result.reducerResults[y().Jd];if("results"!==S.type||"results"!==m.type)return;const g=S.blockIds,f=m.blockIds;return{nextSprintIds:g,futureSprintIds:f}}({environment:d,completeSprintAutomationContext:o})),[m,d,o]);n.useEffect((()=>{p.updateNextAndFutureSprints(g)}),[g,p]);const f=(0,l().tz)(),[{value:x}]=(0,It().Yb)((async()=>await async function(t){var e;const{environment:o,completeSprintAutomationContext:n,intl:r}=t,{taskCollectionStore:i}=n,s=Ot(r,i);if(!s)return;const l=Pt(i);if(!l)return;const a={filter:{operator:"and",filters:[l]},userId:o.currentUser.id,userTimeZone:(0,Tt().P)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:s}},c=null===(e=i.getParentBlockStore())||void 0===e?void 0:e.getCollectionViewStores()[0],u=i.getSpaceId();if(!c)return;const d=await wt().callApi({eventName:"queryCollection",environment:o,data:{source:{type:"collection",id:i.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:a},tracking:{src:"complete_sprint_modal_sprint_picker"}});if("success"!==d.type)return;return Dt(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({intl:f,environment:d,completeSprintAutomationContext:o})),[m,d,o,a]);return n.useEffect((()=>{p.updateCurrentSprintTaskSummary(x)}),[x,p]),(0,ct.jsx)(ct.Fragment,{children:s({completeSprintAutomationState:S,onAutomationComplete:()=>{p.reset()}})})}const Nt=5;var Ut=()=>o(864943),zt=()=>o(101981),Ht=()=>o(873050),Et=()=>o(67775);function Jt(t){const{percentage:e}=t;return(0,ct.jsx)(Et().l,{numberValue:e,numberFormat:void 0,numberPrecision:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}const Yt=function(t){const{isLoading:e,taskSummary:n,styles:r}=t;return(0,ct.jsx)("div",{style:{width:16,height:"auto",...r},children:e?(0,ct.jsx)(o(331542).A,{}):(0,ct.jsx)(Jt,{percentage:(null==n?void 0:n.completedTaskPercent)??0})})};function Wt(t){const{taskCollectionContextStore:e,children:o}=t,n=(0,r().K8)((()=>(0,Ht().y_)(e)),[e]),i=(0,r().K8)((()=>e.collectionStore()),[e]),s=(0,l().tz)(),a=(0,r().K8)((()=>Ot(s,i)),[i,s]);return!a||n?null:(0,ct.jsx)(zt().A,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:e,reducer:a,render:t=>{const e=Dt(t.state);return e?(0,ct.jsxs)(ct.Fragment,{children:[(0,ct.jsx)($t,{currentSprintTasksInView:e}),o(e)]}):null}})}function $t(t){const{currentSprintTasksInView:e}=t,o=(0,s().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",columnGap:5,color:t.text.tertiary,fontSize:a().J.UIRegular.desktop,fontWeight:a().Wy.regular,whiteSpace:"nowrap"}})),[]),{isPhone:n}=(0,i().Y0)();return n?null:(0,ct.jsxs)("div",{style:o.summary,children:[(0,ct.jsx)(Yt,{styles:{paddingTop:1},isLoading:!1,taskSummary:e}),(0,ct.jsx)(l().sA,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:e.completedTaskCount,totalTaskCount:e.totalTaskCount}})]})}function Gt(t){const{collectionContextStore:e,completeSprintAutomationContext:o}=t,s=(0,i().v3)(),[l,a]=n.useState(!1),[c,g]=n.useState(!1),f=n.useCallback((()=>{g(!1)}),[g]),x=(0,r().K8)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),v=(0,r().K8)((()=>m().default.state.currentUserSettingsStore),[]),y=()=>{g(!0);"complete-sprint-button-tooltip"===(0,S().gt)(v,"sprints-onboarding")&&d().tutorialGoToNextStep(s,"sprints-onboarding"),u(s,{...(0,p().sl)(e),action:"open_modal"})};return x?(0,ct.jsxs)(ct.Fragment,{children:[(0,ct.jsx)(Vt,{completeSprintAutomationContext:o,taskCollectionContextStore:e,isModalOpen:c,children:t=>{let{completeSprintAutomationState:n,onAutomationComplete:r}=t;return(0,ct.jsx)(dt,{completeSprintAutomationContext:o,isOpen:c,onDismiss:f,setIsLoading:a,taskCollectionContextStore:e,completeSprintAutomationState:n,onAutomationComplete:r})}}),(0,ct.jsx)(Wt,{taskCollectionContextStore:e,children:()=>(0,ct.jsx)(qt,{taskCollectionContextStore:e,onClick:y,isLoading:l})})]}):null}function qt(t){const{taskCollectionContextStore:e,onClick:o,isLoading:c}=t,{isPhone:u}=(0,i().Y0)(),d=n.useRef(null),p=function(t){const{isPhone:e}=t;return(0,s().IS)((t=>({button:{height:26,marginLeft:8,fontWeight:a().Wy.medium,...e&&{flexGrow:1,borderRadius:8,height:44}}})),[e])}({isPhone:u}),S=(0,r().K8)((()=>e.collectionViewBlockStore()),[e]),f=(0,r().O$)(m().AppStoreCurrentSpaceStore),x=(0,r().K8)((()=>null==S?void 0:S.getSpaceId()),[S]);if(!S)return(0,ct.jsx)(ct.Fragment,{});const v=x===(null==f?void 0:f.id);return(0,ct.jsxs)(ct.Fragment,{children:[(0,ct.jsx)(Ut().A,{size:"lg",ref:d,onClick:o,style:p.button,disabled:c,disabledFeedback:c,children:(0,ct.jsx)(l().sA,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),v&&(0,ct.jsx)(g().rY,{origin:d})]})}var Qt=()=>o(244641);function Xt(t){var e;const{collectionContextStore:o,sprintAutomationContext:n}=t,l=(0,s().IS)((t=>({summary:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:17,columnGap:5,color:t.text.tertiary,fontSize:a().J.UIRegular.desktop,fontWeight:a().Wy.regular,whiteSpace:"nowrap"},icon:{width:16,height:"auto",paddingTop:2}})),[]),{isPhone:c}=(0,i().Y0)(),u=(0,r().K8)((()=>{var t;const e=null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.getRunAt();if(!e)return;const o=Qt().c9.fromMillis(e,{zone:"utc"}).toLocal().startOf("day"),r=Qt().c9.now().startOf("day"),i=o.diff(r,"days").days;return i<1?"soon":1===i?"today":2===i?"tomorrow":i-1}),[null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return u?(0,ct.jsx)(Wt,{taskCollectionContextStore:o,children:()=>c?null:(0,ct.jsxs)("div",{style:l.summary,children:[(0,_().l)(l.icon),(0,ct.jsx)(Zt,{daysRemaining:u})]})}):null}function Zt(t){const{daysRemaining:e}=t;return"soon"===e?(0,ct.jsx)(l().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===e?(0,ct.jsx)(l().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===e?(0,ct.jsx)(l().sA,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,ct.jsx)(l().sA,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:e}})}const te=function(t){var e;const{collectionContextStore:o}=t,n=(0,r().K8)((()=>o.completeSprintButtonContextStore.state),[o]),i=(0,r().K8)((()=>{var t;return Boolean(null==n||null===(t=n.automationContext)||void 0===t?void 0:t.automationStore.isActive())}),[null==n||null===(e=n.automationContext)||void 0===e?void 0:e.automationStore]);return n?i?(0,ct.jsx)(Xt,{collectionContextStore:o,sprintAutomationContext:n}):(0,ct.jsx)(Gt,{collectionContextStore:o,completeSprintAutomationContext:n}):null}},37489:(t,e,o)=>{function n(t){var e;const o=Boolean(null===(e=function(t){var e,o;if(!t.isInViewTabLayout())return;if("page"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()))return;return null===(o=t.collectionViewStore())||void 0===o?void 0:o.getCollectionStore()}(t))||void 0===e?void 0:e.canEditCollection());return t.permissionScopesStore.state.canConfigureBlock||t.isEphemeralView()||o}o.d(e,{H:()=>n})},73223:(t,e,o)=>{o.r(e),o.d(e,{dismissTutorial:()=>u,resetTutorials:()=>d,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>S,tutorialGoToNextStep:()=>a,tutorialGoToPrevStep:()=>c});var n=()=>o(541235),r=()=>o(751156),i=()=>o(755199),s=()=>o(739135),l=()=>o(351360);function a(t,e){var o;const{currentUserSettingsStore:n}=l().default.state;if(!n)return;const r=null===(o=n.getSettings())||void 0===o?void 0:o.tutorials;m({userAction:"TutorialActions.nextStep",environment:t,perform:t=>{i().mJ({userSettingsStore:n,transaction:t,data:{tutorials:{...r,[e]:(0,s().i9)(n,e)}}})},userId:n.id})}function c(t,e){var o;const{currentUserSettingsStore:n}=l().default.state;if(!n)return;const r=null===(o=n.getSettings())||void 0===o?void 0:o.tutorials;m({userAction:"TutorialActions.prevStep",environment:t,perform:t=>{i().mJ({userSettingsStore:n,transaction:t,data:{tutorials:{...r,[e]:(0,s().KD)(n,e)}}})},userId:n.id})}function u(t,e){var o;const{currentUserSettingsStore:r}=l().default.state;if(!r)return;const s=null===(o=r.getSettings())||void 0===o?void 0:o.tutorials;(null==s?void 0:s[e])!==n().YD&&m({userAction:"TutorialActions.dismissTutorial",environment:t,perform:t=>{i().mJ({userSettingsStore:r,transaction:t,data:{tutorials:{...s,[e]:n().YD}}})},userId:r.id})}function d(t){const{currentUserSettingsStore:e}=l().default.state;e&&m({userAction:"TutorialActions.resetTutorialsDebug",environment:t,perform:t=>{i().mJ({userSettingsStore:e,transaction:t,data:{tutorials:{}}})},userId:e.id})}function p(t,e,o){var r;const{currentUserSettingsStore:a}=l().default.state;if(!a||(0,s().x$)(a,e))return;const c=(0,s().gt)(a,e);n().c$[e].steps.findIndex((t=>t.id===c))>=n().c$[e].steps.findIndex((t=>t.id===o))||i().mJ({userSettingsStore:a,transaction:t,data:{tutorials:{...null===(r=a.getSettings())||void 0===r?void 0:r.tutorials,[e]:o}}})}function S(t,e,o){if((0,s().ll)(o))return;const n=(0,s().tb)(e,o);n&&p(t,e,n)}function m(t){return r().createAndCommit({...t,canUndo:!1})}},75544:(t,e,o)=>{o.d(e,{A:()=>p});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520);var n=o(296540),r=()=>o(908006),i=()=>o(847249),s=()=>o(737658),l=()=>o(336811),a=()=>o(496603),c=()=>o(183558),u=()=>o(921598);function d(t){const{reducerId:e,instanceId:o,reducer:n,collectionContextStore:r,groupsPointer:i}=t,s=r.reducersStore.state,l=s[e];let c,d;if(i&&i.length>0&&(c=(0,u().Hm)(i)),n){if(d={instanceIds:a().sb([...(null==l?void 0:l.instanceIds)||[],o]),reducer:n},c){r.reducerDependencies.has(c)||r.reducerDependencies.set(c,new Set);const t=r.reducerDependencies.get(c);null==t||t.add(e)}}else{if(c){const t=r.reducerDependencies.get(c);t&&(t.delete(e),0===t.size&&r.reducerDependencies.delete(c))}const t=a().FF((null==l?void 0:l.instanceIds)||[],o);d=l&&t.length>0?{instanceIds:t,reducer:l.reducer}:void 0}a().n4(l,d)||r.reducersStore.setState({...s,[e]:d})}function p(t){const{id:e,reducer:o,collectionContextStore:u,groupsPointer:p,debounceWait:S}=t,m=(0,i().K8)((()=>p),[p],{useDeepEqual:!0}),g=(0,i().K8)((()=>o),[o],{useDeepEqual:!0}),f=(0,i().K8)((()=>u.collectionViewStore()),[u]),x=(0,i().K8)((()=>u.normalizedFormatStore.state.collection_pointer),[u.normalizedFormatStore]),v=(0,i().K8)((()=>{var t;return null==f||null===(t=f.getFormatStore())||void 0===t?void 0:t.getKeyStore("collection_view_source").getValue()}),[f]),y=(0,n.useRef)(!1),h=(0,l().O)(),[C,b]=(0,n.useReducer)(((t,e)=>a().n4(t,e)?t:e),void 0),j=(0,n.useCallback)((()=>{const t=u.localResultStore.state,o=u.remoteResultStore.state,n=t&&"reducer"===t.type?t.reducerResults[e]:void 0,r=o&&"reducer"===o.type?o.reducerResults[e]:void 0;return function(t){const{reducerId:e,localReducerResult:o,remoteReducerResult:n,collectionContextStore:r,reducer:i}=t,l=r.reducersStore.state,c=r.remoteResultStore.state,u=r.isClientModeEnabledStore.state;if(u)return o;const d=r.isCreatingNewChartCollectionStore.state,p=r.wasCreatedThisSessionStore.state;if("aggregation"===i.type){if(d&&p){return Boolean(n&&"aggregation"===n.type&&"number"===n.aggregationResult.type&&0!==n.aggregationResult.value)&&r.isCreatingNewChartCollectionStore.setState(!1),o}if(n)return n;const t=Boolean(c&&"reducer"===c.type&&a().I6(c.reducerResults,((t,e)=>{const o=l[e];return!!o&&Boolean("results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===t.type&&t.hasMore&&a().n4(i.filter,o.reducer.filter))})));return t?o:n}if("groups"===i.type){if(d&&p){return Boolean(n&&"groups"===n.type&&("v2"===n.version?n.hasMore:0!==n.total))&&r.isCreatingNewChartCollectionStore.setState(!1),o}if("v2"===i.version){var S;let t,e,l;if(i.aggregation&&(n&&"groups"===n.type&&"v2"===n.version?t=n.aggregationResults:o&&"groups"===o.type&&"v2"===o.version&&(t=o.aggregationResults)),i.blockResults){var m;const t=Boolean(n&&"groups"===n.type&&"v2"===n.version&&n.blockResults),i=null===(m=r.collectionViewStore())||void 0===m?void 0:m.getCollectionSource(),l=(0,s().TR)(i)||(0,s().hJ)(i);if((t||p)&&!l&&o&&"groups"===o.type&&"v2"===o.version&&o.blockResults){const t=o.blockResults,r="groups"===(null==n?void 0:n.type)&&"v2"===n.version&&n.blockResults?n.blockResults:{},i=new Set([...Object.keys(t),...Object.keys(r)]),s={};for(const e of i){const o=t[e],n=r[e];let i=[];o?i=o.blockIds:n&&(i=n.blockIds);let l=!1;n?l=n.hasMore:o&&(l=o.hasMore),s[e]={blockIds:i,hasMore:l}}e=s}}o&&"groups"===o.type&&"v2"===o.version&&o.pinnedResults&&(l=o.pinnedResults),n&&"groups"===n.type&&"v2"===n.version&&n.pinnedResults&&(l={groupResults:n.pinnedResults.groupResults,...l,aggregationResults:n.pinnedResults.aggregationResults});let a,c=!1;n&&"groups"===n.type&&"v2"===n.version?(c=n.hasMore,a=n.hasMoreSubGroups):o&&"groups"===o.type&&"v2"===o.version&&(c=o.hasMore,a=o.hasMoreSubGroups);let u=o??n;return r.forceLocalQueryCollection&&(u=n??o),"groups"===(null===(S=u)||void 0===S?void 0:S.type)&&"v2"===u.version?{...u,pinnedResults:l,hasMore:c,hasMoreSubGroups:a,blockResults:e??u.blockResults,aggregationResults:t}:void 0}return n||o}if("results"===i.type){var g;const t=r.wasCreatedThisSessionStore.state,i=Boolean(c&&"reducer"===c.type&&c.reducerResults[e]),l=null===(g=r.collectionViewStore())||void 0===g?void 0:g.getCollectionSource(),a=(0,s().TR)(l)||(0,s().hJ)(l);if((i||t)&&!a&&o&&"results"===o.type){return{...o,hasMore:n&&"results"===n.type?n.hasMore:o.hasMore}}return n}}({reducerId:e,collectionContextStore:u,reducer:g,localReducerResult:n,remoteReducerResult:r})}),[u,g,e]),k=(0,n.useCallback)((()=>{y.current=!1,h.current||b(j())}),[j,h]),A=(0,n.useCallback)((()=>{y.current||(y.current=!0,r().default.afterNextFlush(k))}),[k]),[_]=(0,n.useState)((()=>(0,c().Ay)()));return(0,n.useEffect)((()=>{const t=S?(0,a().sg)(A,S,{leading:!0}):A;return u.remoteResultStore.addListener(A),u.localResultStore.addListener(t),()=>{u.remoteResultStore.removeListener(A),u.localResultStore.removeListener(t)}}),[u,A,S]),(0,n.useEffect)((()=>(d({reducerId:e,instanceId:_,reducer:g,collectionContextStore:u,groupsPointer:m}),()=>{d({reducerId:e,instanceId:_,reducer:void 0,collectionContextStore:u,groupsPointer:m})})),[u,f,x,v,m,g,e,_]),(0,n.useEffect)((()=>{A()}),[]),(0,n.useEffect)((()=>(u.timingTracker.mountCollectionReducerRequest(e,g.type),()=>{u.timingTracker.unmountCollectionReducerRequest(e)})),[u,e,g]),C}},101981:(t,e,o)=>{o.d(e,{A:()=>l});var n=o(296540),r=()=>o(847249),i=o(474848);function s(t){const{resultStore:e,render:s,...l}=t,a=(0,o(75544).A)(l),c=(0,r().uB)(e,o(757695).default.createClass(void 0));(0,n.useEffect)((()=>{c.setState(a);const e=t.reducer;"groups"===e.type&&"v2"===e.version&&"groups"===(null==a?void 0:a.type)&&"v2"===a.version&&t.collectionContextStore.groupsStore.setGroupBlockResults(e,a)}),[t.collectionContextStore.groupsStore,t.reducer,a,c]);const u=(0,r().K8)((()=>s?s(c):null),[s,c]);return(0,i.jsx)(i.Fragment,{children:u})}const l=n.memo(s)},189048:(t,e,o)=>{o.d(e,{u:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowDownThick",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M7.99316 1.52246C7.40527 1.52246 7.00195 1.93262 7.00195 2.54785V10.1357L7.07031 11.6191L5.69629 10.0332L4.1582 8.50195C3.98047 8.31738 3.74805 8.19434 3.44727 8.19434C2.91406 8.19434 2.51074 8.59082 2.51074 9.15137C2.51074 9.41113 2.61328 9.65039 2.81836 9.8623L7.26172 14.3125C7.44629 14.5039 7.72656 14.6133 7.99316 14.6133C8.2666 14.6133 8.54004 14.5039 8.72461 14.3125L13.1748 9.8623C13.3799 9.65039 13.4824 9.41113 13.4824 9.15137C13.4824 8.59082 13.0791 8.19434 12.5459 8.19434C12.252 8.19434 12.0195 8.31738 11.835 8.50195L10.2969 10.0332L8.92285 11.6191L8.98438 10.1357V2.54785C8.98438 1.93262 8.58789 1.52246 7.99316 1.52246Z"})})},199734:(t,e,o)=>{o.d(e,{U:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionSearch",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M0 6.35938C0 9.86719 2.85156 12.7188 6.35938 12.7188C7.66406 12.7188 8.85938 12.3203 9.85938 11.6406L13.4531 15.2344C13.6719 15.4609 13.9766 15.5625 14.2812 15.5625C14.9453 15.5625 15.4219 15.0625 15.4219 14.4141C15.4219 14.1016 15.3125 13.8125 15.1016 13.5938L11.5312 10.0156C12.2734 8.99219 12.7188 7.72656 12.7188 6.35938C12.7188 2.85156 9.86719 0 6.35938 0C2.85156 0 0 2.85156 0 6.35938ZM1.65625 6.35938C1.65625 3.76562 3.75781 1.65625 6.35938 1.65625C8.95312 1.65625 11.0625 3.76562 11.0625 6.35938C11.0625 8.95312 8.95312 11.0625 6.35938 11.0625C3.75781 11.0625 1.65625 8.95312 1.65625 6.35938Z"})})},244091:(t,e,o)=>{o.d(e,{Ni:()=>l,U7:()=>s,rY:()=>a});o(296540);var n=()=>o(959013),r=()=>o(292379),i=o(474848);function s(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function l(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function a(t){let{origin:e}=t;return(0,i.jsx)(r().B,{origin:e,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,i.jsx)(n().sA,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},292379:(t,e,o)=>{o.d(e,{B:()=>S});var n=o(296540),r=()=>o(484714),i=()=>o(847249),s=()=>o(541235),l=()=>o(73223),a=()=>o(739135);const c=new Map;var u=()=>o(351360),d=()=>o(953006),p=o(474848);function S(t){let{tutorialId:e,tutorialStepId:o,onPrimaryButtonClick:S,displayStore:m,...g}=t;const f=(0,r().v3)(),x=function(t){const e=!c.get(t),o=(0,n.useRef)(e);return o.current&&c.set(t,!0),(0,n.useEffect)((()=>()=>{o.current&&c.set(t,!1)}),[t]),o.current}(`${e}.${o}`),{currentStep:v,isLoading:y}=(0,i().K8)((()=>{var t;return{isLoading:!(null!==(t=u().default.state.currentUserSettingsStore)&&void 0!==t&&t.getSettings()),currentStep:(0,a().gt)(u().default.state.currentUserSettingsStore,e)}}),[e]);if((0,n.useEffect)((()=>{y||v!==o||!x?null==m||m.setState(!1):null==m||m.setState(!0)}),[y,v,o,x,m]),y||v!==o||!x)return null;const h=s().c$[e],C=h.steps.findIndex((t=>t.id===o)),b=h.steps.length;return(0,p.jsx)(d().k,{onCloseClick:()=>{l().dismissTutorial(f,e)},onPrimaryButtonClick:t=>{l().tutorialGoToNextStep(f,e),null==S||S(t)},onBackButtonClick:()=>{l().tutorialGoToPrevStep(f,e)},numSteps:b,currStepIndex:C,...g})}},300089:(t,e,o)=>{o.d(e,{N9:()=>ot,aV:()=>tt,he:()=>st});o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),r=()=>o(395361),i=()=>o(484714),s=()=>o(847249),l=()=>o(401497),a=()=>o(199734),c=()=>o(863330),u=()=>o(725649),d=()=>o(959013),p=()=>o(496603),S=()=>o(436696),m=()=>o(187899),g=()=>o(686526),f=()=>o(778417),x=()=>o(725614),v=()=>o(59400),y=()=>o(615950),h=()=>o(145214),C=()=>o(493823),b=()=>o(594739),j=()=>o(439264),k=()=>o(805751),A=()=>o(623580),_=()=>o(897119),M=()=>o(2143),T=()=>o(59822),I=()=>o(10323),R=()=>o(109488),w=()=>o(873050),B=()=>o(525432),F=()=>o(253579),D=()=>o(963589),P=()=>o(756279),O=()=>o(463830),K=()=>o(700250),L=()=>o(17090),V=()=>o(324577),N=()=>o(404779),U=()=>o(37489),z=()=>o(519839),H=()=>o(958832),E=()=>o(602141),J=()=>o(189048),Y=()=>o(134421),W=o(474848);const $=(0,o(340498).wt)("arrowUpThick",{viewBox:"0 0 16 16",svg:(0,W.jsx)("path",{d:"M7.99316 14.6133C8.58789 14.6133 8.98438 14.2031 8.98438 13.5879V6L8.92285 4.5166L10.2969 6.10254L11.835 7.63379C12.0195 7.81836 12.252 7.94141 12.5459 7.94141C13.0791 7.94141 13.4824 7.54492 13.4824 6.98438C13.4824 6.72461 13.3799 6.48535 13.1748 6.27344L8.72461 1.82324C8.54004 1.63184 8.2666 1.52246 7.99316 1.52246C7.72656 1.52246 7.44629 1.63184 7.26172 1.82324L2.81836 6.27344C2.61328 6.48535 2.51074 6.72461 2.51074 6.98438C2.51074 7.54492 2.91406 7.94141 3.44727 7.94141C3.74805 7.94141 3.98047 7.81836 4.1582 7.63379L5.69629 6.10254L7.07031 4.5166L7.00195 6V13.5879C7.00195 14.2031 7.40527 14.6133 7.99316 14.6133Z"})});var G=()=>o(284371),q=()=>o(377586),Q=()=>o(56394);function X(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const{device:r}=(0,i().v3)(),l=(0,s().K8)((()=>o.state.open),[o]),a=(0,n.useCallback)((t=>{t&&(0,F().Rp)(t.target)||g().os({collectionSettingsStore:o})}),[o]),c=(0,n.useCallback)((()=>(0,W.jsx)(v().m$,{context:B().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})),[e,o]);return(0,n.useEffect)((()=>()=>g().os({collectionSettingsStore:o})),[]),(0,W.jsx)(_().Ay,{popupType:r.isMobile?q().n.SlideUp:q().n.Popup,placementToOrigin:K().UV.Bottom,alignmentToOrigin:K().MY.Start,open:l,origin:(0,W.jsx)(Z,{collectionContextStore:e,collectionSettingsStore:o}),onDismiss:a,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function Z(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const r=(0,i().v3)(),[a,c,u,p]=(0,s().K8)((()=>[e.currentSortsStore.state,e.localStateDiffStore.state,e.normalizedSchemaStore.state,e.permissionScopesStore.state]),[e]),m=a[0],f=m?u[m.property]:void 0,x=(0,n.useCallback)((()=>{(0,S().X)({environment:r,collectionContextStore:e,action:"click_sort"}),g().R8({collectionSettingsStore:o,item:{type:"sort"}})}),[e,o,r]),v=(0,l().IS)((t=>({arrowIcon:{width:12,marginRight:4,fill:t.blueColor},arrowsIcon:{width:16,marginRight:4,fill:t.blueColor},title:{marginTop:-1,maxWidth:220,...G().RC}})),[]);let y;return y=1===a.length?m&&"descending"===m.direction?(0,J().u)(v.arrowIcon):$(v.arrowIcon):(0,Y().X)(v.arrowsIcon),(0,W.jsx)(Q().A,{on:!0,hasDiff:Boolean(p.canConfigureBlock&&c.sorts),icon:y,title:(0,W.jsx)("span",{style:v.title,children:1===a.length&&f?f.name:(0,W.jsx)(d().sA,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:a.length}})}),onClick:x})}let tt=function(t){return t[t.FilterBar=0]="FilterBar",t[t.SettingsFilters=1]="SettingsFilters",t}({});const et=o(757695).default.createClass({open:!1,stack:[]},{name:"CreateFilterSettingsStore"});function ot(t){var e,o;let{collectionContextStore:r,showHoverActionsStore:a,createFilterSettingsStore:c,saveControlMoreActionsButtonPopupStore:p}=t;const S=(0,i().WS)(),m=(0,l().DP)(),g=(0,D().X)("db_ux_chrome"),f=(0,s().uB)(p,O().A),x=(0,s().uB)(c,et),v=(0,s().K8)((()=>(0,w().y_)(r)),[r]),y=(0,s().K8)((()=>S&&r.searchOpenStore.state),[S,r]),h=(0,s().O$)(r.currentPropertyFiltersStore),C=(0,s().O$)(r.currentSortsStore),b=(0,s().K8)((()=>r.filterBarSortSettingsStore.state.open),[r]),j=C.length>0||b,k=(0,s().K8)((()=>r.isUnlistedViewStore.state),[r]),A=(0,s().K8)((()=>(0,U().H)(r)?r.currentCombinatorFilterStore.state:void 0),[r]),_=(0,s().uB)(void 0,L().A),R=null===(e=(0,z().Oz)(r))||void 0===e?void 0:e.background,B=(0,s().K8)((()=>"collectionSettings"===r.contextType),[r]),F=(0,s().K8)((()=>r.collectionViewBlockStore()),[r]),K=(0,s().K8)((()=>r.collectionStore()),[r]),N=(0,V().Y)(F),H=(0,s().K8)((()=>{var t,e;if(!N||!K)return;const o=null===(t=N.getModel())||void 0===t?void 0:t.getData();return null==o||null===(e=o.modules)||void 0===e?void 0:e.filter((t=>"database"===t.type)).find((t=>{var e;return(null===(e=(0,u().DK)(t.state))||void 0===e||null===(e=e.pointer)||void 0===e?void 0:e.id)===K.id}))}),[N,K]),E=(0,n.useCallback)((t=>{r.filtersBarOpenStore.setState(!0)}),[r]),J=(0,l().IS)((t=>({container:{width:"100%",zIndex:86,...g&&{borderTop:`1px solid ${t.tableDividerColor}`,marginTop:4},...k&&{paddingLeft:16,paddingRight:16,borderTop:"none"}}})),[g,k]);return(0,W.jsxs)("div",{style:J.container,onClick:E,tabIndex:0,role:"button",children:[B&&(null===(o=(0,u().DK)(null==H?void 0:H.state))||void 0===o?void 0:o.filter)&&!v&&(0,W.jsx)("div",{style:{fontSize:14,color:m.text.tertiary,paddingTop:6},children:(0,W.jsx)(d().sA,{id:"database.filterBar.collectionSettings.workflowAppFilter",defaultMessage:"This filter is used by the appâ€™s Functions"})}),(0,W.jsxs)("div",{style:{display:"flex",paddingTop:4},children:[y&&(0,W.jsx)(ct,{collectionContextStore:r}),!y&&(0,W.jsxs)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:[(0,W.jsx)(M().H,{store:_,type:P().A.X,style:{display:"flex",alignItems:"center",paddingTop:8,paddingBottom:8},children:S?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ut,{collectionContextStore:r}),j&&(0,W.jsx)(rt,{collectionContextStore:r}),j&&!S&&(0,W.jsx)(st,{}),A&&(0,W.jsx)(nt,{collectionContextStore:r}),(0,W.jsx)(at,{collectionContextStore:r,propertyFilters:h,createFilterSettingsStore:x}),(0,W.jsx)(St,{collectionContextStore:r,showHoverActionsStore:a,createFilterSettingsStore:x})]}):(0,W.jsxs)(W.Fragment,{children:[j&&(0,W.jsx)(rt,{collectionContextStore:r}),j&&!S&&(0,W.jsx)(st,{}),A&&(0,W.jsx)(nt,{collectionContextStore:r}),(0,W.jsx)(at,{collectionContextStore:r,createFilterSettingsStore:x,propertyFilters:h}),(0,W.jsx)(St,{collectionContextStore:r,showHoverActionsStore:a,createFilterSettingsStore:x})]})}),!S&&(0,W.jsx)(T().A,{store:_,backgroundColor:R})]}),(0,W.jsxs)("div",{style:{display:"flex",alignItems:"start",paddingTop:6,marginLeft:"auto",flexShrink:0},children:[!S&&v&&(0,W.jsx)(dt,{collectionContextStore:r,showHoverActionsStore:a,saveControlMoreActionsButtonPopupStore:f}),!S&&(0,W.jsx)(I().A,{collectionContextStore:r})]})]}),S&&!y&&(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[v&&(0,W.jsx)(dt,{collectionContextStore:r,showHoverActionsStore:a,saveControlMoreActionsButtonPopupStore:f}),(0,W.jsx)(I().A,{collectionContextStore:r})]})]})}function nt(t){let{collectionContextStore:e}=t;return(0,W.jsx)(H().l,{context:tt.FilterBar,collectionSettingsStore:e.filterBarCombinatorFilterSettingsStore,collectionContextStore:e})}function rt(t){let{collectionContextStore:e}=t;return(0,W.jsx)(X,{collectionContextStore:e,collectionSettingsStore:e.filterBarSortSettingsStore},"sort")}function it(t){let{filter:e,collectionContextStore:o,onClick:n}=t;const r=(0,s().K8)((()=>o.getFilterBarItemSettingsStore(e)),[o,e]);return(0,W.jsx)(E().A,{id:e.id,context:tt.FilterBar,collectionContextStore:o,collectionSettingsStore:r,onClick:n},e.id)}function st(){const t=(0,l().DP)();return(0,W.jsx)("div",{style:{borderRight:`1px solid ${t.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}function lt(t){t.searchOpenStore.setState(!1),t.searchQueryStore.setState("")}function at(t){let{propertyFilters:e,collectionContextStore:o,createFilterSettingsStore:r}=t;const l=(0,i().v3)(),a=(0,s().O$)(o.permissionScopesStore),[c]=(0,s().K8)((()=>[o.currentPropertyFiltersStore.state]),[o]),u=(0,n.useCallback)((t=>{g().os({collectionSettingsStore:r}),g().os({collectionSettingsStore:o.filterBarSortSettingsStore}),g().os({collectionSettingsStore:o.filterBarCombinatorFilterSettingsStore}),c.filter((e=>!t||e.id!==t)).forEach((t=>{const e=o.getFilterBarItemSettingsStore(t);g().os({collectionSettingsStore:e})}))}),[o,r,c]);if(a.canConfigureBlock){const t=e.map((t=>t.id));return(0,W.jsx)(j().Ay,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const n=e.find((e=>e.id===t));if(n)return(0,W.jsx)(it,{collectionContextStore:o,filter:n,onClick:u})},style:{display:"flex",flexShrink:0},onDrop:t=>function(t,e,o){if(!o.collectionViewBlockStore())return;const n=o.currentPropertyFiltersStore.state,r=p().oE(t.map((t=>n.find((e=>e.id===t)))));m().IU({environment:e,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,propertyFilters:{value:r}}}),(0,S().X)({environment:e,collectionContextStore:o,action:"reorder_filters"})}(t,l,o)})}return(0,W.jsx)(W.Fragment,{children:e.map((t=>(0,W.jsx)(it,{filter:t,collectionContextStore:o,onClick:u},t.id)))})}function ct(t){let{collectionContextStore:e}=t;const o=(0,d().tz)(),c=(0,l().DP)(),u=(0,i().v3)(),p=(0,s().O$)(e.searchQueryStore),S=(0,n.useCallback)((t=>{e.searchQueryStore.setState(t.target.value)}),[e]),m=(0,r().Y)(S,250),g=(0,D().X)("db_ux_chrome");return(0,W.jsx)(k().A,{debugName:"CollectionViewFilterBar",capture:!0,children:(0,W.jsx)(R().A,{capture:!0,render:t=>(0,W.jsx)("div",{...t,style:{width:"100%",paddingTop:u.device.isMobile?8:12,paddingBottom:2},children:(0,W.jsx)(Q().A,{wrapStyle:{width:"100%"},innerStyle:{width:"100%",border:"none"},icon:(0,a().U)({width:g?16:14,fill:c.mediumIconColor,marginRight:8}),hideChevron:!0,title:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(A().A,{format:A().C.Transparent,value:p,placeholder:o.formatMessage({defaultMessage:"Type to searchâ€¦",id:"database.filterBar.mobileSearch.placeholder"}),onChange:m,autoComplete:"on",autoCorrect:"on",onBlur:()=>function(t){t.searchQueryStore.state||lt(t)}(e),onClearButtonClick:()=>lt(e),showClearButton:!0,focus:!u.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,W.jsx)(b().A,{show:!0})]})})})})})}function ut(t){let{collectionContextStore:e}=t;const o=(0,l().DP)(),n=(0,i().v3)(),r=(0,D().X)("db_ux_chrome");return"chart"===(0,s().K8)((()=>e.getViewType()),[e])?null:(0,W.jsx)(Q().A,{wrapStyle:{display:"flex",alignItems:"center"},innerStyle:{border:"none"},icon:(0,a().U)({width:r?16:14,fill:o.mediumIconColor}),hideChevron:!0,onClick:()=>function(t,e){x().clear({preventDismissMobileKeyboard:!0,environment:t}),f().IU({preventDismissMobileKeyboard:!0,environment:t}),(0,N().y)(),e.searchOpenStore.setState(!0),e.searchQueryStore.setState(""),(0,S().X)({environment:t,collectionContextStore:e,action:"click_mobile_search"})}(n,e)},"search")}function dt(t){let{collectionContextStore:e,showHoverActionsStore:o,saveControlMoreActionsButtonPopupStore:n}=t;return(0,W.jsx)(y().Ay,{context:y().$J.FilterBar,collectionContextStore:e,showHoverActionsStore:o,moreActionsButtonPopupStore:n})}function pt(t){let{collectionContextStore:e,createFilterSettingsStore:o}=t;return(0,W.jsx)(v().m$,{context:B().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})}function St(t){let{collectionContextStore:e,showHoverActionsStore:o,createFilterSettingsStore:r}=t;const l=(0,i().v3)(),a=(0,D().X)("db_ux_mobile"),u=(0,n.useCallback)((t=>function(t,e){t&&"click"===t.type&&(0,F().Rp)(t.target)||g().os({collectionSettingsStore:e})}(t,r)),[r]),p=(0,n.useCallback)((()=>(0,W.jsx)(pt,{collectionContextStore:e,createFilterSettingsStore:r})),[e,r]),m=(0,n.useCallback)((()=>function(t,e,o){(0,S().X)({environment:t,collectionContextStore:e,action:"click_new_filter"}),g().R8({collectionSettingsStore:o,item:{type:"createFilter"}})}(l,e,r)),[l,e,r]),f=(0,s().K8)((()=>r.state.open),[r]),x=(0,s().K8)((()=>o.state||f),[o,f]);return(0,W.jsx)(_().Ay,{open:f,placementToOrigin:K().UV.Bottom,alignmentToOrigin:K().MY.Start,popupType:l.device.isMobile?a?_().nl.BottomSheet:_().nl.SlideUp:_().nl.Popup,bottomSheetInitialState:"half",origin:(0,W.jsx)(h().A,{tag:C().p,visible:x,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},icon:c().plusSmallIcon,size:"sm",isLightGray:!0,hovered:f,onClick:m,style:{fontSize:14,borderRadius:12,paddingLeft:5,paddingRight:9,marginRight:12},children:(0,W.jsx)(d().sA,{defaultMessage:"Filter",id:"database.filterBar.addButton.title"})}),render:p,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:u})}},516672:(t,e,o)=>{o.d(e,{S:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("filter",{viewBox:"0 0 16 16",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4C2 3.58579 2.33579 3.25 2.75 3.25H13.25C13.6642 3.25 14 3.58579 14 4C14 4.41421 13.6642 4.75 13.25 4.75H2.75C2.33579 4.75 2 4.41421 2 4Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.75 8C3.75 7.58579 4.08579 7.25 4.5 7.25H11.5C11.9142 7.25 12.25 7.58579 12.25 8C12.25 8.41421 11.9142 8.75 11.5 8.75H4.5C4.08579 8.75 3.75 8.41421 3.75 8Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 12C5.5 11.5858 5.83579 11.25 6.25 11.25H9.75C10.1642 11.25 10.5 11.5858 10.5 12C10.5 12.4142 10.1642 12.75 9.75 12.75H6.25C5.83579 12.75 5.5 12.4142 5.5 12Z"})]})})},602141:(t,e,o)=>{o.d(e,{A:()=>h});o(898992),o(354520),o(672577),o(581454);var n=o(296540),r=()=>o(847249),i=()=>o(959013),s=()=>o(284371),l=()=>o(436696),a=()=>o(187899),c=()=>o(686526),u=()=>o(859794),d=()=>o(859428),p=()=>o(873050),S=()=>o(753199),m=()=>o(406792),g=()=>o(962730),f=()=>o(377586),x=()=>o(700250),v=o(474848);function y(t){let{id:e,context:s,collectionContextStore:y,collectionSettingsStore:h,onClick:b}=t;const j=(0,o(484714).v3)(),k=(0,o(401497).DP)(),A=(0,o(963589).X)("nds_default_property_noticon"),{filter:_,isReadOnly:M}=(0,r().K8)((()=>{const t=function(t,e){const o=e.currentPropertyFiltersStore.state;return o.find((e=>e.id===t))}(e,y);return{filter:t,isReadOnly:Boolean(t&&(0,p().vu)(t.id))}}),[y,e]),T=(0,r().K8)((()=>{const t=y.localStateDiffStore.state;return t.filters.updated.includes(e)||t.filters.added.includes(e)}),[y,e]),I=(0,r().K8)((()=>y.collectionViewStore()),[y]),R=(0,r().O$)(y.normalizedSchemaStore),w=(0,r().K8)((()=>(0,o(37489).H)(y)),[y]),B=(0,r().K8)((()=>h.state.open),[h]),F=(0,r().K8)((()=>{var t;return _?null==y||null===(t=y.collectionStore())||void 0===t||null===(t=t.getSchema()[_.filter.property])||void 0===t?void 0:t.type:void 0}),[y,_]),D=(0,r().K8)((()=>_&&_.id===p().Oe),[_]),P=(0,n.useCallback)((t=>{t&&(0,o(253579).Rp)(t.target)||c().os({collectionSettingsStore:h})}),[h]),O=(0,n.useCallback)((()=>{var t;b&&b(null==_?void 0:_.id),_&&(h.state.open?c().os({collectionSettingsStore:h}):c().R8({collectionSettingsStore:h,item:{type:"filter"}}),(0,l().X)({environment:j,collectionContextStore:y,action:"click_property_filter",original_view_type:void 0,property_type:null==y||null===(t=y.collectionStore())||void 0===t||null===(t=t.getSchema()[_.filter.property])||void 0===t?void 0:t.type}))}),[y,h,j,_,b]),K=(0,n.useCallback)((()=>{c().os({collectionSettingsStore:h})}),[h]),L=(0,n.useCallback)((t=>{var e;if(!_)return;const n=null===(e=y.remoteResultStore.state)||void 0===e?void 0:e.sizeHint,r=m().default.DO_NOT_USE_markLegacy("collections.update_filter_lag");m().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:j,getData:()=>o(476492).K6({from:"property_filter",property_type:F,collectionContextStore:y,sizeHintAtStart:n})});const i=_.filter,s=y.currentPropertyFiltersStore.state.map((e=>{if(e.id===_.id){return{..._,filter:{...i,filter:t}}}return e}));a().IU({environment:j,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:s}}}),(0,l().X)({environment:j,collectionContextStore:y,action:"update_property_filter",original_view_type:void 0,property_type:F})}),[y,j,_,F]),V=(0,o(395361).Y)(L,250),N=(0,n.useCallback)((()=>{var t;if(!_)return;const e=y.currentPropertyFiltersStore.state.filter((t=>t.id!==_.id));a().IU({environment:j,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:e}}}),(0,l().X)({environment:j,collectionContextStore:y,action:"delete_property_filter",original_view_type:void 0,property_type:null==y||null===(t=y.collectionStore())||void 0===t||null===(t=t.getSchema()[_.filter.property])||void 0===t?void 0:t.type})}),[y,j,_]),U=(0,n.useCallback)((()=>{var t;if(!_)return;const{combinatorFilter:e,propertyFilters:n}=(0,p().$4)(y,_);a().IU({environment:j,collectionContextStore:y,temporaryState:{...y.temporaryStateStore.state,propertyFilters:{value:n},combinatorFilter:{value:e}}});const r=s===o(300089).aV.FilterBar?y.filterBarCombinatorFilterSettingsStore:y.filterOptionsCombinatorFilterSettingsStore;c().R8({collectionSettingsStore:r,item:{type:"filter"}}),(0,l().X)({environment:j,collectionContextStore:y,action:"merge_filter_into_combinator",property_type:null==y||null===(t=y.collectionStore())||void 0===t||null===(t=t.getSchema()[_.filter.property])||void 0===t?void 0:t.type})}),[y,s,j,_]),z=(0,n.useCallback)(((t,e)=>{if(!I||!_)return null;const n=_.filter,r=!(0,o(289915).t_)(n),i=R[n.property],s=(null==i?void 0:i.icon)&&(0,o(278238).T8)(i.icon),l=(0,o(700251).xI)({size:"sm",type:s?"custom":"system",isMobile:j.device.isMobile});return(0,v.jsx)(o(56394).A,{icon:i&&(0,v.jsx)(o(743176).zB,{type:i.type,icon:i.icon,size:l,theme:k,style:{fill:"currentColor",marginRight:5},isDefaultNoticonEnabled:A}),title:r?(0,v.jsx)(o(704452).A,{propertyFilter:n,schema:R,style:C(),parentStore:I}):(0,v.jsx)("span",{style:C(),children:null==i?void 0:i.name}),on:r,hasDiff:T,disabled:e,hideChevron:e,onClick:t=>((0,S().SQ)({event:t,context:S().y$.CollectionSettingsClick,callback:O}),t.preventDefault(),!1),...t},_.id)}),[A,I,j,_,O,T,R,k]),H=(0,n.useCallback)((()=>D?(0,v.jsx)(d().A,{placement:g().W.Bottom,render:t=>z(t,!0),renderTooltip:()=>(0,v.jsx)(i().sA,{id:"database.filterBarPropertyFilter.cannotConfigureSubitemDisplayMode",defaultMessage:"To modify this filter, first change the subitem display mode."})}):(0,v.jsx)(d().A,{placement:g().W.Bottom,render:t=>z(t,!0),renderTooltip:()=>(0,v.jsx)(i().sA,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})),[z,D]),E=(0,n.useCallback)((()=>{if(!_)return;const t=_.filter;return I?(0,v.jsx)(u().td,{collectionViewId:I.id,propertyFilter:t,schema:R,parentStore:I,onChange:L,onChangeDebounced:V,onClose:K,onDelete:N,onAddToCombinatorFilter:U,context:u().mL.PropertyFilter,userCanConfigureFilters:w,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:y}):void 0}),[w,y,I,_,U,N,K,V,L,R]);return M?H():(0,v.jsx)(o(897119).Ay,{popupType:j.device.isMobile?f().n.SlideUp:f().n.Popup,placementToOrigin:x().UV.Bottom,alignmentToOrigin:x().MY.Start,open:B,origin:M?H():z(void 0,!1),onDismiss:P,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:E,trapFocus:!0})}const h=n.memo(y,o(821062).A);function C(){return{maxWidth:180,...s().RC}}},643381:(t,e,o)=>{o.d(e,{l:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("repeat",{viewBox:"0 0 16 14",svg:(0,n.jsx)("path",{d:"M1.185 7.317a.689.689 0 00.697-.704v-.601c0-1.19.806-1.942 2.064-1.942H9.23v1.573c0 .328.199.52.527.52a.66.66 0 00.403-.144l2.68-2.236c.253-.212.26-.547 0-.765L10.16.782A.62.62 0 009.757.64c-.328 0-.527.184-.527.52v1.53H4.05C1.875 2.69.48 3.9.48 5.875v.738c0 .397.308.704.705.704zm13.624-.649a.689.689 0 00-.698.704v.608c0 1.19-.806 1.942-2.064 1.942H6.763V8.35c0-.329-.199-.52-.527-.52a.66.66 0 00-.403.144l-2.68 2.242c-.26.212-.26.547 0 .759l2.68 2.242a.66.66 0 00.403.143c.328 0 .527-.191.527-.52v-1.544h5.181c2.174 0 3.569-1.21 3.569-3.179v-.745a.695.695 0 00-.704-.704z"})})},704452:(t,e,o)=>{o.d(e,{A:()=>j});o(898992),o(354520),o(581454),o(296540);var n=()=>o(847249),r=()=>o(799288),i=()=>o(289915),s=()=>o(597777),l=()=>o(681873),a=()=>o(799829),c=()=>o(179034),u=()=>o(824862),d=()=>o(519831),p=()=>o(798880),S=()=>o(695608),m=()=>o(959013),g=()=>o(496603),f=()=>o(534177),x=()=>o(284371),v=()=>o(16006),y=()=>o(654734),h=()=>o(205098),C=()=>o(630116),b=o(474848);const j=function(t){let{schema:e,propertyFilter:r,parentStore:s,valueOnly:l,style:a}=t;const c=(0,n().K8)((()=>{const t=e[r.property];if(t&&(0,o(970013).nC)(t))return(0,o(685889).LQ)(t,s)}),[e,r,s]),{filter:u}=r,d=(0,i().s1)(u)?u.subfilter:u,p=(0,i().My)(d)&&!(0,i().fZ)(u),S={...a,maxWidth:void 0};return(0,b.jsx)("span",{style:(0,i().nM)(d)?S:a,children:(0,b.jsx)(m().sA,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:l?void 0:(0,b.jsx)(A,{propertyFilter:r,schema:e}),colonSeparator:l||p?void 0:":",filterOperator:(0,b.jsx)(_,{propertyFilter:r}),propertyValue:(0,b.jsx)(T,{propertyFilter:r,schema:e,parentStore:s,relatedCollectionAppConfigUri:c})}})})};function k(){return(0,b.jsx)(m().sA,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function A(t){let{propertyFilter:e,schema:o}=t;const n=o[e.property];return n?(0,b.jsx)("span",{style:{fontWeight:x().Wy.medium},children:n.name}):null}function _(t){let{propertyFilter:e}=t;const{filter:o}=e,n=(0,i().s1)(o)?o.subfilter:o;if((0,i().YH)(n))return"string_contains"===n.operator||"string_is"===n.operator?null:"string_does_not_contain"===n.operator||"string_is_not"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().uf)(n))return"geo_point_is_within"===n.operator?null:"geo_point_is_not_within"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().My)(n))return(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().Ui)(n)){if("checkbox_is_not"===n.operator)return(0,b.jsx)(k,{})}else{if((0,i().v0)(n))return"enum_is"===n.operator?null:"enum_is_not"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().as)(n))return"enum_contains"===n.operator?null:"enum_does_not_contain"===n.operator?(0,b.jsx)(k,{}):"enum_contains_all"===n.operator?null:(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().H$)(n))return"status_is"===n.operator?null:"status_is_not"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().Pq)(n))return"relation_contains"===n.operator?null:"relation_does_not_contain"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().I_)(n))return"person_contains"===n.operator?null:"person_does_not_contain"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});if((0,i().G)(n)){if("location_is"===n.operator)return null;if("location_is_not"===n.operator)return(0,b.jsx)(k,{})}else if((0,i().nM)(n)){if("date_is"===n.operator)return null;if("date_is_after"===n.operator)return(0,b.jsx)(m().sA,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===n.operator)return(0,b.jsx)(m().sA,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===n.operator)return(0,b.jsx)(m().sA,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===n.operator)return(0,b.jsx)(m().sA,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,i().Cw)(n))return(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});{const t=n.value;if(!t.value||"exact"!==t.type||!(0,s().jS)(t.value))return(0,b.jsx)(b.Fragment,{children:(0,h().kz)(t)});if(t.value.start_date&&t.value.end_date)return null;if(t.value.start_date)return(0,b.jsx)(m().sA,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(t.value.end_date)return(0,b.jsx)(m().sA,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,i().uU)(n))return"verification_is"===n.operator?null:"verification_is_not"===n.operator?(0,b.jsx)(k,{}):(0,b.jsx)(b.Fragment,{children:(0,h().J)(n.operator)});(0,f().HB)(n)}}return null}function M(t){let{index:e}=t;return(0,b.jsx)("span",{style:{whiteSpace:"pre"},children:(0,b.jsx)(m().sA,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},e)}function T(t){let{propertyFilter:e,schema:o,parentStore:n,relatedCollectionAppConfigUri:r}=t;const{filter:u}=e,p=(0,i().s1)(u)?u.subfilter:u;if(!(0,i().gc)(p))return null;if((0,i().YH)(p)||(0,i().My)(p)){const t=p.value.value;if(void 0!==t)return(0,b.jsx)("span",{children:t})}else if((0,i().Ui)(p)){const t=p.value.value;if(!0===t)return(0,b.jsx)("span",{children:(0,b.jsx)(m().sA,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===t)return(0,b.jsx)("span",{children:(0,b.jsx)(m().sA,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,i().v0)(p)||(0,i().as)(p)){const t=(0,i().v0)(p)?(0,i().Zl)(p):(0,i().SM)(p),e=g().oE(t.map((t=>{let{value:e}=t;return e})));return 0===e.length?null:(0,b.jsx)("span",{children:(0,l().A)(e,(t=>(0,b.jsx)(M,{index:t})))})}if((0,i().H$)(p)){const t=(0,i().V6)(p),e=g().oE(t.map((t=>{let{value:e}=t;return e})));return 0===e.length?null:(0,b.jsx)("span",{children:(0,l().A)(e,(t=>(0,b.jsx)(M,{index:t})))})}if((0,i().Pq)(p)){const t=(0,i().Rh)(p),e=g().oE(t.map(((t,e)=>{if(!t.value)return null;const o=t.type;if("exact"===o){const e=C().Bv.createChildStore(n,{table:c().ev,id:t.value});return(0,b.jsx)(v().A,{style:{display:"inline"},store:e},t.value)}if("relative"===o){var i;if("builtin"===t.value.type)return r?(0,b.jsx)("span",{children:(0,b.jsx)(m().sA,{...null===(i=a().n$[r])||void 0===i||null===(i=i[t.value.variable])||void 0===i?void 0:i.messageDescriptor})},e):null;if("current_page_in_related_collection"===t.value.type)return(0,b.jsx)("span",{children:(0,b.jsx)(m().sA,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"})},e)}else(0,f().HB)(o)})));return(0,b.jsx)(b.Fragment,{children:(0,l().A)(e,(t=>(0,b.jsx)(M,{index:t})))})}if((0,i().I_)(p))return(0,b.jsx)(I,{useFilter:p,parentStore:n});if((0,i().G)(p)){const t=(0,i().GK)(p),e=g().oE(t.map((t=>{if(t.value){const e=t.value,o=C().sk.createChildStore(n,{table:d().Vl,id:e});return(0,b.jsx)(v().A,{style:{display:"inline"},store:o},e)}})));return(0,b.jsx)(b.Fragment,{children:(0,l().A)(e,(t=>(0,b.jsx)(M,{index:t})))})}if((0,i().nM)(p)){const t=o[e.property],n=(t&&"date"===t.type?t.date_format:void 0)||s().vz;let r;if("exact"===p.value.type){const t=p.value;if(t.value)if((0,s().$P)(t.value))r=t.value;else if((0,s().jS)(t.value)){const e=(0,s().dq)(t.value);e&&(r=e.value)}}else if(!(0,i().Cw)(p))return(0,b.jsx)(b.Fragment,{children:(0,h().RR)(p.value)});if(r)return(0,b.jsx)(y().A,{style:{display:"inline"},value:r,dateFormat:n,shortenDateAndRange:!0})}else{if((0,i().uU)(p)){const t=(0,i().ms)(p).filter((t=>{let{value:e}=t;return Boolean(e)})).map(h().w0);return 0===t.length?null:(0,b.jsx)("span",{children:(0,l().A)(t,(t=>(0,b.jsx)(M,{index:t})))})}if((0,i().uf)(p))return null;(0,f().HB)(p)}}return null}function I(t){let{parentStore:e,useFilter:o}=t;const s=(0,m().tz)(),a=(0,i().Wf)(o),c=(0,n().K8)((()=>g().oE(a.map(((t,o)=>{if("relative"===t.type)return(0,b.jsx)("span",{children:(0,b.jsx)(m().sA,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},o);if(t.value){const n=t.value;if(n.table===p().oo){const t=C().sk.createChildStore(e,{table:n.table,id:n.id});return(0,b.jsx)("span",{children:(0,S().c6)(s,t.getModel())},o)}if(n.table===u().GP){const t=C().sk.createChildStore(e,{table:n.table,id:n.id});return(0,b.jsx)("span",{children:(0,r().Hg)(t.getModel())},o)}}})))),[a,e,s]);return(0,b.jsx)(b.Fragment,{children:(0,l().A)(c,(t=>(0,b.jsx)(M,{index:t})))})}},958832:(t,e,o)=>{o.d(e,{l:()=>b});o(898992),o(803949);var n=o(296540),r=()=>o(484714),i=()=>o(847249),s=()=>o(401497),l=()=>o(516672),a=()=>o(959013),c=()=>o(284371),u=()=>o(436696),d=()=>o(187899),p=()=>o(686526),S=()=>o(59400),m=()=>o(897119),g=()=>o(525432),f=()=>o(753199),x=()=>o(253579),v=()=>o(377586),y=()=>o(700250),h=()=>o(56394),C=o(474848);function b(t){let{collectionContextStore:e,collectionSettingsStore:o}=t;const s=(0,r().v3)(),[l,a]=(0,i().K8)((()=>[o.state.open,e.currentCombinatorFilterStore.state]),[e,o]),c=(0,n.useCallback)((()=>(0,C.jsx)(S().m$,{context:g().Bd.FilterBar,collectionContextStore:e,collectionSettingsStore:o,hideDesktopHeader:!0})),[e,o]),u=(0,n.useCallback)((t=>{var n;t&&(0,x().Rp)(t.target)||(p().os({collectionSettingsStore:o}),a&&0===(null===(n=a.filters)||void 0===n?void 0:n.length)&&d().IU({environment:s,collectionContextStore:e,temporaryState:{...e.temporaryStateStore.state,combinatorFilter:{value:void 0}}}))}),[e,o,s,a]);return(0,n.useEffect)((()=>()=>p().os({collectionSettingsStore:o})),[]),(0,C.jsx)(m().Ay,{popupType:s.device.isMobile?v().n.SlideUp:v().n.Popup,placementToOrigin:y().UV.Bottom,alignmentToOrigin:y().MY.Start,open:l,origin:(0,C.jsx)(j,{collectionContextStore:e,collectionSettingsStore:o}),onDismiss:u,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:c})}function j(t){var e;let{collectionContextStore:o,collectionSettingsStore:d}=t;const S=(0,r().v3)(),m=(0,s().IS)((t=>({icon:{width:void 0,height:S.device.isMobile?14:12,fill:t.blueColor,marginRight:6},title:{maxWidth:180,...c().RC}})),[S.device]),[g,x]=(0,i().K8)((()=>[Boolean(o.localStateDiffStore.state.combinatorFilter),o.currentCombinatorFilterStore.state]),[o]),v=(0,n.useCallback)((()=>{if(!x)return;o.currentPropertyFiltersStore.state.forEach((t=>{const e=o.getFilterOptionsItemSettingsStore(t);p().os({collectionSettingsStore:e})})),p().R8({collectionSettingsStore:d,item:{type:"filter"}}),(0,u().X)({environment:S,collectionContextStore:o,action:"click_combinator_filter"})}),[o,d,S,x]);return x?(0,C.jsx)(h().A,{icon:(0,l().S)(m.icon),title:(0,C.jsx)("span",{style:m.title,children:(0,C.jsx)(a().sA,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=x.filters)||void 0===e?void 0:e.length)||0}})}),on:!0,hasDiff:g,onClick:t=>(0,f().SQ)({event:t,context:f().y$.CollectionSettingsClick,callback:v})},"combinator"):null}}}]);