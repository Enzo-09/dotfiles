"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[48438],{73223:(e,t,n)=>{n.r(t),n.d(t,{dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>m,tutorialGoToNextStep:()=>c,tutorialGoToPrevStep:()=>l});var o=()=>n(541235),i=()=>n(751156),r=()=>n(755199),s=()=>n(739135),a=()=>n(351360);function c(e,t){var n;const{currentUserSettingsStore:o}=a().default.state;if(!o)return;const i=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{r().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...i,[t]:(0,s().i9)(o,t)}}})},userId:o.id})}function l(e,t){var n;const{currentUserSettingsStore:o}=a().default.state;if(!o)return;const i=null===(n=o.getSettings())||void 0===n?void 0:n.tutorials;f({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{r().mJ({userSettingsStore:o,transaction:e,data:{tutorials:{...i,[t]:(0,s().KD)(o,t)}}})},userId:o.id})}function d(e,t){var n;const{currentUserSettingsStore:i}=a().default.state;if(!i)return;const s=null===(n=i.getSettings())||void 0===n?void 0:n.tutorials;(null==s?void 0:s[t])!==o().YD&&f({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{r().mJ({userSettingsStore:i,transaction:e,data:{tutorials:{...s,[t]:o().YD}}})},userId:i.id})}function u(e){const{currentUserSettingsStore:t}=a().default.state;t&&f({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{r().mJ({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,n){var i;const{currentUserSettingsStore:c}=a().default.state;if(!c||(0,s().x$)(c,t))return;const l=(0,s().gt)(c,t);o().c$[t].steps.findIndex((e=>e.id===l))>=o().c$[t].steps.findIndex((e=>e.id===n))||r().mJ({userSettingsStore:c,transaction:e,data:{tutorials:{...null===(i=c.getSettings())||void 0===i?void 0:i.tutorials,[t]:n}}})}function m(e,t,n){if((0,s().ll)(n))return;const o=(0,s().tb)(t,n);o&&p(e,t,o)}function f(e){return i().createAndCommit({...e,canUndo:!1})}},77279:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});class o extends(()=>n(757695))().default{getInitialState(){return{discussionIdToExpansionStartPointMap:{}}}}const i=new o},79275:(e,t,n)=>{n.d(t,{X:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("newSidebarHome",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M10.1416 3.77299C10.0563 3.71434 9.94368 3.71434 9.85837 3.77299L3.60837 8.06989C3.54053 8.11653 3.5 8.19357 3.5 8.2759V14.2499C3.5 14.9402 4.05964 15.4999 4.75 15.4999H7.5L7.5 10.7499C7.5 10.0595 8.05964 9.49987 8.75 9.49987H11.25C11.9404 9.49987 12.5 10.0595 12.5 10.7499L12.5 15.4999H15.25C15.9404 15.4999 16.5 14.9402 16.5 14.2499V8.2759C16.5 8.19357 16.4595 8.11653 16.3916 8.06989L10.1416 3.77299ZM9.00857 2.53693C9.60576 2.12636 10.3942 2.12636 10.9914 2.53693L17.2414 6.83383C17.7163 7.1603 18 7.69963 18 8.2759V14.2499C18 15.7687 16.7688 16.9999 15.25 16.9999H12.25C11.5596 16.9999 11 16.4402 11 15.7499L11 10.9999H9L9 15.7499C9 16.4402 8.44036 16.9999 7.75 16.9999H4.75C3.23122 16.9999 2 15.7687 2 14.2499V8.2759C2 7.69963 2.2837 7.1603 2.75857 6.83383L9.00857 2.53693Z"})})},99874:(e,t,n)=>{n.r(t),n.d(t,{createClient:()=>c,generateNewClientSessionId:()=>s,getCurrentClientSessionId:()=>a});var o=()=>n(206267),i=()=>n(780054);let r=o().JW();function s(){r=o().JW()}function a(){return r}function c(e){let t=i().A.audioProcessor.url;const{maxReconnectDelayMs:o,minReconnectDelayMs:s}=e,a=`${t}?sessionId=${encodeURIComponent(r)}`;return new(n(502681))(a,{reconnect:{max:o,min:s,"reconnect timeout":2500,retries:1e20},timeout:2500,credentials:!0,transport:{withCredentials:!0},transportOverrides:{transports:["websocket"]}})}},112799:(e,t,n)=>{n.d(t,{a:()=>l,E:()=>c});n(16280);var o=n(296540),i=()=>n(484714),r=(n(898992),n(672577),()=>n(427704));r().GJ.downloadMac,r().GJ.downloadMacUniversal,r().GJ.downloadMacIntel,r().GJ.downloadMacAppleSilicon,r().GJ.downloadWindows,r().GJ.downloadWindowsArm;const s=[{route:r().GJ.downloadMac,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().GJ.downloadMacIntel,architecture:"x86",operatingSystem:"mac",target:"mac"},{route:r().GJ.downloadMacUniversal,architecture:"universal",operatingSystem:"mac",target:"macUniversal"},{route:r().GJ.downloadMacAppleSilicon,architecture:"arm",operatingSystem:"mac",target:"macArm64"},{route:r().GJ.downloadWindows,architecture:"x86",operatingSystem:"windows",target:"windows"},{route:r().GJ.downloadWindowsArm,architecture:"arm",operatingSystem:"windows",target:"windowsArm64"}];function a(e,t){const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=e.toLowerCase();if(t.startsWith("arm"))return"arm";if(t.startsWith("x86")||"intel"===t)return"x86";return null}(e);if(!n||!("mac"===t||"windows"===t))return null;const o=s.find((e=>e.architecture===n&&e.operatingSystem===t));return(null==o?void 0:o.route)||null}function c(){const e=(0,o.useRef)(null),t=(0,i().Y0)();return(0,o.useEffect)((()=>{l(t).then((t=>{e.current=t??null})).catch((e=>{throw new Error(e)}))}),[t]),e}async function l(e){var t;if(!("userAgentData"in navigator))return e.isMac?r().GJ.downloadMacUniversal:r().GJ.downloadWindows;const n=navigator.userAgentData,o=await(null==n||null===(t=n.getHighEntropyValues)||void 0===t?void 0:t.call(n,["architecture"])),i=a(null==o?void 0:o.architecture,e.os);return i||null}},120114:(e,t,n)=>{n.d(t,{AX:()=>s,Ur:()=>o,uw:()=>i,yP:()=>r});const o=["unified_find_variant"],i=["deep_find_enable_query_gen","deep_find_enable_universal_blending","deep_find_enable_3p_sources","deep_find_enable_query_gen_finetuned_json_schema","deep_find_enable_query_gen_json_schema","deep_find_enable_request_tracing","deep_find_render_and_hydrate_notion_pages","deep_find_use_query_gen_for_notion_search","deep_find_should_show_streaming_ux","deep_find_append_keywords_to_notion_search","deep_find_all_connectors"],r=["notionSourceNumResults","maxPagesToDecorate","maxResultsPerSourceToBlendedRanking","maxFinalResults","maxResultsPerSourceToBoost"];function s(e,t,n){return{universalBlendingEnabled:e.isDeepFindUniversalBlendingEnabled(),queryGenEnabled:e.isDeepFindQueryGenEnabled(),notionSourceNumResults:t("notionSourceNumResults"),enableRequestTracing:n("deep_find_enable_request_tracing"),maxPagesToDecorate:t("maxPagesToDecorate"),maxResultsPerSourceToBlendedRanking:t("maxResultsPerSourceToBlendedRanking"),maxFinalResults:t("maxFinalResults"),useQueryGenForNotionSearch:n("deep_find_use_query_gen_for_notion_search"),shouldShowStreamingUx:n("deep_find_should_show_streaming_ux"),appendKeywordsToNotionSearch:n("deep_find_append_keywords_to_notion_search"),allConnectorsEnabled:n("deep_find_all_connectors"),maxResultsPerSourceToBoost:t("maxResultsPerSourceToBoost")}}},126617:(e,t,n)=>{n.d(t,{Y:()=>i});n(296540);const o={viewBox:"0 0 16 16",svg:(0,n(474848).jsx)("path",{d:"M3.2 6.725a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55"})},i=(0,n(340498).wt)("ellipsisSmall",o)},135428:(e,t,n)=>{n.d(t,{Vj:()=>s,ax:()=>a});n(898992),n(354520),n(581454),n(737550);var o=()=>n(244641);const i="–",r=" ";function s(e){let{start:t,end:n,locale:s,timeZone:c}=e;const l=o().c9.fromISO(t),d=o().c9.fromISO(n),u=function(e){let{start:t,end:n}=e;const o=n.diff(t);if(o.as("hours")>12)return!0;const i=t.hour<12,r=n.hour<12;return i!==r}({start:l,end:d}),p=a({time:l,showAmPm:u,locale:s,timeZone:c}),m=a({time:d,showAmPm:!0,locale:s,timeZone:c});return`${p}${r}${i}${r}${m}`}function a(e){let{time:t,showAmPm:n,locale:i,timeZone:s}=e;const a=function(e){return o().c9.fromObject({hour:13}).setLocale(e).toLocaleParts(o().c9.TIME_SIMPLE).some((e=>"dayPeriod"===e.type))}(i),c=0!==t.minute||!a,l={...o().c9.TIME_SIMPLE,hour:"numeric",minute:c?"2-digit":void 0,timeZone:s};return a&&!n?t.setLocale(i).toLocaleParts(l).filter((e=>"dayPeriod"!==e.type)).map((e=>e.value.trim())).join(""):t.toLocaleString({...l,hour12:a},{locale:i}).replace(" ",r)}},233124:(e,t,n)=>{n.d(t,{D_:()=>s,E_:()=>r,Im:()=>a,K_:()=>l,rP:()=>c,uB:()=>i});var o=()=>n(989423);function i(e,t){e&&o().vd(e,"dictation_modal_open",t)}function r(e,t){e&&o().vd(e,"dictation_modal_close",t)}function s(e,t){e&&o().vd(e,"dictation_start",t)}function a(e,t){e&&o().vd(e,"dictation_end",t)}function c(e,t){e&&o().vd(e,"dictation_error",t)}function l(e,t){e&&o().vd(e,"update_dictation_language",t)}},253447:(e,t,n)=>{n.d(t,{F:()=>i});var o=()=>n(963575);function i(e,t){if(e)return e;switch(t){case"large":return o().A.card.desktop.large.height;case"small":return o().A.card.desktop.small.height;default:return o().A.card.desktop.medium.height}}},271232:(e,t,n)=>{n.d(t,{t:()=>r});var o=n(296540),i=n(474848);const r=o.memo((function(e){const{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:r}=e,s=(0,n(401497).IS)((()=>({container:{height:(0,n(253447).F)(t,o),...r}})),[t,o,r]);return(0,i.jsx)("div",{style:s.container})}))},271380:(e,t,n)=>{n.r(t),n.d(t,{ensureTranscriptionIsInActive:()=>D,pauseTranscription:()=>R,placeCursorInNotesTab:()=>q,runSummarization:()=>P,startTranscribingBlockOnPage:()=>E,startTranscription:()=>B,stopTranscription:()=>M,updatePreferredSummarizationFormat:()=>L});n(18107),n(967357);var o=()=>n(416845),i=()=>n(388821),r=()=>n(798880),s=()=>n(763824),a=()=>n(498212),c=()=>n(534177),l=()=>n(896628),d=()=>n(666144),u=()=>n(436572),p=()=>n(725614),m=()=>n(812182),f=()=>n(751156),v=()=>n(182865),g=()=>n(989423),h=()=>n(972435),S=()=>n(351360),y=()=>n(914649),b=()=>n(909557),A=()=>n(540144),w=()=>n(632503),k=()=>n(748197),_=()=>n(749514),x=()=>n(723545),T=()=>n(431895),I=()=>n(470333);const C=(0,n(959013).YK)({transcriptTooShort:{id:"transcriptionBlockActions.transcriptTooShort",defaultMessage:"Transcript is too short to summarize"},genericError:{id:"transcriptionBlockActions.genericError",defaultMessage:"Something went wrong while summarizing your transcript."},failedToStartDictation:{id:"transcriptionBlockActions.failedToStartDictation",defaultMessage:"Unable to start transcription"}});async function B(e){var t;const{environment:n,blockStore:i}=e,a=null===(t=S().default.state.currentUserStore)||void 0===t?void 0:t.id;if(!a)return;const c=t=>{f().createAndCommit({userAction:"transcriptionBlockActions.failedToStartDictation",environment:n,canUndo:!1,perform:t=>{(0,I().A)({environment:n,blockStore:i,transaction:t}),N({...e,transaction:t,state:{state:"paused"}})}}),t&&u().D6({label:h().A.formatMessage(C.failedToStartDictation),helpUrl:y().WQ})},{shouldShowSetupModal:l,shouldStartDictation:d}=await(0,T().HT)(n);if(l)return c(!1),k().c.openTranscriptionSetupModal(),void(0,g().u4)({environment:n,event:{eventName:"transcription_block_setup_modal_opened",eventProperties:{}}});if(!d)return void c(!0);k().c.setSettingsOpenForBlockId(void 0),m().UW("transcription_idle_notification");try{k().c.setLoadingState(i.id,!0);if((await(0,s().nQ)(5e3,_().DictationManager.startDictation({environment:n,blockStore:i,from:"transcription_block",includeSystemAudio:(0,T().u)(n)}))).timeout)throw new(b().Tn)}catch(v){return void((0,o().USz)(v)&&("DictationSystemAudioFailedError"===v.name||"DictationStartTimeoutError"===v.name)&&n.device.isElectronMac?(c(!1),k().c.openTranscriptionSetupModal()):c(!0))}finally{k().c.setLoadingState(i.id,!1)}const p={state:"transcribing",transcriber_id:a,transcriber_table:r().oo};f().createAndCommit({userAction:"transcriptionBlockActions.initializeTitleAndStartTranscription",environment:n,canUndo:!1,perform:t=>{(0,I().A)({environment:n,blockStore:i,transaction:t}),N({...e,transaction:t,state:p})}})}async function M(e){if(!(0,A().pg)(e.blockStore))return u().D6({label:h().A.formatMessage(C.transcriptTooShort)}),void(await R({environment:e.environment,blockStore:e.blockStore,shouldStopDictation:!0,from:e.from}));await j({...e,shouldStopDictation:!0})}async function D(e){var t;const{environment:n,blockStore:o,from:i}=e,r=null===(t=o.getFormat())||void 0===t?void 0:t.transcription_state;return r&&"transcribing"!==r.state?"initial"!==(null==r?void 0:r.state)&&"idle"!==(null==r?void 0:r.state)&&"paused"!==(null==r?void 0:r.state)&&"summarizing"!==r.state&&void(0,c().HB)(r):(await R({environment:n,blockStore:o,shouldStopDictation:!1,from:i}),!0)}async function R(e){await j({...e,disableSummarization:!0,state:{state:"paused"}})}async function j(e){const{environment:t,blockStore:n,state:o,disableSummarization:i,shouldStopDictation:r,from:s}=e;k().c.setSettingsOpenForBlockId(void 0),m().UW("transcription_idle_notification"),o&&N({environment:t,blockStore:n,state:o,from:s}),r&&_().DictationManager.stopDictation({environment:t,from:"transcription_block"}),i||await P({environment:t,blockStore:n})}async function P(e){const{environment:t,blockStore:n}=e;if(!S().default.state.mainEditorCurrentBlockStore)return;const o=n.pointer.spaceId;if(!o)return;N({environment:t,blockStore:n,state:{state:"summarizing",step:"thinking",thinkingSteps:[]},from:"summary_requested"});const r={...n.pointer,spaceId:o},s=k().c.getSummarizationAbortController(n.id);null==s||s.abort();const c=k().c.createSummarizationAbortController(n.id);try{await(0,v().gj)({environment:t,onResponse:e=>{if("summarize-transcript-error"===e.type)return void u().D6({label:h().A.formatMessage(C.genericError)});if("summarize-transcript-record-map"===e.type){const n=e.recordMap;d()._O({environment:t,recordMap:i().RecordMapWithRole.create(n),inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,debugSource:"transcriptionBlockActions.runSummarization"})}const o=k().c.getTabState(n.id),r=(0,A().y1)(n,"summary");r&&o!==(null==r?void 0:r.id)&&k().c.setTabState(n.id,r.id)},data:{transcript:[{id:(0,a().Ay)(),type:"config",value:{type:"summarize-transcript",transcriptPointer:r,language:(0,w().FT)(t.currentUser.id)}},{id:(0,a().Ay)(),type:"summarize-transcript"}],traceId:n.id,spaceId:o,generateTitle:!1},abortSignal:c.signal})}catch(l){if((0,v().zf)(c,l))return;throw N({environment:t,blockStore:n,state:{state:"idle"},from:"summary_error"}),l}}async function E(e){const{environment:t}=e;await S().default.waitUntilRendered();const n=S().default.state.mainEditorCurrentBlockStore;if(!n)return;const o=(0,A().Ql)(n);o.sort(((e,t)=>t.getCreatedTime()-e.getCreatedTime()));const i=o[0];i&&(await B({environment:t,blockStore:i,from:"auto_transcribe"}),q({blockStore:i}))}async function L(e){var t;const{environment:n,blockStore:o,format:i}=e;if((null===(t=o.getFormat())||void 0===t?void 0:t.transcription_summarization_format_type)===i)return;f().createAndCommit({userAction:"transcriptionBlockActions.updatePreferredSummarizationFormat",environment:n,canUndo:!0,perform:e=>{l().zA({stores:[o],update:{transcription_summarization_format_type:i},transaction:e})}});(0,A().I8)({blockStore:o}).length>0&&await P({environment:n,blockStore:o})}function N(e){const{environment:t,blockStore:n,state:o,transaction:i,from:r}=e;(0,x().K)({environment:t,blockStore:n,state:o,transaction:i}),(0,g().u4)({environment:t,event:{eventName:"transcription_state_updated",eventProperties:{from:r,block_id:n.id,space_id:n.pointer.spaceId,new_state:o.state}}})}function q(e){const{blockStore:t}=e,n=(0,A().y1)(t,"notes");if(!n)return;const o=n.getContentStores().at(-1),i=null==o?void 0:o.getTitleStore();i&&(p().setSelectionAtStart({store:i}),k().c.setTabState(t.id,n.id))}},299177:(e,t,n)=>{n.d(t,{A:()=>r});class o extends(()=>n(757695))().default{getInitialState(){return{}}}const i=new o;n(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const r=i},303742:(e,t,n)=>{n.d(t,{o:()=>r});var o=()=>n(640653),i=()=>n(508496);function r(e){return!!e&&Boolean((0,o().IL)(e)&&"external_pages_sidebar"===i().default.getEligibleGroup({experimentId:"sharing_collaboration_sidebar_guest_aggregation"}))}},311004:(e,t,n)=>{e.exports=n.p+"edfba4a6d1ff7acd.png"},317027:(e,t,n)=>{n.d(t,{zz:()=>_,ZQ:()=>x,bH:()=>k,Ux:()=>A,L6:()=>w,$I:()=>T,Ep:()=>ae,Ez:()=>X,$g:()=>oe});n(16280);var o=()=>n(805952),i=()=>n(857639),r=()=>n(206267),s=()=>n(502800),a=()=>n(763824),c=()=>n(720665),l=()=>n(671593),d=()=>n(780054),u=()=>n(749514),p=()=>n(909557),m=()=>n(165121),f=()=>n(351360);const v=!1;var g=()=>n(908006),h=()=>n(989423),S=()=>n(508496);function y(e,t){g().default.afterNextFlush((()=>{S().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&h().vd(e,"audio_processor.client.send_request",t)}))}var b=()=>n(99874);const A="transcription",w="vad",k="rate_limited",_="forbidden",x="openai_error",T=(0,n(827380).A)(),I=async()=>Promise.all([n.e(2681),n.e(36733)]).then(n.bind(n,99874)),C=!1,B=90*c().TD;function M(e){return{_id:e,charactersSent:0,requestsSent:0,requestsTimedOut:0,responsesReceivedWithoutHandlers:0,successfulResponsesReceived:0,unsuccessfulResponsesReceived:0,invalidMessagesReceived:0,notificationsReceived:0,messagesReceived:0}}const D=new(n(999752).O)(20),R=new Map,j=(Date.now(),"audioProcessorInternals"),P=new(i().BatchedLogger)({from:j,type:"BulkDebug",level:"info",maxLength:250,logToConsole:C});let E,L=0,N=0,q=0,F=0,U=M(0),O=null,$=null,z=null,W=0,K=n(882362).u,H=!1,V="uninitialized";const G=!0;function J(e){P.log({level:"info",from:j,type:e})}function Y(){E=function(e){var t;const n=null==e||null===(t=e.socket)||void 0===t||null===(t=t.transport)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.transport;if("websocket"===n||"polling"===n)return n}(this),J(`ping:${E}`),O=Date.now(),le(`Incoming primus ping received from server via ${E}.`)}function Z(){return{...D.getStats()}}function Q(e){switch(P.log({level:"info",from:j,type:"readyStateChange",data:{message:e}}),z=Date.now(),e){case"end":V="closed";break;case"open":V="open";break;case"opening":V="opening"}}const X=n(496603).Bj((e=>async function(e){if(v)return;L+=1;const{createClient:t}=await I(),o=t({minReconnectDelayMs:.5*c().TD,maxReconnectDelayMs:2*c().TD});return o.on("data",re),o.on("open",(()=>{m().A.setState("connected"),J("open"),U=M(U._id+1),C&&function(){const e=Date.now(),t=20;function n(){const o=Z();if(0===o.queue&&0===o.running)return le(`Queues emptied after ${Date.now()-e} ms`),void(ee=void 0);ee=window.setTimeout(n,t)}ee&&window.clearTimeout(ee),le("Starting measurement of time until send queues are empty."),n()}()})),o.on("reconnected",(e=>{var t;(t=null==e?void 0:e.duration)&&t>1e4?ne():H=!1,P.log({level:"info",from:j,type:"reconnected",data:{message:`Reconnected in ${null==e?void 0:e.duration} ms`}})})),o.on("reconnect",(()=>{J("reconnect")})),o.on("reconnect scheduled",(e=>{(void 0===(null==e?void 0:e.attempt)||void 0===(null==e?void 0:e.duration)||e.attempt>2||e.duration>5e3||void 0===m().A.state)&&m().A.setState("disconnected"),P.log({level:"info",from:j,type:"reconnect scheduled",data:{message:`Reconnecting in ${null==e?void 0:e.scheduled} ms, attempt ${null==e?void 0:e.attempt} of ${null==e?void 0:e.retries}`}})})),o.on("reconnect timeout",(()=>{J("reconnect timeout")})),o.on("reconnect failed",(()=>{J("reconnect failed")})),o.on("timeout",(()=>{J("timeout")})),o.on("destroy",(()=>{J("destroy")})),o.on("close",(()=>{J("close")})),o.on("online",(()=>{J("online")})),o.on("offline",(()=>{J("offline")})),o.on("error",(e=>{let t;t="TransportError"===e.type?{level:"info",from:j,type:"primusTransportError",error:(0,s().convertErrorToLog)(e)}:{level:"error",from:j,type:"unknownPrimusError",error:(0,s().convertErrorToLog)(e)};(0,n(745875).rQ)(1)&&i().rateLimitedLog(t),P.log(t),q+=1})),o.on("incoming::ping",Y),o.on("readyStateChange",Q),o.on("end",(()=>{J("end"),o.off("readyStateChange",Q),N+=1,se(o,e)})),window.__primusClient_audioProcessor=o,o}(e)),(function(){return"primus_audioProcessor"}));let ee,te;function ne(){var e;H=!1,D.cancel(),function(){for(const e of R.values())window.clearTimeout(e.timeout);R.clear()}(),null===(e=te)||void 0===e||e()}async function oe(e){var t,n;const{base64Audio:o,environment:i,language:r}=e,s=null===(t=f().default.state.currentUserStore)||void 0===t?void 0:t.id,a=null===(n=f().default.state.currentSpaceStore)||void 0===n?void 0:n.id;var c;if(s&&a)return await(null===(c=ie({method:"audioData",request:{base64Audio:o,language:r,userId:s,spaceId:a},environment:i}))||void 0===c?void 0:c.response);{const e=s||a?s?"Space":"User":"Both";return await(0,u().stopDictation)({environment:i,error:new(p().eY)(e),from:"missing_user_or_space"})}}function ie(e){if(v)return;const{method:t,request:n,environment:o}=e;y(o,{status:"enqueued",endpoint:t});const c=D.enqueue((()=>{var c;const l=r().JW();!function(e,t){g().default.afterNextFlush((()=>{S().default.checkGate({gateName:"audio_processor_client_send_request_metric_enabled"})&&(h().vd(e,"audio_processor.client.send_request.queue_running_size",{value:t.running}),h().vd(e,"audio_processor.client.send_request.queue_backup_size",{value:t.queue}))}))}(o,D.getStats());const u=a().yX(),p=Date.now(),m=G?window.setTimeout((()=>{"open"===V&&(U.requestsTimedOut+=1,P.log({level:"info",from:j,type:"requestTimeout",data:{requestId:l,time:Date.now()-p}}))}),B):void 0;R.set(l,{resolve:u.resolve,reject:u.reject,timeout:m,sendTime:p}),P.log({level:"info",from:j,type:"requestSent",data:{requestId:l,method:t}});const f={type:`${d().A.audioProcessor.api}/${t}`,requestId:l,...n};U.requestsSent+=1,async function(e){const{message:t,environment:n}=e,o=JSON.stringify(t);U.charactersSent+=o.length,W<o.length&&(W=o.length);const i=await X(n);null==i||i.write(t)}({message:f,environment:o}),null===(c=e.onRequestSent)||void 0===c||c.call(e),u.promise.then((e=>{y(o,{status:"success",endpoint:t})})).catch((e=>{const n=D.getStats();y(o,{status:"failure",endpoint:t,queue_running_size:n.running,queue_backup_size:n.queue})}));const v=a().nQ(1e3,u.promise).then((e=>{let{timeout:n}=e;if(n){const e=D.getStats();y(o,{status:"failure",endpoint:t,queue_running_size:e.running,queue_backup_size:e.queue,queue_timeout:!0}),i().log({level:"error",from:"audioProcessorInternals",type:"requestTimeout",error:(0,s().convertErrorToLog)(new Error("Request timed out")),data:{miscDataToConvertToString:{requestId:l,method:t}}})}return{}}));return v}));return{response:c.catch((e=>{e instanceof ce&&!H?(H=!0,F+=1,J("connectionResetDueToFailedRequest"),X(o).then((e=>{null==e||e.end()})),le(`sendRequest() for ${t} returned server error (${e.message}), resetting connection`,n)):le(`sendRequest() cancelled or errored for ${t} (${e.message})`,n)})),asyncQueuePromise:c}}function re(e){U.messagesReceived+=1;const t=(0,l().tf)(o().hX,e);if(t)return U.invalidMessagesReceived+=1,void i().rateLimitedLog({level:"warning",from:j,type:"ValidationError",data:{miscDataToConvertToString:e},error:(0,s().convertErrorToLog)(t)});const n=e;switch(n.type){case"response":{var r;const{requestId:e,status:t,result:o}=n,i=R.get(e);if(R.delete(e),P.log({level:"info",from:j,type:"responseReceived",data:{requestId:e,response:t,time:i&&Date.now()-i.sendTime,internalProcessingTimeMs:null===(r=n.result)||void 0===r?void 0:r.internalProcessingTimeMs}}),!i)return void(U.responsesReceivedWithoutHandlers+=1);$=Date.now(),window.clearTimeout(i.timeout),"ok"===t?(U.successfulResponsesReceived+=1,i.resolve(o)):(U.unsuccessfulResponsesReceived+=1,i.reject(new ce(o)));break}case"transcription":T.emit(A,n);break;case"vad":T.emit(w,n);break;case"rate_limited":T.emit(k,n);break;case"forbidden":T.emit(_,n);break;case"openai_error":T.emit(x,n)}}function se(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o,r;n&&i().log({level:"info",from:j,type:"audioProcessorEnd",error:{message:`SocketId: ${null==e||null===(o=e.socket)||void 0===o?void 0:o.id} Query:${null==e||null===(r=e.transport)||void 0===r?void 0:r.query}`}});K.setTimeout((()=>{void 0!==e&&e.destroy()}),0),X.cache.clear(),ne(),n&&K.setTimeout((()=>{X(t)}),2*c().TD)}async function ae(e){if(e&&X.cache.has("primus_audioProcessor")){const t=await X(e);if(t){const n={type:`${d().A.audioProcessor.api}/destroySession`,requestId:r().JW()};t.write(n),t.removeAllListeners("end"),se(t,e,!1),(0,b().generateNewClientSessionId)()}}}class ce extends Error{constructor(e){super(e),this.name="FailedAudioProcessorRequestError"}}function le(){if(C){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.info("audioProcessorInternals:",...t)}}},338931:(e,t,n)=>{n.d(t,{Gj:()=>i,RN:()=>a,vZ:()=>r});n(944114),n(898992),n(823215),n(354520),n(672577);var o=()=>n(244641);function i(e){const t=o().c9.fromMillis(e.startUnixTimestampMS),n=e.endUnixTimestampMS?o().c9.fromMillis(e.endUnixTimestampMS):void 0,i=o().c9.fromMillis(e.startOfWeekUnixTimestampMS),r=o().c9.fromMillis(e.endOfWeekUnixTimestampMS),s=t.startOf("day"),a=o().c9.max(i,s),c=Math.ceil(a.diff(i,"days").get("days"));let l=1;if(n){const e=n.endOf("day"),t=o().c9.min(r,e);l=Math.ceil(t.diff(a,"days").get("days"))}return{start:t,end:n,startOfWeek:i,endOfWeek:r,startColumn:c,columnCount:l}}function r(e){const t=(e.attendees||[]).filter((e=>!e.self&&!e.resource));return e.hasParticipants&&t.length>0&&t.every((e=>"declined"===e.responseStatus))}const s={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function a(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:n,startingMinsThreshold:i,startedMinsThreshold:r}=s,a=[],l=[],d=[],u=[],p=[];for(const s of t){if(s.isAllDay)continue;const e=c(s),t=o().c9.now(),m=e.start.diff(t,"minutes").minutes;m>=0&&m<=n?a.push(s):-m>=i?d.push(s):-m>=r?u.push(s):e.contains(t)?l.push(s):p.push(s)}return[...a,...d,...u,...l,...p][0]}function c(e){const t=o().c9.fromISO(e.start.dateTime,{zone:e.start.timeZone}),n=o().c9.fromISO(e.end.dateTime,{zone:e.end.timeZone});return o().IX.fromDateTimes(t,n)}},358006:(e,t,n)=>{n.d(t,{z:()=>s});n(296540);var o=()=>n(645873),i=n(474848);const r=new(o().O2)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await n.e(79883).then(n.bind(n,873718));return{CollectionItemCover:e}})),s=(0,o()._h)(r,(e=>e.CollectionItemCover),{renderLoading:(e,t)=>{const{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:s,showEmptyGalleryCover:a}=t;return a?(0,i.jsx)(n(271232).t,{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:s}):null}})},391532:(e,t,n)=>{n.r(t),n.d(t,{appendTranscriptionBlockToPage:()=>A,createTranscriptionBlockInNewPage:()=>w});var o=()=>n(244641),i=()=>n(584262),r=()=>n(700500),s=()=>n(597777),a=()=>n(604995),c=()=>n(416504),l=()=>n(919709),d=()=>n(171718),u=()=>n(44729),p=()=>n(857783),m=()=>n(185544),f=()=>n(319975),v=()=>n(751156),g=()=>n(87017),h=()=>n(328732),S=()=>n(211716),y=()=>n(351360),b=()=>n(502438);function A(e){const{environment:t}=e;v().createAndCommit({userAction:"transcriptionNewPageActions.appendTranscriptionBlock",environment:t,canUndo:!0,perform:e=>{(0,g().insertBlockBelow)({environment:t,createBlockItem:h().ry[r().xd.transcription],analyticsFrom:"quick_templates",selection:[],transaction:e})}})}function w(e){const{environment:t,from:n}=e,g=y().default.state.currentSpaceStore,A=y().default.state.currentSpaceViewStore,w=b().default.getCurrentRecordCache();if(!w)return;if(!g||!A)return;const{performResult:{createdPage:k}}=v().createAndCommit({userAction:"transcriptionNewPageActions.createTranscriptionBlockInNewPage",environment:t,canUndo:!0,perform:e=>{const i=m().IT({environment:t,spaceStore:g,spaceViewStore:A,isPrivate:!0,transaction:e});if(i.isType(r().xd.page)){const n=i.getBlockTitleStore(),r=o().c9.now(),d=[l().wmz(l().Ww9({type:"datetime",start_date:r.toFormat(a().tr),start_time:r.toFormat(s().GE),time_zone:(0,c().P)(),date_format:"relative"}),[[l().BQP.Bold]])];f().yr({environment:t,store:n,tokens:d,transaction:e,index:0})}const p=h().ry[r().xd.transcription],v=d().w({environment:t,transaction:e,inMemoryRecordCache:w,from:n,selection:[],createBlockItem:p});return u().NI({childStore:v,parentStore:i,transaction:e}),{createdPage:i}}});p().uK({environment:t,store:k,visitType:S().ig.Link,pageVisitSource:i().y8.Create})}},431895:(e,t,n)=>{n.d(t,{HT:()=>y,MZ:()=>k,u:()=>_,xw:()=>S});n(16280),n(296540);var o=()=>n(959013),i=()=>n(939768),r=()=>n(449506),s=()=>n(705540),a=()=>n(435009),c=()=>n(812182),l=()=>n(2220),d=()=>n(597755),u=()=>n(112799),p=()=>n(948914),m=()=>n(508496),f=()=>n(927648),v=n(474848);const g=(0,o().YK)({latestVersionStepTitle:{id:"transcriptionSetupSteps.latestVersionStepTitle",defaultMessage:"Update your Notion app"},latestVersionStepDescription:{id:"transcriptionSetupSteps.latestVersionStepDescription",defaultMessage:"To use AI meeting notes, you will need the latest version of the Notion app. Please update to ensure everything works smoothly."},latestVersionStepActionText:{id:"transcriptionSetupSteps.latestVersionStepActionText",defaultMessage:"Check for updates"},microphoneStepTitle:{id:"transcriptionSetupSteps.microphoneStepTitle",defaultMessage:"Microphone"},microphoneStepDescription:{id:"transcriptionSetupSteps.microphoneStepDescription",defaultMessage:"To transcribe audio from your computer, we need permission to your microphone so we can capture what you are saying. You may need to restart your app for the permission to take effect."},microphoneStepActionText:{id:"transcriptionSetupSteps.microphoneStepActionText",defaultMessage:"Grant microphone access"},systemAudioStepTitle:{id:"transcriptionSetupSteps.systemAudioStepTitle",defaultMessage:"Screen access"},systemAudioStepDescription:{id:"transcriptionSetupSteps.systemAudioStepDescription",defaultMessage:"To transcribe audio from your computer, we need permission to access your screen so that we can capture system audio."},systemAudioStepActionText:{id:"transcriptionSetupSteps.systemAudioStepActionText",defaultMessage:"Check screen access"},restartAppStepTitle:{id:"transcriptionSetupSteps.restartAppStepTitle",defaultMessage:"Restart Notion"},restartAppStepDescription:{id:"transcriptionSetupSteps.restartAppStepDescription",defaultMessage:"To apply the new permissions, you need to restart the Notion app. Please close and reopen the app to start using AI meeting notes."},restartAppStepActionText:{id:"transcriptionSetupSteps.restartAppStepActionText",defaultMessage:"Restart Notion"}}),h=[{id:"desktop-app-version",title:g.latestVersionStepTitle,description:g.latestVersionStepDescription,hasCompleted:e=>Promise.resolve(_(e.environment)),actionText:g.latestVersionStepActionText,action:async e=>{const t=await(0,u().a)(e.environment.device);t?await s().openExternalUrl(n(780054).A.domainBaseUrl+t):await s().openExternalUrl("https://www.notion.so/desktop")}},{id:"microphone",title:g.microphoneStepTitle,description:g.microphoneStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.environment.device.isElectron){if("granted"===await s().getMediaAccessStatus("microphone"))return!0;if(e.isConfirmation)try{return await A(),!0}catch{return!1}}return!1},actionText:g.microphoneStepActionText,action:async e=>{try{await A()}catch(t){t instanceof Error&&t.name===f().nY&&s().openSystemSettings("microphone")}}},{id:"system-audio",title:g.systemAudioStepTitle,description:g.systemAudioStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectronWindows)return!0;if(e.isConfirmation){if(await w())return!0}return Promise.resolve(void 0!==f().Ay.getHasAttemptedScreenRecordingPermissions())},actionText:g.systemAudioStepActionText,action:async e=>{const t=await w();f().Ay.setHasAttemptedScreenRecordingPermissions(t?f().a3:f().JS),t&&t===f().a3||s().openSystemSettings("screen-recording")}},{id:"restart-app",title:g.restartAppStepTitle,description:g.restartAppStepDescription,hasCompleted:async e=>{if(e.environment.device.isElectron&&e.isConfirmation){if("allowed"===await w())return!0}return Promise.resolve(!1)},actionText:g.restartAppStepActionText,action:async()=>(s().relaunch(),Promise.resolve())}];function S(){return h}async function y(e){if(m().default.checkGate({gateName:"enable_transcription_on_browser_for_debug_enabled"}))return{shouldShowSetupModal:!1,shouldStartDictation:!0};if(e.device.isMobile)return{shouldShowSetupModal:!1,shouldStartDictation:!0};if(e.device.isBrowser)return{shouldShowSetupModal:!1,shouldStartDictation:!1};const t=await async function(e,t){for(const n of t)if(!(await n.hasCompleted({environment:e,isConfirmation:!1})))return n}(e,S());return"desktop-app-version"===(null==t?void 0:t.id)||"microphone"===(null==t?void 0:t.id)?{shouldShowSetupModal:!0,shouldStartDictation:!1}:{shouldShowSetupModal:!1,shouldStartDictation:!0}}function b(e){c().HK({presentationType:"persistent",id:"transcription_browser_toast",title:(0,v.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.title",defaultMessage:"Notion app required"}),message:(0,v.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.message",defaultMessage:"To begin transcription, you must use the Notion app."}),actions:{primary:{title:(0,v.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.primaryAction",defaultMessage:"Download app"}),onAction:async()=>{await async function(e){const t=await(0,u().a)(e.device);if(!t)return;(0,l().u)({environment:e,event:{eventName:"download_app_for_transcription_clicked",eventProperties:{}}}),a().oo({environment:e,url:t,openInNew:"tab"})}(e),c().UW("transcription_browser_toast")}},secondary:{title:(0,v.jsx)(o().sA,{id:"transcriptionPermissionActions.transcriptionAppRequired.secondaryAction",defaultMessage:"Ignore"}),onAction:()=>{c().UW("transcription_browser_toast"),(0,l().u)({environment:e,event:{eventName:"transcription_native_app_required_toast_dismissed",eventProperties:{}}})}}}}),(0,l().u)({environment:e,event:{eventName:"transcription_native_app_required_toast_shown",eventProperties:{}}})}async function A(){const e=(0,n(673903).E)(),t=await e.getUserMedia({audio:!0});for(const n of t.getTracks())n.stop()}async function w(){try{const e=await(0,n(763824).nQ)(5e3,(0,f().Kj)());return e.timeout?f().JS:e.result}catch{return f().JS}}async function k(e){const t=e.device.os;if("mac"!==t&&"windows"!==t)return void b(e);const n=await r().callApi({eventName:"getDesktopAppRegistration",environment:e,data:{os:t}});if("data"in n&&n.data.isRegistered)return(0,l().u)({environment:e,event:{eventName:"open_transcription_block_in_desktop_app_clicked",eventProperties:{}}}),void(await a().eG({environment:e,url:(0,d().P)((0,i().O$)(window.location.href,{target:"auto_transcribe"}))}));b(e)}function _(e){const t=p().A.state.transcriptionSupportLevel;return Boolean(t)}},541235:(e,t,n)=>{n.d(t,{YD:()=>r,c$:()=>o,q_:()=>i});const o={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]}},i="completed",r="dismissed"},551345:(e,t,n)=>{n.d(t,{VN:()=>c,or:()=>s,pV:()=>a});var o=()=>n(120114),i=()=>n(430483),r=()=>n(508496);function s(e){const{configurationState:t}=e;return t.deepFindRequested&&i().zD.isDeepFindEnabled()}function a(e){const{configurationState:t,assistantSurface:n}=e;return s({configurationState:t})&&n.isType("fullPage")}function c(){const e=i().zD.state;return(0,o().AX)(e,(e=>r().default.getConfigKey("deep_find_config",e)),(e=>r().default.checkGate({gateName:e})))}new(n(496506).default)((()=>{var e;const t=i().zD.isDeepFindEnabled(),o=Boolean(null===(e=n(295169).default.getActiveAssistantConfigurationState())||void 0===e?void 0:e.deepFindRequested);return t&&o}),{debugName:"isDeepFindActiveStore"})},562866:(e,t,n)=>{n.d(t,{$c:()=>a,aI:()=>s,cx:()=>r,uf:()=>i});var o=()=>n(645873);const i={RequestMembersModal:new(o().O2)("RequestMembersModal",(()=>Promise.all([n.e(75134),n.e(43380),n.e(96346),n.e(55373),n.e(36192),n.e(44711),n.e(62475),n.e(3151),n.e(16471),n.e(53321),n.e(58550),n.e(98629),n.e(90825),n.e(37353),n.e(29151),n.e(31895),n.e(83647),n.e(85864),n.e(92845),n.e(71718),n.e(83324),n.e(48486),n.e(95794),n.e(85515),n.e(74562),n.e(38744),n.e(63077),n.e(28271),n.e(17254),n.e(41870),n.e(90966),n.e(42120),n.e(7114),n.e(67435),n.e(92012),n.e(22462),n.e(8184),n.e(4422),n.e(28721),n.e(28866),n.e(21194),n.e(6463),n.e(71993),n.e(1213),n.e(17989),n.e(90625),n.e(59794),n.e(78846),n.e(26483),n.e(43741),n.e(81768),n.e(94387),n.e(82850),n.e(52393),n.e(77692),n.e(75601),n.e(11341),n.e(7060),n.e(82136),n.e(12739),n.e(26090),n.e(73594),n.e(93282),n.e(12341),n.e(50984),n.e(66984),n.e(40828),n.e(26199),n.e(18057),n.e(90978),n.e(56264),n.e(5023),n.e(55927),n.e(61151),n.e(72226),n.e(48199),n.e(64598),n.e(38119),n.e(77282)]).then(n.bind(n,123350)))),GoogleImportsInviteWithModal:new(o().O2)("GoogleImportsInviteWithModal",(()=>Promise.all([n.e(96346),n.e(85864),n.e(92845),n.e(71718),n.e(83324),n.e(48486),n.e(95794),n.e(38744),n.e(51195),n.e(51226)]).then(n.bind(n,720193)))),InviteDropdownMenuItemLabel:new(o().O2)("InviteDropdownMenuItemLabel",(()=>n.e(25171).then(n.bind(n,726799)))),personPropertyInviteActions:new(o().O2)("personPropertyInviteActions",(()=>Promise.all([n.e(96346),n.e(85864),n.e(92845),n.e(71718),n.e(83324),n.e(48486),n.e(95794),n.e(38744),n.e(57613)]).then(n.bind(n,980270))))},r=(0,o()._h)(i.RequestMembersModal,(e=>e.RequestMembersModal)),s=(0,o()._h)(i.GoogleImportsInviteWithModal,(e=>e.GoogleImportsInviteWithModal)),a=(0,o()._h)(i.InviteDropdownMenuItemLabel,(e=>e.InviteDropdownMenuItemLabel))},577579:(e,t,n)=>{n.d(t,{Z:()=>p});n(581454),n(296540);var o=()=>n(484714),i=()=>n(847249),r=()=>n(805952),s=()=>n(760217),a=()=>n(939740),c=()=>n(89924),l=()=>n(38337),d=()=>n(632503),u=n(474848);function p(e){const t=(0,o().v3)(),{parent:n}=e,p=(0,i().K8)((()=>Object.keys(r().Cu).indexOf((0,d().FT)(t.currentUser.id))),[t.currentUser.id]),m=[{key:"languages",render:e=>(0,u.jsx)(c().A,{...e,topBorder:0!==e.index}),items:(0,d().u1)().map((e=>{let[o,[i]]=e;const r={key:o,render:e=>(0,u.jsx)(s().A,{...e,title:i}),action:()=>{(0,d().Xy)(t,o),n.close()}};return r}))}];return(0,u.jsx)("div",{className:l().OLz,style:{display:"flex",flexDirection:"column",width:150},children:(0,u.jsx)(a().Ay,{type:a().Oh.Vertical,initialFocus:p,sections:m})})}},595345:(e,t,n)=>{n.d(t,{$g:()=>o().$g,qY:()=>i().getCurrentClientSessionId});var o=()=>n(317027),i=()=>n(99874)},632503:(e,t,n)=>{n.d(t,{$q:()=>d,FT:()=>g,Xy:()=>v,u1:()=>l});n(378347);var o=()=>n(805952),i=()=>n(763884),r=()=>n(209199),s=()=>n(595345),a=()=>n(351360),c=()=>n(233124);function l(){return Object.entries(o().Cu)}function d(e){return o().Cu[e][1]}function u(e){switch(e){case"en-US":default:return"English";case"de-DE":return"German";case"ko-KR":return"Korean";case"zh-CN":case"zh-TW":return"Chinese";case"ja-JP":return"Japanese";case"es-ES":case"es-LA":return"Spanish";case"pt-BR":return"Portuguese";case"fr-FR":return"French";case"da-DK":return"Danish";case"fi-FI":return"Finnish";case"nb-NO":return"Norwegian";case"nl-NL":return"Dutch";case"sv-SE":return"Swedish"}}class p extends(()=>n(757695))().default{constructor(){super(),this.lastLocalStorageRetrieval=void 0}syncLocalStorageIfNecessary(e){if(!this.lastLocalStorageRetrieval||e!==this.lastLocalStorageRetrieval[0]||Date.now()-this.lastLocalStorageRetrieval[1]>30*n(720665).TD){this.lastLocalStorageRetrieval=[e,Date.now()];const n=i().K.get({userId:e,key:f});if(Object.hasOwn(o().Cu,n))this.state!==n&&this.setState(n);else{var t;const n=u((null===(t=a().default.state.currentUserSettingsStore)||void 0===t||null===(t=t.getSettings())||void 0===t?void 0:t.preferred_locale)??r().q);n!==this.state&&this.setState(n),i().K.set({userId:e,key:f,value:this.state})}}}getInitialState(){var e;return u((null===(e=a().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??r().q)}}const m=new p,f="DictationLanguage";function v(e,t){(0,c().K_)(e,{from_language:m.state,to_language:t,dictation_session_id:(0,s().qY)()}),m.setState(t),i().K.set({userId:e.currentUser.id,key:f,value:t})}function g(e){return m.syncLocalStorageIfNecessary(e),m.state}},694874:(e,t,n)=>{n.d(t,{Oh:()=>y,Qs:()=>S,Wy:()=>f,aX:()=>g,it:()=>h,tL:()=>v});n(898992),n(354520),n(430670);var o=()=>n(244641),i=()=>n(994310),r=()=>n(534177),s=()=>n(246826),a=()=>n(751156),c=()=>n(755199),l=()=>n(638146),d=()=>n(351360),u=()=>n(846955),p=()=>n(696746),m=()=>n(705059);function f(e){const{currentUserSettingsStore:t}=d().default.state;t&&a().createAndCommit({userAction:"SidebarPersonalHomeButton.markAsSeen",environment:e,canUndo:!0,perform:e=>{c().mJ({userSettingsStore:t,transaction:e,data:{seen_personal_home:!0}})}})}function v(e){const{currentUserSettingsStore:t}=d().default.state;t&&(u().default.setState({type:"inactive"}),a().createAndCommit({userAction:"SidebarPersonalHomeButton.markHomeTooltipAsSeen",environment:e,canUndo:!0,perform:e=>{c().mJ({userSettingsStore:t,transaction:e,data:{personal_home_delayed_tooltip_dismissed_at:o().c9.now().toMillis()}})}}))}function g(e){const{environment:t,newSeenWelcomeHomeValue:n}=e,o=d().default.state.currentSpaceViewStore;o&&a().createAndCommit({userAction:"SidebarPersonalHomeSettings.markWelcomeAnimationAsSeen",environment:t,canUndo:!0,perform:e=>{const t=o.getSettingsStore().getKeyStore("personal_home").getKeyStore("seen_welcome_animation");s().KY({store:t,transaction:e,value:n})}})}function h(e){const{environment:t,tipType:n,completed:o}=e,{currentUserSettingsStore:i}=d().default.state;if(!i)return;const r=i.getPersonalHomeTipsSettings(),s={...r,progress_data:{...r.progress_data,[n]:{completed:o}}};a().createAndCommit({userAction:"LearnHomePanel.updateProgress",environment:t,canUndo:!0,perform:e=>{c().mJ({userSettingsStore:i,transaction:e,data:{personal_home_tips_settings:s}})}})}function S(e){const{environment:t,hide:n}=e,{currentUserSettingsStore:o}=d().default.state;if(!o)return;const i={...o.getPersonalHomeTipsSettings(),hide_completed:n};a().createAndCommit({userAction:"LearnHomePanel.hideCompleted",environment:t,canUndo:!0,perform:e=>{c().mJ({userSettingsStore:o,transaction:e,data:{personal_home_tips_settings:i}})}})}function y(e){const{blockId:t,enabledFeatures:n,userId:o}=e,s=(0,r().WP)(n).flatMap((e=>{let[t,n]=e;if(!n)return[];switch(t){case"tasks":return[(0,p().NY)("myTasksAssignedToMeCollectionView")];case"customDb":const e=(0,p().NY)("customDb");return[e&&(0,l().cf)({userId:o,viewBlockId:e})].filter(r().O9);case"similarUsersAndTrending":return[(0,p().NY)("similarUsersCollectionView"),(0,p().NY)("trendingCollectionView")];case"unifiedFeed":return[(0,p().NY)("postsCollectionView")];case"recents":case"updates":case"templates":case"tips":case"calendar":case"aiChatModule":return[];default:(0,r().HB)(t)}})),{isHomeKey:a,homeCollectionViewIdsKey:c,unifiedFeedEnabledKey:d}=(0,m().h)(t);i().A.set(a,!0),i().A.set(c,s),i().A.set(d,n.unifiedFeed)}},725081:(e,t,n)=>{n.r(t),n.d(t,{sendNotificationForDictationInterrupted:()=>x,sendNotificationForRunningAudioProcess:()=>_});n(898992),n(672577),n(581454);var o=()=>n(244641),i=()=>n(662303),r=()=>n(584262),s=()=>n(416504),a=()=>n(959013),c=()=>n(705540),l=()=>n(435009),d=()=>n(186445),u=()=>n(338931),p=()=>n(972435),m=()=>n(523239),f=()=>n(135428),v=()=>n(379560),g=()=>n(982254),h=()=>n(508496),S=()=>n(271380),y=()=>n(391532);const b=(0,a().YK)({"us.zoom.xos":{id:"audioProcessDetectionActions.zoom",defaultMessage:"Zoom meeting detected"}}),A=(0,a().YK)({body:{id:"audioProcessDetectionActions.notification.body",defaultMessage:"Take notes with Notion?"}}),w=(0,a().YK)({transcription_stopped:{id:"transcription.transcriptionStopped",defaultMessage:"Transcription stopped unexpectedly"},resume_prompt:{id:"transcription.resumePrompt",defaultMessage:"Click to resume transcription"}}),k=(0,a().YK)({defaultEventTitle:{id:"calendarMeetingNoteNotification.defaultEventTitle",defaultMessage:"Meeting"},allDayTimeLabel:{id:"calendarMeetingNoteNotification.allDayTimeLabel",defaultMessage:"All-day"},takeNotes:{id:"calendarMeetingNoteNotification.takeNotesBody",defaultMessage:"{startTime} · Take meeting notes"}});function _(e,t){var n;if(e.device.isMobile||!h().default.checkGate({gateName:"meeting_notes_audio_process_notification"}))return;const r=null===(n=v().A.getStateForCurrentSpaceView())||void 0===n?void 0:n.botId,a=function(e){const t=(0,u().RN)(e);if(!t)return;if(t.isAllDay)return;const n=10,i=o().c9.fromISO(t.start.dateTime);if(i.diff(o().c9.now()).as("minutes")>n)return;return t}(v().A.getEvents()),c=function(e){const{processId:t,event:n}=e;if(n)return n.summary||p().A.formatMessage(k.defaultEventTitle);return p().A.formatMessage(b[t])}({processId:t,event:a}),d=function(e){const{event:t}=e;if(t){const e=t.isAllDay?p().A.formatMessage(k.allDayTimeLabel):(0,f().ax)({time:o().c9.fromISO(t.start.dateTime),showAmPm:!0,locale:i().locale,timeZone:(0,s().P)()});return p().A.formatMessage(k.takeNotes,{startTime:e})}return p().A.formatMessage(A.body)}({processId:t,event:a});new Notification(c,{body:d,silent:!0}).addEventListener("click",(()=>{null!=a&&a.meetingNotes&&r?async function(e){const{environment:t,event:n,calendarBotId:o}=e;if(!n.meetingNotes)return;const i=n.isAllDay?{uid:n.meetingNotes.eventUid,title:n.summary??"",attendees:(n.attendees??[]).map((e=>({email:e.email??"",self:e.self}))),isAllDay:!0,start:{date:n.start.date},end:{date:n.end.date}}:{uid:n.meetingNotes.eventUid,title:n.summary??"",attendees:(n.attendees??[]).map((e=>({email:e.email??"",self:e.self}))),isAllDay:!1,start:{dateTime:n.start.dateTime,timeZone:n.start.timeZone},end:{dateTime:n.end.dateTime,timeZone:n.end.timeZone}},r=await(0,m().NC)({environment:t,botId:o,data:{event:i,location:n.meetingNotes.location,share:Boolean(n.meetingNotes.share)}});if("success"===r.type){const{url:e}=r.data.page;l().oo({environment:t,url:e,openInNew:"tab",makeTabActive:!0})}else(0,y().createTranscriptionBlockInNewPage)({environment:t,from:"audio_process_detection"})}({environment:e,event:a,calendarBotId:r}):(0,y().createTranscriptionBlockInNewPage)({environment:e,from:"audio_process_detection"})}))}function x(e,t,n){if(e.device.isMobile)return;const o=p().A.formatMessage(w.transcription_stopped),i=n?p().A.formatMessage(w.resume_prompt):void 0,s=new Notification(o,{body:i,silent:!1,requireInteraction:!0}),a=()=>{if(t){const e=g().A.state.tabs.find((e=>{var t;return(null===(t=e.pagePointer)||void 0===t?void 0:t.id)===(0,d().s0)()}));e&&c().navigateToBlockInTab({tabId:e.id,pointer:t.pointer,source:r().y8.TranscriptionBlockPopup})}},l=n?()=>{a(),null!=t&&t.isTranscriptionBlock()&&(0,S().startTranscription)({environment:e,blockStore:t,from:"resume_from_click_error_notification"})}:a;s.addEventListener("click",l)}},739135:(e,t,n)=>{n.d(t,{KD:()=>l,gt:()=>d,i9:()=>c,ll:()=>s,tb:()=>a,x$:()=>r});var o=()=>n(541235),i=()=>n(496603);function r(e,t){return s(d(e,t))}function s(e){return void 0!==e&&(e===o().q_||e===o().YD)}function a(e,t){if(s(t))return;const n=o().c$[e],i=n.steps.findIndex((e=>e.id===t));return-1===i?n.steps[0].id:i===n.steps.length-1?o().q_:n.steps[i+1].id}function c(e,t){const n=d(e,t);if(n&&!s(n))return a(t,n)}function l(e,t){const n=d(e,t);if(n)return function(e,t){const n=o().c$[e];var r;if(s(t))return null===(r=(0,i().HV)(n.steps))||void 0===r?void 0:r.id;const a=n.steps.findIndex((e=>e.id===t));return-1!==a&&0!==a?n.steps[a-1].id:void 0}(t,n)}function d(e,t){var n;if(!e)return;const i=((null===(n=e.getSettings())||void 0===n?void 0:n.tutorials)||{})[t];return void 0===i?o().c$[t].steps[0].id:i}},749514:(e,t,n)=>{n.r(t),n.d(t,{AudioSessionBlockWriter:()=>U,DictationManager:()=>V,StreamingDictationManager:()=>X,smartToggleDictation:()=>G,startDictation:()=>J,stopDictation:()=>Y,updateActiveBlocks:()=>Z});n(16280),n(18107),n(944114),n(816573),n(878100),n(177936),n(967357),n(748140),n(821903),n(491134),n(128845),n(237467),n(444732),n(979577),n(898992),n(823215),n(354520),n(672577),n(803949),n(581454);var o=()=>n(700500),i=()=>n(857639),r=()=>n(919709),s=()=>n(999752),a=()=>n(319625),c=()=>n(502800),l=()=>n(534177),d=()=>n(44729),u=()=>n(246826),p=()=>n(319975),m=()=>n(725614),f=()=>n(751156),v=()=>n(595345),g=()=>n(317027),h=()=>n(87017),S=()=>n(186445),y=()=>n(328732),b=()=>n(108944),A=()=>n(351360),w=()=>n(148832),k=()=>n(233124);class _{constructor(e,t){this.id=void 0,this.text=void 0,this.isCompleteReceived=void 0,this.transcriptions=void 0,this.id=e,this.isCompleteReceived=Boolean(t),this.transcriptions=new Map}updateText(){let e;for(const t of this.transcriptions.values()){if("pending"===t.status)break;"complete"===t.status&&(e=t.text)}this.text=e}setTranscription(e,t){this.transcriptions.set(e,t),this.updateText()}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}getText(){return this.text}isSettled(){return this.isCompleteReceived&&this.transcriptions.values().every((e=>"pending"!==e.status))}}var x=()=>n(909557),T=()=>n(28834);function I(e){let t;const n=[];for(const i of e.segments){var o;const r=i.getText();if(!r)continue;const s=i.isSettled()||e.forceSettled||!1;(null===(o=t)||void 0===o?void 0:o.settled)!==s?(t&&n.push(t),t={text:r,settled:s,segmentId:i.getId()}):t.text=`${t.text} ${r}`}return t&&n.push(t),n.length>0&&e.indent&&(n[0].text=` ${n[0].text}`),n}n(737550);function C(e){return!!(0,r().BEe)(e)&&e[1].some(r().Si1)}const B=/([\?\!\.])\s/;function M(e){const t=e.split(B);for(let n=1;n<t.length;n++){const e=t[n];[".","?","!"].includes(e)&&(t[n-1]+=e,t[n]="")}return t.filter((function(e){return void 0!==e&&""!==e}))}var D,R=()=>n(540144),j=()=>n(497663),P=()=>n(927648),E=()=>n(964345),L=()=>n(632503);const N=[];function q(e){N.push(e)}class F{constructor(){this.segments=void 0,this.segments=new Map}setSegment(e){this.segments.set(e.getId(),e)}getSegment(e){return this.segments.get(e)}getSegments(){return this.segments.values()}deleteSegment(e){this.segments.delete(e)}isSettled(){return this.getSegments().every((e=>e.isSettled()))}}class U{constructor(e){this.id=void 0,this.env=void 0,this.isCompleteReceived=void 0,this.blockStore=void 0,this.onUpdateBlock=void 0,this.segmentManager=void 0;const{id:t,env:n,blockStore:o,onUpdateBlock:i}=e;this.id=t,this.env=n,this.isCompleteReceived=!1,this.blockStore=o,this.onUpdateBlock=i,this.segmentManager=new F}getOrCreateSegment(e){const t=this.segmentManager.getSegment(e);if(t)return t;const n=new _(e);return this.segmentManager.setSegment(n),n}getBlockStore(){return this.blockStore}setBlockStore(e){var t;this.blockStore=e,null===(t=this.onUpdateBlock)||void 0===t||t.call(this,e)}addInsertEvent(e){}addDeleteEvent(e){}setIsCompleteReceived(e){!this.isCompleteReceived&&e&&(this.isCompleteReceived=!0)}getId(){return this.id}isSettled(){return this.isCompleteReceived&&this.segmentManager.isSettled()}writeToBlock(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.blockStore.getParentBlockStore();if(!this.blockStore.isDictatableBlock()||!t)return;let o=!1;const i=[],s=[];for(const n of[...this.segmentManager.getSegments()])o||!e&&!n.isSettled()?(o=!0,s.push(n)):(i.push(n),this.segmentManager.deleteSegment(n.getId()));f().createAndCommit({userAction:"dictationActions.writeToBlock",environment:this.env,canUndo:!1,perform:o=>{let a,c=0;const l=this.blockStore.getBlockTitleStore(),d=(0,r().ooo)(l.getValue());for(let e=0;e<d.length;e++){if(C(d[e])){a=e;break}c+=(0,r().WWE)(d[e])}if(void 0!==a){if(0===i.length&&n(508496).default.checkGate({gateName:"meeting_notes_skip_redundant_writes"})){const t=function(e){const{tokens:t,...n}=e,o=I(n);return o.length===t.length&&o.every(((e,n)=>{let{text:o,settled:i}=e;const s=t[n];return!(C(s)?i:!i)&&o===(0,r().N8A)(s)}))}({segments:s,tokens:d.slice(a),forceSettled:e,indent:c>0});if(t)return}this.addDeleteEvent({transactionId:o.id,index:c}),p().jQ({environment:this.env,store:l,selection:{startIndex:c,endIndex:1/0},transaction:o,updateSelection:!1})}const u=function(e){const{text:t,maxLength:n=1/0,initialLength:o=0}=e;if(0===n)throw new Error("Max length must be >0");let i=o,r="";const s=[];for(const a of t)r=""===r?a:`${r} ${a}`,i=r.length,i>=n&&(s.push(r),r="",i=0);return r&&s.push(r),s}({text:M(W([...i.values()])),initialLength:c,maxLength:250});for(const e of u){const n=c>0?` ${e}`:e;if(this.addInsertEvent({location:"combined settled segments",transactionId:o.id,index:c,text:n,settled:!0}),z({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:c,transcriptions:[{text:n,settled:!0}],transaction:o}),c+=n.length,c>250){const e=$({environment:this.env,parentBlockStore:t,siblingBlockStore:this.blockStore,transaction:o});this.setBlockStore(e),c=0}}const m=I({segments:s,forceSettled:e,indent:c>0});0!==m.length&&(m.forEach((e=>{let{text:t,settled:n}=e;this.addInsertEvent({text:t,settled:n,index:c,transactionId:o.id,location:"post-insert segments"})})),z({environment:this.env,audioSessionId:this.id,blockStore:this.blockStore,index:c,transcriptions:m,transaction:o}))}})}}function O(e){return f().createAndCommit({userAction:"dictationActions.createDictationBlock",environment:e.environment,canUndo:!1,perform:t=>$({...e,transaction:t})})}function $(e){var t,n;const{environment:i,parentBlockStore:r,siblingBlockStore:s,transaction:a}=e,c=(null==s?void 0:s.getDictationRoleModel())??o().xd.text,l=null===(t=E().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();if(i.device.isMobile&&!l&&!r.isTranscriptionBlock()){const e=h().insertBlockBelow({environment:i,selection:s?[s]:[],createBlockItem:y().ry[c],transaction:a,analyticsFrom:"dictation",preventSetSelection:!0});return m().setSelectionAtEnd({store:e.getBlockTitleStore()}),e}const p=r.isTranscriptionBlock()?null===(n=r.getContentStores().find((e=>{const t=r.getFormat().transcription_transcript_id;return e.id===t})))||void 0===n?void 0:n.getContentStore():r.getContentStore();if(!p)throw new Error("No parent dictation content store found");const f=u().Wv({environment:i,type:c,inMemoryRecordCache:r.inMemoryRecordCache,transaction:a});return d().NI({parentStore:p,childStore:w().B.createChildStore(p,f.pointer),after:null==s?void 0:s.id,transaction:a}),f}function z(e){var t;const{environment:o,audioSessionId:i,blockStore:s,index:a,transcriptions:c,transaction:l}=e;if(!s.isDictatableBlock())return;const d=[],u=c.filter((e=>Boolean(e.text)));for(const[p,m]of u.entries()){const{text:e,settled:t}=m,o=p===u.length-1?e:`${e} `,s=t?(0,r().Ey_)(o):(0,r().Ey_)(o,[(0,r().lf7)(n(914649).h5,i,m.segmentId)]);d.push(s)}p().yr({environment:o,index:a,store:s.getBlockTitleStore(),tokens:d,transaction:l,updateSelection:!1});const f=null===(t=E().ei.state)||void 0===t?void 0:t.isTranscriptionBlock();o.device.isMobile&&!f&&m().setSelectionAtEnd({store:s.getBlockTitleStore()})}function W(e){return e.map((e=>e.getText())).filter((e=>Boolean(e))).join(" ").trim()}function K(e){return new Promise(((t,n)=>{try{const o=new Blob(e),i=new FileReader;i.readAsDataURL(o),i.onloadend=()=>{var e;const o=null===(e=i.result)||void 0===e?void 0:e.toString().split(",")[1];o?t(o):n(new Error("No base64Audio"))}}catch(o){n(o)}}))}function H(e,t,n){if((0,l().O9)(n)&&!n.pathIsDead()&&n.id!==t.id){const o=(0,b().Nq)(t),i=(0,b().Nq)(n);if((0,l().O9)(o)&&(0,l().O9)(i)&&o.id===i.id){const o=(0,b().g7)(n);if((()=>{for(const e of o)if(e instanceof w().B){if(e.id===t.id)return!0;if(e.id===i.id)return!1}return!1})()){const t=n.getParentBlockStore();if(n.isEmptyDictatableBlock()&&[...E().Ay.state.audioSessionBlockWriters.values()].every((e=>e.getBlockStore().id!==n.id)))return n;if(t)return O({environment:e,parentBlockStore:t,siblingBlockStore:n}).performResult}}}return O({environment:e,parentBlockStore:t}).performResult}class V{static async getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>K([o])))}return!1}static getDictationAudioRecorder(e){const{environment:t,includeSystemAudio:n,blockStore:o}=e,r=E().Ay.state.audioRecorder;return r?(r.stop(),r):new(T().Nr)({onDataReceived:n=>{E().gZ.state&&(this.audioBuffer=new Float32Array([...this.audioBuffer,...n]),this.getAllProcessableFramesAsBase64(96).then((n=>{if(n){const r=(0,L().$q)((0,L().FT)(t.currentUser.id));(0,v().$g)({base64Audio:n,environment:t,language:r}).catch((e=>{i().log({level:"error",from:"dictationActions",type:"sendAudioDataFailed",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}})}));const s=E().ei.state;if(s&&s.isTranscriptionBlock()){"transcribing"!==(0,R().by)(s).state&&Y({environment:e.environment,from:"transcription_block_stopped"})}}})).catch((e=>{i().log({level:"error",from:"dictationActions",type:"audioRecorderFailed",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}})})))},onStop:e=>{e&&i().log({level:"error",from:"dictationActions",type:"audioRecorderStopped",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:o.id}}}),Y({environment:t,error:e,from:"audio_recorder_stopped"})},includeSystemAudio:n})}static get dictationIsActive(){return Boolean(this.startController&&!this.startController.signal.aborted)}static async smartToggleDictation(e){var t;const n=(0,S().ao)();return this.dictationIsActive&&(null===(t=E().Ay.state.rootBlock)||void 0===t?void 0:t.id)===(null==n?void 0:n.id)?this.stopDictation(e):this.startDictation(e)}static async startDictation(e){const t=e.blockStore??(0,S().ao)(),o=null==t?void 0:t.isTranscriptionBlock();try{await this.stopDictation({environment:e.environment,from:e.from}),this.startController=new AbortController;const l=this.startController.signal;E().Ay.setState({...E().Ay.state,loading:!0});const{environment:d}=e;let u;if(e.preCreateDictationBlock&&t){const{performResult:e}=O({environment:d,parentBlockStore:t});u=e,await n(908006).default.afterNextFlush((()=>{m().setSelectionAtStart({store:e.getBlockTitleStore()})}))}const p=(0,v().qY)();e.from&&(0,k().uB)(e.environment,{dictation_session_id:p,from:e.from});if(!((null==t?void 0:t.isPageBlock())||(null==t?void 0:t.isCollectionViewPageWithContent())||o)||!(0,n(862835).h)()&&!(0,n(878377).xIn)())throw new Error("Target is not dictatable.");const f=this.getDictationAudioRecorder({...e,blockStore:t});Q.start();try{var r;const{environment:i}=e;await f.start();const s=P().Ay.state;if(P().Ay.setState({...s,audio:P().a3}),l.aborted)throw new Error("start dictation aborted");const a=o?null===(r=t.getContentStores().find((e=>e.id===t.getFormat().transcription_transcript_id)))||void 0===r?void 0:r.getContentStores().at(-1):n(502438).default.state.stores.slice(-1).pop();await(0,g().Ez)(e.environment),E().Ay.setState({...E().Ay.state,audioRecorder:f,enabled:!0,talking:!1,rootBlock:t,block:u??H(i,t,a),environment:i,lastReceivedTranscriptionAt:Date.now()}),(0,k().D_)(i,{dictation_session_id:p,block_id:t.id})}catch(s){if(!l.aborted)try{const{audio:t}=await P().Ay.checkPermissions(e.includeSystemAudio);(0,k().rP)(e.environment,{type:"mic_permissions",dictation_session_id:p,reason:t})}catch(s){i().log({level:"error",from:"dictationActions",type:"checkPermissionsFailed",error:(0,c().convertErrorToLog)(s),data:{miscDataToConvertToString:{dictationSessionId:p,rootBlockId:t.id}}})}if(f.destroy((0,a().A)(s)),o){const{audio:n,screenRecording:o}=await P().Ay.checkPermissions(e.includeSystemAudio);throw i().log({level:"error",from:"dictationActions",type:"dictationFailedToStart",error:(0,c().convertErrorToLog)(s),data:{miscDataToConvertToString:{dictation_session_id:p,transcription_id:t.id,audioPermissions:n,screenRecordingPermissions:o}}}),s}}}catch(s){if(this.stopDictation({environment:e.environment,from:"start_transcription_error",error:(0,a().A)(s)}),o)throw s}finally{E().Ay.setState({...E().Ay.state,loading:!1})}}static async stopDictation(e){const t=E().Ay.state.rootBlock;if(this.startController&&!this.startController.signal.aborted){this.startController.abort();const{environment:r,error:s,from:a}=e,l=(0,v().qY)();(0,k().E_)(r,{dictation_session_id:l,from:a});const d=E().Ay.state.audioRecorder,u=E().Ay.state.enabled;E().Ay.setState({...E().Ay.state,audioRecorder:void 0,enabled:!1,loading:!1,rootBlock:void 0,block:void 0,lastReceivedTranscriptionAt:void 0}),null==d||d.destroy(s),s&&i().log({level:"error",from:"dictationActions",type:"dictationError",error:(0,c().convertErrorToLog)(s),data:{miscDataToConvertToString:{dictation_session_id:l,block_id:(null==t?void 0:t.id)??""}}});try{if(s instanceof x().XG?((0,k().rP)(r,{type:"throttle",dictation_session_id:l}),(0,j().e5)()):s instanceof x().eY?((0,k().rP)(r,{type:"missing_user_or_space",dictation_session_id:l,reason:s.message}),(0,j().op)()):s instanceof x().d1?(0,k().rP)(r,{type:"mic_permissions",dictation_session_id:l,reason:P().Ay.state.audio}):s instanceof x().Rv?((0,k().rP)(r,{type:"forbidden",dictation_session_id:l}),(0,j().op)()):(s instanceof x().E6||s instanceof Error)&&(0,j().op)(),s){const e=(0,n(416845).USz)(s)&&s.retryable&&r&&(null==t?void 0:t.isTranscriptionBlock());r&&(0,n(725081).sendNotificationForDictationInterrupted)(r,t,e)}await(0,g().Ep)(r)}catch(o){}finally{Q.stop();const o=E().Ay.state.audioSessionBlockWriters;let i=!1;for(const e of o.values())e.writeToBlock(!0),o.delete(e.getId()),i=!0;i&&E().Ay.emit(),u&&(0,k().Im)(r,{dictation_session_id:l,block_id:(null==t?void 0:t.id)??""}),null!=t&&t.isTranscriptionBlock()&&e.environment&&n(991526).transcriptionBlockActions.ensureTranscriptionIsInActive({environment:e.environment,blockStore:t,from:e.from})}}}}async function G(e){return V.smartToggleDictation(e)}async function J(e){return V.startDictation(e)}async function Y(e){const{environment:t,error:n,from:o}=e;return V.stopDictation({environment:t,error:n,from:o})}async function Z(e){const t=A().default.state.currentSpaceStore;if(!t)return;const n={};for(const i of e){var o;const e=i.pointer,r=w().B.createChildStore(t,e);if(await r.load(),!r.isTranscriptionBlock()||r.id===(null===(o=E().Ay.state.rootBlock)||void 0===o?void 0:o.id))continue;const s=(0,R().y1)(r,"transcript");if(!s)continue;await s.load();const a=s.getContentStores().at(-1);a&&(await a.load(),n[e.id]={rootBlockStore:r,dictatingBlockStore:a})}E().Ay.setState({...E().Ay.state,passiveBlockMap:{...E().Ay.state.passiveBlockMap,...n}})}V.startController=void 0,V.audioBuffer=new Float32Array,V.audioEncoderQueue=new(s().O)(1);class Q{constructor(){if(Q.instance)return Q.instance;Q.instance=this}static start(){q({type:"start",ts:new Date}),this.listening||(this.listening=!0,g().$I.on(g().Ux,Q.processTranscriptionResult),g().$I.on(g().L6,Q.processVadEvent),g().$I.on(g().bH,Q.processRateLimitEvent),g().$I.on(g().zz,Q.processForbiddenEvent),g().$I.on(g().ZQ,Q.processOpenAIErrorEvent))}static stop(){q({type:"end",ts:new Date}),this.listening&&(this.listening=!1,g().$I.off(g().Ux,Q.processTranscriptionResult),g().$I.off(g().L6,Q.processVadEvent),g().$I.off(g().bH,Q.processRateLimitEvent),g().$I.off(g().zz,Q.processForbiddenEvent),g().$I.off(g().ZQ,Q.processOpenAIErrorEvent))}static processOpenAIErrorEvent(e){if(429===e.status){var t;const{environment:n}=E().Ay.state;Y({environment:n,error:new(x().E6)(e.message,e.status),from:"transcription_error"}),i().log({level:"error",from:"dictationActions",type:"openAIError",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=E().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}}static processForbiddenEvent(e){var t;const{environment:n}=E().Ay.state;Y({environment:n,error:new(x().Rv)("Not eligible for dictation"),from:"forbidden"}),i().log({level:"error",from:"dictationActions",type:"forbidden",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=E().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processRateLimitEvent(e){var t;const{environment:n}=E().Ay.state;Y({environment:n,error:new(x().XG)("Audio usage limit reached"),from:"rate_limit"}),i().log({level:"error",from:"dictationActions",type:"rateLimit",error:(0,c().convertErrorToLog)(e),data:{miscDataToConvertToString:{rootBlockId:null===(t=E().Ay.state.rootBlock)||void 0===t?void 0:t.id}}})}static processVadEvent(e){E().Ay.setState({...E().Ay.state,talking:e.talking})}static updateDictationBlock(e){E().Ay.setState({...E().Ay.state,block:e})}static processTranscriptionResult(e){const{audioSessionId:t,segmentId:o,isSegmentComplete:i,isAudioSessionComplete:r}=e,{enabled:s,rootBlock:a,audioSessionBlockWriters:c,environment:l,block:d}=E().Ay.state;"complete"===e.transcription.status&&null!=a&&a.isTranscriptionBlock()&&l&&(0,n(2220).u)({environment:l,event:{eventName:"meeting_note_transcription_received",eventProperties:{block_id:a.id,audio_duration:e.transcription.audioDuration,text_length:e.transcription.text.length}}});let u=!1;if(!c.has(t)&&l&&s){const e=a?H(l,a,d):void 0;if(e){const n=new U({id:t,env:l,blockStore:e,onUpdateBlock:e=>{t===E().Ay.state.latestSessionId&&Q.updateDictationBlock(e)}});c.set(t,n),u=!0,E().Ay.setState({...E().Ay.state,block:e,latestSessionId:t})}else Y({environment:l,from:"block_not_available"})}const p=c.get(t);if(p){p.setIsCompleteReceived(r);const t=p.getOrCreateSegment(o);t.setIsCompleteReceived(i),t.setTranscription(e.transcription.id,e.transcription)}for(const n of c.values())n.writeToBlock();for(const n of[...c.values()].filter((e=>e.isSettled())))c.delete(n.getId()),u=!0,s&&l&&a&&E().Ay.state.latestSessionId===n.getId()&&E().Ay.setState({...E().Ay.state,block:H(l,a,E().Ay.state.block)});s&&E().Ay.setState({...E().Ay.state,lastReceivedTranscriptionAt:Date.now()}),u&&E().Ay.emit()}}Q.instance=void 0,Q.listening=!1;class X{static getAllProcessableFramesAsBase64(e){const t=16*Math.max(1,e),n=Math.floor(this.audioBuffer.length/t);if(n>0){const e=n*t,o=this.audioBuffer.slice(0,e);return this.audioBuffer=this.audioBuffer.slice(e),this.audioEncoderQueue.enqueue((()=>K([o])))}return Promise.resolve(!1)}static async start(e){try{await this.stop(),this.startController=new AbortController,this.env=e.environment,this.isActive=!0,this.currentTranscript="",this.segments.clear(),this.transcriptionListener=e.onTranscription,this.onErrorListener=e.onError,this.streamingSessionId=(0,v().qY)(),this.audioRecorder=new(T().Nr)({onDataReceived:t=>{this.audioBuffer=new Float32Array([...this.audioBuffer,...t]),this.getAllProcessableFramesAsBase64(96).then((t=>{if(t){const n=(0,L().$q)((0,L().FT)(e.environment.currentUser.id));(0,v().$g)({base64Audio:t,environment:e.environment,language:n}).catch((()=>{}))}})).catch((()=>{}))},onStop:e=>{X.stop()},includeSystemAudio:!1}),await this.audioRecorder.start(),g().$I.on(g().Ux,this.handleTranscriptionEvent)}catch(t){this.onErrorListener&&t instanceof Error&&this.onErrorListener(t),this.stop()}}static async stop(){if(this.isActive){var e;this.isActive=!1,this.startController&&!this.startController.signal.aborted&&this.startController.abort(),g().$I.off(g().Ux,this.handleTranscriptionEvent),null===(e=this.audioRecorder)||void 0===e||e.destroy();try{await(0,g().Ep)(this.env)}catch{}this.audioRecorder=void 0,this.streamingSessionId=void 0,this.env=void 0}}}D=X,X.startController=void 0,X.env=void 0,X.audioBuffer=new Float32Array,X.audioEncoderQueue=new(s().O)(1),X.audioRecorder=void 0,X.streamingSessionId=void 0,X.isActive=!1,X.transcriptionListener=void 0,X.onErrorListener=void 0,X.segments=new Map,X.currentTranscript="",X.handleTranscriptionEvent=e=>{var t;const n=e.segmentId;let o=D.segments.get(n);o||(o=new _(n),D.segments.set(n,o)),o.setIsCompleteReceived(e.isSegmentComplete),o.setTranscription(e.transcription.id,e.transcription);const i=W(Array.from(D.segments.values()));D.currentTranscript=i,null===(t=D.transcriptionListener)||void 0===t||t.call(D,D.currentTranscript)}},784749:(e,t,n)=>{n.d(t,{J:()=>w,w:()=>k});n(581454);var o=n(296540),i=()=>n(484714),r=()=>n(847249),s=()=>n(401497),a=()=>n(742117),c=()=>n(133033),l=()=>n(284371),d=()=>n(493823),u=()=>n(760217),p=()=>n(406699),m=()=>n(939740),f=()=>n(89924),v=()=>n(614415),g=()=>n(645873),h=()=>n(426175),S=()=>n(524007),y=()=>n(632503),b=()=>n(577579),A=n(474848);function w(e){const{languagePopupStore:t}=e,n=(0,i().v3)(),u=(0,r().K8)((()=>(0,y().FT)(n.currentUser.id)),[n.currentUser.id]);(0,o.useEffect)((()=>{h().Ay.updateMediaDevices()}),[]);const m=(0,s().IS)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:l().Wy.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),f=(0,o.useMemo)((()=>(0,a().V)(m.rightChevronStyle)),[m.rightChevronStyle]),S=(0,o.useMemo)((()=>(0,c().$)(m.helpIcon)),[m.helpIcon]),{value:w}=(0,g().fJ)(v().fM);if(!w)return null;const{motion:_}=w;return(0,A.jsxs)("div",{style:m.container,children:[(0,A.jsxs)("div",{style:m.microphoneSection,children:[(0,A.jsx)("div",{style:m.microphoneText,children:"Microphone"}),(0,A.jsx)(k,{})]}),(0,A.jsx)("div",{style:m.line}),(0,A.jsxs)("div",{style:m.languageSection,children:[(0,A.jsx)("div",{style:m.languageText,children:"Language"}),(0,A.jsx)(p().Ay,{buttonPopupStore:t,renderOrigin:e=>(0,A.jsxs)(d().p,{style:m.languageButtonStyle,...e,children:[u," ",f]}),stopClickPropagation:!0,popupType:p().z7.Popup,render:e=>(0,A.jsx)(b().Z,{parent:e})})]}),(0,A.jsx)("div",{style:m.line}),(0,A.jsxs)(_.div,{style:m.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[S,(0,A.jsx)("div",{style:m.helpText,children:"Learn about Dictation"})]})]})}function k(){const e=(0,r().O$)(h().X8),t=(0,r().O$)(h().dc),n=(0,r().K8)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),o=[{key:"devices",render:e=>(0,A.jsx)(f().A,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,A.jsx)(u().A,{...n,title:e.label,isChecked:e.deviceId===(null==t?void 0:t.deviceId)}),action:()=>{S().A.setState(e)}})))}];return(0,A.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,A.jsx)(m().Ay,{type:m().Oh.Vertical,initialFocus:n,sections:o})})}},799384:(e,t,n)=>{n.d(t,{o:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("newSidebarSearch",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 8.75C4 6.12665 6.12665 4 8.75 4C11.3734 4 13.5 6.12665 13.5 8.75C13.5 11.3734 11.3734 13.5 8.75 13.5C6.12665 13.5 4 11.3734 4 8.75ZM8.75 2.5C5.29822 2.5 2.5 5.29822 2.5 8.75C2.5 12.2018 5.29822 15 8.75 15C10.2056 15 11.545 14.5024 12.6073 13.668L16.7197 17.7803C17.0126 18.0732 17.4874 18.0732 17.7803 17.7803C18.0732 17.4874 18.0732 17.0126 17.7803 16.7197L13.668 12.6073C14.5024 11.545 15 10.2056 15 8.75C15 5.29822 12.2018 2.5 8.75 2.5Z"})})},805952:(e,t,n)=>{n.d(t,{Cu:()=>i,hX:()=>l});n(581454);var o=()=>n(638681);const i={English:["English","en"],Chinese:["Chinese","zh"],Spanish:["Spanish","es"],French:["French","fr"],German:["German","de"],Japanese:["Japanese","ja"],Korean:["Korean","ko"],Portuguese:["Portuguese","pt"],Russian:["Russian","ru"],Thai:["Thai","th"],Vietnamese:["Vietnamese","vi"],Danish:["Danish","da"],Finnish:["Finnish","fi"],Norwegian:["Norwegian","no"],Dutch:["Dutch","nl"],Swedish:["Swedish","sv"]},r=o().union([o().number(),o().string(),o().boolean(),o().isNull(),o().array(o().string())]),s=o().undefinable(r),a=(o().union([r,o().record(o().string(),r)]),o().union([s,o().record(o().string(),s)])),c=(o().union([a,o().record(o().string(),a)]),o().union([o().object({required:{id:o().string(),status:o().literal("pending"),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("complete"),text:o().string(),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("error"),reason:o().string(),audioDuration:o().number()},optional:{}}),o().object({required:{id:o().string(),status:o().literal("ignore"),audioDuration:o().number()},optional:{}})])),l=o().union([o().object({required:{type:o().literal("transcription"),audioSessionId:o().string(),segmentId:o().string(),transcription:c,isSegmentComplete:o().boolean(),isAudioSessionComplete:o().boolean()},optional:{}}),o().object({required:{type:o().literal("response"),status:o().literals("ok","error"),requestId:o().string(),result:o().any()},optional:{}}),o().object({required:{type:o().literal("vad"),talking:o().boolean()},optional:{}}),o().object({required:{type:o().literal("rate_limited"),status:o().literal(429),name:o().literal("UserRateLimitResponse"),message:o().string()},optional:{}}),o().object({required:{type:o().literal("forbidden"),status:o().literal(403),name:o().literal("ForbiddenError"),message:o().string()},optional:{}}),o().object({required:{type:o().literal("openai_error"),message:o().string()},optional:{status:o().number()}})]);o().object({required:{base64Audio:o().string(),userId:o().string(),spaceId:o().string()},optional:{language:o().literals(...Object.values(i).map((e=>{let[t,n]=e;return n})))}}),o().object({required:{},optional:{}}),o().object({required:{userId:o().string(),spaceId:o().string()},optional:{language:o().literals(...Object.values(i).map((e=>{let[t,n]=e;return n})))}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}}),o().object({required:{},optional:{}})},824160:(e,t,n)=>{n.d(t,{A:()=>a});n(296540);var o=()=>n(484714),i=()=>n(401497),r=()=>n(704152),s=n(474848);function a(e){const t=(0,o().Y0)(),n=(0,i().IS)((e=>({sharedStyle:{display:"flex",alignItems:"center",borderRadius:4},innerStyle:{padding:"2px 6px",borderRadius:4,color:e.text.secondary,background:e.defaultBadgeBackground,fontSize:t.isMobile?11:9,lineHeight:t.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",whiteSpace:"nowrap"}})),[t.isAndroid,t.isMobile]);return t.isMobile?(0,s.jsx)(r().A,{style:{...n.sharedStyle,...e.mobileStyle},disabled:void 0===e.onClick,children:(0,s.jsx)("div",{style:{...n.innerStyle,...e.innerStyle},children:e.children})}):(0,s.jsx)(r().A,{style:{...n.sharedStyle,...e.desktopStyle},disabled:void 0===e.onClick,...e,children:(0,s.jsx)("div",{style:{...n.innerStyle,...e.innerStyle},children:e.children})})}},863330:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>o,plusSmallIcon:()=>i});n(296540);const o={viewBox:"0 0 16 16",svg:(0,n(474848).jsx)("path",{d:"M8 2.3a.7.7 0 0 0-.7.7v4.3H3a.7.7 0 1 0 0 1.4h4.3V13a.7.7 0 1 0 1.4 0V8.7H13a.7.7 0 1 0 0-1.4H8.7V3a.7.7 0 0 0-.7-.7"})},i=(0,n(340498).wt)("plusSmall",o)},888325:(e,t,n)=>{function o(e){return`${e.table}:${e.id}`}n.d(t,{_:()=>o})},916096:(e,t,n)=>{n.d(t,{ke:()=>q,Ay:()=>O,aQ:()=>U});var o=n(296540),i=()=>n(484714),r=()=>n(847249),s=()=>n(401497),a=()=>n(79275),c=()=>n(959013),l=()=>n(35392),d=()=>n(296798),u=()=>n(859428),p=()=>n(490044),m=()=>n(694874),f=()=>n(696746),v=(n(898992),n(354520),n(672577),n(803949),n(581454),()=>n(187174)),g=()=>n(921997),h=()=>n(519831),S=()=>n(763824),y=()=>n(449506),b=()=>n(941541),A=()=>n(351360),w=()=>n(630116),k=()=>n(634157),_=()=>n(578136);const x=new(n(299919).Y)((e=>new T(e)));class T extends(()=>n(757695))().default{constructor(e){super(),this.collectionStore=void 0,this.debouncedRefresh=void 0,this.collectionStore=e,this.debouncedRefresh=(0,n(496603).sg)(this.unthrottledRefresh.bind(this),2e3)}getInitialState(){return{createdTime:-1/0,createdById:void 0}}getLatestPostCreatedTime(){return this.state.createdTime}getLatestPostCreatedById(){return this.state.createdById}async refresh(e){return this.debouncedRefresh(e)}async unthrottledRefresh(e){const{environment:t}=e;if(!t.currentUser.id)return;if(await this.collectionStore.load(),!this.collectionStore.isDefined())return;const n=await y().callApi({eventName:"getLatestPostCreated",environment:t,data:{spaceId:this.collectionStore.getSpaceId(),collectionIds:[this.collectionStore.id]}});if("success"===n.type&&n.data){const e=n.data[0];this.setState(e)}}}function I(e){const t=(0,i().v3)(),n=(0,r().K8)((()=>{var t;return null==e||null===(t=e[0])||void 0===t?void 0:t.getSpaceId()}),[e]),s=(0,o.useMemo)((()=>e.filter((e=>!x.has(e)))),[e]);(0,v().Yb)((async()=>{await async function(e){const{environment:t,collectionStores:n}=e,o=await S().dS(n,10,(async e=>(await e.load(),e.isDefined())));if(0===o.length)return;const i=o[0].getSpaceId(),r=await y().callApi({eventName:"getLatestPostCreated",environment:t,data:{spaceId:i,collectionIds:o.map((e=>e.id))}});if("success"===r.type&&r.data)for(let s=0;s<o.length;s++){const e=o[s],t=r.data[s];t.collectionId===e.id&&x.get(e).setState(t)}}({environment:t,collectionStores:s})}),[s,t]);const a=(0,o.useMemo)((()=>e.map((e=>x.get(e)))),[e]);return(0,o.useEffect)((()=>{if(!n)return;const e=a.map((e=>b().Ay.addListener((0,g().eG)(e.collectionStore.id),void 0,(0,b().AY)((async()=>await e.refresh({environment:t}))),void 0,t)));return()=>{e.forEach((e=>{e&&b().Ay.removeListener(e,t)}))}}),[a,n,t]),a}var C=()=>n(962730),B=()=>n(551694),M=()=>n(487941),D=()=>n(846955),R=()=>n(644914),j=()=>n(645873);const P={LazyAiLandingPageExperimentSwitcher:new(j().O2)("LazyAiLandingPageExperimentSwitcher",(()=>n.e(66169).then(n.bind(n,981440))))},E=(0,j()._h)(P.LazyAiLandingPageExperimentSwitcher,(e=>e.AiLandingPageExperimentSwitcher));var L=n(474848);function N(e){const{styles:t}=e,v=(0,i().v3)(),g=(0,c().tz)(),S=(0,r().K8)((()=>{const{currentSpaceViewStore:e}=A().default.state;if(e)return f().x$(e)}),[]),y=(0,r().K8)((()=>{const e=A().default.state.mainEditorCurrentBlockStore;return!!e&&f().Nh(e.id)}),[]),b=(0,r().K8)((()=>"home_available"===D().default.getState().type),[]),x=(0,r().K8)((()=>{var e;return null==S||null===(e=S.getModel())||void 0===e?void 0:e.getRenderUrl({getRecordModel:null==S?void 0:S.getRecordModel,pageVisitSource:n(584262).y8.SidebarHome})}),[S]),T=function(){const e=(0,i().v3)(),t=(0,r().K8)((()=>(0,_().D)({isMobileNative:e.device.isMobileNative,disableExposureLogging:!0})),[e]),n=(0,r().K8)((()=>{var e;return null===(e=A().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),o=I((0,r().K8)((()=>{if(!t)return[];const e=A().default.state.currentSpaceStore;return n&&e?k().A.getJoinedTeamStores({userId:n,spaceStore:e}).map((t=>w().md.createChildStore(t,{table:h().Vl,id:t.id,spaceId:e.id}))):[]}),[t,n]));return(0,r().K8)((()=>{var e;if(!A().default.state.currentSpaceStore)return!1;const t=(null===(e=A().default.state.currentSpaceViewStore)||void 0===e?void 0:e.getKeyStore("settings").getKeyStore("last_opened_aggregated_feed").getValue())??0;return o.find((e=>!(!e.getLatestPostCreatedById()||e.getLatestPostCreatedTime()<=t||e.getLatestPostCreatedById()===n)))}),[o,n])}(),B=(0,n(327300).w4)(),j=(0,r().O$)(n(430483).ts),[P,N]=(0,o.useState)(!1),[q,O]=(0,o.useState)(!1),$=(0,o.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,n(819121).p)(t)&&O(!0)}),[]),z=(0,o.useCallback)((()=>{O(!1)}),[]),W=(0,o.useCallback)((()=>{n(353643).A.state.isDragging||N(!0)}),[]),K=(0,o.useCallback)((()=>{N(!1)}),[]),H=(0,r().uB)(void 0,M().A),V=(0,r().uB)(void 0,M().A),G=(0,r().K8)((()=>V.state.focused||V.state.hovered),[V]),J=(0,o.useCallback)((()=>{(0,m().Wy)(v),(0,n(162674).ZL)({environment:v,from:"sidebar"}),b&&(0,m().tL)(v),n(441199).default.isVisible()&&(0,n(770906).VI)({environment:v})}),[v,b]),Y=(0,R().ab)(),Z=(0,s().IS)((e=>({tooltip:{width:200},leftContainer:{position:"relative"},shortcutLabel:{color:e.text.contrastSecondary},linkBoxStyle:{...Y.baseSidebarItem,...y&&Y.currentSelectedSidebarItem},homeIconStyle:{...Y.topButtonIcon,...y&&Y.currentSelectedSidebarIcon}})),[y,Y]),Q=(0,o.useMemo)((()=>B.showAiFaceInHomeIcon?j?(0,n(366295).L)(Y.topButtonIcon):(0,n(654601).X)({width:16}):(0,a().X)(Z.homeIconStyle)),[B.showAiFaceInHomeIcon,j,Z.homeIconStyle,Y.topButtonIcon]),X=(0,o.useCallback)((()=>G?"":(0,L.jsxs)("div",{style:Z.tooltip,children:[(0,L.jsx)("div",{children:g.formatMessage(U.tooltip)}),(0,L.jsx)(l().A,{style:Z.shortcutLabel,name:"openHome"})]})),[G,g,Z.shortcutLabel,Z.tooltip]);return(0,L.jsx)(u().A,{store:H,renderTooltip:X,disableTooltip:b,originGap:6,textWrap:!0,placement:C().W.Right,render:e=>(0,L.jsx)(d().A,{...e,style:Z.linkBoxStyle,hoveredStyle:null==t?void 0:t.buttonHoveredStyle,href:x,onClick:J,"aria-current":y?"page":void 0,children:(0,L.jsx)(p().A,{left:(0,L.jsxs)("div",{style:Z.leftContainer,children:[Q,T&&(0,L.jsx)(F,{})]}),disableMobileBorder:!0,right:(0,L.jsx)(E,{isHovered:P,isFocused:q,tooltipStore:V,parentTooltipStore:H}),onMouseMove:W,onMouseLeave:K,onFocus:$,onBlur:z,children:g.formatMessage(U.label)})})})}function q(e){const{styles:t}=e,n=(0,r().K8)((()=>"home_available"===D().default.getState().type),[]),o=(0,R().ab)(),i=(0,s().IS)((e=>({tooltip:{width:200},shortcutLabel:{color:e.text.contrastSecondary}})),[]);return(0,L.jsx)(u().A,{renderTooltip:()=>(0,L.jsxs)("div",{style:i.tooltip,children:[(0,L.jsx)("div",{children:(0,L.jsx)(c().sA,{id:"sidebarPersonalHomeButton.tooltip",defaultMessage:"View recent pages and more"})}),(0,L.jsx)(l().A,{style:i.shortcutLabel,name:"openHome"})]}),disableTooltip:n,originGap:6,textWrap:!0,placement:C().W.Right,render:e=>(0,L.jsx)(d().A,{...e,style:o.baseSidebarItem,hoveredStyle:null==t?void 0:t.buttonHoveredStyle,onClick:()=>{B().A.open()},children:(0,L.jsx)(p().A,{left:(0,a().X)(o.topButtonIcon),disableMobileBorder:!0,children:(0,L.jsx)(c().sA,{id:"sidebarPersonalHomeButton.label",defaultMessage:"Home"})})})})}function F(e){const{top:t=0,right:n=-3}=e,o=(0,s().IS)((e=>({unreadBadge:{backgroundColor:e.redBadgeBackground,position:"absolute",top:t,right:n,width:8,height:8,borderRadius:4,border:`1px solid ${e.surface.wash}`}})),[t,n]);return(0,L.jsx)("div",{style:o.unreadBadge})}const U=(0,c().YK)({tooltip:{id:"sidebarPersonalHomeButton.tooltip",defaultMessage:"View recent pages and more"},label:{id:"sidebarPersonalHomeButton.label",defaultMessage:"Home"}}),O=o.memo(N)},926329:(e,t,n)=>{n.d(t,{b:()=>i});n(296540);var o=n(474848);const i=(0,n(340498).wt)("templates",{viewBox:"0 0 20 20",svg:(0,o.jsxs)("g",{children:[(0,o.jsx)("path",{d:"M6.39733 5.67853C5.89764 5.50234 5.36002 5.40649 4.8 5.40649C2.14904 5.40649 0 7.55432 0 10.2038C0 12.8533 2.14904 15.0011 4.8 15.0011C6.52165 15.0011 8.0316 14.0952 8.87867 12.7343L5.26487 12.0975L6.39733 5.67853Z"}),(0,o.jsx)("path",{d:"M17.3126 3.66609L7.85843 2L6.19141 11.4489L10.6545 12.2354L14.3998 5.81854L16.3449 9.15116L17.3126 3.66609Z"}),(0,o.jsx)("path",{d:"M8.80078 17L14.4008 7.4054L20.0008 17H8.80078Z"})]})})},991526:(e,t,n)=>{n.r(t),n.d(t,{DictationAvatar:()=>L,DictationBubble:()=>K,StopDictationButton:()=>re,StopDictationButtonMobile:()=>me,StopDictationListener:()=>Ae,TranscriptionSetupModal:()=>De,activeTranscriptionHelpers:()=>a(),audioProcessDetectionActions:()=>s(),dictationActions:()=>i(),hooks:()=>y(),idleTranscriptionActions:()=>o,transcriptionBlockActions:()=>r(),transcriptionNewPageActions:()=>c()});var o={};n.r(o),n.d(o,{showIdleTranscriptionToast:()=>S});var i=()=>n(749514),r=()=>n(271380),s=()=>n(725081),a=()=>n(911063),c=()=>n(391532),l=()=>n(284611),d=()=>n(100622),u=()=>n(812182),p=()=>n(989423),m=()=>n(972435),f=()=>n(351360),v=()=>n(630116),g=()=>n(540144),h=()=>n(432142);function S(e,t){const{pointer:n}=t,o=f().AppStoreCurrentSpaceStore.state;if(!o)return;const i=v().Bv.createChildStore(o,n);null!=i&&i.isTranscriptionBlock()&&"transcribing"===(0,g().by)(i).state&&((0,p().u4)({environment:e,event:{eventName:"idle_transcription_toast_shown",eventProperties:{block_id:i.id}}}),u().Iz({id:"transcription_idle_notification",icon:()=>(0,l().b)({color:d().Ay.invertedTextColor,height:16,width:16}),presentationType:"persistent",title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.title",defaultMessage:"Still there?"}),message:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.message",defaultMessage:"Notion AI is recording your audio but hasn't heard from you in a while."}),onDismiss:()=>{(0,p().u4)({environment:e,event:{eventName:"idle_transcription_toast_dismissed",eventProperties:{block_id:i.id}}})},actions:{primary:{title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.stop",defaultMessage:"Stop"}),onAction:()=>{(0,h().q)({environment:e,blockStore:i}),(0,r().stopTranscription)({environment:e,blockStore:i,from:"transcription_idle_notification"}),u().UW("transcription_idle_notification"),(0,p().u4)({environment:e,event:{eventName:"idle_transcription_toast_stop_button_clicked",eventProperties:{block_id:i.id}}})}},secondary:{title:m().A.getIntl().formatMessage({id:"idleTranscriptionToast.action.goToBlock",defaultMessage:"Go to meeting note"}),onAction:()=>{u().UW("transcription_idle_notification"),(0,h().q)({environment:e,blockStore:i}),(0,p().u4)({environment:e,event:{eventName:"idle_transcription_toast_navigation_button_clicked",eventProperties:{block_id:i.id}}})}}}}))}var y=()=>n(673657),b=(n(581454),n(296540)),A=()=>n(847249),w=()=>n(496603),k=()=>n(614415),_=()=>n(645873),x=()=>n(964345),T=()=>n(484714),I=()=>n(401497),C=()=>n(959013),B=()=>n(620689),M=()=>n(783793),D=()=>n(704152),R=()=>n(859428),j=()=>n(126126),P=n(474848);const E=18;function L(e){let{enableClickToScroll:t=!1,rootStore:n,noMarginRight:o=!1,noOutline:i=!1,noTooltip:r=!1}=e;const s=(0,y().useIsDictatingToPage)(n),a=(0,T().v3)(),c=(0,b.useCallback)((e=>e.UIUserAvatarSelfBorder),[]),l=(0,j().XE)(c,!0),d=(0,I().IS)((e=>({tooltip:{color:e.text.contrastSecondary,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},avatarContainer:{width:E,height:E,borderRadius:E,backgroundColor:e.assistantCornerButtonBackground,display:"flex",alignItems:"center",justifyContent:"center"}})),[]),u=(0,A().K8)((()=>x().b.state),[]);return!s&&n?null:(0,P.jsx)(R().A,{textWrap:!0,disableTooltip:r,renderTooltip:()=>(0,P.jsxs)("div",{children:[(0,P.jsx)("div",{children:(0,P.jsx)(C().sA,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,P.jsx)("div",{style:d.tooltip,children:(0,P.jsx)(C().sA,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const n=(0,P.jsx)("div",{style:{...l.avatarOuterOutline,...i?{outline:"none"}:{},...o?{marginRight:0}:{},width:E,height:E},children:(0,P.jsx)("div",{style:{...l.avatarBorder,...d.avatarContainer},children:(0,P.jsx)(M().o,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"})})});return t&&u?(0,P.jsx)(D().A,{...e,onClick:()=>B().BL([u],!0,a),style:l.button,hoveredStyle:l.buttonHovered,pressedStyle:l.buttonPressed,children:n}):(0,P.jsx)("div",{...e,style:{cursor:"default"},children:n})}})}n(944114),n(898992),n(803949);var N=()=>n(534177),q=()=>n(171333),F=()=>n(141333);function U(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(U(e))})),t}function O(e){let{scrollerStore:t,blockId:n,children:o,framerMotion:i}=e;const r=(0,A().K8)((()=>t.state.elementRef??{current:null}),[t]),s=(0,F().yE)(r),[a,c]=(0,b.useState)(),[l,d]=(0,b.useState)(),u=(0,q().lB)(t),p=(0,q().ht)(t),m=null==u?void 0:u.getNode(),f=null==m?void 0:m.querySelector(".notion-page-content"),v=null==f?void 0:f.querySelector(`[data-block-id="${n}"]`);(0,b.useEffect)((()=>{if(f){let e;const t=new MutationObserver((t=>{(0,N().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(f,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,N().O9)(e)&&cancelAnimationFrame(e)}}}),[f]),(0,b.useEffect)((()=>{if(m){let e;const t=new ResizeObserver((()=>{(0,N().O9)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(m),()=>{t.disconnect(),(0,N().O9)(e)&&cancelAnimationFrame(e)}}}),[m]),(0,b.useLayoutEffect)((()=>{if(!v||!m){const e=setTimeout((()=>{d(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=v.querySelector('[data-content-editable-leaf="true"]')??v,n=U(t),o=m.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const i=e.getBoundingClientRect(),r=i.top+s-o.top,a=i.right-o.left+5;d({top:r,left:a})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),i=parseInt(n.paddingTop,10),r=isNaN(i)?0:i,a=parseInt(n.paddingBottom,10),c=isNaN(a)?0:a,l=parseInt(n.paddingRight,10),u=isNaN(l)?0:l,p=e.top+r+c+s-o.top,m=e.left-o.left+u;d({top:p,left:m})}}}),[v,m,a,s]);const g=(0,N().O9)(l);(0,b.useEffect)((()=>{if(p&&g)switch(p){case"Page":return x().Ay.setState({...x().Ay.state,blockRenderedInPage:!0}),()=>{x().Ay.setState({...x().Ay.state,blockRenderedInPage:!1})};case"PeekView":return x().Ay.setState({...x().Ay.state,blockRenderedInPeekView:!0}),()=>{x().Ay.setState({...x().Ay.state,blockRenderedInPeekView:!1})}}}),[p,g]);const h=(0,b.useRef)(null),{motion:S}=i;return l?(0,P.jsx)(S.div,{ref:h,initial:{transform:`translate(${l.left}px, ${l.top}px)`},animate:{transform:`translate(${l.left}px, ${l.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:112},children:o}):null}function $(e){const{value:t}=(0,_().fJ)(k().fM);return t?(0,P.jsx)(O,{...e,framerMotion:t}):null}function z(e){const{framerMotion:t}=e,{motion:n}=t,o=(0,k().sM)(t);(0,b.useEffect)((()=>{(async()=>{await o.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[o]);const i=(0,I().IS)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,P.jsx)(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((e,t)=>(0,P.jsx)(n.div,{custom:t,animate:o,style:i.dotStyle},t)))})}function W(){const{value:e}=(0,_().fJ)(k().fM);return e?(0,P.jsx)(z,{framerMotion:e}):null}function K(e){let{scrollerStore:t}=e;const n=(0,A().K8)((()=>{const e=x().Ay.state.block&&x().Ay.state.rootBlock?[{type:"active",rootBlockId:x().Ay.state.rootBlock.id,id:x().Ay.state.block.id}]:[],t=Object.values(x().Ay.state.passiveBlockMap).map((e=>{let{dictatingBlockStore:t,rootBlockStore:n}=e;return{type:"passive",rootBlockId:n.id,id:t.id}}));return w().hS([...e,...t],"id")}),[]),o=(0,A().O$)(x().Gq),{value:i}=(0,_().fJ)(k().fM);if(!i)return null;const{AnimatePresence:r}=i;return(0,P.jsx)(P.Fragment,{children:n.map((e=>(0,P.jsx)($,{blockId:e.id,scrollerStore:t,children:(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,P.jsx)(L,{noMarginRight:!0,noOutline:!0,noTooltip:!0}),(0,P.jsx)(r,{children:o&&(0,P.jsx)(W,{})})]})},e.rootBlockId)))})}var H=n(440961),V=()=>n(883234),G=()=>n(197190),J=()=>n(406699),Y=()=>n(745766),Z=()=>n(592678),Q=()=>n(463830),X=()=>n(948914),ee=()=>n(712505),te=()=>n(405689),ne=()=>n(784749);const oe=document.body;function ie(e){let{rootStore:t,framerMotion:n}=e;const o=(0,T().WS)(),r=(0,y().useIsDictatingToPage)(t),s=(0,T().v3)(),a=(0,A().K8)((()=>x().Ay.state.audioRecorder),[]),c=(0,A().uB)(void 0,Q().A),l=(0,A().uB)(void 0,Q().A),d=(0,A().O$)(X().b),u=(0,b.useCallback)((()=>{(0,i().stopDictation)({environment:s,from:"button"})}),[s]),p=(0,b.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,Z().Vt)(e)||(l.state.open?l.reset():c.state.open?c.reset():c.setState({...c.state,open:!0}))}),[c,l]),m=(0,A().K8)((()=>"dark"===s.ThemeStore.state.mode),[s]),[f,v]=(0,b.useState)(!1),g=(0,b.useCallback)((()=>{v(!0)}),[]),h=(0,b.useCallback)((()=>{v(!1)}),[]),[S,w]=(0,b.useState)(!1),k=(0,b.useCallback)((()=>{w(!0)}),[]),_=(0,b.useCallback)((()=>{w(!1)}),[]),C=(0,I().IS)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:m?"#2D2D2D":"#F1F0EF",...(0,Y().g)({noDrag:s.device.isElectron&&!d})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:S?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:f?m?e.accentColors.red[500]:"rgba(191, 67, 64, 1)":m?e.accentColors.red[700]:e.accentColors.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[m,s.device.isElectron,d,S,f]),B=(0,b.useMemo)((()=>(0,V()._)(C.downIcon)),[C.downIcon]),M=(0,A().K8)((()=>{var e;return ee().default.isCenterPeekOpen()&&(null===(e=ee().default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),D=(0,b.useRef)(null),[R,E]=(0,b.useState)(null);(0,b.useEffect)((()=>{if(!D.current)return void E(null);const e=D.current.getBoundingClientRect();E({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[M]);const L=(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(G().A,{style:C.redSquareContainer,onClick:u,onMouseEnter:g,onMouseLeave:h,children:(0,P.jsx)("div",{style:C.redSquare})}),(0,P.jsx)(te().t,{}),(0,P.jsx)(G().A,{className:"notion-dictation-button-up-chevron",style:C.downChevronContainer,onClick:p,onMouseEnter:k,onMouseLeave:_,children:B})]}),N=(0,j().Uo)({environment:s,isShowingTabBar:d,isShowingInPostFeed:!1}),{motion:q}=n;return r&&a&&!o?(0,P.jsx)("div",{style:{marginLeft:N.marginLeft,marginTop:N.marginTop,marginRight:.5*Number(N.marginLeft)*-1},children:(0,P.jsx)(J().Ay,{buttonPopupStore:c,renderOrigin:()=>(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(q.div,{ref:D,className:"notion-dictation-button",style:C.dictationButtonStyle,onClick:u,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:L}),M&&(0,H.createPortal)((0,P.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...C.dictationButtonStyle,position:"fixed",top:(null==R?void 0:R.top)||0,left:(null==R?void 0:R.left)||0,zIndex:1e7},onClick:u,children:L}),oe)]}),stopClickPropagation:!0,popupType:s.device.isMobile?J().z7.SlideUp:J().z7.Popup,popupWrapStyle:{top:6},render:()=>(0,P.jsx)(ne().J,{languagePopupStore:l})})}):null}function re(e){const{value:t}=(0,_().fJ)(k().fM);return t?(0,P.jsx)(ie,{...e,framerMotion:t}):null}const se=(0,n(340498).wt)("stopDictation",{viewBox:"0 0 36 36",svg:(0,P.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,P.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,P.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var ae=()=>n(140862),ce=()=>n(575301),le=()=>n(607859),de=()=>n(991699),ue=()=>n(110750),pe=()=>n(594635);function me(){const e=(0,T().v3)(),{isMobileNative:t,isPhone:n}=(0,T().Y0)(),o=(0,A().K8)((()=>{const e=le().default.state.isOnboarding,t=de().A.state.open;return e||t}),[]),r=(0,A().K8)((()=>{var e;return!o&&x().Ay.getState().enabled&&!x().Ay.getState().loading&&!(null!==(e=x().Ay.getState().rootBlock)&&void 0!==e&&e.isTranscriptionBlock())}),[o]),s=(0,b.useCallback)((()=>{(0,i().stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,b.useEffect)((()=>{o&&s()}),[o,s]),function(e){const t=(0,A().O$)(pe().A);(0,b.useEffect)((()=>{t&&(e(),pe().A.reset())}),[t,e])}(s),function(e){const t=(0,T().v3)(),n=(0,A().K8)((()=>{const e=x().kj.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),o=(0,A().K8)((()=>!x().Y$.state&&x().gZ.state),[]),i=(0,A().O$)(x().ei),r=(0,b.useRef)(!0),s=(0,A().K8)((()=>(0,ue().Xz)(t.TabbedRouterStore.state)),[t]);(0,b.useEffect)((()=>{(0,N().O9)(n)&&n&&e()}),[n,e]),(0,b.useEffect)((()=>{if(o&&(0,N().O9)(i)&&!i.isTranscriptionBlock()){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[o,e,i]),(0,b.useEffect)((()=>{t.device.isMobileNative&&s&&(r.current?r.current=!1:e())}),[t,s,r,e])}(s),r&&t&&n?(0,P.jsx)(fe,{handleClick:s}):null}function fe(e){const{handleClick:t}=e,n=(0,T().v3)(),o=(0,ae().A)(!0);!function(){const{mobileNative:e}=(0,T().v3)();(0,b.useEffect)((()=>(null==e||e.requestKeepScreenOn(!0),()=>{null==e||e.requestKeepScreenOn(!1)})),[e])}();const i=(0,ce().o_)(),[r,s]=(0,A().K8)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),a=(0,I().IS)((e=>({container:{position:"absolute",width:"100%",bottom:i,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:s,paddingLeft:r,border:`1px solid ${e.stroke.secondary}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground}})),[i,r,s]),c=(0,b.useMemo)((()=>se({width:36,height:36,...a.icon})),[a.icon]);return(0,P.jsx)("div",{style:{...a.container,zIndex:1e7},...o,children:(0,P.jsxs)("div",{className:"notion-dictation-button",style:{...a.dictationButtonStyle},children:[(0,P.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:(0,P.jsx)(te().t,{fillWidth:!0})}),(0,P.jsx)("div",{onClick:t,children:c})]})})}var ve=()=>n(857639),ge=()=>n(705540),he=()=>n(615234),Se=()=>n(866515),ye=()=>n(249696);const be=(0,C().YK)({title:{id:"stopDictationListener.notification.title",defaultMessage:"Meeting note stopped due to inactivity"},body:{id:"stopDictationListener.notification.body",defaultMessage:"Notion AI could not detect your audio for a while"}});function Ae(){const e=(0,T().v3)(),t=(0,C().tz)(),n=(0,A().O$)(x().ei),o=(0,A().K8)((()=>(0,N().O9)(n)&&n.isTranscriptionBlock()),[n]),s=(0,A().K8)((()=>{const e=x().kj.state;if(e&&e.isDefined())return!e.isDictatableBlock()||e.pathIsDead()}),[]),a=(0,A().K8)((()=>!x().Y$.state),[]);(0,b.useEffect)((()=>{var t,n,o,r;(0,N().O9)(s)&&s&&(ve().log({level:"info",from:"stopDictationListener",type:"block_not_dictatable",data:{miscDataToConvertToString:{rootBlockId:null===(t=x().ei.state)||void 0===t?void 0:t.id,dictationBlockId:null===(n=x().kj.state)||void 0===n?void 0:n.id,isDictatableBlock:(null===(o=x().kj.state)||void 0===o?void 0:o.isDictatableBlock())??"undefined",isDictationBlockPathDead:(null===(r=x().kj.state)||void 0===r?void 0:r.pathIsDead())??"undefined"}}}),(0,i().stopDictation)({environment:e,from:"block_not_dictatable"}))}),[s,e]),(0,b.useEffect)((()=>{if(a&&!o){const t=setTimeout((()=>{a||(0,i().stopDictation)({environment:e,from:"block_not_visible"})}),350);return()=>{clearTimeout(t)}}}),[a,o,e]);const c=function(){const e=(0,ye().W)(),t=(0,A().O$)(x().ei),[n,o]=(0,b.useState)(void 0),i=(0,b.useCallback)((()=>{if(null==t||!t.isTranscriptionBlock())return;const e=x().Ay.state.lastReceivedTranscriptionAt;if(!e)return;const n=Date.now()-e;n>=15*he().Xb?o("should_stop"):n>=Number(he().Xb)?o("should_notify"):o(void 0)}),[t]);return(0,Se().n)(i,20*he().TD,Boolean(e&&t)),n}();return(0,b.useEffect)((()=>{if(c&&null!=n&&n.isTranscriptionBlock()&&("should_notify"===c&&ge().pushToastInMainTab({toastId:"transcription_idle",pointer:n.pointer}),"should_stop"===c)){(0,r().stopTranscription)({environment:e,blockStore:n,from:"transcription_idle"});new Notification(t.formatMessage(be.title),{body:t.formatMessage(be.body),silent:!1}).addEventListener("click",(()=>{(0,h().q)({environment:e,blockStore:n})}))}}),[c,e,n,t]),null}n(354520);var we=()=>n(187174),ke=()=>n(209969),_e=()=>n(284371),xe=()=>n(843189),Te=()=>n(297872),Ie=()=>n(676007),Ce=()=>n(431895),Be=()=>n(748197);const Me=(0,C().YK)({transcriptionSetupModal:{id:"transcriptionBlock.transcriptionSetupModal.ariaLabel",defaultMessage:"Setting up AI Meeting Notes"},getStarted:{id:"transcriptionBlock.transcriptionSetupModal.getStarted",defaultMessage:"Get started with AI Meeting Notes"},setupDescription:{id:"transcriptionBlock.transcriptionSetupModal.setupDescription",defaultMessage:"We need your permission to transcribe audio from your computer."}});function De(){const e=(0,T().Y0)(),t=(0,A().K8)((()=>Be().c.state.transcriptionSetupModalOpen&&e.isElectron),[e]);return(0,P.jsx)(Ie().A,{ariaLabel:m().A.formatMessage(Me.transcriptionSetupModal),open:t,render:()=>(0,P.jsx)(Re,{}),transitionAppearance:"none",onDismiss:()=>{Be().c.closeTranscriptionSetupModal()}})}function Re(){const e=(0,I().IS)((e=>({wrapper:{display:"flex",flexDirection:"column",padding:"25px 30px 15px",maxWidth:600,width:"100%"},title:{fontSize:24,fontWeight:600,marginBottom:5,color:e.text.primary},description:{fontSize:16,lineHeight:"24px",color:e.text.secondary,marginBottom:15}})),[]),t=(0,T().v3)(),[n]=(0,b.useState)((0,Ce().xw)()),[o,i]=(0,b.useState)([]),[r,s]=(0,b.useState)(!1),[a]=(0,we().Yb)((async()=>{let e,r=o;const s=n.filter((e=>!o.includes(e.id)));for(const n of s){const i=await n.hasCompleted({environment:t,isConfirmation:!1});i&&!o.includes(n.id)&&(r=[...r,n.id]),i||e||(e=n)}return i(r),e}),[t,n,o]);return(0,b.useEffect)((()=>{if(a.value&&r){const e=setInterval((async()=>{const n=a.value;if(!n)return void clearInterval(e);await n.hasCompleted({environment:t,isConfirmation:!0})&&(i([...o,n.id]),clearInterval(e))}),3e3);return()=>{clearInterval(e)}}}),[a,t,r,o]),(0,P.jsx)(Te().A,{capture:!0,allowUndo:!1,allowEsc:!0,allowTabUntab:!1,render:i=>(0,P.jsxs)("div",{...i,style:e.wrapper,children:[(0,P.jsx)("div",{style:e.title,children:(0,P.jsx)(C().sA,{...Me.getStarted})}),(0,P.jsx)("div",{style:e.description,children:(0,P.jsx)(C().sA,{...Me.setupDescription})}),n.map((e=>{var n,i;return(0,P.jsx)(je,{step:e,isCompleted:o.includes(e.id),isFirstIncompleteStep:(null===(i=a.value)||void 0===i?void 0:i.id)===e.id,onAction:()=>{e.action({environment:t,isConfirmation:!1}),(0,p().u4)({environment:t,event:{eventName:"transcription_block_setup_modal_action_clicked",eventProperties:{step:e.id}}}),s(!0)}},`${e.id}-${null===(n=a.value)||void 0===n?void 0:n.id}`)}))]})})}function je(e){const{step:t,isFirstIncompleteStep:n,onAction:o,isCompleted:i}=e,r=(0,I().IS)((e=>({stepContainer:{display:"flex",marginBottom:12},checkIcon:{width:24,height:24,marginRight:12,fill:i?e.blueColor:e.accentColors.gray[200]},content:{flex:1},stepTitle:{display:"flex",alignItems:"center",fontSize:16,fontWeight:i?_e().Wy.medium:_e().Wy.semibold,marginBottom:4,color:i?e.text.secondary:e.text.primary,textDecoration:i?"line-through":"none"},actionButton:{marginTop:12}})),[i]);return(0,P.jsxs)("div",{style:r.stepContainer,children:[(0,ke().checkmarkCircleFillIcon)(r.checkIcon),(0,P.jsxs)("div",{style:r.content,children:[(0,P.jsx)("div",{style:r.stepTitle,children:(0,P.jsx)(C().sA,{...t.title})}),n?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(C().sA,{...t.description}),(0,P.jsx)(xe().E,{color:"uiBlue",style:r.actionButton,onClick:o,children:(0,P.jsx)(C().sA,{...t.actionText})})]}):null]})]})}}}]);