"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86227],{261164:(e,t,o)=>{o.d(t,{o:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowRightRounded",{viewBox:"0 0 16 13",svg:(0,n.jsx)("path",{d:"M15.3828 6.85156C15.3828 7.09635 15.2917 7.3099 15.1094 7.49219L9.95312 12.6328C9.77083 12.8099 9.5651 12.8984 9.33594 12.8984C9.09635 12.8984 8.89583 12.8203 8.73438 12.6641C8.57812 12.5078 8.5 12.3125 8.5 12.0781C8.5 11.9583 8.52083 11.8464 8.5625 11.7422C8.60938 11.638 8.67188 11.5469 8.75 11.4688L10.5 9.70312L13.4141 7.04688L13.6875 7.54688L10.9766 7.70312H1.48438C1.22396 7.70312 1.01302 7.625 0.851562 7.46875C0.695312 7.30729 0.617188 7.10156 0.617188 6.85156C0.617188 6.59635 0.695312 6.39062 0.851562 6.23438C1.01302 6.07292 1.22396 5.99219 1.48438 5.99219H10.9766L13.6875 6.15625L13.4141 6.66406L10.5 4L8.75 2.22656C8.67188 2.14844 8.60938 2.0599 8.5625 1.96094C8.52083 1.85677 8.5 1.74219 8.5 1.61719C8.5 1.38281 8.57812 1.1875 8.73438 1.03125C8.89583 0.875 9.09635 0.796875 9.33594 0.796875C9.45052 0.796875 9.5599 0.820312 9.66406 0.867188C9.76823 0.914062 9.86719 0.984375 9.96094 1.07812L15.1094 6.21094C15.2917 6.39323 15.3828 6.60677 15.3828 6.85156Z"})})},343168:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().default{getInitialState(){return{openTooltip:void 0}}}const r=new n},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>N,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>A,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>I,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>C,RRULE_WEEKDAYS_MAP:()=>g,adjustedStartDateIfPossible:()=>b,areRecurrenceSchedulesEqual:()=>P,convertFromUnpersistedRecurrenceConfig:()=>Q,convertToUnpersistedRecurrenceConfig:()=>F,getFormattedEndCondition:()=>x,getFormattedNextRecurrenceTime:()=>R,getNewEndTimestamp:()=>D,getNextDateUtc:()=>T,getRecurrenceAfter:()=>w,isRunningBetweenMidnightAnd3AM:()=>E,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>S,rruleFromRecurrence:()=>_,templateAncestorsViolateRecurrenceNesting:()=>M});o(898992),o(354520),o(581454);var n=()=>o(244641);o(944114);function r(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(o[0],...o.slice(1)).map((e=>[a,...e])));return i}var i=()=>o(496603),a=()=>o(534177),s=()=>o(720665),c=()=>o(597777),d=()=>o(869190),l=()=>o(416504),u=()=>o(402390);class m extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var p=()=>o(912720);const f=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},g={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},v=99,C=999;function h(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function S(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=C}function _(e){const{start_date:t,frequency:o,interval:n,weekdays:i,timezone:s,hour:d,minute:l}=e,u="week"===o&&i?i.map((e=>g[e])):void 0,p={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?p.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?p.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?p.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?p.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return g[t].nth(o)})):(0,a().HB)(e.monthly_restriction)),new m({freq:y[o],dtstart:(0,c().eU)(t),interval:n,byweekday:u,tzid:s,byhour:d??0,byminute:l??0,bysecond:0,...p})}const I=1,A=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=n>I,a=o.length>=A;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function b(e){var t;const{recurrence:o,afterDate:r}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=r)return o;let i=n().c9.fromMillis(o.start_date,{zone:"utc"});const a=n().c9.fromMillis(r,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/o.interval);i=i.plus({years:e*o.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/o.interval);i=i.plus({months:e*o.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/o.interval);i=i.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/o.interval);i=i.plus({days:e*o.interval});break}}return{...o,start_date:(0,c().DH)(i.toMillis())}}function w(e){const{recurrence:t,afterDate:o}=e;if((0,p().wt)(t)){const e=(0,c().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=_(b({recurrence:t,afterDate:o})).after((0,c().eU)(o));if(!e)return;return(0,c().h1)(e)}}function E(e){return 0===e.hour||1===e.hour||2===e.hour}function T(e){return _(e).after((0,c().eU)((0,c().Rz)()))||void 0}function R(e){const{recurrence:t,intl:o}=e,r=T(Q(t));if(!r)return;const i=E(t),a=n().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(o)).setZone(t.timezone),s=(0,d().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(f.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),o.formatMessage(f.dateAtTime,{date:s,time:e})}}function x(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,d().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(f.noEndCondition)}const N=100;function F(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function D(e,t,o){return e.plus(o-t)}function k(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(o.toJSDate())}}function Q(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?k(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function P(e,t){const o=i().fN(e,(e=>void 0!==e)),n=i().fN(t,(e=>void 0!==e));return i().n4(o,n)}},536308:(e,t,o)=>{o.r(t),o.d(t,{formEditorActions:()=>n()});var n=()=>o(894995)},590856:(e,t,o)=>{o.d(t,{y:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionForm",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M5.50195 4.75635C5.37435 4.75635 5.26953 4.71305 5.1875 4.62646C5.10547 4.53988 5.06445 4.43734 5.06445 4.31885C5.06445 4.1958 5.10547 4.09326 5.1875 4.01123C5.26953 3.9292 5.37435 3.88818 5.50195 3.88818H10.5059C10.6289 3.88818 10.7314 3.9292 10.8135 4.01123C10.8955 4.09326 10.9365 4.1958 10.9365 4.31885C10.9365 4.43734 10.8955 4.53988 10.8135 4.62646C10.7314 4.71305 10.6289 4.75635 10.5059 4.75635H5.50195ZM5.50195 7.0874C5.37435 7.0874 5.26953 7.04639 5.1875 6.96436C5.10547 6.87777 5.06445 6.77295 5.06445 6.6499C5.06445 6.53141 5.10547 6.43115 5.1875 6.34912C5.26953 6.26709 5.37435 6.22607 5.50195 6.22607H10.5059C10.6289 6.22607 10.7314 6.26709 10.8135 6.34912C10.8955 6.43115 10.9365 6.53141 10.9365 6.6499C10.9365 6.77295 10.8955 6.87777 10.8135 6.96436C10.7314 7.04639 10.6289 7.0874 10.5059 7.0874H5.50195ZM5.50195 9.42529C5.37435 9.42529 5.26953 9.38428 5.1875 9.30225C5.10547 9.22021 5.06445 9.11995 5.06445 9.00146C5.06445 8.87842 5.10547 8.77588 5.1875 8.69385C5.26953 8.60726 5.37435 8.56396 5.50195 8.56396H7.92188C8.04948 8.56396 8.1543 8.60726 8.23633 8.69385C8.31836 8.77588 8.35938 8.87842 8.35938 9.00146C8.35938 9.11995 8.31836 9.22021 8.23633 9.30225C8.1543 9.38428 8.04948 9.42529 7.92188 9.42529H5.50195ZM2.13867 13.1577V2.84229C2.13867 2.10856 2.32552 1.55257 2.69922 1.17432C3.07292 0.791504 3.62663 0.600098 4.36035 0.600098H11.6406C12.3743 0.600098 12.9281 0.791504 13.3018 1.17432C13.6755 1.55257 13.8623 2.10856 13.8623 2.84229V13.1577C13.8623 13.896 13.6755 14.4543 13.3018 14.8325C12.9281 15.2108 12.3743 15.3999 11.6406 15.3999H4.36035C3.62663 15.3999 3.07292 15.2108 2.69922 14.8325C2.32552 14.4543 2.13867 13.896 2.13867 13.1577ZM3.48535 13.0757C3.48535 13.3901 3.56738 13.6317 3.73145 13.8003C3.89551 13.9689 4.14388 14.0532 4.47656 14.0532H11.5312C11.8639 14.0532 12.1123 13.9689 12.2764 13.8003C12.4404 13.6317 12.5225 13.3901 12.5225 13.0757V2.93115C12.5225 2.61214 12.4404 2.36833 12.2764 2.19971C12.1123 2.02653 11.8639 1.93994 11.5312 1.93994H4.47656C4.14388 1.93994 3.89551 2.02653 3.73145 2.19971C3.56738 2.36833 3.48535 2.61214 3.48535 2.93115V13.0757Z"})})},725649:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>r,K$:()=>n,j6:()=>i})},894995:(e,t,o)=>{o.r(t),o.d(t,{FORMS_SHARE_CALLOUT_KEY:()=>$,changeFormClosedState:()=>le,changeFormSubmissionPermissions:()=>ue,createAndFocusCollectionFormEditorView:()=>ne,createCollectionFormEditorView:()=>re,createDummyFormPage:()=>ye,createFormInPrivate:()=>ie,createFormQuestion:()=>se,createFormQuestionAndUpdateOrCreateModule:()=>de,createModuleForNewlyDuplicatedProperty:()=>ce,createResponsesCollectionView:()=>ae,handleUpdateFormQuestionName:()=>ee,incrementAndTrackUserFormsCreated:()=>J,maybeAlertAboutUnsupportedPublicQuestions:()=>ge,maybeSyncQuestionNameToPropertyName:()=>te,remapQuestionToNewProperty:()=>fe,toggleAnonymousFormSubmissionState:()=>me,toggleNotionBrandingState:()=>pe});o(16280),o(944114),o(898992),o(354520),o(672577),o(803949),o(581454),o(296540);var n=()=>o(401497),r=()=>o(584262),i=()=>o(700500),a=()=>o(31503),s=()=>o(970013),c=()=>o(713998),d=()=>o(110192),l=()=>o(416504),u=()=>o(261164),m=()=>o(590856),p=()=>o(29118),f=()=>o(688728),y=()=>o(235692),g=()=>o(388821),v=()=>o(450648),C=()=>o(179034),h=()=>o(869558),S=()=>o(37165),_=()=>o(144081),I=()=>o(919709),A=()=>o(959013),M=()=>o(183558),b=()=>o(284371),w=()=>o(235191),E=()=>o(171718),T=()=>o(901389),R=()=>o(896628),x=()=>o(246826),N=()=>o(857783),F=()=>o(185544),D=()=>o(751156),k=()=>o(755199),Q=()=>o(478251),P=()=>o(180762),U=()=>o(989423),V=()=>o(389658),B=()=>o(682146),L=()=>o(594794),H=()=>o(972435),z=()=>o(628315),q=()=>o(978846),O=()=>o(33218),j=()=>o(351360),Z=()=>o(508496),W=()=>o(343168),Y=()=>o(611371),G=()=>o(465741),K=o(474848);const X=(0,A().YK)({responsesViewName:{id:"formEditorActions.responsesViewName",defaultMessage:"Responses"},newFormViewName:{id:"formEditorActions.newFormViewName",defaultMessage:"Form builder"},formDatabaseTitle:{id:"newBlock.databaseInline.formDatabaseTitle",defaultMessage:"New form"}}),$="forms_share_form_tooltip";function J(e,t){const{currentUserSettingsStore:o}=j().default.state;if(!o)return;const n=function(){const{currentUserSettingsStore:e}=j().default.state;if(!e)return;return e.getSettingsStore().getKeyStore("user_forms_created_count").getValue()??0}();void 0!==n&&(k().mJ({userSettingsStore:o,transaction:t,data:{user_forms_created_count:n+1}}),function(e,t){(0,U().u4)({environment:e,event:{eventName:"form_created",eventProperties:{user_total_form_count:t.userFormsCreatedCount}}})}(e,{userFormsCreatedCount:n+1})),Z().default.logEvent("form_created")}function ee(e){var t;const{questionStore:o,newName:n,environment:r,collectionStore:i,collectionSchema:a,collectionContextStore:s}=e,c=null===(t=o.getConfig())||void 0===t?void 0:t.propertyId;if(!c)throw new Error("No property ID found for question");D().createAndCommit({userAction:"formQuestion.changeName",environment:r,canUndo:!0,perform:e=>{var t,r;const d=null===(t=o.getConfig())||void 0===t?void 0:t.name;if(!d)return;const u=(0,v().r4)({textValue:d,getRecordModel:o.getRecordModel,deterministic:!0,userTimeZone:(0,l().P)(),intl:H().A.getIntl()})===(null===(r=a[c])||void 0===r?void 0:r.name);D().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","name"],command:"set",args:[[n]]},transaction:e}),o.shouldSyncQuestionNameToPropertyName()&&(u&&!(0,B().fE)({property:c,collectionContextStore:s,newValue:n})?w().YO({collectionStore:i,property:c,name:n,transaction:e}):D().applyOperation({store:o,operation:{pointer:o.pointer,path:["config","shouldSyncQuestionNameToPropertyName"],command:"set",args:!1},transaction:e}))}})}function te(e){var t;const{questionStore:o,environment:n,collectionStore:r,collectionContextStore:i}=e,a=null===(t=o.getConfig())||void 0===t?void 0:t.propertyId;if(!a)throw new Error("No property ID found for question");D().createAndCommit({userAction:"formQuestion.changeName",environment:n,canUndo:!0,perform:e=>{if(!o.shouldSyncQuestionNameToPropertyName())return;const t=o.getNameStore().getValue();if(!t)return;const n=(0,v().r4)({textValue:t,getRecordModel:o.getRecordModel,deterministic:!0,userTimeZone:(0,l().P)(),intl:H().A.getIntl()}),s=(0,B().fE)({property:a,collectionContextStore:i,newValue:n})?(0,d().Q)(n):n;w().YO({collectionStore:r,property:a,name:s,transaction:e})}})}function oe(){const e=(0,n().IS)((e=>({container:{display:"flex",flexDirection:"column"},iconGroup:{display:"flex",flexDirection:"row",justifyContent:"center",color:e.icon.secondary,alignItems:"center"},dialogTitle:{fontSize:16,fontWeight:b().Wy.semibold,lineHeight:"22px",marginTop:12,marginBottom:12},dialogDescription:{color:e.text.secondary,fontSize:14,lineHeight:"20px"}})),[]);return(0,K.jsxs)("div",{style:e.container,children:[(0,K.jsxs)("div",{style:e.iconGroup,children:[(0,p().K)({width:24}),(0,u().o)({width:16,marginLeft:16,marginRight:14}),(0,m().y)({width:24})]}),(0,K.jsx)("span",{style:e.dialogTitle,children:(0,K.jsx)(A().sA,{defaultMessage:"Auto-create form questions based on existing properties?",id:"NewFormOnExistingCollectionDialogTitle.message"})}),(0,K.jsx)("span",{style:e.dialogDescription,children:(0,K.jsx)(A().sA,{defaultMessage:"Only supported property types will create new questions.",id:"NewFormOnExistingCollectionDialogTitle.description"})})]})}function ne(e){const{environment:t,collectionContextStore:o,transaction:n}=e,r=o.collectionViewBlockStore(),i=o.collectionStore();if(!r||!i)return;const s=o.normalizedSchemaStore.state,c=re({environment:t,collectionViewBlockStore:r,schema:s,transaction:n,initializeWithAllDefaultQuestions:!1});if(!c)return;(0,P().t)({environment:t,collectionContextStore:o,collectionViewId:c.newViewId,isFullScreen:o.isFullScreenStore.state,isRootChild:o.isRootChildStore.state,isInPeekRenderer:o.isInPeekRendererStore.state});const d=c.layoutStore,l=Object.keys(s).filter((e=>{const t=s[e];return"title"!==e&&t&&(0,a().Sg)(t)}));l.length>0&&l.length<=G().eb&&T().ui({showCancel:!1,keepFocus:!1,message:(0,K.jsx)(oe,{}),mode:"wide",items:[{label:(0,K.jsx)(A().sA,{defaultMessage:"Create {numQuestions, plural, one {1 question} other {{numQuestions} questions}}",id:"formEditorActions.createQuestions.primaryAction",values:{numQuestions:l.length}}),color:"blue",buttonType:"solid",onAccept(){D().createAndCommit({environment:t,userAction:"formActions.autoCreateFormQuestionsForExistingDatabase",canUndo:!0,perform:e=>{for(const n of l)ce({type:"formQuestion",environment:t,module:void 0,transaction:e,layoutStore:d,collectionStore:i,propertyId:n,position:{type:"area_relative",area:"form_layout_schema",location:"end_moveable"},collectionContextStore:o,shouldLogEvent:!0,autoCreatedFromExistingDatabase:!0,duplicateModuleMapping:new Map,propertyIdMapping:new Map,sessionId:(0,M().Ay)()})}})}},{label:(0,K.jsx)(A().sA,{defaultMessage:"Start from scratch",id:"formEditorActions.createQuestions.secondary"}),color:"gray",buttonType:"plain",onAccept(){}}]})}function re(e){const{environment:t,collectionViewBlockStore:o,transaction:n,schema:r,initializeWithAllDefaultQuestions:i}=e;if(!o)return;const c=o.getSpaceId(),{formBlockStore:d,layoutStore:l}=function(e){var t;const{environment:o,spaceId:n,inMemoryRecordCache:r,transaction:i,schema:c,initializeWithAllDefaultQuestions:d}=e,l=Object.keys(c).find((e=>{var t;return"multi_select"===(null===(t=c[e])||void 0===t?void 0:t.type)})),u=Boolean(d&&void 0!==l),m=(0,L().Z1)({environment:o,table:C().ev,spaceId:n}),p=(0,L().Z1)({environment:o,table:S().lo,spaceId:n}),f=u?(0,L().Z1)({environment:o,table:S().lo,spaceId:n}):void 0,g=x().Wv({id:m,environment:o,type:"form",permissions:(0,a().eb)(),inMemoryRecordCache:r,transaction:i}),v=x().eC({environment:o,table:_().zx,value:{space_id:n,parent_table:C().ev,parent_id:g.id,modules:(0,y().oP)(p,f)},inMemoryRecordCache:r,transaction:i});var h,I;R().zA({stores:[g],update:{form_layout_pointer:{id:v.id,spaceId:n,table:_().zx}},transaction:i}),se({environment:o,questionId:p,spaceId:n,layoutId:v.id,propertyId:s().rn,initialQuestionTitle:(null===(t=c[s().rn])||void 0===t?void 0:t.name)??"",inMemoryRecordCache:r,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1,logData:{area:"form_layout_schema",layoutStore:v}}),u&&f&&l&&se({environment:o,questionId:f,spaceId:n,layoutId:v.id,propertyId:l,initialQuestionTitle:(null===(h=c[l])||void 0===h?void 0:h.name)??"",existingFormQuestionConfig:{propertyId:l,name:[[(null===(I=c[l])||void 0===I?void 0:I.name)??""]],propertyTypeSpecificConfig:{multi_select:{maxSelectionCount:1}}},inMemoryRecordCache:r,transaction:i,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:!1,logData:{area:"form_layout_schema",layoutStore:v}});return{formBlockStore:g,layoutStore:v}}({environment:t,spaceId:c,inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,schema:r,initializeWithAllDefaultQuestions:i}),u=(0,Q().i)({environment:t,collectionViewBlockStore:o,collectionView:{type:"form_editor",parent_id:o.id,parent_table:C().ev,alive:!0,space_id:c,name:H().A.formatMessage(X.newFormViewName),format:{form_block_pointer:{id:d.id,spaceId:c,table:C().ev}}},transaction:n});return x().zv({store:d,data:{parent_id:u.id,parent_table:h().Gy,alive:!0},transaction:n}),W().A.setState({openTooltip:u.id}),z().HH(t,$),J(t,n),{newViewId:u.id,layoutStore:l,formId:d.id}}function ie(e){const{environment:t,navigateToFormBuilder:o}=e,{currentSpaceStore:n,currentSpaceViewStore:i}=j().default.state;if(!n||!i)return;if(!(0,Y().EF)(t))return void(0,Y().QY)(t);if(!(n&&n.canEdit()&&i))return;const a=n.id,s=t.idCreator.getSpaceIdCreatorSync(a);D().createAndCommit({environment:t,userAction:"formActions.createAndNavigateToFormInPrivate",canUndo:!0,perform:e=>{var c;const{targetBlockStore:d}=E().j({environment:t,sourceBlockId:"root",targetBlockPointer:(0,L().zP)({environment:t,table:C().ev,spaceId:a}),sourceBlockSubtree:(0,g().partialRecordMapToRecordMap)(V().mT({isInline:!0,name:(0,I().x9d)(H().A.formatMessage(X.formDatabaseTitle))})),targetRecordCache:n.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1,spaceIdCreator:s}),l=d.getCollectionStore(),u=null==l||null===(c=l.getModel())||void 0===c?void 0:c.getNormalizedSchema(),m=d;if(!u)throw new Error("Schema not found");re({environment:t,transaction:e,collectionViewBlockStore:m,schema:u,initializeWithAllDefaultQuestions:!0}),ae({environment:t,transaction:e,collectionViewBlockStore:m,schema:u}),F().yM({environment:t,spaceStore:n,spaceViewStore:i,pageStore:d,isPrivate:!0,transaction:e,location:{type:"prepend"}}),o&&N().uK({environment:t,store:d,pageVisitSource:r().y8.CreateFormDeepLink})}})}function ae(e){const{environment:t,collectionViewBlockStore:o,transaction:n}=e,r=o.getSpaceId(),i=Object.keys(e.schema).find((t=>{var o;return"created_by"===(null===(o=e.schema[t])||void 0===o?void 0:o.type)}));(0,Q().i)({environment:t,collectionViewBlockStore:o,collectionView:{type:"table",parent_id:o.id,parent_table:C().ev,alive:!0,name:H().A.formatMessage(X.responsesViewName),space_id:r,format:{table_properties:[{property:"title",visible:!0},...i?[{property:i,visible:!0}]:[]],table_wrap:!0,collection_pointer:o.getCollectionPointer()}},transaction:n})}function se(e){const{environment:t,questionId:o,spaceId:n,layoutId:r,propertyId:i,initialQuestionTitle:a,inMemoryRecordCache:s,transaction:c,shouldSyncQuestionNameToPropertyName:d,collectionContextStore:l,shouldLogEvent:u=!0,autofocusTitle:m,existingFormQuestionConfig:p,autoCreatedFromExistingDatabase:f}=e;x().vt({environment:t,table:S().lo,args:{id:o,space_id:n,parentPointer:{id:r,table:_().zx,spaceId:n},config:{...p,propertyId:i,name:[[a]],shouldSyncQuestionNameToPropertyName:d}},inMemoryRecordCache:s,transaction:c}),u&&(0,U().u4)({environment:t,event:{eventName:"add_form_question",eventProperties:{...(0,G().YA)({collectionContextStore:l,propertyId:i,questionId:o,area:e.logData.area,parentModuleId:e.logData.parentModuleId,layoutStore:e.logData.layoutStore}),auto_created_from_existing_database:Boolean(f)}}}),m&&m.autofocusedQuestionTextStore.autofocusQuestionTitle({questionId:o})}function ce(e){const{type:t,module:o,environment:n,transaction:r,layoutStore:i,position:a,duplicateModuleMapping:s,shouldLogEvent:c=!0,collectionContextStore:d,sessionId:l}=e;let u;const m=o&&s.get(o.id)||(0,M().Ay)();if("formQuestion"===t){var p;const{collectionStore:t,propertyId:l,autofocusTitle:y,existingFormQuestionConfig:g,autoCreatedFromExistingDatabase:v,propertyIdMapping:C}=e,h=t.getSchema()[l];if(!h)throw new Error(`No schema found for property ${l}`);const _=g?(0,I().q4_)(null==g?void 0:g.name):h.name,A=i.getSpaceId(),M=(0,L().Z1)({environment:n,table:S().lo,spaceId:A});if(!(0,f().uW)(a.area))throw new Error("Module is not allowed in this area");se({environment:n,questionId:M,spaceId:A,layoutId:i.id,propertyId:l,initialQuestionTitle:_,inMemoryRecordCache:i.inMemoryRecordCache,transaction:r,shouldSyncQuestionNameToPropertyName:!0,shouldLogEvent:c,logData:{area:a.area,parentModuleId:null==o?void 0:o.parentModuleId,layoutStore:i},collectionContextStore:d,autofocusTitle:y,existingFormQuestionConfig:g,autoCreatedFromExistingDatabase:v}),u={type:"formQuestion",id:m,formQuestionId:M,...o?{parentModuleId:s.get(o.parentModuleId??"")??o.parentModuleId,parentConditionalGroupId:o.parentConditionalGroupId,conditionalGroups:null===(p=o.conditionalGroups)||void 0===p?void 0:p.map((e=>({...e,trigger:{...e.trigger,property:C.get(e.trigger.property)??e.trigger.property},children:[]})))}:{}}}else u={type:"placeholder",id:m,parentModuleId:s.get(o.parentModuleId??""),parentConditionalGroupId:o.parentConditionalGroupId};return(0,q().UQ)({environment:n,transaction:r,layoutStore:i,position:a,module:u,sessionId:l,isPropertyCreation:!1}),{moduleId:m}}function de(e){const{environment:t,transaction:o,layoutStore:n,propertyId:r,initialQuestionTitle:i,moduleId:a,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:c,autofocusTitle:d,area:l,sessionId:u}=e,m=n.getModel();if(!m)throw new Error("Layout model cannot be undefined");const p=n.getSpaceId(),f=(0,L().Z1)({environment:t,table:S().lo,spaceId:p});se({environment:t,questionId:f,spaceId:p,layoutId:m.id,propertyId:r,initialQuestionTitle:i,inMemoryRecordCache:n.inMemoryRecordCache,transaction:o,shouldSyncQuestionNameToPropertyName:s,collectionContextStore:c,autofocusTitle:d,logData:{area:l,parentModuleId:"form_conditional_modules"===l?e.parentModuleId:void 0,layoutStore:n}});const y={type:"formQuestion",id:a??(0,M().Ay)(),formQuestionId:f,..."form_conditional_modules"===l?{parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:{}};return a?(0,O().UQ)({environment:t,transaction:o,layoutStore:n,position:{area:l,moduleId:a},updatedModule:y}):"form_conditional_modules"===l&&(0,q().UQ)({environment:t,transaction:o,layoutStore:n,position:{type:"absolute",area:"form_conditional_modules",parentConditionalGroupId:e.parentConditionalGroupId,parentModuleId:e.parentModuleId},module:y,sessionId:u,isPropertyCreation:!1}),{updatedModuleId:y.id,formQuestionId:f}}function le(e){let{environment:t,formBlockStore:o,isClosed:n}=e;o.getIsFormClosed()!==n&&D().createAndCommit({userAction:"formActions.changeFormClosedState",environment:t,canUndo:!0,perform:e=>{R().zA({stores:[o],update:{form_config:{...o.getFormConfig(),is_form_closed:n}},transaction:e})}})}function ue(e){let{environment:t,formBlockStore:o,permissions:n}=e;o.getFormSubmissionPermissions()!==n&&D().createAndCommit({userAction:"formActions.changeFormSubmissionPermissions",environment:t,canUndo:!0,perform:e=>{R().zA({stores:[o],update:{form_config:{...o.getFormConfig(),submission_permissions:n}},transaction:e})}})}function me(e){let{environment:t,formBlockStore:o}=e;const n=o.getIsFormAnonymousSubmissionEnabled();D().createAndCommit({userAction:"formActions.changeAnonymousFormSubmissionState",environment:t,canUndo:!0,perform:e=>{R().zA({stores:[o],update:{form_config:{...o.getFormConfig(),anonymous_submissions:!n}},transaction:e})}})}function pe(e){var t;let{environment:o,formBlockStore:n}=e;const r=n.getSiteStore();if(!r)return;const i=(null===(t=r.getHeader())||void 0===t?void 0:t.hideWatermark)??!1;D().createAndCommit({userAction:"formBlockStore.publicForm.toggleNotionBranding",environment:o,canUndo:!0,perform:e=>{D().applyOperation({store:r,operation:{pointer:r.pointer,path:["header","hideWatermark"],command:"set",args:!i},transaction:e})}})}function fe(e){let{environment:t,newPropertyId:o,formQuestionStore:n}=e;D().createAndCommit({userAction:"formQuestion.remapQuestionToNewProperty",environment:t,canUndo:!0,perform:e=>{D().applyOperation({store:n,operation:{pointer:n.pointer,path:["config","propertyId"],command:"set",args:o},transaction:e})}})}function ye(e){const{environment:t,collectionSchema:o,temporaryRecordCache:n,spaceId:r,collectionId:a,formMode:s}=e,c={};Object.keys(o).forEach((e=>{c[e]=(0,I().x9d)("")}));const{performResult:d}=D().createAndCommit({environment:t,userAction:"formActions.createDummyFormPage",perform:e=>{const o=x().Wv({environment:t,type:i().xd.page,inMemoryRecordCache:n,transaction:e,spaceId:r,properties:{...c}});return x().zv({store:o,data:{alive:"viewer"===s,parent_id:a,parent_table:"collection"},transaction:e}),o},canUndo:!1});return d}async function ge(e){const{environment:t,formBlockStore:o,collectionSchema:n,theme:r,onAccept:i}=e;if(!n)return;const a=(0,G().Dx)(o),s=(null==a?void 0:a.getNormalizedFormQuestionStoresForFormLayout({collectionSchema:n}))??[],d=[];if(s.forEach((e=>{const o=e.getPropertyId();if(!o)return;const r=(0,c()._g)({schema:n,property:o}),i=null==r?void 0:r.type;if(!i)return;(0,G().CK)({environment:t,propertyType:i,propertySchema:r,isPublicForm:!0})&&d.push(e)})),0===d.length)return void i();const u=d.map(((e,t)=>{const o=(0,v().r4)({textValue:e.getNameStore().getValue(),getRecordModel:e.getRecordModel,deterministic:!0,userTimeZone:(0,l().P)(),intl:H().A.getIntl()}),n=t===d.length-1;return(0,K.jsx)("div",{style:{fontSize:14,textAlign:"start",padding:"8px 12px",borderBottom:n?void 0:`1px solid ${r.lightDividerColor}`},children:o},e.id)})),{accept:m}=await T().Gh({message:(0,K.jsx)(A().sA,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.message",defaultMessage:"These questions are not supported in public forms and will not be shown to respondents:"}),description:(0,K.jsx)("div",{style:{borderRadius:6,border:`1px solid ${r.lightDividerColor}`,width:"calc(100% + 24px)",marginLeft:-12,marginTop:12,maxHeight:210,overflow:"auto"},children:u}),acceptLabel:(0,K.jsx)(A().sA,{id:"formEditorActions.maybeAlertAboutUnsupportedPublicQuestions.acceptLabel",defaultMessage:"Got it"}),acceptColor:"blue",cancelButtonType:"plain",mode:"wide"});m&&i()}}}]);