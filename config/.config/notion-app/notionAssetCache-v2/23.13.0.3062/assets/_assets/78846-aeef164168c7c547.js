"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[78846],{33218:(e,o,t)=>{t.d(o,{UQ:()=>m,gL:()=>f});t(16280),t(898992),t(672577),t(803949);var r=()=>t(651124),i=()=>t(792071),n=()=>t(688728),a=()=>t(369186),d=()=>t(475140),l=()=>t(235692),s=()=>t(778781),p=()=>t(696706),u=()=>t(896628),c=()=>t(751156);function m(e){let{environment:o,transaction:t,layoutStore:r,position:l,updatedModule:s,sessionId:p}=e;const u=n().Zm[l.area],m=r.getRawModules();if("form_conditional_modules"===u){const e=null==m?void 0:m[u];if(!(null==e?void 0:e[l.moduleId]))throw new Error("Unable to find module being updated.");return void c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){c().applyOperation({transaction:e,store:r,operation:i().N4X.updateModuleInArea({pointer:r.pointer,area:u,module:(0,a().Lv)(s)})})},userAction:"BuilderLayoutModules.updateModule"})}if(!m)throw new Error("Unable to find modules");const _=(0,d().LC)(m,(e=>e.id===l.moduleId));if(!_||_.area!==u)throw new Error("Unable to find module being updated.");c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){c().applyOperation({transaction:e,store:r,operation:i().N4X.updateModuleInArea({pointer:r.pointer,module:(0,a().Lv)(s),..."views_main_tab_modules"===_.area?{area:_.area,viewId:_.viewId}:{area:_.area}})})},userAction:"BuilderLayoutModules.updateModule"})}function _(e){var o,t,r;let{collectionStore:i,layoutStore:n}=e;const a=new Map,d=i.getFormat(),l=[...null===(o=n.getModules())||void 0===o?void 0:o.page_main,...null===(t=n.getModules())||void 0===t?void 0:t.page_details],p=new Map;null===(r=d.property_visibility)||void 0===r||r.forEach((e=>{p.set(e.property,e)})),l.forEach((e=>{if(!(0,s()._Q)(e))return(0,s().gx)(e)?(a.set(e.propertyId,{property:e.propertyId}),void p.set(e.propertyId,{property:e.propertyId,visibility:"show"})):void 0;e.propertyIds.forEach((e=>{a.set(e,{property:e}),p.set(e,{property:e,visibility:"show"})}))}));const u=i.getNormalizedPropertyGroups();var c;u?u.forEach((e=>{var o;null===(o=e.propertyIds)||void 0===o||o.forEach((e=>{a.has(e)||a.set(e,{property:e})}))})):null===(c=d.collection_page_properties)||void 0===c||c.forEach((e=>{a.has(e.property)||a.set(e.property,e)}));return{propertiesFormat:Array.from(a.values()),propertyVisibility:Array.from(p.values())}}function f(e){let{environment:o,transaction:t,collectionStore:n,layoutStore:a}=e;const{propertiesFormat:d,propertyVisibility:m}=_({collectionStore:n,layoutStore:a});c().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){const o=a.getBlockChildrenPointers(),t=a.getFormat(),_=a.firstModuleOfType("viewsMain");_&&(0,s().y6)(_)&&o.find((e=>p().L3.isEqual(e,_.collection_view_block_pointer)))&&c().applyOperation({transaction:e,store:a,operation:i().N4X.removeBlockChild(a.pointer,_.collection_view_block_pointer.id)});const f=null==t?void 0:t.previousViewsMainCollectionViewBlockPointer,y=f&&o.find((e=>p().L3.isEqual(e,f)));y&&c().applyOperation({transaction:e,store:a,operation:i().N4X.removeBlockChild(a.pointer,y.id)}),c().applyOperation({transaction:e,store:a,operation:i().N4X.setModulesByAreas(a.pointer,(0,l().K5)())}),c().applyOperation({transaction:e,store:a,operation:i().N4X.deleteFormat(a.pointer)});const v=n.getFormat(),{page_section_visibility:w}=v;u().zA({stores:[n],update:{property_groups:void 0,collection_page_properties:d,property_visibility:m,...w?{page_section_visibility:r().Zi}:void 0},transaction:e})},userAction:"BuilderLayoutModules.resetLayoutToDefault"})}},155185:(e,o,t)=>{t.d(o,{I:()=>a,_:()=>n});const r={normalizedTitleWithIcon:!0,properties:!0,property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,views:!0,viewsMain:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,deleted_property:!1,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,recentActivity:!1,collaborators:!1,teamspaces:!1},i={properties:!0,property:!0,relationsGroup:!0,formQuestion:!0,placeholder:!0,titleWithIcon:!0,cover:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,transcript:!1,formTitle:!1,formSubmit:!1,views:!0,viewsMain:!0,collectionView:!0,collectionViewV2:!0,recentActivity:!1,collaborators:!1,teamspaces:!1};function n(e){return r[e.type]}function a(e){return i[e.type]}},235692:(e,o,t)=>{t.d(o,{K5:()=>c,Vp:()=>p,_u:()=>s,oP:()=>m,wC:()=>l,xN:()=>u});t(898992),t(354520),t(581454);var r=()=>t(183558),i=()=>t(155185),n=()=>t(778781),a=()=>t(369186);const d={page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"properties",type:"properties"},{id:"discussions",type:"discussions"},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},l={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"editor",type:"editor"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},s={page_main:[{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyLabels:"hide",propertyIds:[]},{id:"editor",type:"editor"},{id:"discussions",type:"discussions"}],page_details:[],form_layout_schema:[],person_profile_page_main:[],person_profile_page_details:[]},p={page_main:[],page_details:[],form_layout_schema:[],person_profile_page_main:[{id:"cover",type:"cover"},{id:"title_with_icon",type:"normalizedTitleWithIcon",propertyIds:[]},{id:"recent_activity",type:"recentActivity"}],person_profile_page_details:[{id:"collaborators",type:"collaborators"},{id:"teamspaces",type:"teamspaces"}]};function u(e){return(0,a().jr)({modulesByArea:d,collectionSchema:null==e?void 0:e.collectionSchema,collectionFormat:null==e?void 0:e.collectionFormat})}function c(){return{page_layout_schema:(0,a().ke)(d.page_main).map((e=>{if(!(0,n().cn)(e))return(0,i().I)(e)?{...e,id:(0,r().Ay)()}:e})).filter((e=>void 0!==e)),page_info_layout_schema:(0,a().ke)(d.page_details).map((e=>{if(!(0,n().cn)(e))return(0,i().I)(e)?{...e,id:(0,r().Ay)()}:e})).filter((e=>void 0!==e)),form_layout_schema:void 0,person_profile_page_main:void 0,person_profile_page_details:void 0}}function m(e,o){const t=void 0===o?[{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:e}]:[{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:e},{id:(0,r().Ay)(),type:"formQuestion",formQuestionId:o}];return{page_layout_schema:void 0,page_info_layout_schema:void 0,person_profile_page_main:void 0,person_profile_page_details:void 0,form_layout_schema:[{id:(0,r().Ay)(),type:"cover"},{id:(0,r().Ay)(),type:"formTitle"},...t,{id:(0,r().Ay)(),type:"formSubmit"}]}}},447934:(e,o,t)=>{t.d(o,{$L:()=>O,Fv:()=>U,HD:()=>L,V_:()=>k,bV:()=>x,jP:()=>T,nh:()=>C,w8:()=>E});t(16280),t(18107),t(967357),t(898992),t(354520);var r=()=>t(206267),i=()=>t(792071),n=()=>t(688728),a=()=>t(475140),d=()=>t(235692),l=()=>t(924329),s=()=>t(778781),p=()=>t(144081),u=()=>t(334261),c=()=>t(661920),m=()=>t(435009),_=()=>t(751156),f=()=>t(799832),y=()=>t(492414),v=()=>t(594794),w=()=>t(869562),I=()=>t(351360),b=()=>t(712505),g=()=>t(630116),h=()=>t(263711),A=()=>t(640868),M=()=>t(204521),S=()=>t(33218);function O(e){let{environment:o,transaction:t,collectionStore:r,userId:n,modules:a}=e;const l=(0,v().zP)({environment:o,spaceId:r.getSpaceId(),table:p().zx}),s=g().sk.createChildStore(r,l),{model:u,operations:[c]}=i().wfN.create({pointer:l,parent:r.pointer,createdByUserId:n,modules:a??(0,d().K5)()});_().applyOperation({transaction:t,store:s,operation:c});const m=i().BnK.setLayout(r.pointer,l);return _().applyOperation({transaction:t,store:r,operation:m}),{model:u,store:s}}function B(e){let o;return e?o=e:b().default.state.open&&b().default.state.targetStore?o=b().default.state.targetStore:I().default.state.mainEditorCurrentBlockStore&&(o=I().default.state.mainEditorCurrentBlockStore),o}function P(e){w().setUpdateExpand({environment:e,isExpanded:!1,from:"keyboard_default",saveDetailsSidebarPreference:!1}),c().VN({environment:e,from:"open_page_layout_editor",preventAnimation:!0})}function C(e){var o,t;let{environment:i,blockStore:n,collectionStore:a,collectionViewStore:d,from:l,initialSelectedModuleType:s}=e;const p=function(e){var o;let t=B(e);if(null!==(o=t)&&void 0!==o&&o.isCollectionView()){const e=(0,f().U)(t);t=e?e.resultsInViewOrder(1).at(0):void 0}return t}(n),u=window.location.href;P(i);const c=r().JW();h().g.setState({isOpen:!0,mode:"layout-editor",collectionStore:a,pageStore:p,siteRootBlockStore:void 0,sessionId:c,initialSelectedModuleId:null==p||null===(o=p.getAssociatedCollectionStore())||void 0===o||null===(o=o.getLayoutStore())||void 0===o||null===(o=o.getModel())||void 0===o||null===(o=o.firstRawModuleOfType(s??"titleWithIcon"))||void 0===o?void 0:o.id,urlOnOpen:u}),(0,M().Ko)({environment:i,from:l,context:"layout",sessionId:c,collectionId:null==a?void 0:a.id,existingLayoutId:null==a||null===(t=a.getLayoutStore())||void 0===t?void 0:t.id,collectionViewId:null==d?void 0:d.id})}function T(e){let{environment:o,store:t,siteRootBlockStore:i,from:n}=e;const a=B(t);P(o);const d=r().JW();h().g.setState({isOpen:!0,mode:"site-settings-editor",pageStore:a,siteRootBlockStore:i,sessionId:d}),(0,M().Ko)({environment:o,context:"site",from:n,sessionId:d,collectionId:void 0,existingLayoutId:void 0})}function k(e){let{slideBlockStore:o}=e;const t=o.getNavigableBlockStore(),i=r().JW();h().g.setState({isOpen:!0,mode:"presentation",pageStore:t,currentSlideStore:o,sessionId:i}),window.document.documentElement.requestFullscreen()}function x(e){let{environment:o,pageStore:t,slideBlockStore:r}=e;h().g.setState({isOpen:!1});const i=(0,y().Ay)({store:t,scrollToBlockId:r.id,pageVisitSource:void 0});m().oo({environment:o,url:i}),window.document.fullscreenElement&&window.document.exitFullscreen()}function E(e){h().g.getState().isOpen&&U(e)}function U(e){let{environment:o}=e;const t=h().g.getState();if(!t.isOpen)throw new Error("Cannot close page layout editor. Page layout editor is not open.");"layout-editor"===t.mode&&t.urlOnOpen&&window.location.href!==t.urlOnOpen&&m().aX(o),h().g.setState({isOpen:!1})}function L(e){var o;let{environment:t,transaction:r,property:i,layoutStore:d}=e;const p=h().g.getSessionId(),c=null===(o=d.getModel())||void 0===o?void 0:o.getRawModules(),m=d.getCollectionModel();if(!c||!m)return;const _=g().md.createChildStore(d,m.pointer),f=(0,a().yn)(c,(e=>"titleWithIcon"===e.type));if(f&&(0,s().Mj)(f.module)){var y;const{module:e,position:o}=f,a={...e,type:"titleWithIcon",propertyIds:null===(y=e.propertyIds)||void 0===y?void 0:y.filter((e=>e!==i))};(0,S().UQ)({environment:t,sessionId:p,transaction:r,layoutStore:d,position:{area:(0,n().Fw)(o.area),moduleId:e.id},updatedModule:(0,l().X)(a)})}const v=(0,a().LP)(c,(e=>"property"===e.type&&e.propertyId===i));for(const{module:a,position:l}of v){const e=a.id,o=(0,n().Fw)(l.area);(0,A().U)({environment:t,sessionId:p,transaction:r,layoutStore:d,position:{area:o,moduleId:e}})}const w=m.getFormat().collection_page_sections;if(w){const e=w.filter((e=>e.section!==i));u().LK({store:_,pageSectionFormats:e,transaction:r,environment:t})}}},640868:(e,o,t)=>{t.d(o,{U:()=>c});t(16280);var r=()=>t(31503),i=()=>t(454984),n=()=>t(688728),a=()=>t(475140),d=()=>t(789280),l=()=>t(778781),s=()=>t(751156),p=()=>t(204521),u=()=>t(658616);function c(e){let{environment:o,transaction:t,layoutStore:c,position:m,sessionId:_,beforePerformDeleteModule:f}=e;const y=c.getModules();if(!y)throw new Error("[deleteModuleAtPosition] modules by area not found for layout store");const v=(0,a().EX)(y,(e=>e.id===m.moduleId)),w=(0,r().Cg)({moduleId:null==v?void 0:v.module.id,modulesByArea:c.getModules()}).length;if(!v)return;const{module:I,position:b}=v;if(!(0,d().Fe)(I))throw new Error("[deleteModuleAtPosition] module to delete is not removeable");var g;(s().createAndCommitOrAppend({environment:o,transaction:t,canUndo:!0,perform(e){!function(e){const{transaction:o,layoutStore:t,moduleLocation:r,moduleToDelete:a,beforePerformDeleteModule:d}=e;d&&d(o);(0,l().V6)(a)&&(0,u().deleteViewsModuleDependencies)({layoutStore:t,viewsModule:a,transaction:o});if("form_conditional_modules"===r.area){const e=i().N4.removeChildModule({pointer:t.pointer,modulesByArea:t.getModules(),module:a});for(const r of e)s().applyOperation({transaction:o,store:t,operation:r})}else{const e="views_main_tab_modules"===r.area?{area:r.area,viewId:r.viewId}:{area:n().Zm[r.area]};s().applyOperation({transaction:o,store:t,operation:i().N4.deleteModuleInArea({...e,pointer:t.pointer,moduleId:a.id})})}}({environment:o,transaction:e,layoutStore:c,moduleLocation:b,moduleToDelete:I,beforePerformDeleteModule:f})},userAction:"pageLayout.deleteActions.deleteModuleAtPosition"}),_)&&p().PS({environment:o,module:I,sessionId:_,collectionId:null===(g=c.getCollectionModel())||void 0===g?void 0:g.id,layoutId:c.id,context:(0,n().We)(m.area),area:m.area,depth:w})}},658616:(e,o,t)=>{t.r(o),t.d(o,{deleteViewsModuleDependencies:()=>a});var r=()=>t(220719),i=()=>t(44729),n=()=>t(630116);function a(e){const{layoutStore:o,viewsModule:t,transaction:a}=e,d=(0,r().o9)(n().Bv.createChildStore(o,t.collection_view_block_pointer));i().zz({childStore:d,parentStore:o,transaction:a})}},789280:(e,o,t)=>{t.d(o,{Fe:()=>n,wm:()=>a});const r={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,relationsGroup:!0,formSubmit:!0,formQuestion:!0,formTitle:!0,placeholder:!0,transcript:!0,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,editor:!1,views:!0,viewsMain:!1,recentActivity:!1,collaborators:!1,teamspaces:!1},i={property_number:!0,property_title:!0,property_person:!0,property_file:!0,property_text:!0,property_checkbox:!0,property_url:!0,property_email:!0,property_phone_number:!0,property_created_by:!0,property_last_edited_by:!0,property_button:!0,property_select:!0,property_multi_select:!0,property_status:!0,property_date:!0,property_created_time:!0,property_last_edited_time:!0,property_last_visited_time:!0,property_relation:!0,property_rollup:!0,property_formula:!0,property_auto_increment_id:!0,property_location:!0,property_verification:!0,property_geo_point:!0,deleted_property:!1,formSubmit:!1,formQuestion:!1,formTitle:!1,placeholder:!1,transcript:!1,cover:!1,normalizedTitleWithIcon:!1,properties:!1,inlinePageSections:!1,expandedBacklinks:!1,discussions:!1,bottomControls:!1,relationsGroup:!0,editor:!1,views:!1,viewsMain:!1,recentActivity:!1,collaborators:!1,teamspaces:!1};function n(e){return r[e.type]}function a(e){return i[e.type]}},978846:(e,o,t)=>{t.d(o,{E:()=>v,UQ:()=>w});t(16280),t(18107),t(944114),t(967357);var r=()=>t(31503),i=()=>t(792071),n=()=>t(688728),a=()=>t(500993),d=()=>t(369186),l=()=>t(475140),s=()=>t(120997),p=()=>t(251822),u=()=>t(778781),c=()=>t(496603),m=()=>t(534177),_=()=>t(751156),f=()=>t(447934),y=()=>t(204521);function v(e){const{moduleId:o,layoutStore:t,sessionId:i,environment:a,position:d}=e,l=t.getModuleById(o);if(!l)throw new Error(`Cannot move module with id ${o} because a module with that id is not in the layout`);const s=(0,y().TR)({modulesByArea:t.getModules(),moduleId:o,newPosition:d});I({...e,module:l,userAction:"BuilderLayoutModules.moveModuleToPosition",afterUpsertTransaction:()=>{var e;const o=(0,r().Cg)({moduleId:l.id,modulesByArea:t.getModules()}).length;(0,y().Ib)({environment:a,sessionId:i,collectionId:null===(e=t.getCollectionModel())||void 0===e?void 0:e.id,layoutId:t.id,context:(0,n().We)(d.area),action:s,moduleType:l.type,area:d.area,depth:o})}})}function w(e){const{position:o,module:t,layoutStore:i,sessionId:a,environment:d}=e;if(i.getModuleById(t.id))throw new Error(`Cannot add module with id ${t.id} because a module with that id is already in the layout`);I({...e,userAction:"BuilderLayoutModules.addModuleAtPosition",performBeforeApplyUpsertOperations:e=>{const{transaction:r}=e;"page_main"!==o.area&&"page_details"!==o.area||(0,u().gx)(t)&&(0,f().HD)({environment:d,transaction:r,layoutStore:i,property:t.propertyId})},afterUpsertTransaction:()=>{var l;const s=(0,r().Cg)({moduleId:t.id,modulesByArea:i.getModules()}).length;(0,y().zb)({environment:d,module:t,sessionId:a,collectionId:null===(l=i.getCollectionModel())||void 0===l?void 0:l.id,layoutId:i.id,context:(0,n().We)(o.area),isPropertyCreation:e.isPropertyCreation,area:o.area,depth:s})}})}function I(e){const{environment:o,position:t,layoutStore:r,module:p,transaction:u,userAction:c,performBeforeApplyUpsertOperations:f,afterUpsertTransaction:y}=e,v=r.pointer,w=r.getModules(),I=r.getRawModules(),A=I&&(0,l().c7)(I,(e=>e.id===p.id))||(0,d().Lv)(p),M="page_main"===t.area||"page_details"===t.area?function(e){const{layoutPointer:o,modulesByArea:t,rawModulesByArea:r}=e,a=(0,l().EX)(t,(e=>"relationsGroup"===e.type));if("form_conditional_modules"===(null==a?void 0:a.position.area))return;const s=r&&(0,l().LC)(r,(e=>"relationsGroup"===e.type));if(!a)return;if(a&&s)return;const p=a.module;if(!p||"relationsGroup"!==p.type)throw new Error("relations group module location in normalized was incorrect, cannot backfill relations group module");return function(e){var o;const{module:t,modulesByArea:r,layoutPointer:a}=e,s=(0,l().JO)(r,(e=>e.id===t.id));if(!s)throw new Error("cannot upsert module at current position because module does not have a current position");if("form_conditional_modules"===s.area)throw new Error("[Forms Conditional Logic Not Implemented] form_conditional_modules area is not supported for adding and moving modules");const p="views_main_tab_modules"===s.area?null===(o=r.views_main_tab_modules)||void 0===o?void 0:o[s.viewId]:r[s.area];if(!p||0===p.length)throw new Error("cannot upsert module at current position in area because that area is empty");const u={module:(0,d().Lv)(t),pointer:a,..."views_main_tab_modules"===s.area?{area:n().Zm[s.area],viewId:s.viewId}:{area:n().Zm[s.area]}};if(0===s.index)return i().N4X.putModuleAfter({...u,afterId:void 0});const c=p.at(s.index+1);if(!c)return i().N4X.putModuleAfter({...u,afterId:void 0});return i().N4X.putModuleBefore({...u,beforeId:c.id})}({module:p,layoutPointer:o,modulesByArea:t})}({layoutPointer:v,modulesByArea:w,rawModulesByArea:I}):null;M&&_().createAndCommitOrAppend({environment:o,perform:e=>{_().applyOperation({transaction:e,store:r,operation:M})},canUndo:!0,transaction:u,userAction:`${c||"BuilderLayoutModules.upsert"}.preOpBackfill`});const S=[],O=function(e){const{layoutStore:o,module:t,upsertPosition:r}=e,a=o.getModules(),d=(0,l().JO)(a,(e=>t.id===e.id));if(!d)return;if("form_conditional_modules"===d.area)return i().N4X.deleteModuleInArea({pointer:o.pointer,area:d.area,moduleId:t.id});if("views_main_tab_modules"===d.area){const e="absolute"===r.type&&"views_main_tab_modules"===r.area?r.viewId:void 0,n=d.viewId;if(e===n)return;return i().N4X.deleteModuleInArea({pointer:o.pointer,area:d.area,moduleId:t.id,viewId:n})}if("page_main"===d.area||"page_details"===d.area||"form_layout_schema"===d.area||"person_profile_page_main"===d.area||"person_profile_page_details"===d.area){if(d.area===r.area)return;return i().N4X.deleteModuleInArea({pointer:o.pointer,area:n().Zm[d.area],moduleId:t.id})}(0,m().HB)(d.area)}({upsertPosition:t,module:p,layoutStore:r});O&&S.push(O);const B=function(e){const{upsertPosition:o,layoutPointer:t,modulesByArea:r,rawModuleToUpsert:d}=e;if("absolute"===o.type)return function(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:d}=e,p=(0,l().JO)(d,(e=>t.id===e.id)),{area:u}=o;if("form_conditional_modules"===u){const{parentConditionalGroupId:e,parentModuleId:n}=o;if(!(0,s().V)(t,"form_conditional_modules"))throw new Error("Can only add form question or placeholder modules to form_conditional_modules area.");const p=(0,l().Ib)({modulesByArea:d,find:e=>e.id===t.parentModuleId}),u=(0,a().A)(n,d);return i().N4X.upsertChildModule({pointer:r,module:t,previousParentModuleAndArea:p,newParentModule:{area:u.area,module:u.module,conditionalGroupId:e,index:o.index},modulesByArea:d})}const c=o.index;if(c<0)throw new Error(`Cannot upsert module with id ${t.id} to a negative position`);if("views_main_tab_modules"===u){const e=o.viewId;if(!d[u]||!d[u][e])throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");const a="views_main_tab_modules"===(null==p?void 0:p.area)&&(null==p?void 0:p.viewId)===e?p.index:void 0,l=b({modulesInArea:d[u][e],indexOfModuleToUpsertInArea:a,indexToUpsertTo:c});if(!l)return;return[i().N4X.putModuleBeforeOrAfter({pointer:r,area:n().Zm[u],viewId:e,module:t,direction:l.insertDirection,beforeOrAfterId:l.beforeOrAfterId})]}const m=d[u],_=(null==p?void 0:p.area)===u?p.index:void 0,f=b({modulesInArea:m,indexOfModuleToUpsertInArea:_,indexToUpsertTo:c});if(!f)return;return[i().N4X.putModuleBeforeOrAfter({pointer:r,area:n().Zm[u],module:t,direction:f.insertDirection,beforeOrAfterId:f.beforeOrAfterId})]}({upsertPosition:o,rawModuleToUpsert:d,layoutPointer:t,modulesByArea:r});if("module_relative"===o.type)return[g({upsertPosition:o,rawModuleToUpsert:d,layoutPointer:t,modulesByArea:r})];if("area_relative"===o.type)return[h({upsertPosition:o,rawModuleToUpsert:d,layoutPointer:t,modulesByArea:r})];(0,m().HB)(o)}({module:p,upsertPosition:t,modulesByArea:w,layoutPointer:v,rawModuleToUpsert:A});B&&S.push(...B);const P="placeholder"===p.type&&"form_layout_schema"===t.area?`form_layout_new_question_${p.id}`:void 0;_().createAndCommitOrAppend({environment:o,undoCheckpoint:P,canUndo:!0,perform:e=>{f&&f({transaction:e});for(const o of S)_().applyOperation({transaction:e,store:r,operation:o})},transaction:u,userAction:c||"BuilderLayoutModules.upsert"}),y&&y()}function b(e){const{modulesInArea:o,indexOfModuleToUpsertInArea:t,indexToUpsertTo:r}=e;if(0===r||0===o.length)return{insertDirection:"before",beforeOrAfterId:void 0};const i=o.at(r);return i?void 0===t?{insertDirection:"before",beforeOrAfterId:i.id}:t!==r?t<r?{insertDirection:"after",beforeOrAfterId:i.id}:{insertDirection:"before",beforeOrAfterId:i.id}:void 0:{insertDirection:"after",beforeOrAfterId:void 0}}function g(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:a}=e,{area:d,direction:s,relativeToModuleId:p}=o,u=n().Zm[d],c=(0,l().JO)(a,(e=>e.id===p));if(!c||c.area!==d)throw new Error(`Cannot find module with id: ${p} to add upsert relative to in ${d}`);if("views_main_tab_modules"===u){const e="views_main_tab_modules"===c.area?c.viewId:void 0;if(!e)throw new Error("Cannot upsert module into views_main_tab_modules area that does not have views");return i().N4X.putModuleBeforeOrAfter({pointer:r,area:"views_main_tab_modules",viewId:e,module:t,direction:"above"===s?"before":"after",beforeOrAfterId:p})}return i().N4X.putModuleBeforeOrAfter({pointer:r,area:u,module:t,direction:"above"===s?"before":"after",beforeOrAfterId:p})}function h(e){const{upsertPosition:o,rawModuleToUpsert:t,layoutPointer:r,modulesByArea:a}=e,{location:d}=o;if("views_main_tab_modules"===o.area){const e=o.viewId,s={pointer:r,area:n().Zm[o.area],viewId:e,module:t};if("start"===d||"end"===d)return i().N4X.putModuleBeforeOrAfter({...s,direction:"start"===d?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===d){var l;const e=A({area:o.area,modulesInArea:(null===(l=a.views_main_tab_modules)||void 0===l?void 0:l[o.viewId])??[]});return i().N4X.putModuleBeforeOrAfter({...s,direction:e.insertDirection,beforeOrAfterId:e.beforeOrAfterId})}(0,m().HB)(d)}const s={pointer:r,area:n().Zm[o.area],module:t};if("start"===d||"end"===d)return i().N4X.putModuleBeforeOrAfter({...s,direction:"start"===d?"before":"after",beforeOrAfterId:void 0});if("end_moveable"===d){const e=a[o.area],t=A({area:o.area,modulesInArea:e});return i().N4X.putModuleBeforeOrAfter({...s,direction:t.insertDirection,beforeOrAfterId:t.beforeOrAfterId})}(0,m().HB)(d)}function A(e){const{area:o,modulesInArea:t}=e,{nonMoveableHeaderModules:r,moveableModules:i,nonMoveableFooterModules:n}=(0,p().jS)(o,t);if(i.length){const e=(0,c().HV)(i);if(!e)throw new Error("cannot find last moveable module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(r.length){const e=(0,c().HV)(r);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"after",beforeOrAfterId:e.id}}if(n.length){const e=n.at(0);if(!e)throw new Error("cannot find last header module to add below for end moveable");return{insertDirection:"before",beforeOrAfterId:e.id}}return{insertDirection:"after",beforeOrAfterId:void 0}}}}]);