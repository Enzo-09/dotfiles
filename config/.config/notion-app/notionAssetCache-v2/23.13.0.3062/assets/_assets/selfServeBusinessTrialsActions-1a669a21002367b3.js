"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[7520,65213,77970],{21735:(e,t,n)=>{n.d(t,{A:()=>i});class r extends(()=>n(757695))().default{getInitialState(){return{shouldUseEdgeCache:!1}}}const a=new r;n(604341).exposeDebugValue("EdgeCacheStore",a);const i=a},47273:(e,t,n)=>{n.d(t,{DS:()=>a,Fe:()=>l,GB:()=>s,Gf:()=>d,V_:()=>u,j1:()=>c,j8:()=>i,yp:()=>p,yw:()=>o});var r=()=>n(762433);function a(e){return(0,r().Fq)({subscription:e})}function i(e){return(0,r().Ry)({subscription:e,trial:void 0})}function s(e){let{subscriptionState:t,logFunction:n,spaceId:a}=e;const i=f(t);return(0,r().yB)({billingData:{subscription:i,trial:void 0},logFunction:n,spaceId:a})}function o(e){return(0,r().q8)({subscription:e})}function c(e){return(0,r().V9)({subscription:f(e),trial:void 0})}function l(e){return(0,r().d$)({subscription:f(e),trial:void 0})}function u(e){return(0,r().ji)({subscription:f(e),trial:void 0})}function d(e){return(0,r().AI)({subscription:f(e),trial:void 0})}function p(e,t){return(0,r().KH)({subscription:f(e),trial:void 0},t)}function f(e){return e?{...e,trialEnd:void 0}:void 0}},66460:(e,t,n)=>{n.d(t,{V_:()=>D,WR:()=>M,eu:()=>k,xE:()=>x,xX:()=>N});n(16280);var r=()=>n(244641),a=(n(296540),()=>n(857639)),i=()=>n(762433),s=()=>n(323063),o=()=>n(959013),c=()=>n(502800),l=()=>n(498212),u=()=>n(252105),d=()=>n(449506),p=()=>n(901389),f=()=>n(496414),m=()=>n(989423),v=()=>n(351360),y=()=>n(57605),g=()=>n(508496),S=()=>n(613240),_=()=>n(128265),b=()=>n(224701),w=()=>n(749356),I=()=>n(779795),h=()=>n(807778),A=()=>n(134217),C=()=>n(981046),E=()=>n(151168),T=n(474848);const B=(0,o().YK)({applyingBusinessTrial:{id:"trialUpsellActions.applyingBusinessTrial",defaultMessage:"Setting up your Business trialâ€¦"}});async function k(e){var t,n;const{environment:c,stripe:l,elements:d,trialData:f,trialDays:m,sessionId:g,customerName:S,businessName:_}=e;if(!d||!l)return void a().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:w}=await d.submit();if(w)return void u().$X(c,{error:"could not submit form",error_type:"payment_method"});const B=await l.createPaymentMethod({elements:d});if(B.error)return void u().$X(c,{error:B.error.message,error_type:"payment_method"});if(!B.paymentMethod)return void u().$X(c,{error:"could not create token",error_type:"payment_method"});const k={type:"paymentMethodId",value:B.paymentMethod.id},M=v().default.state.currentSpaceStore;if(!M)return;const D=M.id,N=await I().p_({environment:c,spaceId:D}),x=await y().A.awaitData(c,{spaceId:D});if(!x)throw new Error("Billing data not loaded");const L=(0,i().lQ)(x),V=C().A.state.selectedCurrencyCode??"USD",P=(0,E().Zr)(),U=(0,s().vk)(N,{interval:"month",product:P,currency:V}),O=(0,h().Le)(),F=(0,s().vH)(L,{price:U,quantity:1},{isMay13PackagingChangesEnabled:O}),R=r().c9.now().plus({days:m});return await async function(e){const{environment:t,spaceStore:n,paymentData:r,desiredState:a,stripe:i,trialData:s,customerName:c,businessName:l,addressZip:d,addressCountry:f,sessionId:m}=e,v=await y().A.awaitData(t,{spaceId:n.id});try{const e=await b().nV({environment:t,sessionId:m,spaceStore:n,desiredState:a,paymentData:r,from:"onboarding",trialData:s,billingEmail:(0,A().cs)(v),customerName:c,businessName:l,addressZip:d,addressCountry:f}),u=e.paymentIntentClientSecret,y=e.paymentIntentStatus;if(u&&"requires_action"===y){const{error:e}=await i.handleNextAction({clientSecret:u});e&&(await b().M2({environment:t,spaceStore:n,from:"subscription_upgrade_onboarding_failed_payment"}),p().f1((0,T.jsx)(o().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void u().AF(t)}}({environment:c,spaceStore:M,desiredState:{...F,trialEnd:R},paymentData:k,stripe:l,trialData:f,customerName:S,businessName:_,addressZip:(null===(t=B.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(n=B.paymentMethod.billing_details.address)||void 0===n?void 0:n.country)||"",sessionId:g})}const M=(0,n(496603).sg)(k,1e3,{leading:!0,trailing:!1});async function D(e){let{spaceId:t,environment:n}=e;if(await(0,w().L6)({environment:n,spaceId:t,offerCampaign:"reverse"})&&(0,h().s)(n)){await x(t,n,"going_multiplayer")&&await S().A.resetData(n,{spaceId:t})}}async function N(e,t,n){try{f().m({message:B.applyingBusinessTrial});const r=await d().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:"business_reverse",from:n}}});return"success"===r.type?((0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"business_reverse",success:"success"===r.data.status}}}),await b().Ow(t),f().V(),"success"===r.data.status):(L("business_reverse",t,r.error),f().V(),!1)}catch(r){return L("business_reverse",t,r),f().V(),!1}}async function x(e,t,n){let r="reverse";try{const a=await(0,_().G)(t),i=Boolean(g().default.checkGate({gateName:"apply_reverse_trial_key"}));a&&(r="reverse_mm_ent");const s=`${e}_timed_trial`,o=i?(0,l().gB)(s):void 0,c=await d().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:r,from:n},idempotencyKey:o}});return"success"===c.type?((0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:r,success:"success"===c.data.status}}}),await b().Ow(t),"success"===c.data.status):(L(r,t,c.error),!1)}catch(a){return L(r,t,a),!1}}function L(e,t,n){(0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),a().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,c().convertErrorToLog)(n)})}},271084:(e,t,n)=>{n.d(t,{k:()=>a});n(581454);class r extends(()=>n(757695))().default{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort(((e,t)=>{let[n,r]=e,[a,i]=t;return i-r})).map((e=>{let[t,n]=e;return t}))}}const a=new r;(0,n(604341).exposeDebugValue)("UserSimilarityStore",a)},323063:(e,t,n)=>{n.d(t,{HO:()=>f,V5:()=>c,Vr:()=>l,ef:()=>p,gL:()=>u,ng:()=>y,vH:()=>d,vk:()=>v,z2:()=>m});n(16280),n(269479),n(898992),n(354520),n(672577),n(581454),n(737550);var r=()=>n(720665),a=()=>n(762433),i=()=>n(47273),s=()=>n(622963),o=()=>n(979340);function c(e,t){return f(e.items,t.items).some((e=>{let[t,n]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const n=a().xp(e),r=a().xp(t);if(!n||!r)return!1;return o().o3[n]>o().o3[r]}(t,n)}))}function l(e,t,n){let{trialEnd:r,items:a}=t;return{trialEnd:r,items:a.map((t=>{const r=t.price.product,a=t.price.unitAmount.currencyCode,i=v(e,{interval:n,product:r,currency:a});return{...t,price:i}}))}}function u(e,t){const n=e.items.filter((e=>a().IE(e)!==t));return{...e,items:n}}function d(e,t,n){const{isMay13PackagingChangesEnabled:r}=n,i=a().IE(t),s=t.price.product,o=e.items.filter((e=>{const t=e.price.product,n=a().IE(e);return!(i===n)&&!(r&&"ai"===t&&("business"===s||"enterprise"===s))}));return{...e,items:o.concat([t])}}function p(e){const{state:t,prices:n,quantities:r,params:{interval:i,currency:s},products:o,flags:{isMay13PackagingChangesEnabled:c}}=e,l=o.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),u=l.map((e=>a().Mr(e))),d=t.items.filter((e=>{const t=e.price.product,n=a().IE(e),r=u.includes(n),i=c&&"ai"===t&&(l.includes("business")||l.includes("enterprise"));return!r&&!i})),p=l.map((e=>y(v(n,{interval:i,currency:s,product:e}),r)));return{...t,items:d.concat(p)}}function f(e,t){return(0,r().Z4)(e,(e=>a().IE(e)),t,(e=>a().IE(e)))}function m(e){const{prices:t,billingData:n,product:r}=e,s=a().Ry(n),o=a().lQ(n),c=i().yw(o),l=a().q8(n),u=c??l;return t.find((e=>e.product===r&&e.billingInterval===u&&e.unitAmount.currencyCode===s))}function v(e,t){let{interval:n,product:r,currency:a}=t;return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===r&&e.billingInterval===n&&e.unitAmount.currencyCode===a)),`Unable to find price with interval: ${n}, product: ${r}, currency: ${a}`)}function y(e,t){const{numSeats:n,numCustomHostnames:r}=t;return"public_domain_custom_hostnames"===(0,s().vK)(e.product)?{price:e,quantity:r}:{price:e,quantity:n}}},461946:(e,t,n)=>{n.d(t,{$G:()=>i,$z:()=>p,BV:()=>u,WL:()=>a,YO:()=>c,e3:()=>o,x5:()=>s,yL:()=>l});n(898992),n(672577);var r=()=>n(166386);const a=30,i=5,s=3;function o(e){return Boolean(p(e)||d(e))}function c(e){return p(e)||d(e)}function l(e){const t=p(e)||d(e);if(t)return(0,r().Vm)(t)}function u(e){const t=p(e)||d(e);if(t)return(0,r().kd)(t)}function d(e){var t;return null===(t=f(e))||void 0===t?void 0:t.find((e=>{let{offer:t}=e;return"trial"===t.type&&"business_reverse"===t.campaign}))}function p(e){var t;return null===(t=f(e))||void 0===t?void 0:t.find((e=>{let{offer:t}=e;return"stacked_business_trial"===t.campaign}))}function f(e){if(e)return Array.isArray(e)?e:[e]}},529803:(e,t,n)=>{n.d(t,{A:()=>a});class r extends(()=>n(757695))().default{}const a=new r},624199:(e,t,n)=>{n.d(t,{L3:()=>i,Sp:()=>o,iJ:()=>a,uE:()=>s});var r=()=>n(757695);const a=r().default.createValue({open:!1,openedFrom:void 0},{name:"SelfServeBusinessTrialStartModalStore"}),i=r().default.createValue({open:!1,openedFrom:"plans_page",recentPageStores:[],verifiedPageStores:[],teamStores:[],workspaceUserStores:[],connectedApps:[],modalState:"initial"},{name:"SelfServeBusinessTrialEndingModalStore"}),s=r().default.createValue({open:!1,openedFrom:void 0,connectedApps:[],teamStores:[],pageStores:[],onSecondaryButtonClick:void 0},{name:"SelfServeBusinessTrialLossAversionModalStore"}),o=r().default.createValue({open:!1,connectedApps:[],teamStores:[],pageStores:[]},{name:"SelfServeBusinessTrialExplorePlanStore"})},655765:(e,t,n)=>{n.r(t),n.d(t,{applyMultiplayerReverseTrialIfEligible:()=>l().V_,applyReverseBusinessTrial:()=>l().xX,applyReversePlusTrial:()=>l().xE,handleTrialUpgradeFromOnboarding:()=>l().WR,handleTrialUpgradeFromOnboardingImpl:()=>l().eu,isEligibleForBlockLimitTimedTrial:()=>c});var r=()=>n(130382),a=()=>n(762433),i=()=>n(57605),s=()=>n(128265),o=()=>n(749356);async function c(e,t){const n=await i().A.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,a().AI)(n))return!1;const c=null==t?void 0:t.getSetting("reach_block_limit_time");if(!c||(0,r().Mn)(c)<3)return!1;if(await(0,s().G)(e))return!1;const l=t.getSpaceId();return!!(await(0,o().L6)({environment:e,spaceId:l,offerCampaign:"default"}))}var l=()=>n(66460)},749356:(e,t,n)=>{n.d(t,{VY:()=>p,Qm:()=>f,z6:()=>d,OC:()=>y,L6:()=>m,Zc:()=>g,x3:()=>v});var r=()=>n(857639),a=()=>n(386164);const i={plans_page:["lic_25","lic_50","resurrection_offer","ai_fifty_percent_upgrade"],sidebar_upsell:["lic_25","lic_50"]};var s=()=>n(502800),o=()=>n(449506),c=()=>n(901389),l=()=>n(989423),u=()=>n(351360);async function d(e,t){var n;const{spaceId:r,offerCampaign:a}=t;if(!r||!a||null===(n=u().default.state.currentSpaceStore)||void 0===n||!n.canAdmin())return;const i=await o().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:r,offerCampaign:a}});return"failed"!==i.type&&"offer"in i.data&&i.data.offer?i.data.offer:void 0}async function p(e){const{environment:t,spaceId:n,offerCampaign:r,entrypoint:a}=e,i=await o().callApi({eventName:"applyCustomerOffer",environment:t,data:{spaceId:n,offerCampaign:r,entrypoint:a??"unknown"}});if("failed"!==i.type)return i;c().Qg(i)}async function f(e,t){const n=await o().callApi({eventName:"applyCustomerOffer",environment:e,data:{...t}});if("failed"!==n.type)return n;c().Qg(n)}async function m(e){const{environment:t,spaceId:n,offerCampaign:r}=e;return void 0!==await d(t,{spaceId:n,offerCampaign:r})}async function v(e){var t;const{environment:n,hasReceived:i,offerType:c,newPlan:l,coupon:d}=e,p=null===(t=u().default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId();if(!p)return;const f=await o().callApi({eventName:"updateCustomerOffer",environment:n,data:{spaceId:p,hasReceived:i,offerType:c,newPlan:l,coupon:d},headers:(0,a().WS)({cellId:void 0,spaceId:p})});"failed"===f.type&&r().log({level:"error",from:"offerActions",type:"updateLegacyCustomerOfferFailed",error:(0,s().convertErrorToLog)(f.error)})}async function y(e,t,n){const r=function(e){if(i.hasOwnProperty(e))return i[e]}(n);if(r)for(const a of r){const n=await d(e,{spaceId:t,offerCampaign:a});if((null==n?void 0:n.campaign)===a)return n}}function g(e){let{environment:t,spaceName:n,offerCampaign:r}=e;if(n)switch(r){case"lic_25":case"lic_50":(0,l().WU)(t,"lic_offer_eligible","lic_offer_eligible",3600,{workspace_name:n,lic_25:"lic_25"===r,lic_50:"lic_50"===r});break;case"resurrection_offer":(0,l().WU)(t,"resurrection_offer_eligible","resurrection_offer_eligible",3600,{workspace_name:n});break;default:return}}},922442:(e,t,n)=>{n.r(t),n.d(t,{closeSelfServeBusinessTrialEndingModal:()=>m,closeSelfServeBusinessTrialExplorePlanModal:()=>S,closeSelfServeBusinessTrialLossAversionModal:()=>y,closeSelfServeBusinessTrialStartModal:()=>p,createSelfServeBusinessTrial:()=>_,openSelfServeBusinessTrialEndingModal:()=>f,openSelfServeBusinessTrialExplorePlanModal:()=>g,openSelfServeBusinessTrialLossAversionModal:()=>v,openSelfServeBusinessTrialStartModal:()=>d});var r=()=>n(244641),a=()=>n(762433),i=()=>n(323063),s=()=>n(461946),o=()=>n(981046),c=()=>n(624199),l=()=>n(655765),u=()=>n(411341);function d(e){c().iJ.setState({open:!0,...e})}function p(){c().iJ.update((e=>({...e,open:!1})))}function f(e){c().L3.update((()=>({...e,open:!0})))}function m(){c().L3.update((e=>({...e,open:!1,modalState:"initial"})))}function v(e){c().uE.setState({...e,open:!0})}function y(){c().uE.update((e=>({...e,open:!1})))}function g(e){c().Sp.setState({open:!0,...e})}function S(){c().Sp.update((e=>({...e,open:!1})))}async function _(e){const{billingData:t,environment:n,spaceStore:c,from:d,memberData:p,prices:f,campaign:m="stacked_business_trial"}=e;if(!c||!d||!t||p.loading)return;if("free"===(0,a().AI)(t))return void(await(0,l().applyReverseBusinessTrial)(c.id,n,d));const v=e.nowForTesting??r().c9.now(),y=p.members.length,g={product:"business",interval:"month",currency:o().A.state.selectedCurrencyCode??"USD"},S={items:[{price:(0,i().vk)(f,g),quantity:y}],trialEnd:v.plus({days:s().WL})};await(0,u().updateSubscription)({environment:n,spaceStore:c,from:d,desiredState:S,trialData:{id:m,from:d}})}}}]);