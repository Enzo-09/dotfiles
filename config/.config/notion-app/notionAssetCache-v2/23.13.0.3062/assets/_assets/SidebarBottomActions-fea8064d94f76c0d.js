"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[66249],{21735:(e,t,n)=>{n.d(t,{A:()=>s});class r extends(()=>n(757695))().default{getInitialState(){return{shouldUseEdgeCache:!1}}}const o=new r;n(604341).exposeDebugValue("EdgeCacheStore",o);const s=o},32614:(e,t,n)=>{n.r(t),n.d(t,{SidebarBottomActions:()=>x});var r=n(296540),o=()=>n(484714),s=()=>n(847249),a=()=>n(401497),i=()=>n(959013),c=()=>n(159588),l=()=>n(360088),d=()=>n(963589),u=()=>n(962730),p=()=>n(351360),m=()=>n(324561),v=()=>n(998109),h=()=>n(27569),b=()=>n(187174),g=()=>n(755199),y=()=>n(440209),S=()=>n(680074),f=()=>n(640653),I=()=>n(574752),C=()=>n(718807);var w=()=>n(859428),A=()=>n(309534),P=()=>n(913507),M=()=>n(763336),B=()=>n(679915),k=n(474848);function x(){const e=(0,o().v3)(),t=(0,s().O$)(p().AppStoreMainEditorCurrentBlockStore),n=(0,s().O$)(p().AppStoreCurrentSpaceStore),x=(0,m().f_)({spaceId:null==n?void 0:n.id}),_=(0,a().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:1},sidebarItemButtonStyle:{...(0,c().sQ)({isMobile:!1})},sidebarItemHoveredStyle:{background:e.sidebarItemSelectedBackground},sidebarItemActiveStyle:{...(0,c().sQ)({isMobile:!1}),background:e.sidebarItemSelectedBackground,color:e.text.primary}})),[]),T=(0,d().X)("tablet_refresh_gate"),{isTablet:U}=(0,o().Y0)(),q=(0,l().p)(),L=function(e){let{environment:t}=e;const n=(0,s().K8)((()=>(0,f().s7)(t)),[t]),{isDesktop:a}=(0,o().Y0)(),i=(0,s().K8)((()=>C().Ay.state.isTrashEmpty),[]),c=(0,s().K8)((()=>(0,y().f1)({environment:t,experimentId:"adoption_hide_features_v2",variant:h().T.trash,isUserWorkspaceOwner:n,isDesktop:a})),[t,n,a]),l=(0,s().K8)((()=>{var e;const n=(0,S().R$)(t);return(null==n||null===(e=n.getSettings())||void 0===e?void 0:e.adoption_sidebar_trash)??!1}),[t]),[{value:d}]=(0,b().Yb)((async()=>!(!l&&c)||!(await(0,I().checkIsTrashEmpty)(t))),[t,l,c]);return(0,r.useEffect)((()=>{!c||l||i||g().hT(t)}),[c,l,i,t]),!c||!i||d||l}({environment:e}),N=(0,h().I)({environment:e,section:"templates"}),E=(0,h().I)({environment:e,section:"settings"});return(0,k.jsxs)("div",{style:_.container,children:[q&&T&&(0,k.jsx)(B().A,{hasActivePlan:(0,m().UU)(x)}),E&&(0,k.jsx)(A().A,{buttonStyles:{hoveredStyle:_.sidebarItemHoveredStyle}}),!U&&N&&(0,k.jsx)(v().n,{step:"explore_templates",children:(0,k.jsx)(M().W,{styles:{sidebarItemButtonStyle:_.sidebarItemButtonStyle,buttonHoveredStyle:_.sidebarItemHoveredStyle,sidebarItemActiveStyle:_.sidebarItemActiveStyle}})}),L?t?(0,k.jsx)(w().A,{renderTooltip:()=>(0,k.jsx)(i().sA,{defaultMessage:"Restore deleted pages.",id:"sidebar.openTrashModalButton.tooltip"}),originGap:6,placement:u().W.Right,render:e=>(0,k.jsx)(P().A,{store:t,buttonStyles:{hoveredStyle:_.sidebarItemHoveredStyle},isMobile:!1,...e})}):(0,k.jsx)(w().A,{renderTooltip:()=>(0,k.jsx)(i().sA,{defaultMessage:"Unable to use trash from this view.",id:"sidebar.openTrashModalButton.tooltip.disabled"}),originGap:6,placement:u().W.Right,render:e=>(0,k.jsx)(P().B,{buttonStyles:{hoveredStyle:_.sidebarItemHoveredStyle},isMobile:!1,...e})}):null]})}},180566:(e,t,n)=>{n.d(t,{Q:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("newSidebarTrash",{viewBox:"0 0 20 20",svg:(0,r.jsx)("g",{children:(0,r.jsx)("g",{id:"Layer_1",children:(0,r.jsx)("path",{d:"M16.5,5.25h-2.75v-1.25c0-.9648438-.7851562-1.75-1.75-1.75h-4c-.9648438,0-1.75.7851562-1.75,1.75v1.25h-2.75c-.4140625,0-.75.3359375-.75.75s.3359375.75.75.75h.7835083l.3805542,8.375c.0668945,1.4716797,1.2739258,2.625,2.7470703,2.625h5.1777344c1.4736328,0,2.6796875-1.1533203,2.7470703-2.625l.3809814-8.375h.7830811c.4140625,0,.75-.3359375.75-.75s-.3359375-.75-.75-.75ZM7.75,4c0-.1376953.1123047-.25.25-.25h4c.1376953,0,.25.1123047.25.25v1.25h-4.5v-1.25ZM13.8378906,15.0566406c-.03125.6689453-.5791016,1.1933594-1.2490234,1.1933594h-5.1777344c-.6699219,0-1.2182617-.5244141-1.2490234-1.1933594l-.3774414-8.3066406h8.4301758l-.3769531,8.3066406ZM8.875,8.5v6c0,.3447266-.2797852.625-.625.625s-.625-.2802734-.625-.625v-6c0-.3452148.2797852-.625.625-.625s.625.2797852.625.625ZM12.375,8.5v6c0,.3447266-.2802734.625-.625.625s-.625-.2802734-.625-.625v-6c0-.3452148.2802734-.625.625-.625s.625.2797852.625.625Z"})})})})},240865:(e,t,n)=>{n.d(t,{V:()=>s});var r=()=>n(847249),o=()=>n(351360);function s(){return(0,r().K8)((()=>{const{currentSpaceStore:e}=o().default.state;return(null==e?void 0:e.getMemberCountFromPublicSpaceData())??void 0}),[])}},253093:(e,t,n)=>{n.d(t,{j:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("newSidebarSettings",{viewBox:"0 0 20 20",svg:(0,r.jsx)("path",{d:"M10 13C8.35003 13 7.00003 11.65 7.00003 10C7.00003 8.35 8.35003 7 10 7C11.65 7 13 8.35 13 10C13 11.65 11.65 13 10 13ZM10 8.5C9.17003 8.5 8.50003 9.17 8.50003 10C8.50003 10.83 9.17003 11.5 10 11.5C10.83 11.5 11.5 10.83 11.5 10C11.5 9.17 10.83 8.5 10 8.5ZM10.02 18.45C9.45003 18.45 8.90003 18.4 8.36003 18.29C8.08003 18.23 7.85003 18.01 7.80003 17.72L7.51003 16.06C7.51003 16.06 7.42003 16.02 7.37003 16L6.01003 16.96C5.77003 17.13 5.45003 17.13 5.21003 16.96C4.78003 16.67 4.39003 16.34 4.03003 15.98C3.63003 15.57 3.27003 15.15 2.97003 14.69C2.81003 14.45 2.81003 14.13 2.97003 13.9L3.94003 12.52C3.94003 12.52 3.90003 12.43 3.88003 12.38L2.24003 12.1C1.95003 12.05 1.72003 11.83 1.67003 11.54C1.58003 11.04 1.53003 10.52 1.53003 10.01C1.53003 9.44 1.58003 8.89 1.69003 8.35C1.75003 8.07 1.97003 7.84 2.26003 7.79L3.92003 7.5C3.92003 7.5 3.96003 7.41 3.98003 7.36L3.02003 6C2.85003 5.76 2.85003 5.44 3.02003 5.2C3.31003 4.78 3.64003 4.38 4.00003 4.02C4.40003 3.62 4.83003 3.27 5.28003 2.96C5.52003 2.8 5.84003 2.8 6.07003 2.96L7.45003 3.93C7.45003 3.93 7.54003 3.89 7.59003 3.87L7.87003 2.23C7.92003 1.94 8.14003 1.71 8.43003 1.66C8.93003 1.57 9.45003 1.52 9.96003 1.52C10.53 1.52 11.08 1.57 11.62 1.68C11.91 1.74 12.13 1.96 12.17 2.25L12.46 3.91C12.46 3.91 12.55 3.95 12.6 3.97L13.96 3.01C14.2 2.84 14.52 2.84 14.76 3.01C15.18 3.3 15.58 3.63 15.94 3.99C16.35 4.4 16.7 4.82 17 5.27C17.16 5.51 17.16 5.83 17 6.06L16.03 7.44C16.03 7.44 16.07 7.53 16.09 7.58L17.73 7.86C18.02 7.91 18.24 8.13 18.3 8.42C18.39 8.92 18.44 9.44 18.44 9.95C18.44 10.52 18.39 11.07 18.28 11.61C18.22 11.89 18 12.12 17.71 12.16L16.05 12.45C16.05 12.45 16.01 12.54 15.99 12.59L16.95 13.95C17.12 14.19 17.12 14.51 16.95 14.75C16.66 15.17 16.33 15.57 15.97 15.93C15.57 16.34 15.14 16.69 14.69 16.99C14.45 17.15 14.13 17.15 13.9 16.99L12.52 16.02C12.52 16.02 12.43 16.06 12.38 16.08L12.1 17.72C12.05 18.01 11.83 18.23 11.54 18.29C11.04 18.38 10.52 18.43 10.01 18.43L10.02 18.45ZM9.10003 16.99C9.68003 17.06 10.26 17.06 10.82 16.99L11.09 15.44C11.13 15.18 11.32 14.97 11.57 14.89C11.82 14.81 12.07 14.71 12.3 14.59C12.53 14.47 12.8 14.5 13.02 14.64L14.32 15.56C14.56 15.38 14.78 15.18 14.99 14.97C15.19 14.77 15.37 14.57 15.54 14.36L14.64 13.08C14.49 12.87 14.47 12.58 14.59 12.35C14.7 12.13 14.8 11.89 14.89 11.62C14.97 11.37 15.18 11.19 15.43 11.15L17 10.88C17.04 10.58 17.06 10.28 17.06 9.99C17.06 9.71 17.04 9.44 17.01 9.17L15.46 8.9C15.2 8.86 14.99 8.67 14.91 8.42C14.83 8.17 14.73 7.92 14.61 7.69C14.49 7.46 14.52 7.18 14.66 6.97L15.58 5.67C15.4 5.44 15.2 5.21 14.99 5C14.79 4.8 14.59 4.62 14.37 4.45L13.09 5.35C12.88 5.5 12.6 5.52 12.37 5.4C12.15 5.29 11.91 5.19 11.64 5.1C11.4 5.02 11.22 4.81 11.17 4.56L10.9 2.99C10.33 2.92 9.74003 2.92 9.18003 2.99L8.91003 4.54C8.87003 4.8 8.68003 5.01 8.43003 5.09C8.18003 5.17 7.93003 5.27 7.70003 5.39C7.47003 5.51 7.19003 5.49 6.98003 5.34L5.68003 4.42C5.44003 4.6 5.22003 4.8 5.01003 5.01C4.81003 5.21 4.63003 5.41 4.46003 5.62L5.36003 6.9C5.51003 7.11 5.53003 7.39 5.41003 7.62C5.30003 7.84 5.20003 8.08 5.11003 8.35C5.03003 8.59 4.82003 8.77 4.57003 8.82L3.00003 9.09C2.96003 9.39 2.94003 9.69 2.94003 9.98C2.94003 10.26 2.96003 10.53 2.99003 10.8L4.54003 11.07C4.80003 11.11 5.01003 11.3 5.09003 11.55C5.17003 11.8 5.27003 12.05 5.39003 12.28C5.50003 12.51 5.48003 12.79 5.34003 13L4.42003 14.3C4.60003 14.54 4.80003 14.76 5.01003 14.97C5.21003 15.17 5.41003 15.35 5.62003 15.52L6.90003 14.62C7.11003 14.47 7.39003 14.45 7.63003 14.57C7.85003 14.68 8.09003 14.78 8.36003 14.87C8.61003 14.95 8.79003 15.16 8.83003 15.41L9.10003 16.98V16.99Z"})})},271084:(e,t,n)=>{n.d(t,{k:()=>o});n(581454);class r extends(()=>n(757695))().default{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort(((e,t)=>{let[n,r]=e,[o,s]=t;return s-r})).map((e=>{let[t,n]=e;return t}))}}const o=new r;(0,n(604341).exposeDebugValue)("UserSimilarityStore",o)},305837:(e,t,n)=>{n.d(t,{H:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("settingsUpgradeFilled",{viewBox:"0 0 20 20",svg:(0,r.jsx)("path",{d:"M10 19c4.935 0 9.009-4.073 9.009-9 0-4.926-4.082-9-9.018-9C5.065 1 1 5.074 1 10c0 4.927 4.074 9 9 9zm0-4.422c-.47 0-.818-.33-.818-.8v-4.23l.087-1.863-.81 1.01-1 1.053a.762.762 0 01-.558.235c-.435 0-.757-.314-.757-.74 0-.218.07-.392.218-.549l2.994-3.029c.2-.217.4-.313.644-.313.261 0 .461.104.662.313l2.976 3.03a.73.73 0 01.227.548c0 .426-.322.74-.758.74a.73.73 0 01-.557-.235l-.992-1.045-.818-1.027.087 1.871v4.23c0 .47-.348.801-.827.801z"})})},309534:(e,t,n)=>{n.d(t,{A:()=>i,O:()=>a});var r=n(296540),o=()=>n(959013),s=n(474848);const a=(0,o().YK)({settingsAndMembers:{id:"sidebarSettingsButton.settingsAndMembers",defaultMessage:"Settings & members"},settings:{id:"sidebarSettingsButton.settings",defaultMessage:"Settings"},tooltip:{id:"sidebarSettingsButton.tooltip",defaultMessage:"Manage your account and settings"}}),i=function(e){const{buttonStyles:t}=e,i=(0,o().tz)(),c=i.formatMessage(a.settings),l=(0,n(644914).ab)(),d=(0,r.useCallback)((()=>{n(209660).Ow({openedFrom:"sidebar",currentTab:"user_settings"})}),[]);return(0,s.jsx)(n(859428).A,{renderTooltip:()=>i.formatMessage(a.tooltip),originGap:6,textWrap:!0,placement:n(962730).W.Right,render:e=>(0,s.jsx)(n(704152).A,{...e,onClick:d,style:l.baseSidebarItem,hoveredStyle:null==t?void 0:t.hoveredStyle,children:(0,s.jsx)(n(490044).A,{left:(0,n(253093).j)(l.topButtonIcon),children:c})})})}},324561:(e,t,n)=>{n.d(t,{Gi:()=>v,OD:()=>d,Q7:()=>m,UU:()=>h,_3:()=>p,a9:()=>u,f_:()=>l});var r=()=>n(484714),o=()=>n(847249),s=()=>n(857639),a=()=>n(762433),i=()=>n(596513),c=()=>n(714300);function l(e){let{spaceId:t}=e;const n=(0,r().v3)();return(0,o().K8)((()=>{if(t)return i().t.getData(n,{spaceId:t})}),[n,t])}function d(e){let{environment:t,spaceId:n}=e;return n?i().t.awaitData(t,{spaceId:n}):Promise.resolve(void 0)}function u(e){if("admin"===(null==e?void 0:e.type))return e}function p(e){let{spaceId:t}=e;return u((0,c().l)({spaceId:t}))}function m(e,t,n){if(!t)return 0;const r=(0,a().yB)({spaceId:e,logFunction:s().log.bind(s()),billingData:t});return r?Math.max(r,n):0}function v(e){var t;const n=null===(t=(0,a().KH)(e,"plan"))||void 0===t?void 0:t.price;if(!n)return;const r=n.unitAmount,o="year"===n.billingInterval?12:1;return{amount:r.amount/o,currencyCode:r.currencyCode}}function h(e){return"app_store"===(null==e?void 0:e.provider)||"play_store"===(null==e?void 0:e.provider)||"mixed"===(null==e?void 0:e.provider)}},360088:(e,t,n)=>{n.d(t,{p:()=>p});var r=()=>n(484714),o=()=>n(847249),s=()=>n(762433),a=()=>n(600871),i=()=>n(155959),c=()=>n(324561),l=()=>n(176983),d=()=>n(240865),u=()=>n(58293);function p(){const e=(0,r().v3)(),t=(0,l().J)(),n=(0,d().V)(),p=(0,u().r)(),m=(0,c().f_)({spaceId:null==p?void 0:p.id});return(0,o().K8)((()=>!!(0,a().mM)({environment:e})&&(!(!m||!t||1!==n)&&((0,i().T)("supportsAiIAP")?(0,c().UU)(m)||!(0,s().Fq)(m):!(0,c().UU)(m)&&!(0,s().Fq)(m)))),[e,m,t,n])}},574752:(e,t,n)=>{n.r(t),n.d(t,{ENGLISH_PERSONAL_PRONOUNS:()=>Be,TEST_ONLY__getVisibleSpaceUserIds:()=>ke,checkIsTrashEmpty:()=>pe,getLocalCacheFromAppState:()=>re,isPersonalPronoun:()=>Me,searchActorsById:()=>Ue,searchCollections:()=>me,searchCollectionsWithRecents:()=>ve,searchEdgeCacheSpaceUsers:()=>Ae,searchEmailUser:()=>Te,searchInstallableIntegrations:()=>fe,searchLocalNavigableBlocks:()=>he,searchMentionablePages:()=>qe,searchPageIds:()=>se,searchPageIdsInAncestor:()=>de,searchPagesInAncestor:()=>le,searchPagesInCollection:()=>ae,searchPagesInSpace:()=>oe,searchPagesWithParent:()=>ie,searchPublicPages:()=>Ne,searchSpaceActorIds:()=>_e,searchSpaceActors:()=>xe,searchSpaceBots:()=>ge,searchSpaceGroups:()=>be,searchTeams:()=>Ee,searchTrashPages:()=>ue,searchUsers:()=>Ce,searchVisibleSpaceUsers:()=>we});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(430670),n(581454);var r=n.n(n(844751)),o=()=>n(799288),s=()=>n(842599),a=()=>n(617871),i=()=>n(857639),c=()=>n(142748),l=()=>n(68263),d=()=>n(388821),u=()=>n(861017),p=()=>n(179034),m=()=>n(824862),v=()=>n(519831),h=()=>n(96689),b=()=>n(798880),g=()=>n(245241),y=()=>n(468006),S=()=>n(919709),f=()=>n(695608),I=()=>n(778078),C=()=>n(496603),w=()=>n(763824),A=()=>n(498212),P=()=>n(973647),M=()=>n(534177),B=()=>n(720665),k=()=>n(449506),x=()=>n(908928),_=()=>n(518362),T=()=>n(780054),U=()=>n(989423),q=()=>n(186445),L=()=>n(47373),N=()=>n(108944),E=()=>n(731320),j=()=>n(825972),V=()=>n(780865),F=()=>n(698449),R=()=>n(406792),O=()=>n(696746),D=()=>n(351360),W=()=>n(227440),z=()=>n(605402),H=()=>n(21735),G=()=>n(508496),K=()=>n(968172),Z=()=>n(20199),Q=()=>n(558407),X=()=>n(630116),Y=()=>n(271084),$=()=>n(224701),J=()=>n(134217),ee=()=>n(749240),te=()=>n(690978),ne=()=>n(448433);async function re(e){const{currentSpaceStore:t,currentSpaceViewStore:n}=D().default.state;if(!t)return;return G().default.checkGate({gateName:"search_use_local_search_cache"})?(Z().A.state.localSearchableBlocksCache||await Z().A.waitUntil((()=>Boolean(Z().A.state.localSearchableBlocksCache))),Z().A.state.localSearchableBlocksCache):await(0,ne().h)({environment:e,currentSpaceStore:t,currentSpaceViewStore:n})}async function oe(e){const{environment:t,query:n,limit:r,currentPageId:o,searchSessionId:s,searchSessionFlowNumber:a,recentlyMentionedPageIds:i,spaceId:c,requireEditPermissions:l,excludeTemplates:u,source:p,boostRecentlyViewedPages:m,ignoresHighlight:v,filterOverrides:h}=e,{currentSpaceStore:b}=D().default.state,y={results:[],recordMap:d().RecordMapWithRole.create().toJson(),total:0,trackEventProperties:void 0};if(!b)return y;const S=await re(t),f=g().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:u,requireEditPermissions:l||void 0,...h}),I={field:"relevance"};if(!n&&S){const e=(0,te().k)({query:{query:{text:n,filters:f,sort:I},limit:r},localCachedPages:S,userId:t.currentUser.id,environment:t});return e||y}const C=await k().callApi({eventName:"search",environment:t,data:{type:g().Vz.BlocksInSpace,query:n,spaceId:c,currentPageId:o,searchSessionId:s,searchSessionFlowNumber:a,recentlyMentionedPageIds:i,limit:r,filters:f,sort:I,source:p,recentPagesForBoosting:m?(0,j().cs)(K().A.getWithoutSubscribing(c)):void 0,ignoresHighlight:v}});if("failed"===C.type)throw C.error;return C.data}async function se(e){const t=await oe(e);return{results:t.results.map((e=>e.id)),recordMap:t.recordMap}}async function ae(e){const{environment:t,query:n,collectionId:r,limit:o,spaceId:s,excludeTemplates:a,source:i,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:l,ignoresHighlight:d}=e,u=new Array,p=await re(t),m=g().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:a}),h={field:"relevance"},b=k().callApi({eventName:"search",environment:t,data:{type:g().Vz.BlocksInCollection,query:n,spaceId:s,collectionId:r,limit:o,filters:m,sort:h,source:i,recentPagesForBoosting:l?(0,j().cs)(K().A.getWithoutSubscribing(s)):void 0,ignoresHighlight:d}});if(p){const e={table:v().Vl,id:r,spaceId:s},a=new(X().md)(t,e);await a.load();const i=(0,te().k)({query:{query:{text:n,filters:a.isPageTreeCollection()?{...m,ancestors:[r]}:{...m,parentId:r},sort:h},limit:o},localCachedPages:p,userId:t.currentUser.id,environment:t});i&&u.push(...i.results)}const y=await b;if("failed"===y.type){if(0===u.length)throw y.error}else{let e=y.data.results;n||(e=V().Fj({sort:h,batchSize:o,currentUserId:t.currentUser.id,unsorted:e})),u.push(...e)}return{results:C().oE(C().sb(u.map((e=>e.id))))}}async function ie(e){const{environment:t,query:n,parentId:r,limit:o,spaceId:s,excludeTemplates:a,source:i,includePublicPagesWithoutExplicitAccess:c,boostRecentlyViewedPages:l,ignoresHighlight:d}=e,[u,p]=await Promise.all([k().callApi({eventName:"search",environment:t,data:{type:g().Vz.BlocksInParent,query:n,spaceId:s,parentId:r,limit:o,filters:g().N2({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:c,excludeTemplates:a}),sort:{field:"relevance"},source:i,recentPagesForBoosting:l?(0,j().cs)(K().A.getWithoutSubscribing(s)):void 0,ignoresHighlight:d}}),ce(e)]);if("failed"===u.type)throw u.error;return{results:C().oE(C().sb([p,...u.data.results.map((e=>e.id))]))}}async function ce(e){const{environment:t,query:n,parentId:r,spaceId:o}=e,s=(0,u().parseRoute)({url:n,baseUrl:T().A.domainBaseUrl,publicDomainName:T().A.publicDomainName,isMobile:t.device.isMobile,protocol:T().A.protocol,currentUrl:window.location.href}),a="page"===s.name?s.peekViewBlockId||s.blockId:void 0,i=((0,A().c_)(n)?(0,A().np)(n):void 0)||a;if(i){const e={table:p().ev,id:i},n=new(X().Bv)(t,e);await n.load();const s=n.id,a=n.getParentId(),c=n.getSpaceId();if(a===r&&c===o)return s}}async function le(e){const{environment:t,query:n,ancestorId:r,limit:o,excludeTemplates:s,source:a,currentPageId:i,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:d,ignoresHighlight:u,includePublicPagesWithoutExplicitAccess:p,spaceId:m}=e,v=await k().callApi({eventName:"search",environment:t,data:{type:g().Vz.BlocksInAncestor,query:n,ancestorId:r,filters:g().N2({navigableBlockContentOnly:!0,excludeTemplates:s,includePublicPagesWithoutExplicitAccess:p}),sort:{field:"relevance"},limit:o,source:a,spaceId:m,currentPageId:i,searchSessionId:c,searchSessionFlowNumber:l,recentlyMentionedPageIds:d,ignoresHighlight:u}});if("failed"===v.type)throw v.error;return v.data}async function de(e){return{results:(await le(e)).results.map((e=>e.id))}}async function ue(e){const{environment:t,query:n,limit:r,spaceId:o}=e,s=0===n.trim().length?{field:"lastEdited",direction:"desc"}:{field:"relevance"},a={query:n,filters:g().N2({isDeletedOnly:!0,navigableBlockContentOnly:!0,excludeTemplates:!1,editedBy:e.editedByIds||[],ancestors:e.ancestorIds||[],inTeams:e.teamspaceIds||[]}),sort:s,limit:r,spaceId:o,source:"trash"},i=k().callApi({eventName:"search",environment:t,data:{type:g().Vz.BlocksInSpace,...a}}),c=await i;if("failed"===c.type)throw c.error;{const{results:e,recordMap:t,total:n}=c.data;return{results:e.map((e=>e.id)),recordMap:d().RecordMapWithRole.create(t),endOfResultsReached:n===e.length}}}async function pe(e){const{currentSpaceStore:t,currentUserStore:n}=D().default.state;if(!t||!n)return!1;return 0===(await ue({environment:e,query:"",limit:1,spaceId:t.id,ancestorIds:[],editedByIds:[],teamspaceIds:[]})).results.length}async function me(e,t){const{query:n,limit:r,source:o,requireEditPermissions:s,databaseType:a,spaceStore:i,searchSessionId:c}=t;if(!i)return{results:[],total:0};const l=i.id,[d,u]=await Promise.all([je(e,{...t,spaceId:l,requireEditPermissions:s,databaseType:a,parentStore:i}),k().callApi({eventName:"search",environment:e,data:{type:g().Vz.CollectionsInSpace,query:n,spaceId:l,limit:r,filters:{...g().N2({excludeTemplates:!0,requireEditPermissions:s,databaseType:a})},sort:{field:"relevance"},source:o,recentPagesForBoosting:(0,j().cs)(K().A.get(l)),searchSessionId:c}})]),p=C().KC("success"===u.type?C().oE(u.data.results.map((e=>e.collectionId))):[],d).slice(0,r);return{results:p,total:"success"===u.type?u.data.total:p.length}}async function ve(e){const{environment:t,collectionViewBlockStore:n,spaceStore:r,parentStore:o,query:s,limit:a,requireEditPermissions:i,databaseType:c,searchSessionId:l}=e;let d=[],u=0;if(!s){const e=t.currentUser.id;r&&(d=[...(0,_().F)({currentUserId:e,spaceId:r.id}).map((e=>X().md.createChildStore(o,{table:v().Vl,id:e})))]),d=[...C().oE(null==n?void 0:n.getCollectionViewStores().map((e=>e.getCollectionStore()))),...d],c&&(d=d.filter((e=>{const t=e.getDatabaseType();return!!t&&c.includes(t)}))),d=C().hS(d,(e=>e.id)).filter((e=>!i||e.canEdit()))}const p=await me(t,{query:s,limit:a,source:"collection_settings_source",requireEditPermissions:i,databaseType:c,spaceStore:r,searchSessionId:l});return d=[...d,...p.results.map((e=>X().md.createChildStore(o,{table:v().Vl,id:e})))],u=p.total,d=d.filter((e=>!(0,N().ze)(e)&&e.canRead())),await Promise.all(d.map((async e=>{await e.load()}))),{results:C().hS(d,(e=>e.id)).slice(0,a).map((e=>e.id)),total:u}}async function he(e){const{environment:t,searchQuery:n,blockTypes:r,currentSpaceStore:o,currentSpaceViewStore:s,limit:a,parentId:i}=e,c=await(0,ne().h)({environment:t,currentSpaceStore:o,currentSpaceViewStore:s}),l={query:{text:n,filters:(0,g().N2)({requireEditPermissions:!1,isDeletedOnly:!1,excludeTemplates:!0,navigableBlockContentOnly:!0,blockTypes:r,parentId:i}),sort:{field:"relevance"}},limit:a},d=(0,te().r)({query:l,localCachedPages:c,parentStore:o,isOnline:W().A.state.online,environment:t,shouldLimitLocalResultsWhenOnline:!1,applyScoreThresholdWhenOnline:!0,canUseLtr:!1});return d&&P().Q.isSuccess(d)?d.value.results.filter((e=>e.store.pathIsAccessibleAndAlive())):[]}function be(e){const{query:t,intl:n}=e,r=z().A.state.permissionGroupsAndMemberCounts.map((e=>e.group));if(0===r.length)return[];return t?(0,I().Ay)(t,r,(e=>(0,F().Pf)({intl:n,groupName:e.name})),{normalizeFuzzyScore:!0}):r}async function ge(e){const{query:t}=e,{currentSpaceStore:n}=D().default.state;if(!n)return[];return Se({parentStore:n,query:t,botIds:await ye(e)})}async function ye(e){const{environment:t}=e,{currentSpaceStore:n}=D().default.state;if(!n)return[];const r=n.id,o=await x().Ju({environment:t,table:h().NX,id:r,type:"guest"});return C().sb(o.botIds)}function Se(e){const{parentStore:t,query:n,botIds:r}=e,s=C().oE(r.map((e=>{const n=t.table===h().NX?t.id:void 0;return(0,X().Oo)(t,{table:m().GP,id:e,spaceId:n}).getValue()})));return n?(0,I().Ay)(n,s,o().tb):s}async function fe(e){const{query:t,environment:n,spaceId:r,botSettings:o}=e;if(!r)return[];const s=await k().callApi({eventName:"searchIntegrations",environment:n,data:{query:t}});if("success"===s.type){const e=s.data.integrationIds,t=o&&o.integration_approval_statuses?Object.keys(o.integration_approval_statuses):[],n=Boolean(null==o?void 0:o.integration_restrictions),r=Boolean("approved_or_built_by_notion"===(null==o?void 0:o.integration_restrictions));return n?e.filter((e=>r?t.includes(e)||(0,a().CX)({integrationId:e,env:"production"}):t.includes(e))):e}if("failed"===s.type)throw s.error;(0,M().HB)(s)}const Ie=new Set(["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com"]);async function Ce(e){var t;let{environment:n,parentStore:r,query:o,userIds:a,minFuzzyScore:c,placeSelfFirst:l}=e;const d=R().default.mark("user_search_latency"),u=G().default.checkGate({gateName:"search_batch_load_users"}),p=w().lX(a,u?300:Math.max(a.length,1),(async e=>{const t=X().LU.createChildStore(r,{table:b().oo,id:e});return await t.load(),t.getValue()}));(await(0,w().nQ)(1e4,[p])).timeout&&(i().log({level:"error",from:"searchActions.searchUsers",type:"UserStoreLoadTimeoutV1",error:{message:"The UserStore.load()'s took longer than 10 seconds"},data:{searchedUserIdCount:a.length,queryLength:o.length,parentStoreLoaded:r.isReady(),documentVisibilityState:document.visibilityState}}),(0,U().u4)({environment:n,event:{eventName:"user_search_timeout",eventProperties:{searchedUserIdCount:a.length,queryLength:o.length,parentStoreLoaded:r.isReady(),documentVisibilityState:document.visibilityState}}}));const m=C().oE(await p);let v;const h=null===(t=D().default.state.currentUserStore)||void 0===t?void 0:t.userId;if(l&&h){const e=m.findIndex((e=>h===e.id));e>-1&&(v=m[e],m.splice(e,1))}const g=Y().k.state??{},y=Math.max(...Object.values(g));function S(e){var t;return e===(null===(t=D().default.state.currentUserRootStore)||void 0===t?void 0:t.userId)?y+1e-5:g[e]??0}const A=C().Im(g)?m:m.sort(((e,t)=>{const n=S(e.id);return S(t.id)-n})),P=new Set(r.getEmailDomains()),M=o?(0,I().Ay)(o,A,f().T2,{minThreshold:c,getSortScore:e=>{const{original:t,score:n}=e,r=t.email&&(0,s().zN)(t.email),o=v&&(0,s().zN)(v.email),a=r&&P.has(r),i=o===r,c=o&&Ie.has(o);return n*(a||i&&!c?-2:-1)}}):m;return R().default.measure(d,{environment:n}),v?[v,...M]:M}async function we(e){const{currentSpaceStore:t}=D().default.state;if(!t)return[];const n=e.query.startsWith("@")?e.query.slice(1):e.query,r=await Pe(e);return Ce({environment:e.environment,parentStore:t,query:n,userIds:r,minFuzzyScore:e.minFuzzyScore,placeSelfFirst:e.placeSelfFirst})}async function Ae(e){const{environment:t,membersOnly:n,minFuzzyScore:r=1e3,placeSelfFirst:o,limit:s}=e,{currentSpaceStore:a,mainEditorCurrentBlockStore:i,currentUserStore:c}=D().default.state;if(!a)return[];const d=e.query.startsWith("@")?e.query.slice(1):e.query,u=Y().k.getSortedUserIds().slice(0,100),p=i&&!n?(0,E().i0)(i).flatMap((e=>{let{permissionItem:t}=e;return(0,l().B2)(t)?[t.user_id]:[]})):[],m=await Ce({environment:e.environment,parentStore:a,query:d,userIds:C().sb([...C().oE([null==c?void 0:c.userId]),...u,...p]),minFuzzyScore:r,placeSelfFirst:o});if(s&&m.length>=s)return m.slice(0,s);const v=await k().callApi({eventName:"listUsers",environment:t,data:{cursor:void 0,membershipFilter:n?"members":void 0,limit:s?s-m.length:100,query:d,spaceId:a.id}});if("success"!==v.type||0===v.data.users.length)return m;const h=v.data.users.sort(((e,t)=>{var n,r;const o=(null===(n=Y().k.state)||void 0===n?void 0:n[e.id])??0;return((null===(r=Y().k.state)||void 0===r?void 0:r[t.id])??0)-o})),g=await(0,w().lX)(h,h.length,(async e=>{const t=X().LU.createChildStore(a,{table:b().oo,id:e.id});return await t.load(),t.getValue()}));return C().hS([...m,...C().oE(g)],(e=>e.id))}async function Pe(e){const{environment:t,membersOnly:n}=e,{currentSpaceStore:r}=D().default.state;if(!r)return[];await $().$D({environment:t,spaceId:r.id});const o=ee().subscriptionDataStoreInstance.state;if(!o)return[];const s=(0,J().Be)(o).filter((e=>!(n&&!(0,l().DH)(e.role)))),{mainEditorCurrentBlockStore:a,currentUserStore:i}=D().default.state,c=a&&!n?(0,E().i0)(a).flatMap((e=>{let{permissionItem:t}=e;return(0,l().B2)(t)?[t.user_id]:[]})):[],d=(0,L().Qd)()&&a?function(e,t){const n=N().Uo(e);if(n){const e=new Set((0,y().gm)({membership:n.getRawMembership()}));return t.filter((t=>"none"!==t.role||t.isPageGuest||t.isTeamGuest&&e.has(t.userId)))}return t.filter((e=>"none"!==e.role||e.isPageGuest))}(a,s):s,u=d.map((e=>e.userId));return C().sb([...C().oE([null==i?void 0:i.userId]),...c,...u])}function Me(e,t){return!(!t.startsWith("en-")||!Be.has(e.toLowerCase()))}const Be=new Set(["me","you","i"]),ke=Pe;async function xe(e){const{query:t}=e,n=e.shouldUseEdgeCacheForFeatureGate&&H().A.state.shouldUseEdgeCache,[r,o]=await Promise.all([n?Ae({...e,placeSelfFirst:""===t||Me(t,e.userLocale)}):we({...e,placeSelfFirst:""===t||Me(t,e.userLocale)}),ge(e)]);return{users:r,bots:o}}async function _e(e){const[t,n]=await Promise.all([Pe(e),ye(e)]);return{userIds:t,botIds:n}}async function Te(e,t){const n=(0,s().qh)(t);if((0,s().DT)(n)&&n){const t=await k().callApi({eventName:"findUser",environment:e,data:{email:n}});if("failed"===t.type)throw t.error;const r=t.data;return r.value?{user:r.value.value}:{email:n}}return{}}async function Ue(e){const{query:t,userIds:n,botIds:r,store:o,environment:s}=e;if(G().default.checkGate({gateName:"dont_load_users"}))return{users:[],bots:[]};let a=o;if(!a){const{currentSpaceStore:e}=D().default.state;if(!e)return{users:[],bots:[]};a=e}return{users:await Ce({environment:s,parentStore:a,query:t,userIds:n}),bots:Se({parentStore:a,query:t,botIds:r})}}async function qe(e){const{nearBlock:t,environment:n,query:r,source:o,searchSessionId:s,searchSessionFlowNumber:a}=e,{currentSpaceStore:i}=D().default.state,c=(0,q().s0)(),d=t&&(0,E().i0)(t).find((e=>{let{permissionItem:t}=e;return(0,l().FP)(t)})),u=Q().A.getMentionedIds(n.currentUser.id);if(i){return Le(await oe({environment:n,query:r,limit:20,spaceId:i.id,currentPageId:c,searchSessionId:s,searchSessionFlowNumber:a,recentlyMentionedPageIds:u,requireEditPermissions:!1,excludeTemplates:!0,source:o,boostRecentlyViewedPages:!0,ignoresHighlight:!0}))}if(d&&d.from.table===p().ev){return Le(await le({environment:n,query:r,limit:20,ancestorId:d.from.blockId,excludeTemplates:!0,source:o,currentPageId:c,searchSessionId:s,searchSessionFlowNumber:a,recentlyMentionedPageIds:u,ignoresHighlight:!0}))}return[]}function Le(e){const{trackEventProperties:t,results:n}=e,r=(0,B().MU)((0,M().WP)(t).map((e=>{let[t,n]=e;return[`server-${t}`,n]})));return n.map((e=>({...e,serverEventProperties:r})))}async function Ne(e){const{environment:t,query:n,source:r,limit:o}=e,{currentSpaceStore:s}=D().default.state;if(!s)return[];return(await oe({environment:t,query:n,limit:o||20,spaceId:s.id,requireEditPermissions:!0,excludeTemplates:!0,source:r,boostRecentlyViewedPages:!1})).results.filter((e=>{const t=X().Bv.createChildStore(s,{table:p().ev,id:e.id}),n=(0,N().E)(t);return(0,c().ot)(n)}))}async function Ee(e){let{spaceViewStore:t,query:n,teamStores:r}=e;const o=C().oE(await Promise.all(r.map((async e=>(await e.load(),e.getValue()))))),s=t.getTeamsStores(),a=new Set(s.map((e=>e.id)));return n?(0,I().Ay)(n,o,(e=>e.name),{getSortScore:e=>{const{original:t,score:n}=e;return n*(a.has(t.id)?-2:-1)}}):o}function je(e,t){const{query:n,limit:o,spaceId:s,requireEditPermissions:a,databaseType:i}=t,c=[];if(o>0){const d=new AbortController;e.defaultRecordCache.inMemoryRecordCache.forEachRecord(e.currentUser.id,(e=>{let{model:u,role:p}=e;if(u.table===v().Vl){const e=u.space_id===s,m=!a||(0,l().p2)(p);if(!e||!m||(0,O().Nh)(u.getParentId()))return;const v=u.getDatabaseType();if(!(!i||v&&i.includes(v)))return;const h=(0,S().q4_)(u.getName());if(!r().test(n,h))return;const b=X().md.createChildStore(t.parentStore,u.pointer),g=N().g7(b);if(!N().yR(g))return;c.push(u.pointer.id),c.length>=o&&d.abort()}}),d.signal)}return c}},598899:(e,t,n)=>{n.d(t,{N:()=>o});n(296540);var r=n(474848);const o=(0,n(340498).wt)("newSidebarTemplates",{viewBox:"0 0 20 20",svg:(0,r.jsx)("g",{children:(0,r.jsx)("g",{id:"Layer_1",children:(0,r.jsx)("path",{d:"M18.1572266,15.3720703l-2.3018188-3.9864502c.6661377-.2475586,1.1445923-.8843994,1.1445923-1.6356201V3.75c0-.9648438-.7851562-1.75-1.75-1.75h-6.25c-.9648438,0-1.75.7851562-1.75,1.75v1.5634766c-.2476807-.0355835-.4969482-.0634766-.75-.0634766-2.8950195,0-5.25,2.3549805-5.25,5.25,0,2.8945312,2.3549805,5.25,5.25,5.25.3484497,0,.6890869-.0457764,1.0245972-.1122437-.1846313.4870605-.1571655,1.022583.1101685,1.4862671.3168945.5488281.8842773.8759766,1.5175781.8759766h7.4873047c.6328125,0,1.2001953-.3271484,1.5166016-.875.3173828-.5488281.3173828-1.203125.0009766-1.7529297ZM9,3.5h6.25c.1376953,0,.25.1123047.25.25v6c0,.1376953-.1123047.25-.25.25h-.1946411l-.6422729-1.1123047c-.3164062-.5483398-.8837891-.8759766-1.5166016-.8759766-.6337891,0-1.2011719.3276367-1.5175781.8759766l-.6421509,1.1123047h-1.7421265c-.1347656,0-.2446289-.1098633-.2446289-.2446289v-3.5401611c-.000061-.0013428.0001221-.0026245,0-.0039673v-2.4612427c0-.1376953.1123047-.25.25-.25ZM2.75,10.5c0-2.0678711,1.6821289-3.75,3.75-3.75.2545166,0,.5040894.0332031.75.083252v2.9221191c0,.9619141.7827148,1.7446289,1.7446289,1.7446289h.8760986l-1.1859131,2.0540771c-.0067139.0043945-.0146484.0047607-.0212402.0093994-.6342773.4492188-1.3828125.6865234-2.1635742.6865234-2.0678711,0-3.75-1.6826172-3.75-3.75ZM16.8574219,16.3740234c-.0273438.046875-.0917969.1259766-.2177734.1259766h-7.4873047c-.1264648,0-.190918-.0791016-.2182617-.1259766s-.0634766-.1425781,0-.2519531l3.7436523-6.484375c.125-.2163086.3076172-.2202148.4365234,0l3.7441406,6.4833984c.0625.1103516.0263672.2060547-.0009766.2529297Z"})})})})},679915:(e,t,n)=>{n.d(t,{A:()=>c});n(296540);var r=()=>n(401497),o=()=>n(305837),s=()=>n(959013),a=()=>n(541258),i=n(474848);const c=function(e){let{hasActivePlan:t}=e;const r=(0,n(484714).v3)(),o=t?(0,i.jsx)(s().sA,{id:"upgradeMobileButton.manageButton.label",defaultMessage:"Manage Plan"}):(0,i.jsx)(s().sA,{id:"upgradeMobileButton.upgradeButton.label",defaultMessage:"Upgrade Plan"});return(0,i.jsx)(n(704152).A,{mobileFeedback:!0,onClick:l(r),children:(0,i.jsx)(n(490044).A,{left:(0,i.jsx)(d,{}),disableMobileBorder:!0,children:o})})};function l(e){return()=>{const{mobileNative:t}=e;t&&t.openUpgradeModal({spaceId:a().LU(),from:"mobile_sidebar",showActivePlan:!0})}}function d(){const e=(0,r().DP)();return(0,o().H)({fill:e.mediumIconColor,width:16})}},714300:(e,t,n)=>{n.d(t,{l:()=>c});var r=()=>n(484714),o=()=>n(847249),s=()=>n(176983),a=()=>n(596513),i=()=>n(324561);function c(e){let{spaceId:t}=e;const n=(0,r().v3)(),c=(0,s().J)();return(0,o().K8)((()=>{if(!t||!c)return;const e=a().t.getData(n,{spaceId:t});return(0,i().a9)(e)}),[n,t,c],{useDeepEqual:!0})}},763336:(e,t,n)=>{n.d(t,{U:()=>b,W:()=>h});n(296540);var r=()=>n(484714),o=()=>n(847249),s=()=>n(401497),a=()=>n(598899),i=()=>n(959013),c=()=>n(981084),l=()=>n(644914),d=()=>n(962730),u=()=>n(296798),p=()=>n(859428),m=()=>n(490044),v=n(474848);function h(e){const{styles:t}=e,n=(0,r().v3)(),h=(0,i().tz)(),g=(0,o().K8)((()=>{const{RouterStore:e}=n;return e.state.route}),[n]),y=(0,s().IS)((e=>({templateGalleryNewLogoIcon:{height:20,width:20}})),[]),S=(0,l().ab)(),f=(0,c().U)("marketplace_sidebar_option_click");return(0,v.jsx)(p().A,{renderTooltip:()=>h.formatMessage(b.templatesMwnTooltip),originGap:6,placement:d().W.Right,render:e=>(0,v.jsx)(u().A,{style:t.sidebarItemButtonStyle,hoveredStyle:t.buttonHoveredStyle,onClick:f,...e,children:(0,v.jsx)(m().A,{left:(0,a().N)({...S.bottomButtonIcon,...y.templateGalleryNewLogoIcon}),isBottomItem:!0,style:"gallery"===g.name?t.sidebarItemActiveStyle:{},children:h.formatMessage(b.title)})})})}const b=(0,i().YK)({templatesMwnTooltip:{defaultMessage:"Find all the best templates and set-ups built by Notion’s community",id:"sidebar.openTemplatePickerButton.tooltip.mwn"},title:{defaultMessage:"Templates",id:"sidebar.openTemplatePickerButton"}})},806638:(e,t,n)=>{n.d(t,{P:()=>s});var r=()=>n(427704),o=()=>n(435009);function s(e){const{environment:t}=e;o().oo({environment:t,url:r().JZ.marketplace,redirect:!1})}},908928:(e,t,n)=>{n.d(t,{GO:()=>U,Ju:()=>T,KA:()=>_,L0:()=>E,L2:()=>V,dA:()=>q,gI:()=>x,iN:()=>j,oG:()=>N,sK:()=>L});n(898992),n(354520),n(803949);var r=()=>n(386164),o=()=>n(433847),s=()=>n(68263),a=()=>n(388821),i=()=>n(179034),c=()=>n(824862),l=()=>n(161479),d=()=>n(96689),u=()=>n(798880),p=()=>n(763824),m=()=>n(534177),v=()=>n(901389),h=()=>n(855801),b=()=>n(594794),g=()=>n(972435),y=()=>n(731320),S=()=>n(630116),f=()=>n(449506),I=()=>n(496414),C=()=>n(579627),w=()=>n(246826),A=()=>n(436572),P=()=>n(751156),M=()=>n(633457);const B=(0,n(959013).YK)({duplicatingTemplate:{id:"botActions.duplicatingTemplate.loadingMessage",defaultMessage:"Duplicating template..."},duplicatingTemplateError:{id:"botActions.duplicateTemplateAndShareWithBot.snackbar.failure",defaultMessage:"Failed to duplicate template for to your workspace"}});function k(e,t){const{environment:n,spaceStore:r,spaceRole:o}=t,s=function(e){const{name:t,spaceStore:n,userId:r,icon:o,type:s,environment:a}=e,i=Date.now(),l={name:t,created_at:i,created_by_table:u().oo,created_by_id:r,alive:!0,icon:o,space_id:n.id,last_edited_at:i,last_edited_by_id:r,last_edited_by_table:u().oo};switch(s){case"guest":return{...l,type:"guest",capabilities:e.capabilities,parent_table:d().NX,parent_id:n.id,integration_id:void 0};case"scim":return{...l,id:(0,b().Z1)({environment:a,table:c().GP,spaceId:n.id}),type:"scim",parent_table:u().oo,parent_id:r};default:(0,m().HB)(s)}}(t),a=w().eC({environment:n,table:c().GP,value:s,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:e});return C().dy({environment:n,spaceStore:r,permissionItems:[{type:"bot_permission",role:o,bot_id:a.id}],transaction:e}),{botStore:a}}function x(e){const{environment:t}=e,{serverCommitResult:n,performResult:{botStore:r}}=P().createAndCommit({userAction:"botActions.createSpaceBot",environment:t,canUndo:!0,perform:t=>k(t,e)});return{botStore:r,transactionPromise:n}}async function _(e){const{environment:t,botId:n,onSuccess:r}=e,o=await f().callApi({eventName:"deleteBot",environment:t,data:{botId:n}});"failed"===o.type?v().Qg(o):"success"===o.type&&r&&(await M().oX({environment:t}),r())}async function T(e){const{environment:t,table:n,id:o,type:s}=e,a=await f().callApi({eventName:"getBots",environment:t,data:{table:n,id:o,type:s},headers:(0,r().WS)({spaceId:n===d().NX?o:void 0})});if("failed"===a.type)throw v().Qg(a),a;return{botIds:a.data.botIds,recordMap:a.data.recordMap}}async function U(e){const{environment:t,currentSpaceStore:n,botIds:r}=e;if(!n)return;const o=await f().callApi({eventName:"getBotSharedPageIds",environment:t,data:{spaceId:n.id,botIds:r}});if("failed"!==o.type)return o.data;v().Qg(o)}async function q(e){const{environment:t,botId:n}=e,r=await f().callApi({eventName:"getBotToken",environment:t,data:{botId:n}});if("failed"!==r.type)return r.data.token;v().Qg(r)}function L(e){const{botValue:t,store:n,environment:r}=e,{id:s,parent_id:a,parent_table:i,capabilities:c}=t,l={type:"bot_permission",bot_id:s,parent_id:a,parent_table:i,role:(0,o().MD)(c)};P().createAndCommit({userAction:"TopbarMoreButton.handleAddingConnection",environment:r,canUndo:!0,perform:e=>{C().zP({environment:r,store:n,permissionItems:[l],transaction:e})}})}function N(e){const{botId:t,store:n,environment:r}=e,o=n.getPermissionItems().filter((0,m().u0)((e=>(0,s().P3)(e)?{true:e}:{false:e})));for(const s of o)if(s.bot_id===t){const e={...s,role:"none"};P().createAndCommit({userAction:"TopbarMoreButton.handleRemovingConnection",environment:r,canUndo:!0,perform:t=>{C().zP({environment:r,store:n,permissionItems:[e],transaction:t})}})}}function E(e){const{currentSpaceStore:t,environment:n,pages:r,botStore:o,addPermission:s}=e;if(!t)return;const a=(0,y().Ws)({botStore:o,addPermission:s});r.forEach((e=>{const r=S().sk.createChildStore(t,{table:i().ev,id:e,spaceId:t.getSpaceId()});P().createAndCommit({userAction:"botActions.updateBlockPermissionsForBot",environment:n,canUndo:!0,perform:e=>{C().zP({environment:n,store:r,permissionItems:[a],transaction:e})}})}))}async function j(e){const{environment:t,spaceStore:n,botStore:r,pageIdAndOperations:o,concurrency:s=20}=e;0!==o.length&&await(0,p().lX)(o,s,(async e=>{const o=S().sk.createChildStore(n,{table:i().ev,id:e.pageId,spaceId:n.getSpaceId()}),s=(0,y().Ws)({botStore:r,addPermission:"add"===e.operationType}),{serverCommitResult:a}=P().createAndCommit({userAction:`botActions.updateBotPermissionsForPages.${e.operationType}`,environment:t,canUndo:!0,perform:e=>{C().zP({environment:t,store:o,permissionItems:[s],transaction:e})}});await a}))}async function V(e){const{environment:t,spaceStore:n,spaceViewStore:o,templatePageId:s,botValue:i,pages:d}=e;if(!n)return;const u=S().sk.createChildStore(n,{table:c().GP,id:i.id});if(s)return await async function(e){const{environment:t,spaceStore:n,spaceViewStore:o,templatePageId:s,botStore:i}=e;if(!n||!o)return;try{I().m({message:B.duplicatingTemplate});const e=await f().callApi({eventName:"loadBlockSubtree",environment:t,data:{block:{id:s,spaceId:(0,l().e)(void 0)},shallow:!1},headers:(0,r().WS)({recordId:s})});if("failed"===e.type)return;const c=a().RecordMapWithRole.create(e.data.subtreeRecordMap),{createAndDuplicatePageInSpace:d}=await(0,h().nd)(),{performResult:u}=P().createAndCommit({userAction:"botActions.duplicateTemplateAndShareWithBot",environment:t,canUndo:!0,perform:e=>{const r=d({environment:t,recordMap:c,copyPageId:s,isPrivate:!0,spaceStore:n,spaceViewStore:o,transaction:e,allowCopyExternalObjectInstances:!1}),a=o.getPrivatePageIds();a.length>0&&w().zv({store:o,data:{private_pages:[r.id,...a]},transaction:e});const l=(0,y().Ws)({botStore:i,addPermission:!0});return C().zP({environment:t,store:r,permissionItems:[l],transaction:e}),r}});return u}catch(c){A().D6({label:g().A.formatMessage(B.duplicatingTemplateError)})}finally{I().V()}}({environment:t,templatePageId:s,botStore:u,spaceStore:n,spaceViewStore:o});E({environment:t,currentSpaceStore:n,botStore:u,pages:d,addPermission:!0})}},913507:(e,t,n)=>{n.d(t,{A:()=>C,B:()=>M});var r=n(296540),o=()=>n(484714),s=()=>n(847249),a=()=>n(180566),i=()=>n(959013),c=()=>n(797265),l=()=>n(751156),d=()=>n(989423),u=()=>n(553965),p=()=>n(362749),m=()=>n(644914),v=()=>n(496067),h=()=>n(718807),b=()=>n(351360),g=()=>n(704152),y=()=>n(406699),S=()=>n(199896),f=()=>n(490044),I=n(474848);const C=function(e){let{store:t,onClick:n,onMouseEnter:a,onMouseLeave:i,buttonStyles:c,isMobile:l}=e;const d=(0,o().v3)(),u=(0,r.useCallback)((e=>(0,I.jsx)(P,{store:t,onClick:n,onMouseEnter:a,onMouseLeave:i,buttonStyles:c,isMobile:l,buttonPopupEvents:e})),[t,n,a,i,c,l]),{device:p,mobileNative:m}=d,h=(0,s().K8)((()=>(null==m?void 0:m.supportsNativeHomeOnPhone())||!1),[m]);return(0,I.jsx)(y().Ay,{popupType:p.isMobile?y().z7.SlideUp:y().z7.Popup,hidesMobileNativeBottomBar:h,preventSlideUpTransition:h,buttonPopupStore:v().A,alignmentToOrigin:y().yP.Start,placementToOrigin:y().sx.Right,originGap:0,onClick:e=>A(e,d),isFullWidthOnMobile:!0,render:()=>(0,I.jsx)(w,{}),preventScaleTransition:!0,renderOrigin:u})};function w(){return(0,s().O$)(b().AppStoreCurrentSpaceStore)?(0,I.jsx)(p().V2,{}):null}function A(e,t){h().Ay.setState({...h().Ay.state,currentTab:"all_pages"}),function(e){d().vd(e,"open_trash",(0,m().hX)({environment:e}))}(t)}function P(e){let{store:t,buttonPopupEvents:n,onClick:d,onMouseEnter:p,onMouseLeave:h,buttonStyles:b,isMobile:y}=e;const C=(0,o().v3)(),{onClick:w,...P}=(0,r.useMemo)((()=>(0,u().A)(n,{onClick:d,onMouseEnter:p,onMouseLeave:h})),[n,d,p,h]),M=(0,r.useMemo)((()=>t.clone()),[t]),B=(0,s().O$)(v().A),k=(0,m().ab)();return(0,I.jsx)(S().A,{store:M,canDropOnto:!0,onSelectableDrop:e=>function(e,t){const{droppedStores:n,duplicate:r}=e;r||l().createAndCommit({userAction:"SidebarTrashButton.handleDrop",environment:t,canUndo:!0,perform:e=>{c().ZL({environment:t,blocks:n,transaction:e})}})}(e,C),analyticsName:"sidebar_trash",shouldShowDropZone:!0,children:(0,I.jsx)(g().A,{...P,style:{...k.baseSidebarItem,...B.open&&k.currentSelectedSidebarItem},hoveredStyle:null==b?void 0:b.hoveredStyle,onClick:w||(e=>A(0,C)),mobileFeedback:y,children:(0,I.jsx)(f().A,{left:(0,a().Q)(k.bottomButtonIcon),disableMobileBorder:!0,isBottomItem:!0,children:(0,I.jsx)(i().sA,{defaultMessage:"Trash",id:"sidebarTrashButton.text"})})})})}function M(e){const{buttonStyles:t,isMobile:n,...r}=e,o=(0,m().ab)();return(0,I.jsx)(g().A,{...r,style:{...o.baseSidebarItem},hoveredStyle:null==t?void 0:t.hoveredStyle,mobileFeedback:n,children:(0,I.jsx)(f().A,{left:(0,a().Q)(o.bottomButtonIcon),disableMobileBorder:!0,isBottomItem:!0,children:(0,I.jsx)(i().sA,{defaultMessage:"Trash",id:"sidebarTrashButton.text"})})})}},981084:(e,t,n)=>{n.d(t,{U:()=>d});var r=n(296540),o=()=>n(484714),s=()=>n(427704),a=()=>n(435009),i=()=>n(652617),c=()=>n(989423),l=()=>n(806638);function d(e,t){const n=(0,o().v3)(),{isPhone:d}=(0,o().Y0)(),u=(0,r.useContext)(i().e);return(0,r.useCallback)((r=>{if((0,c().u4)({environment:n,event:{eventName:e,eventProperties:{}}}),d)null==u||u(),a().oo({environment:n,url:"/nativetab/templates",redirect:!0});else{const e="click"===r.type&&(r.metaKey||r.ctrlKey);(null==t?void 0:t.forceOpenInNewTab)||e?a().oo({environment:n,url:s().JZ.marketplace,openInNew:"tab",makeTabActive:!e&&n.device.isDesktop}):(0,l().P)({environment:n})}}),[n,e,t,d,u])}}}]);