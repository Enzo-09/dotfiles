"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943],{8741:(e,t,o)=>{o.r(t),o.d(t,{arrowDiagonalUpRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M5.603 3.663a.625.625 0 1 0 0 1.25h4.6l-6.371 6.371a.615.615 0 0 0 .014.87.616.616 0 0 0 .87.014l6.371-6.372v4.601a.625.625 0 1 0 1.25 0v-6.11a.625.625 0 0 0-.625-.624z"})},r=(0,o(340498).wt)("arrowDiagonalUpRightSmall",n)},51367:(e,t,o)=>{o.d(t,{DL:()=>l,Sq:()=>a,Y5:()=>s,gc:()=>d,wo:()=>c});var n=()=>o(917629),r=()=>o(989423),i=()=>o(508496);function l(e,t){const o=(0,n().h2)(t.callout_key);o&&(t.placement_key=(0,n().t9)(o)),(0,r().u4)({environment:e,event:{eventName:"callout_show",eventProperties:t}}),i().default.logEvent("callout_show",t.callout_key)}function s(e,t){const o=(0,n().h2)(t.callout_key);o&&(t.placement_key=(0,n().t9)(o)),(0,r().u4)({environment:e,event:{eventName:"callout_click",eventProperties:t}}),i().default.logEvent("callout_click",t.callout_key)}function a(e,t){const o=(0,n().h2)(t.callout_key);o&&(t.placement_key=(0,n().t9)(o)),(0,r().u4)({environment:e,event:{eventName:"callout_dismiss",eventProperties:t}}),i().default.logEvent("callout_dismiss",t.callout_key)}function c(e,t){const{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:i,eligibility_timeouts:l,blocklist:s}=t;(0,r().u4)({environment:e,event:{eventName:"callout_coordinator_resolved",eventProperties:{eligible_callouts:o,required_arg_timeout:n,required_args_run_duration:i,eligibility_timeouts:l,blocklist:s}}})}function d(e,t){(0,r().u4)({environment:e,event:{eventName:"callout_feature_interaction",eventProperties:t}})}},56394:(e,t,o)=>{o.d(t,{A:()=>c});o(296540);var n=()=>o(484714),r=()=>o(401497),i=()=>o(668725),l=()=>o(704152),s=()=>o(963589),a=o(474848);function c(e){const{icon:t,title:o,on:c,disabled:d,hasDiff:u,wrapStyle:p,innerStyle:m,hideChevron:g}=e,{isMobile:S}=(0,n().Y0)(),h=(0,s().X)("db_ux_chrome"),f=(0,r().IS)((e=>({container:{borderRadius:14,marginRight:6,display:"inline-flex",...u&&{position:"relative"},...p},filterPill:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:S?28:24,lineHeight:S?"28px":"24px",padding:"0 8px",...!h&&{border:`1px solid ${e.outlineButtonBorder}`},color:e.text.secondary,...c&&{color:e.text.uiBluePrimary,borderColor:e.filterPillBorder,background:e.tint.uiBlue},...d&&{color:e.text.uiBlueTertiary,borderColor:e.text.uiBlueTertiary,background:e.tint.uiBlue},...m},hovered:c?{background:e.tint.uiBlueHover}:{},pressed:c?{background:e.tint.uiBluePressed}:{},chevron:{width:10,marginLeft:4,marginTop:1,fill:d?e.text.uiBlueTertiary:c?e.blueColor:e.lightIconColor},diffDot:{position:"absolute",top:-2,right:-2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[u,p,S,h,c,d,m]);return(0,a.jsxs)("div",{style:f.container,children:[(0,a.jsxs)(l().A,{disabled:d,style:f.filterPill,hoveredStyle:f.hovered,pressedStyle:f.pressed,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,!g&&(0,i().b)(f.chevron)]}),u&&(0,a.jsx)("div",{style:f.diffDot})]})}},77126:(e,t,o)=>{o.d(t,{j:()=>r});class n extends(()=>o(959180))().A{}const r=new n},89849:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_9098_13290)",children:[(0,n.jsx)("path",{d:"M10 13.504a3.5 3.5 0 1 0-.001-7.002A3.5 3.5 0 0 0 10 13.504m1.167-3.502a1.168 1.168 0 1 1-2.335.002 1.168 1.168 0 0 1 2.335-.002"}),(0,n.jsx)("path",{d:"M10 3.895c-4.093 0-7.662 2.189-9.351 5.408-.231.44-.231.964 0 1.404 1.689 3.22 5.258 5.408 9.351 5.408s7.662-2.189 9.351-5.408c.231-.44.231-.964 0-1.404-1.689-3.22-5.258-5.408-9.351-5.408m-8.245 5.99C3.218 7.096 6.347 5.144 10 5.144s6.782 1.952 8.245 4.74a.26.26 0 0 1 0 .24c-1.463 2.788-4.592 4.74-8.245 4.74s-6.782-1.952-8.245-4.74a.26.26 0 0 1 0-.24"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_9098_13290",children:(0,n.jsx)("path",{d:"M0 0h20v20H0z"})})})]})},i=(0,o(340498).wt)("eye",r)},94778:(e,t,o)=>{o.d(t,{A:()=>S});o(296540);var n=()=>o(484714),r=()=>o(847249),i=()=>o(401497),l=()=>o(575157),s=()=>o(959013),a=()=>o(154017),c=()=>o(751156),d=()=>o(760217),u=()=>o(8980),p=()=>o(645873),m=()=>o(339034),g=o(474848);function S(e){const{collectionContextStore:t,onClose:o,focused:S,isCompact:h,compactColor:f="primary"}=e,y=(0,n().v3)(),{value:v}=(0,p().fJ)(m().formsEditorDependency),x=(0,i().IS)((e=>({compactFormButton:{color:"secondary"===f?e.text.secondary:void 0,display:"flex",flexDirection:"row"}})),[f]),b=(0,r().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e||null===(e=e.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[t]);function C(){c().createAndCommit({userAction:"CollectionViewTabBar.createGenericViewType",environment:y,canUndo:!0,skipDefaultPostPerformValidationChecks:b,perform:e=>{v&&v.formEditorActions.createAndFocusCollectionFormEditorView({environment:y,collectionContextStore:t,transaction:e})}}),o(),(0,a().b)({environment:y,collectionContextStore:t,view_type:"form_editor",from:"addButton"})}if(!v)return null;const w=(0,g.jsx)(d().A,{focused:S,onClick:C,title:(0,g.jsx)("div",{style:x.compactFormButton,children:(0,g.jsx)(s().sA,{defaultMessage:"New form",id:"database.collectionViewSelect.newFormButtonTitle"})}),style:{padding:"1 0"},icon:(0,g.jsx)(u().I,{icon:l().docPlainTextIcon,color:f})}),k=(0,g.jsx)(d().A,{focused:S,onClick:C,title:(0,g.jsx)("div",{style:{display:"flex",flexDirection:"row"},children:(0,g.jsx)(s().sA,{defaultMessage:"Form",id:"CollectionViewTabBar.newFormItem.title"})}),icon:(0,g.jsx)(u().I,{icon:l().docPlainTextIcon}),shouldWrapCaption:!0,caption:(0,g.jsx)(s().sA,{defaultMessage:"Create a form to input data directly into this database",id:"CollectionViewTabBar.newFormItem.description"})});return h?w:k}},99600:(e,t,o)=>{o.d(t,{A:()=>F});var n=o(296540),r=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(449552),a=()=>o(701751),c=()=>o(340498),d=o(474848);const u=(0,c().wt)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,d.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),p=(0,c().wt)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,d.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})});var m=()=>o(105819);const g=(0,c().wt)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,d.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var S=()=>o(798880),h=()=>o(695608),f=()=>o(959013),y=()=>o(989423);function v(e,t){y().vd(e,"edit_lock_toggle",t)}var x=()=>o(896628),b=()=>o(751156),C=()=>o(722872),w=()=>o(377586),k=()=>o(455425),A=()=>o(712505),I=()=>o(630116),j=()=>o(575143),R=()=>o(704152),T=()=>o(406699),M=()=>o(928600),_=()=>o(939740),P=()=>o(89924),B=()=>o(859428),V=()=>o(198688);const F=function(e){let{store:t,disableTooltip:o,hideText:n,isInlineCollection:i,buttonStyle:l}=e;const{isMobile:s}=(0,r().Y0)();return s?(0,d.jsx)(W,{store:t,hideText:n}):(0,d.jsx)(H,{store:t,disableTooltip:o,hideText:n,isMobile:s,isInlineCollection:i,buttonStyle:l})};function L(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function E(e,t,o,n,r){return{...L(e,n,r),color:o.text.tertiary,fill:o.lightIconColor}}function O(e,t,o,n,r){return{...L(e,n,r),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function D(e){let{store:t}=e;const o=(0,l().DP)(),n=(0,i().K8)((()=>t.getFormat().block_locked_by),[t]),r=(0,f().tz)(),s=(0,i().K8)((()=>n&&(0,h().c6)(r,I().sk.createChildStore(t,{table:S().oo,id:n}).getModel())),[n,r,t]);return n?(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,d.jsx)("b",{children:s}),br:(0,d.jsx)("br",{}),prompttext:e=>(0,d.jsx)("span",{style:{color:o.text.contrastSecondary},children:e})}})}):null}function z(e,t){k().$.relockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!0,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}function K(e){let{store:t,close:o}=e;const i=(0,r().v3)(),l=(0,n.useCallback)((()=>{!function(e,t){k().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),s=(0,n.useCallback)((()=>{!function(e,t){b().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:o=>{x()._l({environment:e,store:t,isLocked:!1,transaction:o})}});const o=t.getType();if(o){var n;let r;t.isCollectionView()&&(r=t.getCollectionStore()),v(e,{from:"topbar",block_type:o,locked:!1,collection_id:null===(n=r)||void 0===n?void 0:n.id})}}(i,t),o()}),[i,t,o]),c=[{key:"temp_unlock",render:e=>(0,d.jsx)(j().A,{...e,svg:m().pencilLineIcon,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{l()}},{key:"perm_unlock",render:e=>(0,d.jsx)(j().A,{...e,svg:a().p,title:(0,d.jsx)(f().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{s()}}];return(0,d.jsx)(M().A,{menuType:C().gu.Popup,children:(0,d.jsx)(_().Ay,{type:_().Oh.Vertical,onAccept:o,sections:[{key:"unlock_options",render:e=>(0,d.jsx)(P().A,{...e}),items:c}],initialFocus:void 0})})}function H(e){let{store:t,disableTooltip:o,hideText:a,isMobile:c,isInlineCollection:u,buttonStyle:p}=e;const m=(0,l().DP)(),S=(0,r().v3)(),h=(0,n.useCallback)((()=>z(S,t)),[S,t]),y=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),v=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),x=(0,i().K8)((()=>A().default.state.open&&A().default.state.targetStore.id===t.id),[t.id]);return y?v?(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(V().A,{}),(0,d.jsxs)(R().A,{style:O(c,0,m,u,p),onClick:h,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[g({width:16,marginRight:a?void 0:4}),!a&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,d.jsx)(B().A,{renderTooltip:()=>(0,d.jsx)(D,{store:t}),disableTooltip:o,render:e=>(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[x&&(0,d.jsx)(V().A,{}),(0,d.jsx)(T().Ay,{popupType:w().n.Popup,renderOrigin:t=>{let{onClick:o}=t;return(0,d.jsxs)(R().A,{style:E(c,0,m,u,p),onClick:o,...e,children:[(0,s().g)({width:16,marginRight:a?void 0:4}),!a&&(0,d.jsx)("div",{style:{lineHeight:1},children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}})]})}):null}function W(e){let{store:t,hideText:o}=e;const s=(0,l().DP)(),a=(0,r().v3)(),c=(0,n.useCallback)((()=>z(a,t)),[a,t]),m=(0,i().K8)((()=>t.isLockedForAllUsers()),[t]),g=(0,i().K8)((()=>k().$.isTemporarilyUnlocked({userId:t.userId,blockId:t.id})),[t.id,t.userId]),{WindowSizeStore:S}=a,h=(0,i().K8)((()=>S.getSafePaddingLeftCSS(10)),[S]),y=(0,i().K8)((()=>S.getSafePaddingRightCSS(14)),[S]);return m?g?(0,d.jsxs)(R().A,{onClick:c,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:h,paddingRight:y,color:s.blueColor,fill:s.blueColor},children:[p({width:20,height:16,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,d.jsx)(T().Ay,{popupType:w().n.Popup,renderOrigin:e=>{let{onClick:t}=e;return(0,d.jsxs)(R().A,{onClick:t,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:h,paddingRight:y},children:[u({width:20,marginRight:6}),!o&&(0,d.jsx)("div",{children:(0,d.jsx)(f().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]})},render:e=>{let{close:o}=e;return(0,d.jsx)(K,{store:t,close:o})}}):null}},104636:(e,t,o)=>{o.d(t,{Is:()=>u,LS:()=>g,NH:()=>S,QA:()=>m,_b:()=>p});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(244641),r=(o(296540),()=>o(390527)),i=()=>o(604995),l=()=>o(959013),s=()=>o(488887),a=()=>o(534177),c=()=>o(108944),d=o(474848);function u(e){const t=c().g7(e)??[],o=[];for(const n of t){if(!("block"===n.table&&!0===n.isTemplate()&&n.getFormat().automation_id&&n.id!==e.id))continue;const t=n.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r().templateAncestorsViolateRecurrenceNesting)(o)}}function p(e){switch(e){case"day":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily"});case"week":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly"});case"month":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly"});case"year":return(0,d.jsx)(l().sA,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly"});default:(0,a().HB)(e)}}function m(){return{start_date:n().c9.local().plus({days:1}).set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,i().dB)(),hour:0,minute:0,frequency:"day",interval:1}}function g(e){const{recurrence:t,intl:o,leadingPhrase:n}=e;return(0,r().rruleFromRecurrence)({..."month"===t.frequency?{...t,monthly_restriction:void 0}:t,weekdays:void 0,hour:0,minute:0,end_condition:void 0}).toText((e=>{switch(e){case"every":if(void 0===n)return"";if("every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.every",defaultMessage:"every"});if("repeat every"===n)return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.repeatEvery",defaultMessage:"repeat every"});(0,a().HB)(n);break;case"day":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.day",defaultMessage:"day"});case"days":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.days",defaultMessage:"days"});case"week":{const e=(null==t?void 0:t.weekdays)||[];return 5===e.length&&(0,s()._)(new Set(e),new Set(["MO","TU","WE","TH","FR"]))?o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weekday",defaultMessage:"weekday"}):o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.week",defaultMessage:"week"})}case"weeks":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.weeks",defaultMessage:"weeks"});case"month":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.month",defaultMessage:"month"});case"months":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.months",defaultMessage:"months"});case"year":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.year",defaultMessage:"year"});case"years":return o.formatMessage({id:"database.templatePickerItem.repeatMenuLabel.years",defaultMessage:"years"});default:return e.toString()}})).trim()}function S(e){const t=e.getRecurrence();return Boolean(e.isTriggerType("recurrence")&&t&&"disabled_recurrence_ended"===e.getStatus())}},105239:(e,t,o)=>{o.d(t,{N:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M6.337 3.05a.625.625 0 0 0-.003.885L8.828 6.44a.625.625 0 1 0 .886-.882L8.287 4.125H10A5.875 5.875 0 1 1 4.125 10a.625.625 0 1 0-1.25 0A7.125 7.125 0 1 0 10 2.875H8.285l1.44-1.432a.625.625 0 0 0-.882-.886z"})},r=(0,o(340498).wt)("arrowCircleSpinCounterClockwise",n)},105819:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineIcon:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"m13.987 5.682-.684.684-1.288-1.288.692-.691a.91.91 0 0 1 1.28 0c.35.35.35.93 0 1.28zm-9.433 9.433 7.914-7.914-1.289-1.289-7.92 7.908c-.122.122-.214.29-.274.457l-.336 1.082c-.06.229.153.442.366.366l1.082-.335q.252-.07.457-.275m12.446.76H5.61l1.25-1.25H17a.625.625 0 1 1 0 1.25"})},r=(0,o(340498).wt)("pencilLine",n)},112412:(e,t,o)=>{o.d(t,{$:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M2.4 3.7a.7.7 0 1 0 0 1.4h11.2a.7.7 0 0 0 0-1.4zm9.5 3.594H4.1a.7.7 0 1 0 0 1.4h7.8a.7.7 0 1 0 0-1.4M5.8 10.9a.7.7 0 0 0 0 1.4h4.4a.7.7 0 1 0 0-1.4z"})},r=(0,o(340498).wt)("filterSmall",n)},114641:(e,t,o)=>{o.d(t,{H:()=>r});var n=()=>o(989423);function r(e){const{collectionContextStore:t,environment:o,incrementLimitArgs:r}=e;t.groupsStore.incrementLimit(e.incrementLimitArgs),t.loadingDetailsStore.setState({type:"load_more_blocks",group:r.groupsPointer}),n().vd(o,"collection_load_more_blocks")}},124311:(e,t,o)=>{o.d(t,{K:()=>r});var n=()=>o(989423);function r(e){n().vd(e,"inline_collection_load_more_click")}},126617:(e,t,o)=>{o.d(t,{Y:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M3.2 6.725a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55m4.8 0a1.275 1.275 0 1 0 0 2.55 1.275 1.275 0 0 0 0-2.55"})},r=(0,o(340498).wt)("ellipsisSmall",n)},132389:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);function r(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},132855:(e,t,o)=>{o.r(t),o.d(t,{arrowInCircleUpFillIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M10 17.625a7.625 7.625 0 1 0 0-15.25 7.625 7.625 0 0 0 0 15.25m3.042-8.07a.625.625 0 0 1-.884 0L10.625 8.02v5.466a.625.625 0 1 1-1.25 0V8.021L7.842 9.554a.625.625 0 1 1-.884-.883l2.6-2.6a.625.625 0 0 1 .884 0l2.6 2.6a.625.625 0 0 1 0 .883"})},r=(0,o(340498).wt)("arrowInCircleUpFill",n)},134421:(e,t,o)=>{o.d(t,{X:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowsUpDown",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})},167170:(e,t,o)=>{o.d(t,{_:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},r=(0,o(340498).wt)("layout",n)},170356:(e,t,o)=>{o.d(t,{NS:()=>u,Pq:()=>g,Z3:()=>d,sw:()=>p});o(296540);var n=()=>o(484714),r=()=>o(297872),i=()=>o(928600),l=()=>o(678553),s=()=>o(480095),a=()=>o(722872),c=o(474848);const d=8,u=8,p=32,m={height:p+d-2,paddingTop:d-2};function g(e){let{title:t,helpButton:o,onCancel:l,desktopMinWidth:d,desktopMaxWidth:u,desktopWidth:p,children:m}=e;const{device:g}=(0,n().v3)();return(0,c.jsx)(r().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:e=>{let n;return n=g.isMobile?{menuType:a().gu.Modal,title:t,right:(0,c.jsx)(s().DoneMenuText,{}),onClickRight:l,...e}:{menuType:a().gu.Popup,...d&&{minWidth:d},...u&&{maxWidth:u},...p&&{width:p},...e},(0,c.jsx)(i().A,{...n,header:t&&(0,c.jsx)(S,{title:t,helpButton:o}),children:m})}})}function S(e){let{title:t,helpButton:o}=e;return(0,n().v3)().device.isMobile?null:(0,c.jsx)(l().Ay,{style:m,title:t,right:o})}},182034:(e,t,o)=>{o.d(t,{O:()=>u,e:()=>d});o(898992),o(672577);var n=()=>o(908006),r=()=>o(878523),i=()=>o(725614),l=()=>o(892632),s=()=>o(299545),a=()=>o(77126),c=()=>o(489348);function d(e,t){const o=s().dd(t),n=l().xh(o);e.setState({...e.state,files:n})}async function u(e){const{blockStore:t,pageViewBlockStore:o,environment:l}=e;o?o.setState({...o.state,forceDiscussionOpen:!0}):c().A.openNewPageDiscussionInput(t),r().o2(l,{from:"page_comments"}),await n().default.afterNextFlush();const s=a().j.find((e=>e.getBlockStore().id===t.id)),d=null==s?void 0:s.getInputStore();d&&i().setSelectionAtEnd({store:d.state.textStore})}},198688:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(){const e=(0,o(401497).IS)((e=>({separator:{height:14,width:1,marginLeft:6,marginRight:6,background:e.darkDividerColor}})),[]);return(0,n.jsx)("div",{style:e.separator})}},207207:(e,t,o)=>{o.d(t,{J:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M8.875 2.625a6.25 6.25 0 1 0 3.955 11.09l3.983 3.982a.625.625 0 1 0 .884-.884l-3.983-3.982a6.25 6.25 0 0 0-4.84-10.205m-5 6.25a5 5 0 1 1 10 0 5 5 0 0 1-10 0"})},r=(0,o(340498).wt)("magnifyingGlass",n)},239529:(e,t,o)=>{o.d(t,{q:()=>s});var n=()=>o(436696),r=()=>o(435009),i=()=>o(728611),l=()=>o(519839);function s(e){const{environment:t,collectionContextStore:o,event:s,buttonPopupParent:a}=e,c=(0,l().t2)(o);if(!c)return null;const d=i().Vr(s);r().oo({environment:t,url:c,openInNew:d}),d||null==a||a.close(),(0,n().X)({environment:t,collectionContextStore:o,action:"click_source_view"})}},253447:(e,t,o)=>{o.d(t,{F:()=>r});var n=()=>o(963575);function r(e,t){if(e)return e;switch(t){case"large":return n().A.card.desktop.large.height;case"small":return n().A.card.desktop.small.height;default:return n().A.card.desktop.medium.height}}},271232:(e,t,o)=>{o.d(t,{t:()=>i});var n=o(296540),r=o(474848);const i=n.memo((function(e){const{coverHeight:t,coverSizeFormat:n,emptyGalleryCoverStyle:i}=e,l=(0,o(401497).IS)((()=>({container:{height:(0,o(253447).F)(t,n),...i}})),[t,n,i]);return(0,r.jsx)("div",{style:l.container})}))},274375:(e,t,o)=>{o.d(t,{Q:()=>r});o(898992),o(354520),o(672577);var n=()=>o(970013);function r(e,t){const o={property:n().rn,visible:!0,width:276},r={property:t,visible:!0},i=[o,r],l=e.getCollectionViewStores().find((e=>"table"===e.getType())),s=null==l?void 0:l.getFormatStore().getKeyStore("table_properties").getValue();if(!l||!s||0===s.length)return i;const a=s.find((e=>e.property===n().rn))??o;return[a,s.find((e=>e.property===t))??r,...s.filter((e=>e.property!==n().rn&&e.property!==t))]}},285176:(e,t,o)=>{o.d(t,{o:()=>s});o(296540);var n=()=>o(401497),r=()=>o(133033),i=()=>o(959013),l=o(474848);function s(e){const{href:t,style:o}=e,s=(0,n().IS)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.text.secondary}})),[]);return(0,l.jsxs)("a",{href:t,target:"_blank",style:{...s.default,...o},children:[(0,r().$)({width:14,marginRight:4}),(0,l.jsx)(i().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},286367:(e,t,o)=>{o.d(t,{D:()=>I});o(898992),o(354520);var n=o(296540),r=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(955363),a=()=>o(340498),c=()=>o(959013),d=()=>o(284371),u=()=>o(436696),p=()=>o(896628),m=()=>o(751156),g=o(474848);const S=function(e){const{store:t,titleStyle:n,actionButton:r,addViewButton:l}=e,s=(0,i().K8)((()=>t.getParentBlockStore()),[t]);return(0,g.jsx)("div",{children:(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,g.jsx)(o(599945).c,{step:"demo_collection",store:s,children:(0,g.jsx)(o(16006).A,{store:t,style:n})}),l,r]})})};var h=()=>o(760217),f=()=>o(939740),y=()=>o(8980),v=()=>o(897119),x=()=>o(614505),b=()=>o(89924),C=()=>o(697650),w=()=>o(722872),k=()=>o(963589),A=()=>o(46986);const I=n.memo((function(e){const{isHovered:t,collectionContextStore:n,addViewButton:r,showHoverActionsStore:s,titleStyle:a,iconStyle:c,iconSize:u}=e,[p,m,h]=(0,i().K8)((()=>[n.collectionStore(),n.collectionViewBlockStore(),n.permissionScopesStore.state]),[n]),f=(0,i().K8)((()=>n.viewsModuleContextStore.isInLayoutBuilder()),[n]),y=(0,i().K8)((()=>{const e=n.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,o(792002).j_)(t))}),[n]),v=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==m?void 0:m.id))}),[p,m]),x=(0,i().K8)((()=>Boolean(null==p?void 0:p.isSyncedCollection())),[p]),b=(0,o(106412).Zp)(),C=(v||y)&&h.canConfigureCollection&&!(null!=b&&b.disableEditingName)&&!x,w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,display:"flex",alignItems:"center",...d().RC},titleStyle:{fontWeight:d().Wy.bold,fontSize:22,...y?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},marginRight:4,...a}})),[y,a]);return p&&(null!=b&&b.disableAllPointerEvents||f)?(0,g.jsxs)("div",{style:w.container,children:[(0,g.jsx)(T,{collectionContextStore:n,disabled:!0,iconStyle:c,iconSize:u}),(0,g.jsx)(S,{store:p,titleStyle:w.titleStyle})]}):C?(0,g.jsx)(R,{isHovered:t,collectionContextStore:n,showHoverActionsStore:s,titleStyle:w.titleStyle,iconStyle:c,iconSize:u,addViewButton:r}):(0,g.jsx)(j,{isHovered:t,addViewButton:r,collectionContextStore:n,showHoverActionsStore:s,titleStyle:w.titleStyle,iconStyle:c,iconSize:u})})),j=n.memo((function(e){const{isHovered:t,collectionContextStore:s,showHoverActionsStore:a,titleStyle:c,iconStyle:p,iconSize:m,addViewButton:h}=e,f=(0,r().v3)(),{collectionStore:y,collectionViewBlockStore:v}=(0,i().K8)((()=>({collectionStore:s.collectionStore(),collectionViewBlockStore:s.collectionViewBlockStore()})),[s]),{isSystemCollection:x,href:b}=(0,i().K8)((()=>{const e=Boolean(null==y?void 0:y.isSystemCollection());return{isSystemCollection:e,href:e?void 0:(0,o(519839).t2)(s)}}),[s,y]),C=(0,k().X)("db_ux_chrome"),w=(0,l().IS)((()=>({container:{width:"max-content",maxWidth:"100%",marginRight:4,...d().RC},containerInner:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:6},containerHovered:{...C&&{background:"none"}}})),[C]),A=(0,n.useCallback)((()=>{(0,u().X)({environment:f,collectionContextStore:s,action:"click_collection_name_link_button"})}),[f,s]);return y&&v?(0,g.jsxs)(o(296798).A,{disabled:x,style:w.container,innerStyle:w.containerInner,hoveredStyle:w.containerHovered,href:b,onClick:A,children:[(0,g.jsx)(T,{collectionContextStore:s,disabled:!0,iconStyle:p,iconSize:m}),(0,g.jsx)(S,{addViewButton:t?h:void 0,actionButton:t?(0,g.jsx)(M,{showHoverActionsStore:a,collectionContextStore:s}):void 0,store:y,titleStyle:c})]}):null})),R=n.memo((function(e){const{isHovered:t,collectionContextStore:s,addViewButton:a,showHoverActionsStore:d,titleStyle:p,iconStyle:m,iconSize:S}=e,h=(0,r().v3)(),f=(0,c().tz)(),y=(0,i().K8)((()=>s.collectionStore()),[s]),v=(0,i().K8)((()=>s.collectionViewBlockStore()),[s]),x=(0,i().K8)((()=>null==y?void 0:y.getNameStore()),[y]),b=(0,i().K8)((()=>(0,A().ei)(h)),[h]),w=(0,i().K8)((()=>{var e;return b&&y?(0,C().nE)({intl:f}):(null==v||null===(e=v.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:v.getRecordModel,userTimeZone:(0,o(416504).P)(),intl:f}))||(0,C().nE)({intl:f})}),[y,v,f,b]),k=(0,l().IS)((e=>({container:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},titleIcons:{display:"flex",alignItems:"center",opacity:t?1:0},text:p,placeholder:{WebkitTextFillColor:e.pageTitlePlaceholderTextColor,cursor:"text"}})),[p,t]),I=(0,n.useMemo)((()=>(0,g.jsxs)("div",{style:k.titleIcons,children:[a,(0,g.jsx)(M,{showHoverActionsStore:d,collectionContextStore:s})]})),[a,s,d,k.titleIcons]),j=(0,n.useCallback)((()=>{o(778417).IU({environment:h})}),[h]),R=(0,n.useCallback)((()=>{(0,u().X)({environment:h,collectionContextStore:s,action:"click_collection_name_input"})}),[h,s]);return y&&v&&x?(0,g.jsxs)("div",{style:k.container,children:[(0,g.jsx)(T,{collectionContextStore:s,disabled:!1,iconStyle:m,iconSize:S}),(0,g.jsx)(o(524702).A,{store:x,style:k.text,disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:w,onEnter:j,onEsc:j,onClick:R,disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:o(792540).Os.none,placeholderStyle:k.placeholder},x.id),I]}):null})),T=n.memo((function(e){const{disabled:t,collectionContextStore:a,iconStyle:c,iconSize:d=22}=e,u=(0,r().v3)(),{collectionStore:p,collectionViewBlockStore:S}=(0,i().K8)((()=>({collectionStore:a.collectionStore(),collectionViewBlockStore:a.collectionViewBlockStore()})),[a]),h=(0,i().K8)((()=>null==p?void 0:p.getIcon()),[p]),f=(0,i().K8)((()=>{var e;return Boolean((null==p||null===(e=p.getParentBlockStore())||void 0===e?void 0:e.id)===(null==S?void 0:S.id))}),[p,S]),v=(0,i().K8)((()=>null==S?void 0:S.getType()),[S]),b=(0,l().IS)((e=>({iconStyle:{width:d,height:d,marginRight:4,...c},container:{position:"relative",width:d+2,height:d+2,marginRight:4,display:"flex",alignItems:"center",justifyContent:"center"},arrowContainer:{width:20,marginRight:4},pageLinkIndicatorIcon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.text.primary:"#3E3C38",stroke:"dark"===e.mode?e.surface.wash:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[c,d]),C=(0,n.useCallback)((e=>{const t=p&&p.getIconStore();t&&m().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:u,canUndo:!0,perform:n=>{o(246826).KY({store:t,value:e,transaction:n})}})}),[p,u]);return p&&S?h||f?h?(0,g.jsxs)("div",{style:b.container,children:[t?(0,g.jsx)(x().B,{disabled:!0,bucket:"secure",store:p,icon:h,isEmptyPage:!1,style:b.iconStyle,size:d}):(0,g.jsx)(x().B,{disabled:!1,bucket:"secure",store:p,icon:h,isEmptyPage:!1,style:b.iconStyle,size:d,iconLoggingData:{recordTable:p.table,source:"inline_collection",block_type:v,collection_id:p.id},onChange:C}),!f&&(0,o(500066).G)(b.pageLinkIndicatorIcon)]}):null:(0,g.jsx)("div",{style:b.arrowContainer,children:(0,g.jsx)(y().I,{icon:s().arrowDiagonalUpRightIcon})}):null})),M=n.memo((function(e){const{showHoverActionsStore:t,collectionContextStore:s}=e,{isMobile:d}=(0,r().Y0)(),u=(0,c().tz)(),p=(0,i().O$)(t),m=(0,l().IS)((()=>({container:{display:"flex"},buttonPopup:{width:240},iconStyle:{width:a().Ev.sm,height:a().Ev.sm}})),[]),S=(0,n.useCallback)((e=>(0,g.jsx)(o(285790).A,{icon:o(126617).Y,iconStyle:m.iconStyle,ariaLabel:u.formatMessage(C().k9.actionsButtonAriaLabel),...e})),[u,m.iconStyle]),h=(0,n.useCallback)((e=>(0,g.jsx)(_,{parent:e,collectionContextStore:s})),[s]);return(0,g.jsx)(o(145214).A,{visible:p,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:m.container,children:(0,g.jsx)(o(406699).Ay,{popupType:d?v().nl.SlideUp:v().nl.Popup,render:h,renderOrigin:S,style:m.buttonPopup,originGap:4})})})),_=n.memo((function(e){const{parent:t,collectionContextStore:l}=e,a=(0,r().v3)(),{isMobile:d}=(0,r().Y0)(),S=(0,k().X)("db_ux_chrome"),{collectionStore:v,collectionViewStore:x}=(0,i().K8)((()=>({collectionStore:l.collectionStore(),collectionViewStore:l.collectionViewStore()})),[l]),C=(0,i().O$)(l.permissionScopesStore),I=(0,i().K8)((()=>null==v?void 0:v.isSyncedCollection()),[v]),j=(0,i().K8)((()=>{var e,t;const o=Boolean(null==v?void 0:v.isSystemCollection()),n=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.id,r=null==v||null===(t=v.getParentBlockStore())||void 0===t?void 0:t.id,i=r&&n&&r===n;return(!(l.isFullScreenStore.state&&i)||!(0,A().ei)(a))&&!o}),[l,v,a]),R=(0,n.useMemo)((()=>{const e=[j?{key:"view",render:e=>(0,g.jsx)(h().A,{...e,title:(0,g.jsx)(c().sA,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,g.jsx)(y().I,{icon:s().arrowDiagonalUpRightIcon})}),action:e=>{(0,o(239529).q)({environment:a,collectionContextStore:l,event:e.event,buttonPopupParent:t})}}:null,C.canConfigureCollection&&!I?{key:"edit_name",render:e=>(0,g.jsx)(h().A,{...e,title:(0,g.jsx)(c().sA,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,g.jsx)(y().I,{icon:o(105819).pencilLineIcon})}),action:()=>{const e=null==v?void 0:v.getNameStore();e&&(o(725614).selectAllText({environment:a,store:e,canSelectAllBlocks:!1}),t.close(),(0,u().X)({environment:a,collectionContextStore:l,action:"click_source_edit_title"}))}}:null];return e.filter((e=>null!==e))}),[j,C.canConfigureCollection,I,a,l,t,v]),T=(0,n.useMemo)((()=>({key:"show_title",render:e=>(0,g.jsx)(h().A,{...e,icon:(0,g.jsx)(y().I,{icon:o(566910).e}),title:(0,g.jsx)(c().sA,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{m().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:a,canUndo:!0,perform:e=>{if(!x)return;p().zA({stores:[x],update:{hide_linked_collection_name:!0},transaction:e});const t=l.collectionViewBlockStore();S&&t&&p().zA({stores:[t],update:{hide_inline_collection_name:!0},transaction:e})}}),t.close(),(0,u().X)({environment:a,collectionContextStore:l,action:"click_source_hide_title"})}})),[l,x,a,t,S]),M=(0,n.useMemo)((()=>[R.length>0?{key:"actions",render:e=>(0,g.jsx)(b().A,{...e}),items:R}:null,C.canConfigureBlock?{key:"show_title",render:e=>(0,g.jsx)(b().A,{...e,topBorder:!0}),items:[T]}:null].filter((e=>null!==e))),[R,T,C.canConfigureBlock]);return v?(0,g.jsx)(o(928600).A,{menuType:d?w().gu.ActionSheet:w().gu.Popup,children:(0,g.jsx)(f().Ay,{type:f().Oh.Vertical,onAccept:t.close,sections:M,initialFocus:void 0})}):null}))},286993:(e,t,o)=>{o.d(t,{c:()=>c});o(581454),o(296540);var n=()=>o(847249),r=()=>o(496603),i=()=>o(812119),l=()=>o(175116),s=()=>o(62856),a=o(474848);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().Ks)(),m=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,s().A)(!0,0,100))return null;let g=1;void 0!==u?g=u:o||c||d||(g=t?10:3);const S=g>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r().Hn(g).map((e=>(0,a.jsx)(i().J,{isInHomeWidget:m,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:m?8:3},children:h})}},316369:(e,t,o)=>{o.d(t,{w:()=>C});o(581454),o(296540);var n=()=>o(484714),r=()=>o(651124),i=()=>o(30626),l=()=>o(959013),s=()=>o(496603),a=()=>o(436696),c=()=>o(896628),d=()=>o(751156),u=()=>o(722872),p=()=>o(760217),m=()=>o(406699),g=()=>o(285790),S=()=>o(928600),h=()=>o(939740),f=()=>o(897119),y=()=>o(89924),v=o(474848);const x=(0,l().j4)((function(e){const{limit:t}=e;return(0,v.jsx)(l().sA,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})})),b=(0,l().YK)({firstLoadLimitActionButtonAriaLabel:{defaultMessage:"Load limit settings menu",id:"database.firstLoadLimitActionButton.ariaLabel"}});function C(e){let{format:t,collectionContextStore:o}=e;const r=(0,n().v3)(),{device:s}=r,u=(0,l().tz)();return s.isMobile?null:(0,v.jsx)(m().Ay,{popupType:f().nl.Popup,renderOrigin:e=>(0,v.jsx)(g().A,{icon:i()._,style:{marginLeft:4,marginRight:4},ariaLabel:u.formatMessage(b.firstLoadLimitActionButtonAriaLabel),...e}),alignmentToOrigin:m().yP.End,placementToOrigin:m().sx.Bottom,originGap:8,render:e=>(0,v.jsx)(k,{currentLimit:w(t),onAccept:e=>function(e,t,o){const n=t.collectionViewStore();if(!n)return;if(!n.getType())return;d().createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,canUndo:!0,perform:t=>{c().zA({stores:[n],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),(0,a().X)({environment:o,collectionContextStore:t,action:"set_first_load_limit"})}(e,o,r),onClose:e.close,showTitle:!0})})}function w(e){return(0,r().i3)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function k(e){const t=(0,n().v3)(),{device:o}=t,{currentLimit:i,onAccept:a,onClose:c,showTitle:d}=e,m=(0,s().oE)(r().X9.map(((e,t)=>{const o={key:t,render:t=>(0,v.jsx)(p().A,{...t,disabled:!1,title:(0,v.jsx)(x,{limit:e}),isChecked:(0,s().n4)(i,e)}),action:()=>a(e)};return o}))),g=[{key:0,render:e=>(0,v.jsx)(y().A,{enableActionSheetTitle:!0,title:d&&(0,v.jsx)(l().sA,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:m}];let f;return f=o.isMobile?{menuType:u().gu.ActionSheet}:{menuType:u().gu.Popup,width:200},(0,v.jsx)(S().A,{...f,children:(0,v.jsx)(h().Ay,{type:h().Oh.Vertical,sections:g,onAccept:c,initialFocus:void 0})})}},320260:(e,t,o)=>{o.d(t,{y:()=>c});var n=o(296540),r=()=>o(401497),i=()=>o(644187),l=()=>o(720665),s=()=>o(645873);const a=new(s().O2)("notionCalendarLogos",(async()=>o.e(94366).then(o.bind(o,543276))));function c(e){const t=(0,s().fJ)(a),o=function(){const[e,t]=(0,n.useState)(new Date),o=(0,n.useRef)();return(0,n.useEffect)((()=>{const n=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},r=new Date,i=new Date(r);i.setHours(r.getHours()+1),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);const s=i.getTime()-r.getTime(),a=setTimeout((()=>{n(),o.current=window.setInterval(n,l().pT)}),s);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),c=e.dateNumber??o.getDate(),d=(0,r().IS)((t=>({icon:{width:16,height:16,color:t.icon.secondary,...e.style}})),[e.style]),u=(0,n.useCallback)((e=>{const o=i().K;if(e<1||e>31)return o(d.icon);const n=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;if("resolved"!==t.status)return o(d.icon);return(0,t.value[n])(d.icon)}),[d,t]);return u(c)}},324254:(e,t,o)=>{o.r(t),o.d(t,{arrowChevronSingleDownSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"m12.76 6.52-4.32 4.32a.62.62 0 0 1-.44.18.62.62 0 0 1-.44-.18L3.24 6.52a.63.63 0 0 1 0-.88c.24-.24.64-.24.88 0L8 9.52l3.88-3.88c.24-.24.64-.24.88 0s.24.64 0 .88"})},r=(0,o(340498).wt)("arrowChevronSingleDownSmall",n)},344417:(e,t,o)=>{o.d(t,{u:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M7.1 1.975a5.125 5.125 0 1 0 3.155 9.164l3.107 3.107a.625.625 0 1 0 .884-.884l-3.107-3.107A5.125 5.125 0 0 0 7.1 1.975M3.225 7.1a3.875 3.875 0 1 1 7.75 0 3.875 3.875 0 0 1-7.75 0"})},r=(0,o(340498).wt)("magnifyingGlassSmall",n)},344482:(e,t,o)=>{o.d(t,{A:()=>r});o(898992),o(672577);class n extends(()=>o(959180))().A{findTableHeaderCell(e,t){return this.find((o=>o.collectionContextStore===e&&o.property===t))}}const r=new n},358006:(e,t,o)=>{o.d(t,{z:()=>l});o(296540);var n=()=>o(645873),r=o(474848);const i=new(n().O2)("CollectionItemCover",(async()=>{const{CollectionItemCover:e}=await o.e(79883).then(o.bind(o,873718));return{CollectionItemCover:e}})),l=(0,n()._h)(i,(e=>e.CollectionItemCover),{renderLoading:(e,t)=>{const{coverHeight:n,coverSizeFormat:i,emptyGalleryCoverStyle:l,showEmptyGalleryCover:s}=t;return s?(0,r.jsx)(o(271232).t,{coverHeight:n,coverSizeFormat:i,emptyGalleryCoverStyle:l}):null}})},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>_,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>w,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>C,MAX_RECURRENCE_INTERVAL:()=>f,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>y,RRULE_WEEKDAYS_MAP:()=>h,adjustedStartDateIfPossible:()=>A,areRecurrenceSchedulesEqual:()=>L,convertFromUnpersistedRecurrenceConfig:()=>F,convertToUnpersistedRecurrenceConfig:()=>P,getFormattedEndCondition:()=>M,getFormattedNextRecurrenceTime:()=>T,getNewEndTimestamp:()=>B,getNextDateUtc:()=>R,getRecurrenceAfter:()=>I,isRunningBetweenMidnightAnd3AM:()=>j,isValidRecurrenceInterval:()=>v,isValidRecurrenceNumberOfRuns:()=>x,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>k});o(898992),o(354520),o(581454);var n=()=>o(244641);o(944114);function r(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const i=[];for(const l of e)i.push(...r(o[0],...o.slice(1)).map((e=>[l,...e])));return i}var i=()=>o(496603),l=()=>o(534177),s=()=>o(720665),a=()=>o(597777),c=()=>o(869190),d=()=>o(416504),u=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const g=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),S={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},h={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},f=99,y=999;function v(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=f}function x(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function b(e){const{start_date:t,frequency:o,interval:n,weekdays:i,timezone:s,hour:c,minute:d}=e,u="week"===o&&i?i.map((e=>h[e])):void 0,m={};return(0,l().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,a().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,l().HB)(e.end_condition)),"month"===e.frequency&&(0,l().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return h[t].nth(o)})):(0,l().HB)(e.monthly_restriction)),new p({freq:S[o],dtstart:(0,a().eU)(t),interval:n,byweekday:u,tzid:s,byhour:c??0,byminute:d??0,bysecond:0,...m})}const C=1,w=1;function k(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=n>C,l=o.length>=w;return{violatesConstraint:i||l,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:l,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function A(e){var t;const{recurrence:o,afterDate:r}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=r)return o;let i=n().c9.fromMillis(o.start_date,{zone:"utc"});const l=n().c9.fromMillis(r,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(l.diff(i,"years").years/o.interval);i=i.plus({years:e*o.interval});break}case"month":{const e=Math.floor(l.diff(i,"months").months/o.interval);i=i.plus({months:e*o.interval});break}case"week":{const e=Math.floor(l.diff(i,"weeks").weeks/o.interval);i=i.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(l.diff(i,"days").days/o.interval);i=i.plus({days:e*o.interval});break}}return{...o,start_date:(0,a().DH)(i.toMillis())}}function I(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,a().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(A({recurrence:t,afterDate:o})).after((0,a().eU)(o));if(!e)return;return(0,a().h1)(e)}}function j(e){return 0===e.hour||1===e.hour||2===e.hour}function R(e){return b(e).after((0,a().eU)((0,a().Rz)()))||void 0}function T(e){const{recurrence:t,intl:o}=e,r=R(F(t));if(!r)return;const i=j(t),l=n().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(o)).setZone(t.timezone),s=(0,c().Yq)({date:l,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(i)return o.formatMessage(g.dateBetweenMidnightAnd3AM,{date:s});{let e=l.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${l.toFormat("ZZZZ")}`),o.formatMessage(g.dateAtTime,{date:s,time:e})}}function M(e,t){return(0,l().O9)(e)?"number"===e.type?t.formatMessage(g.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,l().HB)(e):t.formatMessage(g.noEndCondition)}const _=100;function P(e){return{...e,start_date:(0,a().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,a().l1)(e.end_condition.end_at)}:(0,l().HB)(e.end_condition):void 0}}function B(e,t,o){return e.plus(o-t)}function V(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,a().Rz)(o.toJSDate())}}function F(e){return{...e,start_date:(0,a().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?V(e,e.end_condition):(0,l().HB)(e.end_condition):void 0}}function L(e,t){const o=i().fN(e,(e=>void 0!==e)),n=i().fN(t,(e=>void 0!==e));return i().n4(o,n)}},403733:(e,t,o)=>{o.d(t,{g:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M8 2.125a.61.61 0 0 0-.625.599v9.017L4.122 8.488a.625.625 0 1 0-.884.884l4.32 4.32c.244.244.64.244.884 0l4.32-4.32a.625.625 0 0 0-.884-.884l-3.253 3.253V2.724A.61.61 0 0 0 8 2.125"})},r=(0,o(340498).wt)("arrowStraightDownSmall",n)},406533:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>r,questionMarkCircleIcon:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.978 7.154c-.804 0-1.333.456-1.438.874a.625.625 0 0 1-1.213-.303c.28-1.121 1.44-1.82 2.65-1.82 1.365 0 2.714.905 2.714 2.298 0 .812-.49 1.477-1.13 1.872l-.755.516a.84.84 0 0 0-.381.677.625.625 0 1 1-1.25 0c0-.688.36-1.318.921-1.706l.003-.002.784-.535.014-.008c.374-.228.544-.537.544-.814 0-.459-.517-1.049-1.463-1.049m.662 6.336a.8.8 0 1 1-1.6 0 .8.8 0 0 1 1.6 0"}),(0,n.jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0M10 3.625a6.375 6.375 0 1 0 0 12.75 6.375 6.375 0 0 0 0-12.75"})]})},i=(0,o(340498).wt)("questionMarkCircle",r)},422540:(e,t,o)=>{o.d(t,{$0:()=>h,Fx:()=>w,Ge:()=>m,I3:()=>u,Kj:()=>b,PP:()=>k,TK:()=>A,Yy:()=>d,aE:()=>I,cQ:()=>C,kH:()=>g,m7:()=>p,nq:()=>v,nv:()=>f,tj:()=>S});o(898992),o(354520),o(737550);var n=()=>o(496603),r=()=>o(534177),i=()=>o(970013),l=()=>o(651124),s=()=>o(349835),a=()=>o(390066);(0,r().u0)((e=>(0,r().O9)(e)&&(0,r().O9)(e.target)&&(0,r().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function u(e){return Boolean(c[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:c,sourcePropertyIds:d}=e,p=(d??(0,r().uv)(o)).filter(((t,n,r)=>{const l=o[t];return!(!l||!u(l))&&(("relation"!==l.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,l))&&(!s||s([t,l],n,o)))}));if(0===p.length)return[];if(!t||!1===c)return p;const m=(0,a().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:o,sort:s}=e,c=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,i().JY)(r))}));if(0===c.length)return[];if(!t||!1===s)return c;const d=(0,a().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(c,(e=>d.findIndex((t=>t.property===e))))}function g(e){return e.type===s().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===s().M9.TokenExpected?{type:e.type,token:e.token}:e.type===s().uW.MissingSchemaPropertyOnThisRow||e.type===s().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===s().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===s().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===s().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===s().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===s().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===s().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===s().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===s().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===s().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===s().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===s().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const S={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function h(e){return Boolean(S[e.type])}function f(e){const{collectionFormat:t,collectionSchema:o,filter:s,sort:c}=e,d=(0,r().uv)(o).filter(((e,t,n)=>{var r;const l=o[e];return!(!l||!S[l.type])&&((!(0,i().$M)(l)||null===(r=(0,i().om)(l))||void 0===r||!r.auto_update_on_edit)&&(!s||s([e,l],t,o)))}));if(0===d.length)return[];if(!t||!1===c)return d;const u=(0,a().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(d,(e=>u.findIndex((t=>t.property===e))))}const y={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function v(e){return y[e.type]}const x={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function b(e){return x[e.type]}function C(e){return 0===e}function w(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function k(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function A(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!u(r):!S[r.type])}function I(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:i,relativeDate:l}=t.event;if(void 0===i)return!1;const s="some"===n.type&&n.some,a="all"===n.type&&n.all;if((s||a||[]).some((e=>k({collectionSchema:o,property:e.property})||A({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const c="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),d="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||c||d)&&!l)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},425981:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(941541);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=e=>{let{value:t,passThroughData:o}=e,n=!0;this.didEmit||(this.didEmit=!0,n=!1),this.lastValue===t?n=!1:this.lastValue=t,n&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},442277:(e,t,o)=>{o.d(t,{B:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("arrowRightSmaller",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M15.383 8.352a.877.877 0 01-.274.64l-5.156 5.14a.864.864 0 01-.617.266.831.831 0 01-.602-.234.795.795 0 01-.234-.586c0-.12.02-.232.063-.336a.912.912 0 01.187-.273l1.75-1.766 2.914-2.656.274.5-2.711.156H1.484c-.26 0-.471-.078-.632-.234a.851.851 0 01-.235-.617c0-.256.078-.461.235-.618a.856.856 0 01.632-.242h9.493l2.71.164-.273.508L10.5 5.5 8.75 3.727a.946.946 0 01-.188-.266.917.917 0 01-.062-.344c0-.234.078-.43.234-.586a.831.831 0 01.602-.234.79.79 0 01.328.07c.104.047.203.117.297.211l5.148 5.133a.877.877 0 01.274.64z"})})},457688:(e,t,o)=>{o.d(t,{A:()=>v,S:()=>f});var n=o(296540),r=()=>o(484714),i=()=>o(847249),l=()=>o(764880),s=()=>o(959013),a=()=>o(962730),c=()=>o(678553),d=()=>o(554509),u=()=>o(453697),p=o(474848);const m="UIRegular-14px/Regular",g="UIRegular-14px/Semibold",S="iOS/Callout-16px/Regular",h=n.forwardRef(((e,t)=>{const{actor:n,userTitle:s,defaultUserTitle:d="name_only",useEmailAsTooltip:m,tooltip:g,tooltipPlacement:S,hoveredStyle:h,disabledFeedback:v,customUserTitleStyles:x,iconSizeOverride:b}=e,C=(0,r().v3)(),w=(0,i().K8)((()=>n.asActor&&n.isUser()?n.email:void 0),[n]),k=m&&w?w:g,A=b||(C.device.isMobile?c().nd:c().pg),I="name_and_email"===d||"name_and_email_unless_right"===d&&!Boolean(e.right)?(0,p.jsx)(y,{actor:null==n?void 0:n.asActor,customStyles:x}):(0,p.jsx)(f,{customStyles:x,actor:null==n?void 0:n.asActor}),j=s??I;let R;return(0,l().H3)(n)?R=(0,p.jsx)(o(256863).A,{botValue:null==n?void 0:n.asActor,size:A}):(0,l().ps)(n)?R=(0,p.jsx)(u().A,{userValue:null==n?void 0:n.asActor,size:A}):(0,l().h2)(n)?R=(0,p.jsx)(u().A,{userValue:void 0,size:A}):(0,o(534177).HB)(n),(0,p.jsx)(o(859428).A,{placement:S??a().W.Bottom,alignment:a().C.Start,textWrap:!0,render:n=>(0,p.jsx)(o(760217).A,{...(0,o(553965).A)(n,e),icon:R,title:j,disabledFeedback:v,className:"notranslate",right:e.right,ref:t,hoveredStyle:h}),disableTooltip:!k,renderTooltip:()=>k})}));function f(e){const{actor:t,customStyles:o}=e,n=(0,r().v3)(),l=(0,s().tz)(),a=(0,i().K8)((()=>t&&t.id===n.currentUser.id),[n,t]),c=(0,i().K8)((()=>t&&t.getDisplayName(l)),[t,l]),u=n.device.isMobile?S:m;return a?(0,p.jsx)(s().sA,{id:"UserMenuItem.fullName.authorLabel",defaultMessage:"<author>{fullName}</author> <you>(You)</you>",values:{author:e=>(0,p.jsx)(d().D,{as:"span",styleName:u,customStyles:o,children:e}),fullName:c,you:e=>(0,p.jsx)(d().D,{as:"span",colorName:"secondary",styleName:u,customStyles:o,children:e})}}):c?(0,p.jsx)(d().D,{styleName:u,customStyles:o,children:c}):(0,p.jsx)(d().D,{styleName:u,customStyles:o,children:(0,p.jsx)(s().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}function y(e){const t=(0,r().v3)(),{actor:o,customStyles:n}=e,l=(0,s().tz)(),a=(0,i().K8)((()=>o&&o.getDisplayName(l)),[o,l]),{email:c,showEmail:u}=(0,i().K8)((()=>{const e=o&&o.asActor&&o.isUser()?o.email:void 0;return{email:e,showEmail:a!==e}}),[o,a]),h=t.device.isMobile?"iOS/Callout-16px/Regular":g,f=t.device.isMobile?S:m;return a?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(d().D,{as:"span",styleName:h,customStyles:n,children:a}),u&&(0,p.jsx)(d().D,{as:"span",styleName:f,customStyles:n,children:` ${c}`})]}):(0,p.jsx)(d().D,{styleName:g,customStyles:n,children:(0,p.jsx)(s().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}h.displayName="UserMenuItem";const v=h},464699:(e,t,o)=>{o.d(t,{b:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("plusThick",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})},488887:(e,t,o)=>{function n(e,t){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}o.d(t,{_:()=>n})},505776:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().default{constructor(){super(...arguments),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},517843:(e,t,o)=>{o.d(t,{V:()=>A,A:()=>w});o(16280);var n=o(296540),r=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(686526),a=()=>o(725614),c=()=>o(59400),d=()=>o(735695);var u=()=>o(145214),p=()=>o(297872),m=()=>o(897119),g=()=>o(38337),S=()=>o(525432),h=()=>o(69447),f=()=>o(753199),y=()=>o(553965),v=()=>o(953418),x=()=>o(963589),b=()=>o(700250),C=o(474848);function w(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:l,settingsHeaderSizeObserver:s,placementStore:a,placementToOrigin:c=b().UV.Bottom,alignmentToOrigin:u=b().MY.Start,marginTop:p=-1,originGap:m,headerRef:g,handleAddItemClick:h}=e,f=(0,r().v3)(),y=(0,i().O$)(a),[x,w]=(0,n.useState)(!1),I=(0,i().K8)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),j=(0,i().O$)(t.isFullScreenStore),[R,T]=(0,n.useState)(!1),M=(0,i().K8)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),_=(0,i().K8)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),P=(0,i().K8)((()=>{const e=o.rect.state;return 0!==e.width?(0,S().wW)(t,f.device.isMobile,e.width):"popup"}),[t,f.device.isMobile,o.rect]);(0,n.useEffect)((()=>{M&&(o.recompute(),s.recompute(),a.setState(P)),M&&!j&&"form_editor"!==_&&w(!0)}),[M,j,a,o,s,_,P]);const B=(0,i().K8)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:s.rect.state.right-2,y:s.rect.state.y-2,width:0,height:s.rect.state.height})),[t,s.rect]);return(0,n.useEffect)((()=>{if(x){const e=null==g?void 0:g.current;if(e){const t=e.getBoundingClientRect();f.WindowSizeStore.state.height-t.top<d().iZ&&((0,v().vq)(e,{edgeDist:0,animate:!1}),o.recompute(),s.recompute())}w(!1)}}),[t,f.WindowSizeStore,o,s,I,x,g]),(0,n.useEffect)((()=>{T(!!M)}),[M]),"sidebar"===y?(0,C.jsx)(k,{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:l,paddingRight:e.paddingRight,shouldScrollIntoView:x,headerHeightStore:e.headerHeightStore,settingsOpen:R,isInPeekRenderer:I}):(0,C.jsx)(A,{collectionContextStore:t,placementToOrigin:c,alignmentToOrigin:u,originGap:m??0,marginTop:p,settingsOpen:R,shouldScrollIntoView:x,originRect:B,handleAddItemClick:h})}function k(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:s,shouldScrollIntoView:c,settingsOpen:d}=e,m=(0,x().X)("db_ux_chrome"),S=(0,r().v3)(),v=(0,i().K8)((()=>{const e=o.rect.state;return S.WindowSizeStore.state.height-(e.top+h().Lq)}),[S.WindowSizeStore,o.rect]),b=(0,i().K8)((()=>n.rect.state.height),[n.rect]),w=(0,i().K8)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),k=(0,i().O$)(e.headerHeightStore),A=(0,i().K8)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),j=(0,l().IS)((e=>({topLevelDiv:{position:"absolute",top:k,right:-s,background:w?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,borderImage:m?`linear-gradient(180deg, ${e.contentBackground} 0px, ${e.tableDividerColor} 12px) 1 100%`:void 0,paddingRight:s,zIndex:88,...A?{height:b,minHeight:v}:{height:v}},nestedDiv:{...m?{}:{boxShadow:`inset 0 1px 0 ${e.tableDividerColor}`}}})),[k,s,w,A,b,v,m]);return d?(0,C.jsx)(p().A,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,C.jsx)(u().A,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:j.topLevelDiv,className:g().N11,...(0,y().A)({onMouseDown:e=>function(e,t){(0,f().SQ)({event:e,context:f().y$.EditorMouseDown,callback:()=>{a().clear({environment:t})}})}(e,S)},e),children:(0,C.jsxs)("div",{style:{display:"flex",...A?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,C.jsx)("div",{style:j.nestedDiv,children:(0,C.jsx)(I,{collectionContextStore:t,shouldScrollIntoView:c,isSidebar:!0})}),(0,C.jsx)("div",{style:{width:s}})]})})}):null}function A(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:l,originGap:a,marginTop:c,settingsOpen:d,shouldScrollIntoView:u,originRect:p,origin:S=(0,C.jsx)("div",{}),handleAddItemClick:h}=e,y=(0,r().v3)(),v=(0,n.useCallback)((e=>(0,C.jsx)(I,{collectionContextStore:t,shouldScrollIntoView:u,isSidebar:e,handleAddItemClick:h})),[t,u,h]),x=function(e){let{collectionContextStore:t}=e;const o=(0,r().v3)(),n=(0,r().WS)(),l=(0,i().K8)((()=>o.WindowSizeStore.isLandscape()),[o.WindowSizeStore]);return(0,i().K8)((()=>"chart"===(null==t?void 0:t.getViewType())&&n&&!l),[t,n,l])}({collectionContextStore:t});return(0,C.jsx)(m().Ay,{popupType:y.device.isMobile?m().nl.BottomSheet:m().nl.Popup,bottomSheetInitialState:x?"half":"full",className:`${g().N11} ${g().xeF}`,open:d,placementToOrigin:o,alignmentToOrigin:l,style:{marginTop:c},origin:S,originGap:a,render:v,onDismiss:t=>{var o;null===(o=e.onDismiss)||void 0===o||o.call(e),function(e,t){(0,f().SQ)({event:e,context:f().y$.CollectionSettingsClick,callback:()=>{s().os({collectionSettingsStore:t.settingsStore})}})}(t,e.collectionContextStore)},originRect:p,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}function I(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:n,handleAddItemClick:r}=e;return n?null:(0,C.jsx)(c().m$,{context:S().Bd.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t,handleAddItemClick:r})}},523389:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,pencilLineSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M11.243 3.457a.803.803 0 0 0-1.13 0l-.554.552a.075.075 0 0 0 0 .106l1.03 1.03a.075.075 0 0 0 .107 0l.547-.546a.1.1 0 0 0 .019-.032.804.804 0 0 0-.02-1.11m-2.246 1.22a.075.075 0 0 0-.106 0l-6.336 6.326a1.1 1.1 0 0 0-.237.393l-.27.87v.002c-.062.232.153.466.389.383l.863-.267q.221-.061.397-.239l6.332-6.331a.075.075 0 0 0 0-.106zm-3.355 6.898a.08.08 0 0 0-.053.022l-1.1 1.1a.075.075 0 0 0 .053.128h9.06a.625.625 0 1 0 0-1.25z"})},r=(0,o(340498).wt)("pencilLineSmall",n)},527580:(e,t,o)=>{o.d(t,{TK:()=>s,YC:()=>l,ui:()=>i});var n=()=>o(645873);const r={pageVerification:new(n().O2)("pageVerification",(()=>o.e(94891).then(o.bind(o,80826)))),pageVerificationBadge:new(n().O2)("pageVerificationBadge",(()=>Promise.all([o.e(75134),o.e(43380),o.e(96346),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(28866),o.e(6463),o.e(1213),o.e(59794),o.e(75601),o.e(58504),o.e(14590),o.e(41412)]).then(o.bind(o,161901)))),pageVerificationMenuRenderer:new(n().O2)("pageVerificationMenuRenderer",(()=>Promise.all([o.e(75134),o.e(43380),o.e(96346),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(28866),o.e(6463),o.e(1213),o.e(59794),o.e(75601),o.e(58504),o.e(14590),o.e(26207)]).then(o.bind(o,196770))))},i=(0,n()._h)(r.pageVerification,(e=>e.PageAddVerificationButton)),l=(0,n()._h)(r.pageVerificationBadge,(e=>e.PageVerificationBadge)),s=(0,n()._h)(r.pageVerificationMenuRenderer,(e=>e.PageVerificationMenuRenderer))},532940:(e,t,o)=>{o.r(t),o.d(t,{exclamationMarkTriangleIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M9.875 6.75c.345 0 .625.28.625.625v3.5a.625.625 0 1 1-1.25 0v-3.5c0-.345.28-.625.625-.625m0 7.375a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,n.jsx)("path",{d:"M8.16 3.563c.818-1.417 2.863-1.417 3.68 0l5.846 10.125c.818 1.416-.204 3.187-1.84 3.187H4.155c-1.636 0-2.659-1.77-1.84-3.187zm2.598.624a.875.875 0 0 0-1.516 0L3.397 14.313a.875.875 0 0 0 .758 1.313h11.69a.875.875 0 0 0 .759-1.312z"})]})},i=(0,o(340498).wt)("exclamationMarkTriangle",r)},546461:(e,t,o)=>{o.d(t,{EC:()=>C,To:()=>b,YC:()=>w,or:()=>x,u:()=>v});o(16280);var n=o(296540),r=()=>o(484714),i=()=>o(847249),l=()=>o(496506),s=()=>o(322867),a=()=>o(959013),c=()=>o(534177),d=()=>o(813297),u=()=>o(862292),p=()=>o(698331),m=()=>o(645873),g=()=>o(190019),S=()=>o(76190),h=o(474848);const f=new WeakMap,y=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});y.displayName="AutomationContext";function v(e){const{automationStore:t,children:o,contextType:n}=e,v=(0,r().v3)(),x=(0,a().tz)(),{value:b}=(0,m().fJ)(u().T.formulas),{value:C}=(0,m().fJ)(d().QV.automationTypecheck),w=(0,S().n)(t),k=(0,i().K8)((()=>{if(!b)return{error:new(s().N9)("Missing formulas dependency")};if(!C)return{error:new(s().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:i,intl:s,isSubscribed:a}=e,d=f.get(o);if(d)return d;{const e=new(l().default)((()=>{const e=o.getTriggerType();let l=r;return(0,c().O9)(e)&&(0,p().x2)(e)&&(l=(0,p().H8)(e)),(0,g().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:l,formulasModule:i,intl:s,isSubscribed:a})}),{debugName:"automationContextTypecheckResultCachedStore"});return f.set(o,e),e}}({environment:v,automationStore:t,automationTypecheckModule:C,contextType:n,formulasModule:b,intl:x,isSubscribed:w});return e.state}),[v,t,C,n,b,x,w]);return(0,h.jsx)(y.Provider,{value:{automationStore:t,typecheckResult:k,contextType:n,defined:!0},children:o})}function x(e){const{automationStore:t,children:o}=e,n=(0,i().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,h.jsx)(v,{automationStore:t,contextType:(0,p().H8)(n??"event"),children:o})}function b(e){var t;return null===(t=f.get(e))||void 0===t?void 0:t.state}function C(){const e=n.useContext(y);if(!1===e.defined)throw new Error("No automation context found!");return e}function w(){return n.useContext(y)}},556048:(e,t,o)=>{o.d(t,{C8:()=>p,Dz:()=>a,GC:()=>g,GL:()=>S,YY:()=>m,dM:()=>d,h9:()=>c,jX:()=>s,oF:()=>u,uj:()=>l});var n=()=>o(645873);const r={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(75134),o.e(68744)]).then(o.bind(o,408453)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(75134),o.e(2686)]).then(o.bind(o,484967)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await o.e(28763).then(o.bind(o,992567)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await o.e(98288).then(o.bind(o,984289)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await o.e(21446).then(o.bind(o,470020)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,470020))))},i={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>o.e(56188).then(o.bind(o,604698))))},l=(0,n()._h)(i.JiraSyncTeamSpaceModal,(e=>e.default)),s=(0,n()._h)(r.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),a=(0,n()._h)(r.JiraDCAuthModal,(e=>e.default)),c=(0,n()._h)(r.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n()._h)(r.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n()._h)(r.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(r.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),m=(0,n()._h)(r.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),g=(0,n()._h)(r.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),S=(0,n()._h)(r.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator));(0,o(340498).xh)("jira",{default:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:20},small:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:16},mini:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:14},large:{loader:()=>o.e(60677).then(o.bind(o,460677)),size:24}})},556148:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>a,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>m,Xw:()=>S,Yg:()=>g,yA:()=>u});o(898992),o(672577),o(581454);var n=()=>o(519839),r=()=>o(38337),i=()=>o(405417),l=()=>o(695625),s=()=>o(236030);let a=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,i().v2)(o[0],e)}function p(e,t){return(0,n().f5)({environment:t,collectionContextStore:e})?s().Fh:0}function m(e){let t=e;for(;null!==t&&!t.classList.contains(r().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function g(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},563615:(e,t,o)=>{o.d(t,{$b:()=>d,Nz:()=>a,Q1:()=>l,Vh:()=>u,ZO:()=>c,bl:()=>s,eN:()=>i,oQ:()=>r});var n=()=>o(645873);const r={WorkflowPageBlock:new(n().O2)("WorkflowPageBlock",(async()=>await o.e(87700).then(o.bind(o,885789)))),WorkflowEditorTopbar:new(n().O2)("WorkflowEditorTopbar",(async()=>await Promise.all([o.e(96346),o.e(55373),o.e(36192),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(92143)]).then(o.bind(o,484654)))),WorkflowInPlaceEditor:new(n().O2)("WorkflowInPlaceEditor",(async()=>await Promise.all([o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(55373),o.e(36192),o.e(44711),o.e(62475),o.e(3151),o.e(16471),o.e(53321),o.e(58550),o.e(98629),o.e(90825),o.e(37353),o.e(29151),o.e(31895),o.e(83647),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(4422),o.e(28721),o.e(28866),o.e(21194),o.e(6463),o.e(71993),o.e(1213),o.e(17989),o.e(90625),o.e(59794),o.e(78846),o.e(26483),o.e(43741),o.e(81768),o.e(94387),o.e(82850),o.e(52393),o.e(77692),o.e(75601),o.e(11341),o.e(7060),o.e(82136),o.e(12739),o.e(26090),o.e(73594),o.e(93282),o.e(12341),o.e(50984),o.e(66984),o.e(40828),o.e(26199),o.e(18057),o.e(90978),o.e(56264),o.e(5023),o.e(55927),o.e(61151),o.e(72226),o.e(48199),o.e(67780),o.e(96933),o.e(4253),o.e(9150),o.e(50437)]).then(o.bind(o,742628)))),ChatCollectionView:new(n().O2)("ChatCollectionView",(async()=>await Promise.all([o.e(96346),o.e(55373),o.e(85864),o.e(7114),o.e(45666)]).then(o.bind(o,227519)))),CustomCollectionView:new(n().O2)("CustomCollectionView",(async()=>await Promise.all([o.e(96346),o.e(55373),o.e(36192),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(64165)]).then(o.bind(o,120250)))),WorkflowEditorCollectionViewPage:new(n().O2)("WorkflowEditorCollectionViewPage",(async()=>await Promise.all([o.e(75134),o.e(43380),o.e(96346),o.e(55373),o.e(36192),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(1213),o.e(78846),o.e(43741),o.e(93282),o.e(67780),o.e(16697)]).then(o.bind(o,258651)))),WorkflowContainerEmptyState:new(n().O2)("WorkflowContainerEmptyState",(async()=>await o.e(97891).then(o.bind(o,50512)))),workflowActions:new(n().O2)("workflowActions",(async()=>await Promise.all([o.e(96346),o.e(55373),o.e(36192),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(11097)]).then(o.bind(o,847)))),workflowNavigationActions:new(n().O2)("workflowNavigationActions",(async()=>await o.e(93139).then(o.bind(o,691093)))),workflowNavigationHelpers:new(n().O2)("workflowNavigationHelpers",(async()=>await o.e(92821).then(o.bind(o,564037)))),workflowAdvanced:new(n().O2)("workflowAdvanced",(async()=>await Promise.all([o.e(75134),o.e(43380),o.e(9304),o.e(96346),o.e(55373),o.e(36192),o.e(44711),o.e(62475),o.e(3151),o.e(16471),o.e(53321),o.e(58550),o.e(98629),o.e(90825),o.e(37353),o.e(29151),o.e(31895),o.e(83647),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(48486),o.e(95794),o.e(85515),o.e(74562),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(42120),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(4422),o.e(28721),o.e(28866),o.e(21194),o.e(6463),o.e(71993),o.e(1213),o.e(17989),o.e(90625),o.e(59794),o.e(78846),o.e(26483),o.e(43741),o.e(81768),o.e(94387),o.e(82850),o.e(52393),o.e(77692),o.e(75601),o.e(11341),o.e(7060),o.e(82136),o.e(12739),o.e(26090),o.e(73594),o.e(93282),o.e(12341),o.e(50984),o.e(66984),o.e(40828),o.e(26199),o.e(18057),o.e(90978),o.e(56264),o.e(5023),o.e(55927),o.e(61151),o.e(72226),o.e(48199),o.e(67780),o.e(96933),o.e(4253),o.e(9150)]).then(o.bind(o,140659))))},i=(0,n()._h)(r.WorkflowPageBlock,(e=>e.default)),l=(0,n()._h)(r.ChatCollectionView,(e=>e.ChatCollectionView)),s=(0,n()._h)(r.CustomCollectionView,(e=>e.CustomCollectionView)),a=(0,n()._h)(r.WorkflowEditorTopbar,(e=>e.WorkflowEditorTopbar)),c=(0,n()._h)(r.WorkflowInPlaceEditor,(e=>e.WorkflowInPlaceEditor)),d=(0,n()._h)(r.WorkflowEditorCollectionViewPage,(e=>e.WorkflowEditorCollectionViewPage)),u=(0,n()._h)(r.WorkflowContainerEmptyState,(e=>e.WorkflowContainerEmptyState))},566910:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"m4.897 3.086-.122-.143a.625.625 0 0 0-.95.814l1.347 1.57c-1.762.91-3.195 2.304-4.083 3.997a1.47 1.47 0 0 0 0 1.362c1.61 3.07 5.011 5.155 8.911 5.155 1.282 0 2.51-.225 3.637-.637l1.588 1.853a.625.625 0 0 0 1.042-.67L4.989 3.229a.6.6 0 0 1-.093-.143M2.194 9.905c.807-1.538 2.15-2.807 3.816-3.599L7.4 7.928a3.326 3.326 0 0 0 4.252 4.961l1.107 1.292a9.4 9.4 0 0 1-2.76.41c-3.459 0-6.42-1.848-7.805-4.486a.22.22 0 0 1 0-.2m6.696.097q0-.151.039-.29l1.194 1.393q-.06.007-.124.007a1.11 1.11 0 0 1-1.109-1.11m7.012 4.038a9.4 9.4 0 0 0 3.01-3.354 1.47 1.47 0 0 0 0-1.362C17.302 6.254 13.9 4.169 10 4.169c-.805 0-1.588.089-2.339.257l.94 1.096a9.5 9.5 0 0 1 1.4-.103c3.458 0 6.42 1.848 7.804 4.486a.22.22 0 0 1 0 .2 8.14 8.14 0 0 1-2.722 2.98z"}),(0,n.jsx)("path",{d:"M13.205 10.893a3.33 3.33 0 0 0-3.596-4.194z"})]})},i=(0,o(340498).wt)("eyeSlash",r)},641514:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(484714),r=()=>o(377586),i=()=>o(676007),l=()=>o(897119),s=o(474848);function a(e){const{isMobile:t}=(0,n().Y0)();return t?(0,s.jsx)(l().Ay,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:r().n.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,s.jsx)(i().A,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},644187:(e,t,o)=>{o.d(t,{K:()=>r});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M5.612 4.08A1.895 1.895 0 0 0 3.971 5.81l-.005.092.001 9.439-.864.053h-.035a.883.883 0 0 1-.571-.245.921.921 0 0 1-.28-.646V4.137c0-.88.683-1.61 1.562-1.665l10.187-.651a.755.755 0 0 1 .786.551.826.826 0 0 1 .03.175v.943l-9.133.583-.037.007Zm12.172 12.67a.779.779 0 0 1-.617.747c-.006 0-.013.003-.02.003l-11.045.681h-.034a.883.883 0 0 1-.571-.245.921.921 0 0 1-.28-.647l-.001-.03V6.072l.001-.047a.777.777 0 0 1 .67-.709c.01 0 .018-.003.027-.003l11.052-.706a.755.755 0 0 1 .786.551.824.824 0 0 1 .03.175l.002 11.418Zm-1.248-8.726a.388.388 0 0 0-.418-.393l-9.213.563c-.23.012-.439.177-.439.436v7.533c-.01.484.31.61.673.583L16 16.221l.002-.001c.466-.018.534-.374.534-.65V8.024Zm-7.35 2.458c-.429.026-.574.353-.573.856v.089c-.051.012-.094.023-.146.026-.309.02-.531-.232-.532-.682 0-.689.616-1.336 1.79-1.41 1.045-.064 1.714.441 1.715 1.333 0 .67-.556 1.147-1.104 1.296 1.028.05 1.458.624 1.459 1.357.001 1.254-.915 1.964-2.329 2.052l-.034.002c-1.063.066-1.809-.338-1.81-1.035 0-.397.29-.733.728-.76.035-.003.068.004.103.002.087.71.567.97 1.046.941.463-.029.788-.34.788-.782v-.018c0-.688-.575-.723-1.44-.757l-.138-.822c.805-.147 1.207-.41 1.207-.887 0-.512-.284-.83-.73-.801Zm3.864-.339c-.857.248-1.045-.129-.952-.523.514-.12 1.85-.521 2.356-.703l.006 5.289.934.136c0 .344-.197.56-.548.581-.291.018-.968.043-1.294.063-.505.031-1.43.107-1.43.107a.572.572 0 0 1-.035-.201c0-.168.068-.34.29-.416l.677-.219-.004-4.114Z"})},r=(0,o(340498).wt)("calendarDate31",n)},645099:(e,t,o)=>{o.d(t,{LA:()=>C,jJ:()=>w});o(296540);var n=()=>o(484714),r=()=>o(847249),i=()=>o(401497),l=()=>o(584262),s=()=>o(403733),a=()=>o(340498),c=()=>o(959013),d=()=>o(124311),u=()=>o(114641),p=()=>o(857783),m=()=>o(778417),g=()=>o(186445),S=()=>o(325383),h=()=>o(753199),f=()=>o(704152),y=()=>o(331542),v=()=>o(316369),x=o(474848);const b=30,C=33;function w(e){const{style:t,iconStyle:o,store:C,format:w,collectionContextStore:k,groupsPointer:A,incrementLimitsInRelatedGroups:I,isFullScreen:j}=e,R=(0,n().v3)(),T=(0,r().K8)((()=>k.groupsStore.getGroupState(A)),[k,A]),M=(0,r().K8)((()=>(0,S().Kk)({collectionContextStore:k,groupsPointer:A})),[k,A]),_=(0,r().O$)(k.isInHomeWidgetStore),P=(0,i().IS)((e=>({homeContainer:{display:"flex",alignItems:"center",justifyContent:"center"},button:{display:"flex",alignItems:"center",justifyContent:"center",height:b,borderRadius:6,whiteSpace:"break-spaces",fontSize:14,..._?{textAlign:"center",width:"fit-content",marginLeft:12,marginBottom:0,padding:4}:{},...t},loadingContainer:{marginTop:1,marginLeft:8,marginRight:8},icon:{width:a().Ev.sm,height:a().Ev.sm,marginRight:6,fill:e.icon.tertiary,...o},text:{color:e.text.tertiary,width:"100%",fontSize:_?14:void 0},hoveredStyle:{...M?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}}})),[_,t,M,o]),B=(0,r().K8)((()=>C.canEdit()),[C]);return T?_?(0,x.jsx)("div",{style:P.homeContainer,children:(0,x.jsx)(f().A,{onClick:e=>function(e,t,o){const n=e.metaKey||e.ctrlKey?"tab":void 0,r=(0,g().sj)(o.id)?l().y8.PersonalHomeTileTasks:l().y8.PersonalHomeTileCustomDb;p().uK({environment:t,store:o,pageVisitSource:r,openInNew:n})}(e,R,C),onMouseDown:h().tr,style:P.button,children:(0,x.jsx)("div",{style:P.text,children:(0,x.jsx)(c().sA,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})})}):(0,x.jsxs)(f().A,{onClick:e=>function(e,t,o,n,r,i){const l=o.groupsStore.getGroupState(n);if(!l)return;const s=l.reducerResultStore.state;(0,h().kV)(e),m().IU({environment:t}),s&&(0,u().H)({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:i,currentResultCount:s.blockIds.length,groupsPointer:l.groupsPointer,incrementLimitsInRelatedGroups:r}});(0,d().K)(t)}(e,R,k,A,I,j),onMouseDown:h().tr,disabled:M,hoveredStyle:P.hoveredStyle,style:P.button,children:[(0,s().g)(P.icon),(0,x.jsx)("div",{style:P.text,children:(0,x.jsx)(c().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),M?(0,x.jsx)("div",{style:P.loadingContainer,children:(0,x.jsx)(y().A,{size:"sm"})}):B&&(0,x.jsx)(v().w,{collectionContextStore:k,format:w})]}):null}},653252:(e,t,o)=>{o.d(t,{O:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},662984:(e,t,o)=>{o.r(t),o.d(t,{arrowExpandDiagonalBottomLeftToTopRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",svg:(0,o(474848).jsx)("path",{d:"M8.912 2.463a.625.625 0 1 0 0 1.25h2.491L8.358 6.758a.625.625 0 1 0 .884.884l3.045-3.045v2.49a.625.625 0 1 0 1.25 0v-4a.625.625 0 0 0-.625-.624zM7.64 8.36a.625.625 0 0 0-.885 0l-3.042 3.043V8.912a.625.625 0 1 0-1.25 0v4c0 .345.28.625.625.625h4a.625.625 0 0 0 0-1.25H4.597l3.042-3.043a.625.625 0 0 0 0-.883"})},r=(0,o(340498).wt)("arrowExpandDiagonalBottomLeftToTopRightSmall",n)},697650:(e,t,o)=>{o.d(t,{Qo:()=>l,k9:()=>r,nE:()=>i});var n=()=>o(508496);const r=(0,o(959013).YK)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"},newTitlePlaceholder:{defaultMessage:"New database",id:"database.source.newTitlePlaceholder"},actionsButtonAriaLabel:{defaultMessage:"Collection actions",id:"database.source.actionsButtonAriaLabel"}});function i(e){let{intl:t}=e;const o=n().default.checkGate({gateName:"db_ux_chrome"});return t.formatMessage(o?r.newTitlePlaceholder:r.titlePlaceholder)}function l(e){let{collectionStore:t,intl:o}=e;return t.getName()??[[i({intl:o})]]}},698331:(e,t,o)=>{o.d(t,{$X:()=>i,H8:()=>l,x2:()=>r});var n=()=>o(534177);function r(e){return"event"===e||"recurrence"===e}function i(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function l(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},701751:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,n.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},i=(0,o(340498).wt)("lockOpen",r)},725649:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>r,K$:()=>n,j6:()=>i})},735790:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},i=(0,o(340498).wt)("sliders",r)},736767:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(296540),r=o(474848);function i(e,t){return(0,r.jsx)(o(678553).Ay,{...e,ref:t,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}const l=(0,n.forwardRef)(i)},748539:(e,t,o)=>{o.d(t,{f:()=>n});const n=new(o(645873).O2)("pageCovers",(async()=>{const{pageCovers:e}=await o.e(40198).then(o.bind(o,519737));return e}))},766558:(e,t,o)=>{o.d(t,{j:()=>r,y:()=>i});var n=()=>o(284371);function r(e){const{theme:t,isInHomeWidget:o,isFeedbackButton:r}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...r?{height:o?24:28,color:t.text.tertiary,fill:t.lightIconColor}:o?{height:24,width:24,color:t.text.tertiary,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}function i(e){const{theme:t}=e;return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:t.mediumIconColor,fontWeight:n().Wy.regular,lineHeight:1,borderRadius:6}}},773363:(e,t,o)=>{o.d(t,{k:()=>r});let n;class r{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;n||(n=document.createElement("div"),n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",n.style.opacity="0",document.body.appendChild(n)),o(496603).uk(this.style,((e,t)=>{n&&(n.style[t]=e)})),n.textContent=e;const r=n.getBoundingClientRect();return this.lastResult={text:e,rect:r},r}}},782473:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},812119:(e,t,o)=>{o.d(t,{J:()=>l});o(296540);var n=()=>o(401497),r=()=>o(710149),i=o(474848);function l(e){const{widthPercentage:t,isInHomeWidget:o}=e,l=(0,n().IS)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,i.jsx)("div",{style:l.rowContainer,children:(0,i.jsxs)("div",{style:l.column,children:[(0,i.jsx)(r().A,{style:l.circleShimmer}),(0,i.jsx)(r().A,{style:l.rowShimmer})]})})}},835755:(e,t,o)=>{o.d(t,{p:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionDescriptionSmall",{viewBox:"0 0 14 14",svg:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 4.667C6.69049 4.667 6.39366 4.54405 6.17481 4.32519C5.95595 4.10634 5.833 3.80951 5.833 3.5C5.833 3.19049 5.95595 2.89366 6.17481 2.67481C6.39366 2.45595 6.69049 2.333 7 2.333C7.30951 2.333 7.60634 2.45595 7.82519 2.67481C8.04405 2.89366 8.167 3.19049 8.167 3.5C8.167 3.80951 8.04405 4.10634 7.82519 4.32519C7.60634 4.54405 7.30951 4.667 7 4.667V4.667ZM8 11C8 11.2652 7.89464 11.5196 7.70711 11.7071C7.51957 11.8946 7.26522 12 7 12C6.73478 12 6.48043 11.8946 6.29289 11.7071C6.10536 11.5196 6 11.2652 6 11V7C6 6.73478 6.10536 6.48043 6.29289 6.29289C6.48043 6.10536 6.73478 6 7 6C7.26522 6 7.51957 6.10536 7.70711 6.29289C7.89464 6.48043 8 6.73478 8 7V11ZM7 0C5.14348 0 3.36301 0.737498 2.05025 2.05025C0.737498 3.36301 0 5.14348 0 7C0 8.85652 0.737498 10.637 2.05025 11.9497C3.36301 13.2625 5.14348 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0V0Z"})})},845094:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(645873);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,901175)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,191294))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},848565:(e,t,o)=>{o.d(t,{FB:()=>p,Ql:()=>m,SM:()=>g,Wv:()=>i,Yz:()=>s,ds:()=>r,e4:()=>n,eQ:()=>l,im:()=>c,jw:()=>a,k2:()=>u,uG:()=>d});const n=8,r=10,i=8,l=24,s=6,a=1.5,c=(l-a)/2,d=l+s,u=`calc(100% + ${i+(n-s)-d}px)`,p=l+8,m=-16;function g(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}},877051:(e,t,o)=>{o.d(t,{V:()=>l});var n=()=>o(847249),r=()=>o(351360),i=()=>o(963589);function l(){const e=(0,i().X)("lazier_dependencies"),t=(0,n().K8)((()=>r().default.state.renderPhase),[]);return e&&"rendered"!==t}},881915:(e,t,o)=>{o.d(t,{X:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},883138:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>Hf,CollectionViewBlockWithErrorBoundary:()=>Wf});var n=o(296540),r=(o(898992),o(581454),o(908872),o(737550),()=>o(244641)),i=()=>o(17022),l=()=>o(908006),s=()=>o(484714),a=()=>o(852507),c=()=>o(118884),d=()=>o(847249),u=()=>o(401497),p=()=>o(757695),m=()=>o(107041),g=()=>o(763884),S=()=>o(921997),h=()=>o(558842),f=()=>o(869558),y=()=>o(496603),v=()=>o(534177),x=()=>o(436696),b=()=>o(686526),C=()=>o(313209),w=()=>o(661920),k=()=>o(257615),A=()=>o(778417),I=()=>o(725614),j=()=>o(751156),R=()=>o(450510),T=()=>o(928530),M=(o(672577),()=>o(493260)),_=()=>o(519839),P=()=>o(760077);var B=()=>o(556048),V=()=>o(478726),F=()=>o(747100),L=()=>o(953418),E=()=>o(963589),O=()=>o(712505),D=o(474848);const z=n.memo((function(e){const{store:t,collectionContextStore:r,isFullScreen:i,canEdit:l,showHoverActionsStore:a,paddingLeft:c,addViewButton:p}=e,m=(0,E().X)("db_ux_chrome"),g=(0,s().v3)(),[S,h]=(0,n.useState)(!1),f=(0,d().K8)((()=>{const e=O().default.state;return(0,F().RX)(t)||!(0,F().cq)(t)&&e.open&&e.isClosing}),[t]),y=(0,d().K8)((()=>r.collectionStore()),[r]),v=(0,d().K8)((()=>r.collectionViewBlockStore()),[r]),x=(0,d().K8)((()=>Boolean(null==y?void 0:y.isSyncedCollection())),[y]),b=(0,d().K8)((()=>Math.min(V().x6,g.WindowSizeStore.state.width)),[g.WindowSizeStore]),C=(0,u().IS)((()=>{const e={display:"flex",alignItems:"center",justifyContent:"space-between",width:f?b:"100%",boxSizing:f?"content-box":void 0,...(i||f)&&(0,L().z4)(g)&&{position:"sticky",left:0}},t={flexGrow:m?1:void 0};return m?e.padding=`4px 0 4px ${i?c??0:0}px`:e.paddingTop=8,{containerHoverArea:t,container:e,flex:{display:"flex"},button:{margin:0},syncedContainer:{paddingLeft:4}}}),[g,i,f,m,b,c]),w=(0,n.useCallback)((()=>{h(!0)}),[]),k=(0,n.useCallback)((()=>{h(!1)}),[]);return y&&v?(0,D.jsxs)("div",{onMouseEnter:w,onMouseLeave:k,style:C.containerHoverArea,children:[(0,D.jsxs)("div",{style:C.container,children:[(0,D.jsx)(o(286367).D,{collectionContextStore:r,showHoverActionsStore:a,addViewButton:p,isHovered:S}),x&&(0,D.jsx)("div",{style:C.flex,children:(0,D.jsx)(o(66858).A,{canEdit:l,store:v,buttonStyle:C.button})})]}),(0,D.jsxs)("div",{style:C.syncedContainer,children:[(0,D.jsx)(o(948049).A,{collectionStore:y,collectionContextStore:r}),(0,D.jsx)(B().GL,{store:y})]})]}):null}));o(18107),o(967357),o(803949);var K=()=>o(179034),H=()=>o(741496),W=()=>o(388821),G=()=>o(951177);const N=new(o(178624).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function U(e,t){let{lastActionWasCut:o,valuePromise:n}=t;const r=(0,G().hB)(e);N.setState({eventId:r,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const i=await n;if(!i)return void N.setState({});const{recordMaps:l,...s}=i;N.setState({eventId:r,waitingForCopy:!1,lastActionWasCut:o,value:{...s,recordMapsJson:Y(l)}})}function $(e){const t=N.getState(),o=(0,G().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{N.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:s}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:s||!1,value:{...l,recordMaps:q(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:q(r.recordMapsJson)}}):Promise.resolve(void 0)}function q(e){return new Map(e.map((e=>{let[t,o]=e;return[t,W().RecordMap.create(o)]})))}function Y(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson()]}))}var X=()=>o(884107),Q=()=>o(60867),Z=()=>o(899453),J=()=>o(797265),ee=()=>o(545805),te=()=>o(175116),oe=()=>o(659602),ne=()=>o(335722),re=()=>o(855801),ie=()=>o(405417),le=()=>o(504836),se=()=>o(645873),ae=()=>o(630116),ce=()=>o(502438),de=()=>o(24157);const ue=n.memo((function(){const e=(0,s().v3)(),t=(0,te().ET)(),{value:r}=(0,se().fJ)(oe().g),{value:i}=(0,se().fJ)(ne().S),a=(0,d().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),c=(0,d().K8)((()=>{if(de().default.isEditingStore.state)return!1;const e=ce().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,ie().oC)(e))return!1;const n=(0,o(236162).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===a}),[a]),u=n.useCallback((async o=>{(await X().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=ce().default.state.stores;U(o,{lastActionWasCut:!1,valuePromise:pe(e).then((o=>{const{result:r,status:i}=o;if("failed"===i)return;for(const n of r){var l;(0,H().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const s=r.length>0;for(const c of n){var a;(0,H().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:s,collection_id:null===(a=t.collectionStore())||void 0===a?void 0:a.id})}return me({environment:e,subitems:r})}))})}),[t,e,r]),p=n.useCallback((async o=>{(await X().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:r});const n=t.collectionStore();if(null!=n&&n.isExternallyImportedAndSyncedCollection()&&(0,le().pB)())return;const i=ce().default.state.stores,l=pe(e),s=pe(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,H().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:a});const r=o.length>0;for(const l of i)(0,H().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:r,collection_id:a});return me({environment:e,subitems:o})}));await U(o,{lastActionWasCut:!0,valuePromise:s});const c=ce().default.getState().stores,d=(await l).result;await Q().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,a,e,r]),m=n.useCallback((async o=>{var n,s,c,d;const u=await X().R.clipboardActions.load(),p=await $(o),m=await re().VI.loadLocalSubtree.load(),g=await re().VI.duplicateActions.load();if(N.setState({...N.getState(),lastActionWasCut:!1}),!p){j().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:t,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i})}});const t=ce().default.state.stores[0];if(void 0===t)return;return void(0,H().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:!1,collection_id:a})}const S=t.collectionViewBlockStore();if(!S)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,le().pB)())return;const{recordMaps:f,subitemFormat:y,childRelationSchema:v,parentRelationSchema:x}=p.value;if(!(f&&y&&v&&x))return;const b=[...f.entries()].map((e=>{let[t]=e;return ae().Bv.createChildStore(h,{table:K().ev,id:t})}));await Promise.all(b.map((e=>e.load())));const C=ce().default.getState().stores,w=!(p.lastActionWasCut&&function(e,t){const o=t.map((t=>ae().Bv.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,b));let k=[],I=ie().n9(t),R=null===(n=I)||void 0===n?void 0:n.parentRelationProperty,T=null===(s=I)||void 0===s?void 0:s.childRelationSchema,M=null===(c=I)||void 0===c?void 0:c.parentRelationSchema,_=null===(d=I)||void 0===d?void 0:d.subitemFormat;const P=t.permissionScopesStore.state.canConfigureCollection;for(const t of b)(0,H().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:p.value.isBulk,collection_id:a});if(j().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:n=>{if(!_&&P){Q().VI({transaction:n,collectionContextStore:t,environment:e})&&(I=ie().n9(t),I&&(R=I.parentRelationProperty,T=I.childRelationSchema,M=I.parentRelationSchema,_=I.subitemFormat))}if(!(R&&T&&M&&_))return void u.paste({environment:e,event:o,disableEmbedMenu:!0,transaction:n,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:i});const l=w?Q().B2({blocks:b,environment:e,transaction:n,recordMaps:f,migrateSubitemFormat:{from:y,to:_},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:v,parentRelationSchema:x},analyticsFrom:p.lastActionWasCut?"cut":"copy",loadLocalSubtreeModule:m,duplicateActionsModule:g}):Q().fA({blocks:b,transaction:n,from:y,to:_,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,s=i.collectionStore();if(!s)return;const a=o.at(-1),c=ie().Px(n,r);if(0===c.length)return;if(a){const e=ie().W5(i,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ae().Bv&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{Q().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l}),o&&Z().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{Q().VT({environment:t,blockStore:e,collectionStore:s,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:C,blocksToInsert:l,subitemFormat:_,collectionContextStore:t,transaction:n}),J().LE({environment:e,blocksToInsert:l,target:C,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),k=l}}),!(R&&T&&M&&_))return;const B=ie().BK({blocks:k,parentRelationProperty:R,parentRelationSchema:M,collectionViewBlockStore:S});l().default.afterNextFlush((()=>{l().default.afterNextFlush((()=>{A().td({environment:e,stores:B})}))}))}),[t,a,e,r,i]);return(0,D.jsx)(ee().A,{debugName:`CollectionViewKeyboardArea-${a}`,capture:!0,priority:c?0:-1,onCopy:u,onCut:p,onPaste:m})}));function pe(e){const t=ce().default.getState().stores;return Q().zM({environment:e,blocks:t})}function me(e){let{subitems:t,environment:n}=e;const r=ce().default.getState().stores,i=r.at(0);if(!i)return;const l=(0,ie().oC)(i);if(!l)return;const s=[...r,...t],a=y().oE(s.map((e=>{const t=(0,o(59110).loadLocalSubtree)(n,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}).recordMap;return t&&[e.id,t]}))),c=new Map(a),{subitemFormat:d,childRelationSchema:u,parentRelationSchema:p}=l;return{recordMaps:c,subitemFormat:d,childRelationSchema:u,parentRelationSchema:p,isBulk:t.length>0}}const ge=new(se().O2)("lazyCreateHasSchemaChangedForQueryStore",(async()=>await o.e(42050).then(o.bind(o,366518))));function Se(e){const{collectionContextStore:t,previewContext:o,isPlaceholderExternalCollection:n}=e;return(0,d().K8)((()=>{var e,r,i;return Boolean(!n&&!(null!=o&&o.hideViewBlockSource)&&t.shouldShowSourceStore.state&&!t.isUnlistedViewStore.state&&(null===(e=t.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(r=t.collectionViewStore())||void 0===r?void 0:r.getType())&&"chat"!==(null===(i=t.collectionViewStore())||void 0===i?void 0:i.getType()))}),[t,o,n])}var he=()=>o(835066),fe=()=>o(106412),ye=()=>o(789550),ve=()=>o(862292),xe=()=>o(989423);async function be(e){const t=await ve().T.formulas.load();t.setFormulaParsingInstrumentation((()=>{class n extends t.FormulaParsingInstrumentation{constructor(){super(...arguments),this.pendingMetricsMap={},this.throttledFlushMetrics=y().nF((()=>{this.flushMetrics()}),15*o(615234).TD,{trailing:!0})}flushMetrics(){0!==Object.keys(this.pendingMetricsMap).length&&((0,xe().u4)({environment:e,event:{eventName:"collections_formula_parsing_cache_stats",eventProperties:(0,o(720665).MU)((0,v().WP)(this.pendingMetricsMap).map((e=>{let[t,o]=e;return[n.metricNameToEventProperty[t],o??0]})))}}),this.pendingMetricsMap={})}incrMetricImpl(e){this.pendingMetricsMap[e]=(this.pendingMetricsMap[e]??0)+1,this.throttledFlushMetrics()}}return n.metricNameToEventProperty={"formulas.parsing.weak_map_cache.hit":"weak_map_cache_hit","formulas.parsing.weak_map_cache.miss":"weak_map_cache_miss"},new n}))}var Ce=()=>o(186445),we=()=>o(38337),ke=()=>o(476492),Ae=()=>o(525432),Ie=()=>o(69447),je=()=>o(638146),Re=()=>o(728611),Te=()=>o(753199),Me=()=>o(571963),_e=()=>o(592678),Pe=()=>o(347320),Be=()=>o(891078),Ve=()=>o(406792),Fe=()=>o(117296),Le=()=>o(696746),Ee=()=>o(665579),Oe=()=>o(644914),De=()=>o(962730),ze=()=>o(463830),Ke=()=>o(889097),He=()=>o(227440),We=()=>o(230062),Ge=()=>o(961581),Ne=()=>o(666803),Ue=()=>o(977390),$e=()=>o(606932),qe=()=>o(865241),Ye=()=>o(472090),Xe=()=>o(611371),Qe=()=>o(563615),Ze=()=>o(845094),Je=()=>o(632905),et=()=>o(671593),tt=()=>o(666144);async function ot(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,v().WP)(t).map((async t=>{let[o,n]=t;return tt().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:K().ev,id:o},userId:e.currentUser.id,minimumVersion:n})})))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}class nt{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.handleCollectionSchemaChange=e=>{if(!this.collectionContextStore.isClientModeEnabledStore.state&&e.state){var t,o;const e=`${null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.id}:${null===(o=this.collectionContextStore.collectionStore())||void 0===o||null===(o=o.getModel())||void 0===o?void 0:o.getVersion()}`;this.throttledRefetch({src:"change_schema",trigger:e})}},this.isServerQueryCollectionRequiredForCollectionEmit=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const n=Boolean(e&&(0,et().Xj)(Je().yx,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,v().WP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,et().Xj)(Je().yx,e)&&!e.hasMore)},this.throttledRefetch=(0,o(279900).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,v().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await ot({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,T().M)(this.environment,this.collectionContextStore,e),(0,o(763824).wR)(t)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,et().Xj)(Je().yx,o)&&null!=o&&o.blockIdToVersion&&(0,v().WP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequiredForCollectionEmit(o,r),!n)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}subscribeToSchemaChanges(e){e.addListener(this.handleCollectionSchemaChange)}unsubscribeFromSchemaChanges(){var e;null===(e=this.collectionContextStore.hasSchemaChangedForQueryStore)||void 0===e||e.removeListener(this.handleCollectionSchemaChange)}}var rt=()=>o(155004),it=()=>o(297872),lt=()=>o(199896),st=()=>o(425981),at=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(354520),()=>o(66689)),ct=()=>o(59674),dt=()=>o(713998),ut=()=>o(735384),pt=()=>o(959013),mt=()=>o(548218),gt=()=>o(44729),St=()=>o(109488),ht=()=>o(454305),ft=()=>o(682146);o(944114);function yt(e){let{collectionContextStore:t,property:o,blockStores:n}=e;const r=t.normalizedFormatStore.state.collection_group_by;if((null==r?void 0:r.property)!==o)return;const i=function(e,t){const o=new Map,n=t.groupsStore.getAllGroupStates(),r=(0,y().E$)(e,ce().default.state.stores);if(!r.length)return o;for(const i of r){const e=n.find((e=>e.groupUiParentStore===i.getRecordStoreUIParent()));e&&o.set(i,e.resultsStore)}return o}(n,t),l=[];for(const[s,a]of i.entries())a.state.includes(s)||l.push(s);l.length&&A().DN({stores:(0,y().R9)(ce().default.state.stores,l)})}var vt=()=>o(972435),xt=()=>o(351360),bt=()=>o(919709);class Ct extends p().default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===bt().q4_(o)}))}}var wt=()=>o(41459),kt=()=>o(145214),At=()=>o(704152),It=()=>o(285790),jt=()=>o(859428),Rt=()=>o(398842);const Tt=32;function Mt(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const _t=(0,pt().YK)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Pt(e){const{marginLeft:t}=e,r=(0,s().v3)(),i=(0,n.useRef)(null),l=(0,n.useRef)(void 0),a=(0,te().ET)(),c=(0,d().K8)((()=>a.collectionViewBlockStore()),[a]),p=(0,d().uB)(void 0,Ct),[m,g]=(0,n.useState)(!1),{selectedItems:S,selectedItemCount:h}=(0,d().K8)((()=>{const e=ce().default.state.stores;return{selectedItems:e,selectedItemCount:e.length}}),[]),f=(0,d().K8)((()=>p.getNumberOfTextStoresBeingEdited()),[p]),y=(0,d().K8)((()=>{var e;return!!(0,_().f5)({environment:r,collectionContextStore:a})&&(!S.some((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))&&(f>0||S.length>=1&&(0,_().Rd)(S,null===(e=a.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[a,r,f,S]);(0,d().K8)((()=>{const e=Ce().jQ().state;e.isOpen?l.current=e.property:l.current&&yt({collectionContextStore:a,property:l.current,blockStores:S})}),[a,S],{debugName:"cleanUpSelection"});const v=(0,d().K8)((()=>c&&"suggest"!==o(77246).Uv.getMode(c)),[c]),x=(0,n.useCallback)((e=>{e||g(!1)}),[]),b=(0,u().IS)((e=>({inner:{display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.shadowSM,height:Tt},outer:{position:"sticky",top:1,left:t??0,zIndex:999,visibility:m?"visible":"hidden"},outerLayoutAdjust:{marginBottom:-Tt},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.text.primary},trashButton:{borderRadius:0,height:"100%",border:0,...Mt(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[m,t]);return(0,D.jsx)(St().A,{capture:y,render:e=>(0,D.jsxs)(kt().A,{visible:y,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onAnimationEnd:x,ref:i,...e,style:b.outer,children:[(0,D.jsx)(rt().s,{allowSelectionWithin:!1,children:(0,D.jsxs)("div",{style:b.inner,children:[(0,D.jsx)(Bt,{selectedItemCount:h,numTextStoresBeingEdited:f}),(0,D.jsx)(zt,{collectionsBulkActionsToolbarStore:p,selectedItems:S,marginLeft:t,setIsReadyToRender:g,outerContainerRef:i}),v&&(0,D.jsx)(jt().A,{renderTooltip:()=>(0,D.jsx)("div",{children:vt().A.formatMessage(_t.delete)}),render:e=>(0,D.jsx)(It().A,{...e,ariaLabel:vt().A.formatMessage(_t.delete),icon:()=>(0,ut().I)(b.trashButtonIcon),style:b.trashButton,hoveredStyle:b.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;(0,H().N)(r,{analyticsName:o(416726).AY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=a.collectionStore())||void 0===e?void 0:e.id}),await J().Af({environment:r,blocks:S,shouldCheckSuggestEdit:!0,overrideRemoveBlockFunc:(e,t)=>{var o,n;(null===(o=e.getAssociatedCollectionStore())||void 0===o?void 0:o.id)===(null===(n=a.collectionStore())||void 0===n?void 0:n.id)&&gt().by({childStore:e,transaction:t})}})}}),placement:De().W.Top}),(0,D.jsx)(o(496889).A,{store:S[0],fadeIn:!1,style:b.blockActionMenuButton,hoveredStyle:b.blockActionMenuButton,iconStyle:b.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})}),(0,D.jsx)("div",{style:b.outerLayoutAdjust})]})})}function Bt(e){const{selectedItemCount:t,numTextStoresBeingEdited:o}=e,r=(0,s().v3)(),i=(0,n.useMemo)((()=>o>0?o:Math.max(1,t)),[o,t]),l=(0,n.useCallback)((()=>A().IU({environment:r})),[r]),a=(0,u().IS)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Mt(e)}})),[]);return(0,D.jsx)(At().A,{style:a.button,onClick:l,children:(0,D.jsx)(pt().sA,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:i}})})}const Vt=6,Ft=450,Lt=2,Et=32,Ot=150,Dt=new Set(["title","rollup","formula","button"]);function zt(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:l}=e,s=(0,te().ET)(),a=(0,n.useRef)(null),c=(0,n.useRef)([]),p=(0,d().O$)(s.normalizedSchemaStore),m=(0,d().K8)((()=>s.databaseType===at().TC&&r.some((e=>e.getPropertyValue(ct().y.MeetingNoteToCalendarEventRelation)))),[s,r]),g=(0,d().K8)((()=>{var e;const t=s.normalizedFormatStore.state;return((null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=s.collectionStore(),{property:o,visible:n}=e;if((0,dt()._f)(null==t?void 0:t.getModel(),o))return!m;const i=p[o];return n&&i&&!Dt.has(i.type)&&(0,ft().g2)({propertySchema:i,property:o,blockStores:r,collectionSchema:p,collectionStore:t,spaceStore:xt().default.state.currentSpaceStore})})))??[]).slice(0,Vt)}),[s,p,r,m]),[S,h]=(0,n.useState)(Vt),[f,v]=(0,n.useState)(!1);(0,n.useEffect)((()=>{c.current.length>0&&c.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[c]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:l,setShowIconsOnly:s,setHiddenButtonsIndex:a}=e;(0,n.useEffect)((()=>{const e=y().sg((()=>{var e,n,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,m=d-Ot;let g=r.current.findIndex((e=>e.rightEdge>m));g=-1!==g?g:Vt;let S=r.current.findIndex(((e,t)=>p+t*Et>m));S=-1!==S?S:Vt;const h=g<Lt||u<=Ft;s(h),a(h?S:g),l(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,a,l,s])}({propertyButtonsContainerRef:a,propertyButtonRefs:c,outerContainerRef:t,marginLeft:i,setIsReadyToRender:l,setHiddenButtonsIndex:h,setShowIconsOnly:v});const x=(0,u().IS)((()=>({container:{display:"flex"}})),[]);return(0,D.jsx)("div",{ref:a,style:x.container,children:g.map(((e,t)=>{var r;let i=null===(r=c.current[t])||void 0===r?void 0:r.element;if(!i){const e=n.createRef();c.current[t]={element:e,rightEdge:0},i=e}const l=t>=S;return(0,D.jsx)("div",{ref:i,children:(0,D.jsx)(Kt,{collectionsBulkActionsToolbarStore:o,schema:p,property:e.property,isHidden:l,showIconsOnly:f},e.property)},e.property)}))})}function Kt(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:i,showIconsOnly:l}=e,a=(0,E().X)("db_ux_mobile"),c=(0,s().v3)(),p=(0,te().ET)(),m=(0,n.useRef)(null),g=(0,d().uB)(void 0,ht().A),S=o[t],h=(0,d().K8)((()=>!(p.permissionScopesStore.state.canEditContent||"collectionTypedView"===p.contextType)),[p]),f=(0,u().IS)((e=>({button:{display:i?"none":"flex",paddingLeft:8,paddingRight:8,height:Tt,alignItems:"center",...Mt(e)},property:{maxWidth:"250px",textOverflow:"ellipsis"},icon:{fill:e.text.primary}})),[i]),y=(0,n.useCallback)((async e=>{var o,n;if(!m.current)return;const i=ce().default.state.stores;e.stopPropagation(),e.preventDefault();const l=null===(o=m.current)||void 0===o?void 0:o.getBoundingClientRect();if(i.length<1)return;const s=i[0].getAssociatedCollectionStore();p&&l&&s&&await mt().V({environment:c,store:i[0],additionalStores:i.slice(1),property:t,rect:l,format:wt().j.Table,collectionStore:s,blockPropertyValueOverlayStore:Ce().jQ(),collectionContextStore:p,statusSetCheckbox:"checkbox"===(null===(n=p.getPropertyFormat(t))||void 0===n?void 0:n.statusShowAs),mouseStore:g,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r,isDBUXMobileEnabled:a})}),[m,p,c,t,g,r,a]),v=(0,n.useCallback)((()=>null==S?void 0:S.name),[S]),x=(0,n.useCallback)((e=>S?(0,D.jsx)(At().A,{...e,ariaLabel:S.name,ref:m,style:f.button,disabled:h,onClick:y,children:(0,D.jsx)(Rt().mA,{style:f.property,propertySchema:S,hideName:l,showIcon:!0,property:t,iconStyle:f.icon})}):null),[y,h,t,S,l,f.button,f.icon,f.property]);return S?(0,D.jsx)(jt().A,{renderTooltip:v,render:x,disableTooltip:!l,placement:De().W.Top}):null}const Ht=n.memo((function(e){const{isFullScreen:t,leftRightPaddingStore:o,leftRightMarginStore:n,overrideViewType:r}=e,i=(0,s().v3)(),l=(0,te().ET)(),a=(0,d().K8)((()=>(0,_().f5)({environment:i,collectionContextStore:l,overrideViewType:r})),[i,l,r]),c=(0,d().K8)((()=>{var e;if(!a)return 0;return(t?(null===(e=o.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(n.state.marginLeft??0)-2}),[a,n,o,t]);return a?(0,D.jsx)(Pt,{marginLeft:c}):null}));var Wt=()=>o(661179),Gt=()=>o(689094);const Nt=new(se().O2)("CollectionTasksEmptyStateModal",(async()=>await Promise.all([o.e(1440),o.e(47536)]).then(o.bind(o,201440)))),Ut=(0,se()._h)(Nt,(e=>e.CollectionTasksEmptyStateModal));var $t=()=>o(162674),qt=()=>o(610101),Yt=()=>o(920773),Xt=()=>o(132389);const Qt="noWritableDbs";function Zt(e){const{collectionContextStore:t,onAddTaskClick:r,from:i}=e,l=(0,s().v3)(),a=(0,n.useRef)(null),c=(0,d().O$)(t.isInHomeWidgetStore),p=(0,d().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),m=(0,d().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),g=(0,d().K8)((()=>(0,_().h6)(t)),[t]),S=(0,d().K8)((()=>!t.isFullScreenStore.state),[t]),h=(0,n.useCallback)((e=>{b().Ub({environment:l,handleAddItemClick:r,buttonRef:a,event:e})}),[l,r,a]),f=(0,u().IS)((e=>({container:{width:"100%",height:S?"calc(100% - 4px)":void 0,paddingTop:S?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.text.tertiary},icon:(0,Ee().Xx)(e)})),[S]),y=(0,n.useMemo)((()=>p?(0,D.jsx)(jt().A,{disableTooltip:m,placement:De().W.Bottom,renderTooltip:()=>(0,D.jsx)(pt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,D.jsx)("br",{})}}),render:e=>(0,D.jsx)(Yt().p,{...e,isBlue:!0,ref:a,disabled:!m,disabledFeedback:!m,onClick:e=>{(0,$t().bS)({environment:l,from:i}),h(e)},icon:e=>(0,Gt().W)(e),children:g})}):(0,D.jsx)(Yt().p,{isBlue:!0,onClick:()=>{(0,$t().bS)({environment:l,from:i}),qt().A.setState(!0)},children:(0,D.jsx)(pt().sA,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[p,m,g,l,i,h]);return c&&!p?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Ut,{from:i}),(0,D.jsx)(Fe().Ww,{feature:"tasks",onSetup:()=>{(0,$t().bS)({environment:l,from:i}),qt().A.setState(!0)}})]}):(0,D.jsxs)("div",{style:f.container,children:[(0,D.jsx)(Ut,{from:i}),(0,o(370873).p)(f.icon),(0,D.jsx)(Xt().A,{size:16}),m?(0,D.jsx)(pt().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,D.jsx)(pt().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,D.jsx)(Xt().A,{size:16}),y]})}var Jt=()=>o(261237),eo=()=>o(710149);function to(e){let t,{store:o,collectionViewStore:n,collectionContextStore:r}=e,i=n.getFormat().page_pointer;const l=r.viewsModuleContextStore;if(!i&&"viewsMain"===(null==l?void 0:l.getViewModuleType())){const e=l.currentPageStore();e&&(i=e.pointer,t=e)}if(i)return t??=o.id===i.id?o:ae().Bv.createChildStore(o,{table:i.table,id:i.id,spaceId:i.spaceId}),t.isPageBlock()||t.isCollectionView()?t:void 0}var oo=()=>o(11048),no=()=>o(222299),ro=()=>o(551619);const io=new(se().O2)("views-main-builder-modules",(()=>Promise.all([o.e(44711),o.e(53321),o.e(85864),o.e(92845),o.e(71718),o.e(95794),o.e(63077),o.e(28271),o.e(17254),o.e(90966),o.e(80896),o.e(40186),o.e(61660),o.e(70605)]).then(o.bind(o,984318)))),lo=(0,se()._h)(io,(e=>e.ViewsMainBuilderModules));var so=()=>o(778781),ao=()=>o(548821),co=()=>o(729923),uo=()=>o(9768);const po=n.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:a,pageLayoutRef:c,collectionContextStore:u,editorContentContainerRef:p}=e,m=(0,s().v3)(),g=(0,d().K8)((()=>r.getSchema()),[r]),S=(0,d().K8)((()=>(0,o(577814).A)({environment:m,store:n,pageViewBlockStore:void 0})),[m,n]),h=(0,D.jsx)(D.Fragment,{children:t.map((e=>(0,D.jsx)(mo,{module:e,store:n,context:i,disabled:l,collectionSchema:g,collectionStore:r,modules:t,templatePickerMenuListStore:a,pageLayoutRef:c,pageDiscussionsRenderState:S,editorContentContainerRef:p},e.id)))});return u?(0,D.jsx)(te().RI,{value:u,children:h}):h}));function mo(e){let{module:t,store:r,context:i,disabled:l,collectionSchema:a,collectionStore:c,modules:u,templatePickerMenuListStore:p,pageLayoutRef:m,pageDiscussionsRenderState:g,editorContentContainerRef:S}=e;const h=(0,s().v3)(),f=(0,uo().Br)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:a,collectionStore:c,pageMainModules:u,showDetailsPanelToggleButtonBelowTitle:!1}),y=(0,uo().Jh)({layoutModule:t,area:"views_main_tab_modules",collectionSchema:a,collectionStore:c,showDetailsPanelToggleButtonBelowTitle:!1,modules:u}),x=(0,d().K8)((()=>!(0,o(864994).g)({environment:h,layoutArea:"views_main_tab_modules",moduleType:t.type,pageViewBlockContext:i})),[h,t.type,i]);return(0,o(120997).p)(t,"views_main_tab_modules")?(0,so().gx)(t)?(0,D.jsx)(o(483832).v,{context:i,disabled:l,propertyId:t.propertyId,store:r,pageModule:t,wrapper:y,stackPropertyLabelAndValue:x},`${t.id}-${r.id}`):(0,so().i_)(t)?(0,D.jsx)(n.Fragment,{children:(0,D.jsx)(o(793282).h,{context:i,disabled:l,store:r,wrapper:y,layoutModule:t,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:x,disableContainerPadding:!0,disableLastRowBottomPadding:x},showDefaultTitle:!0})},`${t.id}-${r.id}`):"editor"===t.type?(0,D.jsx)(co().p,{context:i,disabled:l,handlePlaceholderWrapClick:e=>no().YB(e,r,h),pageBlockStore:r,pathToBlockId:t.pathToBlockId,templatePickerMenuListStore:p,pageViewBlockAccessor:()=>(null==m?void 0:m.current)??null,editorWrapper:i===ao().Rr.DraftPostInInlineComposer?void 0:y,ref:S}):"relationsGroup"===t.type?(0,D.jsx)(o(996262).z,{pageStore:r,wrapper:y,disabled:l,context:i,showDefaultTitle:f}):"deleted_property"===t.type?null:"discussions"===t.type?(0,D.jsx)(o(257502).d,{store:r,wrapper:y,showDefaultTitle:f,discussionLocation:"page_discussion",pageDiscussionsRenderState:g}):void(0,v().HB)(t):null}var go=()=>o(817942),So=()=>o(255824);const ho=n.memo((function(e){const{store:t,canEdit:r,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:a,isFullScreen:c,editorContentContainerRef:u}=e,p=(0,s().v3)(),m=(0,n.useRef)(null),g=(0,d().K8)((()=>t.isNonEditableState()),[t]),S=(0,So().a)(),h=(0,te().ET)(),f=(0,o(933951).sS)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:y,viewsMainTabId:v}=(0,d().K8)((()=>{const e=null==f?void 0:f.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==a?void 0:a.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[a,f]),x=(0,ro().n$)(),b=(0,d().K8)((()=>(0,F().cq)(t)?ao().Rr.PeekView:h.isFullScreenStore.state?ao().Rr.CollectionPageViewFullScreen:ao().Rr.CollectionPageView),[h,t]),C=(0,Be().VE)(t),w=(0,d().K8)((()=>{const e=o(129522).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),k=(0,d().K8)((()=>(0,o(299772).NS)(C,t,b,p)),[C,t,b,p]),A=!r||g||S,I=S&&v?(0,D.jsx)("div",{style:{paddingTop:24,paddingRight:4},children:(0,D.jsx)(lo,{viewsMainTabId:v,pageLayoutType:k})}):y&&l?(0,D.jsx)(go().Mx,{ref:m,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?x:void 0},children:(0,D.jsx)(po,{context:b,modules:y,store:t,disabled:A,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:m,collectionContextStore:w,editorContentContainerRef:u})}):(0,D.jsx)(go().Mx,{ref:m,type:k,style:{justifyContent:"center",paddingTop:24,paddingBottom:c?x:void 0},children:(0,D.jsx)(co().p,{context:b,disabled:A,handlePlaceholderWrapClick:e=>no().YB(e,t,p),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>m.current,ref:u})});return(0,D.jsx)(oo().A,{name:"PageView",children:I})})),fo=n.memo(n.forwardRef((function(e,t){let{store:o,collectionViewStore:n,style:r,isFullScreen:i,editorContentContainerRef:l,templatePickerMenuListStore:s,isViewsModule:a}=e;const c=(0,te().ET)(),u=(0,d().K8)((()=>c.collectionStore()),[c]),p=(0,d().K8)((()=>"collectionSystemView"===c.contextType),[c]),m=(0,d().K8)((()=>to({store:o,collectionViewStore:n,collectionContextStore:c})),[o,n,c]),g=!(0,Be().bx)(m,p);return a?m?(0,D.jsx)("div",{style:r,children:(0,D.jsx)(ho,{canEdit:!g,disabled:g,store:m,collectionViewStore:n,templatePickerMenuListStore:s,collectionStore:u,isFullScreen:i,editorContentContainerRef:l})}):null:(0,D.jsx)(Jt().c,{disabled:!1,displayName:"CollectionPagePageContent",ref:t,style:r,children:(0,D.jsx)(oo().A,{name:"CollectionPageView",children:m?(0,D.jsx)(ho,{canEdit:!g,disabled:g,store:m,collectionViewStore:n,templatePickerMenuListStore:s,collectionStore:u,isFullScreen:i,editorContentContainerRef:l}):null})})})));var yo=()=>o(735695),vo=()=>o(236030),xo=()=>o(690471),bo=()=>o(836251),Co=()=>o(756279),wo=()=>o(2143);function ko(e){const{style:t,children:o}=e,n=(0,u().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,D.jsx)(wo().H,{type:Co().A.Y,style:n.scroller,children:o})}function Ao(e){let{store:t,children:r,isFullScreen:i,currentViewType:l,isInPeek:a,isInHomeWidget:c,handleEditorClick:u,isRootOrDirectChild:p,leftRightPaddingStore:m,paddingBottom:g,viewSettingsPlacementStore:S,paddingLeft:h,format:f,isMyTasksEmpty:y,isHomeCustomDbEmpty:x,isInFrameWhenSidePeekOpen:b,handleHorizontalScrollerMount:C,handleEditorMouseDown:w,isUnlistedView:k,isPreviewing:A}=e;const I=(0,te().ET)(),j=(0,s().v3)(),{isPhone:T}=(0,s().Y0)(),M=(0,E().X)("disable_rectangular_selection_for_database_horizontal_scroll"),_=(0,d().K8)((()=>(0,bo().w6)(j)),[j]),P=(0,d().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:s}=e;if(r)return Co().A.None;if("page"===s||"feed"===s)return Co().A.None;if(i)return Co().A.All;if(n)return Co().A.X;if(l)return Co().A.X;if(!o||!(0,L().z4)(t))return Co().A.X;return Co().A.None}({environment:j,isFullScreen:i,isPreviewing:A,isInPeek:a,isUnlistedView:Boolean(k),isSettingsView:"collectionSettings"===I.contextType,collectionViewType:l})),[k,j,i,A,a,I,l]),B=(0,d().K8)((()=>!("collectionSystemView"===I.contextType)&&c&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"chat":return!0;case"calendar":case"map":case"feed":case"custom":return!1;default:return(0,v().HB)(e)}}(l)),[I,c,l]),V=(0,d().K8)((()=>R().B2({blockStore:t,isFullScreen:i,environment:j,collectionContextStore:I})),[t,i,j,I]),F=(0,d().K8)((()=>{const e=m.state,o=I.settingsStore.state.open,n=I.isInHomeWidgetStore.state&&I.isEditableHomeCollectionStore.state;let r={};return k&&(r=T?{height:_?vo().gK:vo().NH,width:void 0}:{height:vo().PN,width:void 0}),{flexGrow:1,flexShrink:0,...t.isNonEditableState()&&{cursor:"default"},..."timeline"===l&&I.collectionStore()&&!i&&!(0,xo().Od)({environment:j,format:f,isFullScreen:i,isRootChild:p})&&e&&{marginLeft:e.paddingLeft,marginRight:e.paddingRight,marginBottom:g},...o&&!i&&"sidebar"===S.state&&{minHeight:yo().iZ},...n?{paddingRight:8,paddingLeft:"list"===l?8:16}:{},...c&&!B?{maxHeight:"inherit"}:{},...y||x||!B?{height:"100%"}:{},...!b||"timeline"===l||c||k?{}:{position:"sticky",left:0,paddingLeft:h,width:(0,Oe().Uh)(j)},..."chart"===l&&b&&!c?{paddingLeft:h}:{},..."page"===l?{zIndex:86}:{},...V&&{marginLeft:-vo().Fh},...r,..."custom"===l&&{height:"100%"}}}),[m,I,p,t,l,i,j,f,g,S,c,B,y,x,b,h,V,k,T,_]),O=(0,So().a)(),z=(0,d().K8)((()=>O&&"page"===l?Co().A.All:a||c?Co().A.None:o(620689).u5(j)),[j,a,c,O,l]),K=(0,n.useCallback)((e=>{u(e,l)}),[u,l]),H=(0,D.jsx)(wo().H,{type:P,className:we().ohG,onMouseDown:M?void 0:w,preventType:z,onClick:K,style:F,ref:C,children:r});return B?(0,D.jsx)(ko,{style:{..."list"===l?{paddingBottom:8}:"timeline"===l?{paddingBottom:0}:{paddingBottom:16},...c&&"feed"!==l?{paddingTop:12}:{}},children:H}):H}var Io=()=>o(340498);const jo=(0,Io().wt)("formBuilderDisabled",{viewBox:"0 0 72 72",svg:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.77344 41.6953V17.2031H53.4922V22.6875H57.2656V13.2656C57.2656 10.8594 56.6562 9.04688 55.4375 7.82812C54.2188 6.60938 52.375 6 49.9062 6H9.35938C6.90625 6 5.0625 6.60938 3.82812 7.82812C2.60938 9.03125 2 10.8438 2 13.2656V41.9062C2 44.3125 2.60938 46.1172 3.82812 47.3203C5.0625 48.5391 6.90625 49.1484 9.35938 49.1484H40.4062V45.375H9.40625C8.23438 45.375 7.33594 45.0703 6.71094 44.4609C6.08594 43.8359 5.77344 42.9141 5.77344 41.6953ZM53.4922 13.4766V13.8984H5.77344V13.4766C5.77344 12.2578 6.08594 11.3359 6.71094 10.7109C7.33594 10.0859 8.23438 9.77344 9.40625 9.77344H49.8594C51.0156 9.77344 51.9062 10.0859 52.5312 10.7109C53.1719 11.3359 53.4922 12.2578 53.4922 13.4766Z"}),(0,D.jsx)("path",{d:"M14.1641 34.0781H40.4062V41.6719H14.1641C13.5391 41.6719 13.0312 41.4844 12.6406 41.1094C12.2656 40.7344 12.0781 40.2422 12.0781 39.6328V36.1172C12.0781 35.5078 12.2656 35.0156 12.6406 34.6406C13.0312 34.2656 13.5391 34.0781 14.1641 34.0781Z"}),(0,D.jsx)("path",{d:"M63.5781 34.5C63.8594 34.5 64.0938 34.5938 64.2812 34.7812C64.4792 34.9688 64.5781 35.2031 64.5781 35.4844C64.5781 35.776 64.4792 36.0208 64.2812 36.2188C64.0938 36.4167 63.8594 36.5156 63.5781 36.5156H52.4375C52.1458 36.5156 51.901 36.4167 51.7031 36.2188C51.5156 36.0208 51.4219 35.776 51.4219 35.4844C51.4219 35.2031 51.5156 34.9688 51.7031 34.7812C51.901 34.5938 52.1458 34.5 52.4375 34.5H63.5781Z"}),(0,D.jsx)("path",{d:"M63.5781 39.75C63.8594 39.75 64.0938 39.849 64.2812 40.0469C64.4792 40.2344 64.5781 40.4688 64.5781 40.75C64.5781 41.0417 64.4792 41.2865 64.2812 41.4844C64.0938 41.6823 63.8594 41.7812 63.5781 41.7812H52.4375C52.1458 41.7812 51.901 41.6823 51.7031 41.4844C51.5156 41.2865 51.4219 41.0417 51.4219 40.75C51.4219 40.4688 51.5156 40.2344 51.7031 40.0469C51.901 39.849 52.1458 39.75 52.4375 39.75H63.5781Z"}),(0,D.jsx)("path",{d:"M51.875 45.173C52.0377 45.0681 52.2252 45.0156 52.4375 45.0156H57.9062C58.1979 45.0156 58.4375 45.1146 58.625 45.3125C58.8229 45.5104 58.9219 45.7552 58.9219 46.0469C58.9219 46.3177 58.8229 46.5521 58.625 46.75C58.4375 46.9375 58.1979 47.0312 57.9062 47.0312H55.244C55.2387 47.0458 55.2332 47.0605 55.2276 47.0751C55.2093 47.1229 55.1899 47.1699 55.1695 47.216C55.1592 47.1922 55.1491 47.168 55.1392 47.1437C55.124 47.106 55.1097 47.0685 55.0963 47.0312H52.4375C52.2252 47.0312 52.0377 46.9816 51.875 46.8822C51.8142 46.845 51.757 46.801 51.7031 46.75C51.5156 46.5521 51.4219 46.3177 51.4219 46.0469C51.4219 45.9193 51.4398 45.8008 51.4756 45.6912C51.5218 45.5501 51.5976 45.4239 51.7031 45.3125C51.757 45.2587 51.8142 45.2122 51.875 45.173Z"}),(0,D.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.4062 31.9844C44.4062 30.2656 44.849 28.9531 45.7344 28.0469C46.6302 27.1406 47.9375 26.6875 49.6562 26.6875H66.3438C68.0521 26.6875 69.3542 27.1406 70.25 28.0469C71.1458 28.9531 71.5938 30.2656 71.5938 31.9844V55.4688C71.5938 57.1979 71.1458 58.5104 70.25 59.4062C69.3542 60.3021 68.0521 60.75 66.3438 60.75H49.6562C47.9375 60.75 46.6302 60.3021 45.7344 59.4062C44.849 58.5104 44.4062 57.1979 44.4062 55.4688V31.9844ZM47.875 55.1719C47.875 55.8594 48.0521 56.3802 48.4062 56.7344C48.7604 57.099 49.2969 57.2812 50.0156 57.2812H65.9844C66.7031 57.2812 67.2344 57.099 67.5781 56.7344C67.9323 56.3802 68.1094 55.8594 68.1094 55.1719V32.2812C68.1094 31.6042 67.9323 31.0833 67.5781 30.7188C67.2344 30.3542 66.7031 30.1719 65.9844 30.1719H50.0156C49.2969 30.1719 48.7604 30.3542 48.4062 30.7188C48.0521 31.0833 47.875 31.6042 47.875 32.2812V55.1719Z"})]})});var Ro=()=>o(284371),To=()=>o(584262),Mo=()=>o(921598),_o=()=>o(566910),Po=()=>o(183558),Bo=()=>o(873050),Vo=()=>o(10594),Fo=()=>o(508496),Lo=()=>o(916260);function Eo(e){const{environment:t,groupsFormatKey:n,collectionContextStore:r,currentGroups:i}=e;if(Fo().default.checkGate({gateName:"collection_group_reducer_visible"}))return;const l=r.normalizedFormatStore.state;if(""!==r.searchQueryStore.state)return;if((0,Bo().I6)(r))return;const s=l[n]||[];if(!r.permissionScopesStore.state.canConfigureBlock)return;if(0===i.length)return;const a=i.slice(0,Vo()._9),c=s.slice(0,Vo()._9);y().n4(a,c)||j().createAndCommit({userAction:"collectionGroupActions.persistFormatGroups",environment:t,canUndo:!1,perform:e=>{(0,Lo().o)({collectionContextStore:r,newGroups:i,groupsFormatKey:n,transaction:e}),e.postSubmitCallbacks.push((()=>{(0,o(191597).a)({environment:t,collectionContextStore:r,request_reason:"persist_format_groups"})}))}})}var Oo=()=>o(896628),Do=()=>o(246826),zo=()=>o(857783),Ko=()=>o(281948),Ho=()=>o(312296),Wo=()=>o(970013),Go=()=>o(206267),No=()=>o(821062);function Uo(e,t){xe().vd(e,"board_item_delete_newly_created",t)}var $o=()=>o(114641),qo=()=>o(645099),Yo=()=>o(690825),Xo=()=>o(592269),Qo=()=>o(416504),Zo=(o(823215),o(430670),()=>o(9559)),Jo=()=>o(519831),en=()=>o(708830),tn=()=>o(909470),on=()=>o(337567),nn=()=>o(861841),rn=()=>o(722101),ln=()=>o(73223),sn=()=>o(317001),an=()=>o(520861),cn=()=>o(716728),dn=()=>o(976405),un=()=>o(394653);function pn(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const s=i.normalizedSchemaStore.state,a=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,u=new Map;for(const p of n){const e=Xo().jV({block:o.getModel(),schema:s,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,Qo().P)(),userStartOfWeek:Ce().XX.state},group:p,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:vt().A.getIntl(),relativeVariableResult:a,currentPageInRelatedCollection:c,resultCache:d,regExpCache:u,experimentService:Fo().default});(0,un().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var mn=()=>o(755673),gn=()=>o(656432);function Sn(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r}=e,i=[];return t.forEach((e=>{var t,l;const s=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],a=null==o||null===(l=o.collectionStore())||void 0===l?void 0:l.getSchema(),c=new Map,d=new Map,u=n.flatMap((t=>{const o=t.getModel();if(s&&a&&o)return(0,Zo().W)({property:e.property,schema:a,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,Qo().P)(),depth:0,intl:vt().A.getIntl(),visitedProperties:new Set,resultCache:c,regExpCache:d,experimentService:Fo().default,collectionFeatureGates:(0,tn().i)()},exportedFilePaths:!1,formulasModule:r})})).filter((e=>!y().b0(e)));i.push(...u)})),y().Mp(i,y().n4)}function hn(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:s,droppedDirection:a,droppedStores:c,transaction:d,duplicate:u,collectionContextStore:p,groupsPointer:m,subitemPath:g,formulasModule:S,duplicateActions:h}=e;if(!p.permissionScopesStore.state.canEditContent)return;if(c.some((e=>(0,on().pQ)(e.id))))return;if(c.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:s,duplicateActions:a}=e,c=i.collectionStore(),d=i.collectionViewStore(),u=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),p=u&&u.id===(null==c?void 0:c.id),m=i.hasSingleCollection()&&r,g=(0,an().T)({environment:o,droppedStores:n,duplicate:m,transaction:s,collectionStore:c,duplicateActions:a});for(const S of g){const e=c??S.getAssociatedCollectionStore();e&&(0,sn().j)({environment:o,store:S,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:s})}d&&(0,mn().z)({resultIds:g.map((e=>e.id)),collectionViewStore:d,collectionContextStore:i,transaction:s}),s.postSubmitCallbacks.push((async e=>{!e&&c&&(p||await Q().Bz({droppedStores:n,createdStores:g,collectionStore:c,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:p,groupsPointer:m,droppedStores:c,duplicate:u,transaction:d,duplicateActions:h}),!s)return;const f=p.collectionViewStore();if(!f)return;const v=null===(t=c[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),x=v&&v.id===(null==l?void 0:l.id),b=null===(o=p.groupsStore.getGroupState(m))||void 0===o?void 0:o.groupUiParentStore;if(!b)return;const C=Sn({groupsPointer:m,collectionContextStore:p,blocks:c,formulasModule:S}),w=(null===(n=p.groupsStore.getGroupState(m))||void 0===n?void 0:n.resultsStore.state)||[],k=c.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=c[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),I=p.hasSingleCollection()&&(k||u);if(a===nn().bH.Onto){A().IU({environment:i});const e=s.getContentStore(),t=(0,an().T)({environment:i,droppedStores:c,duplicate:I,transaction:d,collectionStore:l,duplicateActions:h});for(const o of t)rn().BC({parentStore:e,appendStore:o,transaction:d});return[]}let j=!1,R=[];if(!I&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,gn().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===Jo().Vl||l.getAssociatedCollectionStore())return;if(!gt().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:c,collectionStore:l,transaction:d});j=void 0!==e,R=e??[]}const T=(0,ie().kY)([...(null==g?void 0:g.map((e=>e.value.store.pointer)))??[]]),M=p.subitemExpandedStore.state.get(T),_=g&&g.length>1||(null==M?void 0:M.isExpanded)&&a===nn().bH.Below,P=p.groupsStore.getAllGroupStates();c.forEach((e=>{const t=P.find((t=>t.resultsStore.state.includes(e)));t&&!_&&pn({environment:i,store:e,collectionContextStore:p,groupsPointer:t.groupsPointer,transaction:d})}));const B=(0,an().T)({environment:i,droppedStores:c,duplicate:I,transaction:d,collectionStore:l,duplicateActions:h});j||(R=(0,gn().K)({environment:i,stores:B,spaceId:s.getSpaceId(),transaction:d})),d.postSubmitCallbacks.push((async e=>{!e&&l&&(x||await Q().Bz({droppedStores:c,createdStores:B,collectionStore:l,environment:i,collectionContextStore:p,groupsPointer:m,alreadyMovedToCollection:j,shouldDuplicate:I}))}));for(const y of R){const e=l??y.getAssociatedCollectionStore();e&&(0,sn().j)({environment:i,store:y,collectionStore:e,collectionContextStore:p,groupsPointer:Boolean(_)?[]:m,shouldCoerce:!0,transaction:d,alreadyMovedToCollection:j})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:s,collectionStore:a,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:m,transaction:g}=e,S=s.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,f=h&&s.normalizedSchemaStore.state[h],y=null==S?void 0:S.property,v=y&&s.normalizedSchemaStore.state[y],x=null===(t=s.collectionViewStore())||void 0===t?void 0:t.getType(),b=null===(o=s.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=s.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection()&&(0,le().pB)())return;const C=(null==b?void 0:b.subitem_display_mode)??"show",w=S&&x&&(0,ie().qS)(x)&&f&&(0,Wo().nC)(f)&&"flattened"!==C&&"disabled"!==C,k=(0,ie().oC)(c[0]);null!=k&&k.subitemFormat&&S&&v&&(0,Wo().nC)(v)&&Q().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:g,subitemRelationSchema:v,relationPropertyCollectionId:a.id});const A=S?(0,ie().Ku)(d,S):void 0,I=A?d.filter(((e,t)=>A.includes(t))):[];for(const j of I){if(w){const e=(0,ie().eO)({store:j,subitemFormat:S,propertySchema:f});for(const t of e){const e=ae().Bv.createChildStore(j,t);Z().c3({environment:r,sourceStore:e,destStore:j,propertyWithInverse:S,transaction:g})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,cn().i)({environment:r,collectionContextStore:s,collectionStore:a,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(en().PH)((0,ie().f5)(m),[])],store:m,before:"into"===e,insertBlockStore:j,insertDirection:e,transaction:g})}}}({environment:i,isInsertingAsSubitem:Boolean(_),shouldDuplicate:I,collectionContextStore:p,collectionStore:l,droppedStores:c,wrappedStores:R,targetSubitemExpandedState:M,subitemPath:g,targetStore:s,transaction:d});const V=w.filter((e=>!B.includes(e))),F=V.indexOf(s),L=a===nn().bH.Above||a===nn().bH.Left?F:F+1,E=[...V.slice(0,L),...R,...V.slice(L)];(0,mn().z)({resultIds:E.map((e=>e.id)),collectionViewStore:f,collectionContextStore:p,transaction:d});const O=Sn({groupsPointer:m,collectionContextStore:p,blocks:B,formulasModule:S}),D=y().n4(C.sort(),O.sort());Fo().default.checkGate({gateName:"intelligent_collections_sort_modal"})?x&&D&&(0,dn().f)({environment:i,collectionContextStore:p}):(0,dn().f)({environment:i,collectionContextStore:p});if(!p.collectionViewBlockStore())return;const z=_?s:b,H=R.map((e=>ae().Bv.createChildStore(z,{table:K().ev,id:e.id})));return A().td({environment:i,stores:H}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===at().Lu&&"sprint_board"===(null===(n=xt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&ln().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(p,d),H}var fn=()=>o(522419),yn=()=>o(675074);function vn(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:s,groupsPointer:a,formulasModule:c,duplicateActions:d}=e,u=s.collectionViewStore(),p=Ce().y0(t);if(!u)return;const m=o.inMemoryRecordCache,g=yn().$C({environment:t,files:i,inMemoryRecordCache:m,pageWidth:p,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],s=Do().Wv({environment:t,type:"page",inMemoryRecordCache:m,properties:{title:(0,bt().x9d)(fn().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return rn().BC({parentStore:s.getContentStore(),appendStore:e,transaction:l}),s}));hn({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:s,groupsPointer:a,droppedStores:g,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c,duplicateActions:d})}var xn=()=>o(901389),bn=()=>o(101981);var Cn=()=>o(289915),wn=()=>o(187174),kn=()=>o(403733);var An=()=>o(97059),In=()=>o(851802),jn=()=>o(970330),Rn=()=>o(645302),Tn=()=>o(522986),Mn=()=>o(315221),_n=()=>o(843306),Pn=()=>o(544073),Bn=()=>o(945895);function Vn(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:i,canDrag:l,canDrop:a,getItemSelectableStyle:c,belowDropZoneMargin:p,analyticsName:m,disabled:g,direction:S,onSelectableEnter:h,disableScrollToRevealHorizontal:f,touchDragOnly:y,isLast:v,groupsPointer:x,toggleButton:b,subitemPath:C,disableSelectable:k,itemSelectableHaloStyle:A,passesFilter:I,onSelectableInsertRow:R,blockPropertyValueOverlayStore:T,dropzoneGap:M}=e,P=(0,s().v3)(),B=(0,fe().Zp)(),V=(0,d().K8)((()=>(0,An().W)(P,t.id)),[t,P]),F=(0,d().K8)((()=>t.canEdit()),[t]),L=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),E=(0,d().K8)((()=>"collectionTypedView"===i.contextType),[i]),O=(0,d().K8)((()=>{const e=i.groupsStore.getGroupState(x);return null==e?void 0:e.resultsStore}),[i,x]),z=(0,d().K8)((()=>_().NM(t)),[t]),K=(0,d().K8)((()=>_().f5({environment:P,collectionContextStore:i})?60:void 0),[i,P]),H=(0,d().K8)((()=>{const e=Bn().A.state;return e.isActive&&e.store===t}),[t]),W=!g&&F&&!V,G=e.shouldShowHoverMenu&&W,N=S!==Kn.Vertical&&a,U=S!==Kn.Vertical&&a,$=S===Kn.Vertical&&a,q=(0,d().K8)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),Y=(0,u().IS)((e=>({haloStyle:{..._().wh(e,z),...("board"===q||"gallery"===q)&&{borderRadius:Us},...A}})),[q,A,z]),X=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?(0,Mn().D)({environment:P,collectionStore:L,collectionContextStore:i,groupsPointer:x,insertStores:o,store:t,before:!1,transaction:n}):[]}),[L,i,P,x,t]),Q=(0,n.useCallback)((e=>{const{insertStores:o,transaction:n}=e;return L?(0,Mn().D)({environment:P,collectionStore:L,collectionContextStore:i,groupsPointer:x,insertStores:o,store:t,before:!0,transaction:n}):[]}),[L,i,P,x,t]),{value:Z}=(0,se().fJ)(re().VI.duplicateActions),J=(0,n.useCallback)((async e=>{const{droppedDirection:o,duplicate:n}=e;if(!L)return[];const r=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:P,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})});const l=o!==nn().bH.Onto?(0,Vo().f0)({stores:e.droppedStores,collectionContextStore:i}):e.droppedStores;if(0===l.length&&E)return void xn().f1((0,D.jsx)(pt().sA,{...Vo().K0.unsupportedGroupAction}));const s=await ve().T.formulas.load();j().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:P,canUndo:!0,perform:e=>{!hn({environment:P,collectionStore:E?void 0:L,targetStore:t,droppedDirection:o,collectionContextStore:i,groupsPointer:x,droppedStores:l,duplicate:n,transaction:e,subitemPath:C,collapsedGroup:!1,formulasModule:s,duplicateActions:Z})&&E&&xn().f1((0,D.jsx)(pt().sA,{...Vo().K0.unsupportedGroupAction}))}})}),[L,i,Z,P,x,E,t,C]),ee=(0,n.useCallback)((async e=>{const{files:o,droppedDirection:n}=e;if(!L)return[];const r=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:P,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!0,is_empty:!1})});const l=await ve().T.formulas.load();j().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:P,canUndo:!0,perform:e=>{vn({environment:P,collectionStore:L,targetStore:t,droppedDirection:n,collectionContextStore:i,groupsPointer:x,files:o,transaction:e,formulasModule:l,duplicateActions:Z})}})}),[L,i,Z,P,x,t]),te=(0,n.useCallback)((e=>o=>{let{transaction:n}=o;if(!L)return[];const r=(0,_n().u)({environment:P,collectionContextStore:i,groupsPointer:x,store:t,before:"above"===e,collectionStore:L,transaction:n,subitemPath:C,subitemInsertDirection:"below"});if(jn().v(P,{...ke().sl(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==r?void 0:r.id,creating_block_id:null==r?void 0:r.id}),r&&R&&R(t,r),r&&T){const e=()=>{Tn().ho({isNewBlock:!0,environment:P,blockPropertyValueOverlayStore:T,store:r,property:"title",format:wt().j.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(r,e)}}),[L,T,i,P,x,R,t,C]),oe=e.handleOpenPeekPage,ne=(0,n.useCallback)((()=>{const e=i.collectionViewStore();Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),oe&&oe(),w().Ey({collectionContextStore:i,resultsStore:O});const t=null==e?void 0:e.getType();if(t){const e=i.normalizedFormatStore.state.collection_peek_mode,o=e||Pn().C9[t];Rn().bn(P,{is_peek:!0,from:t,peek_mode:o})}}),[i,P,oe,O]),ie=(0,d().K8)((()=>c?c(v):void 0),[c,v]);(0,n.useEffect)((()=>{i.onItemMount(t)}),[t,i]);const le=n.createElement(r,{handleOpenPeekPage:ne,collectionContextStore:i,...o,...V?{disabled:!0}:{},store:t,key:t.id,isLast:v,toggleButton:b,subitemPath:C,passesFilter:I});return k?le:(0,D.jsx)(lt().A,{style:ie,store:t,canSelect:W,shouldShowHalo:!(H||null!=B&&B.isPreviewing),shouldForceRenderSelectionHalo:z,haloStyle:Y.haloStyle,canDrag:l,canDropBelow:$,canDropLeft:N,canDropRight:U,canNativeDropBelow:$&&!E,canNativeDropLeft:N&&!E,canNativeDropRight:U&&!E,canDropOnto:a,canTriggerContextMenu:W,isLastItem:v,showBlockMenuInput:!0,shouldShowHoverMenu:G,shouldShowCommentMenu:!1,onSelectableDrop:J,onNativeDrop:ee,onInsertBelow:X,onInsertAbove:Q,onRemove:e=>function(e,t,o,n,r){const{transaction:i}=e;r.length>0&&pn({store:o,transaction:i,groupsPointer:r,collectionContextStore:n,environment:t});gt().by({childStore:o,transaction:i})}(e,P,t,i,x),canInsertAbove:a,canInsertBelow:a,onInsertRowBelow:te("below"),onInsertRowAbove:te("above"),belowDropZoneMargin:p,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:m,shouldShowDropZone:a,dropzoneGap:M,onEnter:h,className:we().E4t,disableScrollToRevealHorizontal:f,touchDragOnly:y,groupsPointer:x,verticalDropZoneExtraLeftEdgeOffset:K,children:le})}const Fn=n.memo(Vn,No().A);var Ln=()=>o(702796);function En(e){const{store:t,collectionContextStore:r,subitemPath:i,titleColumnIndex:l,nestedCreateSubitemButton:a,getItemSelectableStyle:c}=e,p=(0,s().v3)(),{isMobile:m}=(0,s().Y0)(),g=(0,u().DP)(),{currentSubitemFormatStoreForUiDisplayStore:S,subitemExpandedStore:h,subitemTreeStore:f}=r,v=(0,d().K8)((()=>_().Dj({store:t,collectionContextStore:r})),[r,t]),x=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),{value:b}=(0,se().fJ)(ve().T.formulas),C=(0,d().K8)((()=>i&&i.length>0?i:(0,en().Qe)(f.state.children,(e=>e.value.store===t))),[i,f,t],{useDeepEqual:!0}),w=(0,n.useMemo)((()=>C?(0,ie().kY)(C.map((e=>e.value.store))):""),[C]),k=(0,d().K8)((()=>h.state.get(w)),[h,w]),I=Boolean(null==k?void 0:k.isExpanded),j=(0,d().O$)(S),R=(0,d().K8)((()=>{if(!v||!j)return;const e=v.getSchema()[j.property];return void 0!==e&&(0,Wo().nC)(e)?e:void 0}),[v,j]),T=(0,d().K8)((()=>{var e;return R&&"relation"===R.type&&(0,Wo().zO)(R)===(null===(e=r.collectionStore())||void 0===e?void 0:e.id)&&R.property}),[r,R]),M=(0,d().K8)((()=>{const e=!T||x&&(0,ie().qS)(x)?void 0:{property:T,filter:{operator:"is_empty"}};return!(!j||!v)&&(0,ie().Ch)({store:t,collectionStore:v,subitemFormat:j,subitemPathKey:w,collectionContextStore:r,propertyFilters:[...e&&T?[{id:T,filter:e}]:[],...r.currentPropertyFiltersStore.state],combinatorFilter:r.currentCombinatorFilterStore.state,currentUserId:p.currentUser.id,resultCache:new Map,regExpCache:new Map,formulasModule:b}).length>0}),[r,x,p.currentUser.id,T,v,w,t,j,b]),P=(0,d().K8)((()=>!(!v||!j)&&(M||I||m||"timeline"===x)),[v,j,M,I,m,x]),B=(0,d().K8)((()=>!(!v||!j)&&In().A.getState().hoveredStore===t),[v,t,j]),V=(0,d().K8)((()=>{const e=(0,Bo().AU)({collectionContextStore:r,collectionStore:v,environment:p});if(e)return(0,Cn().oR)(e)}),[r,v,p]),F=(0,n.useCallback)((()=>{const e=h.state;if(I){e.delete(w);const o=ce().default.state.stores.filter((e=>t.uiContains(e)));o.length>0&&A().DN({stores:(0,y().R9)(ce().default.state.stores,o)}),function(e,t){xe().vd(e,"subitem_toggle_block_close",t)}(p,{...(0,ke().sl)(r),depth:(null==C?void 0:C.length)||0}),h.emit()}else e.set(w,{isExpanded:!0,limit:20}),function(e,t){xe().vd(e,"subitem_toggle_block_open",t)}(p,{...(0,ke().sl)(r),depth:(null==C?void 0:C.length)||0}),V&&e&&R&&j?(0,ie().eI)({blockStore:t,subitemExpandedStore:h,subitemFormat:j,propertySchema:R,compiledFilter:V,pathKey:w,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}).then((()=>{h.emit()})):h.emit()}),[h,I,w,p,r,null==C?void 0:C.length,t,V,R,j]),L=(0,d().K8)((()=>{const o=f.state;return o&&C&&o.children.length>0?(0,ie().ag)(o).value.store===t:e.isLast}),[f,e.isLast,t,C]),E=(0,o(991114).C)(),O=(0,d().K8)((()=>{var e;const o=t.getModel();if(!V||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return V({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+E,resultCache:new Map,regExpCache:new Map,experimentService:Fo().default,formulasModule:b})}),[t,V,E,b]),z=(0,d().K8)((()=>(0,An().W)(p,t.id)),[p,t]),K=(0,d().K8)((()=>c&&!O||z?()=>({...c?c(L):{},...O?{}:{opacity:.5},...z?{opacity:.5}:{}}):c),[c,O,L,z]);(0,wn().Yb)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel;if(!P||!e||!V||!R||!o||!j||O)return;(0,ie().eO)({store:t,subitemFormat:j,propertySchema:R}).length>0||(await(0,ie().eI)({blockStore:t,subitemExpandedStore:h,subitemFormat:j,propertySchema:R,compiledFilter:V,pathKey:w,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map}),h.emit())}),[P,V,O,w,t,h,j,R]);const H=(0,D.jsx)(Fn,{...e,passesFilter:O,isLast:L,getItemSelectableStyle:K,subitemPath:C,toggleButton:P||B?(0,D.jsx)(Ln().A,{isSidebar:!1,open:I,fill:!0,onClick:F,color:M||I?g.regularIconColor:g.mediumIconColor,disabled:C&&C.length>=ie().x2}):void 0});if(!I||!C||0===C.length||C.length>=ie().x2)return H;const W=C[C.length-1].children;return(0,D.jsxs)(D.Fragment,{children:[H,W.map((t=>{const o=t.value.store;return(0,n.createElement)(Dn,{...e,key:o.id,store:o,subitemPath:[...C,t]})})),v&&a&&a({store:t,parentStore:v,subitemPath:C,indentLevel:C.length,titleColumnIndex:l}),k&&W.length>0&&W.length===k.limit&&(0,D.jsx)(On,{collectionContextStore:e.collectionContextStore,pathKey:w,titleColumnIndex:l,limit:k.limit,indentLevel:C.length})]})}const On=n.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:l}=e,s=(0,n.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),a=(0,d().K8)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),c=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:(0,R().si)({columnIndex:0,titleColumnIndex:r,indentLevel:l,isSubitemToggleOnTitleColumn:a}),fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},buttonHovered:{background:e.tableRowHoveredBackground},icon:{width:Io().Ev.sm,height:Io().Ev.sm,marginRight:6,fill:e.icon.tertiary},label:{color:e.text.tertiary}})),[r,l,a]);return(0,D.jsxs)(At().A,{onClick:s,onMouseDown:Te().tr,style:c.button,hoveredStyle:c.buttonHovered,children:[(0,kn().g)(c.icon),(0,D.jsx)("span",{style:c.label,children:(0,D.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})),Dn=n.memo(En),zn=n.createContext(null);zn.displayName="CollectionGroupContainerContext";let Kn=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function Hn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,disableRequest:l,onSelectableEnter:a,canDrop:c,canDrag:u,groupsPointer:p,loadContentCover:m,emptyDroppableSize:g,emptyDroppableStyle:S,virtualizeResults:h}=e,f=(0,s().v3)(),v=(0,E().X)("drag_respects_relation_limits"),x=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),b=(0,n.useMemo)((()=>{if(x)return new(ae().Bv)(f,x.pointer)}),[x,f]),{groupState:C,reducer:w}=(0,d().K8)((()=>{const e=t.groupsStore.getGroupState(p);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=y().oE(p.map((e=>(0,Xo().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,Qo().P)()}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:m}}}),[t,p,m]),k=(0,d().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(p);return(null==e?void 0:e.resultsStore.state)??[]}),[t.groupsStore,t.shouldDelayRenderStore,p]),A=(0,d().K8)((()=>"collectionTypedView"===t.contextType?void 0:t.collectionStore()),[t]),I=(0,d().K8)((()=>{if(!v)return!1;const e=t.normalizedSchemaStore.state;return p.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,p,v]),j=i===Kn.Vertical;var R;k.length>0&&(null===(R=t.databaseItemsVisibleTracker)||void 0===R||R.handleItemsRenderStart());(0,n.useEffect)((()=>t.renderEmitter.emit()));const T=g||void 0;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:{...j?{height:T}:{width:T},...S},children:(0,D.jsx)(Gn,{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,canDrop:c,groupsPointer:p,instanceCollectionViewBlockStore:b,resultStores:k,droppedIntoCollectionStore:A,onSelectableEnter:a})}),h?(0,D.jsx)(Un,{collectionContextStore:t,groupsPointer:p,resultComponentProps:e,canDrag:u&&!I,groupState:C,resultStores:k}):k.map(((t,o,n)=>(0,D.jsx)(qn,{store:t,isLast:o===n.length-1,...e,canDrag:u&&!I},t.id))),(0,D.jsx)(Yn,{collectionContextStore:t,groupsPointer:p,disableRequest:l,resultsReducer:w})]})}const Wn=n.memo(Hn);function Gn(e){const{collectionContextStore:t,disabled:o,analyticsName:r,direction:i,onSelectableEnter:l,canDrop:a,groupsPointer:c,instanceCollectionViewBlockStore:u,resultStores:p,droppedIntoCollectionStore:m}=e,g=(0,s().v3)(),S=(0,d().K8)((()=>"collectionTypedView"===t.contextType),[t]),h=(0,d().O$)(t.isInHomeWidgetStore),f=(0,d().K8)((()=>_().f5({environment:g,collectionContextStore:t})?60:void 0),[t,g]),{value:y}=(0,se().fJ)(re().VI.duplicateActions),v=(0,n.useCallback)((async e=>{const o=await ve().T.formulas.load();return function(e,t,o,n,r,i,l){const{droppedDirection:s,duplicate:a}=e,c=o.collectionViewBlockStore();if(!c)return;const d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const u="collectionTypedView"===o.contextType,p=(0,Vo().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===p.length&&u)return void xn().f1(vt().A.formatMessage(Vo().K0.unsupportedGroupAction));j().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!hn({environment:t,collectionStore:l,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n,droppedStores:p,duplicate:a,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})&&u&&xn().f1(vt().A.formatMessage(Vo().K0.unsupportedGroupAction))}})}(e,g,t,c,o,y,m)}),[t,m,y,g,c]),x=(0,n.useCallback)((async t=>{const o=await ve().T.formulas.load();return function(e,t,o,n,r,i,l){const{files:s,droppedDirection:a}=e;if(!l)return;const c=o.collectionViewBlockStore();if(!c)return;const d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),j().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{vn({environment:t,collectionStore:l,targetStore:c,droppedDirection:a,collectionContextStore:o,groupsPointer:n,files:s,transaction:e,formulasModule:r,duplicateActions:i})}})}(t,g,e.collectionContextStore,e.groupsPointer,o,y,m)}),[m,y,g,e.collectionContextStore,e.groupsPointer]);if(!u)return null;const b=i!==Kn.Vertical&&(!o&&0===p.length),C=i===Kn.Vertical&&!o;return(0,D.jsx)(lt().A,{store:u,canSelect:!1,canEditText:!1,shouldShowHalo:!h,canDrag:!1,canDropLeft:a&&b,canNativeDropLeft:a&&b&&!S,canDropBelow:a&&C,canNativeDropBelow:a&&C&&!S,canTriggerContextMenu:!1,isLastItem:0===p.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:v,onNativeDrop:x,analyticsName:r,shouldShowDropZone:a,onEnter:l,groupsPointer:c,verticalDropZoneExtraLeftEdgeOffset:f,style:i===Kn.Vertical?void 0:{width:"100%",height:"100%"}})}function Nn(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r,canDrag:i,groupState:l,resultStores:a}=e;const c=0!==o.length,u=c,[p,m]=(0,n.useState)(!u),[g,S]=(0,n.useState)(0),h=(0,n.useContext)(ye().R),f=(0,n.useRef)(null),y=(0,n.useRef)(null),v=a.length<=0,x=(0,n.useContext)(zn);(0,n.useEffect)((()=>{if(!c)return;const e=new ResizeObserver((()=>{var e;null===(e=y.current)||void 0===e||e.call(y)}));if(null!=x&&x.current)return e.observe(x.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[x,c]);const b=(0,d().K8)((()=>{var e;return null==h||null===(e=h.verticalScroller)||void 0===e?void 0:e.getStore().state.element}),[null==h?void 0:h.verticalScroller]);(0,n.useEffect)((()=>{if(f.current&&u&&!p&&!v){if(null==b||!b.deref())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&m(!0)}),{root:b.deref(),rootMargin:"300px 0px 300px 0px"});return e.observe(f.current),()=>e.disconnect()}}),[p,v,b,u]);const C=(0,n.useCallback)((e=>{if(f.current=e,null==b||!b.deref())return;const t=()=>{let t=e,o=0;for(;t&&t!==document.body&&t!==b.deref();)o+=t.offsetTop,t=t.offsetParent;S(o)};t(),y.current=t}),[b]),w=(0,n.useCallback)((e=>a[e].id),[a]),k=(0,Yo().Te)({count:a.length,estimateSize:()=>34,scrollMargin:g,getScrollElement:()=>(null==b?void 0:b.deref())??null,getItemKey:w,overscan:p?10:1});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:i}=e;const l=(0,n.useRef)({fetching:!1,previousTotal:0}),a=(0,s().v3)(),c=t.getVirtualItems(),u=o.length+1,p=(0,d().K8)((()=>{var e;return(null==i||null===(e=i.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==i?void 0:i.reducerResultStore]);(0,n.useEffect)((()=>{if(null!=i&&i.groupsPointer.length)return;const{fetching:e,previousTotal:t}=l.current;e&&t!==u&&(l.current={fetching:!1,previousTotal:0})}),[null==i?void 0:i.groupsPointer.length,u]),(0,n.useEffect)((()=>{if(!p||null==i||!i.groupsPointer||i.groupsPointer.length>0||l.current.fetching)return;const[e]=c.slice(-1);!e||u<=0||e.index-t.options.overscan>.67*u&&(l.current={fetching:!0,previousTotal:u},r.infiniteScrollLongTaskObserver.observe(),(0,$o().H)({collectionContextStore:r,environment:a,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==i?void 0:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,a,null==i?void 0:i.groupsPointer,p,o.length,u,c,t.options.overscan])}({virtualizer:k,resultsStores:a,collectionContextStore:t,groupState:l}),(0,n.useEffect)((()=>{t.virtualizedModule.setRowVirtualizer({virtualizer:k,groupsPointer:o})}),[t,k,o]),v?null:(0,D.jsx)("div",{ref:C,style:{height:k.getTotalSize(),width:"100%",position:"relative"},children:k.getVirtualItems().map((e=>{const t=a[e.index],o=a.length-1===e.index;return(0,D.jsx)("div",{"data-index":e.index,ref:k.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-k.options.scrollMargin}px)`},children:(0,D.jsx)(qn,{store:t,isLast:o,...r,canDrag:i},t.id)},e.key.toString())}))})}const Un=n.memo(Nn,No().A);function $n(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:l,groupsPointer:s,shouldShowHoverMenu:a,canDrag:c,disabled:u,format:p,getItemSelectableStyle:m,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,direction:f,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:x,touchDragOnly:b,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:A,nestedCreateSubitemButton:I,itemSelectableHaloStyle:j}=e,R=(0,d().K8)((()=>_().Dj({store:e.store,collectionContextStore:o})),[o,e.store]),T=(0,n.useMemo)((()=>[]),[]);return R?(0,D.jsx)(Dn,{getItemSelectableStyle:m,itemSelectableHaloStyle:j,store:e.store,canDrag:c,resultProps:i,resultComponent:l,collectionContextStore:o,groupsPointer:s,shouldShowHoverMenu:a,canDrop:v&&!u,format:p,handleOpenPeekPage:g,belowDropZoneMargin:S,analyticsName:h,disabled:u,direction:f,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:x,touchDragOnly:b,isLast:t,subitemPath:T,titleColumnIndex:A,blockPropertyValueOverlayStore:C,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:I}):null}const qn=n.memo($n,No().A);function Yn(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:n,resultsReducer:r}=e;const i=(0,E().X)("collection_group_reducer_visible"),l=(0,d().K8)((()=>t.groupsStore.getGroupState(o)),[t,o]),s=(0,d().K8)((()=>Fo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),a=i&&o.length>0;return n||!r||!l||a?null:(0,D.jsx)(bn().A,{id:o.length>0?`results:${(0,Mo().Hm)(o)}`:"collection_group_results",reducer:r,groupsPointer:o,collectionContextStore:t,resultStore:l.reducerResultStore,debounceWait:s})}var Xn=()=>o(228927),Qn=()=>o(325383),Zn=()=>o(612008),Jn=()=>o(573451),er=()=>o(357643);function tr(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:s,from:a,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,Zn().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:s,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:a},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(n.device.isMobile)zo().uK({environment:n,store:m,pageVisitSource:To().y8.Create});else if(p){const e=m.getBlockTitleStore();A().hc({environment:n,store:m}),I().setSelectionAtEnd({store:e}),(0,Jn().C)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextType;Ko().VU({environment:n,store:m,peekMode:(0,_().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:To().y8.Create})}jn().v(n,{from:a,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,ke().sl)(r)})}var or=()=>o(863330),nr=()=>o(100622),rr=()=>o(128914);function ir(e){const{collectionContextStore:t}=e,o=(0,pt().tz)(),n=(0,d().K8)((()=>{var e;return t.databaseType?(0,rr().Mw)(o,t.databaseType):(0,rr()._o)(o,null===(e=t.collectionStore())||void 0===e?void 0:e.getModel())}),[t,o]);return(0,D.jsx)(D.Fragment,{children:n})}var lr=()=>o(860118);const sr={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:Ro().Wy.medium,width:"auto"},ar={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:Ro().Wy.medium,width:"auto"};function cr(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,ft().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==Wo().rn||(0,lr().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Qo().P)(),intl:vt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:r})))}function dr(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,ft().qI)(o,t)}return!1}var ur=()=>o(493823),pr=()=>o(331542);const mr=n.memo((function(e){const{collectionContextStore:t,color:o,groupsPointer:r,isFullScreen:i,shouldShowSpinner:l}=e,a=(0,s().v3)(),{isMobile:c}=(0,s().Y0)(),d=(0,u().IS)((e=>{const t=o||e.text.tertiary,n=c?ar.fontSize:sr.fontSize;return{addItemButton:{width:"100%",color:t,borderRadius:Us,boxShadow:"dark"===e.mode?`${nr().Ay.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:"12px 16px 12px 16px",minHeight:(0,_().rU)({isMobile:c}),fontSize:n},plusIcon:{width:n,height:n,fill:t},spinner:{margin:"0 0 0 auto"}}}),[o,c]),p=(0,n.useCallback)((()=>{(0,Xe().EF)(a)?j().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:a,canUndo:!0,perform:e=>{tr({transaction:e,environment:a,collectionContextStore:t,isFullScreen:i,groupsPointer:r,from:"board_group_add_item_bottom",transient:!1})}}):(0,Xe().QY)(a)}),[t,a,r,i]);return(0,D.jsxs)(ur().p,{icon:or().plusSmallIcon,iconStyle:d.plusIcon,isLightGray:!0,size:"lg",style:d.addItemButton,onClick:p,onMouseDown:Te().tr,children:[(0,D.jsx)(ir,{collectionContextStore:t}),l?(0,D.jsx)("div",{style:d.spinner,children:(0,D.jsx)(pr().A,{size:"sm"})}):null]})}));var gr=()=>o(955363),Sr=()=>o(319357);function hr(e){let{color:t,collectionContextStore:o,groupFormat:n,isHovered:r}=e;const{isMobile:i}=(0,s().Y0)(),l=(0,u().IS)((e=>{const o=t||e.text.tertiary,n=i?ar.fontSize:sr.fontSize;return{linkButton:{visibility:r?"visible":"hidden",marginTop:8,width:"100%",color:o,borderRadius:Us,padding:"12px 16px 12px 16px",fontSize:n},icon:{width:n,height:n,fill:o}}}),[t,i,r]);return(0,D.jsx)(Sr().O,{collectionContextStore:o,groupFormat:n,renderLinkButton:e=>(0,D.jsx)(ur().p,{icon:gr().arrowDiagonalUpRightIcon,iconStyle:l.icon,isLightGray:!0,size:"lg",style:l.linkButton,...e,children:(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})})}var fr=()=>o(395361),yr=()=>o(721908),vr=()=>o(435009),xr=()=>o(932210),br=()=>o(244091),Cr=()=>o(743147),wr=()=>o(164124),kr=()=>o(296798),Ar=()=>o(492414),Ir=()=>o(231722),jr=()=>o(34556),Rr=()=>o(299709),Tr=()=>o(739041),Mr=()=>o(458366);function _r(e,t,o,n,r){const i=o.getViewType();if("board"===i||"gallery"===i){const l=(0,ft().yT)(t);A().hc({environment:e,store:t}),I().setSelectionAtEnd({store:l}),(0,Jn().C)({store:t}),r&&(0,Tr().u)(e,"board_item_edit_mode_enter",{...(0,ke().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function Pr(e,t,o,n,r,i,s,a){const c=r.normalizedSchemaStore.state,d=n.state;if(!d.isOpen)return;const u=cr(t,o,r,s,a).map((e=>e.property)),p=u.findIndex((e=>e===d.property));let m;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,Mr().B2)(c[e])))||u.find(((e,t)=>!s&&(0,Mr().B2)(c[e])));m=e}else{const e=y().Uk(u,((e,t)=>t<p&&(0,Mr().B2)(c[e])))||y().Uk(u,((e,t)=>!s&&(0,Mr().B2)(c[e])));m=e}m?l().default.afterNextFlush((()=>{Tn().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:m,format:wt().j.Page,collectionContextStore:r})})):s&&l().default.afterNextFlush((()=>{_r(t,o,r,i)})),Tn().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Br(e,t,o,n,r,i,l,s){const a=n.normalizedSchemaStore.state,c=cr(t,o,n,l,s).map((e=>e.property));let d;if("tab"===e){d=c.length>0?c[0]:void 0}else{d=y().Uk(c,((e,t)=>{const o=a[e];return(0,Mr().B2)(o)}))}d&&Tn().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:d,format:wt().j.Page,collectionContextStore:n}),i.preventEmptyDelete()}class Vr extends p().default{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),Bn().A.state.isActive&&Bn().A.setState({...Bn().A.state,transient:!1}))}}const Fr=Vr;var Lr=()=>o(126617),Er=()=>o(8980),Or=()=>o(24611);function Dr(e){const t=(0,s().v3)(),n=(0,s().Y0)(),{value:r}=(0,se().fJ)(ve().T.formulas),i=(0,d().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),l=(0,d().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),a=(0,d().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),c=(0,d().K8)((()=>Bn().A.state.isActive&&Bn().A.state.store===e.store),[e.store]),u=(0,d().K8)((()=>a.canEditContent&&e.store.canEdit()),[a.canEditContent,e.store]),p=(0,d().K8)((()=>O().default.state.open&&O().default.state.targetStore.id===e.store.id),[e.store.id]),m=(0,d().K8)((()=>{const t=(0,_().hH)(e.collectionContextStore);return(0,Mr().lA)(t,!1)}),[e.collectionContextStore]),g=(0,d().K8)((()=>(0,_().wy)({environment:t,store:e.store,mainEditorCurrentBlockStore:xt().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[t,e.store,e.collectionContextStore]),S=(0,d().K8)((()=>dr(e.collectionContextStore)),[e.collectionContextStore]),h=(0,d().K8)((()=>{const o=l?(0,ft().Wp)({viewType:l,format:i,visible:!0}):[],n=cr(t,e.store,e.collectionContextStore,c,r);return o.length>0&&o.length!==n.length}),[t,i,c,e.collectionContextStore,e.store,l,r]),f=(0,d().K8)((()=>{var t;const o=de().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Ir().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,ft().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),y=(0,d().K8)((()=>!(a.isLocked||!a.canEditContent||a.isSyncedCollection||a.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextType||e.store.canEdit())),[a.canEditContent,a.isExternallyImportedAndSyncedCollection,a.isLocked,a.isSyncedCollection,e.collectionContextStore,e.store]),v=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,x=y&&!c&&!f&&(S||h),b=c&&!p&&!e.disablePeekButton,C=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return n.isMobile?null:(0,D.jsxs)(o(608581).A,{isVisible:e.controlArgs.isVisible,position:"top",children:[v&&!e.controlArgs.isRepositioning&&(0,D.jsx)(At().A,{style:Or().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,D.jsx)(pt().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),v&&e.controlArgs.isRepositioning&&(0,D.jsx)(At().A,{style:Or().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,D.jsx)(pt().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),v&&e.controlArgs.isRepositioning&&(0,D.jsx)(At().A,{style:Or().k,onClick:e.controlArgs.handleCancelClick,children:(0,D.jsx)(pt().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),x&&(0,D.jsx)(jt().A,{renderTooltip:()=>(0,D.jsx)(pt().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:n=>(0,D.jsx)(At().A,{style:Or().k,onClick:()=>{_r(t,e.store,e.collectionContextStore,e.editModeStore,"click")},...n,children:(0,D.jsx)(Er().I,{icon:o(523389).pencilLineSmallIcon,size:"sm"})})}),b&&(0,D.jsx)(jt().A,{renderTooltip:()=>m.tooltip,render:o=>(0,D.jsx)(At().A,{style:Or().k,onClick:()=>{g&&(vr().oo({environment:t,url:g}),e.editModeStore.preventEmptyDelete())},...o,children:(0,D.jsx)(Er().I,{icon:m.icon,size:"sm"})})}),C&&(0,D.jsx)(jt().A,{renderTooltip:()=>(0,D.jsx)(pt().sA,{defaultMessage:"Rename, delete, move to and moreâ€¦",id:"collectionViewCardItem.repositionAction.tooltip"}),render:n=>(0,D.jsx)(At().A,{style:Or().k,onClick:n=>{A().Lt({environment:t,store:e.store}),o(901265).it({environment:t,stores:ce().default.state.stores,left:n.clientX,top:n.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...n,children:(0,D.jsx)(Er().I,{icon:Lr().Y,size:"sm"})})})]})}const zr=n.memo(Dr);var Kr=()=>o(29247);function Hr(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,collectionContextStore:i,disabled:l,editModeStore:a,isCardSelected:c}=e;const u=(0,s().v3)(),{value:p}=(0,se().fJ)(ve().T.formulas),{collectionStore:m,canEdit:g}=(0,d().K8)((()=>({collectionStore:o.getAssociatedCollectionStore(),canEdit:o.canEdit()})),[o]),{viewType:S,collectionViewStore:h,isTableWrapped:f}=(0,d().K8)((()=>({viewType:i.getViewType(),collectionViewStore:i.collectionViewStore(),isTableWrapped:Boolean(i.normalizedFormatStore.state.table_wrap)})),[i]),y=(0,d().K8)((()=>i.permissionScopesStore.state.isLocked||!i.permissionScopesStore.state.canEditContent),[i.permissionScopesStore]),v=(0,n.useCallback)((()=>Pr("tab",u,o,r,i,a,c,p)),[u,o,r,i,a,c,p]),x=(0,n.useCallback)((()=>Pr("untab",u,o,r,i,a,c,p)),[u,o,r,i,a,c,p]),b=(0,n.useCallback)((()=>function(e,t,o,n){Tn().VN({environment:e,blockPropertyValueOverlayStore:t}),A().Lt({environment:e,store:o}),n.preventEmptyDelete()}(u,r,o,a)),[u,r,o,a]);if(!m)return null;const C="gallery"===S?wt().j.GalleryView:wt().j.Board;return(0,D.jsx)(Kr().m,{store:o,property:t.property,disabled:l||!g,locked:y,format:C,tableWrap:f||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:m,showIfEmpty:c,onEnter:b,onEsc:b,onBgClick:b,onTab:v,onUntab:x,collectionViewStore:h},t.property)}const Wr=n.memo(Hr);var Gr=()=>o(693954),Nr=()=>o(614505);const Ur=(0,pt().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a nameâ€¦",id:"collectionViewCardItem.itemName.placeholder"}});function $r(e){const{store:t,collectionContextStore:r,editModeStore:i,onTextEsc:l,onTextEnter:a,blockPropertyValueOverlayStore:c,isCardSelected:p}=e,m=(0,s().v3)(),g=(0,s().Y0)().isMobile,S=(0,pt().tz)(),{value:h}=(0,se().fJ)(ve().T.formulas),{collectionViewBlockId:f,collectionViewId:y,viewType:v}=(0,d().K8)((()=>{var t,o;return{collectionViewId:null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.id,collectionViewBlockId:null===(o=e.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.id,viewType:e.collectionContextStore.getViewType()}}),[e.collectionContextStore]),x=(0,d().K8)((()=>cr(m,t,r,p,h)),[m,t,r,p,h]),b=(0,d().K8)((()=>(0,ie().Kk)({collectionContextStore:r,blockStore:t})),[t,r]),{titleStore:C,icon:w,isEmptyPage:k,hasError:R}=(0,d().K8)((()=>({titleStore:(0,ft().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),T=(0,d().K8)((()=>(Boolean(t.getIcon())||!t.isEmptyPage())&&r.shouldShowPageIcon()),[t,r]),M=(0,d().K8)((()=>{var e;return p?S.formatMessage(Ur.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Qo().P)(),intl:S}))||S.formatMessage(Ur.untitledBlock)}),[p,S,t]),_=(0,d().K8)((()=>t.canEdit()&&r.permissionScopesStore.state.canEditContent),[t,r]),P=(0,n.useCallback)((()=>{Br("tab",m,t,r,c,i,p,h)}),[m,t,r,i,c,p,h]),B=(0,n.useCallback)((()=>{Br("untab",m,t,r,c,i,p,h)}),[m,t,r,i,c,p,h]),V=(0,n.useCallback)((()=>{(0,jr().x)(),I().clear({environment:m});t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):"new"===i.state?a(t):A().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[m,t,r.permissionScopesStore,i,l,a]),F=(0,n.useCallback)((()=>{(0,jr().x)();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?l(t):A().Lt({environment:m,store:t}),i.preventEmptyDelete())}),[t,r.permissionScopesStore,i,l,m]),L=(0,n.useCallback)((()=>{!function(e,t,o,n){const r=t.getViewType();"board"!==r&&"gallery"!==r||((0,Rr().E)({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:r}),n.preventEmptyDelete())}(m,r,t,i)}),[m,t,r,i]),E=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&j().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:m,canUndo:!0,perform:t=>{Do().KY({store:o,value:e,transaction:t})}})}),[m,t]),O=(0,u().IS)((e=>{const t=x.length>0;return{titleWrap:{position:"relative",width:"gallery"===v?"100%":"auto",display:"flex",paddingLeft:10,paddingRight:10,paddingBottom:t?6:g?12:8,paddingTop:b?4:g?12:8},recordIcon:{float:"left",borderRadius:5,width:24,height:24,marginLeft:-2,...g?{marginTop:0,marginRight:4}:{marginTop:2,marginRight:4}},warningIcon:{fill:e.accentColors.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...g?{width:20,marginLeft:2,marginRight:4}:{width:16,marginLeft:4,marginRight:6}},text:{pointerEvents:p?void 0:"none",cursor:p?"text":void 0,flexGrow:1,padding:"2px 1px",whiteSpace:"pre-wrap",...g?ar:sr}}}),[p,g,b,x.length,v]),z=(0,n.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:y,collectionViewBlockId:f})),[f,y]),K=(T||p)&&!R;return(0,D.jsxs)("div",{style:O.titleWrap,children:[K&&(0,D.jsx)(Nr().B,{disabled:!1,bucket:"secure",style:O.recordIcon,progressContainerStyle:O.recordIcon,icon:w,store:t,size:g?24:_?20:18,isEmptyPage:k,onChange:E}),R&&(0,Gr().Q)(O.warningIcon),(0,D.jsx)(o(524702).A,{store:C,disabled:!p,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:V,onEsc:F,onTab:P,onUntab:B,onChange:L,placeholder:M,style:O.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:z})]})}const qr=n.memo($r);function Yr(e,t){const{store:o,onTextEsc:r,onTextEnter:i,onShiftEnter:l,handleOpenPeekPage:c,collectionContextStore:u,blockPropertyValueOverlayStore:p}=e,m=(0,s().v3)(),g=(0,n.useRef)(null),{value:S}=(0,se().fJ)(ve().T.formulas),h=(0,d().uB)(void 0,ht().A),f=(0,d().uB)(void 0,Fr),y=(0,d().r6)((()=>{const t=Bn().A.state;return t.isActive&&t.store===e.store}),[e.store]),v=(0,d().O$)(y),x=(0,d().K8)((()=>ce().default.state.stores.includes(o)),[o]),b=(0,d().K8)((()=>{var e,t,n;return!(o.getSpaceId()!==(null===(e=xt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=u.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===at().Lu&&o.getFormat().app_config_uri===at().e4&&"sprint_board"===(null===(n=xt().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch))}),[o,u]),C=(0,d().K8)((()=>{const e=xt().default.state.mainEditorCurrentBlockStore;return(0,_().wy)({environment:m,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:u,fullyQualified:!1})}),[m,u,o]),w=(0,n.useCallback)((()=>{_r(m,o,u,f,"space")}),[m,o,u,f]),k=(0,n.useCallback)((()=>{(0,jr().x)(),f.preventEmptyDelete()}),[f]),A=(0,n.useCallback)((()=>{i(o)}),[i,o]),I=(0,n.useCallback)((()=>{Pr("tab",m,o,p,u,f,v,S)}),[m,o,p,u,f,v,S]),R=(0,n.useCallback)((()=>{Pr("untab",m,o,p,u,f,v,S)}),[m,o,p,u,f,v,S]),T=(0,n.useCallback)((()=>{j().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:m,canUndo:!0,perform:e=>{l({blocks:ce().default.state.stores,transaction:e})}})}),[m,l]),M=(0,n.useCallback)((()=>{"new_empty"!==f.state||v||u.defaultPageTemplateStore.state||(r(o),y.removeListener(M))}),[u.defaultPageTemplateStore,f,v,y,r,o]);return(0,a().l)((()=>{var t;const o=de().default.state,n=Bn().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Ir().H7)(o.multiSelection))||void 0===t?void 0:t.store)===(0,ft().yT)(e.store);i&&r?f.setState("new_empty"):i?f.setState("new"):f.setState("existing")})),(0,n.useEffect)((()=>(y.state&&"new_empty"===f.state&&y.addListener(M),()=>{y.removeListener(M)})),[f,y,M]),(0,Be().NW)(o,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>o,getNode:()=>g.current,activate:()=>{C&&(c(),vr().oo({environment:m,url:C}))}})),[m,c,C,o]),(0,D.jsx)(ee().A,{debugName:"CollectionViewCardItem",capture:v,onEsc:k,onEnter:A,onSpace:w,onTab:I,onUntab:R,children:(0,D.jsxs)(ee().A,{debugName:"CollectionViewCardItem",capture:x,onShiftEnter:T,children:[(0,D.jsx)(Qr,{...e,ref:g,mouseStore:h,editModeStore:f,isCardSelected:v,peekUrl:C}),b&&(0,D.jsx)(br().Ni,{origin:g})]})}))}const Xr=n.memo(n.forwardRef(Yr)),Qr=n.memo(n.forwardRef((function(e,t){const{store:r,disabled:i,peekUrl:l,editModeStore:a,handleOpenPeekPage:c,collectionContextStore:p,blockPropertyValueOverlayStore:m,mouseStore:g,isCardSelected:S,coverFormat:h,coverAspectFormat:f,colorStyle:y,coverSizeFormat:v,coverWidth:x,coverHeight:b}=e,C=(0,s().v3)(),w=(0,s().Y0)().isMobile,k=(0,fe().Zp)(),{value:A}=(0,se().fJ)(ve().T.formulas),[I,R]=(0,n.useState)(void 0),T=(0,d().K8)((()=>(0,An().W)(C,r.id)),[C,r]),M=(0,d().K8)((()=>g.state.mouseEntered),[g]),{viewType:_,isInHomeWidget:P}=(0,d().K8)((()=>({viewType:p.getViewType(),isInHomeWidget:p.isInHomeWidgetStore.state})),[p]),B=(0,d().K8)((()=>(0,Ar().Ay)({store:r,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage})),[r]),V=(0,d().K8)((()=>dr(p)),[p]),F=(0,d().K8)((()=>cr(C,r,p,S,A)),[C,r,p,S,A]),L=(0,d().K8)((()=>(0,ie().xC)({collectionContextStore:p,blockStore:r})),[p,r]),E=(0,d().K8)((()=>(0,ie().Kk)({collectionContextStore:p,blockStore:r})),[p,r]),O=(0,d().K8)((()=>(0,o(299545).oC)(r,{recursivelyLoadAllDiscussions:!1})>0),[r]),z=(0,n.useCallback)((e=>{R(e)}),[R]),K=(0,n.useCallback)((e=>{c(),a.preventEmptyDelete()}),[a,c]),H=(0,n.useCallback)((()=>{We().A.state||g.setState({...g.state,mouseEntered:!0})}),[g]),W=(0,yr().d)(H,100),G=(0,n.useCallback)((()=>{g.setState({...g.state,mouseEntered:!1})}),[g]),N=(0,fr().Y)(G,100),U=(0,n.useCallback)((e=>{j().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:C,canUndo:!0,perform:t=>{Oo().G8({store:r,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[C,r]),$=(0,n.useCallback)((e=>T||null!=k&&k.disableAllPointerEvents?null:(0,D.jsx)(zr,{store:r,collectionContextStore:p,blockPropertyValueOverlayStore:m,coverFormat:h,coverAspectFormat:f,lastProxiedUrl:I,editModeStore:a,controlArgs:e,disablePeekButton:null==k?void 0:k.disablePageLinks,disableMoreButton:null==k?void 0:k.disablePageLinks})),[m,p,k,f,h,a,I,r,T]),q=(0,u().IS)((e=>{const t="board"===_?(null==y?void 0:y.cardBackgroundColor)||e.boardItemDefaultBackground:e.collectionGalleryPreviewCardBackground,o={background:t,boxShadow:e.homeShadow.card.base};return{linkBox:{borderRadius:Us,position:M?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:t,..."board"===_?{marginBottom:w?10:8}:{height:"100%"},...P?{boxShadow:e.homeShadow.card.base}:{boxShadow:e.shadowXS}},linkBoxInner:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===_?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHovered:P?o:{background:(null==y?void 0:y.cardHoveredBackgroundColor)||e.cardHoveredBackground},linkBoxPressed:P?o:{background:(null==y?void 0:y.cardPressedBackgroundColor)||e.cardPressedBackground},propertiesWrapper:{paddingTop:V?0:8,lineHeight:1.5,display:"flex",flexDirection:"column",..."board"===_?{paddingBottom:6}:{paddingBottom:8,...P&&{flexWrap:"wrap"}}},iconsWrapper:{display:"flex",alignItems:"center",paddingRight:10,paddingBottom:O?4:8,paddingLeft:!O||E||V?10:4,paddingTop:"gallery"===_&&0===F.length?8:0,marginTop:"board"===_&&O?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:e.text.tertiary,fill:e.text.tertiary,fontWeight:Ro().Wy.medium,fontSize:12}}}),[_,y,M,w,P,S,O,E,V,F.length]);return"board"!==_&&"gallery"!==_?null:(0,D.jsxs)(kr().A,{ref:t,href:B,metaHref:w?B:l,onMouseEnter:W,onMouseMove:W,onMouseLeave:N,onClick:K,style:q.linkBox,innerStyle:q.linkBoxInner,hoveredStyle:S?{background:q.linkBox.background}:q.linkBoxHovered,pressedStyle:S?{background:q.linkBox.background}:q.linkBoxPressed,disableForOffline:T,children:[(0,D.jsx)(o(801678).A,{store:r,source:_,mouseStore:g,renderControl:$,small:"small"===v,onFlushTemporaryPosition:U,render:e=>{let{imagePosition:t}=e;return h&&(0,D.jsx)(o(358006).z,{variant:"gallery",store:r,coverWidth:x,coverHeight:b,coverFormat:h,coverAspectFormat:f,coverSizeFormat:v,coverPosition:t,showEmptyGalleryCover:"gallery"===_,onLoadProxiedImage:z,isInHomeWidget:p.isInHomeWidgetStore.state})}}),L&&(0,D.jsx)("div",{style:{paddingRight:6,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},children:(0,D.jsx)(Cr().n,{blockStore:r,collectionContextStore:p})}),V&&(0,D.jsx)(qr,{collectionContextStore:p,store:r,blockPropertyValueOverlayStore:m,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}),F.length>0&&(0,D.jsx)("div",{style:q.propertiesWrapper,children:F.map((e=>(0,D.jsx)(Wr,{store:r,disabled:i,blockPropertyValueOverlayStore:m,collectionContextStore:p,editModeStore:a,isCardSelected:S,propertyFormat:e},e.property)))}),(O||E)&&(0,D.jsxs)("div",{style:q.iconsWrapper,children:[E&&(0,D.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,D.jsx)(wr().W,{blockStore:r,collectionContextStore:p})}),(0,D.jsx)(xr().g,{store:r,iconStyle:q.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginLeft:E?-3:0}})]})]})})));const Zr=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w}=e;return(0,D.jsx)(Xr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:void 0,coverWidth:void 0,colorStyle:f,onTextEnter:y,onTextEsc:v,onShiftEnter:x,blockPropertyValueOverlayStore:b,handleOpenPeekPage:C,collectionContextStore:w})};var Jr=()=>o(62856),ei=()=>o(569912);class ti extends p().default{getInitialState(){return{}}}const oi=ti;var ni=()=>o(617668),ri=()=>o(484792);const ii=n.memo((function(e){const{groupsPointer:t,groupFormat:o,collectionContextStore:r,isSingleColumn:i,coverHeight:l,hasVisibleProperties:a,isFullScreen:c}=e,p=(0,s().v3)(),{isMobile:m}=(0,s().Y0)(),g=(0,pt().tz)(),S=(0,n.useContext)(ri().n),h=(0,d().K8)((()=>_().fG({collectionContextStore:r,environment:p,intl:g})),[r,p,g]),f=(0,n.useCallback)((e=>{S?S(e):vr().oo({environment:p,url:e})}),[p,S]),y=(0,n.useCallback)((()=>{if(!(0,Xe().EF)(p))return void(0,Xe().QY)(p);const e=r.groupsStore.getGroupState(t);e&&j().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:p,canUndo:!0,perform:o=>{const{mainEditorCurrentBlockStore:n}=xt().default.state,i=(0,Zn().Q)({environment:p,collectionContextStore:r,groupsPointer:t,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"gallery"},inMemoryRecordCache:p.defaultRecordCache.inMemoryRecordCache});if(!i)return;const l=_().wy({environment:p,store:i.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:r})??(0,Ar().Ay)({store:i.newStore,pageVisitSource:To().y8.Create});f(l),w().Ey({collectionContextStore:r,resultsStore:e.resultsStore}),jn().v(p,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:i.newStore.id,creating_block_id:i.newStore.id,...(0,ke().sl)(r)})}})}),[p,r,t,f]),v=(0,u().IS)((e=>{const t=m?ar.fontSize:sr.fontSize,o=_().rU({isMobile:m}),n=l>0&&c&&!i,r=n&&a?l+o:n?l:o;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:m?ar.fontSize:sr.fontSize,borderRadius:Us,boxShadow:"dark"===e.mode?`${e.darkDividerColor} 0px 0px 0px 1px`:`${e.regularDividerColor} 0px 0px 0px 1px`,padding:m?"12px 14px 12px 14px":"9px 14px 8px",minHeight:r,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:m?ar.fontSize:sr.fontSize,borderRadius:Us,padding:m?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginLeft:-6,color:e.lightIconColor},buttonIcon:{width:t,height:t,marginLeft:i?void 0:-1,marginRight:6,fill:e.lightIconColor}}}),[m,l,c,i,a]),x=(0,n.useCallback)((e=>(0,D.jsx)(At().A,{style:v.linkExistingButton,...e,children:(0,D.jsxs)("div",{style:v.buttonContent,children:[(0,gr().arrowDiagonalUpRightIcon)(v.buttonIcon),(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})),[v]);return(0,D.jsxs)("div",{style:v.wrapper,children:[(0,D.jsx)(At().A,{onClick:y,onMouseDown:Te().tr,style:v.addItemButton,children:(0,D.jsxs)("div",{style:v.buttonContent,children:[(0,ni().plusIcon)(v.buttonIcon),(0,D.jsx)(ir,{collectionContextStore:r})]})}),h?(0,D.jsx)(Sr().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:x}):null]})}));var li=()=>o(599945);const si=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k}=e;return(0,D.jsx)(li().c,{store:t,step:"demo_collection_record",children:(0,D.jsx)(Xr,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:s,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:m,coverFormat:g,coverAspectFormat:S,coverSizeFormat:h,coverHeight:f,coverWidth:y,colorStyle:void 0,onTextEnter:v,onTextEsc:x,onShiftEnter:b,blockPropertyValueOverlayStore:C,handleOpenPeekPage:w,collectionContextStore:k})})};function ai(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:i,disabled:l,store:a,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:u,isSingleColumn:p}=e;const m=(0,s().v3)(),g=(0,n.useMemo)((()=>o?[o]:[]),[o]),S=(0,d().O$)(t.permissionScopesStore),h=(0,d().K8)((()=>a.canEdit()&&("collectionTypedView"===t.contextType||S.canEditContent)),[t,S.canEditContent,a]),f=(0,n.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();A().hc({environment:m,store:e}),I().setSelectionAtEnd({store:o}),(0,Jn().C)({store:e})}}),[m]),y=(0,n.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;bt().q4_(n.getValue())?A().Lt({environment:m,store:e}):o&&j().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:m,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}})}),[t,m]),v=(0,n.useMemo)((()=>p?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[p]),{gallery_cover:x,gallery_cover_aspect:b,gallery_cover_size:C}=r,w=!l&&h&&!S.isSyncedCollection,{coverHeight:k,coverWidth:R}=(0,d().K8)((()=>{const{coverHeight:e,coverWidth:t}=u.state;return{coverHeight:e,coverWidth:t}}),[u]),T=(0,n.useMemo)((()=>({format:r,schema:i,onTextEnter:y,onTextEsc:y,onShiftEnter:f,disabled:l,coverFormat:x,coverAspectFormat:b,coverSizeFormat:C,coverHeight:k,coverWidth:R,blockPropertyValueOverlayStore:c,collectionContextStore:t})),[c,t,k,R,b,x,C,l,r,f,y,i]);return(0,D.jsx)(Wn,{collectionContextStore:t,groupsPointer:g,format:r,canDrag:w,onSelectableEnter:f,resultProps:T,resultComponent:si,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:p?Kn.Vertical:Kn.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:v,loadContentCover:x&&"page_content"===x.type})}const ci=n.memo(ai);function di(e){const t=e.minHeight||zs,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,D.jsx)(eo().A,{style:o.card})}function ui(e){const{hasPartialResults:t}=e;if(!(0,Jr().A)(!0,0,100))return null;const n=e.coverHeight??o(963575).A.card.desktop.medium.height,r=t?void 0:n+40,i=t?1:3,l=y().Hn(i,(e=>(0,D.jsx)(di,{minHeight:r},e)));return(0,D.jsx)(D.Fragment,{children:l})}const pi=n.memo((function(e){var t;const{groupFormat:o,store:r,format:i,disabled:l,collectionContextStore:a,schema:c,blockPropertyValueOverlayStore:p,isFullScreen:m,collectionGalleryViewStore:g,headerWidth:S}=e,{isMobile:h}=(0,s().Y0)(),f=(0,n.useMemo)((()=>o?[o]:[]),[o]),y=(0,d().K8)((()=>S<=Ds),[S]),v=(0,d().K8)((()=>a.groupsStore.anyGroupHasResults()),[a]),x=(0,d().K8)((()=>a.groupsStore.getGroupState(f)),[a,f]),b=(0,d().K8)((()=>g.state.coverHeight),[g]),{reducerResult:C,hasPartialResults:w}=(0,d().K8)((()=>{const e=null==x?void 0:x.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[x]),k=(0,d().K8)((()=>(0,Qn().iv)({collectionContextStore:a,groupsPointer:f,hasPartialResults:w})),[a,f,w]),A=(0,d().K8)((()=>_().XQ({collectionContextStore:a,reducerResult:C,isFullScreen:m})),[a,C,m]),{canEditContent:I,isSyncedCollection:j}=(0,d().K8)((()=>{const e=a.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),R=(0,d().K8)((()=>r.canEdit()&&("collectionTypedView"===a.contextType||I)),[r,a,I]),T=(0,d().O$)(a.isInHomeWidgetStore),M=(0,u().IS)((e=>{const t=i.collection_group_by,n=i.gallery_cover_size,r=h?ar.fontSize:sr.fontSize;return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${y?"100%":`${_().rq(n)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:t?1:16,paddingBottom:4,...T?{paddingLeft:8,paddingRight:8}:{}},loadMoreButton:{fontSize:r},loadMoreButtonIcon:{width:r,height:r},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,T,h,y]);if(!x)return null;const P=void 0!==o,B=!T&&v&&!l&&R&&!j&&(w||!k),V=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,D.jsxs)("div",{style:M.container,children:[(0,D.jsxs)("div",{style:M.resultsWrapper,children:[(0,D.jsx)(ci,{collectionContextStore:a,groupFormat:o,format:i,schema:c,disabled:l,store:r,blockPropertyValueOverlayStore:p,collectionGalleryViewStore:g,isSingleColumn:y}),k?(0,D.jsx)(ui,{hasGroups:P,hasPartialResults:w,coverHeight:b}):null,B?(0,D.jsx)(ii,{collectionContextStore:a,groupsPointer:f,groupFormat:o,isSingleColumn:y,coverHeight:i.gallery_cover&&b?b:0,hasVisibleProperties:V,isFullScreen:m}):null]}),A?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:M.renderLoadMoreButtonDivider}),(0,D.jsx)(qo().jJ,{groupsPointer:f,store:r,collectionContextStore:a,format:i,isFullScreen:m,incrementLimitsInRelatedGroups:!1,style:M.loadMoreButton,iconStyle:M.loadMoreButtonIcon})]}):null]})}));var mi=()=>o(588316),gi=()=>o(30626),Si=()=>o(797535),hi=()=>o(751086);function fi(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:s}=e,a=o.collectionStore();!(0,Mo().OF)(n.value,r.value)&&a&&(0,hi().a)({environment:t,collectionStore:a,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:s});const c=l.map((e=>(0,Mo().OF)(n.value,e.value)?r:e));(0,Lo().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:s})}function yi(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:s,environment:a}=e,c=n[o.property];if(!c)return;if(!(0,Mo().Eg)(c))return;const d=o.value;if((0,Wo().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],u=t.value,p=e.map((e=>e.value===d.value?{...e,value:u}:e)),m={...c,options:p},g={...n,[o.property]:m},S={...o,value:{...d,value:u}};j().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:e=>{fi({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:S,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,Si().I)({environment:a,collectionStore:s,update:{schema:g},transaction:e})}})}else if("person"!==c.type)if((0,Mo().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};j().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{fi({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else"status"===c.type||(0,Mo()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,v().HB)(c.type);else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};j().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:a,canUndo:!0,perform:t=>{fi({environment:a,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var vi=()=>o(89849),xi=()=>o(236262),bi=()=>o(161479);const Ci=(0,o(583835).Dv)("deleteGroup");var wi=()=>o(357625);var ki=()=>o(939466),Ai=()=>o(654062),Ii=()=>o(314660),ji=()=>o(722872),Ri=()=>o(575143),Ti=()=>o(928600),Mi=()=>o(939740),_i=()=>o(480095),Pi=()=>o(89924),Bi=()=>o(893952);const Vi="color";const Fi=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:c,groupsLimitStore:u,schema:p}=e;const m=(0,s().v3)(),g=(0,pt().tz)(),{device:S}=m,h=(0,E().X)("collection_group_reducer_visible"),f=(0,d().K8)((()=>y().oE([Oi({environment:m,groupFormat:o,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:c,groupsLimitStore:u,isGroupsReducerV2:h,intl:g}),Ei(m,p,o,r)])),[m,o,r,i,l,a,c,u,h,g,p]),v=(0,n.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(Vi)||t.close()}),[t]);let x;return x=S.isMobile?{menuType:ji().gu.Modal,title:(0,D.jsx)(pt().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:t.close}:{menuType:ji().gu.Popup},(0,D.jsx)(Ti().A,{...x,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:0,sections:f,onAccept:v})})};async function Li(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const s=n.value;if("relation"===s.type&&(0,Mo().WO)(s.value)){const e=ae().Bv.createChildStore(l,{id:s.value.id,table:K().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}j().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:s=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:s,transaction:a,intl:c}=e,d=o.getSchema(),u=d[i.property],p=l.filter((e=>!(0,Mo().OF)(i.value,e.value)));(0,Lo().o)({collectionContextStore:s,newGroups:p,groupsFormatKey:n,transaction:a});const m=i.value;if(u&&(0,Wo().lx)(u)&&m.type===u.type&&o){const e=(u.options||[]).filter((e=>e.value!==m.value)),n={...u,options:e},r={...d,[i.property]:n};(0,Si().I)({environment:t,collectionStore:o,update:{schema:r},transaction:a})}const g=t.currentUser.id,S=new Map,h=new Map;o.inMemoryRecordCache.forEachRecord(g,(async e=>{let{model:n}=e;if(n.table!==K().ev)return;const i=ae().Bv.createChildStore(o,n.pointer);if(Xo().xw({block:n,groupBy:s.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:m,intl:c,timeZone:(0,Qo().P)(),getRecordModel:o.getRecordModel,resultCache:S,regExpCache:h,experimentService:Fo().default,collectionFeatureGates:(0,tn().i)()}))if(n.parent_id===o.id)gt().by({childStore:i,transaction:a});else{const e=i.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===i.getType()||"collection_view_page"===i.getType()&&!i.isCollectionViewPageWithContent())&&await J().Af({environment:t,blocks:[i],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&a.postSubmitCallbacks.push((async e=>{const n=await wi().UT(t,Ci,{collection:{id:o.id,spaceId:(0,bi().e)(o.pointer.spaceId)},property:r,value:m}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:s,intl:i})}}),(0,x().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function Ei(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const s=nr().tS.map((r=>{const i={key:`${Vi}_${r}`,render:e=>(0,D.jsx)(Bi().A,{...e,color:r,isChecked:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!Wo().lx(i))return;const l=r.collectionStore();if(!l)return;const s=o.value;if(s.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),c={...i,options:a},d={...n,[o.property]:c};j().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,Si().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,x().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,D.jsx)(Pi().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s}}function Oi(e){const{environment:t,groupFormat:o,collectionContextStore:n,groupsFormatKey:r,format:i,query:l,currentGroups:s,groupsLimitStore:a,isGroupsReducerV2:c,intl:d}=e,u=[],p=o.value,m=n.permissionScopesStore.state;("board_columns"===r?void 0===l.aggregations:void 0===i.collection_group_aggregation)?u.push({key:"addAggregation",render:e=>(0,D.jsx)(Ri().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:vi().eyeIcon}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[Mo().VR]};j().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Ai().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else j().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{Oo().zA({stores:[r],update:{collection_group_aggregation:Mo().VR},transaction:e})}})}(t,r,l,n)}):u.push({key:"removeAggregation",render:e=>(0,D.jsx)(Ri().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:_o().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:void 0};j().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Ii().f)({collectionViewStore:r,update:t,transaction:e})}})}else j().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{Oo().zA({stores:[r],update:{collection_group_aggregation:void 0},transaction:e})}})}(t,r,l,n)}),(0,Mo().tx)(o)?u.push({key:"show",render:e=>(0,D.jsx)(Ri().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:vi().eyeIcon}),action:()=>{c?(0,ki().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r,i){const l={...t,hidden:!1},s=(0,Vo().DF)(r,l,i.state);j().createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,canUndo:!0,perform:e=>{(0,Lo().o)({collectionContextStore:o,newGroups:s,groupsFormatKey:n,transaction:e})}}),(0,x().X)({environment:e,collectionContextStore:o,action:"show_group"})}(t,o,n,r,s,a)}}):u.push({key:"hide",render:e=>(0,D.jsx)(Ri().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:_o().e}),action:()=>{c?(0,ki().m)({environment:t,collectionContextStore:n,groupsFormatKey:r,groupFormat:o,action:"toggle_group_visibility",currentGroups:s}):function(e,t,o,n,r){const i={...t,hidden:!0},l=(0,Vo().LS)(r,i);j().createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,canUndo:!0,perform:e=>{(0,Lo().o)({collectionContextStore:o,newGroups:l,groupsFormatKey:n,transaction:e})}}),(0,x().X)({environment:e,collectionContextStore:o,action:"hide_group"})}(t,o,n,r,s)}}),void 0===p.value||!m.canEditContent||m.isSyncedCollection||"collectionTypedView"===n.contextType||m.isExternallyImportedAndSyncedCollection||u.push({key:"delete",render:e=>(0,D.jsx)(Ri().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:xi().trashIcon}),action:()=>function(e,t,o,n,r,i){xn().ui({message:(0,D.jsx)(pt().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Li(e,t,o,n,r,i)}]})}(t,n,s,o,r,d)});const g={key:"collection group",render:e=>(0,D.jsx)(Pi().A,{...e}),items:u};return g}var Di=()=>o(67657),zi=()=>o(478184),Ki=()=>o(722372),Hi=()=>o(553965);function Wi(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,y().n4)(t,n):o}function Gi(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:i,changingType:l}=(0,d().K8)((()=>({isCalculating:Wi(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),s=function(e,t){const o=(0,n.useRef)(e);return(0,n.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,i);return i?l?(0,D.jsx)(pr().A,{}):(0,D.jsx)("span",{style:{opacity:.5},children:s??r}):(0,D.jsx)(D.Fragment,{children:r})}var Ni=()=>o(509060);const Ui=(0,pt().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculatingâ€¦)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculatingâ€¦)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculatingâ€¦"}});var $i=()=>o(760217),qi=()=>o(406699),Yi=()=>o(662971);function Xi(e){let{schema:t,groupFormat:o,format:n,groupAggregationKey:r,collectionContextStore:i,disabled:l,groupsResultStore:a}=e;const c=(0,s().Y0)(),p=(0,E().X)("collection_group_reducer_visible"),m=(0,d().K8)((()=>n[r]||{aggregator:"count"}),[n,r]),g=(0,d().K8)((()=>({type:"aggregation",filter:(0,Xo().Yy)({schema:t,group:o,groupBy:i.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default}),aggregation:m})),[i,t,o,m]),S=(0,u().IS)((e=>({button:{fontWeight:Ro().Wy.medium,color:e.text.tertiary,height:24}})),[]);return(0,D.jsx)(jt().A,{renderTooltip:()=>(0,D.jsx)(ll,{schema:t,collectionContextStore:i,aggregation:m}),render:e=>(0,D.jsx)(qi().Ay,{popupType:c.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:n=>(0,D.jsx)(ur().p,{disabled:l,style:S.button,...(0,Hi().A)((0,Hi().A)(e,n),{onClick:Te().kV}),children:p?(0,D.jsx)(il,{collectionContextStore:i,schema:t,aggregation:m,groupFormat:o,groupsResultStore:a}):(0,D.jsx)(rl,{schema:t,collectionContextStore:i,groupFormat:o,aggregation:m,reducer:g})}),disabled:l,render:e=>(0,D.jsx)(nl,{aggregation:m,parent:e,collectionContextStore:i,format:n,groupAggregationKey:r,schema:t})})})}function Qi(e){let{aggregationType:t,isSelected:o,label:n,props:r}=e;const i=Ki().cx[t];return(0,D.jsx)(jt().A,{placement:De().W.Right,delayThreshold:0,render:e=>(0,D.jsx)($i().A,{title:n,isChecked:o,...(0,Hi().A)(e,r)}),renderTooltip:()=>(0,D.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,D.jsx)("img",{src:(0,zi().L)(i),style:{borderRadius:6,width:140,marginTop:4}}),Ki().fp[t]]})},r.key)}function Zi(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),j().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,Ai().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,x().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function Ji(e,t,o,n,r,i,l){const s=Ki().zY[o];return{key:o,render:t=>(0,D.jsx)(Qi,{isSelected:e,aggregationType:o,label:s,props:t}),action:()=>{Zi({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function el(e,t,o,n,r){const i=e.enforceMaxAggregationLimit??!1,l={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,D.jsx)(Ni().A,{on:i,menuListItemProps:e}),action:()=>Zi(l,t,o,n,r)}}function tl(e,t,o,n,r,i,l,s){const{device:a}=n,c=Ki().zY[t],d=y().oE(o.map((o=>function(e,t,o,n,r,i,l,s,a){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,D.jsx)(Qi,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{Zi({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,s,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,n,r,i,l,s)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,D.jsx)(Yi().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,D.jsx)($i().A,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=a.isMobile?{menuType:ji().gu.Modal,title:c,right:a.isPhone?(0,D.jsx)(_i().DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:ji().gu.Popup,width:200,...e},(0,D.jsx)(Ti().A,{...n,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,D.jsx)(Pi().A,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function ol(e,t,o,n,r,i){const l={};for(const u of Di().VD)l[u]=Ji(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const u of Di().CG)"show_unique"!==u&&(l[u]=tl(e,u,s,t,i,o,n,r));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().OC)(o)}))}(i);if(a.length>0)for(const u of Di().Sn)l[u]=tl(e,u,a,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().fo)(o)}))}(i);if(c.length>0)for(const u of Di().zE)l[u]=tl(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Di().s_)(o)}))}(i);if(d.length>0)for(const u of Di().QO)l[u]=tl(e,u,d,t,i,o,n,r);return l}function nl(e){let{aggregation:t,parent:o,collectionContextStore:n,format:r,groupAggregationKey:i,schema:l}=e;const a=(0,s().v3)(),{device:c}=a,{actions:d,initialFocus:u}=function(e,t,o,n,r,i){const{device:l}=t,s=[];let a=0,c=0;const d=ol(e,t,o,n,r,i);let u=0;return Object.entries(Di().Kn).forEach((i=>{let[p,m]=i;const g=[];for(const t of m)d[t]&&(g.push(d[t]),e.aggregator===t&&(a=u,c=g.length-1));const S=[];if("count_aggregations"===p&&S.push({key:"limitToggleSection",render:e=>(0,D.jsx)(Pi().A,{...e}),items:[el(e,t,o,n,r)]}),S.push({key:"aggregations",render:e=>(0,D.jsx)(Pi().A,{topBorder:!0,...e}),items:g}),g.length>0){u++;const e=Ki().jA[p],t={key:e,render:(t,o)=>(0,D.jsx)(Yi().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,D.jsx)($i().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=l.isMobile?{menuType:ji().gu.Modal,title:e,right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:ji().gu.Popup,width:250,...t},(0,D.jsx)(Ti().A,{...r,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:c,sections:S,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};s.push(t)}})),{actions:s,initialFocus:a}}(t,a,n,r,i,l);let p;return p=c.isMobile?{menuType:ji().gu.Modal,title:(0,D.jsx)(pt().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:o.close}:{menuType:ji().gu.Popup,width:200},(0,D.jsx)(Ti().A,{...p,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,D.jsx)(Pi().A,{...e}),items:d}],onAccept:o.close})})}function rl(e){let{schema:t,collectionContextStore:o,groupFormat:n,aggregation:r,reducer:i}=e;return i?(0,D.jsx)(bn().A,{id:`group_aggregation:${(0,Mo().Ix)(n)}`,collectionContextStore:o,reducer:i,groupsPointer:[n],render:e=>{const n=e.state;let i,l;if((0,Di().G9)(r)){const e=t[r.property];!e||"formula"!==e.type&&"number"!==e.type||(i=e.number_format),e&&"date"===e.type&&(l=e.date_format)}return(0,D.jsx)(Gi,{aggregation:r,collectionContextStore:o,children:n?(0,Ki().rv)({numberFormat:i,dateFormat:l,aggregation:r,userTimeZone:(0,Qo().P)(),value:n.aggregationResult,numberPrecision:void 0}):"â€“"})}}):null}function il(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Mo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Di().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,D.jsx)(Gi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Ki().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"â€“"})}function ll(e){let{schema:t,collectionContextStore:o,aggregation:n}=e;const r=(0,pt().tz)(),i=Ki().zY[(0,Di().V1)(n)],l=(0,d().K8)((()=>Wi(o,n)),[o,n]);if((0,Di().G9)(n)){const e=t[n.property];if(e){const t=e.name;return(0,D.jsx)(D.Fragment,{children:r.formatMessage(Ui.propertyAggregation,{aggregationType:i,propertyName:t,calculating:l})})}}return(0,D.jsx)(D.Fragment,{children:r.formatMessage(Ui.aggregationType,{aggregationType:i,calculating:l})})}var sl=()=>o(632537),al=()=>o(852302);function cl(e){const{onMount:t,isInPeekRenderer:r,style:i,paddingTop:a,disabled:c,stickyStyle:p,transitionStickyStyle:m,groupFormat:g,collectionContextStore:S,format:h,groupAggregationKey:f,stickyWrapStyle:y}=e,[v,x]=(0,n.useState)(void 0),b=(0,s().v3)(),C=(0,fe().Zp)(),w=(0,n.useRef)(null);(0,n.useEffect)((()=>{null==t||t()}),[t]),(0,n.useEffect)((()=>{const e=S.collectionViewBlockStore();e&&x(new(ae().Bv)(b,{table:K().ev,id:e.id}))}),[S,b]);const k=(0,d().K8)((()=>S.groupsStore.getGroupState(g)),[S.groupsStore,g]),I=(0,n.useMemo)((()=>{if((0,Mo().D1)(g.value)&&(0,Mo().WO)(g.value.value))return new(ae().Bv)(b,g.value.value)}),[b,g.value]),R=(0,d().K8)((()=>Boolean((null==I?void 0:I.isReady())&&!(null!=I&&I.canRead()))),[I]),T=(0,d().K8)((()=>null==k?void 0:k.toggleStateStore.state),[k]),M=(0,d().O$)(S.permissionScopesStore),P=(0,d().K8)((()=>!c&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!R),[S,c,R]),B=(0,d().O$)(S.isInHomeWidgetStore),V=(0,d().K8)((()=>void 0!==h[f]&&!(null!=C&&C.isPreviewing)),[h,f,C]),F=(0,_().Oz)(S),E=(0,d().K8)((()=>B?"transparent":(null==F?void 0:F.background)||void 0),[F,B]),O=(0,d().O$)(S.isUnlistedViewStore),z=(0,u().IS)((t=>{const o=O?t.surface.elevated:r?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===E?o:E,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:a,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!T&&{marginBottom:e.toggleClosedMarginBottom},...y}}}),[E,r,T,a,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,y,O]),H=(0,d().K8)((()=>b.WindowSizeStore.state.height),[b.WindowSizeStore]),W=(0,n.useCallback)((()=>{if(!k)return;A().IU({environment:b});const e=!T;if((0,o(294917).J)({environment:b,groupFormat:g,toggleStateStore:k.toggleStateStore,newValue:e,collectionContextStore:S}),!e){const e=w.current,t=null==e?void 0:e.parentElement;t&&l().default.afterNextFlush((()=>{(0,L().uf)({environment:b,el:t,windowHeight:H,minEdgeDist:50}),S.renderEmitter.emit()}))}}),[S,b,g,k,T,H]),G=(0,n.useCallback)((()=>(0,D.jsx)(Ln().A,{isSidebar:!1,open:T??!1,fill:!0,onClick:W,onMouseDown:Te().tr,style:{flexShrink:0}})),[W,T]),{value:N}=(0,se().fJ)(re().VI.duplicateActions),U=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=w.current;if(!(n&&n instanceof Element))return;const r=await ve().T.formulas.load();j().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:b,canUndo:!0,perform:e=>hn({environment:b,collectionContextStore:S,groupsPointer:[g],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r,duplicateActions:N})})}),[S,N,b,g]),$=(0,n.useMemo)((()=>({...p,paddingLeft:e.paddingLeft-2})),[p,e.paddingLeft]);return k&&v?(0,D.jsx)(al().g,{stickyAttachPoint:B?"no-stick":"ceiling",stickyStyle:$,transitionStickyStyle:m,nodeRef:w,children:(0,D.jsxs)("div",{style:z.topLevelDiv,ref:w,children:[(0,D.jsx)("div",{style:z.stickyWrapStyle,children:(0,D.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,D.jsxs)(lt().A,{store:v,canDropOnto:!c&&!T,onSelectableDrop:U,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[g],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[G(),(0,D.jsx)(ml,{collectionGroupHeaderProps:e}),V&&(0,D.jsx)(ul,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!c&&M.canConfigureBlock&&(0,D.jsx)(pl,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),P&&(0,D.jsx)(gl,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}const dl=n.memo(cl);function ul(e){let{disabled:t,format:o,schema:n,collectionContextStore:r,groupFormat:i,groupsResultStore:l,groupAggregationKey:s}=e;const a=(0,d().K8)((()=>r.permissionScopesStore.state.canConfigureBlock),[r]);return(0,D.jsx)(Xi,{groupsResultStore:l,groupFormat:i,disabled:t||!a,groupAggregationKey:s,format:o,schema:n,collectionContextStore:r})}function pl(e){let{groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:a,isGroupHoveredStore:c}=e;const p=(0,pt().tz)(),m=(0,s().Y0)(),g=(0,d().K8)((()=>l.groupsLimitStore),[l]),S=(0,d().O$)(c),[h,f]=(0,mi().A)(),y=(0,u().IS)((()=>({button:{transition:m.isMobile?void 0:"opacity 100ms ease-in-out",opacity:m.isMobile?void 0:S||f?1:0}})),[m.isMobile,f,S]);return(0,D.jsx)(qi().Ay,{popupType:m.isMobile?qi().z7.SlideUp:qi().z7.Popup,renderOrigin:e=>(0,D.jsx)(It().A,{ariaLabel:p.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:h,icon:gi()._,style:y.button,...e}),onClick:Te().kV,render:e=>(0,D.jsx)(Fi,{parent:e,groupFormat:t,currentGroups:o,format:n,schema:r,query:i,collectionContextStore:l,groupsFormatKey:a,groupsLimitStore:g})})}function ml(e){let{collectionGroupHeaderProps:t}=e;const o=(0,s().v3)(),{groupFormat:n,schema:r,disabled:i,currentGroups:l,groupBy:a,collectionContextStore:c}=t,u=(0,d().O$)(c.permissionScopesStore);return(0,D.jsx)(sl().A,{groupBy:a,groupFormat:n,currentGroups:l,schema:r,disabled:i||!u.canConfigureCollection||u.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(yi({...e,environment:t,collectionStore:r,...o}),(0,x().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:c})}function gl(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const n=(0,pt().tz)(),r=(0,s().Y0)(),i=(0,s().v3)(),l=(0,d().O$)(o),[a,c]=(0,mi().A)(),p=(0,u().IS)((()=>({button:{transition:r.isMobile?void 0:"opacity 100ms ease-in-out",opacity:r.isMobile?void 0:l||c?1:0}})),[r.isMobile,c,l]);return(0,D.jsx)(jt().A,{renderTooltip:()=>(0,D.jsx)(pt().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,D.jsx)(It().A,{ariaLabel:n.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:a,icon:or().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,Xe().EF)(e)&&(n.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),j().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,Zn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),jn().v(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,ke().sl)(n)}))}}))}(i,t),style:p.button,...e})})}var Sl=()=>o(700500),hl=()=>o(187899);async function fl(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:s}=e,a=l[s.property];if(!a)return;const c="relation"===a.type&&(0,Wo().zO)(a),d=c&&new(ae().md)(i,{table:Jo().Vl,id:c});d&&await d.load(),j().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups&&((0,Lo().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),hl().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})),t.newSchema&&(0,Si().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===a.type&&d){const o=(0,bt().x9d)(t.newPage.name),n=Do().Wv({environment:i,id:t.newPage.id,type:Sl().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});gt().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&C().n5({title:{text:o},environment:i,store:ae().Bv.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var yl=()=>o(9151),vl=()=>o(396671);class xl extends p().default{getInitialState(){return!1}}const bl=xl;class Cl extends p().default{getInitialState(){}}const wl=Cl;var kl=()=>o(787812);var Al=()=>o(498212),Il=()=>o(155129),jl=()=>o(141333),Rl=()=>o(970560),Tl=()=>o(150866),Ml=()=>o(725976);const _l=0;function Pl(e){let{nodeRef:t,width:o,isFirst:r,children:i,clipLeftExtra:l}=e;const s=(0,n.useMemo)(Al().Ay,[]),[a,c]=(0,n.useState)(0),[u,p]=(0,n.useState)(0),{ceiling:m,floor:g,stickyHorizontally:S}=(0,n.useContext)(Ml().m),h=(0,n.useContext)(Rl().e),f=(0,n.useContext)(Tl().j8),y=(0,n.useRef)(null),v=(0,n.useRef)(null),x=(0,n.useRef)(null),b=(0,n.useRef)(null),[C,w]=(0,n.useState)("in"),[k,A]=(0,n.useState)("in"),I=(0,n.useCallback)((e=>{for(const t of e)if(t.target===y.current||t.target===b.current){(t.target===y.current?w:A)((e=>{var o;return t.isIntersecting?"in":t.boundingClientRect.y<((null===(o=t.rootBounds)||void 0===o?void 0:o.y)||0)?"above":"below"}))}}),[y]);(0,n.useEffect)((()=>{if(!f.current||!y.current||!b.current)return;const e=new IntersectionObserver(I,{root:f.current,threshold:[0,1],rootMargin:`${-1*((null==h?void 0:h.stickyCeilingPortalsHeight)||0)}px 0px ${-1*(u+_l)}px 0px`});e.observe(y.current);const t=new IntersectionObserver(I,{root:f.current,threshold:[0,1],rootMargin:-1*(a+_l+((null==h?void 0:h.stickyCeilingPortalsHeight)||0))+"px 0px 0px 0px"});return t.observe(b.current),()=>{e.disconnect(),t.disconnect()}}),[I,null==h?void 0:h.stickyCeilingPortalsHeight,f,a,u]);const j="above"===(r&&h?h.topMarkerState:C)&&"above"!==k,R="below"!==C&&"below"===k,T=!j&&"above"===(r&&h?h.topMarkerState:C),M=!R&&"below"===k,_=(0,n.useCallback)(((e,t)=>{("ceiling"===e?c:p)((e=>e+t))}),[]),P=(0,n.useRef)([]),B=(0,n.useRef)([]),V=(0,n.useCallback)(((e,t)=>{const o="ceiling"===e?P:B;return o.current.push(t),()=>{o.current.splice(o.current.indexOf(t),1)}}),[]),F=(0,n.useMemo)((()=>({id:s,ceilingIsSticky:j,ceilingIsTransitioning:T,containerNode:t,floorIsSticky:R,floorIsTransitioning:M,topMarkerState:C,provideHeight:_,ceilingTransitionRef:v,floorTransitionRef:x,stickyCeilingPortalsHeight:a,registerPortal:V})),[s,j,T,R,t,_,C,v,x,M,a,V]),L=-1*(0,n.useContext)(Il().X),{horizontalScroller:E}=(0,n.useContext)(ye().R)||{},O=(0,d().K8)((()=>null==E?void 0:E.getStore().state.elementRef),[E]),z=(0,jl().Xg)(O??{current:null}),K=O?`${z}px`:"100%";return(0,n.useEffect)((()=>{if(!m||!g||!t.current||S)return;const e=P.current;for(let t=0;t<e.length;t++)e[t].parentElement.style.width=j?K:"initial";const o=B.current;for(let t=0;t<o.length;t++)o[t].parentElement.style.width=R?K:"initial"}),[j,m,s,R,g,t,K,S]),(0,n.useEffect)((()=>{if(!t.current||!f.current||S)return;const e=t.current.closest(`.${we().XGs}.${we().Dkd}`),o=t.current.closest(`.${we().XGs}.${we().RYy}`);if(!e||!o)return;const n=e.closest(".layout");let r=null;const i=e=>{e.target===n&&s(e)},s=function(){r||(r=requestAnimationFrame((()=>{r=null;const t=e.scrollLeft,n=e.getBoundingClientRect(),i=o.getBoundingClientRect(),s=n.x-i.x,a=t-s;if(j&&m){const e=P.current,o=void 0===l||0===l?0:l-s;for(let r=0;r<e.length;r++)e[r].style.marginLeft=-1*a+"px",e[r].style.marginRight=`${a}px`,e[r].style.clipPath=`rect(-100px ${t+n.width}px calc(100% + 100px) ${t+o}px)`,e[r].style.setProperty("--sticky-horizontal-offset",(0===o?-1*s:0)+"px")}else{const e=P.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath="",e[t].style.removeProperty("--sticky-horizontal-offset")}if(R&&g){const e=B.current;for(let o=0;o<e.length;o++)e[o].style.marginLeft=-1*a+"px",e[o].style.marginRight=`${a}px`,e[o].style.clipPath=`rect(-10px ${t+n.width}px calc(100% + 10px) ${t}px)`}else{const e=B.current;for(let t=0;t<e.length;t++)e[t].style.marginLeft="",e[t].style.marginRight="",e[t].style.clipPath=""}})))};s(),e.addEventListener("scroll",s,{passive:!0});const a=new ResizeObserver(s);return a.observe(f.current),a.observe(e),a.observe(o),null==n||n.addEventListener("transitionend",i),()=>{e.removeEventListener("scroll",s),r&&cancelAnimationFrame(r),null==n||n.removeEventListener("transitionend",i),a.disconnect()}}),[s,j,R,t,f,T,m,g,S,l,L]),(0,D.jsxs)(Rl().e.Provider,{value:F,children:[(0,D.jsx)("div",{ref:x,style:{position:"absolute",zIndex:999,width:"100%"}}),(0,D.jsx)("div",{ref:y,style:{height:_l,marginTop:-1*_l,pointerEvents:"none",width:o}}),i,(0,D.jsx)("div",{ref:b,style:{height:_l,marginTop:-1*_l,pointerEvents:"none",width:o,clear:"both",transform:`translateY(${_l}px)`}}),(0,D.jsx)("div",{ref:v,style:{position:"absolute",zIndex:999,width:"100%",transform:`translateY(-${a}px)`}})]})}const Bl=p().default.createClass(!1,{name:"IsGroupHoveredStore"});function Vl(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:i,groupsFormatKey:l,groupAggregationKey:a,groupsResultStore:c,format:p,schema:m,query:S,collectionContextStore:h,onGroupHeaderAddItem:f,renderHeader:y,getGroupStyle:v,stickyLeft:x,paddingLeft:b,isFullScreen:C,index:w,isRootChild:k,isInPeekRenderer:A,groupBy:I,isLast:j}=e;const R=(0,s().v3)(),T=(0,n.useRef)(null),M=(0,d().uB)(void 0,Bl),[_,P,B,V,F]=(0,d().K8)((()=>{const e=h.groupsStore.getGroupState(o),n=e?e.toggleStateStore:null,s=!!n&&n.state?t(o):null,d={groupFormat:o,currentGroups:r.currentGroups,disabled:i,groupsFormatKey:l,groupAggregationKey:a,groupsResultStore:c,format:p,schema:m,query:S,collectionContextStore:h,isFullScreen:C,isInPeekRenderer:A,onGroupHeaderAddItem:f,stickyLeft:x,index:w,paddingLeft:b,isRootChild:k,groupBy:I,isGroupHoveredStore:M},u=y?y(d):(0,D.jsx)(dl,{...d});return[e,n,v&&n?v({groupFormat:o,index:w,isLast:j,toggleStateStore:n,isFullScreen:C,groupsDisplayState:r}):void 0,s,u]}),[h,o,t,r,i,l,a,c,p,m,S,C,A,f,x,w,b,k,I,M,y,v,j]);(0,n.useEffect)((()=>{!function(e){const{environment:t,groupFormat:o,collectionContextStore:n}=e,r=n.collectionViewStore();if(!r)return;const i=n.groupsStore.getGroupState(o);if(!i)return;const l=g().K.get({userId:t.currentUser.id,key:(0,kl().i)(r.id,o)});i.toggleStateStore.setState(l??!0)}({environment:R,collectionContextStore:h,groupFormat:o})}),[]);const L=(0,n.useCallback)((()=>{M.setState(!0)}),[M]),E=(0,n.useCallback)((()=>{M.setState(!1)}),[M]),O=(0,u().IS)((()=>({container:{width:"100%",position:"relative",...B}})),[B]);return _&&P?(0,D.jsx)("div",{style:O.container,onMouseEnter:L,onMouseLeave:E,ref:T,children:(0,D.jsxs)(Pl,{nodeRef:T,isFirst:0===w,children:[F,V]})}):null}var Fl=()=>o(8741),Ll=()=>o(895876);const El=n.memo((function(e){const{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:l}=e,a=(0,s().v3)(),{isMobile:c}=(0,s().Y0)(),d=c?{menuType:ji().gu.Modal,title:(0,D.jsx)(pt().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:o.close}:{menuType:ji().gu.Popup,width:200},{sections:u,initialFocus:p}=(0,n.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const{device:i}=t,l=[];let s=0,a=0;const c=function(e,t,o,n,r){const i={};for(const s of Di().VD)i[s]=Hl(e.aggregator===s,e.enforceMaxAggregationLimit??!1,s,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,Di().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const s of Di().CG)"show_unique"!==s&&(i[s]=Kl(e,s,l,t,r,o,n));return Dl.forEach((l=>{let{supportCheck:s,aggregationTypes:a}=l;const c=Object.keys(r).filter((e=>{const t=r[e];return t&&s(t)}));if(c.length>0)for(const d of a)i[d]=Kl(e,d,c,t,r,o,n)})),i}(e,t,o,n,r);let d=0;return Object.entries(Di().Kn).forEach((t=>{let[n,r]=t;const u=[];for(const o of r)c[o]&&(u.push(c[o]),e.aggregator===o&&(s=d,a=u.length-1));const p=[];if("count_aggregations"===n&&p.push({key:"limitToggleSection",render:e=>(0,D.jsx)(Pi().A,{...e}),items:[zl(e,o)]}),p.push({key:"aggregations",render:e=>(0,D.jsx)(Pi().A,{topBorder:!0,...e}),items:u}),u.length>0){d++;const e=Ki().jA[n],t={key:e,render:(t,o)=>(0,D.jsx)(Yi().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,D.jsx)($i().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=i.isMobile?{menuType:ji().gu.Modal,title:e,right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:n.close,...t}:{menuType:ji().gu.Popup,width:250,...t},(0,D.jsx)(Ti().A,{...r,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:a,sections:p,onAccept:(e,t,r)=>{n.close(),o.onAccept&&o.onAccept(e,t,r)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:s}}(t,a,r,i,l);return{sections:[{key:"aggregation section",render:e=>(0,D.jsx)(Pi().A,{...e}),items:e}],initialFocus:o}}),[i,a,r,l,t]);return(0,D.jsx)(Ti().A,{...d,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:p,sections:u,onAccept:o.close})})})),Ol=n.memo((function(e){const{aggregationType:t,isSelected:o,label:r,innerProps:i}=e,l=Ki().cx[t],s=(0,u().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),a=(0,n.useCallback)((e=>(0,D.jsx)($i().A,{title:r,isChecked:o,...(0,Hi().A)(e,i)})),[o,i,r]),c=(0,n.useCallback)((()=>(0,D.jsxs)("div",{style:s.container,children:[l&&(0,D.jsx)("img",{src:(0,zi().L)(l),style:s.image}),Ki().fp[t]]})),[l,s.container,s.image,t]);return(0,D.jsx)(jt().A,{placement:De().W.Right,delayThreshold:0,render:a,renderTooltip:c})}));const Dl=[{supportCheck:Di().OC,aggregationTypes:Di().Sn},{supportCheck:Di().fo,aggregationTypes:Di().zE},{supportCheck:Di().s_,aggregationTypes:Di().QO}];function zl(e,t){const o=e.enforceMaxAggregationLimit??!1,n={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,D.jsx)(Ni().A,{on:o,menuListItemProps:e}),action:()=>{t(n)}}}function Kl(e,t,o,n,r,i,l){const{device:s}=n,a=Ki().zY[t],c=y().oE(o.map((o=>function(e,t,o,n,r,i,l,s){const a=r[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,D.jsx)(Ol,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{Wl({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,e.enforceMaxAggregationLimit??!1,r,i,l,n)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,D.jsx)(Yi().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,D.jsx)($i().A,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=s.isMobile?{menuType:ji().gu.Modal,title:a,right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:ji().gu.Popup,width:200,...e},(0,D.jsx)(Ti().A,{...n,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,D.jsx)(Pi().A,{...e}),items:c}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function Hl(e,t,o,n,r,i){const l=Ki().zY[o];return{key:o,render:t=>(0,D.jsx)(Ol,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{Wl({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function Wl(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,x().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const Gl=n.memo((function(e){const{aggregation:t,schema:o,groupFormat:r,groupsResultStore:i,collectionContextStore:l,disabled:a,color:c,onChange:d}=e,{isMobile:p}=(0,s().Y0)(),m=(0,E().X)("collection_group_reducer_visible"),g=(0,u().IS)((e=>({button:{fontWeight:Ro().Wy.regular,color:c||e.text.tertiary,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}})),[c]),S=(0,n.useCallback)((()=>(0,D.jsx)(Nl,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),h=(0,n.useCallback)((e=>(0,D.jsx)(qi().Ay,{popupType:p?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:n=>(0,D.jsx)(ur().p,{disabled:a,style:g.button,...(0,Hi().A)(e,n),children:m?(0,D.jsx)($l,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r,groupsResultStore:i}):(0,D.jsx)(Ul,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:r})}),disabled:a,render:e=>(0,D.jsx)(El,{parent:e,selectedAggregation:t,onChange:d,collectionContextStore:l,schema:o})})),[p,a,g.button,m,o,t,l,r,i,d]);return(0,D.jsx)(jt().A,{renderTooltip:S,render:h})}));function Nl(e){let{aggregation:t,schema:o,collectionContextStore:n}=e;const r=(0,d().K8)((()=>!!Boolean(t)&&Wi(n,t)),[n,t]);if(t){const e=Ki().zY[(0,Di().V1)(t)];if((0,Di().G9)(t)){const n=o[t.property];if(n){const t=n.name;return(0,D.jsx)(D.Fragment,{children:vt().A.formatMessage(Ui.propertyAggregation,{aggregationType:e,propertyName:t,calculating:r})})}}return(0,D.jsx)(D.Fragment,{children:vt().A.formatMessage(Ui.aggregationType,{aggregationType:e,calculating:r})})}return(0,D.jsx)(pt().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function Ul(e){const{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e,l=(0,d().K8)((()=>({type:"aggregation",filter:(0,Xo().Yy)({schema:t,group:i,groupBy:r.getGroupByAndGroupFormats().groupBy,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default}),aggregation:o})),[r,o,t,i]),{numberFormat:s,numberPrecision:a}=(0,n.useMemo)((()=>{if(!(0,Di().G9)(o))return{};const e=t[o.property];if(e&&("formula"===e.type||"number"===e.type)){const t=e.number_format,n=e.number_precision;return{numberFormat:t,numberPrecision:(0,Di().FM)(o)?n:void 0}}return{}}),[o,t]),c=(0,n.useMemo)((()=>{if(!(0,Di().G9)(o))return;const e=t[o.property];return e&&"date"===e.type?e.date_format:void 0}),[o,t]),u=(0,n.useCallback)((e=>{const t=e.state;return(0,D.jsx)(Gi,{aggregation:o,collectionContextStore:r,children:t?(0,Ki().rv)({numberFormat:s,dateFormat:c,aggregation:o,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:a}):"-"})}),[o,r,c,s,a]);return l?(0,D.jsx)(bn().A,{id:`board:${(0,Mo().Ix)(i)}`,collectionContextStore:r,reducer:l,groupsPointer:[i],render:u}):null}function $l(e){const t=(0,d().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o||"v2"!==o.version)return;const n=(0,Mo().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,Di().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,D.jsx)(Gi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,Ki().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,Qo().P)(),value:t.aggregationResult,numberPrecision:void 0}):"â€“"})}function ql(e){return(0,_().rq)(e.board_cover_size)}const Yl=function(e){const{hoveredGroupStore:t,groupFormat:o,schema:r,format:i,groupsResultStore:l,collectionContextStore:a,disabled:c,hidden:p,isPopup:m,isInPeekRenderer:g,query:S,currentGroups:h,isFullScreen:f}=e,y=(0,u().DP)(),v=(0,s().v3)(),x=(0,pt().tz)(),b=(0,fe().Zp)(),C=(0,d().K8)((()=>!!v.device.isMobile||(0,Mo().Mn)(t.state,o)),[v,t,o]),w=(0,d().K8)((()=>(0,Vo().$e)({environment:v,groupFormat:o,schema:r,format:i,theme:y})),[o,r,i,v,y]),k=(0,d().O$)(a.permissionScopesStore),A=(0,n.useMemo)((()=>{if((0,Mo().D1)(o.value)&&(0,Mo().WO)(o.value.value))return new(ae().Bv)(v,o.value.value)}),[v,o.value]),I=(0,d().K8)((()=>Boolean((null==A?void 0:A.isReady())&&!(null!=A&&A.canRead()))),[A]),j=(0,d().K8)((()=>a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!I),[a,I]),R=(0,d().K8)((()=>(0,_().fG)({collectionContextStore:a,environment:v,intl:x})),[a,v,x]),T=(0,d().K8)((()=>{const e=a.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==b||!b.isPreviewing)&&(S.aggregations&&S.aggregations.length>0)}),[a,S,b]),M=(0,d().K8)((()=>function(e,t,o,n,r,i){const{device:l}=e,s=ql(o),a=Boolean(o.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:s,paddingLeft:$s,paddingRight:$s,marginRight:2*Ns,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...n&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:s},...i&&!t&&{backgroundColor:i.backgroundColor,...a?{borderRadius:Us}:{borderTopLeftRadius:Us,borderTopRightRadius:Us}}}}(v,p,i,m,0,w)),[v,p,i,m,g,w]);return(0,D.jsxs)("div",{style:M,onMouseMove:()=>function(e,t){e.state!==t&&e.setState(t)}(t,o),children:[(0,D.jsx)(Ql,{boardGroupHeaderProps:e}),T&&(0,D.jsx)(ts,{groupsResultStore:l,disabled:c,query:S,schema:r,collectionContextStore:a,groupFormat:o,hidden:p,boardSelectStyle:w}),(0,D.jsx)("div",{style:{flexGrow:1}}),!c&&k.canConfigureBlock&&(0,D.jsx)(os,{hidden:p,groupFormat:o,currentGroups:h,format:i,schema:r,query:S,collectionContextStore:a,boardSelectStyle:w,isHovered:C}),j&&(0,D.jsx)(ns,{format:i,groupFormat:o,collectionContextStore:a,isFullScreen:f,hidden:p,isHovered:C,boardSelectStyle:w}),R&&(0,D.jsx)(rs,{groupFormat:o,collectionContextStore:a,hidden:p,isHovered:C,boardSelectStyle:w})]})};function Xl(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=s.boardColumnsLimitStore;return(0,D.jsx)(Fi,{parent:t,groupFormat:o,currentGroups:n,format:r,query:l,schema:i,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:a})}function Ql(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:n,disabled:r,currentGroups:i,format:l,groupBy:a,collectionContextStore:c}=t,u=(0,s().v3)(),p=ql(l),m=(0,d().O$)(c.permissionScopesStore);return(0,d().K8)((()=>c.groupsStore.getGroupState(o)),[c,o])?(0,D.jsx)(sl().A,{groupBy:a,groupFormat:o,currentGroups:i,schema:n,disabled:r||!m.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(yi({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:r,...o}),(0,x().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(e,u,t),style:{maxWidth:p-70},collectionContextStore:c}):null}function Zl(e,t,o){return!t&&o?o.textColor:e.text.tertiary}function Jl(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t?1:0}}function es(e,t,o,n,r,i){const{device:l}=e;if(!(0,Xe().EF)(e))return;const s="collectionTypedView"===n.contextType,a=Boolean(t.collection_group_by);n.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r});const c=n.groupsStore.getGroupState(o);if(!c)return;const d=c.resultsStore;j().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:t=>{const r=(0,Zn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:t,from:{createBlock:"board_group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(!r)return;const c=r.coercionSucceeded,u=r.newStore;if(l.isMobile){!function(e,t,o){o?o(e):vr().oo({environment:t,url:e})}((0,Ar().Ay)({store:u,pageVisitSource:To().y8.Create}),e,i)}else if(c&&!a){const t=u.getBlockTitleStore();A().hc({environment:e,store:u}),I().setSelectionAtEnd({store:t}),(0,Jn().C)({store:u})}else Ko().VU({environment:e,store:u,peekMode:(0,_().hH)(n),showMoveTo:s,resultsStore:d,collectionContextStore:n,pageVisitSource:To().y8.Create});jn().v(e,{from:"board_group_add_item_top",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,ke().sl)(n)})}})}function ts(e){let{disabled:t,query:o,schema:n,collectionContextStore:r,groupFormat:i,hidden:l,boardSelectStyle:a,groupsResultStore:c}=e;const p=(0,u().DP)(),m=(0,s().v3)(),g=o.aggregations?o.aggregations[0]:void 0,S=(0,d().O$)(r.permissionScopesStore);if(!g)return null;const h=Zl(p,l,a);return(0,D.jsx)(Gl,{groupFormat:i,groupsResultStore:c,disabled:t||!S.canConfigureBlock,aggregation:g,schema:n,collectionContextStore:r,color:h,onChange:e=>function(e,t,o,n){const r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&j().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,Ai().F)({collectionViewStore:r,update:{query2:i},transaction:e})}})}(e,r,o,m)})}function os(e){let{hidden:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a,boardSelectStyle:c,isHovered:d}=e;const p=(0,u().DP)(),m=(0,s().v3)(),g=(0,pt().tz)(),{device:S}=m,h=Zl(p,t,c),f=Jl(t,d);return(0,D.jsx)(qi().Ay,{popupType:S.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:e=>(0,D.jsx)(It().A,{icon:Lr().Y,iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:h},style:f,ariaLabel:g.formatMessage({defaultMessage:"More group options",id:"database.boardGroupHeader.actions.moreGroupOptions.tooltip"}),...e}),render:e=>(0,D.jsx)(Xl,{parent:e,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:a})})}function ns(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,hidden:l,isHovered:a,boardSelectStyle:c}=e;const p=(0,u().DP)(),m=(0,s().v3)(),g=(0,pt().tz)(),S=(0,n.useContext)(ri().n),h=(0,n.useCallback)((()=>es(m,t,o,r,i,S)),[m,t,o,r,i,S]),f=(0,d().K8)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),y=Zl(p,l,c),v=Jl(l,a),x=(0,Ll().$O)(f),b=g.formatMessage({defaultMessage:"Create new {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:x});return(0,D.jsx)(jt().A,{renderTooltip:()=>b,render:e=>(0,D.jsx)(It().A,{icon:or().plusSmallIcon,onClick:h,style:v,iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:y},ariaLabel:b,...e})})}function rs(e){let{groupFormat:t,collectionContextStore:o,hidden:r,isHovered:i,boardSelectStyle:l}=e;const s=(0,u().DP)(),a=(0,pt().tz)(),c=(0,d().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),p=(0,n.useMemo)((()=>{const e=(0,Ll().$O)(c);return a.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:e})}),[c,a]),m=(0,n.useCallback)((()=>p),[p]),g=(0,n.useCallback)(((e,t)=>{const o=Zl(s,r,l),n=Jl(r,i);return(0,D.jsx)(It().A,{icon:Fl().arrowDiagonalUpRightSmallIcon,style:n,iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:o},...e,...t,ariaLabel:p})}),[l,r,i,p,s]);return(0,D.jsx)(Sr().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,D.jsx)(jt().A,{renderTooltip:m,render:t=>g(t,e)})})}var is=()=>o(668725);const ls=30,ss=4,as=10;function cs(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,d().O$)(t);return(0,D.jsx)(ur().p,{onClick:function(){t.setState(!t.state)},onMouseDown:Te().tr,style:{height:ls,marginBottom:ss,...e.style},icon:e=>(0,is().b)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,D.jsx)(pt().sA,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function ds(e){const t=(0,d().K8)((()=>e.columnsDisplayState.visibleGroups.length*(ql(e.format)+2*$s+2*Ns)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,D.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,D.jsx)(cs,{...e})})}const us=30,ps=4,ms=n.memo((function(e){let{type:t,groupsDisplayState:o,groupsLimitStore:n,schema:r,collectionContextStore:i,style:l}=e;const a=(0,s().v3)(),c=(0,u().DP)(),p=(0,d().O$)(i.normalizedFormatStore),m=(0,d().K8)((()=>(0,Qn().Mw)({collectionContextStore:i,isForColumnGroups:"board"===t})),[i,t]),g=(0,d().K8)((()=>"board"===t?(0,Vo().$e)({environment:a,groupFormat:void 0,schema:r,format:p,theme:c}):void 0),[a,p,r,c,t]),S="v2"===o.version?void 0:Math.min(Vo().B2,o.total-o.hiddenGroups.length-o.visibleGroups.length),h=(0,u().IS)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.text.secondary,marginLeft:void 0===S?8:4,marginTop:1,..."default"===t?{marginRight:8}:{}},button:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2,paddingRight:8,color:e.text.secondary,fontWeight:Ro().Wy.medium,..."board"===t?{background:null==g?void 0:g.backgroundColor,paddingLeft:8,height:"100%",marginRight:2*Ns,borderRadius:Us,width:void 0===S?"fit-content":90,...l}:{paddingLeft:2,borderRadius:4,height:us,marginTop:ps,marginBottom:ps}}})),[null==g?void 0:g.backgroundColor,S,l,t]);return"default"===t?(0,D.jsxs)(ur().p,{onClick:()=>function(e,t,o){o.setState(o.state+Vo().B2),t.loadingDetailsStore.setState({type:"load_more_groups"}),gs(e)}(a,i,n),onMouseDown:Te().tr,disabled:m,hoveredStyle:m?h.hovered:{},style:{...h.button,...l},children:[(0,gi()._)(h.dots),void 0===S?(0,D.jsx)(pt().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more groups"}):(0,D.jsx)(pt().sA,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:S}}),m&&(0,D.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,D.jsx)(pr().A,{size:"sm"})})]}):(0,D.jsxs)(ur().p,{onClick:()=>function(e,t,o){o.setState(o.state+Vo().B2),t.loadingDetailsStore.setState({type:"load_more_columns"}),gs(e)}(a,i,n),onMouseDown:Te().tr,disabled:m,hoveredStyle:m?h.hovered:{},style:h.button,children:[(0,D.jsx)("span",{style:{flexGrow:1},children:void 0===S?(0,D.jsx)(pt().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"More"}):(0,D.jsx)(pt().sA,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:S}})}),m?(0,D.jsx)("div",{style:{marginLeft:4},children:(0,D.jsx)(pr().A,{size:"sm"})}):(0,gi()._)(h.dots)]})}),No().A);function gs(e){xe().vd(e,"collection_load_more_groups")}function Ss(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,s().v3)(),l=(0,d().K8)((()=>(0,xo().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),a=(0,d().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),c=(0,d().K8)((()=>(0,xo().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?xo().HV:n),[i,t,o,r,n]);return l||a?null:(0,D.jsx)("div",{style:{width:"100%",height:ia+sa+la,display:"flex"},children:(0,D.jsx)(ca,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?c:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function hs(e){const{format:t,isFullScreen:o,isRootChild:n,paddingLeft:r,hiddenGroups:i,hiddenGroupsVisibleStore:l,style:a}=e,c=(0,s().v3)(),u=(0,d().K8)((()=>(0,xo().iw)({environment:c,format:t,isFullScreen:o,isRootChild:n})),[c,t,o,n]),p=(0,d().K8)((()=>(0,xo().Od)({environment:c,isRootChild:n,isFullScreen:o,format:t})?xo().HV:r),[c,t,o,n,r]);return u?null:(0,D.jsx)("div",{style:{width:"100%",height:ls+ss+as,display:"flex"},children:(0,D.jsx)(cs,{hiddenGroupsVisibleStore:l,hiddenGroups:i,style:{position:"sticky",left:o?p:3,width:"max-content",paddingLeft:4,paddingRight:8,...a}})})}function fs(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,s().v3)(),i=(0,d().K8)((()=>(0,xo().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,d().K8)((()=>(0,xo().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?xo().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,D.jsx)("div",{style:{width:"100%",height:us+2*ps,display:"flex"},children:(0,D.jsx)(ms,{type:"default",groupsDisplayState:e.groupsDisplayState,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var ys=()=>o(864943);const vs=n.memo((function(e){const{title:t,icon:n,onClick:r,className:i}=e,{isPhone:l}=(0,s().Y0)();(0,o(388487).A)({capture:!0,preventType:Co().A.X});const a=(0,u().IS)((e=>({wrapper:{display:"flex",alignItems:"center",justifyContent:"center",height:144},phoneButton:{fontSize:16,color:e.text.tertiary,height:l?36:void 0},phoneIcon:{width:18,height:18,fill:e.icon.tertiary},iconStyle:{width:16,height:16}})),[l]);return(0,D.jsx)("div",{style:a.wrapper,className:i,children:l?(0,D.jsx)(ys().A,{onClick:r,size:"lg",style:a.phoneButton,icon:n,iconStyle:a.phoneIcon,children:t}):(0,D.jsx)(ur().p,{onClick:r,isLightGray:!0,icon:n,iconStyle:a.iconStyle,children:t})})})),xs=(0,Io().wt)("collectionGroupAccordion",{svg:(0,D.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});function bs(e){const{width:t}=e,o=(0,s().v3)(),n=(0,d().K8)((()=>o.WindowSizeStore.state.width<=Ds),[o]),r=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,n]);return(0,D.jsxs)("div",{style:r.container,children:[(0,D.jsxs)("div",{style:r.groupContainer,children:[(0,D.jsx)("div",{style:r.iconContainer,children:xs(r.icon)}),(0,D.jsx)(eo().A,{style:r.groupShimmer})]}),(0,D.jsxs)("div",{style:r.itemsContainer,children:[(0,D.jsx)(di,{}),(0,D.jsx)(di,{}),(0,D.jsx)(di,{})]})]})}function Cs(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,_().rq)(o),i=y().Hn(n,(e=>(0,D.jsx)(bs,{width:r},e)));return(0,D.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function ws(){const e=(0,u().IS)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,D.jsxs)("div",{style:e.container,children:[(0,D.jsxs)("div",{style:e.groupContainer,children:[(0,D.jsx)("div",{style:e.iconContainer,children:xs(e.icon)}),(0,D.jsx)(eo().A,{style:e.groupShimmer})]}),(0,D.jsxs)("div",{style:e.rowsContainer,children:[(0,D.jsxs)("div",{style:e.rowContainer,children:[(0,D.jsxs)("div",{style:e.firstColumn,children:[(0,D.jsx)(eo().A,{style:e.circleShimmer}),(0,D.jsx)(eo().A,{style:e.rowShimmerShort})]}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmerShort})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmerShort})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmerShort})})]}),(0,D.jsxs)("div",{style:e.rowContainer,children:[(0,D.jsxs)("div",{style:e.firstColumn,children:[(0,D.jsx)(eo().A,{style:e.circleShimmer}),(0,D.jsx)(eo().A,{style:e.rowShimmerLong})]}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})})]}),(0,D.jsxs)("div",{style:e.lastRowContainer,children:[(0,D.jsxs)("div",{style:e.firstColumn,children:[(0,D.jsx)(eo().A,{style:e.circleShimmer}),(0,D.jsx)(eo().A,{style:e.rowShimmerLong})]}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})}),(0,D.jsx)("div",{style:e.column,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})})]})]})]})}function ks(e){const{isFullScreen:t}=e,o=t?2:1,n=y().Hn(o,(e=>(0,D.jsx)(ws,{},e)));return(0,D.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function As(){const e=(0,u().IS)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,D.jsxs)("div",{style:e.rowsContainer,children:[(0,D.jsx)("div",{style:e.rowContainer,children:(0,D.jsx)(eo().A,{style:e.rowShimmerShort})}),(0,D.jsx)("div",{style:e.rowContainer,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})})]})}var Is=()=>o(812119);function js(){const e=(0,u().IS)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=(0,te().Ks)(),o=(0,d().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,D.jsx)(Is().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,D.jsxs)("div",{style:e.container,children:[(0,D.jsxs)("div",{style:e.groupContainer,children:[(0,D.jsx)("div",{style:e.iconContainer,children:xs(e.icon)}),(0,D.jsx)(eo().A,{style:e.groupShimmer})]}),(0,D.jsx)("div",{style:e.rowsContainer,children:n})]})}function Rs(e){const{isFullScreen:t}=e,o=t?2:1,n=y().Hn(o,(e=>(0,D.jsx)(js,{},e)));return(0,D.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function Ts(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,Jr().A)(!0,0,100))return null;switch(t){case"table":return(0,D.jsx)(ks,{isFullScreen:o});case"list":return(0,D.jsx)(Rs,{isFullScreen:o});case"gallery":return(0,D.jsx)(Cs,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,D.jsx)(As,{});default:return null}}const Ms=new Set(["dropzone","table"]),_s=new Set(["item","table"]),Ps=n.memo((function(e){const{onClickEmptyStateButton:t,collectionContextStore:r,timelineProps:i}=e,l=(0,s().v3)(),a=(0,s().Y0)().isMobile,c=(0,E().X)("collection_group_reducer_visible"),u=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),p=(0,d().O$)(r.permissionScopesStore),m=(0,d().O$)(r.normalizedFormatStore),g=null==m?void 0:m.collection_group_by,S=null==m?void 0:m.board_columns_by,h=(0,d().O$)(r.groupsLimitStore),f=(0,d().O$)(r.normalizedSchemaStore),v=(0,d().K8)((()=>r.normalizedQueryStore.state??{}),[r.normalizedQueryStore]),x=(0,d().K8)((()=>{if(c&&"board"===u&&g&&S)return;if(!g||!m)return;if(null!=i&&i.type&&Ms.has(null==i?void 0:i.type))return;const e=(0,yl().m)({collectionContextStore:r,isMobile:a,groupBy:g});return(0,yl().p)({groupBy:g,schema:f,format:m,groupsFormatKey:Mo().V1,limit:h,aggregation:m.collection_group_aggregation,blockResults:e})}),[c,u,g,S,m,null==i?void 0:i.type,r,a,f,h]),b=(0,d().uB)(e.groupsResultStore,wl),C=(0,d().O$)(b),w=(0,d().uB)(null==i?void 0:i.hiddenGroupsVisibleStore,bl),k=(0,d().O$)(w),[A,I]=(0,vl().d)({collectionContextStore:r,groupBy:g,groupsFormatKey:Mo().V1,reducerResult:C,groupsLimit:h}),[j]=(0,vl().d)({collectionContextStore:r,groupBy:S,groupsFormatKey:"board_columns",reducerResult:C,groupsLimit:h}),[R]=(0,vl().d)({collectionContextStore:r,groupBy:"board"===u?void 0:g,subGroupBy:"board"===u?g:void 0,groupsFormatKey:Mo().V1,reducerResult:C,groupsLimit:h}),T=c?R:A,M=n.useCallback((()=>{Eo({environment:l,groupsFormatKey:Mo().V1,collectionContextStore:r,currentGroups:I.state.currentGroups})}),[r,l,I]),P=(0,fr().U)(M,5e3);(0,n.useEffect)((()=>{if(null==i||!i.type||!Ms.has(null==i?void 0:i.type))return I.addListener(P),()=>{I.removeListener(P),P.cancel()}}),[I,P,i]);const B=(0,d().K8)((()=>I.state.hiddenGroups.slice(0,Vo().RP)),[I]),V=(0,d().K8)((()=>!((null==i?void 0:i.type)&&_s.has(null==i?void 0:i.type))&&(0,Qn().c_)({collectionContextStore:r,displayState:T})),[r,T,i]),F=(0,d().K8)((()=>{const{visibleGroups:e}=T;return 0===e.length&&!r.shouldShowSpinnerStore.state||e.length>0}),[r,T]),L=(0,d().K8)((()=>(0,Vo().Zl)(T,e.collectionContextStore,!1)),[T,e.collectionContextStore]),O=(0,d().K8)((()=>!e.disabled&&!p.isLocked&&p.canConfigureBlock&&!V&&g&&(0,Mo().pP)(g,p.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,o(443239).u)(g.property)&&F),[F,r,p.canConfigureBlock,p.canConfigureCollection,p.isLocked,e.disabled,g,V]),z=(0,d().K8)((()=>Fo().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),K=u?(0,_().JK)(u):void 0,H=(0,E().X)("db_ux_empty_states");if(!m)return null;const W="board"!==u&&"timeline"!==u&&H&&!V&&"v2"===T.version&&0===T.visibleGroups.length&&0===T.pinnedGroups.groups.length?(0,D.jsx)(vs,{className:K,onClick:t??y().D_,icon:_o().e,title:(0,D.jsx)(pt().sA,{id:"board.emptyState.button",defaultMessage:"All groups are hidden"})}):(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)(Bs,{groups:T.visibleGroups,groupBy:g,groupsDisplayState:T,groupsResultStore:b,format:m,schema:f,query:v,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem}),V&&(0,D.jsx)(Ts,{viewType:u,isFullScreen:e.isFullScreen,galleryCoverSize:m.gallery_cover_size}),L&&(0,D.jsx)(Vs,{timelineType:null==i?void 0:i.type,collectionContextStore:e.collectionContextStore,schema:f,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),B.length>0&&!c&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Ls,{reducerId:e.reducerId,timelineType:null==i?void 0:i.type,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:j,hiddenGroups:B,hiddenGroupsVisibleStore:w}),k&&(0,D.jsx)(Bs,{groups:B,groupBy:g,groupsDisplayState:T,groupsResultStore:b,format:m,schema:f,query:v,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderHeader:e.renderHeader,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,onGroupHeaderAddItem:e.onGroupHeaderAddItem})]}),O&&!c&&(0,D.jsx)(Fs,{timelineType:null==i?void 0:i.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:f,format:m,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:g})]});return x?(0,D.jsx)(bn().A,{id:e.reducerId,reducer:x,collectionContextStore:e.collectionContextStore,resultStore:b,render:()=>W,debounceWait:z}):W}),No().A),Bs=n.memo((function(e){const{groups:t,groupBy:o,groupsDisplayState:n,groupsResultStore:r,format:i,schema:l,query:s,collectionContextStore:a,disabled:c,isFullScreen:u,isRootChild:p,paddingLeft:m,stickyLeft:g,renderGroup:S,getGroupStyle:h,renderHeader:f,onGroupHeaderAddItem:y}=e,v=(0,d().O$)(a.isInPeekRendererStore),x=a.groupsStore.getGroupState;return(0,D.jsx)(D.Fragment,{children:t.map(((e,d)=>x&&o?(0,D.jsx)(Vl,{collectionContextStore:a,groupsDisplayState:n,groupFormat:e,groupBy:o,groupsResultStore:r,disabled:c,groupsFormatKey:Mo().V1,groupAggregationKey:Mo().FJ,format:i,schema:l,query:s,isInPeekRenderer:v,isFullScreen:u,isRootChild:p,paddingLeft:m,stickyLeft:g,renderGroup:S,renderHeader:f,onGroupHeaderAddItem:y,getGroupStyle:h,index:d,isLast:d===t.length-1},(0,Mo().Ix)(e)):null))})}));function Vs(e){return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,D.jsx)(fs,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,D.jsx)("div",{style:{display:"flex"},children:(0,D.jsx)(ms,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:e.collectionContextStore.groupsLimitStore,groupsDisplayState:e.groupsDisplayState,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function Fs(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=n.useCallback(((e,t,o,n,r)=>{const i=o.collectionStore();i&&fl({update:e,collectionContextStore:o,groupsFormatKey:Mo().V1,collectionStore:i,environment:t,groupBy:n,schema:r})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,D.jsx)(Ss,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,D.jsx)(ca,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function Ls(e){return"board_collection_groups"===e.reducerId?(0,D.jsx)(ds,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,D.jsx)(hs,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,style:{marginTop:as}}):(0,D.jsx)("div",{style:{display:"flex"},children:(0,D.jsx)(cs,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:as,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}const Es=n.memo((function(e){const{collectionContextStore:t,store:o,format:r,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,paddingLeft:d,isRootChild:p,headerWidth:m,collectionGalleryViewStore:g}=e,S=(0,E().X)("db_ux_chrome"),h=(0,u().DP)(),f=(0,s().v3)(),{isMobile:y}=(0,s().Y0)(),v=(0,n.useCallback)((e=>(0,D.jsx)(Os,{args:e})),[]),x=(0,n.useCallback)((e=>{if(y)zo().uK({environment:f,store:e,pageVisitSource:To().y8.Create});else{const o="collectionTypedView"===t.contextType;Ko().VU({environment:f,store:e,peekMode:_().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:To().y8.Create})}}),[t,f,y]),C=(0,n.useCallback)((e=>(0,D.jsx)(pi,{store:o,format:r,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,collectionGalleryViewStore:g,groupFormat:e,headerWidth:m})),[o,r,i,t,l,a,c,g,m]),w=(0,n.useCallback)((e=>S||0===e.index?{}:{borderTop:`1px solid ${h.tableDividerColor}`}),[S,h.tableDividerColor]),k=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[t]);return(0,D.jsx)(Ps,{reducerId:"gallery_groups",store:o,collectionContextStore:t,disabled:i,isFullScreen:c,isRootChild:p,paddingLeft:d,stickyLeft:!1,renderHeader:v,onGroupHeaderAddItem:x,renderGroup:C,getGroupStyle:w,onClickEmptyStateButton:k})}));function Os(e){let{args:t}=e;const o=(0,d().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,D.jsx)(dl,{...t,height:o?ft().ag:48,stickyStyle:n})}const Ds=480,zs=40;function Ks(e){const{store:t,format:o,collectionContextStore:r,isFullScreen:i,isPreviewing:l,isRootChild:a,blockPropertyValueOverlayStore:c,disabled:p,schema:m,paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f,headerWidth:y}=e,v=(0,s().v3)(),{isMobile:x}=(0,s().Y0)(),b=(0,n.useRef)(null),C=(0,d().uB)(void 0,oi);(0,d().O$)(C);const{coverWidth:w,coverHeight:k}=(0,d().O$)(C),A=(0,d().K8)((()=>_().mM(r,i)),[r,i]),I=(0,d().O$)(r.isInHomeWidgetStore),j=(0,d().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),R=(0,n.useCallback)((()=>{if(b.current){const e=b.current.getNode();if(e){const t=e.querySelector(`.${we().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return _().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),T=(0,n.useCallback)((e=>{C.setState({coverHeight:k,coverWidth:e||R()})}),[C,k,R]),M=(0,n.useCallback)((()=>R()*(9/16)),[R]),P=(0,n.useCallback)((e=>{C.setState({coverWidth:w,coverHeight:e||M()})}),[C,w,M]),B=(0,n.useCallback)((e=>{var t;const o=r.isLoadingStore.state,n=null===(t=r.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<Ke().A.incrementScrollOffset&&n&&!o&&null!=n&&n.hasMore&&(0,$o().H)({collectionContextStore:r,environment:v,incrementLimitArgs:{isFullScreen:i,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[r,v,i]),V=(0,n.useCallback)((()=>{const e=M(),t=R();k!==e&&P(e),w!==t&&T(t)}),[M,R,k,w,P,T]),F=(0,fr().Y)(V,100),L=(0,yr().d)(V,100);(0,n.useEffect)((()=>{T(R()),P()}),[R,P,T,null==o?void 0:o.gallery_cover_size]),(0,n.useEffect)((()=>((0,Re().P4)(window,"resize",L),x&&(0,Re().P4)(window,"orientationchange",F),()=>{(0,Re().Ol)(window,"resize",L),x&&(0,Re().Ol)(window,"orientationchange",F)})),[F,L,x]);const E=(0,u().IS)((()=>({container:{paddingBottom:g,paddingLeft:S,paddingRight:h,minWidth:f}})),[f,g,S,h]),O=o.collection_group_by,z=(0,fe().Zp)();return(0,ei().A)((e=>(0,D.jsxs)("div",{style:E.container,className:we().wx0,children:[(0,D.jsx)(lt().A,{store:t,shouldShowHalo:!i&&!I&&!l,canSelect:!i&&!j,disablePointerEvents:null==z?void 0:z.disableAllPointerEvents,analyticsName:"gallery",...e,ref:b,children:O?(0,D.jsx)(Es,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,isFullScreen:i,isRootChild:a,paddingLeft:S,headerWidth:y-2*S,schema:m,store:t}):(0,D.jsx)(pi,{blockPropertyValueOverlayStore:c,collectionContextStore:r,collectionGalleryViewStore:C,disabled:p,format:o,groupFormat:void 0,isFullScreen:i,headerWidth:y-2*S,schema:m,store:t})}),!A&&(0,D.jsx)(Xn().A,{onChange:B})]})))}const Hs=n.memo(Ks);function Ws(e){const t=e.minHeight||zs,o=(0,u().IS)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:Us,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,D.jsx)(eo().A,{style:o.card})}function Gs(){return(0,Jr().A)(!0,0,100)?(0,D.jsx)(Ws,{}):null}const Ns=5,Us=10,$s=7,qs=$s+32;function Ys(e,t){return t?0:e?8:12}const Xs=function(e){let{groupsPointer:t,schema:o,format:n,collectionContextStore:r,store:i,disabled:l,blockPropertyValueOverlayStore:a,isFullScreen:c,anyGroupHasResults:p,isInPeekRenderer:m,hoveredGroupStore:g}=e;const S=(0,u().DP)(),h=(0,s().v3)(),f=(0,pt().tz)(),{isMobile:v}=(0,s().Y0)(),x=(0,d().K8)((()=>{const e=y().HV(t);return(0,Vo().$e)({environment:h,groupFormat:e,schema:o,format:n,theme:S})}),[t,o,n,h,S]),b=(0,d().K8)((()=>{const e=r.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,r]),C=(0,d().K8)((()=>r.groupsStore.getGroupState(t)),[r,t]),w=(0,d().K8)((()=>(0,_().mM)(r,c)),[r,c]),A=(0,d().K8)((()=>null==C?void 0:C.reducerResultStore.state),[C]),I=(0,d().O$)(r.permissionScopesStore),R=(0,d().O$)(r.isInHomeWidgetStore),T=(0,d().K8)((()=>!l&&b&&r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!R})),[l,b,r,R]),M=(0,d().K8)((()=>(0,_().XQ)({reducerResult:A,collectionContextStore:r,isFullScreen:c})),[A,r,c]),P=(0,d().K8)((()=>(0,Qn().iv)({collectionContextStore:r,groupsPointer:t,hasPartialResults:p})),[r,t,p]),B=(0,d().K8)((()=>p&&r.shouldShowSpinnerStore.state&&"load_general"===r.loadingDetailsStore.state.type),[r,p]),V=(0,d().K8)((()=>(0,_().fG)({collectionContextStore:r,environment:h,intl:f})),[h,r,f]),F=(0,d().K8)((()=>h.device.isMobile||(0,Mo().Mn)(g.state,y().HV(t))),[g,t,h]),L=(0,u().IS)((e=>({loadMoreButton:{borderRadius:Us,fontSize:v?16:14,padding:"5px 4px 5px 11px",height:void 0},loadMoreButtonIcon:{width:v?16:14,height:v?16:14}})),[v]);if(!C)return null;const E=function(e){return e?e.board_cover:void 0}(n),O=!l&&!I.isSyncedCollection,z=Boolean(n.collection_group_by),K=!p&&z&&P;return(0,D.jsxs)("div",{style:ra(n,b,x),onMouseDown:e=>function(e,t){const{device:o}=t,{target:n}=e;!o.isMobile&&n instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:t,target:n,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,h),onClick:ta,className:we().mVR,onMouseMove:()=>function(e,t){const o=y().HV(e);o&&t.state!==o&&t.setState(o)}(t,g),children:[(0,D.jsx)(Wn,{collectionContextStore:r,groupsPointer:t,format:n,canDrag:O,onSelectableEnter:e=>oa(e,t,r,c,h),resultProps:{format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,Xe().EF)(i)||!o.collectionStore())return na(e,o,r,t,i);const l=ea(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))+1;j().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{tr({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}})}(e,t,r,c,i,h),onShiftEnter:e=>oa(e,t,r,c,h),coverFormat:E,coverAspectFormat:Qs(n),coverSizeFormat:Zs(n),colorStyle:x,onTextEsc:e=>na(e,r,i,t,h),disabled:l,blockPropertyValueOverlayStore:a,collectionContextStore:r},canDrop:!0,resultComponent:Zr,disabled:l,direction:Kn.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:z?$s:3,analyticsName:"board",loadContentCover:E&&"page_content"===E.type}),K&&(0,D.jsx)(Gs,{}),M&&(0,D.jsx)(qo().jJ,{groupsPointer:t,store:i,collectionContextStore:r,format:n,isFullScreen:c,incrementLimitsInRelatedGroups:!0,style:L.loadMoreButton,iconStyle:L.loadMoreButtonIcon}),T&&(0,D.jsxs)(D.Fragment,{children:[M&&(0,D.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${S.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,D.jsx)(mr,{groupsPointer:t,collectionContextStore:r,isFullScreen:c,color:null==x?void 0:x.textColor,shouldShowSpinner:B})]}),V&&(0,D.jsx)(hr,{groupFormat:y().HV(t),collectionContextStore:r,color:null==x?void 0:x.textColor,isHovered:F}),!w&&(0,D.jsx)(Xn().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),s=null==l?void 0:l.reducerResultStore.state;e<Ke().A.incrementScrollOffset&&!i&&s&&s.hasMore&&((0,$o().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,r,c,t,h)})]})};function Qs(e){return e?e.board_cover_aspect:void 0}function Zs(e){return e?e.board_cover_size:void 0}function Js(e){const t=e.board_cover_size;return(0,_().rq)(t)}function ea(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function ta(e){(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{}})}function oa(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const s=i[0];if(!(0,Xe().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=ea(t,o);if(!a)return;tr({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===s))+1,from:"board_group_enter_add_item",transient:!0})}function na(e,t,o,n,r){const i=t.collectionStore(),l=e.getTitleStore();if(!l)return;if(bt().q4_(l.getValue()))A().Lt({environment:r,store:e});else if(i){const i=ea(n,t);if(!i)return;const l=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),a=t.collectionViewBlockStore();if(s&&a&&Uo(r,{...(0,ke().sl)(t),block_id:o.id}),j().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}}),l>=0){const e=i.state[l];A().Lt({environment:r,store:e})}}}function ra(e,t,o){const n=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:$s,paddingRight:$s,paddingBottom:$s,marginRight:2*Ns,boxSizing:"content-box",width:Js(e),height:n?void 0:"max-content",...o&&t&&{backgroundColor:o.backgroundColor,...n?{borderRadius:Us}:{borderBottomLeftRadius:Us,borderBottomRightRadius:Us}}}}const ia=28,la=12,sa=4,aa=(0,pt().YK)({addGroup:{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"}}),ca=n.memo((function(e){let{type:t,style:r,groupBy:i,currentGroups:l,schema:a,groupsLimitStore:c,collectionContextStore:p,parentStore:m,onAccept:g,paddingLeft:S,stickyLeft:h,disabled:f}=e;const y=(0,s().v3)(),b=(0,u().DP)(),C=(0,pt().tz)(),w=(0,d().uB)(void 0,ze().A),k=a[i.property],A=(0,d().K8)((()=>(0,Vo().$e)({environment:y,groupFormat:void 0,schema:a,format:p.normalizedFormatStore.state,theme:b})),[p,y,a,b]),I=(0,u().IS)((e=>({plusIcon:{fill:e.text.secondary},iconButton:{width:35,background:null==A?void 0:A.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:$s,paddingBottom:$s,marginRight:Ns,borderRadius:Us,height:"100%",...r}})),[A,r]),j=(0,n.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:s,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=r.state;if(!u||!(0,Mo().Eg)(u))return;if((0,x().X)({environment:s,collectionContextStore:i,action:"board_add_group"}),a.reset(),Wo().lx(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],r={id:Go().JW(),value:d.value,color:(0,Wo().Zd)(e)},i=[...e,r],s={...u,options:i},a={...t,[o.property]:s},c={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Vo().DF)(n,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,Mo().Vs)(u.type)){const e={property:o.property,value:d,hidden:!1};return void l({newGroups:(0,Vo().DF)(n,e,p),newPage:c.newPage})}if((0,Mo()._o)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,v().HB)(u.type)}({schema:a,groupBy:i,currentGroups:l,groupsLimitStore:c,collectionContextStore:p,onAccept:g,environment:y,buttonPopupStore:w,update:e})}),[w,p,l,y,i,c,g,a]),R=(0,n.useCallback)((()=>{!function(e){e.reset()}(w)}),[w]),T=(0,n.useCallback)((()=>(0,D.jsx)(o(330557).p,{groupFormat:void 0,groupBy:i,currentGroups:l,schema:a,onChange:j,onClose:R,parentStore:m})),[l,i,j,R,m,a]);return k&&(0,Mo().Eg)(k)?(0,D.jsx)(qi().Ay,{render:T,buttonPopupStore:w,popupType:y.device.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:e=>"board"===t?(0,D.jsx)(It().A,{ariaLabel:C.formatMessage(aa.addGroup),icon:e=>(0,Gt().W)({...e,...I.plusIcon}),style:I.iconButton,disabled:f,...e}):(0,D.jsx)(ur().p,{isLightGray:!0,icon:Gt().W,style:{display:"flex",height:ia,marginTop:la,marginBottom:sa,width:"max-content",position:h?"sticky":void 0,left:h&&S?S:0,...r},disabled:f,...e,children:C.formatMessage(aa.addGroup)})}):null}),No().A);var da=()=>o(439264);const ua=n.memo((function(e){let{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,D.jsx)(bn().A,{id:"board_columns",reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,D.jsx)(D.Fragment,{children:t()})}));function pa(e){const t=(0,u().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,D.jsx)(At().A,{style:t.button,onClick:e.onClick,children:e.children})}const ma=function(e){const{title:t,description:o,icon:n,style:r,buttonText:i,buttonOnClick:l,secondaryButtonText:s,secondaryButtonOnClick:a}=e,c=(0,Jr().A)(!0,300,0),d=(0,u().IS)((e=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",padding:16,...r},title:{fontSize:17,fontWeight:Ro().Wy.medium,color:e.text.tertiary,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:Ro().Wy.medium,color:e.text.primary}})),[r]);return c?(0,D.jsxs)("div",{style:d.wrapper,children:[n,(0,D.jsx)("div",{style:d.title,children:t}),o?(0,D.jsx)("div",{style:d.description,children:o}):void 0,i?(0,D.jsx)(ys().A,{size:"lg",onClick:l,style:d.button,children:i}):void 0,s?(0,D.jsx)(ys().A,{size:"lg",onClick:a,style:d.button,children:s}):void 0]}):null},ga=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:l}=e,s=(0,d().O$)(t.permissionScopesStore),a=t.settingsStore,c=(0,n.useCallback)((()=>{b().Ow({collectionContextStore:t,collectionSettingsStore:a}),b().a2({collectionSettingsStore:a,item:{type:"properties",timelineViewTab:"table"}})}),[t,a]);return(0,D.jsx)(ma,{title:(0,D.jsx)(pt().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,D.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,D.jsx)(pa,{onClick:c,children:e})}}):(0,D.jsx)(pt().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:l}})}));function Sa(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r}=e,i=e.numBoardColumns||3,l=function(e){const t=2*$s;return(0,_().rq)(e)+t}(o),s=(0,u().IS)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:12},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginRight:10,width:"100%",minWidth:l}})),[r,n,l]),a=y().Hn(i,(e=>(0,D.jsxs)("div",{style:s.group,children:[(0,D.jsx)(eo().A,{style:s.groupHeader}),(0,D.jsx)(Ws,{minHeight:t})]},e)));return(0,D.jsx)("div",{style:s.container,children:a})}var ha=()=>o(607517);const fa=n.memo((function(e){let{format:t,schema:o,collectionContextStore:n,store:r,columnsDisplayStateForCurrentGroups:i,disabled:l}=e;const a=(0,s().v3)(),c=(0,d().K8)((()=>n.contextType),[n]);return t.board_columns_by?"collectionTypedView"===c?null:(0,D.jsx)(ca,{groupBy:t.board_columns_by,schema:o,currentGroups:i,onAccept:e=>function(e,t,o,n,r){const i=t.collectionStore();if(!i)return;const l=n.board_columns_by;if(!l)return;fl({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:l,environment:r})}(e,n,o,t,a),groupsLimitStore:n.boardColumnsLimitStore,parentStore:r,type:"board",collectionContextStore:n}):null}));function ya(e,t,o){const{visibleGroups:n}=e,r=t.board_columns_by;if(!r)return!1;if(0===n.length)return!1;const i=o.permissionScopesStore.state;return i.canConfigureBlock&&!i.isSyncedCollection&&(0,Mo().pP)(r,i.canConfigureCollection)}function va(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function xa(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:qs+Ys(t,o),marginLeft:12}}const ba=n.memo((function(e){const{collectionContextStore:t,columnsDisplayState:o,groupsResultStore:r,currentGroups:i,disableBoardColorColumns:l,disabled:a,format:c,headerPlaceholderHeight:p,hiddenGroups:m,hiddenGroupsHeaderRef:g,hoveredGroupStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y,paddingLeft:v,paddingRight:x,query:b,schema:C,store:w,visibleGroups:k,shouldShowShimmer:A}=e,I=(0,s().v3)(),j=(0,u().DP)(),R=(0,n.useRef)(null),T=(0,d().O$)(t.shouldShowSpinnerStore),M=(0,d().K8)((()=>(0,Vo().K3)({device:I.device,isFullScreen:h,isRootChild:y})),[I.device,h,y]),P=function(e,t,o,n){const r=(0,_().Oz)(t);return(0,d().K8)((()=>{const i=t.isInHomeWidgetStore.state,l=i?"transparent":(null==r?void 0:r.background)||(o?e.cardContentBackground:e.contentBackground),s=Ys(n,i);return{position:"absolute",background:l,height:qs+s,paddingTop:s,zIndex:85,display:"flex",boxShadow:`-3px 0 0 ${l}`,minWidth:"100%"}}),[t,null==r?void 0:r.background,o,e.cardContentBackground,e.contentBackground,n])}(j,t,f,l),B=(0,u().IS)((e=>({stickyHeader:{paddingLeft:v,paddingRight:x},stickyHeaderTransition:{paddingLeft:v},hiddenGroupsTitle:{display:"flex",alignItems:"center",width:220,flexShrink:0,fontSize:14,color:e.text.tertiary,marginLeft:20}})),[v,x]),V=(0,d().O$)(t.permissionScopesStore),F=(0,d().K8)((()=>{const e=t.normalizedFormatStore.state.board_columns_by;if(!e)return!1;const o=(0,Mo().Nf)(e);return V.canConfigureBlock&&o.includes("manual")}),[t.normalizedFormatStore,V.canConfigureBlock]),L=(0,d().O$)(t.isInHomeWidgetStore),E=(0,n.useCallback)(((e,o)=>(0,D.jsx)(wa,{schema:C,collectionContextStore:t,format:c,query:b,disabled:a,isFullScreen:h,isInPeekRenderer:f,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r})),[t,i,a,c,S,h,f,b,r,C,k]),O=(0,n.useCallback)((e=>{"v2"!==o.version?(0,ha().r)({environment:I,collectionContextStore:t,isHidden:!1,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:i,newGroupIds:e}):(0,ha().V)({environment:I,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:o.currentGroups,containsAllGroups:!1})}),[t,o.version,o.currentGroups,i,I]),z=(0,d().K8)((()=>(0,Vo().Zl)(o,t,!0)),[t,o]),K=(0,d().K8)((()=>ya(o,c,t)),[t,o,c]),H=(0,n.useMemo)((()=>A?null:"v2"===o.version?o.pinnedGroups.groups.length>0?(0,D.jsxs)("div",{style:B.hiddenGroupsTitle,ref:g,children:[(0,D.jsx)(pt().sA,{...Vo().K0.pinnedGroups}),(0,D.jsx)(Xt().A,{size:4}),(0,D.jsx)(Ca,{collectionContextStore:t})]}):null:m.length>0?(0,D.jsx)("div",{style:B.hiddenGroupsTitle,ref:g,children:(0,D.jsx)(pt().sA,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})}):null),[t,o,m.length,g,A,B.hiddenGroupsTitle]);if(0===k.length&&0===m.length&&"v2"===o.version&&0===o.pinnedGroups.groups.length)return null;const W=k.map((e=>(0,Mo().Ix)(e)));return c.board_columns_by?(0,D.jsx)(al().g,{stickyAttachPoint:L?"no-stick":"ceiling",absoluteHeight:p,nodeRef:R,stickyStyle:B.stickyHeader,transitionStickyStyle:B.stickyHeaderTransition,children:(0,D.jsxs)("div",{style:P,ref:R,children:[M&&(0,D.jsx)("div",{style:va(f,j,L)}),F?(0,D.jsx)(da().Ay,{direction:"horizontal",keys:W,renderKey:E,onDrop:O}):W.map(((e,o)=>(0,D.jsx)(wa,{schema:C,collectionContextStore:t,format:c,query:b,disabled:a,isFullScreen:h,isInPeekRenderer:f,hoveredGroupStore:S,groupFormat:k[o],currentGroups:i,groupsResultStore:r},(0,Mo().Ix)(k[o])))),z&&(0,D.jsx)(ms,{groupsDisplayState:o,groupsLimitStore:t.boardColumnsLimitStore,type:"board",schema:C,collectionContextStore:t}),K&&(0,D.jsx)(fa,{format:c,schema:C,collectionContextStore:t,store:w,columnsDisplayStateForCurrentGroups:i,disabled:T}),H]})}):null}));function Ca(e){const t=(0,pt().tz)();return(0,D.jsx)(It().A,{icon:gi()._,ariaLabel:t.formatMessage(Vo().K0.pinnedGroups),onClick:()=>{const t=e.collectionContextStore.settingsStore;b().R8({collectionSettingsStore:t,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}})}const wa=n.memo((function(e){let{groupFormat:t,currentGroups:o,schema:n,collectionContextStore:r,format:i,query:l,disabled:s,isFullScreen:a,isInPeekRenderer:c,hoveredGroupStore:u,groupsResultStore:p}=e;return(0,d().K8)((()=>r.groupsStore.getGroupState([t])),[r,t])&&i.board_columns_by?(0,D.jsx)(Yl,{currentGroups:o,groupFormat:t,query:l,schema:n,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:u,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:c,isFullScreen:a,groupsResultStore:p}):null}));class ka extends p().default{constructor(){super("groupsReducerResultStore")}getInitialState(){}}var Aa=()=>o(419357),Ia=()=>o(64e3),ja=()=>o(897119);class Ra extends p().default{getInitialState(){return{searchQuery:"",limit:Ra.defaultLimit}}}Ra.defaultLimit=20,Ra.loadMoreScrollOffset=200,Ra.loadMoreIncrement=20;const Ta=Ra,Ma={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:6},_a=(0,pt().YK)({searchPlaceholder:{defaultMessage:"Search for a pageâ€¦",id:"boardHiddenGroup.searchPlaceholder"}}),Pa=n.memo((function(e){const{device:t}=(0,s().v3)(),r=(0,s().v3)(),i=(0,u().DP)(),{groupBy:l,groupFormat:a,disabled:c,format:p,query:m,schema:g,currentGroups:S,collectionContextStore:h,blockPropertyValueOverlayStore:f,isFullScreen:y,hoveredGroupStore:v,isInPeekRenderer:x}=e,b=(0,d().uB)(void 0,ka),C=(0,d().uB)(void 0,ze().A),w=(0,d().uB)(void 0,Ta),k=n.useRef(null),A=(0,d().K8)((()=>{var e;return null===(e=m.aggregations)||void 0===e?void 0:e[0]}),[m]),I=(0,d().O$)(h.isInHomeWidgetStore),R=(0,d().K8)((()=>h.collectionViewBlockStore()),[h]),T=(0,n.useMemo)((()=>R?new(ae().Bv)(r,{table:K().ev,id:R.id}):null),[r,R]),M=(0,n.useCallback)((()=>(0,D.jsx)(Ga,{groupFormat:a,disabled:c,format:p,collectionContextStore:h,schema:g,blockPropertyValueOverlayStore:f,isFullScreen:y,buttonPopupStore:C})),[f,C,h,c,p,a,y,g]),{searchQuery:P,limit:B}=(0,d().O$)(w),V=(0,d().K8)((()=>{const e=(0,Xo().Yy)({schema:g,group:a,groupBy:p.board_columns_by,propertyMapping:void 0,timeZone:(0,Qo().P)(),experimentService:Fo().default});if(!e)return;return{type:"results",filter:e,limit:B,searchQuery:P,loadContentCover:Boolean(p&&p.board_cover&&"page_content"===p.board_cover.type)}}),[a,g,p,P,B]),F=(0,n.useCallback)((e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:Ta.defaultLimit}),Da(t)}(e,r,w)),[r,w]),L=(0,n.useCallback)((()=>function(e,t){t.reset(),Da(e)}(r,w)),[r,w]),E=(0,n.useCallback)((()=>(0,D.jsxs)(n.Fragment,{children:[!t.isMobile&&(0,D.jsx)(Yl,{groupBy:l,currentGroups:S,groupFormat:a,query:m,schema:g,format:p,collectionContextStore:h,disabled:c||Boolean(P),hidden:!0,isPopup:!0,isFullScreen:y,hoveredGroupStore:v,isInPeekRenderer:x,groupsResultStore:b},(0,Mo().Ix)(a)),(0,D.jsx)("div",{style:{margin:t.isMobile?0:"6px 0"},children:(0,D.jsx)(St().A,{capture:!0,render:e=>(0,D.jsx)(Aa().Ay,{value:P,placeholder:vt().A.formatMessage(_a.searchPlaceholder),autoFocus:!t.isMobile,showClearButton:!0,onChange:F,onClearButtonClick:L,...e})})})]})),[h,S,t.isMobile,c,p,l,a,L,F,v,y,x,m,b,g,P]),O=(0,n.useCallback)((e=>function(e,t,o,n){var r;const i=n.state,l=null===(r=Ea(t,o))||void 0===r||null===(r=r.state)||void 0===r?void 0:r.blockIds,s=t.isLoadingStore.state;e<Ta.loadMoreScrollOffset&&!s&&l&&i.limit<=l.length&&n.setState({...i,limit:i.limit+Ta.loadMoreIncrement})}(e,h,a,w)),[h,a,w]),z=(0,n.useCallback)((e=>(0,D.jsx)("div",{...e,children:(0,gi()._)({width:18,height:18,color:i.text.tertiary})})),[i.text.tertiary]),H=(0,n.useCallback)((e=>(0,D.jsx)(za,{parent:e,groupFormat:a,currentGroups:S,format:p,schema:g,query:m,collectionContextStore:h})),[a,S,p,g,m,h]),W=(0,n.useCallback)((e=>{let o,{selectableEvents:n}=e;return o=t.isMobile?{menuType:ji().gu.Modal,title:(0,D.jsx)(sl().A,{groupBy:l,groupFormat:a,currentGroups:S,schema:g,disabled:!0,isHiddenGroup:!0,collectionContextStore:h}),left:(0,D.jsx)(qi().Ay,{popupType:ja().nl.BottomSheet,renderOrigin:z,render:H}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:()=>Wa(C),header:E()}:{menuType:ji().gu.Popup,header:E(),width:(0,_().rq)(La(p))+20},V?(0,D.jsxs)(Ti().A,{...o,...n,children:[(0,D.jsx)(bn().A,{id:`board_hidden_group:${(0,Mo().Ix)(a)}`,reducer:V,groupsPointer:[a],collectionContextStore:h,resultStore:Ea(h,a),render:M}),(0,D.jsx)(Xn().A,{onChange:O})]}):null}),[t.isMobile,V,a,h,M,O,l,S,g,z,H,E,C,p]),G=(0,n.useCallback)((()=>{if(T)return(0,D.jsx)(o(13679).A,{store:T,isDefaultContainer:!0,droppable:!0,render:W})}),[T,W]),N=(0,n.useCallback)((()=>function(e,t){t.reset(),Da(e)}(r,w)),[r,w]),{value:U}=(0,se().fJ)(re().VI.duplicateActions),$=(0,n.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=k.current;if(!n)return;if(!(n instanceof Element))return;const i=await ve().T.formulas.load();j().createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:r,canUndo:!0,perform:e=>hn({environment:r,collectionContextStore:h,groupsPointer:[a],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:i,duplicateActions:U})})}),[r,h,a,U]),q=(0,n.useCallback)((e=>(0,D.jsx)(Ba,{buttonPopupEvents:e,aggregation:A,schema:g,collectionContextStore:h,query:m,groupFormat:a,groupBy:l,currentGroups:S,isInHomeWidget:I,groupsResultStore:b})),[g,h,m,a,l,S,I,A,b]);return T?(0,D.jsx)("div",{ref:k,children:(0,D.jsx)(lt().A,{store:T,canDropOnto:!c,onSelectableDrop:$,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,D.jsx)(qi().Ay,{popupType:t.isMobile?ja().nl.BottomSheet:ja().nl.Popup,renderOrigin:q,render:G,buttonPopupStore:C,onClick:N})})}):null}));function Ba(e){let{query:t,aggregation:o,buttonPopupEvents:r,groupFormat:i,groupBy:l,currentGroups:a,schema:c,collectionContextStore:d,isInHomeWidget:p,groupsResultStore:m}=e;const g=(0,s().v3)(),S=(0,u().IS)((e=>({button:{...Ma,...p?{fontSize:14}:{}}})),[p]),h=(0,n.useCallback)((e=>function(e,t,o,n){const r=t.collectionViewStore(),i=e?[e]:[],l={...o,aggregations:i};r&&j().createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:n,canUndo:!0,perform:e=>{(0,Ai().F)({collectionViewStore:r,update:{query2:l},transaction:e})}})}(e,d,t,g)),[d,t,g]);return(0,D.jsxs)(At().A,{style:S.button,...r,children:[(0,D.jsx)(sl().A,{groupBy:l,groupFormat:i,currentGroups:a,schema:c,disabled:!0,isHiddenGroup:!0,collectionContextStore:d}),o&&(0,D.jsx)(Gl,{groupFormat:i,aggregation:o,schema:c,collectionContextStore:d,disabled:!0,onChange:h,groupsResultStore:m})]},(0,Mo().Ix)(i))}function Va(e){return e?e.board_cover:void 0}function Fa(e){return e?e.board_cover_aspect:void 0}function La(e){return e?e.board_cover_size:void 0}function Ea(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Oa(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Da(e){ce().default.state.stores.length>0&&A().IU({environment:e})}function za(e){let{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s}=e;const a=(0,d().K8)((()=>s.collectionStore()),[s]),c=s.boardColumnsLimitStore;return a?(0,D.jsx)(Fi,{parent:t,groupFormat:o,currentGroups:n,format:r,schema:i,query:l,collectionContextStore:s,groupsFormatKey:"board_columns",groupsLimitStore:c}):null}function Ka(e,t,o,n,r){const{blocks:i,transaction:l}=e,s=o.groupsStore.getGroupState(t);if(!s)return;const a=s.resultsStore;if(i.length>0&&a.state.length>0){const e=i[0];if(!(0,Xe().EF)(r)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;tr({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0})}}function Ha(e,t,o,n){const r=t.collectionStore(),i=e.getTitleStore();if(bt().q4_(null==i?void 0:i.getValue()))return void A().Lt({environment:n,store:e});if(!r)return;const l=Oa(t,o);if(!l)return;const s=l.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&Uo(n,{...(0,ke().sl)(t),block_id:e.id}),j().createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:n,canUndo:!0,perform:t=>{gt().by({childStore:e,transaction:t})}}),s>=0){const e=l.state[s];A().Lt({environment:n,store:e})}}function Wa(e){e.setState({open:!1})}function Ga(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,buttonPopupStore:u}=e;const p=(0,s().v3)(),m=(0,n.useCallback)((()=>Wa(u)),[u]),g=(0,n.useCallback)((e=>Ka(e,t,i,c,p)),[t,i,c,p]),{device:S}=p,h=(0,d().K8)((()=>{var e;return null===(e=Ea(i,t))||void 0===e?void 0:e.state}),[i,t]),f=(0,d().K8)((()=>{var e;return null===(e=Oa(i,t))||void 0===e?void 0:e.state}),[i,t]),y=(0,d().K8)((()=>O().default.isSidePeekOpen()),[]);return h&&f?0===f.length?(0,D.jsx)(Pi().A,{children:(0,D.jsx)(Ia().A,{title:(0,D.jsx)(pt().sA,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,D.jsx)("div",{style:{padding:S.isMobile?"8px 16px":"6px 14px 8px"},children:(0,D.jsx)(Wn,{collectionContextStore:i,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:g,disableRequest:!0,resultProps:{format:r,schema:l,disabled:o,coverFormat:Va(r),coverAspectFormat:Fa(r),coverSizeFormat:La(r),colorStyle:void 0,blockPropertyValueOverlayStore:a,onTextEnter:e=>function(e,t,o,n,r){const i=Oa(t,n);if(!i)return;if(!(0,Xe().EF)(r)||!t.collectionStore())return Ha(e,t,n,r);const l=i.state.findIndex((t=>t===e))+1;j().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:r,canUndo:!0,perform:e=>{tr({transaction:e,environment:r,collectionContextStore:t,isFullScreen:o,groupsPointer:[n],insertAtIndex:l,from:"board_group_enter_add_item",transient:!0})}})}(e,i,c,t,p),onTextEsc:e=>Ha(e,i,t,p),onShiftEnter:e=>Ka(e,t,i,c,p),collectionContextStore:i},resultComponent:Zr,handleOpenPeekPage:y?void 0:m,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:Kn.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,D.jsx)(Pi().A,{children:(0,D.jsx)(Ia().A,{title:(0,D.jsx)(pr().A,{})})})}const Na=Pa,Ua=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disabled:r,disableBoardColorColumns:i,hiddenGroups:l,store:a,format:c,query:u,schema:p,isFullScreen:m,isInPeekRenderer:g,blockPropertyValueOverlayStore:S,columnsDisplayStateForCurrentGroups:h,hoveredGroupStore:f}=e,y=(0,s().v3)(),v=(0,s().Y0)(),x=(0,Be().bx)(a,r),b=(0,d().K8)((()=>x&&!v.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent),[x,o,v]),C=(0,n.useMemo)((()=>l.slice(0,Vo().RP)),[l]),w=(0,n.useMemo)((()=>C.map((e=>(0,Mo().Ix)(e)))),[C]),k=(0,d().O$)(o.permissionScopesStore),A=(0,n.useCallback)((e=>{if(c.board_columns_by)return(0,D.jsx)(Na,{query:u,schema:p,format:c,groupFormat:e,groupBy:c.board_columns_by,currentGroups:h,collectionContextStore:o,disabled:r||!x||!k.canEditContent&&"collectionTypedView"!==o.contextType,blockPropertyValueOverlayStore:S,isFullScreen:m,hoveredGroupStore:f,isInPeekRenderer:g},(0,Mo().Ix)(e))}),[S,x,o,h,r,c,f,m,g,k.canEditContent,u,p]),I=(0,n.useCallback)(((e,t)=>A(C[t])),[C,A]),j=(0,n.useCallback)((e=>(0,ha().r)({environment:y,collectionContextStore:o,isHidden:!0,groupsFormatKey:"board_columns",groupByKey:"board_columns_by",currentGroups:h,newGroupIds:e})),[o,h,y]),R=(0,d().K8)((()=>xa(o,i)),[o,i]);return(0,D.jsx)("div",{style:R,ref:t,children:C.length>0&&(b?(0,D.jsx)(da().Ay,{direction:"vertical",keys:w,renderKey:I,onDrop:j}):(0,D.jsx)("div",{children:C.map(A)}))})})));var $a=()=>o(274375),qa=()=>o(681445);const Ya=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,disableBoardColorColumns:n,columnsDisplayState:r,disabled:i}=e,l=(0,d().K8)((()=>xa(o,n)),[o,n]),s=r.pinnedGroups;return(0,D.jsx)("div",{ref:t,style:l,children:s.groups.map((e=>{const t=(0,Mo().Ix)(e),n=s.aggregations[t]??0;return(0,D.jsx)(Xa,{groupFormat:e,count:n,collectionContextStore:o,columnsDisplayState:r,disabled:i},(0,Mo().Ix)(e))}))})})));function Xa(e){const{groupFormat:t,collectionContextStore:r,columnsDisplayState:i,disabled:l}=e,a=(0,s().v3)(),c=(0,pt().tz)(),u=n.useRef(null),p=(0,d().O$)(r.normalizedFormatStore),m=(0,d().O$)(r.normalizedSchemaStore),g=(0,d().O$)(r.temporaryStateStore),[S,h]=n.useState(!1),f=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return e?new(ae().Bv)(a,{table:K().ev,id:e.id}):null}),[a,r]),{value:y}=(0,se().fJ)(re().VI.duplicateActions),v=n.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:n}=e,i=u.current;if(!i)return;if(!(i instanceof Element))return;const l=await ve().T.formulas.load();j().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:a,canUndo:!0,perform:e=>hn({environment:a,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:y})})}),[r,y,a]),x=n.useCallback((()=>{(0,ki().m)({environment:a,collectionContextStore:r,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[a,r,t,i]),b=p.board_columns_by,C=n.useMemo((()=>b?(0,D.jsx)(sl().A,{collectionContextStore:r,currentGroups:i.currentGroups,groupBy:b,groupFormat:t,schema:m,disabled:!0,isHiddenGroup:!1,style:{fontSize:14,cursor:"inherit"}}):null),[r,i.currentGroups,b,t,m]);if(!b)return null;if(!f)return null;const w={onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)};return(0,D.jsx)("div",{ref:u,children:(0,D.jsxs)(lt().A,{analyticsName:"board_pinned_group",store:f,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await v({...e,groupFormat:t})},style:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2},children:[(0,D.jsxs)(ur().p,{onClick:()=>{!function(e){var t,o,n;const{collectionContextStore:r,environment:i,groupFormat:l,groupBy:s,temporaryViewState:a,title:c}=e,d=r.collectionViewBlockStore();if(!d)return;const u=r.normalizedSchemaStore.state,p=r.normalizedFormatStore.state,m=r.normalizedQueryStore.state,g=(null===(t=xt().default.state.currentUserSettingsStore)||void 0===t?void 0:t.getSettingsStore().getKeyStore("time_zone").getValue())||(0,Qo().P)(),S=(0,Xo().K8)({schema:u,groupBy:s,group:l,propertyMapping:void 0,timeZone:g});if(!S)return;const h=s.property,f=(0,$a().Q)(d,h),y=(null===(o=a.combinatorFilter)||void 0===o?void 0:o.value)??(null==m?void 0:m.filter),v={type:"table",parent_id:d.pointer.id,parent_table:d.pointer.table,alive:!0,space_id:d.getSpaceId(),format:{is_unlisted:!0,collection_pointer:p.collection_pointer,table_properties:f,property_filters:(null==a||null===(n=a.propertyFilters)||void 0===n?void 0:n.value)??(null==p?void 0:p.property_filters)},query2:{...m,filter:y?(0,Cn().GV)([y,S]):(0,Cn().GV)([S])}},x=(0,ke().sl)(r);(0,xe().u4)({environment:i,event:{eventName:"collection_chart_drilldown_click",eventProperties:{...x,drilldown_type:"grouped",from:"board_pinned_group"}}}),qa().S.openCollectionDrilldownView({collectionViewValue:v,collectionViewBlockStore:d,viewsModuleContext:r.viewsModuleContextStore.state,title:c})}({collectionContextStore:r,environment:a,groupFormat:t,groupBy:b,temporaryViewState:g,title:C})},hoveredStyle:{cursor:"pointer"},children:[C,(0,D.jsx)("span",{style:{opacity:.5,fontSize:14,marginLeft:8},children:(0,o(72135).ZV)(e.count,"number",c,"compact")})]}),l?null:(0,D.jsx)(jt().A,{renderTooltip:e=>(0,D.jsx)(pt().sA,{...e,...Vo().K0.unpinGroup}),render:e=>(0,D.jsx)(It().A,{...(0,Hi().A)(e,w),ariaLabel:c.formatMessage(Vo().K0.unpinGroup),icon:S?o(230979).N:o(68207).S,iconStyle:{width:16,height:16},onClick:x})})]})},(0,Mo().Ix)(t))}const Qa=n.memo((function(e){let{args:t,collectionContextStore:o,isInPeekRenderer:n,format:r,setSubgroupsMounted:i,columnsDisplayStateStore:l}=e;const s=(0,d().O$)(o.isInHomeWidgetStore),a=(0,d().K8)((()=>function(e,t){return t.state.visibleGroups.length*(ql(e)+2*$s+2*Ns)}(r,l)),[r,l]),{stickyStyle:c}=(0,u().IS)((e=>s?{stickyStyle:{}}:{stickyStyle:{background:n?e.cardContentBackground:e.contentBackground,boxShadow:`0 1px 0 ${n?e.cardContentBackground:e.contentBackground}`}}),[s,n]);return(0,D.jsx)(dl,{...t,height:s?ft().ag:36,stickyStyle:c,style:{...t.style,minWidth:a},onMount:i})})),Za=p().default.createClass(void 0,{name:"GroupsReducerResultStore"}),Ja=p().default.createClass(void 0,{name:"HoveredGroupStore"}),ec=n.memo((function(e){const{store:t,format:r,schema:i,collectionContextStore:a,isFullScreen:c,isPreviewing:p,paddingLeft:m,paddingRight:g,paddingBottom:S,disabled:h,query:f,blockPropertyValueOverlayStore:v,isInPeekRenderer:x,isRootChild:C}=e,w=(0,s().v3)(),{isMobile:A}=(0,s().Y0)(),I=(0,u().DP)(),R=(0,pt().tz)(),T=(0,E().X)("collection_group_reducer_visible"),M=(0,n.useRef)(null),P=(0,n.useRef)(null),B=(0,n.useRef)(0),V=(0,n.useRef)(null),F=(0,d().uB)(void 0,Za),L=(0,d().O$)(F),O=(0,d().uB)(void 0,Ja),[z,K]=(0,n.useState)(!1),H=(0,d().r6)((()=>{var e,t;const o=a.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[a],{useDeepEqual:!0}),{collectionStore:W,collectionViewStore:G,collectionViewBlockStore:N}=(0,d().K8)((()=>({collectionStore:a.collectionStore(),collectionViewStore:a.collectionViewStore(),collectionViewBlockStore:a.collectionViewBlockStore()})),[a]),U=(0,d().K8)((()=>"collectionTypedView"===a.contextType),[a]),$=(0,d().K8)((()=>a.permissionScopesStore.state),[a]),q=(0,d().K8)((()=>{const e=r.board_columns_by;if(e)return(0,Mo().oH)({schema:i,groupBy:e})}),[r.board_columns_by,i],{useDeepEqual:!0}),Y=(0,d().O$)(a.boardColumnsLimitStore),X=(0,d().K8)((()=>!Boolean((0,Vo().$e)({environment:w,groupFormat:void 0,schema:i,format:r,theme:I}))),[w,r,i,I]),[Q,Z]=(0,vl().d)({collectionContextStore:a,groupBy:r.board_columns_by,groupsFormatKey:"board_columns",reducerResult:L,groupsLimit:Y}),J=(0,d().K8)((()=>{const{visibleGroups:e}=Q,t=r.collection_group_by,o=F.state;if("v2"===(null==o?void 0:o.version))return a.groupsStore.anyGroupHasResults();const n=void 0!==N?(0,Vo().ck)({groupBy:t,schema:i,formatGroups:r.collection_groups||[],schemaGroups:q,reducerResults:null==o?void 0:o.results,getRecordModel:N.getRecordModel,getRecordRole:N.getRecordRole,relativeVariableResult:a.relativeVariableStore.state,viewAppConfigUri:null==G?void 0:G.getFormat().app_config_uri,allowedCollectionStores:a.collectionStoresStore.state}):[];if(0===n.length){if(void 0!==t)return!1;for(const t of e){const e=a.groupsStore.getGroupState(t);if(null!=e&&e.reducerResultStore.state)return!0}}else for(const r of n)for(const t of e){const e=[r,t],o=a.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}return!1}),[a,N,G,Q,r,F,i,q]),ee=(0,d().K8)((()=>{var e;const t=r.board_columns_by;if(!t)return;const o=r.collection_group_by?{groupBy:r.collection_group_by,groupsFormatKey:"collection_groups",limit:a.groupsLimitStore.state,subGroupAggregation:r.collection_group_aggregation}:void 0,n=(0,yl().m)({collectionContextStore:a,isMobile:A,groupBy:t,subGroupBy:r.collection_group_by});return(0,yl().p)({groupBy:t,schema:i,format:r,groupsFormatKey:"board_columns",limit:a.boardColumnsLimitStore.state,aggregation:null===(e=f.aggregations)||void 0===e?void 0:e.at(0),returnPinnedGroups:!0,subGroupArgs:o,blockResults:n})}),[a,r,A,f.aggregations,i]),te=(0,Be().bx)(t,h),oe=(0,n.useMemo)((()=>te&&(U||$.canEditContent)),[te,$.canEditContent,U]),ne=(0,n.useCallback)((()=>{W&&W.isDefined()&&G&&$.canConfigureBlock&&j().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:w,canUndo:!0,perform:e=>{let t,o=_().In(i);if(!o&&$.canConfigureCollection){o=(0,Po().Ay)();t={[o]:{name:R.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!o)return;const n=(t||i)[o];n&&(0,Mo().Eg)(n)&&(Oo().zA({stores:[G],update:{board_columns_by:(0,Mo().V0)({property:o,propertySchema:n,isCollectionTypedView:U})},transaction:e}),Do().zv({store:G,data:{type:"board"},transaction:e}),t&&(0,Ho().F)({environment:w,collectionStore:W,update:t,transaction:e}))}})}),[W,G,w,R,U,$.canConfigureBlock,$.canConfigureCollection,i]);(0,n.useEffect)((()=>{W&&(!r.board_columns_by&&t.isDefined()&&W.isDefined()&&ne(),l().default.afterNextFlush((()=>{if(!P.current||!M.current)return;let e=0;if(M.current){const t=P.current.getBoundingClientRect().left;e=M.current.getBoundingClientRect().left-t+8}const t=e+B.current;B.current=t,P.current.style.left=`${t}px`})))}),[a,W,w,r.board_columns_by,R,i,t,ne]);const re=(0,n.useCallback)((()=>{const e=Z.state.currentGroups;Eo({environment:w,groupsFormatKey:"board_columns",collectionContextStore:a,currentGroups:e})}),[w,a,Z]),ie=(0,n.useMemo)((()=>y().sg(re,5e3)),[re]);(0,n.useEffect)((()=>(Z.addListener(ie),()=>{Z.removeListener(ie),ie.cancel()})),[Z,ie]),(0,n.useEffect)((()=>{const e=()=>K(!1);return H.addListener(e),()=>H.removeListener(e)}),[H]);const le=(0,n.useCallback)((()=>O.setState(void 0)),[O]),se=(0,n.useCallback)((e=>{const o=Q.visibleGroups;return(0,D.jsx)("div",{style:da().Z0,children:o.map(((n,l)=>{const s=l===o.length-1,d=e?[e,n]:[n],u=0!==Q.hiddenGroups.length;return a.groupsStore.getGroupState(d)?(0,D.jsx)(Xs,{store:t,hoveredGroupStore:O,query:f,schema:i,format:r,groupsPointer:d,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:x,disabled:h||!oe,isLast:s&&!u,blockPropertyValueOverlayStore:v,anyGroupHasResults:J},(0,Mo().Hm)(d)):null}))})}),[J,v,oe,a,Q.hiddenGroups.length,Q.visibleGroups,h,r,O,c,x,f,i,t]),ae=(0,n.useCallback)((()=>{K(!0)}),[K]),ce=(0,n.useCallback)((e=>(0,D.jsx)(Qa,{collectionContextStore:a,isInPeekRenderer:x,format:r,setSubgroupsMounted:ae,columnsDisplayStateStore:Z,args:e})),[a,Z,r,x,ae]),de=(0,n.useCallback)((e=>{A?zo().uK({environment:w,store:e,pageVisitSource:To().y8.Create}):Ko().VU({environment:w,store:e,peekMode:_().hH(a),showMoveTo:U,resultsStore:void 0,collectionContextStore:a,pageVisitSource:To().y8.Create})}),[a,w,U,A]),ue=J,pe=z,me=(0,d().O$)(a.shouldShowSpinnerStore)&&!pe&&!ue,ge=(0,d().O$)(a.isInHomeWidgetStore),Se=(0,d().K8)((()=>Boolean(a.viewsModuleContextStore.getViewModuleType())),[a]),{visibleGroups:he,hiddenGroups:ye}=Q,ve=(0,d().K8)((()=>"v2"===Q.version?r.board_columns||[]:Q.currentGroups),[Q.currentGroups,Q.version,r.board_columns]),xe=r.collection_group_by,be=c?480:ge?220:360,Ce=qs+Ys(X,ge),ke=(0,n.useMemo)((()=>me?null:"v2"===Q.version?Q.pinnedGroups.groups.length>0?(0,D.jsx)(Ya,{ref:P,collectionContextStore:a,disableBoardColorColumns:X,columnsDisplayState:Q,disabled:h}):(0,D.jsx)(Xt().A,{size:64}):ye.length>0?(0,D.jsx)(Ua,{ref:P,collectionContextStore:a,store:t,disabled:h,hiddenGroups:ye,disableBoardColorColumns:X,format:r,schema:i,query:f,blockPropertyValueOverlayStore:v,isFullScreen:c,isInPeekRenderer:x,columnsDisplayStateForCurrentGroups:Q.currentGroups,hoveredGroupStore:O}):null),[v,a,Q,X,me,h,r,ye,O,c,x,f,i,t]),Ae=(0,fe().Zp)(),Ie=(0,n.useCallback)((e=>{const{target:t}=e;!A&&0===e.button&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:w,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[w,A]),je=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:a.settingsStore,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}),[a]),Re=(0,n.useCallback)((e=>({marginTop:4,...e.isLast&&{paddingBottom:12}})),[]),Me=(0,u().IS)((()=>({container:{marginLeft:m,marginRight:g,float:"left",paddingBottom:Ce},selectable:{display:"flex",position:"relative",flexGrow:1,paddingBottom:S},spacer:{width:90,marginLeft:Ns,marginRight:Ns,pointerEvents:"none"},addGroupButtonSpacer:{width:35,marginLeft:Ns,marginRight:Ns,pointerEvents:"none"},groupsWrapper:{display:"flex",flexDirection:"column",position:"relative",top:Ce}})),[Ce,S,m,g]),_e=(0,n.useCallback)((()=>!me&&T&&"v2"===Q.version&&0===Q.visibleGroups.length&&0===Q.pinnedGroups.groups.length?(0,D.jsx)(vs,{className:we().okd,onClick:je,icon:_o().e,title:(0,D.jsx)(pt().sA,{id:"board.emptyState.button",defaultMessage:"All groups are hidden"})}):(0,ei().A)((e=>(0,D.jsx)("div",{className:we().okd,style:Me.container,...e,ref:V,children:(0,D.jsx)(Pl,{nodeRef:V,children:(0,D.jsxs)(lt().A,{style:Me.selectable,store:t,shouldShowHalo:!c&&!ge&&!p,canSelect:!c&&!Se,disablePointerEvents:null==Ae?void 0:Ae.disableAllPointerEvents,onMouseDown:Ie,analyticsName:"board",onMouseLeave:le,children:[me&&ge?null:(0,D.jsx)(ba,{collectionContextStore:a,columnsDisplayState:Q,currentGroups:ve,disableBoardColorColumns:X,disabled:h,groupsResultStore:F,format:r,headerPlaceholderHeight:Ce,hiddenGroups:ye,hiddenGroupsHeaderRef:P,hoveredGroupStore:O,isFullScreen:c,isInPeekRenderer:x,isRootChild:C,paddingLeft:m,paddingRight:g,query:f,schema:i,store:t,visibleGroups:he,shouldShowShimmer:me}),me?(0,D.jsx)(Sa,{height:be,numBoardColumns:he.length,boardCoverSize:r.board_cover_size,areColumnsColored:!X,showGroupHeader:0===he.length}):null,he.length>0?(0,D.jsx)("div",{style:Me.groupsWrapper,children:xe?(0,D.jsx)(Ps,{reducerId:o(381891).bq,store:t,groupsResultStore:T?F:void 0,collectionContextStore:a,disabled:h,isFullScreen:c,isRootChild:C,paddingLeft:m,stickyLeft:!A,renderGroup:se,getGroupStyle:Re,renderHeader:ce,onGroupHeaderAddItem:de,onClickEmptyStateButton:je}):se(void 0)}):null,(0,Vo().Zl)(Q,a,!0)?(0,D.jsx)("div",{style:Me.spacer}):null,ya(Q,r,a)?(0,D.jsx)("div",{style:Me.addGroupButtonSpacer}):null,ke]})})})))),[he,ye,ve,xe,Me.container,Me.selectable,Me.groupsWrapper,Me.spacer,Me.addGroupButtonSpacer,t,c,ge,p,Se,null==Ae?void 0:Ae.disableAllPointerEvents,Ie,le,me,a,Q,X,h,F,r,Ce,O,x,C,m,g,f,i,be,T,A,se,Re,ce,de,je,ke]);return r.board_columns_by?(0,D.jsx)(ua,{collectionContextStore:a,groupsResultStore:F,groupsReducer:ee,render:_e}):(0,D.jsx)(ga,{collectionContextStore:a,isFullScreen:c,paddingLeft:m,paddingRight:g,paddingBottom:S})}));var tc=()=>o(604995),oc=()=>o(636740),nc=()=>o(397248),rc=()=>o(833880),ic=()=>o(253021),lc=()=>o(747671),sc=()=>o(597777);function ac(e){const{blockPropertyValueOverlayStore:t,calendarBy:r,calendarViewRange:i,canEditCalendar:l,collectionContextStore:s,columnIndex:a,currentlyViewedMonth:c,endOfDay:d,format:p,items:m,query:g,sortedResultsStore:S,schema:h,shouldShowShimmer:f,startOfDay:y}=e,v=(0,tc().vY)({firstDate:y,secondDate:c}),x=(0,tc().c_)(y),b=!v&&!x&&"week"!==i,C=(0,u().IS)((e=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?e.text.tertiary:x?e.white:void 0,...x?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:nr().Ay.red,marginLeft:"auto",marginRight:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:e.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}})),[x,b]),w=(0,n.useMemo)((()=>m.find((e=>(0,sc().m6)(y,d,e.start,e.end?e.end:void 0)))),[m,y,d]),k=(0,tc().wN)(y),A=(0,n.useCallback)((e=>(0,D.jsxs)(At().A,{style:C.button,...e,children:[(0,D.jsx)("div",{style:C.dayNumber,className:f?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${a}`:"notion-shimmer-calendar-transition",children:k}),w&&(0,D.jsx)("div",{style:C.eventDot})]})),[C,f,a,k,w]),I=(0,n.useCallback)((e=>(0,D.jsx)(o(824622).iq,{collectionContextStore:s,initialStartOfDay:y,format:p,schema:h,query:g,calendarBy:r,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:S})),[s,y,p,h,g,r,l,t,S]);return(0,D.jsx)(qi().Ay,{popupType:qi().z7.SlideUp,renderOrigin:A,render:I},k.toString())}const cc=(0,n.memo)(ac);function dc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:r,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:s,format:a,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,showWeekends:S,startOfWeek:h}=e,f=(0,u().IS)((e=>({container:{display:"flex",boxShadow:`0 -1px 0 ${e.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=S?7:5,v=(0,n.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,tc().K1)({date:h,daysToAdd:e});return{startOfDay:t,endOfDay:(0,tc().P9)(t)}}))),[y,h]);return(0,D.jsx)("div",{style:f.container,children:v.map(((e,n)=>(0,D.jsx)(cc,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:n,currentlyViewedMonth:s,endOfDay:e.endOfDay,format:a,items:c,query:d,sortedResultsStore:p,schema:m,shouldShowShimmer:g,startOfDay:e.startOfDay,calendarViewRange:r},e.startOfDay.toString())))},h.toString())}const uc=(0,n.memo)(dc);var pc=()=>o(751735),mc=()=>o(465364);const gc=30,Sc=(0,pt().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function hc(e){const{blockStore:t,calendarStore:r,collectionContextStore:i,columnIndex:l,startOfDay:a,canEditCalendar:c,isInHomeWidget:p,isInPeekRenderer:m,isTypedMsvCollection:g,currentlyViewedMonth:S,calendarBy:h,propertySchema:f,calendarViewRange:y,shouldShowShimmer:v}=e,x=(0,s().v3)(),b=(0,pt().tz)(),C=(0,n.useContext)(ri().n),{mainEditorCurrentBlockStore:k}=(0,d().O$)(xt().default),A=(0,d().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:I,isDragging:R,hoveredDay:T}=(0,d().K8)((()=>({dayStoreMap:r.state.dayStoreMap,isDragging:r.state.isDragging,hoveredDay:r.state.isDragging?void 0:r.state.hoveredDay})),[r]),{pointer:M,userId:P,inMemoryRecordCache:B}=(0,d().K8)((()=>t),[t]),V=(0,n.useMemo)((()=>{const e=I.get(a);if(e)return e;const t=new(o(148832).B)(x,M,{userId:P,inMemoryRecordCache:B});return I.set(a,t),t}),[I,x,B,M,a,P]),F=(0,tc().vY)({firstDate:a,secondDate:S}),L=(0,tc().c_)(a),E=(0,tc().sm)(a),O="date"===f.type,z=!F&&!L&&"week"!==y,K=!R&&T===a&&(O||L)&&A&&c,H=(0,n.useMemo)((()=>1!==(0,tc().wN)(a)||L?(0,tc().wN)(a):`${new Intl.DateTimeFormat(b.locale,{month:"short",day:"numeric"}).format(new Date(a))} `),[b.locale,L,a]),W=(0,n.useCallback)((e=>{C?C(e):vr().oo({environment:x,url:e})}),[x,C]),G=(0,n.useCallback)((()=>{const{performResult:e}=j().createAndCommit({userAction:"Calendar.createBlockInDay",environment:x,canUndo:!0,perform:e=>{const t=(0,Zn().Q)({environment:x,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:x.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(h))??h;mc().D5({type:"timestamp",environment:x,store:t.newStore,propertyId:n,timestampMs:a,transaction:e});const r=_().wy({environment:x,store:t.newStore,mainEditorCurrentBlockStore:k,collectionContextStore:i,showMoveTo:g})??(0,Ar().Ay)({store:t.newStore,pageVisitSource:To().y8.Create});return W(r),w().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[h,i,x,g,k,W,a]),N=(0,n.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(h))??h;if(mc().D5({type:"timestamp",environment:x,store:t,propertyId:i,timestampMs:a,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,Qo().P)(),intl:b}))||"",s=r.length>53?`${r.slice(0,50)}â€¦`:r;o(436572).rL({item:{label:b.formatMessage(Sc.linkExistingCompleteToast,{pageTitle:s,numUpdates:e})},undoFunc:()=>{}})}}),[h,x,a,b]),{value:U}=(0,se().fJ)(re().VI.duplicateActions),$=(0,n.useCallback)((e=>{j().createAndCommit({userAction:"Calendar.renderDay",environment:x,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextType)return;const n=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:x,getData:()=>ke().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),mc().M9({...e,environment:x,startOfDay:a,calendarBy:h,collectionStore:o,collectionContextStore:i,transaction:t,duplicateActions:U})}})}),[h,i,U,x,a]),q=(0,n.useCallback)((()=>{if(c&&(0,Xe().EF)(x)&&A){const e=G();jn().v(x,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ke().sl)(i)})}}),[c,x,A,G,i]),Y=(0,u().IS)((e=>{const t=(()=>{if(E)return p?(0,pc().X4)(e.tableHomeDividerColor,.05):m?e.cardSidebarBackground:e.surface.wash})(),o=z?e.text.tertiary:L?e.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default",background:t},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:o,...L?{right:4,width:24,borderRadius:"100%",textAlign:"center",background:e.calendarTodayBackground}:{right:10,textAlign:"right",transition:"color 100ms ease-out"}}}}),[p,m,L,E,z]),X=(0,fe().Zp)();return(0,D.jsxs)(lt().A,{style:Y.selectable,store:V,canDropOnto:c&&O,onSelectableDrop:$,onDoubleClick:q,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[K&&!(null!=X&&X.disablePageLinks)&&(0,D.jsx)(fc,{collectionContextStore:i,createBlockFunc:G,updateBlockDayProperty:N}),(0,D.jsx)("div",{style:Y.dayNumber,className:v?`${we().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${we().yWO} notion-shimmer-calendar-transition`,children:H})]},a.toString())}function fc(e){let{collectionContextStore:t,createBlockFunc:o,updateBlockDayProperty:r}=e;const i=(0,s().v3)(),l=(0,pt().tz)(),a=(0,d().K8)((()=>_().fG({collectionContextStore:t,environment:i,intl:l})),[t,i,l]),c=(0,n.useCallback)((()=>{if((0,Xe().EF)(i)){const e=o();jn().v(i,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,ke().sl)(t)})}else(0,Xe().QY)(i)}),[i,o,t]),p=(0,u().IS)((e=>({iconToolbar:{position:"absolute",display:"flex",top:6,left:6,padding:2,borderRadius:8,background:e.popoverBackground,boxShadow:e.shadowMD},iconButton:{width:20,height:20}})),[]),m=(0,n.useCallback)(((e,t)=>(0,D.jsx)(It().A,{ariaLabel:l.formatMessage(Sc.addItemLabel),icon:Gt().W,style:p.iconButton,onClick:c,...(0,Hi().A)(e,{onMouseDown:Te().tr})})),[c,l,p.iconButton]);return(0,D.jsxs)("div",{style:p.iconToolbar,children:[(0,D.jsx)(jt().A,{renderTooltip:()=>l.formatMessage(Sc.addItemLabel),render:m}),a?(0,D.jsx)(jt().A,{renderTooltip:()=>l.formatMessage(Sc.linkExistingLabel),render:e=>(0,D.jsx)(Sr().O,{collectionContextStore:t,renderLinkButton:t=>(0,D.jsx)(It().A,{ariaLabel:l.formatMessage(Sc.linkExistingLabel),icon:gr().arrowDiagonalUpRightIcon,style:p.iconButton,...t,...(0,Hi().A)(e,{onMouseDown:Te().tr})}),onAddOrLink:r})}):null]})}const yc=(0,n.memo)(hc);var vc=()=>o(869190),xc=()=>o(828180),bc=()=>o(603820),Cc=()=>o(16006),wc=()=>o(338931),kc=()=>o(771989);const Ac=2,Ic=3;function jc(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:i}=e,l=(0,s().v3)(),a=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=xt().default.state;return _().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:l,store:o,collectionContextStore:r});e&&(i(),vr().oo({environment:l,url:e}))}),[r,l,i,o]),u=(0,n.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>a.current,getBlockStore:()=>o,activate:c})),[c,o]);(0,d().K8)((()=>{r.onItemMount(o)}),[r,o]);const p=(0,D.jsx)("div",{ref:a,children:(0,D.jsx)(Tc,{...e})});return(0,Be().NW)(o,t,u,p)}const Rc=n.forwardRef(jc);function Tc(e){const{store:t,row:o,schema:n,format:r,disabled:i,calendarBy:l,showWeekends:a,collectionContextStore:c,includeTime:u,handleOpenPeekPage:p,blockPropertyValueOverlayStore:m,calendarStore:g}=e,S=(0,s().v3)(),{value:h}=(0,se().fJ)(ve().T.formulas),f=n[l],v=(0,d().K8)((()=>!i&&"date"===(null==f?void 0:f.type)&&!c.permissionScopesStore.state.isSyncedCollection),[c.permissionScopesStore,i,null==f?void 0:f.type]),{start:x,end:b,startOfWeek:C,endOfWeek:w,startColumn:k,columnCount:A}=(0,wc().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),I=(0,d().K8)((()=>{const e=r.calendar_properties?r.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,lr().T)({block:t.getModel(),property:e,schema:n,getRecordModel:t.getRecordModel,userId:S.currentUser.id,userTimeZone:(0,Qo().P)(),intl:vt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:h})));return o.concat(y().R9(e,o))}),[S.currentUser.id,r.calendar_properties,n,t,h]),j=(0,d().K8)((()=>(0,ie().jz)({collectionContextStore:c})),[c]);if(!f||!Wo().$L(f))return null;const R=I.length+(j?1:0),T=x<C,M=void 0!==b&&b>w;return(0,D.jsxs)(Mc,{store:t,row:o,numRows:R,columnCount:A,startIsBeforeStartOfWeek:T,endIsAfterEndOfWeek:M,startColumn:k,disabled:i,isEditableDate:v,calendarBy:l,showWeekends:a,handleOpenPeekPage:p,children:[j&&(0,D.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,D.jsx)(Cr().n,{blockStore:t,collectionContextStore:c})}),(0,D.jsx)(Vc,{store:t,collectionContextStore:c,disabled:i,start:x,startOfWeek:C,end:b,endOfWeek:w,includeTime:u,propertySchema:f}),(0,D.jsx)(Lc,{store:t,sortedProperties:I,startIsBeforeStartOfWeek:T,disabled:i,blockPropertyValueOverlayStore:m}),v&&(0,D.jsx)(Ec,{store:t,start:x,startOfWeek:C,end:b,endOfWeek:w,calendarBy:l,calendarStore:g})]})}function Mc(e){const{store:t,children:o,columnCount:r,row:i,numRows:l,startColumn:a,disabled:c,isEditableDate:p,calendarBy:m,showWeekends:g,handleOpenPeekPage:S,startIsBeforeStartOfWeek:h,endIsAfterEndOfWeek:f}=e,y=(0,s().v3)(),v=(0,te().ET)(),x=(0,fe().Zp)(),b=(0,d().K8)((()=>_().NM(t)),[t]),C=(0,d().K8)((()=>(0,An().W)(y,t.id)),[y,t.id]),w=Bc(l,(0,d().K8)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),k=gc+w*i,A=(0,d().uB)(void 0,kc().A),I=(0,d().K8)((()=>We().A.state?!0===A.state.dragging:In().A.state.hoveredStore===t),[t,A]),j=g?7:5,R=(0,u().IS)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:h?0:6,paddingRight:f?0:6,width:f?`calc(100% / ${j} * ${r} - 1px)`:`calc(100% / ${j} * ${r})`,left:`calc(100% / ${j} * ${a})`,height:w,top:k},haloStyle:{..._().wh(e,b),borderRadius:6,marginTop:2,marginBottom:2,marginLeft:h?0:5,marginRight:f?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:6,borderTopRightRadius:6,borderBottomLeftRadius:6,borderBottomRightRadius:6,boxShadow:e.shadowSM,...f&&{borderTopRightRadius:0,borderBottomRightRadius:0},...h&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},...C&&{opacity:.5}},linkBoxHoveredStyle:{opacity:C?.5:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,f,w,j,b,a,h,k,C]),T=(0,n.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?mc().jo({environment:y,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:m,transaction:e.transaction}):[]}),[m,v,y,t]),M=(0,n.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&gt().by({childStore:t,transaction:o})}),[t]),[P,B]=(0,d().K8)((()=>{const{mainEditorCurrentBlockStore:e}=xt().default.state,o=_().wy({environment:y,store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,Ar().Ay)({store:t,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage}),o]}),[y,v,t]),V=(0,d().O$)(v.isInHomeWidgetStore);return(0,D.jsx)(lt().A,{store:t,style:R.selectable,canSelect:!c,shouldShowHalo:!(V||null!=x&&x.isPreviewing),shouldForceRenderSelectionHalo:b,haloStyle:R.haloStyle,canTriggerContextMenu:!c,showBlockMenuInput:!0,canDrag:p,onInsertAbove:T,onInsertBelow:T,onRemove:M,canInsertAbove:p,canInsertBelow:p,analyticsName:"calendar",shouldShowDropZone:!0,className:we().E4t,draggableStore:A,children:(0,D.jsx)(kr().A,{style:R.linkBoxStyle,hoveredStyle:R.linkBoxHoveredStyle,pressedStyle:R.linkBoxHoveredStyle,innerStyle:R.linkBoxInnerStyle,onClick:S,href:P,metaHref:B,hovered:I,disableForOffline:C,children:o})},t.id)}const _c=24,Pc=36;function Bc(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?Pc:_c)+e*xc().CL+2*Ac+2*Ic}function Vc(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:a,end:c,endOfWeek:p,includeTime:m,propertySchema:g}=e,S=(0,s().v3)(),h=l<a,f=c&&c>p,y=(0,d().K8)((()=>(0,ie().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),v="time_format"in g?g.time_format:sc().CE,[x,b,C]=(0,d().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),w=(0,n.useCallback)((e=>{const o=t.getIconStore();o&&j().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:S,canUndo:!0,perform:t=>{Do().KY({store:o,value:e,transaction:t})}})}),[S,t]),k=(0,d().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),A=(0,u().IS)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...h&&{paddingLeft:12},...f&&{paddingRight:11},width:"100%",...k?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:Pc,paddingTop:2}:{height:_c,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:Ro().Wy.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:k?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:k?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:k?2:4},timeStyle:{color:e.text.secondary,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:k?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[f,h,k]),I=m&&c&&r().IX.fromDateTimes(a,p).contains(c)&&l.day!==c.day,R=(0,d().K8)((()=>o.shouldShowPageIcon()&&(void 0!==x||!b)&&!C),[o,x,b,C]);return(0,D.jsxs)("div",{style:A.titleContainer,children:[R&&(i?(0,D.jsx)(Nr().B,{disabled:!0,icon:x,isEmptyPage:b,size:14,style:A.recordIconStyle}):(0,D.jsx)(Nr().B,{disabled:!1,store:t,bucket:"secure",icon:x,isEmptyPage:b,size:14,style:A.recordIconStyle,onChange:w})),C&&(0,Gr().Q)(A.iconWarningStyle),(0,D.jsx)(Fc,{store:t,titlePropertyIsWrapped:k}),y&&(0,D.jsx)("div",{style:A.subitemCountIndicatorContainer,children:(0,D.jsx)(wr().W,{blockStore:t,collectionContextStore:o,wrapperStyle:A.subitemsWrapperStyle})}),m&&r().IX.fromDateTimes(a,p).contains(l)&&(0,D.jsxs)("div",{style:A.timeStyle,children:[(0,vc().PS)({dateTime:l,humanReadable:!1,timeFormat:v}),I&&(0,D.jsxs)("span",{children:[" â†’ ",(0,vc().PS)({dateTime:c,humanReadable:!1,timeFormat:v})]})]}),(0,D.jsx)(Cc().A,{store:t,shouldWrap:k})]})}function Fc(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,u().IS)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.text.tertiary,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,D.jsx)(xr().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function Lc(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,te().ET)(),s=(0,d().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[a,c]=(0,d().K8)((()=>[_().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return a?(0,D.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,D.jsx)(Kr().m,{store:t,property:e,disabled:r,locked:s,format:wt().j.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:a,collectionViewStore:c},e)))}):null}function Ec(e){const{store:t,calendarStore:o,start:r,startOfWeek:i,end:l,endOfWeek:a,calendarBy:c}=e,d=(0,s().v3)(),p=(0,u().IS)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),m=(0,n.useCallback)((e=>{mc().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:c})}),[o,c]),g=(0,n.useCallback)((()=>{j().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:d,canUndo:!0,perform:e=>{mc().eW({environment:d,transaction:e,calendarStore:o,calendarBy:c})}})}),[c,o,d]),S=(0,n.useCallback)((()=>{mc().Pt({calendarStore:o})}),[o]),h=r>=i&&(0,D.jsx)(bc().A,{render:e=>(0,D.jsx)("div",{style:p.leftDragHandle,...e}),onDraggableDragStart:()=>{mc().v7({calendarStore:o,targetStore:t,direction:lc().Q.Left})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S}),f=(!l||l&&l<a)&&(0,D.jsx)(bc().A,{render:e=>(0,D.jsx)("div",{style:p.rightDragHandle,...e}),onDraggableDragStart:e=>{mc().v7({calendarStore:o,targetStore:t,direction:lc().Q.Right})},onDraggableDragMove:m,onDraggableDragEnd:g,onDraggableDragCancel:S});return(0,D.jsxs)(D.Fragment,{children:[h,f]})}function Oc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:r,calendarStore:i,calendarViewRange:l,canEditCalendar:a,collectionContextStore:c,collectionViewStore:p,currentlyViewedMonth:m,endOfWeek:g,format:S,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,items:v,propertySchema:x,schema:b,shouldShowShimmer:C,showWeekends:k,sortedResultsStore:A,startOfWeek:I}=e,j=(0,s().v3)(),{isDragging:R,targetStore:T,temporaryValue:M}=(0,d().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:_,targetStoreCollectionStoreCalendarBy:P}=(0,d().K8)((()=>{const e=null==T?void 0:T.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(r)}}),[T,r]),B=(0,n.useCallback)((()=>{Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),w().Ey({collectionContextStore:c,resultsStore:A});const e=c.normalizedFormatStore.state.collection_peek_mode,t=e||Pn().C9.calendar;Rn().bn(j,{is_peek:!0,from:"calendar",peek_mode:t})}),[c,j,A]),V=k?7:5,F=(0,n.useMemo)((()=>{const e=[];v.forEach((o=>{const n=ae().Bv.createChildStore(p,{table:K().ev,id:o.id});R&&T===n&&M||e.push((0,D.jsx)(Dc,{blockPropertyValueOverlayStore:t,calendarBy:r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:S,handleOpenPeekPage:B,item:o,schema:b,showWeekends:k,startOfWeek:I,store:n},o.id))}));const o=R&&M&&(0,tc().uo)(M,(0,Qo().P)());if(R&&M&&o&&(0,sc().m6)(I,g,o.start,o.end)&&T&&null!=T&&T.id){const n=v.find((e=>e.id===T.id));e.push((0,D.jsx)(Dc,{blockPropertyValueOverlayStore:t,calendarBy:P??r,calendarStore:i,collectionContextStore:c,endOfWeek:g,format:S,handleOpenPeekPage:B,schema:_??b,showWeekends:k,startOfWeek:I,store:T,item:{id:T.id,start:o.start,end:o.end,row:n?n.row:0,includeTime:"datetime"===M.type||"datetimerange"===M.type}},T.id))}return e}),[t,r,i,c,p,g,S,B,R,v,b,k,I,T,P,_,M]),L=(0,n.useMemo)((()=>Math.max(0,...v.map((e=>e.row)))),[v]),E=(0,d().K8)((()=>(0,ie().jz)({collectionContextStore:c})),[c]),O=(0,u().IS)((()=>{const e=(S.calendar_properties?S.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(E?1:0),t="week"===l?372:124,o=Bc(e,S);return{container:{position:"relative",display:"flex",height:Math.max((L+1)*o+gc+4,t)}}}),[l,S,L,E]);return(0,D.jsxs)("div",{style:O.container,children:[[...Array(V).keys()].map((e=>{const t=(0,tc().K1)({date:I,daysToAdd:e});return(0,D.jsx)(yc,{blockStore:o,calendarStore:i,collectionContextStore:c,columnIndex:e,startOfDay:t,calendarBy:r,currentlyViewedMonth:m,canEditCalendar:a,isInHomeWidget:h,isInPeekRenderer:f,isTypedMsvCollection:y,propertySchema:x,calendarViewRange:l,shouldShowShimmer:C},e)})),F]},I.toString())}function Dc(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:s,item:a,schema:c,showWeekends:u,startOfWeek:p,store:m}=e,{canEdit:g,collectionStore:S}=(0,d().K8)((()=>({canEdit:m.canEdit(),collectionStore:m.getAssociatedCollectionStore()})),[m]),{collectionStoreSchema:h,collectionStoreCalendarBy:f}=(0,d().K8)((()=>({collectionStoreSchema:null==S?void 0:S.getSchema(),collectionStoreCalendarBy:null==S?void 0:S.getMappedProperty(o)})),[S,o]);return S?(0,D.jsx)(Rc,{collectionContextStore:r,store:m,startOfWeek:p,endOfWeek:i,showWeekends:u,start:a.start,end:a.end,row:a.row,includeTime:a.includeTime,format:l,schema:h??c,calendarBy:f??o,disabled:!g,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:s},m.id):null}const zc=(0,n.memo)(Oc);function Kc(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,query:g,resultStore:S,schema:h,sortedResultsStore:f,weeks:y}=e,{isPhone:v}=(0,s().Y0)(),x=(0,d().K8)((()=>{var e,t;return(void 0===(null===(e=S.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=S.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Qn().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,S]),{collectionViewStore:b,calendarViewRange:C,showWeekends:w}=(0,d().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var k;y&&y.length>0&&(null===(k=i.databaseItemsVisibleTracker)||void 0===k||k.handleItemsRenderStart());const A=(0,u().IS)((e=>({container:v?{}:{boxShadow:`-1px 0 0 ${e.tableDividerColor}`,marginTop:1,overflow:"hidden"}})),[v]),{calendar_by:I}=g;if(!I)return null;const j=h[I];return j&&b?(0,D.jsx)("div",{style:A.container,children:y&&y.map((e=>v?(0,D.jsx)(uc,{blockPropertyValueOverlayStore:t,calendarBy:I,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,items:e.items,query:g,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start):(0,D.jsx)(zc,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:I,calendarStore:n,calendarViewRange:C,canEditCalendar:r,collectionContextStore:i,collectionViewStore:b,currentlyViewedMonth:l,endOfWeek:e.end,format:a,isInHomeWidget:c,isInPeekRenderer:p,isTypedMsvCollection:m,items:e.items,propertySchema:j,schema:h,shouldShowShimmer:x,showWeekends:w,sortedResultsStore:f,startOfWeek:e.start},e.start)))}):null}const Hc=(0,n.memo)(Kc);var Wc=()=>o(662303),Gc=()=>o(380048),Nc=()=>o(742117),Uc=()=>o(583238),$c=()=>o(543906),qc=()=>o(40970),Yc=()=>o(628315),Xc=()=>o(131448),Qc=()=>o(53137),Zc=()=>o(404141),Jc=()=>o(645200),ed=()=>o(320260),td=()=>o(953006);const od=(0,pt().YK)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function nd(e){let{variant:t,origin:o,onCloseClick:n,onConnectCalendarClick:r}=e;const i=(0,u().IS)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.text.contrastPrimary},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,D.jsx)(td().k,{origin:o,placementToOrigin:"bottom",header:(0,D.jsx)(pt().sA,{..."success"===t?od.successTitle:od.defaultTitle}),content:(0,D.jsxs)("div",{style:i.contentInner,children:[(0,D.jsx)("div",{style:i.contentMessage,children:(0,D.jsx)(pt().sA,{..."success"===t?od.successContent:od.defaultContent})}),"default"===t&&(0,D.jsx)("div",{style:i.footer,children:(0,D.jsx)(At().A,{style:i.primaryButton,hoveredStyle:i.primaryButtonHover,pressedStyle:i.primaryButtonPressed,onClick:r,children:(0,D.jsx)(pt().sA,{...od.connectCalendarTitle})})})]}),contentStyle:i.content,onCloseClick:n,shouldDismissUponOutsideClick:!1,enableMouseCapture:!1,pointerPosition:"33%",style:{...i.tooltip}})}function rd(e){let{collectionContextStore:t}=e;const o=(0,n.useRef)(null),[r,i]=(0,n.useState)(!1),l=(0,s().v3)(),a=(0,d().O$)(xt().AppStoreCurrentSpaceStore),c=(0,d().K8)((()=>(0,Uc().mX)()),[]),p=(0,d().K8)((()=>Xc().default.isVisible("open_in_calendar_tooltip")),[]),m=(0,d().K8)((()=>{const e=Zc().A.state.open||t.settingsStore.state.open,o=t.isFullScreenStore.state,n=O().default.state.open;return o&&!e&&!n&&Qc().A.state.loaded}),[t]);(0,$c().A)((()=>{Yc().HH(l,"open_in_calendar_tooltip")}),m);const g=(0,n.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),n=null==o?void 0:o.getParentBlockStore();e&&o&&n&&a&&(qc().tC(l,{is_calendar_connected:c,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:n.id}),Jc().Op({environment:l,collectionViewStore:e,spaceStore:a,from:"openInCalendarButton"}))}),[l,t,a,c]),S=(0,n.useCallback)((()=>{Yc().a(l,"open_in_calendar_tooltip")}),[l]),h=(0,n.useCallback)((()=>{i(!0),g()}),[g]),f=(0,u().IS)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(ys().A,{size:"lg",ref:o,style:f.button,iconStyle:f.calendarIconSvg,icon:e=>(0,D.jsx)(ed().y,{style:{...e,...f.calendarIcon}}),onClick:g,children:(0,D.jsx)(pt().sA,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),p&&(0,D.jsx)(nd,{variant:r||c?"success":"default",origin:o,onCloseClick:S,onConnectCalendarClick:h})]})}function id(e){const t=(0,s().v3)(),o=(0,fe().Zp)();return!(0,d().K8)((()=>(0,Uc().JF)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:xt().default.state.currentSpaceStore})),[t,e.collectionContextStore])||null!=o&&o.disablePageLinks?null:(0,D.jsx)(rd,{...e})}const ld=(0,pt().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}}),sd=n.memo((function(e){const{currentlyViewedMonth:t,calendarViewRange:o,setNewCalendarStart:r,isInHomeWidget:i,dateRangeStart:l,isInPeekRenderer:a,stickyStyle:c,collectionContextStore:p,weeks:m,userSettingsStartOfWeekStore:g}=e,S=(0,pt().tz)(),{isPhone:h,isMobile:f}=(0,s().Y0)(),y=(0,n.useRef)(null),v=(0,_().Oz)(p),x=(0,d().K8)((()=>{const e=g.state,t=p.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_show_weekends").getValue())??!0?(0,vc().zI)(e,Wc().locale):(0,vc().rj)(Wc().locale)}),[p,g]),b=(0,n.useMemo)((()=>{const e=(0,vc().W_)(t,"month_year_long",Wc().locale);if("month"===o)return e;if(!m||void 0===m[0])return"";const n=m[0];if((0,tc().vY)({firstDate:n.start,secondDate:n.end}))return e;return`${(0,vc().W_)(n.start,(0,tc().St)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",Wc().locale)} - ${(0,vc().W_)(n.end,"month_year_short",Wc().locale)}`}),[t,o,m]),C=(0,n.useCallback)((()=>{const e=g.state,t="month"===o?(0,tc().mK)((0,tc().Mw)(Date.now()),e):(0,tc().mK)(Date.now(),e);r({newCalendarStart:t,calendarViewRange:o,startOfWeek:e})}),[o,r,g]),w=(0,n.useCallback)((e=>{const t=g.state,n=(0,tc().to)(l,t);if("month"===o){const i="left"===e?-1:1,l=(0,tc().mK)((0,tc().Mw)((0,tc().AQ)({date:n,monthsToAdd:i})),t);r({newCalendarStart:l,calendarViewRange:o,startOfWeek:t})}else{const n="left"===e?-7:7,i=(0,tc().mK)((0,tc().K1)({date:l,daysToAdd:n}),t);r({newCalendarStart:i,calendarViewRange:o,startOfWeek:t})}}),[g,l,o,r]),k=(0,u().IS)((e=>{const t=h?e.contentBackground:(null==v?void 0:v.background)||(a?e.cardContentBackground:e.contentBackground);return{container:i?{}:{position:"absolute",left:0,right:0,zIndex:85,background:t},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:Ro().Wy.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:h?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:h?8:0,boxShadow:`0 1px 0 ${e.tableDividerColor}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:e.text.tertiary,height:24}}}),[v,i,a,h]);return(0,D.jsx)(al().g,{stickyAttachPoint:i?"no-stick":"ceiling",nodeRef:y,stickyStyle:c,transitionStickyStyle:c,absoluteHeight:98,children:(0,D.jsxs)("div",{style:k.container,ref:y,children:[(0,D.jsxs)("div",{style:k.monthSwitcher,children:[(0,D.jsx)("div",{style:k.monthHeader,children:b}),(0,D.jsx)("div",{style:k.spacer}),(0,D.jsx)(id,{collectionContextStore:p}),(0,D.jsx)(It().A,{ariaLabel:S.formatMessage(ld.previousMonthButtonAriaLabel),mobileFeedback:f,icon:Gc().I,onClick:()=>w("left")}),(0,D.jsx)(ur().p,{size:"sm",onClick:C,children:(0,D.jsx)(pt().sA,{...ld.todayButtonLabel})}),(0,D.jsx)(It().A,{ariaLabel:S.formatMessage(ld.nextMonthButtonAriaLabel),mobileFeedback:f,icon:Nc().V,onClick:()=>w("right")})]}),(0,D.jsx)("div",{style:k.weekdayNamesContainer,className:we().VO,children:x.map((e=>{let[t,o]=e;return(0,D.jsx)("div",{style:k.weekdayName,children:o},t)}))})]})})})),ad=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,store:i,format:l,query:m,schema:g,isFullScreen:S,isInPeekRenderer:h,isPreviewing:f,maxHeight:v,minWidth:x,paddingBottom:b,paddingLeft:C,paddingRight:w}=e,I=(0,pt().tz)(),R=(0,s().v3)(),T=R.currentUser.id,{isPhone:M,isMobile:P}=(0,s().Y0)(),{value:B}=(0,se().fJ)(ve().T.formulas),V=(0,n.useRef)(null),F=(0,n.useRef)(null),E=(0,o(93583).A)(F,V),O=(0,d().uB)(void 0,lc().a),z=(0,d().uB)(void 0,p().default),H=(0,d().K8)((()=>r.collectionViewStore()),[r]),W=null==H?void 0:H.id,G=(0,d().K8)((()=>r.collectionStore()),[r]),N=(0,Be().bx)(i,!1),U=(0,d().O$)(We().A),$=(0,d().O$)(r.isLoadingStore),q=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),Y=(0,d().O$)(r.isInHomeWidgetStore),X=(0,d().K8)((()=>Boolean(r.viewsModuleContextStore.getViewModuleType())),[r]),Q=(0,d().O$)(r.dateRangeStartStore),Z=(0,d().O$)(r.dateRangeEndStore),J=(0,d().O$)(r.permissionScopesStore),ee=(0,d().O$)(O),{dayStoreMap:te,startingMonth:oe,isDragging:ne}=ee,re=ne?void 0:ee.hoveredDay,ie=(0,d().K8)((()=>N&&(J.canEditContent||q)),[N,J.canEditContent,q]),le=(0,d().K8)((()=>{var e;return(null==H||null===(e=H.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[H]),ce=(0,d().K8)((()=>S&&!P&&"month"===le),[S,P,le]),de=(0,d().K8)((()=>{const e=Ce().XX.state;return ce||!Q?oe:(0,tc().Mw)((0,tc().to)(Q,e))}),[ce,Q,oe]),ue=(0,d().K8)((()=>(0,rc().j2)({collectionContextStore:r})),[r],{useDeepEqual:!0}),pe=(0,d().K8)((()=>{if(!H)return[];const e=z.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>ae().Bv.createChildStore(H,{id:e,table:K().ev})))||[];return(0,rc().oq)({collectionContextStore:r,results:t,getRecordValue:i.getRecordValue,intl:I,formulasModule:B})}),[H,z,r,i.getRecordValue,I,B],{useDeepEqual:!0}),me=(0,d().r6)((()=>H&&pe&&(null==pe?void 0:pe.flatMap((e=>e.items.map((e=>ae().Bv.createChildStore(H,{table:K().ev,id:e.id}))))))||[]),[H,pe],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,d().O$)(me);const[ge,Se]=(0,n.useState)();(0,n.useEffect)((()=>{var e;null!==(e=V.current)&&void 0!==e&&e.parentElement&&Se((0,L().NM)(V.current.parentElement))}),[]);const he=(0,n.useCallback)((e=>{const{newCalendarStart:t,calendarViewRange:o,startOfWeek:n}=e,i=(0,tc().to)(t,n);let l;"month"===o?(l=ce?(0,tc().to)((0,tc().AQ)({date:i,monthsToAdd:1}),n):(0,tc().to)((0,tc().Xf)(i),n),ge&&ce&&(ge.scrollTop=0)):l=i,(0,oc().r)({dateRangeStart:t,dateRangeEnd:l,collectionContextStore:r}),O.update((e=>({...e,startingMonth:(0,tc().Mw)((0,tc().to)(t,n))}))),W&&(0,ic().LQ)({newCalendarStart:t,newCalendarEnd:l,collectionViewId:W,currentUserId:T})}),[r,O,ce,ge,W,T]),ye=(0,n.useCallback)((()=>{G&&G.isDefined()&&H&&J.canConfigureBlock&&j().createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:R,canUndo:!0,perform:e=>{let t,o=_().zv(g);if(!o&&J.canConfigureCollection){o=(0,Po().Ay)();t={[o]:{name:I.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}o&&((0,Ii().f)({collectionViewStore:H,update:{calendar_by:o},transaction:e}),Do().zv({store:H,data:{type:"calendar"},transaction:e}),t&&(0,Ho().F)({environment:R,collectionStore:G,update:t,transaction:e}))}})}),[G,H,R,I,J.canConfigureBlock,J.canConfigureCollection,g]),xe=(0,n.useCallback)((e=>{if(!H||!W)return;const t=(0,ic().dI)({collectionViewId:W,currentUserId:T}),o=e.state,n=(0,tc().mK)(t,o),r=(0,tc().mK)(new Date((0,tc().to)(t,o)).getDate()>7?(0,tc().Mw)(t):t,o),i="month"===le?r:n;O.update((e=>({...e,startingMonth:r.valueOf()}))),he({newCalendarStart:i,calendarViewRange:le,startOfWeek:o})}),[H,W,T,le,O,he]),be=(0,n.useCallback)((()=>{if(!F.current||!ce)return;const e=y().Ul(Array.from(te.entries()).map((e=>{let[t,o]=e;return{store:o,timestamp:t}})),(e=>{let{timestamp:t}=e;return t})),t=F.current.getBoundingClientRect(),n=e.find((e=>{let{store:n}=e;const r=o(695625).T.getRectFromStore(n);if(!r)return;const i=(null==ge?void 0:ge.scrollTop)??0,l=r.top<=t.top+i,s=r.bottom>=t.top+i;return l&&s}));if(n){const e=Ce().XX.state,t=(0,tc().Mw)((0,tc().K1)({date:(0,tc().to)(n.timestamp,e),daysToAdd:1}));t!==oe&&O.update((e=>({...e,startingMonth:t})))}}),[O,te,ce,oe,null==ge?void 0:ge.scrollTop]),ke=(0,yr().d)(be,100),Ae=(0,n.useCallback)((e=>{if(e<Ke().A.incrementScrollOffset&&!$&&ce){const e=Ce().XX.state,t=(0,tc().to)((0,tc().AQ)({date:Z,monthsToAdd:2}),e);(0,oc().r)({dateRangeStart:Q,dateRangeEnd:t,collectionContextStore:r})}}),[r,Z,Q,$,ce]),Ie=(0,n.useCallback)((e=>{const{target:t}=e;!M&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:R,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}),[R,M,i]),je=(0,n.useCallback)((e=>{if(!U&&(0,rc().kc)(ee)){const t=function(e,t){A().AP();const{selectableRectMap:n}=o(666710).default.state,r=Array.from(te.keys()),i=Array.from(te.values());for(const[o,l]of n.entries())if(l&&nc().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>te.get(e)===o.props.store))}(e.clientX,e.clientY);re!==t&&O.update((e=>({...e,hoveredDay:t})))}}),[O,ee,te,re,U]),Me=(0,yr().d)(je,100);(0,a().l)((()=>{xe(Ce().XX),Ce().XX.addListener(xe)})),(0,c().X)((()=>{Ce().XX.removeListener(xe)})),(0,n.useEffect)((()=>{U&&(0,rc().kc)(ee)&&O.update((e=>({...e,hoveredDay:void 0}))),m.calendar_by||ye()}),[O,ee,U,m.calendar_by,ye]),(0,n.useEffect)((()=>{const e=V.current,t=null==e?void 0:e.parentElement,o=ge;return t&&(Re().P4(t,"mousemove",Me),o&&Re().P4(o,"scroll",ke)),()=>{t&&Re().Ol(t,"mousemove",Me),o&&Re().Ol(o,"scroll",ke)}}),[Me,ke,ge]);const _e=(0,u().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:v?v-(M?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...Y?{paddingTop:12}:{}},scrollOffset:Y?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingLeft:1,...Y&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:b,paddingLeft:C,paddingRight:w,minWidth:x,...Y&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingLeft:C,paddingRight:w,minWidth:x}})),[Y,M,v,x,b,C,w]),Pe=(0,fe().Zp)(),Ve=(0,n.useCallback)((()=>(0,ei().A)((e=>(0,D.jsx)(Pl,{nodeRef:F,children:(0,D.jsx)(Xn().A,{onChange:Ae,style:_e.scrollOffset,children:(0,D.jsx)("div",{ref:E,style:_e.container,className:we().G1r,children:(0,D.jsxs)(lt().A,{store:i,onMouseDown:Ie,style:_e.selectable,shouldShowHalo:!S&&!Y&&!f,canSelect:!S&&!X,analyticsName:"calendar",disablePointerEvents:null==Pe?void 0:Pe.disableAllPointerEvents,...e,children:[!(null!=Pe&&Pe.disableAllPointerEvents)&&(0,D.jsx)(sd,{collectionContextStore:r,weeks:pe,userSettingsStartOfWeekStore:Ce().XX,dateRangeStart:Q,currentlyViewedMonth:de,setNewCalendarStart:he,calendarViewRange:le,isInHomeWidget:Y,isInPeekRenderer:h,stickyStyle:_e.sticky}),Y?(0,D.jsx)(ko,{style:_e.scroller,children:(0,D.jsx)(Hc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:O,resultStore:z,sortedResultsStore:me,format:l,query:m,schema:g,weeks:pe,isInPeekRenderer:h,currentlyViewedMonth:de,canEditCalendar:ie,isInHomeWidget:Y,isTypedMsvCollection:q})}):(0,D.jsx)(Hc,{blockPropertyValueOverlayStore:t,collectionContextStore:r,blockStore:i,calendarStore:O,resultStore:z,sortedResultsStore:me,format:l,query:m,schema:g,weeks:pe,isInPeekRenderer:h,currentlyViewedMonth:de,canEditCalendar:ie,isInHomeWidget:Y,isTypedMsvCollection:q})]})})})})))),[t,i,O,le,ie,r,de,Q,l,Ie,Ae,S,Y,h,f,X,q,E,Pe,m,z,g,he,me,_e.container,_e.scrollOffset,_e.scroller,_e.selectable,_e.sticky,pe]),{calendar_by:Fe}=m;if(!Fe)return(0,D.jsx)(cd,{collectionContextStore:r,isFullScreen:S,paddingBottom:b,paddingLeft:C,paddingRight:w});const Le=g[Fe];return Le&&Wo().$L(Le)?ue?(0,D.jsx)(bn().A,{id:"calendar_results",resultStore:z,collectionContextStore:r,reducer:ue,render:Ve}):null:(0,D.jsx)(cd,{collectionContextStore:r,isFullScreen:S,paddingBottom:b,paddingLeft:C,paddingRight:w})}));function cd(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i}=e,l=t.settingsStore,s=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),a=(0,u().IS)((()=>({container:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,D.jsx)(ma,{style:a.container,title:(0,D.jsx)(pt().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:s?(0,D.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,D.jsx)(pa,{onClick:()=>{b().Ow({collectionContextStore:t,collectionSettingsStore:l}),b().a2({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,D.jsx)(pt().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}var dd=()=>o(714574),ud=()=>o(996494);function pd(e,t){return(0,Mr().B2)(t[e])}function md(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=xt().default.state;return _().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}function gd(e,t,o,n,r,i){return t.isDefined()?n.filter((n=>{const l="title"!==n&&r;return!dt().r8({property:n,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,Qo().P)(),intl:vt().A.getIntl(),experimentService:Fo().default,collectionFeatureGates:(0,tn().i)(),formulasModule:i})||l})):[]}function Sd(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=gd(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=y().Uk(c,((e,t)=>t<d&&pd(e,n)));return u||(i?"title":function(e,t){return y().Uk(e,(e=>pd(e,t)))}(c,n))}function hd(e,t,o,n,r,i,l){const s=t.state,a=s.isOpen?s.property:"title",c=gd(e,o,n,r,i,l),d=c.findIndex((e=>e===a)),u=c.find(((e,t)=>t>d&&pd(e,n)));return u||(i?"title":function(e,t){return e.find((e=>pd(e,t)))}(c,n))}function fd(e){(0,dd().P)({store:e})}function yd(e,t,o,n,r){if("title"===e){Tn().VN({environment:r,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();A().hc({environment:r,store:t}),(0,Jn().C)({store:t}),I().setSelectionAtEnd({store:e})}else e?(Tn().VN({environment:r,blockPropertyValueOverlayStore:o}),Tn().ho({environment:r,blockPropertyValueOverlayStore:o,store:t,property:e,format:wt().j.ListView,collectionContextStore:n})):Tn().VN({environment:r,blockPropertyValueOverlayStore:o});fd(t)}function vd(e,t,o){Tn().VN({environment:e,blockPropertyValueOverlayStore:t}),A().Lt({environment:e,store:o}),fd(o)}function xd(e){const{environment:t,newStore:o,previousStore:n}=e;A().hc({environment:t,store:o}),(0,Jn().C)({store:o}),ud().A.setState({store:o,editMode:"new",previousStore:n})}function bd(e){const t=(0,s().v3)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:l,collectionStore:a,subitemPath:c,indentLevel:p,onSubitemCreate:m}=e,g=(0,d().K8)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),S=(0,d().K8)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),h=(0,ro().Sm)(o),f=(0,d().K8)((()=>(0,R().si)({columnIndex:0,titleColumnIndex:0,indentLevel:p,isSubitemToggleOnTitleColumn:S})),[p,S]),y=(0,E().X)("db_ux_chrome"),v=(0,u().IS)((t=>({newRowButtonWrapper:{...y?{display:"flex",alignItems:"center",height:36,width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles}:{display:"contents"}},newRowButton:{display:y?"inline-flex":"flex",alignItems:"center",fontSize:14,height:y?28:32,...y?{borderRadius:6,paddingLeft:6,paddingRight:8,marginLeft:22}:{width:"100%",paddingLeft:f,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...g&&{borderTop:"none"},...e.styles}},newRowButtonHovered:{...!y&&{backgroundColor:t.tableRowHoveredBackground}},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:f+8,color:t.text.tertiary},newIcon:{width:Io().Ev.sm,height:Io().Ev.sm,marginRight:6,fill:t.icon.tertiary},newText:{color:t.text.tertiary}})),[f,g,e.styles,y]),x=(0,d().K8)((()=>{const e=r.permissionScopesStore.state,t=a.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,a]),b=(0,n.useCallback)((e=>{j().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:n=>{const i=(0,_n().u)({environment:t,collectionContextStore:r,groupsPointer:l,store:o,before:!1,collectionStore:a,transaction:n,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&m(i)}}),function(e,t){xe().vd(e,"create_subitem",t)}(t,{...(0,ke().sl)(r)})}),[r,t,l,a,o,c,m]);return!x||h?null:(0,D.jsx)("div",{style:v.newRowButtonWrapper,children:(0,D.jsx)(At().A,{onClick:b,onMouseDown:Te().tr,style:v.newRowButton,hoveredStyle:v.newRowButtonHovered,children:(0,D.jsxs)("span",{style:v.newRowContainer,children:[(0,or().plusSmallIcon)(v.newIcon),(0,D.jsx)("span",{style:v.newText,children:(0,D.jsx)(pt().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})})}var Cd=()=>o(442277);function wd(e){let{property:t,propertyIndex:o,showProperties:r,blockPropertyValueOverlayStore:i,store:l,schema:a,collectionContextStore:c,disabled:u,isEditing:p,mouseIsEntered:m}=e;const g=(0,s().v3)(),S=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){yd(Sd(e,t,o,n,r,l,await ve().T.formulas.load()),o,t,i,e)}(g,i,l,a,r,c,p)),[g,i,l,a,r,c,p]),h=(0,n.useCallback)((async()=>async function(e,t,o,n,r,i,l){yd(hd(e,t,o,n,r,l,await ve().T.formulas.load()),o,t,i,e)}(g,i,l,a,r,c,p)),[g,i,l,a,r,c,p]),f=(0,d().K8)((()=>_().Dj({store:l,collectionContextStore:c})),[l,c]),y=(0,d().K8)((()=>c.collectionViewStore()),[c]),v=(0,d().K8)((()=>{const e=c.isInHomeWidgetStore.state,o=c.isUnlistedViewStore.state&&c.isInlineViewStore.state;return"title"===t&&m&&!e&&!o}),[c,m,t]),x=(0,d().K8)((()=>l.canEdit()),[l]),b=(0,d().K8)((()=>p||c.isInHomeWidgetStore.state),[p,c]),C=(0,d().K8)((()=>c.permissionScopesStore.state.isLocked||!c.permissionScopesStore.state.canEditContent),[c]);return f?(0,D.jsx)(Kr().m,{store:l,property:t,propertyIndex:o,disabled:u||!x,locked:C,format:wt().j.ListView,tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:f,collectionViewStore:y,forceMouseEntered:v,showIfEmpty:b,onBgClick:()=>vd(g,i,l),onEnter:()=>vd(g,i,l),onEsc:()=>vd(g,i,l),onTab:h,onUntab:S,onClick:()=>fd(l)},t):null}function kd(e){let{collectionContextStore:t,toggleButton:o,subitemPath:n}=e;const r=(0,d().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0;if(!r)return null;const l=Math.max((i-1)*ie().yy,0)+ie().Pi;return o?(0,D.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,D.jsx)("div",{style:{width:l}}),o]}):(0,D.jsx)("div",{style:{minWidth:l+ie().yy}})}const Ad=n.memo(n.forwardRef((function(e,t){const o=(0,pt().tz)(),{store:r,schema:i,blockPropertyValueOverlayStore:l,handleOpenPeekPage:a,collectionContextStore:p,onShiftEnter:m,toggleButton:g,subitemPath:S,showProperties:h,disabled:f}=e,y=(0,s().v3)(),{isMobile:v,isPhone:x}=(0,s().Y0)(),b=(0,n.useRef)(null),C=(0,n.useRef)(null),[w,k]=(0,n.useState)(!1),[A,j]=(0,n.useState)(!1),[R,T]=(0,n.useState)(!1),[M,_]=(0,n.useState)(!1),P=(0,d().K8)((()=>{const e=Bn().A.state;return Boolean(e.isActive&&e.store.id===r.id)}),[r.id]),B=(0,d().K8)((()=>{const e=ud().A.state;return e.store&&e.store.id===r.id?e.editMode:void 0}),[r.id]),V=(0,yr().d)((()=>{We().A.state||_(!0)}),100),F=(0,fr().Y)((()=>{_(!1)}),100),L=(0,yr().d)((()=>{T(!0)}),100),E=(0,yr().d)((()=>{j(!0)}),100),O=(0,d().K8)((()=>ce().default.state.stores.length>0&&ce().default.state.stores[0].id===r.id),[r.id]),z=(0,n.useCallback)((()=>{const e=md({environment:y,store:r,collectionContextStore:p});e&&(a(),vr().oo({environment:y,url:e}))}),[y,a,r,p]),K=(0,d().K8)((()=>r.getBlockTitleStore()),[r]),H=(0,d().K8)((()=>function(e){return(0,Ar().Ay)({store:e,fullyQualified:!1,pageVisitSource:To().y8.LinkInPage})}(r)),[r]),W=(0,d().K8)((()=>md({environment:y,store:r,collectionContextStore:p})),[y,r,p]),G=(0,d().K8)((()=>h.map((e=>r.getPropertyValue(e)))),[h,r]),N=(0,n.useCallback)((()=>{!function(e,t){fd(e),t()}(r,a)}),[r,a]),U=(0,n.useCallback)((()=>{C.current&&k(C.current.scrollWidth>C.current.clientWidth)}),[]),$=(0,yr().d)(U,100),q=(0,d().K8)((()=>(0,An().W)(y,r.id)),[y,r]),Y=(0,u().IS)((e=>{return{container:{display:"flex",position:"relative"},linkBox:{position:"relative",...(t=P?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:6,..."single"===t?{height:30}:{minHeight:30}})},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${e.tableDividerColor}`},linkBoxInner:{display:"flex",alignItems:"center",paddingLeft:4,userSelect:P?void 0:"none",WebkitUserSelect:P?void 0:"none"},mobileLinkBoxInner:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingLeft:v?0:6,paddingBottom:v?0:4},hoveredStyle:{background:P?"transparent":e.buttonHoveredBackground},pressedStyle:{background:P?"transparent":e.buttonPressedBackground},overflowButtonArea:{position:"absolute",right:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:e.buttonBackground,transition:"none",paddingLeft:2,paddingRight:0},overflowIcon:{width:12,height:12,fill:e.lightIconColor,marginLeft:-2}};var t}),[P,v]);(0,n.useEffect)((()=>{P&&"new"===B&&I().setSelectionAtEnd({store:K})}),[P,B,K]),(0,n.useEffect)((()=>(window.addEventListener("resize",$),()=>window.removeEventListener("resize",$))),[$]),(0,n.useEffect)((()=>{$()}),[$,G]),(0,c().X)((()=>{ud().A.reset(),Bn().A.reset()}));const X=(0,n.useMemo)((()=>h.indexOf("title")),[h]),Q=x&&h.length>0,Z=(0,D.jsx)(kd,{collectionContextStore:p,toggleButton:g,subitemPath:S}),J=(e,t)=>(0,D.jsx)(wd,{blockPropertyValueOverlayStore:l,collectionContextStore:p,disabled:f,isEditing:P,mouseIsEntered:M,property:e,propertyIndex:t,showProperties:h,schema:i,store:r},e);let te;if(Q){const[e,t]=[h.slice(0,X+1),h.slice(X+1)];te=(0,D.jsxs)("div",{style:Y.container,dir:"ltr",ref:b,children:[Z,(0,D.jsxs)(kr().A,{ref:C,href:H,metaHref:W,external:!1,style:Y.mobileLinkBox,innerStyle:Y.mobileLinkBoxInner,disableForOffline:q,children:[(0,D.jsx)("div",{style:Y.propertiesWithTitleContainer,children:e.map(J)}),t.length>0&&(0,D.jsx)("div",{style:Y.propertiesAfterTitleContainer,children:t.map(J)})]})]})}else{const e=o.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});te=(0,D.jsx)(ee().A,{debugName:"CollectionListViewItem",capture:O,onShiftEnter:m,children:(0,D.jsxs)("div",{style:Y.container,dir:"ltr",ref:b,onMouseEnter:E,onMouseLeave:()=>j(!1),children:[Z,(0,D.jsx)(kr().A,{ref:C,href:H,metaHref:W,altHref:W,onClick:N,external:!1,style:Y.linkBox,innerStyle:Y.linkBoxInner,hoveredStyle:Y.hoveredStyle,pressedStyle:Y.pressedStyle,onMouseEnter:V,onMouseMove:V,onMouseLeave:F,disableForOffline:q,children:h.map(J)}),w&&(0,D.jsx)("div",{style:Y.overflowButtonArea,children:(R||A)&&(0,D.jsx)(jt().A,{renderTooltip:()=>e,placement:De().W.Bottom,render:t=>(0,D.jsx)(It().A,{icon:Cd().B,iconStyle:Y.overflowIcon,ariaLabel:e,style:Y.overflowButton,onClick:z,onMouseEnter:L,onMouseLeave:()=>T(!1),...t})})})]})})}return(0,Be().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"page",getBlockStore:()=>r,getNode:()=>b.current,activate:z})),[r,z]),te)})));function Id(){return{marginTop:1,marginBottom:1}}const jd=n.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:i,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:c}=e;const u=(0,s().v3)(),p=(0,n.useMemo)((()=>t?[t]:[]),[t]),m=(0,n.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:g}=(0,d().K8)((()=>({permissionScopes:l.permissionScopesStore.state})),[l]),S=(0,d().K8)((()=>l.groupsStore.getGroupState(p)),[p,l]),h=(0,d().K8)((()=>!i&&o.canEdit()&&g.canEditContent&&!g.isSyncedCollection),[i,o,g]),f=(0,n.useCallback)((()=>{if(!S)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=ce().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,en().Qe)(o.children,(e=>e.value.store===t)),r=n?(0,ie().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),s=Boolean(null==i?void 0:i.isExpanded);j().createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:u,canUndo:!0,perform:o=>{const r=(0,_n().u)({environment:u,collectionContextStore:l,groupsPointer:S.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:s?"into":"below",from:"list_selection_overlay_shift_enter"});r&&xd({environment:u,newStore:r,previousStore:t})}}),(0,Tr().u)(u,"list_item_edit_mode_enter",{...(0,ke().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,u,S]),y=(0,n.useCallback)(((e,t)=>{xd({environment:u,newStore:t,previousStore:e})}),[u]),v=(0,n.useMemo)((()=>({blockPropertyValueOverlayStore:c,collectionContextStore:l,disabled:i,onShiftEnter:f,schema:a,showProperties:m,collectionViewBlockStore:o})),[c,l,i,f,a,m,o]),x=(0,n.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,D.jsx)(bd,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:p,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,Jn().C)({store:e,transient:!1}),ud().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,p]);return S?(0,D.jsx)(Wn,{collectionContextStore:l,groupsPointer:p,format:r,canDrag:h,resultProps:v,canDrop:!0,resultComponent:Ad,disabled:i,shouldShowHoverMenu:!0,direction:Kn.Vertical,analyticsName:"list",getItemSelectableStyle:Id,emptyDroppableSize:0,onSelectableInsertRow:y,nestedCreateSubitemButton:x}):null}));const Rd=n.memo((function(e){const{store:t,format:o,paddingBottom:r,paddingLeft:i,paddingRight:l,isFullScreen:a,isPreviewing:c,isRootChild:p,minWidth:m,disabled:g,collectionContextStore:S}=e,h=(0,s().v3)(),{isMobile:f}=(0,s().Y0)(),y=(0,u().DP)(),v=(0,d().K8)((()=>_().mM(S,a)),[S,a]),x=(0,d().K8)((()=>null==S?void 0:S.isInHomeWidgetStore.state),[S]),C=(0,d().K8)((()=>"collectionSystemView"===(null==S?void 0:S.contextType)),[S]),w=(0,d().K8)((()=>Boolean(S.viewsModuleContextStore.getViewModuleType())),[S]),k=o.collection_group_by,A=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:S.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[S]),I=(0,n.useCallback)(((e,t,o)=>{if(f)zo().uK({environment:h,store:e,pageVisitSource:To().y8.Create});else if(t)xd({environment:h,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=S.groupsStore.getGroupState(n),i="collectionTypedView"===S.contextType;Ko().VU({environment:h,store:e,peekMode:_().hH(S),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:S,pageVisitSource:To().y8.Create})}}),[S,h,f]),j=(0,n.useCallback)((e=>0===e.index?{}:{borderTop:`1px solid ${y.tableDividerColor}`}),[y]),R=(0,n.useCallback)((o=>(0,D.jsx)(Ps,{reducerId:"list_groups",store:t,collectionContextStore:S,disabled:g,isFullScreen:a,isRootChild:p,paddingLeft:i,stickyLeft:!1,renderGroup:t=>(0,D.jsx)(Md,{...e,groupFormat:t}),getGroupStyle:j,renderHeader:e=>(0,D.jsx)(Td,{args:e}),onGroupHeaderAddItem:I,onClickEmptyStateButton:A})),[S,g,j,A,I,a,p,i,e,t]),T=(0,n.useCallback)((e=>{const t=S.isLoadingStore.state,o=S.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===S.contextType)return;const n=o.reducerResultStore.state;e<Ke().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,$o().H)({collectionContextStore:S,environment:h,incrementLimitArgs:{isFullScreen:a,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[S,h,a]),M=(0,u().IS)((()=>({container:{paddingBottom:x?0:r,paddingLeft:i,paddingRight:l,minWidth:m},selectable:{display:"flex",flexDirection:"column",paddingTop:k||x||C?void 0:4,paddingBottom:4}})),[r,i,l,m,k,x,C]),P=(0,fe().Zp)();return(0,ei().A)((o=>(0,D.jsxs)("div",{style:M.container,className:we()._OD,children:[(0,D.jsx)(lt().A,{store:t,shouldShowHalo:!a&&!x&&!c,canSelect:!a&&!w,disablePointerEvents:null==P?void 0:P.disableAllPointerEvents,analyticsName:"list",style:M.selectable,...o,children:k?R(k):(0,D.jsx)(Md,{...e,groupFormat:k})}),!v&&(0,D.jsx)(Xn().A,{onChange:T})]})))}));function Td(e){const{args:t}=e,{collectionContextStore:o}=t,n=(0,d().O$)(o.isInHomeWidgetStore),{stickyStyle:r}=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${e.contentBackground}`}})),[]);return(0,D.jsx)(dl,{...t,height:n?ft().ag:48,stickyStyle:r})}const Md=n.memo((function(e){const{store:t,format:r,schema:i,disabled:l,groupFormat:a,isFullScreen:c,collectionContextStore:p,blockPropertyValueOverlayStore:m}=e,{isMobile:g}=(0,s().Y0)(),S=void 0!==a,h=(0,n.useMemo)((()=>a?[a]:[]),[a]),f=(0,d().K8)((()=>p.groupsStore.getGroupState(h)),[p,h]),y=(0,d().K8)((()=>null==f?void 0:f.reducerResultStore.state),[f]),v=(0,d().K8)((()=>p.groupsStore.anyGroupHasResults()),[p]),{canEditContent:x,isSyncedCollection:b}=(0,d().K8)((()=>{const e=p.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[p]),C=(0,d().K8)((()=>"collectionTypedView"===p.contextType),[p]),w=(0,d().O$)(p.isInHomeWidgetStore),k=(0,d().K8)((()=>v&&!l&&t.canEdit()&&(x||C)&&!b),[v,l,t,x,C,b]),A=(0,d().K8)((()=>""!==p.searchQueryStore.state),[p]),I=(0,d().K8)((()=>void 0!==y&&(null==y?void 0:y.blockIds.length)>0),[y]),j=(0,d().K8)((()=>(0,Qn().iv)({collectionContextStore:p,groupsPointer:h,hasPartialResults:I})),[p,h,I]),R=(0,d().K8)((()=>_().XQ({collectionContextStore:p,reducerResult:y,isFullScreen:c})),[p,y,c]),T=(0,u().IS)((e=>({container:{paddingBottom:a?w?8:16:void 0},groupLoadMoreButton:{fontSize:16,marginTop:g?4:void 0,paddingLeft:3},groupLoadMoreIcon:{width:16,height:16,marginRight:8},spacer:{width:"100%",borderTop:a||w?void 0:`1px solid ${e.tableDividerColor}`,marginTop:4,marginBottom:4}})),[a,w,g]);return f?(0,D.jsxs)("div",{style:T.container,children:[(0,D.jsx)(jd,{groupFormat:a,store:t,format:r,disabled:l,collectionContextStore:p,schema:i,blockPropertyValueOverlayStore:m}),j&&(0,D.jsx)(o(286993).c,{isFullScreen:c,hasGroups:S,hasPartialResults:I,hasSearchQuery:A,overrideNumShimmerRows:w&&!I?6:void 0}),k&&(0,D.jsxs)(D.Fragment,{children:[R&&(0,D.jsx)("div",{style:T.spacer}),(0,D.jsx)(_d,{collectionContextStore:p,isFullScreen:c,groupState:f,groupFormat:a})]}),R&&(0,D.jsx)(qo().jJ,{groupsPointer:h,store:t,collectionContextStore:p,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:T.groupLoadMoreButton,iconStyle:T.groupLoadMoreIcon})]}):null})),_d=n.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:r,isFullScreen:i}=e,l=(0,s().v3)(),a=(0,pt().tz)(),{isMobile:c}=(0,s().Y0)(),p=(0,d().O$)(r.isInHomeWidgetStore),m=(0,d().K8)((()=>_().fG({collectionContextStore:r,environment:l,intl:a})),[r,l,a]),g=(0,n.useCallback)((()=>{if(!(0,Xe().EF)(l))return void(0,Xe().QY)(l);const e=r.currentSubitemFormatStoreForUiDisplayStore.state;j().createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:l,canUndo:!0,perform:o=>{!function(e){var t;const{transaction:o,environment:n,results:r,collectionContextStore:i,isFullScreen:l,groupsPointer:s,insertAtIndex:a,from:c}=e;i.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const d=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!d)return;let u;a>0&&(u=r[a]);const p=(0,Zn().Q)({environment:n,collectionContextStore:i,groupsPointer:s,insertAtIndex:a,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:c},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!p)return;const m=p.coercionSucceeded,g=p.newStore;n.device.isMobile?zo().uK({environment:n,store:g,pageVisitSource:To().y8.Create}):m?xd({environment:n,newStore:g,previousStore:u}):Ko().VU({environment:n,store:g,peekMode:(0,_().hH)(i),resultsStore:d,collectionContextStore:i,pageVisitSource:To().y8.Create}),jn().v(n,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,ke().sl)(i)})}({transaction:o,environment:l,results:t.resultsStore.state,collectionContextStore:r,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:e?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,r,i]),S=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",height:(0,R().sG)({isMobile:c}),borderRadius:6,fontSize:p?14:16,color:e.text.tertiary,paddingLeft:4,paddingRight:12},icon:{width:p?12:16,height:p?12:16,marginLeft:p?10:3,marginRight:p?6:8,fill:e.lightIconColor},buttonContainer:{display:"flex"}})),[p,c]);return m?(0,D.jsxs)("div",{style:S.buttonContainer,children:[(0,D.jsxs)(At().A,{onClick:g,onMouseDown:Te().tr,style:S.button,children:[(0,Gt().W)(S.icon),(0,D.jsx)(ir,{collectionContextStore:r})]}),(0,D.jsx)(Sr().O,{collectionContextStore:r,groupFormat:o,renderLinkButton:e=>(0,D.jsxs)(At().A,{style:S.button,...e,children:[(0,gr().arrowDiagonalUpRightIcon)(S.icon),(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,D.jsxs)(At().A,{onClick:g,onMouseDown:Te().tr,style:S.button,children:[(0,Gt().W)(S.icon),(0,D.jsx)(ir,{collectionContextStore:r})]})}));class Pd extends p().default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const Bd=Pd;var Vd=()=>o(675592);function Fd(e){let{isPhone:t,elementWidth:o,paddingLeft:n,paddingRight:r,propertyWidths:i}=e;let l=o-n-r,s=0;for(let c=0;c<i.length;c++){if(l-=i[c]??0,s=c,l<=0)break}const a=s+1;return i.length>a+(t?2:5)}const Ld=n.memo((function(e){let{collectionContextStore:t,tableProperties:r,paddingLeft:i,paddingRight:l,children:a}=e;const c=(0,s().v3)(),{isPhone:u}=(0,s().Y0)(),p=(0,n.useRef)(null),m=(0,n.useContext)(ye().R),g=(0,n.useMemo)((()=>r.filter((e=>e.visible))),[r]),S=(0,d().K8)((()=>{var e;return null==m||null===(e=m.horizontalScroller)||void 0===e?void 0:e.getStore().state.element}),[m]),h=(0,d().K8)((()=>{const e=t.frozoneStore.state.frozenIndex;return void 0===e?0:e+1}),[t]),f=(0,d().K8)((()=>g.map((e=>(0,R().oe)({environment:c,propertyFormat:e})))),[c,g]),[y,v]=(0,n.useState)((()=>{var e;return Fd({isPhone:u,elementWidth:(null==S||null===(e=S.deref())||void 0===e?void 0:e.clientWidth)??0,paddingLeft:i,paddingRight:l,propertyWidths:f})}));(0,n.useEffect)((()=>{t.virtualizedModule.setVirtualizedColumnsEnabled(y)}),[y,t]);const x=(0,n.useCallback)((e=>{O().default.state.open&&O().default.state.mode===o(868840).A||v(Fd({isPhone:u,elementWidth:e.width,paddingLeft:i,paddingRight:l,propertyWidths:f}))}),[i,l,f,u]);(0,o(188709).tK)(p,x);const b=(0,n.useCallback)((e=>e+h>f.length-1?35:f[e+h]??35),[f,h]),C=(0,Yo().Te)({enabled:y,count:g.length,estimateSize:b,scrollMargin:i,getScrollElement:()=>(null==S?void 0:S.deref())??null,getItemKey:e=>g[e].property||e,overscan:2,horizontal:!0}),w=C.getVirtualItems(),[k,A]=(0,n.useMemo)((()=>w.length>0?[w[0].start-i,C.getTotalSize()+i-w[w.length-1].end]:[0,0]),[w,C,i]),I=0===w.length?0:h+w[0].index,j=0===w.length?0:w[w.length-1].index+1,{propertiesInRange:T,propertiesInRangeIndices:M}=(0,n.useMemo)((()=>0===w.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:g.slice(I,j),propertiesInRangeIndices:Array.from({length:j-I},((e,t)=>I+t))}),[w.length,j,I,g]),_=(0,n.useMemo)((()=>({propertiesInRange:T,propertiesInRangeIndices:M,beforeWidth:k,afterWidth:A})),[A,k,T,M]);return(0,D.jsx)(Vd().Pr.Provider,{value:C,children:(0,D.jsx)(Vd().Z6.Provider,{value:y,children:(0,D.jsx)(Vd().Wm.Provider,{value:_,children:a})})})}));var Ed=()=>o(651124),Od=()=>o(124311),Dd=()=>o(316369),zd=()=>o(969197);const Kd=Object.freeze({display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"});function Hd(e){(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{}})}function Wd(e,t){return!e&&t}var Gd=()=>o(421107),Nd=()=>o(831194);const Ud=n.memo((function(e){const{disabled:t,property:r,schema:i,collectionContextStore:l,groupFormat:a,propertyFormat:c,isHovered:p,aggregation:m,onChange:g}=e,S=(0,s().v3)(),{isMobile:h}=(0,s().Y0)(),f=(0,E().X)("db_ux_empty_states"),v=(0,E().X)("db_ux_chrome"),b=(0,pt().tz)(),[C,w]=(0,n.useState)(void 0),k=(0,n.useMemo)((()=>Boolean((null==c?void 0:c.width)&&c.width<100)),[c]),A=(0,d().K8)((()=>Wi(l,m)),[l,m]),I=(0,d().K8)((()=>{if(!m)return;return{type:"aggregation",filter:a?(0,Xo().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:a,timeZone:(0,Qo().P)(),experimentService:Fo().default}):void 0,aggregation:m}}),[i,a,m,l]),j=(0,n.useCallback)(((e,t)=>{if(e){const o={aggregator:e,property:r,enforceMaxAggregationLimit:t};g(r,o),w(o),(0,x().X)({environment:S,collectionContextStore:l,action:"table_change_aggregation"})}else g(r,void 0),(0,x().X)({environment:S,collectionContextStore:l,action:"table_remove_aggregation"})}),[S,g,r,l]),T=(0,u().IS)((()=>({buttonContainer:{display:"flex",justifyContent:"flex-end",alignItems:v?"center":"flex-start",width:"100%",marginRight:f?4:0},buttonStyle:{display:"flex",alignItems:"center",...f?{justifyContent:"center",height:"75%",padding:"0px 6px",borderRadius:6}:{justifyContent:"flex-end",width:"100%",height:(0,R().sG)({isMobile:h}),paddingRight:8},overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[v,f,h]);(0,n.useEffect)((()=>{C&&!Wi(l,C)&&(0,y().n4)(m,C)&&w(void 0)}),[A,C,l,m]);const M=(0,n.useMemo)((()=>k&&null!=m&&m.aggregator?Ki().zY[(0,Di().V1)(m)]:void 0),[k,m]),_=(0,n.useMemo)((()=>{const e=null==I?void 0:I.aggregation;if(!e)return"";let t=`${e.aggregator}`;return"object"==typeof e.aggregator&&"operator"in e.aggregator&&(t=`${e.aggregator.operator}:${e.aggregator.groupName}`),`table:${(0,Mo().Ix)(a)}:${r}:${t}`}),[a,r,null==I?void 0:I.aggregation]),P=(0,n.useCallback)((e=>I?(0,D.jsx)(bn().A,{id:_,collectionContextStore:l,reducer:I,groupsPointer:a?[a]:void 0,render:o=>(0,D.jsx)(jt().A,{alignment:k?De().C.Center:De().C.End,disableTooltip:!A&&!M,renderTooltip:()=>A?b.formatMessage(Ui.aggregationCalculating):M,render:n=>(0,D.jsx)(At().A,{disabled:t,style:T.buttonStyle,...(0,Hi().A)(n,e),children:(0,D.jsx)($d,{resultStore:o,aggregation:m,schema:i,property:r,hideLabelText:k})})})}):h?null:(0,D.jsx)(At().A,{disabled:t,style:T.buttonStyle,...e,children:(0,D.jsx)(qd,{disabled:t,isHovered:p,hideLabelText:k})})),[I,_,l,h,a,t,T.buttonStyle,p,k,A,M,b,m,i,r]),B=(0,n.useCallback)((e=>{let{close:t}=e;return(0,D.jsx)(o(195071).A,{currentAggregation:m,property:r,schema:i,onChange:j,onClose:t,source:"tableAggregation"})}),[j,m,r,i]);return(0,D.jsx)("div",{style:T.buttonContainer,children:(0,D.jsx)(qi().Ay,{popupType:h?qi().z7.SlideUp:qi().z7.Popup,disabled:t,renderOrigin:P,render:B})})})),$d=n.memo((function(e){const{aggregation:t,resultStore:r,schema:i,property:l,hideLabelText:a}=e,c=(0,E().X)("db_ux_empty_states"),p=(0,te().ET)(),{isMobile:m}=(0,s().Y0)(),g=(0,u().IS)((e=>c?{container:{display:"flex",fontSize:m?12:10,fontWeight:500},valueStyle:{color:e.text.primary,alignItems:"center",height:"100%"},aggregationTypeNameStyle:{color:e.text.tertiary,textTransform:"uppercase",letterSpacing:1,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}:{container:{display:"flex",justifyContent:"center",alignItems:"center"},valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:m?12:10,textTransform:"uppercase",letterSpacing:1,color:e.text.secondary,marginTop:m?0:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}}),[c,m]),S=(0,d().O$)(r),h=(0,n.useMemo)((()=>{if(!t)return;let e=Ki().SE[(0,Di().V1)(t)];return(0,Di().ET)(t.aggregator)&&(e=t.aggregator.groupName in Nd().OR?Nd().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:f,numberPrecision:y}=(0,d().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,Ki().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(685889).pg)(p,r),s=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),a=null==s?void 0:s[e.target_property];if("number"===(null==a?void 0:a.type)){const e=a.number_format,o=a.number_precision;return{numberFormat:e,numberPrecision:t?(0,Ki().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,p]);if(!h)return null;const v=(0,D.jsx)("span",{style:g.valueStyle,children:t&&(0,D.jsx)(Gi,{aggregation:t,collectionContextStore:p,children:S?(0,Ki().rv)({numberFormat:f,dateFormat:void 0,aggregation:t,userTimeZone:(0,Qo().P)(),value:S.aggregationResult,numberPrecision:y}):void 0})},"value");return a?v:(0,D.jsxs)("div",{style:g.container,children:[(0,D.jsx)("span",{style:g.aggregationTypeNameStyle,children:h},"type"),v]})})),qd=n.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,i=(0,E().X)("db_ux_empty_states"),{isMobile:l}=(0,s().Y0)(),a=(0,u().IS)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.text.tertiary},chevronIcon:{width:10,marginLeft:r?1:4,marginTop:1,fill:e.lightIconColor},summationIcon:{width:12,marginTop:1,fill:e.lightIconColor}})),[r]);return t||!n&&!l?null:(0,D.jsx)(kt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:a.placeholderWrapper,children:(0,D.jsxs)("div",{style:a.placeholderWrapper,children:[r?(0,D.jsx)("span",{style:a.placeholderText,children:(0,o(514503).n)(a.summationIcon)},"placeholder"):(0,D.jsx)("span",{style:a.placeholderText,children:(0,D.jsx)(pt().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),!i&&(0,is().b)(a.chevronIcon)]})})})),Yd=n.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:i,isInPeekRenderer:l,query:a,schema:c,showPropertyFormats:p,showRightActionsSpacer:m,pageCount:g,style:S,paddingLeft:h,paddingRight:f,onMouseEnter:y,onMouseLeave:v,disableSticky:x}=e;const b=(0,s().v3)(),{isPhone:C,isMobile:w}=(0,s().Y0)(),k=(0,E().X)("db_ux_empty_states"),A=(0,u().DP)(),[I,j]=(0,n.useState)(!1),T=(0,d().K8)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:M,frozenPropertyFormats:P,unfrozenPropertyFormats:B}=(0,d().K8)((()=>{const e=p;let t=[],o=e;const n=(0,_().qi)(T);return void 0!==T&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[T,p]),V=(0,d().O$)(t.isInHomeWidgetStore),F=(0,d().K8)((()=>{var e;return Boolean(null===(e=a.aggregations)||void 0===e?void 0:e.length)}),[a.aggregations]),L=(0,n.useMemo)((()=>g>0&&!o),[g,o]),O=(0,d().O$)(Wt().A),z=(0,_().Oz)(t),K=(0,u().IS)((e=>{const t=V?void 0:(null==z?void 0:z.background)||(l?e.cardContentBackground:e.contentBackground);return{aggregationRow:{borderTop:!k||L?`1px solid ${e.tableDividerColor}`:"none",display:"flex",background:t,zIndex:85,fontSize:14,height:(0,R().sG)({isMobile:w})+(i&&!r?O:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,boxSizing:"border-box",...S},stickyStyle:{paddingLeft:h,paddingRight:f,fontVariantNumeric:"lining-nums tabular-nums"},container:{display:"flex",paddingRight:!o&&m?32:0},innerContainer:{display:"flex"}}}),[V,null==z?void 0:z.background,l,k,w,i,r,O,S,h,f,o,m,L]),H=(0,d().K8)((()=>void 0!==T&&(0,R().wy)({environment:b,collectionContextStore:t,isPhone:C,theme:A})),[T,b,t,C,A]),W=(0,n.useCallback)((()=>{j(!0),null==y||y()}),[j,y]),G=(0,n.useCallback)((()=>{j(!1),null==v||v()}),[j,v]),N=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{}})}),[]),U=(0,n.useCallback)(((e,n)=>(0,D.jsx)(Xd,{propertyFormat:e,groupFormat:r,disabled:o,mouseEntered:I,collectionContextStore:t,schema:c,query:a},e.property)),[t,o,r,I,a,c]),$=!V&&(F||i),q=(0,n.useRef)(null),Y=(0,D.jsx)(rt().s,{allowSelectionWithin:!1,style:K.aggregationRow,onMouseMove:W,onMouseLeave:G,onMouseDown:N,ref:q,children:(0,D.jsx)("div",{style:K.container,children:(0,D.jsxs)("div",{style:K.innerContainer,children:[void 0!==T&&(0,D.jsx)("div",{style:{...H,display:"flex"},children:P.map(U)}),B.map(((e,t)=>U(e,t+M)))]})})});return $?(0,D.jsx)(al().g,{stickyAttachPoint:x?"no-stick":"floor",stickyStyle:K.stickyStyle,nodeRef:q,children:Y}):Y})),Xd=n.memo((function(e){var t;let{propertyFormat:r,groupFormat:i,disabled:l,mouseEntered:a,collectionContextStore:c,query:p,schema:m}=e;const g=(0,s().v3)(),[S,h]=(0,n.useState)(!1),f=(0,E().X)("db_ux_empty_states"),y=(0,u().IS)((()=>({wrapper:{display:"flex",width:r.width}})),[r.width]),v=(0,n.useCallback)(((e,t)=>{(0,o(500733).I)({environment:g,collectionContextStore:c,query:p,property:e,newAggregation:t})}),[c,p,g]),x=(0,d().K8)((()=>!l&&(f?S:!!a)),[a,l,S,f]),b=(0,n.useCallback)((()=>{h(!0)}),[h]),C=(0,n.useCallback)((()=>{h(!1)}),[h]);return(0,D.jsx)("div",{style:y.wrapper,onMouseEnter:b,onMouseLeave:C,children:(0,D.jsx)(Ud,{groupFormat:i,propertyFormat:r,disabled:l,isHovered:x,aggregation:null===(t=p.aggregations)||void 0===t?void 0:t.find((e=>e.property===r.property)),property:r.property,collectionContextStore:c,schema:m,onChange:v})})})),Qd=n.memo(n.forwardRef((function(e,t){const{collectionContextStore:o,handleAddRowClick:r,numberOfBlankRows:i,isBlockPropertyValueOverlayOpen:l,propertyFormats:a,hideDefaultButtonText:c,query:p}=e,{isMobile:m}=(0,s().Y0)(),g=(0,E().X)("db_ux_empty_states"),[S,h]=(0,n.useState)(0),f=(0,n.useCallback)((()=>{h(0)}),[]),y=(0,n.useCallback)((()=>{h(0)}),[]),v=(0,d().O$)(o.isInHomeWidgetStore),x=(0,d().K8)((()=>{var e;return Boolean(null===(e=p.aggregations)||void 0===e?void 0:e.length)}),[p.aggregations]),b=(0,u().IS)((e=>{const t=v?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n,icon:r}=(0,R().BJ)({theme:e,isMobile:m,hideTextWithTransition:c,hideTextWithoutTransition:l});return{button:{...o,transition:"background 0.2s ease",borderBottom:`1px solid ${t}`,paddingLeft:g?0:8},buttonHovered:{background:e.tableRowHoveredBackground},icon:r,firstRow:{...n,...!g&&{opacity:0!==S||c?0:1},height:"100%"},lastRow:{...!g&&{borderBottom:"none"},...g&&!x&&{marginBottom:6}},text:{...n,height:"100%"}}}),[c,l,S,x,g,v,m]);return 0===a.length?null:(0,D.jsxs)("div",{onMouseLeave:f,ref:t,children:[(0,D.jsx)(At().A,{className:we().$0P,onClick:r,onMouseDown:Te().tr,style:b.button,hoveredStyle:b.buttonHovered,onMouseEnter:y,children:(0,D.jsx)("span",{style:b.firstRow,children:g?(0,D.jsx)(Zd,{propertyFormats:a,collectionContextStore:o,isRowHovered:0===S}):(0,D.jsxs)(D.Fragment,{children:[(0,or().plusSmallIcon)(b.icon),(0,D.jsx)(ir,{collectionContextStore:o})]})})},"add-row-button-default"),Array.from({length:i}).map(((e,t)=>{const n=t+1,l=n===i,s=S===n?1:0;return(0,D.jsx)(At().A,{className:we().Mbm,onClick:r,onMouseDown:Te().tr,style:{...b.button,...l&&b.lastRow},hoveredStyle:b.buttonHovered,onMouseEnter:()=>h(n),children:(0,D.jsx)("span",{style:{...b.text,...!g&&{opacity:s}},children:g?(0,D.jsx)(Zd,{propertyFormats:a,collectionContextStore:o,isRowHovered:S===n}):(0,D.jsxs)(D.Fragment,{children:[(0,or().plusSmallIcon)(b.icon),(0,D.jsx)(ir,{collectionContextStore:o})]})})},n)}))]})})));function Zd(e){const{propertyFormats:t,collectionContextStore:o,isRowHovered:n}=e;return(0,D.jsx)(D.Fragment,{children:t.map(((e,r)=>(0,D.jsx)(Jd,{propertyFormat:e,collectionContextStore:o,isRowHovered:n,isFirstColumn:0===r,showCellBorder:1===t.length||r!==t.length-1},e.property)))})}function Jd(e){const{propertyFormat:t,collectionContextStore:o,isRowHovered:n,isFirstColumn:r,showCellBorder:i}=e,l=(0,s().v3)(),{isMobile:a}=(0,s().Y0)(),c=(0,d().K8)((()=>(0,R().oe)({environment:l,propertyFormat:t})),[l,t]),p=(0,u().IS)((e=>({tableCell:{display:"flex",width:c,height:"100%",position:"relative",borderRight:i?`1px solid ${e.tableDividerColor}`:"none"},icon:{width:Io().Ev.sm,height:Io().Ev.sm,marginLeft:a?0:1,marginRight:7,fill:e.lightIconColor},newPageLabel:{display:"flex",alignItems:"center",paddingLeft:8,minWidth:100}})),[c,a,i]);return(0,D.jsx)("div",{style:p.tableCell,children:n&&r?(0,D.jsxs)("div",{style:p.newPageLabel,children:[(0,or().plusSmallIcon)(p.icon),(0,D.jsx)(ir,{collectionContextStore:o})]}):null})}var eu=()=>o(112412),tu=()=>o(914701);const ou=n.memo((function(e){const{collectionContextStore:t,groupFormat:o,handleAddRowClick:n,hasSearchQuery:r,hasFilter:i,hasMultipleGroups:l,shouldShowAddRowButton:a,shouldShowLinkButton:c,left:p,height:m}=e,g=(0,E().X)("db_ux_empty_states"),{isMobile:S}=(0,s().Y0)(),h=(0,d().O$)(t.isInHomeWidgetStore),f=(0,u().IS)((e=>{const t=h?e.tableHomeDividerColor:e.tableDividerColor,{button:o,buttonInner:n}=(0,R().BJ)({theme:e,isMobile:S});return{button:{...o,borderBottom:`1px solid ${t}`},buttonInner:n}}),[h,S]);return g&&(i||r)?(0,D.jsx)(nu,{hasMultipleGroups:l,left:p,height:m,children:(0,D.jsx)(ru,{collectionContextStore:t,groupFormat:o,handleAddRowClick:n,hasSearchQuery:r,hasFilter:i,shouldShowAddRowButton:a,shouldShowLinkButton:c})}):(0,D.jsx)(At().A,{className:we().Mbm,onClick:n,onMouseDown:Te().tr,disabled:!a,style:f.button,children:a?(0,D.jsx)("span",{style:f.buttonInner,children:i?(0,D.jsx)(pt().sA,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,D.jsx)(pt().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,D.jsx)("span",{style:f.buttonInner,children:i?(0,D.jsx)(pt().sA,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,D.jsx)(pt().sA,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})})),nu=n.memo((function(e){const{hasMultipleGroups:t,left:o,height:n,children:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,u().IS)((()=>({container:{position:"sticky",display:"flex",height:n||(i?t?144:216:144),gap:4},stickyContainer:{left:o,transform:"translateX(-50%)",position:"sticky",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"}})),[t,n,i,o]);return(0,D.jsx)("div",{style:{width:"100%",overflowX:"initial"},children:(0,D.jsx)("div",{style:l.container,className:we().Mbm,children:(0,D.jsx)("div",{style:l.stickyContainer,children:r})})})}));function ru(e){const{collectionContextStore:t,groupFormat:r,handleAddRowClick:i,hasSearchQuery:l,hasFilter:a,shouldShowAddRowButton:c,shouldShowLinkButton:d}=e,p=(0,s().v3)(),{isMobile:m}=(0,s().Y0)(),g=(0,n.useCallback)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id;o&&((0,tu().E)({userId:p.currentUser.id,collectionViewId:o,isOpen:!0}),t.filtersBarOpenStore.setState(!0))}),[t,p]),S=(0,n.useCallback)((()=>{t.searchQueryStore.setState("")}),[t]),h=(0,u().IS)((e=>{const{buttonInner:t}=(0,R().BJ)({theme:e,isMobile:m});return{container:{overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},iconStyle:{width:16,fill:t.color},buttonInner:t,menuButton:{width:"auto",color:"inherit"}}}),[m]),f=(0,n.useCallback)((e=>(0,D.jsx)("div",{style:h.container,children:(0,D.jsx)(ur().p,{...e,...l?{}:{icon:eu().$,iconStyle:h.iconStyle},children:(0,D.jsx)("span",{style:h.buttonInner,children:l?(0,D.jsx)(pt().sA,{defaultMessage:"No search results",id:"database.tableView.noResults.emptyTablePlaceholderWithSearch"}):(0,D.jsx)(pt().sA,{defaultMessage:"No filter results",id:"database.tableView.noResults.emptyTablePlaceholderWithFilters"})})})})),[h,l]),y=(0,n.useCallback)((e=>{const n=[l?{key:"clear-search",render:t=>(0,D.jsx)($i().A,{...t,title:(0,D.jsx)(pt().sA,{defaultMessage:"Clear search",id:"database.tableView.emptyTablePlaceholderWithFilters.clearSearch"}),icon:(0,D.jsx)(Er().I,{icon:o(105239).N}),buttonStyle:h.menuButton,onClick:()=>{S(),e.close()}}),action:()=>{}}:null,a?{key:"edit-filter",render:t=>(0,D.jsx)($i().A,{...t,title:(0,D.jsx)(pt().sA,{defaultMessage:"Edit filter",id:"database.tableView.emptyTablePlaceholderWithFilters.editFilter"}),icon:(0,D.jsx)(Er().I,{icon:o(105819).pencilLineIcon}),buttonStyle:h.menuButton,onClick:()=>{g(),e.close()}}),action:()=>{}}:null,d?{key:"link-existing",render:e=>(0,D.jsx)(Sr().O,{collectionContextStore:t,groupFormat:r,renderLinkButton:t=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"}),icon:(0,D.jsx)(Er().I,{icon:gr().arrowDiagonalUpRightIcon}),buttonStyle:h.menuButton,...t})}),action:()=>{}}:null,c?{key:"add-row",render:t=>(0,D.jsx)($i().A,{...t,title:(0,D.jsx)(pt().sA,{defaultMessage:"Create a new page",id:"database.tableView.emptyTablePlaceholderWithFilters.addRow"}),icon:(0,D.jsx)(Er().I,{icon:ni().plusIcon}),buttonStyle:h.menuButton,onClick:t=>{i(t),e.close()}}),action:()=>{}}:null];return(0,D.jsx)(Ti().A,{menuType:ji().gu.Popup,children:(0,D.jsx)(Mi().Ay,{style:{padding:4},initialFocus:0,type:Mi().Oh.Vertical,sections:[{key:"empty-results",render:e=>(0,D.jsx)(Pi().A,{...e,hideTitle:!0}),items:n.filter((e=>null!==e))}]})})}),[l,a,d,c,h.menuButton,S,g,t,r,i]);return(0,D.jsx)(qi().Ay,{popupType:qi().z7.Popup,placementToOrigin:qi().sx.Top,alignmentToOrigin:qi().yP.Center,renderOrigin:f,render:y})}var iu=()=>o(40845),lu=()=>o(634201),su=()=>o(60382),au=()=>o(713972);const cu={position:"absolute",display:"flex",opacity:.5,zIndex:81},du=function(e){const t=(0,n.useRef)(null),r=(0,n.useRef)(),i=(0,d().uB)(e.store,o(170253).A),l=(0,d().O$)(i),{direction:s,sectionedKeys:a,sectionStyles:c,keys:u,disableVerticalEdgeScroll:p,disableHorizontalEdgeScroll:m,disabled:g,renderKey:S}=e,h={..."horizontal"===s?da().Z0:da().Bb,...l.isDragging&&{position:"relative",zIndex:1,width:l.savedContainerRect.width,height:l.savedContainerRect.height},...e.style};function f(e){return"string"==typeof e?e:e.key}const x=(0,d().K8)((()=>u.map(((e,t)=>{const o=f(e),n=S(o,t,t===u.length-1);if(l.isDragging&&l.draggingKey===o){const{savedKeyRects:e,savedContainerRect:r,currentXOffset:i,currentYOffset:a}=l,c=e[t];let d,u;"vertical"===s?(d=(0,iu().A)(c.top+a,r.top,r.top+r.height-c.height)-r.top,u=c.left-r.left):(d=c.top-r.top,u=(0,iu().A)(c.left+i,r.left,r.left+r.width-c.width)-r.left);const p={...cu,left:u,top:d,width:c.width,height:c.height,zIndex:1};return(0,D.jsx)("div",{style:p,children:n},o)}}))),[u,S,s,l]);function b(){const{direction:o}=e;return!r.current&&t.current&&(r.current="vertical"===o?(0,L().NM)(t.current):(0,L().T8)(t.current)),r.current}const C=g?{}:{onDraggableDragCancel:()=>{l.isDragging&&i.reset()},onDraggableDragEnd:()=>{if(l.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:n,currentKeyPosition:r}=l;if(n!==r){const e=y().o8(t);e.splice(r,0,e.splice(n,1)[0]);const i=f(t[n]);o(e.map(f),{key:i,startPosition:n,endPosition:r})}e.onDragEnd&&e.onDragEnd(),i.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:n}=e,r=t.current;if(!r)return;if(!(r instanceof Element))return;const l=au().EV(o.target,(e=>au().vq(e)&&e.classList.contains(we().wAf))),s=au().EV(o.target,(e=>e.parentNode===l));if(l&&s){const t=lu().PE(r.children).indexOf(l),o=lu().PE(l.children).indexOf(s);let c=0;const d=Object.keys(a);for(let e=0;e<t;e++)c+=a[d[e]].length;c+=o;const u=n[c];if("object"==typeof u&&!u.draggable)return;const p=r.getBoundingClientRect(),m=y().Bq(Object.keys(a).map(((e,t)=>a[e].map(((e,o)=>r.children[t].children[o].getBoundingClientRect()))))),g=b();if(g){const t=f(n[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),i.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:g.scrollLeft,startScrollY:g.scrollTop,currentKeyPosition:c,savedContainerRect:p,savedKeyRects:m})}}},onDraggableDragMove:t=>{!l.isDragging&&l.willDrag&&l.draggingKey&&(0,su().A)(t.startX,t.startY,t.currentX,t.currentY)>=_e().tC[t.device]&&(i.setState({currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset,startScrollX:l.startScrollX,startScrollY:l.startScrollY,startKeyPosition:l.startKeyPosition,currentKeyPosition:l.currentKeyPosition,savedKeyRects:l.savedKeyRects,savedContainerRect:l.savedContainerRect,draggingKey:l.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const o=b();if(l.isDragging&&o){const{savedKeyRects:e,startScrollX:n,startScrollY:r}=l,s=o.scrollLeft-n,a=o.scrollTop-r,c=y().wq(e,(e=>(0,su().A)(t.currentX+s,t.currentY+a,e.left+e.width/2,e.top+e.height/2)));if(c){const o=e.indexOf(c);i.setState({...l,currentXOffset:t.diffX+s,currentYOffset:t.diffY+a,currentKeyPosition:o})}}}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(bc().A,{...C,forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:p||"horizontal"===s,disableHorizontalEdgeScroll:m||"vertical"===s,render:o=>{let n=0;return(0,D.jsx)("div",{ref:t,style:h,...o,children:Object.entries(a).map((t=>{let[o,r]=t;const i=((e,t)=>(0,D.jsx)("div",{className:we().wAf,style:null==c?void 0:c[e],children:t},e))(o,r.map(((t,o)=>((t,o)=>{const n=f(t),r=e.keys.map(f),i=S(n,o,r.length-1===o);let s="";if(l.isDragging){const{startKeyPosition:t,currentKeyPosition:n}=l;t===n?s="":"horizontal"===e.direction?n===o&&o<t?s=`inset 4px 0 ${nr().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(s=`inset -4px 0 ${nr().Ay.blueWithAlpha(.5)}`):"vertical"===e.direction&&(n===o&&o<t?s=`inset 0 4px ${nr().Ay.blueWithAlpha(.5)}`:n===o&&o>t&&(s=`inset 0 -4px ${nr().Ay.blueWithAlpha(.5)}`))}return(0,D.jsx)("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,v().HB)(e.direction),boxShadow:s},children:i},n)})(t,o+n))));return n+=r.length,i}))})}}),x]})};const uu={viewBox:"0 0 16 16",svg:(0,D.jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 0 0 12.1 6.05 6.05 0 0 0 0-12.1m0 3.5a.55.55 0 0 1 .55.55v1.45H10a.55.55 0 1 1 0 1.1H8.55V10a.55.55 0 1 1-1.1 0V8.55H6a.55.55 0 1 1 0-1.1h1.45V6A.55.55 0 0 1 8 5.45"})},pu=(0,Io().wt)("plusCircleFillSmall",uu);var mu=()=>o(36629),gu=()=>o(404779);const Su=(0,pt().YK)({addProperty:{defaultMessage:"Add property",id:"collectionTable.addColumnButton.addProperty.ariaLabel"}}),hu=n.memo((function(e){const{collectionContextStore:t}=e,r=(0,s().v3)(),i=(0,pt().tz)(),l=(0,E().X)("db_ux_chrome"),a=(0,E().X)("db_ux_properties"),{isMobile:c}=(0,s().Y0)(),p=(0,d().O$)(t.normalizedSchemaStore),m=(0,n.useMemo)((()=>Object.keys(p).length<=1),[p]),g=(0,u().IS)((e=>({button:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"auto",borderRadius:0,padding:8},iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,...l&&{fill:(0,o(743176).P0)({theme:e,willShowOnTooltip:!1})}},longButton:{display:"flex",alignItems:"center",justifyContent:"center",height:"75%",width:"100%",paddingLeft:6,paddingRight:6,fontSize:14},smallButton:{display:"flex",alignItems:"center",justifyContent:"start",height:28,width:28,overflow:"hidden",paddingLeft:6,paddingRight:6,fontSize:14},smallButtonHovered:{width:"auto",paddingRight:8}})),[l]),S=(0,n.useRef)(null),h=(0,n.useCallback)((()=>{t.collectionStore()&&(I().clear({environment:r}),A().IU({environment:r}),(0,gu().y)(),(0,x().X)({environment:r,collectionContextStore:t,action:"click_new_property"}),a&&!c?b().dP({collectionSettingsStore:t.settingsStore,ref:S,item:{type:"propertyTypeGrid",onAccept:(e,o,n,i)=>{mu().nZ({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:o,propertyName:n,selectOptions:i,from:"table"})}}}):b().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:(e,o,n,i)=>{mu().nZ({environment:r,collectionContextStore:t,propertyType:e,isSuggestedProperty:o,propertyName:n,selectOptions:i,from:"table"})}}}))}),[t,r,a,c]);return l?(0,D.jsx)(ur().p,{testId:"add-column-button",style:m?g.longButton:g.smallButton,hoveredStyle:m?void 0:g.smallButtonHovered,onMouseDown:Hd,onClick:h,icon:m?pu:or().plusSmallIcon,iconStyle:g.iconStyle,isGray:!0,ref:S,children:(0,D.jsx)(pt().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnButton.addProperty"})}):(0,D.jsx)(It().A,{testId:"add-column-button",style:g.button,onMouseDown:Hd,onClick:h,icon:or().plusSmallIcon,iconStyle:g.iconStyle,ariaLabel:i.formatMessage(Su.addProperty),ref:S})}));function fu(e){let{collectionContextStore:t}=e;const o=(0,s().v3)(),r=(0,u().IS)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),i=(0,n.useCallback)((()=>{b().Ow({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),(0,x().X)({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),b().a2({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,D.jsx)(At().A,{style:r.button,onMouseDown:Hd,onClick:i,className:we().LcC,children:(0,D.jsx)("div",{style:Kd,children:(0,gi()._)(r.dotsIcon)})})}var yu=()=>o(444570),vu=()=>o(871399);const xu=2,bu=3;function Cu(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:i,isShimmerRow:l}=e,s=(0,n.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,pc().X4)(nr().CM[e.mode].gray,.15)},${(0,pc().X4)(nr().CM[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,pc().X4)(nr().CM[e.mode].gray,.35)},${(0,pc().X4)(nr().CM[e.mode].gray,.2)},  transparent)`),[o,t]),a=(0,u().IS)((e=>({border:{position:"absolute",right:0,width:xu,height:l?35:"100%",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-bu,width:bu,height:l?34:"100%",background:s(e)}})),[l,o,t,s]);return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"row",height:"100%"},children:[i?null:(0,D.jsx)("div",{style:a.border}),(0,D.jsx)(kt().A,{visible:!0,animate:{opacity:r?1:0},children:(0,D.jsx)("div",{style:a.shadow})})]})}function wu(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:i,isBlockHovered:l,passesFilter:a,disabled:c,frozoneProps:p}=e,m=(0,s().v3)(),g=(0,d().uB)(void 0,ht().A),S=(0,yu().Jj)(),h=(0,d().K8)((()=>S&&vu().default.state.isOpen&&vu().default.state.isPlusButtonVisible),[S]),f=(0,d().K8)((()=>g.state.mouseEntered),[g]),y=(0,n.useRef)(null);(0,n.useEffect)((()=>{y.current&&(y.current.indeterminate="indeterminate"===t)}),[t]);const v=(0,d().O$)(nn().Hf),x=(0,n.useCallback)((e=>{if(c)return;o(e);const t=(0,ke().sl)(i)||{};xe().vd(m,"collection_multi_select_checkbox_clicked",{...t,checkbox_type:r})}),[c,r,i,m,o]),b=(0,d().K8)((()=>h?0:!1===t&&!f||v?l?.6:null!=p&&p.shouldShowStickyMultiSelectColumn?.4:0:1),[t,f,v,l,null==p?void 0:p.shouldShowStickyMultiSelectColumn,h]),C=(0,u().IS)((e=>({multiSelectCheckbox:{background:null!=p&&p.isScrolled?null==p?void 0:p.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=p&&p.isCollectionViewBlockSelected?nr().Ay.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:vo().S8,height:vo().S8,cursor:c?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[c,null==p?void 0:p.frozenStyles.background,null==p?void 0:p.isCollectionViewBlockSelected,null==p?void 0:p.isScrolled]),w=null!=p&&p.shouldShowStickyMultiSelectColumn?b>0?1:0:b;return(0,D.jsxs)(kt().A,{animate:{opacity:w},style:C.multiSelectCheckbox,onMouseEnter:()=>g.enter(),onMouseLeave:()=>g.exit(),children:[(0,D.jsx)("div",{style:C.multiSelectCheckboxInner,children:(0,D.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:c?void 0:"pointer",zIndex:1},onClick:Te().kV,onMouseDown:Te().tr,children:(0,D.jsx)("div",{style:{width:`${vo().tG}px`,height:`${vo().tG}px`,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,D.jsx)("input",{type:"checkbox",style:C.checkBoxInput,ref:y,checked:!0===t,onChange:x,disabled:c})})})}),(null==p?void 0:p.shouldFreezeMultiSelectColumn)&&(0,D.jsx)(Cu,{isCollectionViewBlockSelected:null==p?void 0:p.isCollectionViewBlockSelected,passesFilter:a,isCheckbox:!0,isScrolled:!0})]})}function ku(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:r,frozoneProps:i}=e,l=(0,s().v3)(),a=(0,n.useCallback)((()=>(0,ie().v2)(t[0],o).filter((e=>e.canEdit()))),[o,t]),c=(0,d().K8)((()=>0===a().length),[a]),{checkedState:p,allVisibleItemsChecked:m}=(0,d().K8)((()=>{const e=a(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=ce().default.state.stores.filter((t=>e.includes(t))).length;let n;return n=0!==o&&(o===t&&!r||"indeterminate"),{checkedState:n,allVisibleItemsChecked:o===t}}),[a,r]),g=(0,n.useCallback)((e=>{var t;const n=a(),r=ce().default.state.stores,i=(0,R().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===p||"indeterminate"===p&&!m?A().td({environment:l,stores:y().KC(i,n)}):(!0===p||"indeterminate"===p&&m)&&A().td({environment:l,stores:y().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[p,o,l,a,m]),S=(0,d().K8)((()=>(0,_().f5)({environment:l,collectionContextStore:o})),[l,o]),h=(0,u().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:S?{position:"absolute",left:-vo().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,S]);return(0,D.jsx)("div",{style:h.wrapper,children:(0,D.jsx)("div",{style:h.checkboxContainer,children:(0,D.jsx)(wu,{passesFilter:!0,checkedState:p,onClick:g,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:c})})})}var Au=()=>o(37250),Iu=()=>o(285176),ju=()=>o(782473);function Ru(e){const{origin:t,propertyType:o}=e,n=(0,s().v3)();return(0,D.jsx)(td().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,D.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,D.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,D.jsx)(pt().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,v().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,D.jsx)(pt().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,D.jsx)("span",{style:{fontWeight:Ro().Wy.semibold},children:e})}});case"verification":return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(pt().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,D.jsx)(Iu().o,{href:(0,bo().xS)("guides.wikis"),style:{color:nr().Ay.uiLightGray}})]});case"tags":return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(pt().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,D.jsx)(Iu().o,{href:(0,bo().xS)("guides.databaseProperties"),style:{color:nr().Ay.uiLightGray}})]});default:(0,v().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,v().HB)(o)}}(),onCloseClick:()=>{Au().ZP(n)},onPrimaryButtonClick:()=>Au().A6(n),onBackButtonClick:()=>Au().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:ju().gO,pointerOffset:ju().j$,style:{width:ju().Sw}})}var Tu=()=>o(790748),Mu=()=>o(912720);const _u=new(se().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(55373),o.e(36192),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(95794),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(7605),o.e(7005),o.e(47779)]).then(o.bind(o,981667)))),Pu=(0,se()._h)(_u,(e=>e.TableHeaderCellMenu));var Bu=()=>o(840094),Vu=()=>o(913687),Fu=()=>o(452862),Lu=()=>o(964447),Eu=()=>o(673730),Ou=()=>o(806401),Du=()=>o(532940),zu=()=>o(784438),Ku=()=>o(817126);const Hu=(0,pt().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function Wu(e){let{propertySchema:t}=e;const o=(0,Ku().kg)(t);return o?(0,D.jsx)(Gu,{featureName:o}):null}function Gu(e){let{featureName:t}=e;const o=(0,pt().tz)(),n=(0,u().IS)((e=>({container:{display:"flex",flexDirection:"column",gap:4,width:200,textWrap:"wrap"},title:{lineHeight:Ro().K_.UISmall.desktop,fontSize:Ro().J.UISmall.desktop},description:{lineHeight:Ro().K_.UIRegular.desktop,fontSize:Ro().J.UIRegular.desktop,color:e.text.secondary}})),[]),r=(0,Ku().G9)({featureName:t});if(!r)return null;const i=(0,zu().Xq)(r);if(!i||"product"!==i.type)return null;const l=i.product;return"plus"!==l&&"business"!==l&&"enterprise"!==l?null:(0,D.jsx)(jt().A,{placement:De().W.Top,render:e=>(0,D.jsx)("div",{...(0,Hi().A)(e),children:(0,D.jsx)(Er().I,{icon:Du().exclamationMarkTriangleIcon,color:"uiYellowPrimary",style:{padding:2}})}),renderTooltip:()=>(0,D.jsxs)("div",{style:n.container,children:[(0,D.jsx)("div",{style:n.title,children:(0,D.jsx)(pt().sA,{defaultMessage:"Upgrade to {subscriptionTier}",id:"collectionSettings.connectedRelationUpsell.title",values:{subscriptionTier:o.formatMessage(Hu[l])}})}),(0,D.jsx)("div",{style:n.description,children:(0,D.jsx)(pt().sA,{defaultMessage:"You will lose access to this feature on August 13",id:"property.connectedPropertyUpsellBadge.description"})})]})})}var Nu=()=>o(377586);const Uu=(0,pt().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),$u=n.memo((function(e){let{type:t}=e;const r=(0,s().v3)(),i=(0,pt().tz)(),l=(0,n.useRef)(null),a=(0,u().IS)((e=>({icon:{fill:e.icon.orangePrimary},text:{width:300,color:e.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${e.stroke.secondary}`},button:{width:"auto"},dismissButton:{color:e.text.uiBluePrimary},learnMoreButton:{color:e.text.secondary},learnMoreIcon:{width:14,height:14,marginRight:0}})),[]),c=(0,bo().xS)("guides.duplicateToSpace"),d=(0,n.useCallback)((()=>(0,D.jsxs)(Ti().A,{menuType:ji().gu.Popup,children:[(0,D.jsx)(Pi().A,{style:a.text,children:i.formatMessage(Uu[t])}),(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=l.current)||void 0===e||e.setOpen(!1)},render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...a.button,...a.dismissButton}})},{key:"learn-more",action:e=>{var t,o,n;null===(t=(o=e.event).preventDefault)||void 0===t||t.call(o),null===(n=l.current)||void 0===n||n.setOpen(!1),vr().oo({environment:r,url:c,openInNew:"tab"})},render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,o(133033).$)(),desktopIconStyle:a.learnMoreIcon,buttonStyle:{...a.button,...a.learnMoreButton},href:c,external:!0})}],render:e=>(0,D.jsx)(Pi().A,{...e,style:a.footer})}]})]})),[a,i,r,c,t]),p=(0,n.useCallback)((e=>(0,D.jsx)(It().A,{icon:Gr().Q,iconStyle:a.icon,ariaLabel:i.formatMessage(Uu[t]),...e})),[a,i,t]);return(0,D.jsx)(qi().Ay,{popupType:Nu().n.Popup,render:d,renderOrigin:p,ref:l})})),qu=n.memo((function(e){const{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,disableCellRightBorder:l,disabled:a,format:c,formatKey:p,isLast:m,paddingTop:g,property:S,renderSpacer:h,schema:f,width:y,collectionViewBlockStore:x}=e,b=(0,n.useRef)(null);(0,Tu().b)(o(344482).A,(()=>({collectionContextStore:r,property:S,getNode:()=>b.current})),[r,S]);const C=(0,s().v3)(),{isMobile:w}=(0,s().Y0)(),{value:k}=(0,se().fJ)(ve().T.formulas),{value:j}=(0,se().fJ)(ve().T.formulaConstants),{value:R}=(0,se().fJ)(ve().T.formulaPermissions),[T,M]=(0,n.useState)(!1),_=(0,d().O$)(r.permissionScopesStore),P=(0,d().uB)(void 0,ze().A),B=(0,d().K8)((()=>o(792415).A.state.publicPageData),[]),{isRightMostFrozenColumn:V,isScrolled:F}=(0,d().K8)((()=>{const{frozenIndex:e,isScrolled:t}=r.frozoneStore.state;return{isRightMostFrozenColumn:e===i,isScrolled:t}}),[r.frozoneStore,i]),L=f[S],O=(0,d().K8)((()=>{var e;if("relation"!==(null==L?void 0:L.type))return!1;const t=null===(e=r.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,Wo().o2)(t,L)}),[r,L]),[{value:z}]=(0,wn().Yb)((async()=>{var e;if("formula"!==(null==L?void 0:L.type))return!1;const t=r.collectionStore(),n=null===(e=r.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&n&&k&&j&&R))return!1;const i=(0,tn().i)(),l=(0,o(502856).MC)({collectionFeatureGates:i,experimentService:Fo().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel}),s={type:"block",collection:n},a={kind:j.FormulaContextValueKind.ThisRow,type:s},c={sourceProperty:S,valueTypes:[a],handleDataRequest:l,publicPageDataCollection:{id:null==B?void 0:B.collectionId,schema:null==B?void 0:B.collectionSchema},spaceId:t.getSpaceId(),featureGates:i};return!(await R.hasAccessToProperty({collectionPointer:n,collectionSchema:f,context:c,propertyId:S,hasAccessFn:R.hasSameSpaceAccess}))}),[r,L,S,f,k,j,R,B]),K=(0,E().X)("collections_xws"),H=(0,E().X)("db_ux_chrome"),W=O&&K,G=z&&K,N=(0,Ou().D)(L),U=(0,d().K8)((()=>x.getCollectionStore()),[x]),$=(0,n.useCallback)((()=>{I().clear({environment:C}),A().IU({environment:C}),(0,gu().y)()}),[C]),q=(0,n.useCallback)((e=>{w||(e.preventDefault(),(0,Te().SQ)({event:e,context:Te().y$.EditorContextMenu,callback:()=>{$(),P.setState({open:!0})}}))}),[w,$,P]),Y=(0,n.useCallback)((e=>{M(e)}),[M]),X=(0,u().IS)((e=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:y,borderRight:l?void 0:`1px solid ${e.tableDividerColor}`},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:g},buttonHovered:{background:e.tableRowHoveredBackground},property:{fontSize:14,flex:"1 1 auto"},enabledIcon:{width:20,height:20,marginLeft:4},menuWrapper:{marginLeft:H?-6:void 0}})),[y,l,g,H]),Q=(0,n.useCallback)((e=>L?(0,D.jsx)(Yu,{propertySchema:L,tooltipEvents:e,propertyId:S,collectionViewBlockStore:x}):null),[L,S,x]),Z=(0,n.useCallback)(((e,t)=>{var n;return L?(0,D.jsxs)(At().A,{style:X.button,hoveredStyle:X.buttonHovered,disabled:a,...(0,Hi().A)(e,t),children:[h&&h(m),(0,D.jsx)(Rt().mA,{propertySchema:L,showIcon:!0,badge:(0,D.jsxs)(D.Fragment,{children:["relation"===L.type&&N&&(0,D.jsx)(Fu().z,{style:X.enabledIcon}),U&&(0,D.jsx)(o(297264).s,{collectionStore:U,propertyId:S,propertySchema:L}),"button"===L.type&&(0,v().O9)(L.automation_id)&&(0,D.jsx)(Zu,{propertyId:S,propertySchema:L,automationId:L.automation_id,collectionViewBlockStore:x}),Boolean(null===(n=L.description)||void 0===n?void 0:n.length)&&!w&&(0,D.jsx)(o(769068).g,{setIsHovered:Y}),(0,D.jsx)(Rt().Jv,{propertySchema:L}),(0,D.jsx)(Rt().Zr,{propertyId:S,collectionContextStore:r}),(0,D.jsx)(Wu,{propertySchema:L})]}),style:X.property,property:S}),W&&(0,D.jsx)($u,{type:"relation"}),G&&(0,D.jsx)($u,{type:"formula"}),V&&(0,D.jsx)(Cu,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(F)})]}):null}),[L,X.button,X.buttonHovered,X.enabledIcon,X.property,a,h,m,N,U,S,x,w,Y,W,G,V,F,r]),J=(0,n.useCallback)((e=>L?(0,D.jsx)(jt().A,{tooltipClassName:we().StS,disableTooltip:W||G,delayThreshold:T?0:500,placement:De().W.Right,renderTooltip:Q,render:t=>Z(t,e)}):null),[L,W,G,Q,T,Z]),ee=(0,n.useCallback)((e=>(0,D.jsx)(Pu,{allowHidingTitle:t,collectionContextStore:r,columnIndex:i,format:c,formatKey:p,parent:e,property:S,schema:f})),[t,r,i,c,p,S,f]);return L?(0,D.jsxs)("div",{ref:b,style:X.container,className:we().P2l,onContextMenu:q,children:[(0,D.jsx)(Lu().dT,{origin:b,store:r}),(0,D.jsx)(qi().Ay,{popupType:w?ja().nl.BottomSheet:ja().nl.Popup,bottomSheetInitialState:"half",disabled:!_.canConfigureBlock,originGap:H?0:1,popupWrapStyle:X.menuWrapper,alignmentToOrigin:qi().yP.Start,buttonPopupStore:P,renderOrigin:J,render:ee,onClick:$})]}):null}));function Yu(e){const{propertyId:t,propertySchema:n,tooltipEvents:r,collectionViewBlockStore:i}=e,l=(0,u().IS)((e=>({description:{color:e.text.contrastSecondary},sharingEnabledTooltip:{marginTop:8,color:e.text.contrastSecondary},personPropertyPermissionsTooltip:{marginTop:8,color:e.text.contrastSecondary},aiUpdate:{color:e.text.contrastSecondary}})),[]),s=(0,d().K8)((()=>(0,Wo().$M)(n)&&(0,Wo().om)(n)),[n]),a=(0,Ou().D)(n),c=(0,d().K8)((()=>i.getCollectionStore()),[i]);return(0,D.jsxs)("div",{...r,style:Eu().Q$,children:[(0,D.jsx)("div",{children:n.name}),void 0!==(null==n?void 0:n.description)&&n.description.length>0?(0,D.jsx)("div",{style:l.description,children:n.description}):null,c&&"relation"===n.type&&a&&(0,D.jsx)(Fu().F,{propertySchema:n,collectionStore:c,style:l.sharingEnabledTooltip}),c&&"person"===n.type&&(0,D.jsx)(o(591872).o,{propertySchema:n,propertyId:t,collectionStore:c,style:l.personPropertyPermissionsTooltip}),s&&s.auto_update_on_edit&&(0,D.jsx)("div",{style:l.aiUpdate,children:(0,D.jsx)(pt().sA,{...Vu().A.keptUpToDateWithNotionAITooltip})}),"button"===n.type&&(0,v().O9)(n.automation_id)&&(0,D.jsx)(Qu,{propertyId:t,propertySchema:n,automationId:n.automation_id,collectionViewBlockStore:i})]})}function Xu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:i}=e,l=(0,d().K8)((()=>o.getSpaceId()),[o]),s=ae().dn.createChildStore(o,{id:t,table:Mu().yB,spaceId:l});return(0,Bu().cN)({automationStore:s,propertyId:n,propertySchema:r,collectionContextStore:i})}function Qu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({wrap:{color:e.text.contrastSecondary}})),[]);return Xu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,te().ET)()})?(0,D.jsx)("div",{style:i.wrap,children:(0,D.jsx)(pt().sA,{...Vu().A.buttonPropertyErrorTooltip})}):null}function Zu(e){const{automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r}=e,i=(0,u().IS)((e=>({icon:{width:14,height:14,marginLeft:5,fill:e.mediumIconColor}})),[]);return Xu({automationId:t,collectionViewBlockStore:o,propertyId:n,propertySchema:r,collectionContextStore:(0,te().ET)()})?(0,Gr().Q)(i.icon):null}var Ju=()=>o(708685);const ep={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1},tp=n.memo((function(e){let{leftFormat:t,height:r,onTemporaryResize:i,onAccept:l,onCancel:a,propertySchema:c,resultStore:d}=e;const u=(0,n.useRef)(void 0),{isPhone:p}=(0,s().Y0)(),[m,g]=(0,n.useState)(!1),[S,h]=(0,n.useState)(!1),f=!p&&(S||m),v=(0,n.useCallback)((e=>{const o=u.current;if(!o||!o.width)return;const n=Math.max(o.width+e.diffX,ip(c,t,o.width,e.optionKey));return{...o,width:n}}),[t,c]),x=(0,n.useCallback)((e=>{e.preventDefault(),u.current=t,h(!0)}),[t]),b=(0,n.useCallback)((e=>{const t=v(e);t&&i(t)}),[v,i]),C=(0,n.useCallback)((e=>{const t=v(e);t&&l(t),h(!1)}),[v,l]),w=(0,n.useCallback)((()=>{a(),u.current=void 0,h(!1)}),[a]),k=(0,n.useCallback)((e=>{const n=d.state?d.state.blockIds:[],r=y().oE(n.map((e=>{const n=o(57618).A.findBlockPropertyValueByBlockId(e,t.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),ip(c,t,t.width)))};l(e)}}),[t,l,c,d]),A=(0,n.useCallback)((e=>(0,D.jsx)("div",{style:f?sp(r):lp(r),onDoubleClick:k,...e})),[k,r,f]);return(0,D.jsx)("div",{style:ep,onMouseMove:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,D.jsx)(bc().A,{onDraggableDragStart:x,onDraggableDragMove:b,onDraggableDragEnd:C,onDraggableDragCancel:w,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:A})})}));const op=32,np=64,rp=100;function ip(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return op;const n=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return op;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return op;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Ju().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return op;if("auto_increment_id"===(null==e?void 0:e.type))return np;return rp}(e,t);return o&&o<n?op:n}function lp(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:nr().Ay.blueWithAlpha(0),cursor:"col-resize"}}function sp(e){return{...lp(e),background:nr().Ay.blueWithAlpha(.8)}}const ap=n.memo((function(e){let{store:t,collectionContextStore:r,schema:i,query:l,disabled:a,formatKey:c,disableCellRightBorder:p,renderSpacer:m,allowHidingTitle:g,paddingTop:S,showRightActions:h,showPropertyFormats:f,resultStore:y,format:v,tableStore:b,height:C,groupsPointer:w,property:k,index:A,isLast:I}=e;const T=(0,s().v3)(),{isMobile:M,isPhone:_}=(0,s().Y0)(),P=(0,n.useRef)(null),B=(0,d().K8)((()=>b.getCurrentFormat(v)),[v,b]),V=f[A],{wikiOnboardingPhase:F,showWikiTooltip:L}=(0,d().K8)((()=>{var e,n,l,s;const a=Au().WH(),c="notion://wiki_collection"===(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())&&t.isCollectionViewPageWithContent()&&t.id===(null===(n=r.collectionViewBlockStore())||void 0===n?void 0:n.id),d=c&&("notion://wiki/owner_property"===k||k===o(931075)._e.Owner)&&"owner"===a,u=c&&"verification"===(null===(l=i[k])||void 0===l?void 0:l.type)&&"verification"===a,p=c&&"multi_select"===(null===(s=i[k])||void 0===s?void 0:s.type)&&"tags"===a;return{wikiOnboardingPhase:a,showWikiTooltip:!M&&(d||u||p)}}),[r,M,k,i,t]),E=(0,d().K8)((()=>p||I&&!Wd(a,h)),[p,a,I,h]),O=(0,d().K8)((()=>(0,R().oe)({environment:T,propertyFormat:V})),[T,V]),z=(0,n.useCallback)((e=>{const t=b.getCurrentFormat(B),o=b.getCurrentProperties(c,t).map((t=>t.property===e.property?e:t)),n={...t,[c]:o};b.setState({...b.state,temporaryFormat:n})}),[b,c,B]),K=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=b.getCurrentFormat(B),n=b.getCurrentProperties(c,B).map((t=>t.property===e.property?e:t)),i={...o,[c]:n};j().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:T,canUndo:!0,perform:e=>{(0,Ai().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),b.setState({...b.state,temporaryFormat:void 0}),(0,x().X)({environment:T,collectionContextStore:r,action:"table_resize_columns"})}),[r,T,B,c,b]),H=(0,n.useCallback)((()=>{b.setState({...b.state,temporaryFormat:void 0})}),[b]),W=(0,u().IS)((()=>({container:{display:"flex",position:"relative"}})),[]);return(0,D.jsxs)("div",{style:W.container,ref:L?P:null,children:[L&&(0,D.jsx)(Ru,{origin:P,propertyType:F}),V&&O&&(0,D.jsx)(qu,{format:B,schema:i,query:l,property:k,width:O,collectionViewBlockStore:t,collectionContextStore:r,disabled:a,formatKey:c,isLast:I,disableCellRightBorder:E,allowHidingTitle:g,renderSpacer:m,paddingTop:S,columnIndex:A,groupsPointer:w}),!a&&!_&&(0,D.jsx)(tp,{leftFormat:V,onTemporaryResize:z,onAccept:K,onCancel:H,height:C,propertySchema:i[k],resultStore:y})]},k)})),cp=p().default.createClass(void 0,{name:"ReducerResultStore"}),dp=n.memo((function(e){let{allowHidingTitle:t,children:o,collectionContextStore:r,disableCellRightBorder:i,disabled:l,disableHorizontalEdgeScroll:a,disableTopBorder:c,format:p,formatKey:m,frozoneProps:g,groupFormat:S,hasMoreReducerResults:h,height:f,isInHomeWidget:y,isInPeekRenderer:v,minWidth:x,paddingLeft:b,paddingRight:C,paddingTop:w,query:k,renderSpacer:A,resultStore:I,schema:j,showHoverActionsStore:R,showPropertyFormats:T,showRightActions:M,store:P,tableStore:B}=e;const V=(0,s().v3)(),F=(0,n.useRef)(null),L=(0,E().X)("db_ux_chrome"),O=(0,d().K8)((()=>(0,_().f5)({environment:V,collectionContextStore:r})),[r,V]),z=(0,d().uB)(I,cp),K=(0,n.useMemo)((()=>S?[S]:[]),[S]),H=(0,n.useMemo)((()=>Wd(l,M)),[l,M]),W=(0,d().K8)((()=>!!R&&R.state),[R]),G=(0,d().K8)((()=>{var e;return null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType()}),[r]),N=(0,d().O$)(r.isUnlistedViewStore),U=(0,_().Oz)(r),$=(0,u().IS)((e=>{const t=y?e.tableHomeDividerColor:e.tableDividerColor,o=y?"transparent":N?e.surface.elevated:v?e.cardContentBackground:(null==U?void 0:U.background)||e.contentBackground,n=K.length>0;return{flex:{display:"flex"},buttonContainer:{display:"flex",justifyContent:"center",alignItems:"center"},headerRow:{display:"flex",background:o,zIndex:87,height:f,color:e.text.secondary,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${c?"":`, inset 0 1px 0 ${t}`}`,minWidth:x,left:"timeline"===G?void 0:0,right:"timeline"===G?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingLeft:b+(L&&n?24:0),paddingRight:C,minWidth:x,background:o,borderRight:"timeline"===G?`1px solid ${e.tableDividerColor}`:void 0,"--timeline-box-shadow":"timeline"===G?"0px":void 0},transitionStickyStyle:{paddingLeft:L&&n?24:0,..."timeline"===G?{borderRight:void 0}:{}}}}),[y,N,null==U?void 0:U.background,v,f,c,x,G,b,L,C,K.length]);return(0,D.jsx)(al().g,{stickyAttachPoint:y?"no-stick":"ceiling",absoluteHeight:f,nodeRef:F,stickyStyle:$.stickyStyle,transitionStickyStyle:$.transitionStickyStyle,children:(0,D.jsxs)("div",{className:we().FYj,style:$.headerRow,dir:"ltr",ref:F,children:[O&&(0,D.jsx)(ku,{groupsPointer:K,collectionContextStore:r,frozoneProps:g,hasMoreReducerResults:Boolean(h)}),(0,D.jsx)(up,{showRightActions:M,store:P,collectionContextStore:r,schema:j,query:k,disabled:l,formatKey:m,disableCellRightBorder:i,renderSpacer:A,allowHidingTitle:t,paddingTop:w,frozoneProps:g,disableTopBorder:c,backgroundColor:$.headerRow.background,disableHorizontalEdgeScroll:a,showPropertyFormats:T,format:p,height:f,tableStore:B,groupsPointer:K,resultStore:z}),(0,D.jsxs)(kt().A,{visible:H,animate:{opacity:W?1:0},style:L?$.buttonContainer:$.flex,children:[(0,D.jsx)(hu,{collectionContextStore:r}),L?null:(0,D.jsx)(fu,{collectionContextStore:r})]}),o]})})})),up=n.memo((function(e){let{allowHidingTitle:t,backgroundColor:o,collectionContextStore:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:l,disableTopBorder:a,disabled:c,format:p,formatKey:m,frozoneProps:g,groupsPointer:S,height:h,paddingTop:f,query:v,renderSpacer:b,resultStore:C,schema:w,showPropertyFormats:k,showRightActions:A,store:I,tableStore:R}=e;const T=(0,s().v3)(),{canConfigureBlock:M}=(0,d().O$)(r.permissionScopesStore),P=(0,d().O$)(r.isInHomeWidgetStore),{frozenIndex:B,unfrozenIndexAddendum:V,stickyLeft:F}=(0,n.useMemo)((()=>{const e=null==g?void 0:g.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,_().qi)(e),stickyLeft:null==g?void 0:g.frozenStyles.left}}),[null==g?void 0:g.frozenIndex,null==g?void 0:g.frozenStyles.left]),{showProperties:L,frozenShowProperties:E,unfrozenShowProperties:O}=(0,n.useMemo)((()=>{const e=k.map((e=>e.property)),[t,o]=[e.slice(0,V),e.slice(V)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[k,V]),z=(0,n.useCallback)((e=>{const t=r.collectionViewStore();if(!t)return;const o=R.getCurrentFormat(p),n=y().Ul(R.getCurrentProperties(m,p),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),i={...o,[m]:n};j().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:T,canUndo:!0,perform:e=>{(0,Ai().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),(0,x().X)({environment:T,collectionContextStore:r,action:"table_reorder_columns"})}),[r,T,p,m,R]),K=(0,u().IS)((e=>{const t=P?e.tableHomeDividerColor:e.tableDividerColor;return{flex:{display:"flex"},frozenStyle:{display:"flex",...null==g?void 0:g.frozenStyles,left:P?vo().hj:F??0,boxShadow:`-3px 0 0 ${o}, inset 0 -1px 0 ${t}${a?"":`, inset 0 1px 0 ${t}`}`}}}),[o,a,null==g?void 0:g.frozenStyles,P,F]),H=(0,n.useMemo)((()=>({frozen:E,unfrozen:O})),[E,O]),W=(0,n.useMemo)((()=>({frozen:K.frozenStyle,unfrozen:{display:"flex"}})),[K.frozenStyle]),G=(0,n.useCallback)(((e,o,n)=>(0,D.jsx)(ap,{collectionContextStore:r,store:I,schema:w,query:v,disabled:c,format:p,formatKey:m,allowHidingTitle:t,showPropertyFormats:k,resultStore:C,showRightActions:A,disableCellRightBorder:i,renderSpacer:b,paddingTop:f,tableStore:R,groupsPointer:S,height:h,property:e,index:o,isLast:n},e)),[t,r,i,c,p,m,S,h,f,v,b,C,w,k,A,I,R]);return c||!M?(0,D.jsxs)("div",{style:da().Z0,children:[(0,D.jsx)("div",{style:K.frozenStyle,children:E.map(((e,t)=>G(e,t,t===L.length-1)))}),O.map(((e,t)=>G(e,t+V,t===L.length-1)))]}):(0,_().Eh)(B)?(0,D.jsx)(du,{style:K.flex,direction:"horizontal",keys:L,sectionedKeys:H,sectionStyles:W,renderKey:G,onDrop:z,disableHorizontalEdgeScroll:l}):(0,D.jsx)(da().Ay,{direction:"horizontal",keys:L,renderKey:G,onDrop:z,disableHorizontalEdgeScroll:l})}));function pp(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:n,shouldFreeze:r}=e,i=(0,u().IS)((()=>({container:{display:"flex",background:o&&n?nr().Ay.blueWithAlpha(.14):void 0}})),[o,n]);return r?(0,D.jsx)(kt().A,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:i.container,children:t},"halo"):(0,D.jsx)(D.Fragment,{children:t})}var mp=()=>o(828634);function gp(e){let{store:t,collectionContextStore:o,children:n,anyWrapping:r}=e;return(0,Vd().DV)()&&r?(0,D.jsx)(Sp,{store:t,collectionContextStore:o,children:n}):(0,D.jsx)("div",{style:{display:"flex"},children:n})}function Sp(e){let{store:t,collectionContextStore:o,children:r}=e;const i=(0,n.useRef)(null),l=(0,n.useRef)(null),s=o.virtualizedModule.getBlockHeightsCache(),a=(0,d().O$)(s.getBlockHeightStore(t.id)),c=(0,n.useCallback)((()=>{s.expandHeightToTallestCached(t.id)}),[s,t]);(0,mp().tK)(0===a?i:l,c);const p=(0,u().IS)((()=>({row:{display:"flex",...a?{height:Math.max(a,xc().tt),overflowY:"clip"}:{}}})),[a]);return(0,D.jsx)("div",{ref:i,style:p.row,children:r})}const hp=n.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:i}=e,l=(0,te().ET)(),a=(0,s().v3)(),c=(0,d().K8)((()=>ce().default.state.stores.includes(t)),[t]),u=(0,d().K8)((()=>{var e;return vu().default.state.isOpen&&(null===(e=vu().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),p=(0,n.useCallback)((e=>{var o;(0,R().ut)({collectionViewBlockId:null===(o=l.collectionViewBlockStore())||void 0===o?void 0:o.id})?A().td({environment:a,stores:[t]}):A().Lt({environment:a,store:t,selectMode:A().gj()?A().SB.MULTI_SELECT_FROM_BOUNDARY:A().SB.TOGGLE}),e.stopPropagation()}),[l,a,t]);return(0,D.jsx)(wu,{checkedState:c,onClick:p,checkboxType:"single_row",collectionContextStore:l,isBlockHovered:u,frozoneProps:i,passesFilter:o,disabled:!r})}));const fp=n.memo((function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,{isMobile:i}=(0,s().Y0)(),l=(null==o?void 0:o.length)??0,a=Math.max((l-1)*ie().yy,0)+ie().Pi,c=(0,u().IS)((()=>{const e=i?xc().Um:xc().tt;return{hiddenContainer:{minWidth:a+ie().yy,...0===r&&n?{marginLeft:-8,marginRight:4}:{}},buttonContainer:{paddingTop:(e-24)/2,display:"flex",...0===r&&n?{marginLeft:-8,marginRight:0,gap:4}:{}},width:{width:a}}}),[a,i,r,n]);return t?(0,D.jsxs)("div",{style:c.buttonContainer,children:[(0,D.jsx)("div",{style:c.width}),t]}):(0,D.jsx)("div",{style:c.hiddenContainer})})),yp=n.memo((function(e){const{propertyFormat:t,index:r,canEdit:i,isLastColumn:l,isRightMostFrozenColumn:a,store:c,schema:p,disabled:m,disableCellBorderRight:g,disableLastCellBorderRight:S,subitemPath:h,onShiftEnter:f,tableWrap:v,subitemFormat:x,forceMouseEntered:b,shouldCaptureKeyboard:C,isLocked:w,toggleButton:k,onPropertyClick:A,titleColumnIndex:I,isSubitemToggleOnTitleColumn:j,onPropertyTab:T,onPropertyUntab:M,onPropertyEnter:_,onPropertyEsc:P,onPropertyBgClick:B,onPropertyContextMenu:V,collectionViewStore:F,collectionStore:L,blockPropertyValueOverlayStore:E,shouldSetCellHeight:O,onOpenProperty:z,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,groupFormat:W,rowIndex:G,isCollectionViewBlockSelected:N,passesFilter:U,isScrolled:$,shouldShowMultiSelectCheckbox:q,isInHomeWidget:Y,normalizedTableSelection:X,hasColumnVirtualizer:Q}=e,{property:Z,wrap:J}=t,oe=(0,s().v3)(),ne=(0,d().K8)((()=>(0,R().oe)({environment:oe,propertyFormat:t})),[oe,t]),re=(0,te().ET)(),ie=(null==h?void 0:h.length)??0,le=x&&(0,R().BC)({columnIndex:r,titleColumnIndex:I,isSubitemToggleOnTitleColumn:j}),se=(0,n.useMemo)((()=>{if(void 0!==ne){if(le){const e=(0,R().si)({columnIndex:r,indentLevel:ie,titleColumnIndex:I,isSubitemToggleOnTitleColumn:j});return ne-e}return ne}}),[ie,r,j,le,I,ne]),ae=(0,n.useCallback)((()=>A(c,Z,p)),[A,Z,p,c]),ce=m||!i,[de,ue]=(0,d().K8)((()=>{const e=re.collectionViewBlockStore();if(!e)return[!1,!1];const t=Gd().A.state;if(!t.isActive||!(0,Gd().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:W})||!X)return[!1,!1];const o=X,{start:n,end:i}=o,l=G===n.row||G===i.row||y().r4(G,n.row,i.row),s=r===n.col||r===i.col||y().r4(r,n.col,i.col);return[l&&s,G===n.row&&r===n.col]}),[re,W,r,X,G]),pe=(0,d().K8)((()=>{const e=re.frozoneStore.state.frozenIndex;return void 0!==e&&r<=e}),[re,r]),me=(0,o(736230).V)({collectionContextStore:re,blockId:c.id,property:Z,featureEnabled:Q}),ge=(0,u().IS)((e=>{const t=Y?e.tableHomeDividerColor:e.tableDividerColor,o=N?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:ne||void 0,height:me?void 0:"100%",position:"relative",borderRight:g||a||l&&S?"none":`1px solid ${pe?o:t}`},tableSelectionOverlay:{background:de?nr().Ay.blueWithAlpha(.07):void 0,borderRadius:ue?3:void 0,boxShadow:ue?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",left:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:se||void 0}}}),[Y,N,ne,me,g,a,l,S,pe,de,ue,se]),Se=(0,D.jsxs)(ee().A,{debugName:"TableRow",capture:C,onShiftEnter:f,children:[(0,D.jsx)(Kr().m,{collectionStore:L,store:c,property:Z,disabled:ce,locked:w,width:se,format:wt().j.Table,forceMouseEntered:b,tableWrap:Boolean(v||J),isLast:l,indentLevel:0===r&&h?h.length:void 0,onTab:T,onUntab:M,onEnter:_,onClick:ae,onEsc:P,onBgClick:B,onContextMenu:V,collectionViewStore:F,shouldSetCellHeight:O,onOpenProperty:z,blockPropertyValueOverlayStore:E,disableHorizontalEdgeScroll:K,handleOpenPeekPage:H,propertyIndex:r,shouldShowMultiSelectCheckbox:q},Z),a&&(0,D.jsx)(Cu,{isCollectionViewBlockSelected:N,passesFilter:U,isScrolled:$})]}),he=(0,n.useRef)(null);return(0,D.jsxs)("div",{ref:he,className:we().WvK,"data-row-index":G,"data-col-index":r,style:ge.tableCell,children:[le?(0,D.jsx)(fp,{subitemFormat:x,toggleButton:k,subitemPath:h,shouldShowMultiSelectCheckbox:q,propertyIndex:r}):null,(0,D.jsx)("div",{style:ge.propertyValueContainer,children:Se}),de&&(0,D.jsx)("div",{style:ge.tableSelectionOverlay})]})})),vp=n.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:s,indexAddendum:a,frozoneProps:c,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g}=e,S=(0,te().ET)(),h=(0,d().K8)((()=>S.collectionViewStore()),[S]),f=(0,d().K8)((()=>_().Dj({store:i,collectionContextStore:S})),[i,S]),y=(0,d().K8)((()=>!t.state.isOpen&&ce().default.state.stores.length>0&&ce().default.state.stores[0].id===i.id),[i.id,t]),v=(0,d().O$)(S.currentSubitemFormatStoreForUiDisplayStore),x=(0,d().K8)((()=>"title"===(null==h?void 0:h.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[h]),b=(0,d().K8)((()=>S.frozoneStore.state.frozenIndex),[S]),C=(0,d().K8)((()=>{if(!p)return;if(m)return;if(S.isInlineViewStore.state&&S.isUnlistedViewStore.state)return;const e=vu().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[p,S,m,i]),w=r??o.length;return(0,D.jsx)(D.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(a??0);return(0,D.jsx)(yp,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:b===r,collectionViewStore:h,collectionStore:f,tableWrap:l,shouldSetCellHeight:s,forceMouseEntered:"title"===e.property?C:void 0,shouldCaptureKeyboard:y,subitemFormat:v,isSubitemToggleOnTitleColumn:x,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:u,canEdit:p,isInHomeWidget:m,...g},e.property)}))})})),xp=n.memo((function(e){let{propertyFormats:t,...o}=e;const{propertiesInRange:n,propertiesInRangeIndices:r,beforeWidth:i,afterWidth:l}=(0,Vd().UB)();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:{width:`${i}px`}}),(0,D.jsx)(vp,{...o,propertyFormats:n,propertyFormatsMap:r}),(0,D.jsx)("div",{style:{width:`${l}px`}})]})})),bp=n.memo(n.forwardRef((function(e,t){const{disabled:o,store:r,groupFormat:i,collectionContextStore:l,propertyFormats:a,frozoneProps:c,passesFilter:p,shouldShowMultiSelectCheckbox:m,isLast:g,isInHomeWidget:S,isCollectionViewBlockSelected:h,allRows:f,isInEphemeralView:y,normalizedTableSelection:v,unfrozenIndexAddendum:x,frozenPropertyFormats:b,unfrozenPropertyFormats:C,tableWrap:w,shouldSetCellHeight:k,isNonEditable:A,shouldShowRightActionSpacer:I,...j}=e,{handleOpenPeekPage:R}=e,T=(0,n.useRef)(null),M=(0,s().v3)(),P=(0,d().K8)((()=>!o&&r.canEdit()),[o,r]),B=(0,n.useMemo)((()=>f.findIndex((e=>e===r))),[f,r]),V=null==c?void 0:c.frozenIndex,F=void 0!==V,L=-1===V,E=(0,d().K8)((()=>{if(void 0===V)return!1;const e=Gd().A.state,t=l.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Gd().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:i})||!v)return!1;const o=v,{start:n}=o;return B===n.row&&n.col<=V}),[i,l,v,V,B]),O=(0,n.useMemo)((()=>F?{...null==c?void 0:c.frozenStyles,...E?{zIndex:86}:{zIndex:85},...L?{background:void 0}:{},...S?{left:vo().hj}:{}}:{}),[F,null==c?void 0:c.frozenStyles,E,L,S]),z=(0,u().IS)((e=>{const t=S?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...g&&S?{}:{borderBottom:`1px solid ${t}`},width:"100%"},checkboxContainer:{position:"absolute",left:-vo().Fh,...!L&&{background:null==c?void 0:c.frozenStyles.background,height:"100%"}}}}),[L,null==c?void 0:c.frozenStyles.background,S,g]),K=(0,n.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=xt().default.state,t=_().wy({environment:M,store:r,mainEditorCurrentBlockStore:e,collectionContextStore:l,fullyQualified:!1,overridePeekMode:y?"center_peek":void 0});t&&(R(),vr().oo({environment:M,url:t}))}),[l,M,R,y,r]),H=(0,Vd().DV)(),W=w||a.some((e=>e.wrap)),G=(0,D.jsxs)(n.Fragment,{children:[(0,D.jsx)("div",{className:we().Eo4,style:z.tableViewRowStyle,dir:"ltr",ref:T,children:(0,D.jsx)(li().c,{store:r,step:"demo_collection_record",children:(0,D.jsxs)(gp,{collectionContextStore:l,store:r,anyWrapping:W,children:[(0,D.jsx)("div",{style:O,children:(0,D.jsx)(pp,{isCollectionViewBlockSelected:h,passesFilter:Boolean(p),shouldFreeze:!L,children:(0,D.jsxs)(D.Fragment,{children:[m&&(0,D.jsx)(kt().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,D.jsx)("div",{style:z.checkboxContainer,children:(0,D.jsx)(hp,{store:r,passesFilter:Boolean(p),frozoneProps:c,canEdit:P})})}),(0,D.jsx)(vp,{store:r,canEdit:P,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:k,indexAddendum:0,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:A,isCollectionViewBlockSelected:h,passesFilter:Boolean(p),shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j})]})})}),H?(0,D.jsx)(xp,{store:r,canEdit:P,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:A,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j}):(0,D.jsx)(vp,{store:r,canEdit:P,propertyFormats:C,visiblePropertiesLength:C.length,shouldSetCellHeight:k,indexAddendum:x,rowIndex:B,disabled:o,groupFormat:i,tableWrap:w,isLocked:A,isCollectionViewBlockSelected:h,passesFilter:!0,shouldShowMultiSelectCheckbox:m,frozoneProps:c,normalizedTableSelection:v,isInHomeWidget:S,...j})]})})}),I?(0,D.jsx)("div",{style:{...z.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Be().NW)(r,t,(0,n.useMemo)((()=>({renderedType:"table_row",getNode:()=>T.current,getBlockStore:()=>r,activate:K})),[K,r]),G)})));const Cp=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:a}=e,c=(0,s().v3)(),p=(0,te().Ks)(),m=(0,n.useRef)(null),g=(0,n.useRef)(null),[S,h]=n.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[f,v]=n.useState(0),[x,b]=n.useState(0),C=(0,d().K8)((()=>t.state.isRepositioning||S.isMouseDown),[t,S.isMouseDown]),w=(0,d().K8)((()=>t.state.newFrozenIndex),[t]),k=(0,d().K8)((()=>!!p&&(0,_().f5)({environment:c,collectionContextStore:p})),[c,p]),A=(0,d().K8)((()=>null==p?void 0:p.frozoneStore.state.isScrolled),[p]),I=(0,d().K8)((()=>!A&&-1===o&&k?-4:0),[o,A,k]),j=(0,d().K8)((()=>S.isEntered||C),[S.isEntered,C]),T=(0,d().K8)((()=>t.state.newFrozenColumnXPosition),[t]),M=(0,n.useContext)(ye().R),P=null==M?void 0:M.horizontalScroller,B=(0,n.useCallback)((()=>{var e,t,o;if(!P||!m.current)return 0;const n=(null===(e=m.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(we().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[P]),V=(0,n.useCallback)((()=>{var e,t,o,n,r;if(!P||!m.current)return 0;const i=(null===(e=m.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(we().Eo4),s=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(n=P.getNode())||void 0===n?void 0:n.getElementsByClassName(we().Mbm),c=a&&a.length>0?null===(r=a[a.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(s,c)-i}),[P]),F=(0,d().K8)((()=>{var e;const t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==a?new DOMRect(t.x+a+S.x+10,t.y+S.y+10,3,3):void 0}),[a,S]),L=(0,d().K8)((()=>{const e=(null==p?void 0:p.frozoneStore.state.scrollerLeftOffset)??0,t=(0,Oe().kf)(c),o=Math.max(t-e,0);return p&&(0,R().QP)(c,p)?o:0}),[p,c]),E=(0,d().K8)((()=>p&&(0,_().f5)({environment:c,collectionContextStore:p})),[p,c]),O=(0,n.useCallback)((e=>{if(void 0===o||void 0===r||void 0===a||null===m.current||null===g.current)return;const n=m.current.getBoundingClientRect(),s=e.clientX-n.x;if(null==p||p.frozoneStore.setState({...null==p?void 0:p.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!j)return;const c=B();v(c);const d=V();b(d);const u=2+a,S=Math.max(s-u,-u),f=e.clientY-n.y-14,y=n.bottom-n.top-14+d,x=C?c:-14,w=Math.max(Math.min(f,y),x);if(h((e=>({...e,x:C?S:0,y:w}))),C){const e=l,n=g.current.getBoundingClientRect();let c=s,d=i,u=-1,p=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,A&&t===o+1&&(c-=n.x);const i=Math.abs(d-c);i<m&&(m=i,p=d,u=t)}t.setState({...t.state,newFrozenIndex:u,newFrozenColumnXPosition:p-a-1})}}),[o,r,a,null==p?void 0:p.frozoneStore,j,B,V,C,l,i,t,A]);(0,n.useEffect)((()=>{const e=y().nF((e=>{O(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[O]);const z=(0,n.useCallback)((e=>{C||(O(e.nativeEvent),h((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[C,O]),K=(0,n.useCallback)((e=>{C||h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[C]),H=(0,n.useCallback)((e=>{h((e=>({...e,isMouseDown:!0})))}),[]),W=(0,n.useCallback)((e=>{C&&h((e=>({...e,isEntered:!0})))}),[C]),G=(0,n.useCallback)((e=>{h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,n.useCallback)((e=>{C&&h((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[C]),U=(0,u().IS)((e=>{const t=void 0!==w&&void 0!==o&&w<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:C?"grabbing":"grab",pointerEvents:C?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:L+(E?vo().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",left:-1!==a||A?a??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:C?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:C?S.x-1:-1,top:C?f:0,width:2,height:C?`calc(100% + ${x-f}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:C?f:0,width:1,height:C?`calc(100% + ${x-f}px`:"100%",background:e.accentColors.uiBlue[300]},frozenGhostColumn:{left:T,opacity:C&&t?1:0},unfrozenGhostColumn:{left:(a??0)+(T??0),opacity:j&&C&&!t?1:0},tooltipDraggable:{position:"absolute",left:C?S.x-2:-2,top:S.y,width:4,height:28,background:e.accentColors.uiBlue[600],borderRadius:4}}}),[w,o,C,L,E,a,A,S.x,S.y,f,x,T,j]);return(0,D.jsx)("div",{className:we().FZs,style:U.repositionerContainer,onMouseEnter:W,onMouseLeave:G,onMouseUp:N,children:(0,D.jsxs)("div",{style:U.repositionerOutsideStickyWrapper,ref:g,children:[(0,D.jsx)("div",{style:U.repositionerInsideStickyWrapper,ref:m,children:(0,D.jsx)(jt().A,{renderTooltip:()=>C&&void 0!==w&&w!==o?(0,D.jsx)(pt().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:w+1}}):(0,D.jsx)(pt().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:C||void 0,placement:De().W.Right,originRect:F,render:e=>(0,D.jsxs)(kt().A,{animate:{translateX:I,opacity:j?1:0},...e,style:U.tooltipContainer,children:[(0,D.jsx)("div",{style:U.tooltipOrigin,onMouseEnter:z,onMouseLeave:K,onMouseDown:H}),(0,D.jsx)("div",{style:{...U.ghostColumnBase,...U.frozenGhostColumn}}),(0,D.jsx)("div",{style:U.tooltipColumn}),(0,D.jsx)("div",{style:U.tooltipDraggable})]})})}),(0,D.jsx)("div",{style:{...U.ghostColumnBase,...U.unfrozenGhostColumn}})]})})},wp={tableSelectionOverlayActions:new(se().O2)("tableSelectionOverlayActions",(async()=>await o.e(95496).then(o.bind(o,339016)))),tableSelectionOverlayPropertyActions:new(se().O2)("tableSelectionOverlayPropertyActions",(async()=>await o.e(40589).then(o.bind(o,233035))))};var kp=()=>o(556148);class Ap extends p().default{getInitialState(){}}const Ip=Ap;class jp extends p().default{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const Rp=jp,Tp=new Set(["rollup","formula","verification"]);function Mp(e){var t;const{dragAndFillStore:o,frozenIndex:r,rowsWrapRect:i,schema:l,selection:a,selectionStartRectStore:c,showPropertyFormats:p}=e,m=(0,s().v3)(),g=(0,te().ET)(),S=(0,d().O$)(o),h=(0,d().K8)((()=>{const e=(null==S?void 0:S.start)||a.start;return p[e.col]}),[S,a,p]),f=h?null===(t=l[h.property])||void 0===t?void 0:t.type:void 0,y=(0,d().O$)(c),v=(0,d().K8)((()=>void 0!==r&&a.start.col<=r),[r,a]),x=(0,d().K8)((()=>g.isInHomeWidgetStore.state),[g]),b=(0,d().K8)((()=>(0,_().f5)({environment:m,collectionContextStore:g})),[g,m]),C=(0,u().IS)((e=>{const t=v?91:85,o=v?"sticky":void 0;let n=0;x?n=vo().hj:b&&(n=vo().Fh);return{dragAndFillContainer:{zIndex:t,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:o,left:n},tooltipContainer:y?{position:"absolute",left:y.left+y.width-6-(b?vo().Fh:0)}:{},tooltipOrigin:{position:"absolute",left:0,top:y?y.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:y?y.bottom-5:void 0,width:9,height:9,border:`2px solid ${nr().Ay.blueWithAlpha(.57)}`,transform:S?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.text.contrastSecondary,maxWidth:200,...Ro().RC}}}),[v,x,b,y,S]),w=(0,n.useMemo)((()=>{if(y&&i)return new DOMRect(y.x+i.x+y.width-4,y.y+i.y+y.height-4,7,7)}),[y,i]),k=(0,n.useCallback)((()=>(0,D.jsx)(pt().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),A=(0,n.useCallback)((e=>(0,D.jsx)("div",{...e,className:we().yle,style:C.dragAndFillContainer,children:(0,D.jsx)("div",{style:C.dragAndFillOutsideStickyWrapper,children:(0,D.jsx)("div",{style:C.dragAndFillInsideStickyWrapper,children:(0,D.jsxs)("div",{style:C.tooltipContainer,children:[(0,D.jsx)("div",{style:C.tooltipOrigin}),(0,D.jsx)("div",{style:C.tooltipCircle})]})})})})),[C]);return y?!f||(0,Wo().F_)(f)||Tp.has(f)?null:(0,D.jsx)(jt().A,{renderTooltip:k,delayThreshold:300,forceVisibleState:!!S||void 0,originRect:w,placement:De().W.Right,render:A}):null}const _p=n.memo((function(e){const{groupFormat:t}=e,r=(0,s().v3)(),i=(0,n.useContext)(ri().n),l=(0,n.useRef)(null),a=(0,n.useRef)(void 0),c=(0,E().X)("improved_drag_and_fill"),{value:u}=(0,se().fJ)(oe().g),{value:p}=(0,se().fJ)(ne().S),{value:m}=(0,se().fJ)(ve().T.formulas),g=(0,n.useMemo)((()=>wp.tableSelectionOverlayActions.load()),[]),S=(0,d().uB)(void 0,Ip),h=(0,d().uB)(void 0,Rp),f=(0,d().r6)((()=>(0,ie().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),y=(0,d().K8)((()=>(0,_().f5)({environment:r,collectionContextStore:e.collectionContextStore})),[r,e.collectionContextStore]),v=(0,d().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),x=(0,d().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=Gd().A.state;if(!r.isActive||!(0,Gd().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,R().yR)(r.selection,e.showPropertyFormats.length,f.state.length);return o(4319).kn(f.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,f]),b=(0,d().O$)(x),C=(0,d().K8)((()=>{const e=x.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[x]),w=(0,d().K8)((()=>{const e=x.state;return e&&e.start.row===e.end.row}),[x]),k=c?w:C,A=(0,d().r6)((()=>{const t=x.state;if(!t)return;if(!l.current)return;const o=t.start,n=e.showPropertyFormats,i=f.state[o.row],s=(0,kp().Xw)(i,l.current);if(!s)return;const a=l.current.getBoundingClientRect(),c=s.height,d=s.top-a.top-1,u=n[o.col].width||0,p=c+1;let m=(0,kp().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[f,r,x,e.collectionContextStore,e.showPropertyFormats]),I=(0,d().r6)((()=>{const t=x.state;if(!t||!w)return;if(!l.current)return;const o=t.end,n=e.showPropertyFormats,i=f.state[o.row],s=(0,kp().Xw)(i,l.current);if(!s)return;const a=l.current.getBoundingClientRect(),c=s.height,d=s.top-a.top-1,u=n[o.col].width||0,p=c+1;let m=(0,kp().$u)(e.collectionContextStore,r);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(m+=t.width)}return new DOMRect(m-1,d,u+1,p)}),[f,r,w,x,e.collectionContextStore,e.showPropertyFormats]),j=c?I:A,T=(0,d().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),M=(0,d().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),P=(0,d().r6)((()=>{const t=T.state;if(void 0!==t){let o=(0,kp().$u)(e.collectionContextStore,r);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(y?vo().Fh:0)}}),[T,y,e.collectionContextStore,e.showPropertyFormats,r]),B=(0,d().K8)((()=>(0,kp().$u)(e.collectionContextStore,r)-(y?vo().Fh:0)),[e.collectionContextStore,r,y]),V=(0,d().K8)((()=>{let t=!1;const o=(0,kp().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=ce().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==T.state&&!S.state&&!t&&!Gd().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[S,T,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,n.useEffect)((()=>{l.current&&(a.current=new MutationObserver((()=>{A.recompute()})),a.current.observe(l.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=a.current;return()=>{e&&e.disconnect()}}),[A]);const F=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,r,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,x,f,P,T]),L=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),O=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Up,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),z=(0,n.useCallback)((async t=>{(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Down,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),K=(0,n.useCallback)((async t=>{(await g).handleEnter({shortcutEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),H=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Right,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),W=(0,n.useCallback)((async t=>{t.preventDefault();(await g).handleDirection({shortcutOrKeyboardEvent:t,direction:kp().Dp.Left,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats]),G=(0,n.useCallback)((async e=>{(await g).handleEsc({keyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,g]),N=(0,n.useCallback)((async()=>{(await g).handleDelete({environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[f,r,x,e.collectionContextStore,e.disabled,e.showPropertyFormats,g]),U=(0,n.useCallback)((async t=>{(await g).handleCut({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,formulasModule:m})}),[g,r,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,x,f,m]),$=(0,n.useCallback)((async t=>{(await g).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:f.state,formulasModule:m,normalizedTableSelection:x.state})}),[g,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,f,m,x]),q=(0,n.useCallback)((async t=>{const o=await g,n=await X().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:v,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:u,tinyMceMicrosoftWordPasteFilter:p,disabled:e.disabled,allRows:f.state,clipboardActions:n,normalizedTableSelection:x.state})}),[g,f,r,u,x,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,v,p]),Y=(0,n.useCallback)((async()=>{(await g).handleCommandEnter({environment:r,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,overrideLinkClick:i})}),[f,r,x,i,e.collectionContextStore,g]),Q=(0,n.useCallback)((async()=>{(await g).handleShiftEnter({environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:A,frozenSectionWidth:P.state,frozenIndex:T.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,T,P,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,A]),Z=(0,n.useCallback)((async()=>{(await g).handleCommandShiftEnter({environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x]),J=(0,n.useCallback)((async t=>{(await g).handleDuplicate({keyboardEvent:t,environment:r,disabled:e.disabled,schema:v,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x,v,e.disabled,e.showPropertyFormats]),te=(0,n.useCallback)((async t=>{(await g).handleKeypress({keyboardEvent:t,environment:r,schema:v,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:x.state,allRows:f.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[g,f,r,x,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,v]),re=(0,n.useCallback)((async e=>{(await g).handleMoveTo({shortcutOrKeyboardEvent:e,environment:r,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,r,x]),le=(0,n.useCallback)((async t=>{(await g).handleDragStart({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:S,frozenColumnRepositionStore:h,frozenIndex:T.state,allRows:f.state,normalizedTableSelection:x.state})}),[g,f,S,r,h,T,x,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),ae=(0,n.useCallback)((async t=>{(await g).handleDragMove({dragEvent:t,environment:r,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state,selectionStartRectStore:A})}),[g,f,S,r,h,x,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,A]),de=(0,n.useCallback)((async()=>{(await g).handleDragEnd({environment:r,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:v,dragAndFillStore:S,frozenColumnRepositionStore:h,normalizedTableSelection:x.state,allRows:f.state})}),[g,f,S,r,h,x,e.collectionContextStore,e.showPropertyFormats,v]),ue=(0,n.useCallback)((async()=>{(await g).handleDragCancel({dragAndFillStore:S,frozenColumnRepositionStore:h})}),[S,h,g]);return(0,D.jsx)(ee().A,{debugName:"TableSelectionOverlay",capture:void 0!==b,onLeft:F,onRight:L,onUp:O,onDown:z,onEnter:K,onTab:H,onUntab:W,onEsc:G,onDelete:N,onBackspace:N,onCut:U,onCopy:$,onPaste:q,onCommandEnter:Y,onShiftEnter:Q,onCommandShiftEnter:Z,onDuplicate:J,onKeypress:te,onMoveTo:re,children:(0,D.jsx)(bc().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:le,onDraggableDragMove:ae,onDraggableDragEnd:de,onDraggableDragCancel:ue,render:t=>{var o;return(0,D.jsxs)("div",{ref:l,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,kp().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&b&&(k||S.state)?(0,D.jsx)(Mp,{dragAndFillStore:S,frozenIndex:T.state,rowsWrapRect:null===(o=l.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:v,selection:b,selectionStartRectStore:j,showPropertyFormats:e.showPropertyFormats}):null,V&&(0,D.jsx)(Cp,{frozenColumnRepositionStore:h,xForFirstCellInRow:B,maxFrozenIndex:M,showPropertyFormats:e.showPropertyFormats,frozenIndex:T.state,frozenSectionWidth:P.state}),(0,D.jsx)(Pp,{...e,allRowsStore:f,selectionStartRectStore:A,normalizedTableSelectionStore:x,frozenSectionWidthStore:P,frozenIndexStore:T})]})}})})}),No().A),Pp=n.memo((function(e){const t=(0,s().v3)(),o=(0,n.useMemo)((()=>wp.tableSelectionOverlayActions.load()),[]),r=(0,n.useMemo)((()=>wp.tableSelectionOverlayPropertyActions.load()),[]),i=(0,n.useMemo)((()=>({onPropertyTab:async()=>{(await r).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await r).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await r).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,n,i)=>{(await r).handlePropertyClick({store:o,property:n,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await r).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await r).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await r).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await r).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,r,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,D.jsx)(D.Fragment,{children:e.render(i)})}),No().A);function Bp(e){const{isFullScreen:t,hasGroups:o,propertyWidths:n,hasPartialResults:r,hasSearchQuery:i,frozoneProps:l}=e,a=(0,s().v3)(),c=(0,u().DP)(),p=(0,s().Y0)().isPhone,m=(0,te().Ks)(),g=(0,Jr().A)(!0,0,100),S=(0,d().K8)((()=>Boolean(null==m?void 0:m.normalizedFormatStore.state.hide_table_vertical_lines)),[m]),h=l.isScrolled,f=l.frozenIndex,y=void 0!==f,v=(0,d().K8)((()=>{if(!m)return!1;const e=m.collectionViewBlockStore();return!!e&&(0,zd().d1)(e)}),[m]),x=(0,d().K8)((()=>m?(0,R().wy)({environment:a,collectionContextStore:m,isPhone:p,theme:c}):{}),[m,a,p,c]),b=(0,d().K8)((()=>Boolean(null==m?void 0:m.isInHomeWidgetStore.state)),[null==m?void 0:m.isInHomeWidgetStore]),C=(0,u().IS)((e=>{let t="0x 16px";return y?t=void 0:b&&(t=0),{container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...x,...-1===f?{background:void 0}:{}},rowContainer:{display:"flex",alignItems:"flex-start",padding:t,borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:y?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:S?void 0:`1px solid ${e.tableDividerColor}`}}}),[y,b,x,f,S]);if(!g||!m)return null;const w=n.map(((e,t)=>(0,D.jsx)("div",{style:{...C.column,width:e},children:(0,D.jsx)(eo().A,{style:{...C.rowShimmer,width:.6*(e-16)}})},t)));let k=null,A=[];if(y&&void 0!==f){const e=w.slice(0,f+1);k=(0,D.jsxs)("div",{style:C.frozenColumnsContainer,children:[(0,D.jsx)(pp,{isCollectionViewBlockSelected:v,passesFilter:!0,shouldFreeze:-1!==f,children:e}),e.length>0?(0,D.jsx)(Cu,{isCollectionViewBlockSelected:v,passesFilter:!0,isShimmerRow:!0,isScrolled:h}):null]}),A=w.slice(f+1,w.length)}else A=w;let I=1;o||r||i||(I=t?10:3);const j=[...Array(I)].map(((e,t)=>(0,D.jsxs)("div",{style:C.rowContainer,children:[k,A]},t)));return(0,D.jsx)("div",{style:C.container,children:(0,D.jsx)("div",{style:C.rowsContainer,children:j})})}const Vp=n.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:r,disabled:i,format:l,groupFormat:a,isFullScreen:c,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,query:f,schema:y,showHoverActionsStore:v,store:x,tableStore:b,headerWidth:C}=e,w=(0,E().X)("db_ux_chrome"),k=(0,E().X)("db_ux_empty_states"),A=(0,s().v3)(),{isMobile:I,isPhone:T}=(0,s().Y0)(),M=(0,pt().tz)(),P=(0,u().DP)(),B=(0,n.useContext)(ri().n),V=(0,fe().Zp)(),F=(0,n.useMemo)((()=>a?[a]:[]),[a]),{groupState:L,groupCount:O}=(0,d().K8)((()=>({groupState:r.groupsStore.getGroupState(F),groupCount:r.groupsStore.getAllGroupStates().length})),[r.groupsStore,F]),{reducerResult:z,isReady:K,hasPartialResults:H,pageCount:W,shouldShowShimmer:G}=(0,d().K8)((()=>{const e=null==L?void 0:L.reducerResultStore.state,t=void 0!==e,o=(null==e?void 0:e.blockIds.length)||0,n=void 0!==e&&e.blockIds.length>0;return{reducerResult:e,isReady:t,hasPartialResults:n,pageCount:o,shouldShowShimmer:(0,Qn().iv)({collectionContextStore:r,groupsPointer:F,hasPartialResults:n})}}),[r,L,F]),N=0===W&&K&&!G,U=(0,d().K8)((()=>(0,Qn().Kk)({collectionContextStore:r,groupsPointer:F})),[r,F]),$=(0,d().O$)(r.permissionScopesStore),q=(0,Be().bx)(e.store,e.disabled),Y=(0,d().K8)((()=>!!q&&(!$.isSyncedCollection&&$.canEditContent)),[q,$]),{showPropertyFormats:X,titleColumnIndex:Q,propertyWidths:Z,totalPropertyWidth:J}=(0,d().K8)((()=>{const e=(0,R().GW)(l,b).filter((e=>e.visible)),t=e.findIndex((e=>{let{property:t}=e;return"title"===t})),o=e.map((e=>{let{width:t}=e;return t||Ed().kp}));return{showPropertyFormats:e,titleColumnIndex:t,propertyWidths:o,totalPropertyWidth:e.reduce(((e,t)=>e+(t.width||0)),0)}}),[l,b],{useDeepEqual:!0}),ee=(0,d().K8)((()=>(0,R().Ty)(l,b)),[l,b]),te=(0,d().K8)((()=>J+($.canEditContent?32:0)),[J,$]),oe=(0,d().K8)((()=>"collectionTypedView"===r.contextType),[r]),ne=(0,d().O$)(r.isInHomeWidgetStore),re=(0,d().O$)(r.isUnlistedViewStore),le=(0,d().O$)(r.isInlineViewStore),se=re&&le,ae=(0,d().K8)((()=>(0,Ce().sj)(x.id)),[x]),de=(0,d().K8)((()=>_().fG({collectionContextStore:r,environment:A,intl:M})),[r,A,M]),ue=(0,d().K8)((()=>{const e=Boolean(r.currentCombinatorFilterStore.state),t=r.currentPropertyFiltersStore.state.length>0;return e||t}),[r]),pe=(0,d().K8)((()=>""!==r.searchQueryStore.state),[r]),me=(0,n.useMemo)((()=>k&&N&&(ue||pe)),[k,N,ue,pe]),{shouldShowAddRowButton:ge,canAddRow:Se}=(0,d().K8)((()=>{const e=K&&!ne&&(Y||oe)&&Boolean(r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}));return me?{shouldShowAddRowButton:!1,canAddRow:e}:{shouldShowAddRowButton:e,canAddRow:e}}),[me,K,ne,Y,oe,r]),he=Boolean(a),ye=(0,d().K8)((()=>!me&&(K&&!G&&0===W&&ge&&!ue&&!he)),[ue,me,W,K,G,ge,he]),ve=(0,n.useMemo)((()=>c?4:2),[c]),xe=(0,d().K8)((()=>{var e;return Boolean(null===(e=f.aggregations)||void 0===e?void 0:e.length)}),[f]),be=(0,d().K8)((()=>!me&&(!(k&&!xe)&&!(re||null!=V&&V.hideTableAggregationRow))),[k,me,re,null==V?void 0:V.hideTableAggregationRow,xe]),Ae=(0,d().K8)((()=>_().XQ({collectionContextStore:r,reducerResult:z,isFullScreen:c})),[r,c,z]),Ie=(0,d().K8)((()=>r.viewIsFlushToTopbar()),[r]),je=(0,d().K8)((()=>Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines)),[r]),Re=(0,d().K8)((()=>{const e=(0,ie().v2)(F[0],r);return ce().default.state.stores.filter((t=>e.includes(t))).length>0}),[F,r]),Me=(0,d().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=r.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,R().wy)({environment:A,collectionContextStore:r,isPhone:T,theme:P}),display:"flex",...e&&-1===t&&{height:"calc(100% - 1px)",borderBottom:`1px solid ${P.tableDividerColor}`}},i=Boolean(e&&-1===t),l=Boolean(i&&(o||Re)),s=r.collectionViewBlockStore(),a=!!s&&(0,zd().d1)(s);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:i,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:a}}),[Re,r,A,T,P],{useDeepEqual:!0}),_e=(0,d().K8)((()=>{const e=r.collectionViewStore();return Y&&I&&!(null!=e&&e.isSyncedCollection())}),[Y,r,I]),Pe=(0,d().O$)(r.defaultPageTemplateStore),Ve=(0,d().K8)((()=>{var e,o;const n=null===(e=r.collectionStore())||void 0===e?void 0:e.id;return(t.state.isOpen&&(null===(o=t.state.collectionContextStore)||void 0===o||null===(o=o.collectionStore())||void 0===o?void 0:o.id))===n}),[t,r]),[Fe,Le]=(0,n.useState)(!1),Ee=(0,n.useCallback)((()=>{Le(!0)}),[]),Oe=(0,n.useCallback)((()=>{Le(!1)}),[]),De=(0,n.useCallback)((()=>{if(!L)return;const e=r.collectionStore();if(!e||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o=ce().default.state.stores[0];if(!o)return;const n=r.subitemTreeStore.state,i=(0,en().Qe)(n.children,(e=>e.value.store===o));if(!i)return;const l=i?(0,ie().kY)(i.map((e=>e.value.store))):"",s=r.subitemExpandedStore.state.get(l);Boolean(null==s?void 0:s.isExpanded)&&j().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:A,canUndo:!0,perform:n=>{const l=(0,_n().u)({environment:A,collectionContextStore:r,groupsPointer:L.groupsPointer,store:o,before:!1,collectionStore:e,transaction:n,subitemPath:i,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&t){const e=()=>{Tn().ho({isNewBlock:!0,environment:A,blockPropertyValueOverlayStore:t,store:l,property:"title",format:wt().j.Table,collectionContextStore:r})};r.registerCallbackForItemMounted(l,e)}}})}),[t,r,A,L]),ze=(0,n.useCallback)((e=>{const n=new(o(838256).aD)(A,"handleAddRowClick");if(!(0,Xe().EF)(A)||!L)return n.fail("invalid_state"),void(0,Xe().QY)(A);r.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:r,isFullScreen:c}),j().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:A,canUndo:!0,perform:e=>{const o=(0,Zn().Q)({environment:A,collectionContextStore:r,groupsPointer:a?[a]:[],shouldCoerce:!0,templateStore:Pe,transaction:e,from:{createBlock:"table_group_results"},tracker:n,inMemoryRecordCache:A.defaultRecordCache.inMemoryRecordCache});if(!o)return;const i=o.newStore;if(I){const e=(0,Ar().Ay)({store:i,fullyQualified:!1,pageVisitSource:To().y8.Create});B?B(e):vr().oo({environment:A,url:e})}else{if(o.coercionSucceeded){const o=()=>{Tn().ho({isNewBlock:!0,environment:A,blockPropertyValueOverlayStore:t,store:i,property:"title",format:wt().j.Table,collectionContextStore:r})};r.registerCallbackForItemMounted(i,o),e.postSubmitCallbacks.push((async e=>{if(!e)return r.virtualizedModule.waitToScrollToBlock(F,i)}))}else Ko().VU({environment:A,store:i,peekMode:_().hH(r),resultsStore:L.resultsStore,collectionContextStore:r,pageVisitSource:To().y8.Create});const n=r.currentSubitemFormatStoreForCollectionStore.state;jn().v(A,{from:n?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:i.id,creating_block_id:i.id,...(0,ke().sl)(r)})}}})}),[A,L,r,c,a,Pe,I,B,t,F]),Ke=(0,n.useCallback)((e=>{L&&((0,Te().kV)(e),z&&(0,$o().H)({collectionContextStore:r,environment:A,incrementLimitArgs:{isFullScreen:c,currentResultCount:z.blockIds.length,groupsPointer:L.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,Od().K)(A))}),[r,A,L,c,z]),He=(0,_().Oz)(r),We=(0,u().IS)((e=>{const{button:t,buttonInner:o,icon:n}=(0,R().BJ)({theme:e,isMobile:I,hideTextWithTransition:ye&&Fe,hideTextWithoutTransition:ye&&Ve});return{wrapper:{position:"relative",marginLeft:w&&F.length>0?24:void 0},iconStyle:n,viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...t,borderBottom:k?`1px solid ${e.tableDividerColor}`:void 0,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...U?{background:e.whiteButtonBackground}:{background:e.tableRowHoveredBackground}},loadMoreButtonInner:o,text:{color:e.text.tertiary,flexGrow:1},addRowButtonWrapper:{...t,display:"flex",alignItems:"center",gap:w?4:2,paddingLeft:2,paddingRight:2},addRowButton:{...w?{display:"inline-flex",height:28,borderRadius:6,paddingLeft:6,paddingRight:8}:{...t},background:(null==He?void 0:He.background)||(p?e.cardContentBackground:e.contentBackground)},addRowButtonHovered:{background:w?e.buttonHoveredBackground:e.tableRowHoveredBackground},addRowButtonInner:o,linkExistingButton:{paddingLeft:6,paddingRight:8,borderRadius:6,marginLeft:w?void 0:12},linkExistingButtonInner:{display:"flex",alignItems:"center",gap:8,fontSize:14,height:28,color:e.text.tertiary},linkExistingIcon:{width:16,height:16,fill:e.icon.tertiary},aggregationRow:{...(!K||ne)&&{opacity:0,pointerEvents:"none",left:0,right:0}},spinner:{marginTop:1,marginLeft:8,marginRight:8}}}),[I,k,ye,Fe,Ve,w,F.length,U,null==He?void 0:He.background,p,K,ne]),Ge=(0,n.useCallback)((e=>(0,D.jsx)(Fp,{args:e,store:x,collectionContextStore:r,collectionViewFormat:ee,blockPropertyValueOverlayStore:t,groupFormat:a,groupsPointer:F,propertyFormats:X,schema:y,canDrag:_e,disabled:i,titleColumnIndex:Q,onShiftEnter:De,frozoneProps:Me,isInHomeWidget:ne,isFullScreen:c,isInEphemeralView:se})),[x,r,ee,t,a,F,X,y,_e,i,Q,De,Me,ne,c,se]);return L?(0,D.jsxs)("div",{style:We.wrapper,children:[(0,D.jsx)(dp,{store:x,format:ee,groupFormat:a,schema:y,query:f,collectionContextStore:r,isInPeekRenderer:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,blockPropertyValueOverlayStore:t,resultStore:L.reducerResultStore,showPropertyFormats:X,showRightActions:$.canConfigureCollection&&$.canConfigureBlock&&!se&&!ae,showHoverActionsStore:v,allowHidingTitle:!1,tableStore:b,formatKey:"table_properties",disabled:i||!$.canConfigureBlock,disableTopBorder:!Ie||he||w,disableCellRightBorder:!Ie||he||je||w,height:vo().sH,frozoneProps:Me,isInHomeWidget:ne,hasMoreReducerResults:Boolean(null==z?void 0:z.hasMore)}),(0,D.jsx)(_p,{store:x,collectionContextStore:r,minWidth:m,blockPropertyValueOverlayStore:t,showPropertyFormats:X,disabled:!Y,groupFormat:a,tableStore:b,paddingLeft:S,render:Ge}),G&&(0,D.jsx)(Bp,{isFullScreen:c,hasGroups:void 0!==a,propertyWidths:Z,hasPartialResults:H,hasSearchQuery:pe,frozoneProps:Me}),ye?(0,D.jsx)(Qd,{collectionContextStore:r,handleAddRowClick:ze,numberOfBlankRows:ve,hideDefaultButtonText:Fe,propertyFormats:X,isBlockPropertyValueOverlayOpen:Ve,query:f}):N?(0,D.jsx)(ou,{collectionContextStore:r,groupFormat:a,shouldShowAddRowButton:Se,shouldShowLinkButton:de,hasFilter:ue,hasSearchQuery:pe,handleAddRowClick:ze,hasMultipleGroups:O>1,left:Math.floor(C/2)}):null,(0,D.jsx)("div",{style:{width:te}}),Ae&&(ne?(0,D.jsx)(qo().jJ,{groupsPointer:F,store:x,collectionContextStore:r,format:l,isFullScreen:c,incrementLimitsInRelatedGroups:!1,style:We.viewAllButton}):(0,D.jsx)(At().A,{onMouseDown:Te().tr,onClick:Ke,disabled:U,hoveredStyle:We.loadMoreButtonHovered,style:We.loadMoreButton,children:(0,D.jsxs)("span",{style:We.loadMoreButtonInner,children:[(0,kn().g)(We.iconStyle),(0,D.jsx)("div",{style:We.text,children:(0,D.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),U?(0,D.jsx)("div",{style:We.spinner,children:(0,D.jsx)(pr().A,{size:"sm"})}):Y&&(0,D.jsx)(Dd().w,{collectionContextStore:r,format:l})]})})),ge&&!ye&&w&&(0,D.jsxs)("div",{style:We.addRowButtonWrapper,children:[(0,D.jsx)(At().A,{onClick:ze,onMouseDown:Te().tr,style:We.addRowButton,hoveredStyle:We.addRowButtonHovered,className:we().$0P,children:(0,D.jsxs)("span",{style:We.addRowButtonInner,children:[(0,or().plusSmallIcon)(We.iconStyle),(0,D.jsx)(ir,{collectionContextStore:r})]})}),de&&(0,D.jsx)(Sr().O,{collectionContextStore:r,groupFormat:a,renderLinkButton:e=>(0,D.jsx)(At().A,{style:We.linkExistingButton,...e,children:(0,D.jsxs)("span",{style:We.linkExistingButtonInner,children:[(0,Fl().arrowDiagonalUpRightSmallIcon)(We.linkExistingIcon),(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]}),ge&&!ye&&!w&&(0,D.jsx)(At().A,{onClick:ze,onMouseDown:Te().tr,style:We.addRowButton,hoveredStyle:We.addRowButtonHovered,className:we().$0P,children:(0,D.jsxs)("span",{style:We.addRowButtonInner,children:[(0,or().plusSmallIcon)(We.iconStyle),(0,D.jsx)(ir,{collectionContextStore:r}),de&&(0,D.jsx)(Sr().O,{collectionContextStore:r,groupFormat:a,renderLinkButton:e=>(0,D.jsx)(At().A,{style:We.linkExistingButton,...e,children:(0,D.jsxs)("span",{style:We.linkExistingButtonInner,children:[(0,Fl().arrowDiagonalUpRightSmallIcon)(We.linkExistingIcon),(0,D.jsx)(pt().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})})]})}),be&&(0,D.jsx)(Yd,{pageCount:W,collectionContextStore:r,disabled:i||!$.canConfigureBlock,groupFormat:a,isFullScreen:c,isInPeekRenderer:p,onMouseEnter:Ee,onMouseLeave:Oe,paddingLeft:S,paddingRight:h,query:f,schema:y,showPropertyFormats:X,showRightActionsSpacer:$.canConfigureCollection,style:We.aggregationRow})]}):null})),Fp=n.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:r,collectionContextStore:i,collectionViewFormat:l,disabled:a,frozoneProps:c,groupFormat:p,groupsPointer:m,isFullScreen:g,isInHomeWidget:S,onShiftEnter:h,propertyFormats:f,schema:y,store:v,titleColumnIndex:x,isInEphemeralView:b}=e,C=(0,s().v3)(),w=(0,d().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),k=(0,d().K8)((()=>_().f5({environment:C,collectionContextStore:i})),[i,C]),A=(0,d().K8)((()=>v.isNonEditableState()),[v]),I=(0,u().IS)((()=>({itemSelectableHalo:{borderRadius:3,zIndex:86},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),j=(0,n.useCallback)((()=>I.itemSelectableStyle),[I]),T=(0,n.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,D.jsx)(bd,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:a,groupsPointer:m,onSubitemCreate:e=>{if(o){const t=()=>{Tn().ho({isNewBlock:!0,environment:C,blockPropertyValueOverlayStore:o,store:e,property:"title",format:wt().j.Table,collectionContextStore:i})};i.registerCallbackForItemMounted(e,t)}}})}),[o,i,a,C,m]),M=(0,d().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,zd().d1)(e)}),[i]),P=(0,d().K8)((()=>(0,ie().v2)(p,i)),[p,i]),B=(0,d().K8)((()=>{const e=Gd().A.state;if(e.isActive)return(0,R().yR)(e.selection,f.length,P.length)}),[P.length,f.length]),V=null==c?void 0:c.frozenIndex,F=(0,d().K8)((()=>_().qi(V)),[V]),[L,E]=(0,n.useMemo)((()=>void 0!==V?[f.slice(0,V+1),f.slice(V+1)]:[[],f]),[V,f]),O=(0,d().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),z=(0,d().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!O&&!f.some((e=>e.wrap)))}),[i,f,O]),K=(0,d().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),H=(0,d().K8)((()=>{var e;return!S&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,S]),W=(0,Vd().DV)(),G=(0,n.useMemo)((()=>({schema:y,collectionContextStore:i,propertyFormats:f,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:a,blockPropertyValueOverlayStore:o,disableCellBorderRight:w,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:A,disableTableWrap:!1,onShiftEnter:h,titleColumnIndex:x,groupFormat:p,frozoneProps:c,shouldShowMultiSelectCheckbox:k,isInHomeWidget:S,isCollectionViewBlockSelected:M,allRows:P,isInEphemeralView:b,normalizedTableSelection:B,unfrozenIndexAddendum:F,frozenPropertyFormats:L,unfrozenPropertyFormats:E,tableWrap:O,shouldSetCellHeight:z,isNonEditable:K,shouldShowRightActionSpacer:H,hasColumnVirtualizer:W})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,a,w,h,f,y,x,p,c,k,A,S,M,P,b,B,F,L,E,O,z,K,H,W]),N=g;return(0,D.jsx)(Wn,{collectionContextStore:i,groupsPointer:m,format:l,canDrag:r,resultProps:G,canDrop:!0,resultComponent:bp,disabled:a,direction:Kn.Vertical,getItemSelectableStyle:j,itemSelectableHaloStyle:I.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:x,nestedCreateSubitemButton:T,virtualizeResults:N})}),No().A),Lp=n.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,collectionContextStore:l,format:a,schema:c,disabled:p,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,isPreviewing:h,query:f,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,minWidth:x,placementStore:b,headerWidth:C}=e,w=(0,s().v3)(),k=(0,d().uB)(void 0,Bd),A=(0,n.useRef)(null),I=(0,E().X)("db_ux_chrome"),j=a.collection_group_by,T=m&&!j,M=(0,d().K8)((()=>(0,R().GW)(a,k)),[a,k]),P=(0,d().K8)((()=>(0,_().mM)(l,m)),[l,m]),B=(0,d().K8)((()=>l.isInHomeWidgetStore.state),[l.isInHomeWidgetStore]),V=(0,d().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),F=(0,d().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===b.state;return e&&t}),[l.settingsStore,b]),L=n.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<Ke().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,$o().H)({collectionContextStore:l,environment:w,incrementLimitArgs:{isFullScreen:m,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,w,m]),O=(0,u().IS)((()=>({selectable:{position:"relative",marginRight:F?yo().vE:void 0},container:{position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingLeft:r,paddingRight:i,marginTop:I?4:0}})),[o,r,i,F,I]),z=(0,fe().Zp)();return(0,ei().A)((e=>{const n=(0,D.jsx)(lt().A,{store:t,shouldShowHalo:!m&&!B&&!h,canSelect:!m&&!V,disablePointerEvents:null==z?void 0:z.disableAllPointerEvents,analyticsName:"table",style:O.selectable,...e,children:j?(0,D.jsx)(Ep,{collectionContextStore:l,store:t,format:a,schema:c,query:f,isFullScreen:m,isRootChild:g,isInPeekRenderer:S,paddingLeft:r,paddingBottom:o,paddingRight:i,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p,headerWidth:C}):(0,D.jsx)(Dp,{collectionContextStore:l,store:t,format:a,schema:c,query:f,isFullScreen:m,isInPeekRenderer:S,paddingLeft:r,paddingRight:i,paddingBottom:o,minWidth:x,tableStore:k,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,disabled:p,groupFormat:void 0,headerWidth:C})});return(0,D.jsx)("div",{className:we().EOV,style:O.container,ref:A,children:(0,D.jsxs)(zn.Provider,{value:A,children:[j?(0,D.jsx)(Ld,{collectionContextStore:l,tableProperties:M,paddingLeft:r,paddingRight:i,children:n}):(0,D.jsx)(Pl,{nodeRef:A,children:(0,D.jsx)(Ld,{collectionContextStore:l,tableProperties:M,paddingLeft:r,paddingRight:i,children:n})}),!P&&!T&&(0,D.jsx)(Xn().A,{onChange:e=>L(e)})]})})}))})),Ep=n.memo((function(e){let{collectionContextStore:t,store:o,format:r,schema:i,query:l,disabled:a,isFullScreen:c,paddingLeft:d,paddingRight:p,isRootChild:m,isInPeekRenderer:g,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,tableStore:v,headerWidth:x}=e;const C=(0,s().v3)(),w=(0,u().IS)((e=>({groupDivider:{borderTop:`1px solid ${e.tableDividerColor}`}})),[]),k=(0,E().X)("db_ux_chrome"),A=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:"collection_group_by",groupsFormatKey:Mo().V1}})}),[t]),I=(0,n.useCallback)(((e,t)=>k&&0===e.index?{marginTop:4}:k||t.isInHomeWidgetStore.state?{}:0!==e.index||t.viewIsFlushToTopbar()?e.index>0&&t.shouldShowSpinnerStore.state?{}:w.groupDivider:{}),[k,w.groupDivider]),j=(0,n.useCallback)(((e,o)=>{if(C.device.isMobile)zo().uK({environment:C,store:e,pageVisitSource:To().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextType;Ko().VU({environment:C,store:e,peekMode:(0,_().hH)(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:To().y8.Create})}}),[t,C]);return(0,D.jsx)(Ps,{reducerId:"table_groups",store:o,collectionContextStore:t,disabled:a,isFullScreen:c,isRootChild:m,paddingLeft:d,stickyLeft:!0,renderGroup:e=>(0,D.jsx)(Dp,{store:o,format:r,schema:i,query:l,collectionContextStore:t,showHoverActionsStore:S,isFullScreen:c,isInPeekRenderer:g,disabled:a,blockPropertyValueOverlayStore:h,minWidth:f,paddingBottom:y,paddingLeft:d,paddingRight:p,tableStore:v,groupFormat:e,headerWidth:x}),onClickEmptyStateButton:A,getGroupStyle:e=>I(e,t),renderHeader:e=>(0,D.jsx)(Op,{args:e,isInPeekRenderer:g}),onGroupHeaderAddItem:(e,t,o)=>{j(e,o)}})})),Op=n.memo((function(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:n}=t,r=(0,d().O$)(n.isInHomeWidgetStore),i=(0,u().IS)((e=>({stickyStyle:{boxShadow:`0 -1px 0 ${o?e.cardContentBackground:e.contentBackground}`}})),[o]);return(0,D.jsx)(dl,{...t,height:r?ft().ag:vo().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:i.stickyStyle})})),Dp=n.memo((function(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,tableStore:f,headerWidth:y}=e;const v=(0,d().uB)(f,Bd);return(0,d().K8)((()=>l.groupsStore.getGroupState(t?[t]:[])),[l,t])?(0,D.jsx)(Vp,{tableStore:v,groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,showHoverActionsStore:s,isFullScreen:a,isInPeekRenderer:c,disabled:u,blockPropertyValueOverlayStore:p,minWidth:m,paddingBottom:g,paddingLeft:S,paddingRight:h,headerWidth:y}):null}));var zp=()=>o(717989),Kp=()=>o(839106);class Hp extends p().default{constructor(){super("hiddenGroupsVisibleStore")}getInitialState(){return!1}}class Wp extends p().default{getInitialState(){return new Set}}class Gp extends(()=>o(959180))().A{constructor(){super(...arguments),this.itemsRefStore=new Wp}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const Np=new Gp;(0,o(604341).exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Np);var Up=()=>o(396182),$p=()=>o(931121),qp=()=>o(259464);const Yp=15,Xp=33,Qp=12,Zp={position:"absolute",left:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function Jp(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+Qp,o.top=o.top-Yp)),o):o}function em(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:a,isFullScreen:c,isRootChild:p,relationType:m,isUserDrawnTemp:g,isNewSubitemPlaceholder:S,renderEmitter:h}=e,f=(0,te().ET)(),y=(0,s().v3)(),v=(0,Up().I)(),[x,b]=(0,n.useState)(!1),C=(0,u().DP)(),[w,k]=(0,n.useState)(null),[A,I]=(0,n.useState)(null),j=(0,n.useCallback)((e=>{k(e.state)}),[]),R=(0,n.useCallback)((e=>{I(e.state)}),[]),T=(0,n.useCallback)((()=>{l().default.afterNextFlush((()=>{v("CollectionTimelineRelationArrow","CollectionTimelineRelationArrow/resetTopPositions")}))}),[v]);(0,n.useEffect)((()=>(k(t.stores.nodeStore.state),I(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(j),null==o||o.stores.nodeStore.addListener(R),null==h||h.addListener(T),f.filtersBarOpenStore.addListener(T),()=>{t.stores.nodeStore.removeListener(j),null==o||o.stores.nodeStore.removeListener(R),null==h||h.removeListener(T),f.filtersBarOpenStore.removeListener(T)})),[t,o,h,j,R,T,f.filtersBarOpenStore]);const M=(0,d().K8)((()=>nn().Ay.state.isDragging&&nn().Ay.state.draggedStores.includes(t.props.store)),[t]),_=(0,d().K8)((()=>o&&nn().Ay.state.isDragging&&nn().Ay.state.draggedStores.includes(o.props.store)),[o]),P=(0,d().K8)((()=>{const e=nn().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),B=w&&w.getBoundingClientRect().y+(M?P:0),V=(0,d().K8)((()=>{const e=t.itemPositionStore.state;return B&&e?{left:e.left,right:"subitem"===m?e.left+Qp:e.right,top:"subitem"===m?B+Yp:B}:void 0}),[m,t.itemPositionStore,B]),F=A&&A.getBoundingClientRect().y+(_?P:0),L=(0,d().K8)((()=>{const e=F&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:F}:void 0;return"subitem"===m?Jp({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,F,m,t.itemPositionStore]),E=(0,d().O$)(t.dateValueStore),O=(0,d().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),z=(0,d().K8)((()=>void 0!==i.dragStateStore.state),[i]),K=(0,d().K8)((()=>void 0!==i.drawStateStore.state),[i]),H=(0,d().O$)(i.hoveredItemStore),W=x&&!z&&!K,G=(0,n.useCallback)((()=>{r&&!a&&zp().cd({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:f,environment:y,timelineState:i,isFullScreen:c,isRootChild:p})}),[t,a,r,f,y,i,c,p]),N=(0,n.useCallback)((()=>{b(!0)}),[b]),U=(0,n.useCallback)((()=>{b(!1)}),[b]),$=(0,n.useCallback)((e=>{if(L)return(0,D.jsx)(tm,{topOffset:e,endPosition:L,handleCloseButtonClick:G})}),[L,G]),q=(0,d().O$)(f.permissionScopesStore),Y=H===t.props.store,X=o&&H===o.props.store,Q=Y||X||W||"subitem"===m?1:.7;let Z;const J=(0,d().K8)((()=>t.props.store.canEdit()),[t.props.store]),ee=(0,d().K8)((()=>"subitem"!==m&&(J&&("collectionTypedView"===f.contextType||q.canEditContent))),[m,J,f,q.canEditContent]);"subitem"===m?Z=C.collectionUnsetDependencyArrow:E&&O&&(Z=E<=O?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const oe=(0,u().IS)((()=>({svgStyle:{zIndex:"dependency"===m&&(W||X)?86:83}})),[m,W,X]);return V?g?(0,D.jsx)(om,{startPosition:V,timelineState:i}):S?(0,D.jsx)(nm,{startPosition:V,timelineState:i}):t!==o&&L?(0,D.jsx)(rm,{startPosition:V,endPosition:L,strokeOpacity:Q,strokeColorOverride:Z,svgStyle:oe.svgStyle,cornerRadiusOverride:"subitem"===m?8:void 0,relationType:m,handleMouseMove:N,handleMouseLeave:U,renderChildren:ee&&W?$:void 0}):null:null}function tm(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,u().IS)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,$p().J)(r.icon)})})}function om(e){const{startPosition:t,timelineState:o}=e,n=(0,d().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore]);return n?(0,D.jsx)(rm,{startPosition:t,endPosition:n,strokeOpacity:1,relationType:"dependency"}):null}function nm(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,u().DP)(),i=(0,d().O$)(n.dateRangePlaceholderStore),l=(0,d().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),s=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=s?s[s.length-1].children.length:0,c=o.top+a*Xp+Yp+5,p=(0,d().K8)((()=>{const e=(0,xo().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return Jp({startItemPosition:o,value:t})}),[l,c,o,n]);return p?(0,D.jsx)(rm,{startPosition:o,endPosition:p,strokeOpacity:1,strokeColorOverride:r.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function rm(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:l,relationType:s,svgStyle:a,handleMouseMove:c,handleMouseLeave:p}=e,m=(0,te().ET)(),g=(0,u().DP)(),[S,h]=(0,n.useState)(0),f=t.right,y=t.top+Yp-S,v=o.left-3,x=o.top+Yp-S,b=(0,d().K8)((()=>{if(r)return r;return(0,xo().tH)(m)&&t.right&&o.left?t.right<o.left?g.collectionValidDependencyArrow:g.collectionInvalidDependencyArrow:g.collectionUnsetDependencyArrow}),[m,o.left,t.right,r,g]);return(0,D.jsx)("svg",{style:{...Zp,...a},ref:e=>{e&&h(e.getBoundingClientRect().top)},children:(0,D.jsx)(qp().A,{startPoint:{x:f,y},endPoint:{x:v,y:x},style:{stroke:b,strokeWidth:xo().cC,strokeOpacity:l},useRightAngles:"subitem"===s,showArrowHead:"dependency"===s&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:p,children:e.renderChildren&&e.renderChildren(S)})})}function im(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:l,renderEmitter:s}=e,a=(0,te().ET)(),c=(0,n.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),u=(0,d().K8)((()=>a.collectionViewBlockStore()),[a]),p=(0,d().K8)((()=>a.settingsStore.state.open),[a]);if((0,n.useEffect)((()=>{var e;!p&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[p,t.drawStateStore,c]),!r||!u)return null;const m=Np.findCollectionTimelineViewItems(u);return(0,D.jsx)(D.Fragment,{children:m.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,Mo().AC)(c):"noGroup";return(0,D.jsxs)(n.Fragment,{children:[(0,D.jsx)(lm,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,D.jsx)(lm,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function lm(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,relationType:s,renderEmitter:a}=e,{store:c,schema:u}=t.props,p=(0,te().ET)(),m=(0,d().K8)((()=>"dependency"===s?o.drawStateStore.state:void 0),[o.drawStateStore,s]),g=(0,d().K8)((()=>(null==m?void 0:m.startStore)===c),[c,m]),S=(0,d().K8)((()=>g&&!(null!=m&&m.tryToCompleteDrawnArrow)),[m,g]),h=(0,d().K8)((()=>"dependency"===s?g&&m?m.temporaryDependencyRelationPointers:(0,xo().GW)(p,c,u):"subitem"===s?(0,xo().s0)(p,c,u):[]),[s,g,m,p,c,u]),f=(0,d().K8)((()=>p.collectionViewBlockStore()),[p]),y=(0,d().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==s||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[s,t.props.store,o.dateRangePlaceholderStore]),v=(0,d().K8)((()=>[...Np.getItemsRefStore().state]),[]);return f?(0,D.jsxs)(D.Fragment,{children:[h.map((e=>{if(c.id===e.id)return null;const d=v.filter((t=>t.props.store.id===e.id));return(0,D.jsx)(n.Fragment,{children:d.map((n=>{const c=n.props.store,d=n.props.groupFormat;return(0,D.jsx)(em,{startItem:t,endItem:n,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:s},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===s&&S&&(0,D.jsx)(em,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}),"subitem"===s&&y&&(0,D.jsx)(em,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"})]}):null}const sm=n.memo((function(e){const{zoomLevel:t,onChange:o}=e,r=(0,s().Y0)(),i=(0,u().IS)((e=>({icon:{width:10,marginLeft:4,fill:e.mediumIconColor}})),[]),l=(0,n.useMemo)((()=>(0,is().b)(i.icon)),[i.icon]),a=(0,n.useCallback)((e=>(0,D.jsxs)(ur().p,{size:"sm",isGray:!0,...e,children:[(0,D.jsx)(am,{zoomLevel:t}),l]})),[l,t]),c=(0,n.useCallback)((e=>(0,D.jsx)(cm,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,D.jsx)(qi().Ay,{popupType:r.isMobile?ja().nl.SlideUp:ja().nl.Popup,originGap:8,renderOrigin:a,render:c})})),am=n.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,D.jsx)(pt().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,v().HB)(t)})),cm=n.memo((function(e){const{zoomLevel:t,onChange:o,parent:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,n.useMemo)((()=>[{key:"calendar by section",render:e=>(0,D.jsx)(Pi().A,{...e}),items:Ed().Ui.map((e=>{const t={key:e,render:t=>(0,D.jsx)($i().A,{...t,title:(0,D.jsx)(am,{zoomLevel:e})}),action:()=>{o(e),r.close()}};return t}))}]),[o,r]),a=(0,n.useCallback)((e=>{const o=i?{menuType:ji().gu.Modal,title:(0,D.jsx)(pt().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:r.close,...e}:{menuType:ji().gu.Popup,width:180,...e};return(0,D.jsx)(Ti().A,{...o,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,sections:l,initialFocus:Ed().Ui.indexOf(t)})})}),[i,r.close,l,t]);return(0,D.jsx)(it().A,{capture:!0,allowEsc:!0,render:a})})),dm=6,um=xo().tp+xo().lH,pm=n.memo((function(e){let{timelineState:t,scrollerLeftOffset:i,paddingLeft:l,showTable:a,isFullScreen:c,isRootChild:p,isReady:m,collectionContextStore:g,isInPeekRenderer:S,format:h,paddingRight:f}=e;const y=(0,u().DP)(),v=(0,s().v3)(),x=(0,d().K8)((()=>{const e=t.zoomLevelStore.state,{primaryDisplayUnit:o,secondaryDisplayUnit:n}=xo().eM[e],s=t.scrollLeftStore.state,{startTimestamp:d}=t.currentRangeStore.state;if(void 0!==s){const t=d+(0,xo().C1)(e,s+i+(!a&&c?l:0));return(0,xo().DY)(r().c9.fromMillis(t),o).startOf(n).valueOf()}}),[t,i,l,a,c]),b=(0,s().Y0)(),C=(0,d().O$)(t.zoomLevelStore),w=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:k}=xo().eM[C],A=(0,d().K8)((()=>(0,xo().DG)({environment:v,isFullScreen:c,isRootChild:p})),[v,c,p]),I=(0,d().O$)(g.permissionScopesStore),R=!a&&A&&I.canConfigureBlock,T=(0,_().Oz)(g),M=(null==T?void 0:T.background)||(S?y.cardContentBackground:y.contentBackground),P=S?y.cardContentBackgroundTransparent:y.contentBackgroundTransparent,B=(0,u().IS)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingLeft:c&&!a?i+l:i,display:"flex",alignItems:"center",height:um,paddingTop:dm+(b.isMobile?2:0),background:M,fontSize:14,fontWeight:Ro().Wy.medium},outerContainer:{position:"sticky",left:0,width:w,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,right:"var(--sticky-horizontal-offset, 0px)",paddingRight:f,display:"flex",alignItems:"center",height:um,paddingTop:dm+1,background:M},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:b.isIOS?0:1,height:22,fill:y.lightIconColor}})),[M,b.isIOS,b.isMobile,c,w,l,f,i,a,y.lightIconColor]),V=(0,n.useRef)(null),F=(0,n.useCallback)((e=>{zp().k3({timelineState:t,environment:v,zoomLevel:e,centerTimestamp:(0,xo().o$)(t)}),(0,Kp().z2)(v,(0,Kp().ZR)({environment:v,collectionContextStore:g,timelineState:t,isFullScreen:c,isRootChild:p}))}),[t,v,g,c,p]);return(0,D.jsx)(al().g,{stickyAttachPoint:"ceiling",nodeRef:V,noPlaceholder:!0,children:(0,D.jsxs)("div",{style:B.outerContainer,ref:V,children:[x&&(0,D.jsxs)("div",{style:B.secondaryDisplayUnit,children:[R&&(0,D.jsx)(jt().A,{render:e=>(0,D.jsx)(ur().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;j().createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,xo().iH)(t,!0);Oo().zA({stores:[l],update:o,transaction:e})}}),(0,Kp().VD)(e,{...(0,Kp().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(v,h,t,g,c,p),style:B.hideTableIcon,...e,children:(0,o(996624).a)({width:14})}),renderTooltip:()=>(0,D.jsx)(pt().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,D.jsx)("span",{style:{paddingLeft:R||b.isPhone?0:c||a?16:2},children:(0,xo().Kx)(x,k)}),!m&&!a&&(0,D.jsx)(mm,{}),(0,D.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${M} 20%, ${P} 100%)`}})]}),(0,D.jsxs)("div",{style:B.controlBarRight,children:[(0,D.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${M} 20%, ${P} 100%)`}}),(0,D.jsx)(id,{collectionContextStore:g}),(0,D.jsx)(sm,{zoomLevel:C,onChange:F}),(0,D.jsx)(ur().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,xo().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,xo().o$)(t),p=u-(0,xo().C1)(s,d);zp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,Kp().i6)(e,{...(0,Kp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(v,t,l,h,c,p,g),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,Gc().I)({width:12,fill:y.mediumIconColor})}),(0,D.jsx)(ur().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=(0,xo().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});zp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:a}),(0,Kp().AP)(e,{...(0,Kp().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(v,t,l,h,g,c,p),children:(0,D.jsx)(pt().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,D.jsx)(ur().p,{size:"sm",isGray:!0,onClick:()=>function(e,t,o,n,r,i,l){const s=t.zoomLevelStore.state,a=t.outerSizeObserver.rect.state.width,c=(0,xo().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(a-c)/2,u=(0,xo().o$)(t),p=u+(0,xo().C1)(s,d);zp().k3({timelineState:t,environment:e,zoomLevel:s,centerTimestamp:p}),(0,Kp().i6)(e,{...(0,Kp().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(v,t,l,h,c,p,g),style:{paddingLeft:4,paddingRight:4},children:(0,Nc().V)({width:12,fill:y.mediumIconColor})})]})]})})}));function mm(){return(0,Jr().A)(!0,400,0)?(0,D.jsx)(pr().A,{style:{marginLeft:8,marginTop:1}}):null}var gm=()=>o(496506),Sm=()=>o(402390);function hm(e){const{shouldShowShimmer:t,children:o}=e,n=(0,Jr().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,D.jsx)("div",{className:n,style:{height:"100%"},children:o})}const fm=4,ym=22,vm=110,xm=7,bm=22,Cm=12,wm=4,km=32;function Am(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:a,schema:c}=e,p=(0,s().Y0)(),m=(0,pt().tz)(),g=(0,E().X)("db_ux_chrome"),S=(0,n.useRef)(null),{value:h}=(0,se().fJ)(ve().T.formulas),f=(0,Up().I)(),v=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&f("CollectionTimelineViewTimeBar","CollectionTimelineViewTimeBar/handleSeconds")}),[f]);(0,n.useEffect)((()=>{const e=setInterval(v,1e3);return()=>clearInterval(e)}),[v]);const{primaryDisplayUnit:x,activeRangeType:b}=(0,d().K8)((()=>{const e=l.zoomLevelStore.state;return xo().eM[e]}),[l]),C=(0,xo().LH)(x),w=r().c9.now(),k=C?w.startOf("minute"):w.startOf("day"),A=w.startOf("minute"),I=(0,d().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Qn().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),j=(0,d().K8)((()=>o.viewIsFlushToTopbar()),[o]),R=new(gm().default)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:s}=xo().eM[n];if(!s)return;let d;if(t)d=t.temporaryValues.map((e=>(0,xo().yl)(e,"day")));else if(i.active)d=[(0,xo().yl)(i.date,"day")];else{const{stores:t}=ce().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=y().sb(y().oE([...n,r]));d=y().oE(i.map((e=>{const t=(0,xo().GM)({store:e,query:a,schema:c,userId:o.getCurrentUserId(),intl:m,formulasModule:h});if(t)return(0,xo().yl)(t,"day")})))}const u=y().wq(d,(e=>{let{start:t}=e;return t.valueOf()})),p=y().Sk(d,(e=>{let{end:t}=e;return t.valueOf()}));return u&&p?{start:u.start.valueOf(),end:p.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),T=null===(t=(0,_().Oz)(o))||void 0===t?void 0:t.background,M=(0,u().IS)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:T||(i?e.cardContentBackground:e.contentBackground),boxSizing:"border-box",boxShadow:j&&!g?`inset 0 var(--timeline-box-shadow, 1px) 0 0 ${e.tableDividerColor}`:void 0},controlBar:{height:um,position:"relative",overflow:"hidden"},primaryTimeBar:{height:km,boxShadow:`inset 0 -1px 0 0 ${e.tableDividerColor}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0,"--timeline-box-shadow":"0px"},transitionStickyStyle:{display:"none"}})),[T,g,i,j]);return(0,D.jsx)(al().g,{stickyAttachPoint:"ceiling",nodeRef:S,stickyStyle:M.stickyStyle,transitionStickyStyle:M.transitionStickyStyle,noPlaceholder:!0,children:(0,D.jsxs)("div",{style:M.wrapper,ref:S,children:[(0,D.jsx)("div",{style:M.controlBar,children:!p.isPhone&&(0,D.jsx)(Fm,{timelineState:l})}),(0,D.jsxs)("div",{style:M.primaryTimeBar,children:[(0,D.jsx)(hm,{shouldShowShimmer:I,children:(0,D.jsx)(Vm,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:k})}),"highlight_days"===b&&(0,D.jsx)(Em,{timelineState:l,activeRangeStore:R}),(0,D.jsx)(Lm,{timelineState:l,time:k}),"display_range"===b&&(0,D.jsx)(Em,{timelineState:l,activeRangeStore:R})]}),(0,D.jsx)(Mm,{timelineState:l,time:A})]})})}function Im(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:s}=xo().eM[r],a=(0,xo().DY)(t,l),c=(0,xo().Vz)(t,l),d=(0,xo().w0)(r,a.valueOf()-i),u=(0,xo().w0)(r,t.valueOf()-i),p=(0,xo().w0)(r,c.valueOf()-i)-d,m=o?wm:0;return{left:("range_start"===s?u-p/2:u)-m,width:p+2*m}}function jm(e){return{color:e.text.primary,fontSize:Cm}}function Rm(e){return{background:e.timelineRed,width:bm,height:bm,borderRadius:bm/2,position:"absolute",left:`calc(50% - ${bm/2}px)`,top:`calc(50% - ${bm/2}px)`}}function Tm(e){const{time:t,accent:o,timelineState:r}=e,i=(0,d().O$)(r.zoomLevelStore),{left:l,width:s}=(0,d().K8)((()=>Im({time:t,isNowIndicator:!1,timelineState:r})),[t,r]),a=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:l,width:s,height:km-4,display:"flex",alignItems:"start",lineHeight:km-4+"px"},text:{fontSize:Cm,margin:"0 auto"},singleColor:{color:o?e.text.primary:e.text.tertiary},twoColorDarker:{color:o?e.text.primary:e.text.secondary},twoColorLighter:{color:o?e.text.secondary:e.text.tertiary}})),[o,l,s]),c=(0,n.useMemo)((()=>{const{primaryDisplayUnit:t}=xo().eM[i],o=e.time.setLocale(Wc().locale),n=(0,xo().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,D.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,D.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,D.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,D.jsxs)(D.Fragment,{children:[t,e]}):(0,D.jsxs)(D.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,D.jsx)("span",{style:a.singleColor,children:o.toFormat("H:mm")});{const e=(0,D.jsx)("span",{style:{...a.twoColorDarker,paddingRight:r?void 0:3},children:o.toFormat("h")}),t=(0,D.jsx)("span",{style:{...a.twoColorLighter,paddingRight:r?3:void 0},children:o.toFormat("a")});return r?(0,D.jsxs)(D.Fragment,{children:[t,e]}):(0,D.jsxs)(D.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("span",{style:{...a.twoColorLighter,paddingRight:3},children:o.toFormat("ccccc")}),(0,D.jsx)("span",{style:{...a.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,D.jsx)("span",{style:a.singleColor,children:o.toFormat("d")}):"month"===t?(0,D.jsx)("span",{style:a.singleColor,children:o.toFormat("M")}):void(0,v().HB)(t)}),[i,e.time,a.singleColor,a.twoColorDarker,a.twoColorLighter]);return(0,D.jsx)("div",{style:a.container,children:(0,D.jsx)("div",{style:a.text,children:c})})}function Mm(e){const{time:t,timelineState:o}=e,r=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i}=(0,d().O$)(o.currentRangeStore),l=(0,n.useMemo)((()=>Math.floor((0,xo().w0)(r,t.valueOf()-i))),[r,t,i]),s=(0,u().IS)((e=>({container:{position:"absolute",left:l-xm/2+.5,top:Math.floor(km+um-xm/2+.5),width:xm,height:xm,background:e.timelineRed,borderRadius:"100%"}})),[l]);return(0,D.jsx)("div",{style:s.container})}function _m(e){const{time:t,timelineState:o,intl:r}=e,{isMobile:i}=(0,s().Y0)(),l=(0,d().O$)(o.zoomLevelStore),{startTimestamp:a}=(0,d().O$)(o.currentRangeStore),c=(0,n.useMemo)((()=>(0,xo().w0)(l,t.valueOf()-a)),[l,t,a]),p=(0,n.useMemo)((()=>{const{secondaryDisplayUnit:e}=xo().eM[l];return(0,xo().u7)((0,Sm().H)(r),t.valueOf(),e)}),[l,r,t]),m=(0,u().IS)((e=>({container:{position:"absolute",top:0,left:c,height:km,color:e.text.primary,fontSize:14,fontWeight:Ro().Wy.medium,verticalAlign:"middle",paddingTop:dm+(i?2:7),display:"flex",alignItems:"center"}})),[i,c]);return(0,D.jsx)("div",{style:m.container,children:p},c)}function Pm(e){let{start:t,end:o,rangeWidth:n}=e;const r=(0,u().DP)();return t&&o?n>=vm?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:jm(r),children:(0,vc().W_)(t.valueOf(),"month_day",Wc().locale)}),(0,D.jsx)("div",{style:{flexGrow:1}}),(0,D.jsx)("div",{style:jm(r),children:(0,vc().W_)(o.valueOf(),"month_day",Wc().locale)})]}):(0,D.jsxs)("div",{style:jm(r),children:[(0,vc().W_)(t.valueOf(),"month_day",Wc().locale)," â€“ ",t.month===o.month?(0,vc().W_)(o.valueOf(),"day",Wc().locale):(0,vc().W_)(o.valueOf(),"month_day",Wc().locale)]}):(0,D.jsx)("div",{style:jm(r),children:(0,vc().W_)(t.valueOf(),"month_day",Wc().locale)})}function Bm(e,t,o,n){const r=e.setLocale(Wc().locale),i=(0,xo().LH)(o),l=(0,xo().IW)();return i?l?(0,D.jsx)("span",{style:{color:n.timelineRed},children:r.toFormat("H:mm")}):(0,D.jsx)("span",{style:{color:n.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("span",{style:{color:n.text.tertiary,paddingRight:3},children:r.toFormat("ccccc")}),(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)("div",{style:Rm(n)}),(0,D.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)("div",{style:Rm(n)}),(0,D.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}function Vm(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const n=(0,d().O$)(o.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(o.currentRangeStore),s=xo().eM[n],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:c}=s,u=c||0,p=(0,d().K8)((()=>Im({time:t,isNowIndicator:!0,timelineState:o})),[t,o]),m=p.left+u,g=p.left+p.width-u,S=[];let h=(0,xo().DY)(r().c9.fromMillis(i),a);const f=(0,d().K8)((()=>Im({time:h,isNowIndicator:!1,timelineState:o})),[h,o]);for(;h.valueOf()<l;){const e=f.left+u,t=f.left+f.width-u;void 0!==c&&(m>=e&&m<=t||g>=e&&g<=t)||S.push((0,D.jsx)(Tm,{timelineState:o,time:h,accent:!1},h.valueOf()));const n=(0,xo().Vz)(h,a);h=n}return(0,D.jsx)(D.Fragment,{children:S})}function Fm(e){let{timelineState:t}=e;const o=(0,pt().tz)(),n=(0,d().O$)(t.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,d().O$)(t.currentRangeStore),s=xo().eM[n],{primaryDisplayUnit:a,secondaryDisplayUnit:c}=s,u=[];let p=(0,xo().DY)(r().c9.fromMillis(i),c);for(;p.valueOf()<l;){u.push((0,D.jsx)(_m,{timelineState:t,intl:o,time:p},p.valueOf()));const e=(0,xo().Vz)(p,c);p=(0,xo().zj)(e,a)}return(0,D.jsx)(D.Fragment,{children:u})}function Lm(e){let{time:t,timelineState:o}=e;const n=(0,u().DP)(),r=(0,d().O$)(o.zoomLevelStore),{primaryDisplayUnit:i}=xo().eM[r],{left:l,width:s}=(0,d().K8)((()=>Im({time:t,isNowIndicator:!0,timelineState:o})),[t,o]);return(0,D.jsx)("div",{style:{position:"absolute",top:0,left:l,width:s,height:km-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,D.jsx)("div",{style:{fontSize:Cm,margin:"0 auto",display:"flex"},children:Bm(t,r,i,n)})},l)}function Em(e){let{timelineState:t,activeRangeStore:o}=e;const n=(0,u().DP)(),i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,d().O$)(t.currentRangeStore),a=xo().eM[i],{activeRangeType:c}=a,p=(0,d().O$)(o);if(p){const e=(0,xo().DY)(r().c9.fromMillis(p.start),"day"),o=(0,xo().w0)(i,e.valueOf()-l);if("highlight_days"===c){const a=[];let c=r().c9.fromMillis(Math.max(e.valueOf(),(0,xo().DY)(r().c9.fromMillis(l),"day").valueOf()));for(;c.valueOf()<p.end&&c.valueOf()<s;){a.push(c);c=(0,xo().Vz)(c,"day")}const d=(0,xo().w0)(i,c.valueOf()-l)-o+2*fm,u=a.map(((e,o)=>(0,D.jsx)(Tm,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{style:{position:"absolute",top:0,left:o-fm,width:d,marginTop:(km-ym)/2-2,height:ym,background:n.timelineDarkerBackground,borderRadius:ym/2}}),u]})}{const t=(0,xo().DY)(r().c9.fromMillis(p.end),"day"),s=(0,xo().NB)(r().c9.fromMillis(p.end),"day"),a=(0,xo().w0)(i,t.valueOf()-l)-o+2*fm;return(0,D.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-fm,minWidth:a,marginTop:(km-ym)/2-2,height:ym,background:n.timelineDarkerBackground,borderRadius:ym/2,paddingLeft:6,paddingRight:6},children:(0,D.jsx)(Pm,{start:e,end:e.valueOf()!==s.valueOf()?s:void 0,rangeWidth:a})})}}return null}function Om(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:n}=e;const r=(0,d().K8)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),i=t.settingsStore;return(0,D.jsx)(ma,{title:(0,D.jsx)(pt().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,D.jsx)(pt().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,D.jsx)(pa,{onClick:()=>{b().Ow({collectionContextStore:t,collectionSettingsStore:i}),b().a2({collectionSettingsStore:i,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,D.jsx)(pt().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:n}})}function Dm(e){let{timelineState:t}=e;const o=(0,Up().I)(),r=(0,n.useCallback)((()=>{0===(new Date).getSeconds()&&o("TimelineBackground","TimelineBackground/handleSeconds")}),[o]);(0,n.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const i=(0,d().O$)(t.zoomLevelStore),{startTimestamp:l,endTimestamp:s}=(0,d().O$)(t.currentRangeStore);return(0,D.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,D.jsx)(Gm,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,D.jsx)(Nm,{zoomLevel:i,startTimestamp:l,endTimestamp:s}),(0,D.jsx)(Wm,{zoomLevel:i,startTimestamp:l})]})}const zm=n.memo(Dm,No().A),Km=n.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>{const r=t.plus({day:2}).startOf("day"),i=(0,xo().w0)(o,t.valueOf()-n);return{weekendIndicator:{position:"absolute",left:i,width:(0,xo().w0)(o,r.valueOf()-n)-i,height:"100%",background:e.timelineDarkerBackground}}}),[t,n,o]);return(0,D.jsx)("div",{style:r.weekendIndicator},t.valueOf())}),No().A),Hm=n.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:n}=e;const r=(0,u().IS)((e=>({verticalDivider:{position:"absolute",left:(0,xo().w0)(o,t-n),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[n,t,o]);return(0,D.jsx)("div",{style:r.verticalDivider},t)}),No().A),Wm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const n=(0,u().IS)((e=>{const n=r().c9.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,xo().w0)(t,n.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,D.jsx)("div",{style:n.nowVerticalDivider})}),No().A),Gm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{showWeekendIndicators:i}=xo().eM[t];if(!i)return null;let l=(0,xo().DY)(r().c9.fromMillis(o),"day");const s=[];for(;l.valueOf()<n;)6===l.weekday&&s.push((0,D.jsx)(Km,{start:l,zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,xo().Vz)(l,"day");return(0,D.jsx)(D.Fragment,{children:s})}),No().A),Nm=n.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:n}=e;const{verticalDividerUnit:i}=xo().eM[t];if(!i)return null;const l=[];let s=(0,xo().DY)(r().c9.fromMillis(o),i);for(;s.valueOf()<n;)l.push((0,D.jsx)(Hm,{time:s.valueOf(),zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,xo().Vz)(s,i);return(0,D.jsx)(D.Fragment,{children:l})}),No().A);var Um=()=>o(74513);function $m(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:s,canEditCollectionTimeline:a}=e;return(0,n.useCallback)((e=>{const{groupFormat:n,groupsDisplayState:c}=e,d=i.collection_group_by,u=t.groupsStore.getGroupState(n),p=Boolean(n&&!(null!=u&&u.toggleStateStore.state)),{currentGroups:m,visibleGroups:g,hiddenGroups:S}=c,h=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(n,p,m,t),f=null==u?void 0:u.reducerResultStore.state,y=_().XQ({collectionContextStore:t,reducerResult:f,isFullScreen:o}),v=n===S[S.length-1],x=n===g[g.length-1],b=(0,Vo().Zl)(c,t,!1),C=l.state?v:x,w=t.permissionScopesStore.state,k=C&&!r&&w.canConfigureBlock&&d&&(0,Mo().pP)(d,w.canConfigureCollection),A=f&&0===f.blockIds.length;return{groupHeader:Boolean(n&&(!s||!h)),tableHeaderRow:Boolean(s&&!p&&!h),tableAggregationRow:Boolean(s&&!p),addItemRow:Boolean(a&&!p),hiddenGroupsButton:Boolean(x&&S.length>0),groupsLoadMoreButton:Boolean(x&&b),loadMoreButton:Boolean(!p&&y),tableEmptyRow:Boolean(s&&!p&&A),extraGroupMarginBottom:Boolean(s&&p),addGroupButton:Boolean(k)}}),[a,t,r,i.collection_group_by,l,o,s])}const qm=function(e){let{store:t,collectionContextStore:o,groupFormat:n}=e;const r=(0,s().v3)(),i=(0,d().K8)((()=>Ym(t)),[t]),{value:l}=(0,se().fJ)(ve().T.formulas),{value:a}=(0,se().fJ)(re().VI.duplicateActions);return(0,D.jsx)(lt().A,{store:t,style:{width:"100%",height:Um().V+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:i?Xm(i,r,t,o,n):void 0,onInsertAbove:i?Qm(i,r,t,o,n):void 0,onSelectableDrop:e=>function(e,t,o,n,r,i,l){const{droppedDirection:s,droppedStores:a,duplicate:c}=e,d=Ym(o);if(!d)return;const u=n.subitemTreeStore.state,p=(0,en().Qe)(u.children,(e=>e.value.store===o)),m=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(m,{environment:t,getData:()=>ke().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const g="collectionTypedView"===n.contextType;j().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{hn({environment:t,collectionStore:g?void 0:d,targetStore:o,droppedDirection:s,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:a,duplicate:c,transaction:e,subitemPath:p,collapsedGroup:!1,formulasModule:i,duplicateActions:l})}})}(e,r,t,o,n,l,a),onNativeDrop:e=>function(e,t,o,n,r,i,l){const{files:s,droppedDirection:a}=e,c=Ym(r);if(!c)return;const d=o.collectionViewBlockStore(),u=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:t,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),d&&j().createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{vn({environment:t,collectionStore:c,targetStore:d,droppedDirection:a,collectionContextStore:o,groupsPointer:n?[n]:[],files:s,transaction:e,formulasModule:i,duplicateActions:l})}})}(e,r,o,n,t,l,a),onRemove:e=>function(e,t){const{transaction:o}=e,n=Ym(t);if(!n)return;gt().by({childStore:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function Ym(e){return e.getAssociatedCollectionStore()}function Xm(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,Mn().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:s})}}function Qm(e,t,o,n,r){return i=>{const{insertStores:l,transaction:s}=i,a="collectionTypedView"===n.contextType;return(0,Mn().D)({environment:t,collectionStore:a?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:s})}}function Zm(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:i,disabled:l,format:a}=e;const c=(0,s().v3)(),{value:u}=(0,se().fJ)(ve().T.formulas),[p]=(0,n.useState)((()=>new(ae().Bv)(c,t.pointer))),m=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]),g=(0,d().O$)(r.permissionScopesStore),S=(0,d().K8)((()=>r.collectionViewStore()),[r]),h=(0,d().K8)((()=>i&&g.canEditContent&&!g.isSyncedCollection&&c.device.isMobile&&!(null!=S&&S.isSyncedCollection())),[i,S,c,g]),{value:f}=(0,se().fJ)(re().VI.duplicateActions),v=(0,n.useMemo)((()=>{if(p)return(0,D.jsx)(lt().A,{store:p,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:s,duplicate:a}=e,c=o.collectionStore();if(!c)return;const d=o.groupsStore.getGroupState(t);if(!d)return;const u=o.collectionViewBlockStore(),p=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:n,getData:()=>ke().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),u&&j().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{hn({environment:n,collectionStore:c,targetStore:u,droppedDirection:l,collectionContextStore:o,groupsPointer:d.groupsPointer,droppedStores:s,duplicate:a,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})}})}(e,o,r,c,u,f),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:s}=e,a=t.collectionStore();if(!a)return;const c=t.collectionViewBlockStore(),d=Ve().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:n,getData:()=>ke().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),c&&j().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{vn({environment:n,collectionStore:a,targetStore:c,droppedDirection:s,collectionContextStore:t,groupsPointer:o?[o]:[],files:l,transaction:e,formulasModule:r,duplicateActions:i})}})}(e,r,o,c,u,f),analyticsName:"timeline",style:{width:"100%"}})}),[p,i,o,r,c,u,f]);return m?(0,D.jsxs)(D.Fragment,{children:[v,(0,D.jsx)(Wn,{collectionContextStore:r,groupsPointer:m.groupsPointer,format:a,canDrag:h,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:y().lQ},canDrop:!0,resultComponent:qm,disabled:l,direction:Kn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:eg})]}):null}const Jm=n.memo(Zm,No().A);function eg(e){return(0,D.jsx)("div",{style:{width:"100%",height:Um().V+1}})}const tg=n.memo((function(e){let{store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,hiddenGroupsVisibleStore:p,canEditCollectionTimeline:m,showTable:g}=e;const S=(0,n.useMemo)((()=>({type:"dropzone",hiddenGroupsVisibleStore:p})),[p]),h=(0,n.useCallback)((()=>null),[]),f=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,s().Y0)(),u=$m({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=u(e),o=(0,R().sG)({isMobile:d})-1;let n=0,r=0;return t.groupHeader&&(n+=xo().tp+xo().lH-1),t.tableHeaderRow&&(n+=xo().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=Um().V),t.loadMoreButton&&(r+=qo().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=ls+ss+as),t.groupsLoadMoreButton&&(r+=us+2*ps),t.addGroupButton&&(r+=ia+sa+la),{paddingTop:n,paddingBottom:r}}),[d,u])}({collectionContextStore:o,isFullScreen:i,disabled:r,format:d,hiddenGroupsVisibleStore:p,showTable:g,canEditCollectionTimeline:m}),y=(0,n.useCallback)((e=>(0,D.jsx)(Jm,{store:t,groupFormat:e,collectionContextStore:o,canEdit:m,format:d,disabled:r&&m})),[o,t,d,r,m]);return d.collection_group_by?(0,D.jsx)(Ps,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:r,isFullScreen:i,isRootChild:l,paddingLeft:a,stickyLeft:!1,renderGroup:y,getGroupStyle:f,renderHeader:h,onGroupHeaderAddItem:c,timelineProps:S,groupsResultStore:u}):(0,D.jsx)("div",{style:f(void 0),children:y(void 0)})}));function og(e){let{timelineState:t,...o}=e;const{collectionContextStore:n,isFullScreen:r,paddingLeft:i,isInPeekRenderer:l}=o,s=(0,d().O$)(n.isInHomeWidgetStore),a=(0,d().K8)((()=>t.outerSizeObserver.rect.state.width),[t]),c=(0,u().IS)((e=>({outerDiv:{position:"sticky",left:0,width:a,height:xo().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingLeft:r?i:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...s?{}:{background:e.contentBackground,boxShadow:`0 -1px 0 ${e.tableDividerColor}`}}})),[r,s,a,i]);return(0,D.jsx)("div",{style:c.outerDiv,children:(0,D.jsx)(dl,{...o,style:c.headerStyle,stickyStyle:c.stickyStyle,preventToggleBackground:l})})}const ng=new(se().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,117686)))),rg=(0,se()._h)(ng,(e=>e.TimelineItemDateRange));var ig=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(ig||{});function lg(e){let{store:t,type:r,timelineState:i,scrollerLeftOffset:l,paddingLeft:a,format:c,itemPositionStore:p,dateValueStore:m,isDraggingViaTimelineItemStore:g,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:f,isRootChild:y}=e;const v=(0,s().v3)(),x=(0,n.useRef)(ig.NotDefined),b=(0,n.useRef)(null),C=(0,n.useRef)(null),[w,k]=(0,n.useState)(!1),I="left"===r?o(881915).X:o(653252).O,j=(0,d().O$)(i.outerSizeObserver.rect),R=(0,d().r6)((()=>{const e=p.state;if(e){const{left:t,right:o}=e;if(g.state)return ig.Hidden;const n=i.scrollLeftStore.state;if(void 0!==n){if("left"===r){const e=n+l;if(e-o>0)return ig.VisibleOutOfItem;if(e-t>0)return ig.VisibleInItem}else{const e=n+j.width;if(t-e>0)return ig.VisibleOutOfItem;if(o-e>0)return ig.VisibleInItem}return ig.Hidden}}return ig.NotDefined}),[g,p,j,l,i,r]),T=(0,u().IS)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:w?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===r&&{marginLeft:8,marginRight:4},..."right"===r&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:f?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===r?l:j.width-220,width:220,height:vo().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===r?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[w,f,j,l,r]);(0,n.useLayoutEffect)((()=>{M()}),[]),(0,n.useEffect)((()=>(R.addListener(M),()=>{R.removeListener(M)})),[]),(0,n.useEffect)((()=>{R.enqueueRecompute()}));const M=(0,n.useCallback)((()=>{const e=b.current,t=C.current;if(e&&t){const o=R.state,n=o===ig.VisibleInItem||o===ig.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===ig.VisibleOutOfItem?"":"none";x.current!==ig.NotDefined&&o!==ig.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),x.current=o}}),[R]),_=(0,n.useCallback)((()=>{const e=m.state,o=i.zoomLevelStore.state,{snapUnit:n}=xo().eM[o],l=(0,xo().C1)(o,200);if(e)if("left"===r){const{start:t}=(0,xo().yl)(e,n),r=(0,xo().zb)({timestamp:t.valueOf(),environment:v,timelineState:i,paddingLeft:a,format:c})-l;zp().k3({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}else{const{end:t}=(0,xo().yl)(e,n),r=(0,xo()._r)({timestamp:t.valueOf(),timelineState:i})+l;zp().k3({timelineState:i,environment:v,zoomLevel:o,centerTimestamp:r})}k(!1),A().Lt({environment:v,store:t}),(0,Kp().iT)(v,{...(0,Kp().ZR)({environment:v,collectionContextStore:S,timelineState:i,isFullScreen:h,isRootChild:y}),type:r})}),[S,m,v,c,h,y,a,t,i,r]),P=(0,n.useCallback)((()=>{v.device.isPhone||We().A.state||k(!0)}),[v]),B=(0,n.useCallback)((()=>{v.device.isPhone||k(!1)}),[v]);return(0,D.jsxs)("div",{style:T.wrap,onMouseOver:P,onMouseOut:B,onMouseDown:Te().tr,onClick:_,ref:C,children:[(0,D.jsx)("div",{style:T.arrow,ref:b,children:I(T.icon)}),w&&(0,D.jsx)(ag,{dateValueStore:m,timelineState:i,isInPeekRenderer:f})]})}const sg=n.memo(lg,No().A);function ag(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:n}=e;const r=(0,u().IS)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:n?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[n]),i=(0,d().O$)(t),l=(0,d().O$)(o.zoomLevelStore);return i?(0,D.jsx)("span",{style:r.dateRange,children:(0,xo().tX)(i,l)}):null}class cg extends p().default{getInitialState(){return null}}function dg(e){let{store:t,timelineState:o,scrollerLeftOffset:i,paddingLeft:l,format:a,query:c,schema:p,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,collectionContextStore:h,isFullScreen:f,isRootChild:y,toggleButton:v,groupFormat:x,subitemPath:b,isInPeekRenderer:C,handleOpenPeekPage:w}=e;const A=(0,s().v3)(),{value:I}=(0,se().fJ)(ve().T.formulas),R=(0,n.useRef)(null),[T]=(0,n.useState)((()=>t.clone())),M=(0,n.useRef)(null),P=(0,d().K8)((()=>{const e=o.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&!e.newTimelineItemProps&&(0,Mo().Mn)(e.groupFormat,x))return e.date}),[x,t,o]),B=(0,d().r6)((()=>{const e=o.dragStateStore.state;if(P)return P;if(e){const o=e.stores.indexOf(t);if(o>=0)return e.temporaryValues[o]}return ug(t,c,p,A,I)}),[A,P,c,p,t,o,I],{useDeepEqual:!0}),V=(0,d().O$)(B),F=(0,d().K8)((()=>{const e=(0,en().dC)(b);if(!e||Boolean(V))return;const t=e.value.store,o=Np.findCollectionTimelineViewItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[V,b]),L=(0,d().r6)((()=>(0,xo().BD)({timelineState:o,dateValue:V,placeholderDate:P,subitemPlaceholderDate:F})),[V,P,F,o]),E=(0,d().uB)(void 0,cg);(0,Tu().b)(Np,(()=>({getNode:()=>R.current,props:{store:t,groupFormat:x,schema:p},stores:{nodeStore:E},dateValueStore:B,itemPositionStore:L})),[t,R,B,x,p,L,E]);const O=(0,d().O$)(L),z=(0,d().K8)((()=>{var e;return null===(e=h.groupsStore.getGroupState(x))||void 0===e?void 0:e.reducerResultStore}),[x,h]),K=(0,fe().Zp)(),H=Boolean(O&&!O.isPlaceholder&&!(null!=K&&K.disableAllPointerEvents)),W=(0,d().r6)((()=>{const e=o.dragStateStore.state,n=nn().Ay.state;return Boolean(e&&e.stores.includes(t)&&n.isDragging&&n.draggedStores.includes(t))}),[t,o]);(0,d().O$)(W);const G=(0,d().K8)((()=>t.getAssociatedCollectionStore()),[t]),N=(0,n.useCallback)((e=>{const n=o.dateRangePlaceholderStore.state,r=h.groupsStore.getGroupState(x);if(r)if(n.active){const{date:e}=n;j().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:A,canUndo:!0,perform:o=>{zp().Xt({environment:A,store:t,query:c,schema:p,date:e,transaction:o})}}),o.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=o,i=o.scrollLeftStore.state,l=L.state,s=M.current;if(!n||void 0===i||!l||!s)return;const a=n.getBoundingClientRect(),c=i+(e.clientX-a.left),d=M.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const p=i+(u.getBoundingClientRect().right-a.left);c>l.right&&c<=p&&(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{(0,_e().Zm)()||Ko().VU({environment:A,store:t,openInNew:Re().Vr(e),peekMode:(0,_().hH)(h),resultsStore:r.resultsStore,collectionContextStore:h,pageVisitSource:To().y8.PeekOpen})}})}}),[h,A,x,L,c,p,t,o]),U=(0,n.useCallback)((()=>{o.dateRangePlaceholderStore.setState({active:!1})}),[o]),$=(0,n.useCallback)((e=>{const{target:t}=e;!A.device.isMobile&&t instanceof HTMLElement&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:A,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}),[A]),q=(0,n.useCallback)((e=>{const n=o.dragStateStore.state,i=o.drawStateStore.state,{horizontalScroller:l}=o,s=o.scrollLeftStore.state,a=o.zoomLevelStore.state,d=o.currentRangeStore.state,{snapUnit:u,getDateRangePlaceholderDuration:m}=xo().eM[a];if(!i&&We().A.state||n||ug(t,c,p,A,I)||!l||void 0===s||g)return;const S=l.getBoundingClientRect(),h=s+(e.clientX-S.left),f=(0,xo().C1)(a,h),y=r().c9.fromMillis(d.startTimestamp+f),v=(0,xo().DY)(y,u),b=(0,xo().DY)(m(y),u),C=(0,tc().p6)(v.valueOf(),(0,Qo().P)()),w=(0,xo().oJ)({startValue:C,snapUnit:u,desiredStart:v,desiredEnd:b});o.dateRangePlaceholderStore.setState({active:!0,store:t,parentStore:G,groupFormat:x,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:c,schema:p}})}),[A,o,t,x,g,c,p,G,I]),Y=(0,n.useCallback)((e=>{E.setState(e)}),[E]),X=(0,u().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:Um().V+1,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!z)return null;const Q=Boolean(O);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{ref:R,style:X.scrollArrows,children:[H&&(0,D.jsx)(sg,{store:t,type:"left",timelineState:o,scrollerLeftOffset:i,itemPositionStore:L,dateValueStore:B,paddingLeft:l,format:a,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:C,isRootChild:y}),H&&(0,D.jsx)(sg,{store:t,type:"right",timelineState:o,scrollerLeftOffset:i,itemPositionStore:L,dateValueStore:B,paddingLeft:l,format:a,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isInPeekRenderer:C,isFullScreen:f,isRootChild:y})]}),(0,D.jsx)("div",{style:X.dateRange,onMouseDown:$,onMouseMove:q,onMouseLeave:U,onClick:N,className:we().ZLF,ref:Y,children:Q&&(0,D.jsx)(rg,{store:t,parentStore:G,toggleButton:v,clonedStore:T,itemPositionStore:L,dateValueStore:B,query:c,schema:p,timelineState:o,blockPropertyValueOverlayStore:m,disabled:g,showProperties:S,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:W,collectionContextStore:h,isFullScreen:f,isInPeekRenderer:C,isRootChild:y,intl:vt().A.getIntl(),propertiesWrapElementRef:M,resultStore:z,handleOpenPeekPage:w})})]})}function ug(e,t,o,n,r){return(0,xo().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:vt().A.getIntl(),formulasModule:r})}function pg(e){const{store:t,parentStore:o,timelineState:i,scrollerLeftOffset:l,query:a,schema:c,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,collectionContextStore:S,isFullScreen:h,isRootChild:f,toggleButton:y,groupFormat:v,canEditTimelineItems:x,subitemPath:b,paddingLeft:C,showTable:w}=e,A=(0,s().v3)(),{isMobile:I}=(0,s().Y0)(),[T,M]=(0,n.useState)(),_=(0,u().IS)((()=>({container:{display:"flex",height:(0,R().sG)({isMobile:I})+1,width:"100%",cursor:"default",isolation:"auto"}})),[I]);(0,n.useEffect)((()=>{M(null==t?void 0:t.clone())}),[t]);const P=(0,d().K8)((()=>{var e;return null===(e=S.groupsStore.getGroupState(v))||void 0===e?void 0:e.reducerResultStore}),[S.groupsStore,v]),B=(0,d().K8)((()=>{const e=i.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,Mo().Mn)(e.groupFormat,v))return e.date}),[v,o,t,i.dateRangePlaceholderStore]),V=(0,d().K8)((()=>B),[B],{useDeepEqual:!0}),F=(0,d().K8)((()=>(0,xo().BD)({timelineState:i,dateValue:V,placeholderDate:B,subitemPlaceholderDate:void 0})),[V,B,i]),L=(0,d().K8)((()=>Boolean(F)),[F]),E=(0,d().K8)((()=>!S.isInHomeWidgetStore.state&&!t&&!L&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,L,t]),O=(0,d().K8)((()=>S.isInPeekRendererStore.state),[S.isInPeekRendererStore]),z=(0,n.useMemo)((()=>new(gm().default)((()=>F),{debugName:"itemPositionStore"})),[F]),K=(0,n.useMemo)((()=>new(gm().default)((()=>V),{debugName:"dateValueStore"})),[V]),H=(0,n.useMemo)((()=>new(gm().default)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return P?(0,D.jsxs)("div",{style:_.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,A),onMouseMove:e=>function(e,t,o,n,i,l,s,a,c,d,u,p){var m;const g=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,f=t.scrollLeftStore.state,y=t.zoomLevelStore.state,v=t.currentRangeStore.state,{snapUnit:x,getDateRangePlaceholderDuration:b}=xo().eM[y];if(!g&&We().A.state||S||!h||void 0===f||i)return;const C=null===(m=d.groupsStore.getGroupState(n))||void 0===m?void 0:m.resultsStore;if(!C)return;const w=h.getBoundingClientRect(),k=f+(e.clientX-w.left),A=(0,xo().C1)(y,k),I=r().c9.fromMillis(v.startTimestamp+A),j=(0,xo().DY)(I,x),R=(0,xo().DY)(b(I),x),T=(0,tc().p6)(j.valueOf(),(0,Qo().P)()),M=(0,xo().oJ)({startValue:T,snapUnit:x,desiredStart:j,desiredEnd:R});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:n,date:M,newTimelineItemProps:{query:l,schema:s,resultsStore:C,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,i,t,v,m,a,c,h,x,S,o,b),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(i),onClick:e=>function(e,t,o,n,r,i,l,s,a,c,d,u){const p=r.dateRangePlaceholderStore.state;if(p.active){const{date:e}=p,m=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";if(!(0,Xe().EF)(t))return void(0,Xe().QY)(t);j().createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,canUndo:!0,perform:r=>{const p=zp().dO({environment:t,transaction:r,date:e,store:c,parentStore:d,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:s,collectionContextStore:a,subitemPath:u,from:m});jn().v(t,{from:m,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,ke().sl)(a)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,A,a,c,i,h,v,x,S,t,o,b),className:we().ZLF,children:[L&&(0,D.jsx)(rg,{store:o?void 0:t,parentStore:o,toggleButton:y,clonedStore:T,itemPositionStore:z,dateValueStore:K,query:a,schema:c,timelineState:i,blockPropertyValueOverlayStore:p,disabled:m,showProperties:g,scrollerLeftOffset:l,isDraggingViaTimelineItemStore:H,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:O,isRootChild:f,intl:vt().A.getIntl(),resultStore:P,handleOpenPeekPage:gg}),E&&(0,D.jsx)(yg,{parentStore:o,collectionContextStore:S,paddingLeft:C,isFullScreen:h,showTable:w})]}):null}const mg=n.memo(pg);function gg(){}function Sg(e){let{isMobile:t}=e;return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:(0,R().sG)({isMobile:t}),lineHeight:Ro().K_.UIRegular.desktop}}function hg(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function fg(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function yg(e){let{parentStore:t,collectionContextStore:o,paddingLeft:n,isFullScreen:r,showTable:i}=e;const{isMobile:l}=(0,s().Y0)(),a=(0,u().DP)(),c=(0,d().O$)(o.currentSubitemFormatStoreForUiDisplayStore),p=(0,d().K8)((()=>{var e;return c&&t?null===(e=t.getSchema()[c.property])||void 0===e?void 0:e.name:""}),[c,t]);return(0,D.jsx)("div",{style:hg(n,r,i),children:(0,D.jsxs)("div",{style:Sg({isMobile:l}),children:[(0,Gt().W)(fg(a)),(0,D.jsx)("span",{style:{color:a.text.secondary},children:t&&p?(0,D.jsx)(pt().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:p}}):(0,D.jsx)(pt().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function vg(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:s,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:m,groupFormat:g,paddingLeft:S,showTimelineProperties:h,scrollerLeftOffset:f,showTable:y,canEditTimelineItems:v,isInPeekRenderer:x,isReady:b,canEdit:C}=e,w=(0,d().K8)((()=>c.groupsStore.getGroupState(g)),[c,g]),k=(0,d().O$)(c.permissionScopesStore),A=(0,d().K8)((()=>"collectionTypedView"===c.contextType),[c]);return(0,d().O$)(c.isInHomeWidgetStore)||!w||!b||!C&&!A||k.isSyncedCollection?null:(0,D.jsx)(mg,{store:t,disabled:i||!k.canEditContent&&!A,timelineState:r,schema:a,query:l,format:s,scrollerLeftOffset:f,paddingLeft:S,showProperties:h,blockPropertyValueOverlayStore:u,collectionContextStore:c,isFullScreen:p,showTable:y,isRootChild:m,groupFormat:g,canEditTimelineItems:v,isInPeekRenderer:x,parentStore:o,subitemPath:n})}const xg=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:r,showTable:i,store:l,format:a,isFullScreen:c,paddingLeft:u,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,isRootChild:S,isReady:h,canEdit:f,disabled:v,scrollerLeftOffset:x}=e,b=(0,s().v3)(),C=(0,d().K8)((()=>{if(!r.timeline_by)return null;const e=t.groupsStore.getGroupState(n);if(!e)return null;const l=e.currentLimit.state,s=y().oE([n&&(0,Xo().K8)({schema:o,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:n,timeZone:(0,Qo().P)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:l}}),[t,o,n,r,i]),w=(0,d().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),k=n?[n]:[],A=(0,d().K8)((()=>null==w?void 0:w.reducerResultStore.state),[null==w?void 0:w.reducerResultStore]),I=(0,d().K8)((()=>_().XQ({collectionContextStore:t,reducerResult:A,isFullScreen:c})),[t,A,c]),j=(0,d().K8)((()=>_().Cn({query:r,schema:o})),[r,o]),R=(0,d().K8)((()=>(a.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))),[a]);return w?(0,D.jsxs)(D.Fragment,{children:[C&&(0,D.jsx)(bn().A,{id:k.length>0?`results:${(0,Mo().Hm)(k)}`:"timeline_results",reducer:C,groupsPointer:k,collectionContextStore:t,resultStore:w.reducerResultStore}),(0,D.jsx)(Cg,{groupFormat:n,format:a,collectionContextStore:t,store:l,schema:o,query:r,isInPeekRenderer:p,timelineState:m,blockPropertyValueOverlayStore:g,showTimelineProperties:R,paddingLeft:u,isFullScreen:c,isRootChild:S,isReady:h,canEdit:f,canEditTimelineItems:j,disabled:v,showTable:i,scrollerLeftOffset:x}),I&&(0,D.jsx)("div",{style:{width:"100%"},children:i?(0,D.jsx)("div",{style:{height:qo().LA}}):(0,D.jsx)(qo().jJ,{style:{position:"sticky",left:c?u:3,width:"max-content",height:qo().LA},groupsPointer:k,store:l,collectionContextStore:t,format:a,isFullScreen:c,incrementLimitsInRelatedGroups:!1})}),(0,D.jsx)(vg,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>bg(t,n,b),canEditTimelineItems:j,showTimelineProperties:R})]}):null};function bg(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;Ve().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();w().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||Pn().C9.timeline;Rn().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function Cg(e){const t=(0,s().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:a,blockPropertyValueOverlayStore:c,isFullScreen:u,isRootChild:p,showTable:m,canEditTimelineItems:g,scrollerLeftOffset:S,timelineState:h,paddingLeft:f,showTimelineProperties:y,isInPeekRenderer:v}=e,x=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return{disabled:i||!("collectionTypedView"===r.contextType||e.canEditContent),timelineState:h,schema:a,query:l,format:n,scrollerLeftOffset:S,paddingLeft:f,showProperties:y,blockPropertyValueOverlayStore:c,collectionContextStore:r,isFullScreen:u,showTable:m,isRootChild:p,groupFormat:o,canEditTimelineItems:g,isInPeekRenderer:v,handleOpenPeekPage:()=>bg(r,o,t),isLast:!1}}),[r,o,n,t,i,l,a,c,u,p,m,g,S,h,f,y,v]),b=(0,d().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return b?(0,D.jsx)(Wn,{disableSelectable:!0,collectionContextStore:r,groupsPointer:b.groupsPointer,format:n,canDrag:!1,disableRequest:!0,resultProps:x,canDrop:!1,resultComponent:dg,disabled:!0,direction:Kn.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,D.jsx)(vg,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>bg(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e)}):null}const wg=n.memo((function(e){let{store:t,collectionContextStore:o,timelineState:r,disabled:i,isFullScreen:l,isInPeekRenderer:a,paddingLeft:c,isRootChild:p,format:m,schema:g,query:S,showTable:h,groupsReducerResultStore:f,hiddenGroupsVisibleStore:y,canEditCollectionTimeline:v,isReady:x,blockPropertyValueOverlayStore:b,tableStore:C,scrollerLeftOffset:w,onGroupHeaderAddItem:k}=e;const A=(0,n.useMemo)((()=>({type:"item",hiddenGroupsVisibleStore:y})),[y]),I=(0,n.useCallback)((e=>{if(!h)return(0,D.jsx)(og,{timelineState:r,...e})}),[h,r]),j=(0,d().K8)((()=>(0,R().Ty)(m,C)),[m,C]),T=(0,n.useCallback)((e=>(0,D.jsx)(xg,{store:t,groupFormat:e,schema:g,query:S,isInPeekRenderer:a,timelineState:r,collectionContextStore:o,blockPropertyValueOverlayStore:b,paddingLeft:c,format:j,isFullScreen:l,isRootChild:p,isReady:x,canEdit:v,disabled:i,showTable:h,scrollerLeftOffset:w})),[b,v,o,j,i,l,a,x,p,c,S,g,w,h,t,r]),M=function(e){let{collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c}=e;const{isMobile:d}=(0,s().Y0)(),p=(0,u().DP)(),m=$m({collectionContextStore:t,isFullScreen:o,disabled:r,format:i,hiddenGroupsVisibleStore:l,showTable:a,canEditCollectionTimeline:c});return(0,n.useCallback)((e=>{const t=m(e),o=(0,R().sG)({isMobile:d});let n=0,r=0;return t.groupHeader&&a&&(n+=xo().tp+xo().lH),t.tableHeaderRow&&(n+=xo().MR-1),t.tableAggregationRow&&(r+=o),t.addItemRow||(r+=1),t.tableEmptyRow&&(r+=o),t.hiddenGroupsButton&&a&&(r+=ls+ss+as),t.groupsLoadMoreButton&&a&&(r+=us+2*ps),t.addGroupButton&&a&&(r+=ia+sa+la),{paddingTop:n,paddingBottom:r,minHeight:xo().tp,boxShadow:e.index>0&&(!a||t.tableHeaderRow)?`inset 0 -1px 0 ${p.tableDividerColor}`:void 0}}),[m,d,a,p.tableDividerColor])}({collectionContextStore:o,isFullScreen:l,disabled:i,format:m,hiddenGroupsVisibleStore:y,showTable:h,canEditCollectionTimeline:v});return m.collection_group_by?(0,D.jsx)(al().l,{children:(0,D.jsx)(Ps,{reducerId:"timeline_groups",store:t,collectionContextStore:o,disabled:i,isFullScreen:l,isRootChild:p,paddingLeft:c,stickyLeft:!1,renderGroup:T,getGroupStyle:M,renderHeader:I,onGroupHeaderAddItem:k,timelineProps:A,groupsResultStore:f})}):T()}));const kg=(0,Io().wt)("doubleChevronLeft",{viewBox:"0 0 16 16",svg:(0,D.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})});const Ag=function(e){let{isGrouped:t,format:o,collectionContextStore:n,isFullScreen:r,isRootChild:i,timelineState:l}=e;const a=(0,u().DP)(),c=(0,s().v3)(),{device:d}=c;return(0,D.jsx)(jt().A,{render:e=>(0,D.jsx)(ur().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;j().createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,xo().iH)(t,!1);Oo().zA({stores:[l],update:o,transaction:e})}}),(0,Kp().VD)(e,{...(0,Kp().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(c,o,n,r,i,l),style:{position:"absolute",top:t?d.isIOS?3:4:d.isIOS?7:8,right:t?6:8,zIndex:84,fill:a.lightIconColor},...e,children:kg({width:14})}),renderTooltip:()=>(0,D.jsx)(pt().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function Ig(){const e=(0,u().IS)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,D.jsx)("div",{style:e.rowContainer,children:(0,D.jsx)(eo().A,{style:e.rowShimmer})})}const jg=function(e){const{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:a,store:c,disabled:u,format:p,schema:m,isInPeekRenderer:g,query:S,paddingBottom:h,tableStore:f,timelineState:y,isRootChild:v,canEdit:x,paddingLeft:b,paddingRight:C}=e,w=(0,s().v3)(),k=(0,E().X)("db_ux_empty_states"),{titleColumnIndex:A,left:I}=(0,d().K8)((()=>{const e=t.state.findIndex((e=>"title"===e.property)),o=t.state.reduce(((e,t)=>t.visible?e+(t.width||0):e),0),n=w.WindowSizeStore.getSafePaddingLeftPx((0,Ce().F8)(w));return{titleColumnIndex:e,left:Math.floor(o/2)+n}}),[w,t]),j=(0,n.useMemo)((()=>o?[o]:[]),[o]),R=(0,d().K8)((()=>i.groupsStore.getGroupState(j)),[i,j]),T=(0,d().K8)((()=>null==R?void 0:R.reducerResultStore.state),[R]),M=(0,d().K8)((()=>(0,_().XQ)({collectionContextStore:i,reducerResult:T,isFullScreen:r})),[i,T,r]),P=(0,d().O$)(i.shouldShowSpinnerStore),B=(0,d().O$)(i.permissionScopesStore),V=(0,d().O$)(t),F=(0,d().O$)(i.isInHomeWidgetStore),L=(0,d().K8)((()=>"collectionTypedView"===i.contextType),[i]),O=a&&0===(null==T?void 0:T.blockIds.length)&&!P,z=(0,d().K8)((()=>{const e=Boolean(!F&&a&&(x||L)&&!B.isSyncedCollection);return k?e&&!O:e}),[F,a,x,L,B.isSyncedCollection,k,O]);return R?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Mg,{store:c,format:p,schema:m,query:S,collectionContextStore:i,disabled:u,paddingBottom:h,isInPeekRenderer:g,blockPropertyValueOverlayStore:l,tableStore:f,showTablePropertyFormats:V,timelineState:y,isFullScreen:r,isRootChild:v,groupFormat:o,isInHomeWidget:F,paddingLeft:b,paddingRight:C}),O&&(0,D.jsx)(Vg,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,canEdit:x,left:I,height:70}),(0,D.jsx)(zg,{store:c,schema:m,query:S,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:x,format:p,tableStore:f,paddingLeft:b,disabled:u,groupFormat:o,titleColumnIndex:A,groupsPointer:j}),P&&(0,D.jsx)(Ig,{}),M&&(0,D.jsx)(Lg,{collectionContextStore:i,format:p,canEdit:x,groupFormat:o,isFullScreen:r,groupsPointer:j}),z&&(0,D.jsx)(Fg,{collectionContextStore:i,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:g}),(0,D.jsx)(Yd,{groupFormat:o,pageCount:(null==T?void 0:T.blockIds.length)??0,style:Tg(a,o,r,b),disabled:u||!B.canConfigureBlock,schema:m,query:S,collectionContextStore:i,isInPeekRenderer:g,isFullScreen:r,showPropertyFormats:V,showRightActionsSpacer:!1,paddingLeft:b,paddingRight:C,disableSticky:!0})]}):null};function Rg(){}function Tg(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:n},...o&&!t&&{left:n}}}function Mg(e){let{groupFormat:t,store:o,format:n,schema:r,query:i,collectionContextStore:l,disabled:s,paddingBottom:a,isInPeekRenderer:c,blockPropertyValueOverlayStore:u,tableStore:p,showTablePropertyFormats:m,timelineState:g,isFullScreen:S,isRootChild:h,isInHomeWidget:f,paddingLeft:y,paddingRight:v}=e;const x=(0,d().K8)((()=>l.groupsStore.getGroupState(t)),[l,t]),b=(0,d().O$)(l.permissionScopesStore),C=(0,d().K8)((()=>l.viewIsFlushToTopbar()),[l]);if(!x)return null;const w=Boolean(t);return(0,D.jsx)(dp,{store:o,format:n,schema:r,query:i,collectionContextStore:l,isInPeekRenderer:c,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:u,showPropertyFormats:m,showRightActions:!1,allowHidingTitle:!0,tableStore:p,formatKey:"timeline_table_properties",disabled:s||!b.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,xo().Zk)(w),paddingTop:w?0:xo().jI-xo().MR,disableTopBorder:!C||w,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:f,hasMoreReducerResults:!1,paddingLeft:y,paddingRight:v,children:!w&&b.canConfigureBlock&&(0,D.jsx)(Ag,{isGrouped:!1,format:n,collectionContextStore:l,timelineState:g,isFullScreen:S,isRootChild:h})})}function _g(e,t,o){return{display:"flex",alignItems:"center",height:(0,R().sG)({isMobile:o}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function Pg(e){return{width:Io().Ev.sm,height:Io().Ev.sm,marginRight:6,fill:e.lightIconColor}}function Bg(e,t,o,n,r,i){const{device:l}=e,s=n?[n]:[],a=t.groupsStore.getGroupState(s);if(!(0,Xe().EF)(e)||!a)return;t.searchQueryStore.state&&(0,er().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;j().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const s=(0,Zn().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(s){if(l.isMobile){!function(e,t,o){o?o(e):vr().oo({environment:t,url:e})}((0,Ar().Ay)({store:s.newStore,fullyQualified:!1,pageVisitSource:To().y8.Create}),e,i)}else if(s.coercionSucceeded){const o=()=>{Tn().ho({environment:e,blockPropertyValueOverlayStore:r,store:s.newStore,property:"title",format:wt().j.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(s.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);Ko().VU({environment:e,store:s.newStore,peekMode:(0,_().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:To().y8.Create})}jn().v(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,ke().sl)(t)})}}})}function Vg(e){const{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,canEdit:l,left:a,height:c}=e,p=(0,E().X)("db_ux_empty_states"),m=(0,s().v3)(),{isMobile:g}=(0,s().Y0)(),S=(0,u().DP)(),h=(0,n.useContext)(ri().n),f=(0,n.useCallback)((()=>Bg(m,t,o,r,i,h)),[m,t,o,r,i,h]),y=(0,d().K8)((()=>{const e=Boolean(t.currentCombinatorFilterStore.state),o=t.currentPropertyFiltersStore.state.length>0;return e||o}),[t]),v=(0,d().K8)((()=>""!==t.searchQueryStore.state),[t]),x=(0,d().K8)((()=>t.groupsStore.getAllGroupStates().length>1),[t.groupsStore]);return p?(0,D.jsx)(ou,{collectionContextStore:t,groupFormat:r,handleAddRowClick:f,hasSearchQuery:v,hasFilter:y,hasMultipleGroups:x,shouldShowAddRowButton:l,shouldShowLinkButton:!1,left:a,height:c}):(0,D.jsx)(At().A,{onClick:f,onMouseDown:Te().tr,disabled:!l,style:{display:"flex",alignItems:"center",height:(0,R().sG)({isMobile:g}),width:"100%",paddingLeft:8,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,background:S.contentBackground,left:0,right:0,borderBottom:`1px solid ${S.tableDividerColor}`},children:l?(0,D.jsx)("span",{style:{color:S.text.tertiary},children:(0,D.jsx)(pt().sA,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,D.jsx)("span",{style:{color:S.text.tertiary},children:(0,D.jsx)(pt().sA,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function Fg(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:i,isInPeekRenderer:l}=e;const a=(0,s().v3)(),c=(0,u().DP)(),d=(0,n.useContext)(ri().n),p=(0,n.useCallback)((()=>Bg(a,t,o,r,i,d)),[a,t,o,r,i,d]);return(0,D.jsxs)(At().A,{onClick:p,style:_g(l,c,a.device.isMobile),className:we().$0P,onMouseDown:Te().tr,children:[(0,or().plusSmallIcon)(Pg(c)),(0,D.jsx)("span",{style:{color:c.text.tertiary},children:(0,D.jsx)(pt().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Lg(e){let{groupsPointer:t,collectionContextStore:o,format:n,canEdit:r,groupFormat:i,isFullScreen:l}=e;const a=(0,u().DP)(),c=(0,s().v3)(),p=(0,d().K8)((()=>o.groupsStore.getGroupState(t)),[o,t]),m=(0,d().K8)((()=>(0,Qn().Kk)({collectionContextStore:o,groupsPointer:t})),[o,t]);return p?(0,D.jsxs)(At().A,{onMouseDown:Te().tr,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Te().kV)(e),A().IU({environment:r}),l&&(0,$o().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,Od().K)(r)}(e,o,i,l,c),disabled:m,hoveredStyle:m?{background:a.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:qo().LA,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:Ro().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${a.tableDividerColor}`,borderBottom:`1px solid ${a.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,kn().g)(Pg(a)),(0,D.jsx)("span",{style:{color:a.text.tertiary,flexGrow:1},children:(0,D.jsx)(pt().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),m?(0,D.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,D.jsx)(pr().A,{size:"sm"})}):r&&(0,D.jsx)(Dd().w,{collectionContextStore:o,format:n})]}):null}function Eg(e){const t=(0,s().v3)(),{isMobile:o}=(0,s().Y0)(),{store:n,parentStore:r,subitemPath:i,indentLevel:l,groupsPointer:a,collectionContextStore:c,disabled:d,blockPropertyValueOverlayStore:u}=e;return r?(0,D.jsx)(bd,{store:n,collectionStore:r,subitemPath:i,indentLevel:l,collectionContextStore:c,disabled:d,groupsPointer:a,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{Tn().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",format:wt().j.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,c,u,t),styles:{height:(0,R().sG)({isMobile:o})+1}}):null}const Og=[];function Dg(e){let{args:t,schema:o,disabled:n,collectionContextStore:r,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:a,format:c,groupFormat:p,titleColumnIndex:m}=e;(0,u().DP)();const g=(0,s().Y0)(),S=(0,d().K8)((()=>r.collectionViewStore()),[r]),{groupsPointer:h}=t,f=(0,d().K8)((()=>r.groupsStore.getGroupState(h)),[r,h]),y=(0,d().O$)(l),v=(0,d().K8)((()=>!a&&g.isMobile&&!(null!=S&&S.isSyncedCollection())),[a,g,S]),x=(0,d().O$)(r.isInHomeWidgetStore),b=(0,d().K8)((()=>{const e=r.collectionViewBlockStore();return!(!e||r.isFullScreenStore.state)&&(0,zd().d1)(e)}),[r]),C=(0,d().K8)((()=>(0,ie().v2)(p,r)),[p,r]),w=(0,d().K8)((()=>r.isUnlistedViewStore.state&&r.isInlineViewStore.state),[r]),k=(0,d().K8)((()=>{const e=Gd().A.state;if(e.isActive)return(0,R().yR)(e.selection,y.length,C.length)}),[C,y]),A=Og,I=y,j=(0,d().K8)((()=>{const e=r.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[r.permissionScopesStore]);if(!S||!f)return null;return(0,D.jsx)(Wn,{collectionContextStore:r,groupsPointer:h,disableRequest:!0,format:c,canDrag:v,resultProps:{schema:o,collectionContextStore:r,propertyFormats:y,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:Rg,titleColumnIndex:m,groupFormat:p,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:x,isCollectionViewBlockSelected:b,allRows:C,isInEphemeralView:w,normalizedTableSelection:k,unfrozenIndexAddendum:0,frozenPropertyFormats:A,unfrozenPropertyFormats:I,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:j,shouldShowRightActionSpacer:!1,hasColumnVirtualizer:!1},resultComponent:bp,canDrop:!1,disabled:n,direction:Kn.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:m,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:l,indentLevel:s}=e;return(0,D.jsx)(Eg,{collectionContextStore:r,disabled:n,blockPropertyValueOverlayStore:i,store:t,parentStore:o,subitemPath:l,indentLevel:s,groupsPointer:h})}})}function zg(e){let{groupFormat:t,groupsPointer:o,store:r,schema:i,query:l,collectionContextStore:s,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:u,format:p,tableStore:m,paddingLeft:g,disabled:S,titleColumnIndex:h}=e;const f=(0,d().K8)((()=>s.collectionViewStore()),[s]),y=(0,d().K8)((()=>s.groupsStore.getGroupState(t)),[s,t]),v=(0,d().O$)(c),x=(0,n.useCallback)((e=>(0,D.jsx)(Dg,{schema:i,disabled:S,collectionContextStore:s,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:u,format:p,groupFormat:t,titleColumnIndex:h,args:{...e,groupsPointer:o}})),[i,S,s,a,c,u,p,t,h,o]);return f&&y?(0,D.jsx)(_p,{store:r,collectionContextStore:s,minWidth:void 0,blockPropertyValueOverlayStore:a,showPropertyFormats:v,disabled:!u,disableHorizontalEdgeScroll:!0,groupFormat:t,render:x,tableStore:m,paddingLeft:g}):null}const Kg=n.memo((function(e){let{store:t,tableStore:o,collectionContextStore:r,timelineState:i,format:l,schema:s,query:a,isFullScreen:c,groupBy:p,paddingLeft:m,paddingRight:g,paddingBottom:S,scrollerLeftOffset:h,isInPeekRenderer:f,isInHomeWidget:y,computedOuterHeight:v,showHoverActionsStore:x,blockPropertyValueOverlayStore:C,isRootChild:w,isReady:k,disabled:A,canEditCollectionTimeline:I,viewIsFlushToTopbar:j,groupsReducerResultStore:T,hiddenGroupsVisibleStore:M,onGroupHeaderAddItem:_}=e;const P=(0,E().X)("db_ux_chrome"),B=(0,n.useRef)(null),V=(0,d().r6)((()=>{const e=(0,R().Ty)(l,o);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[l,o],{useDeepEqual:!0});(0,d().O$)(V);const F=(0,d().K8)((()=>V.state.reduce(((e,t)=>e+(t.width||0)),0)),[V]),L=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:r.settingsStore,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})}),[r]),O=(0,u().IS)((e=>({selectable:{whiteSpace:"nowrap",...y?{}:{background:f?e.cardContentBackground:e.contentBackground},paddingLeft:m,boxSizing:"border-box",borderRight:`1px solid ${e.tableDividerColor}`,boxShadow:e.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:F+m,height:y?"100%":v},tableGroupHeaderSticky:{borderRight:`1px solid ${e.tableDividerColor}`,"--timeline-box-shadow":"0px"},tableGroupHeaderTransition:{borderRight:void 0},tableGroupHeader:{boxShadow:P?void 0:`inset 0 var(--timeline-box-shadow, 1px) 0 ${e.tableDividerColor}`}})),[y,f,m,F,v,P]),z=(0,d().K8)((()=>(0,R().Ty)(l,o)),[l,o]),K=(0,n.useCallback)((e=>(0,D.jsx)(jg,{store:t,groupFormat:e,schema:s,query:a,isInPeekRenderer:f,timelineState:i,collectionContextStore:r,blockPropertyValueOverlayStore:C,showTablePropertyFormatsStore:V,tableStore:o,paddingLeft:m,paddingRight:g,paddingBottom:S,format:z,isFullScreen:c,isRootChild:w,isReady:k,canEdit:I,disabled:A&&I})),[C,I,r,A,z,c,f,k,w,S,m,g,a,s,V,t,o,i]),H=(0,n.useCallback)((e=>{const t=r.permissionScopesStore.state;return(0,D.jsx)(dl,{...e,height:xo().tp,paddingTop:xo().lH,stickyStyle:O.tableGroupHeaderSticky,transitionStickyStyle:O.tableGroupHeaderTransition,style:0!==e.index||j?O.tableGroupHeader:{},stickyWrapStyle:{marginBottom:xo().lH},children:0===e.index&&t.canConfigureBlock&&(0,D.jsx)(Ag,{isGrouped:!0,format:l,collectionContextStore:r,timelineState:i,isFullScreen:c,isRootChild:w})})}),[r,l,c,w,O.tableGroupHeader,O.tableGroupHeaderSticky,O.tableGroupHeaderTransition,i,j]),W=(0,n.useCallback)((()=>({})),[]),G=(0,n.useCallback)((()=>(0,D.jsx)(Ps,{reducerId:"timeline_groups",store:t,collectionContextStore:r,disabled:A,isFullScreen:c,isRootChild:w,paddingLeft:m,stickyLeft:!1,renderGroup:K,getGroupStyle:W,renderHeader:H,onGroupHeaderAddItem:_,timelineProps:{type:"table",hiddenGroupsVisibleStore:M},groupsResultStore:T,onClickEmptyStateButton:L})),[r,A,W,T,L,M,c,w,_,m,H,K,t]);return(0,D.jsx)("div",{style:{position:"sticky",left:0,height:0,width:F,zIndex:3},children:(0,D.jsx)(lt().A,{style:O.selectable,store:t,shouldShowHalo:!1,canSelect:!c,analyticsName:"timeline",children:(0,D.jsx)(Ml().q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:h,children:p?G():(0,D.jsx)(Pl,{nodeRef:B,children:(0,D.jsx)("div",{ref:B,children:K(void 0)})})})})})})),Hg=n.memo(n.forwardRef((function(e,t){let{store:r,collectionContextStore:i,query:l,schema:p,format:m,paddingLeft:g,paddingRight:S,isFullScreen:h,isPreviewing:f,isRootChild:y,disabled:v,isInPeekRenderer:x,paddingBottom:b,showHoverActionsStore:C,blockPropertyValueOverlayStore:w}=e;const k=function(e){let{isFullScreen:t,isRootChild:o}=e;const[r]=(0,n.useState)((()=>(0,xo().o8)({isFullScreen:t,isRootChild:o})));return r}({isFullScreen:h,isRootChild:y}),A=(0,s().v3)(),I=(0,s().Y0)();(0,a().l)((()=>{const e=i.collectionViewStore();e&&zp().n_({timelineState:k,environment:A,collectionViewStore:e,collectionContextStore:i}),(0,Kp().iH)(A,(0,Kp().ZR)({environment:A,collectionContextStore:i,timelineState:k,isFullScreen:h,isRootChild:y}))})),function(e){let{collectionContextStore:t,query:o,schema:r,environment:i}=e;(0,n.useEffect)((()=>{const e=t.collectionStore();if(e&&!o.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;const l=(0,pt().YK)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});j().createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:i,canUndo:!0,perform:t=>{let s,a=_().HG(r);if(!a&&e.canConfigureCollection){a=(0,Po().Ay)();s={[a]:{name:vt().A.formatMessage(l.date),type:"date"}}}a&&((0,Ii().f)({collectionViewStore:n,update:{timeline_by:a},transaction:t}),Do().zv({store:n,data:{type:"timeline"},transaction:t}),s&&(0,Ho().F)({environment:i,collectionStore:o,update:s,transaction:t}))}})}}),[o,t,r,i])}({collectionContextStore:i,query:l,schema:p,environment:A}),function(e){(0,n.useEffect)((()=>{const t=()=>{We().A.state&&e.hoveredItemStore.setState(void 0)};return We().A.addListener(t),()=>{We().A.removeListener(t)}}),[e])}(k),function(e){let{environment:t,collectionContextStore:o,timelineState:r,isFullScreen:i,isRootChild:l}=e;(0,n.useEffect)((()=>{const e=r.drawStateStore.state;if(null!=e&&e.tryToCompleteDrawnArrow){(0,xo().tH)(o)&&j().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:t,canUndo:!0,perform:e=>{zp().sd({timelineState:r,environment:t,transaction:e,collectionContextStore:o,isFullScreen:i,isRootChild:l})}})}}))}({environment:A,collectionContextStore:i,timelineState:k,isFullScreen:h,isRootChild:y}),(0,c().X)((()=>{k.destroyed=!0,k.outerSizeObserver.destroy(),k.timelineSizeObserver.destroy(),k.horizontalScroller&&(k.horizontalScroller.scrollLeft=0,(0,Re().Ol)(k.horizontalScroller,"scroll",V))}));const R=(0,d().uB)(void 0,Bd),T=(0,d().uB)(void 0,Hp),M=(0,d().uB)(void 0,ka),P=(0,n.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=k;if(!e)return;const o=k.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=k.currentRangeStore.state,i=e.scrollLeft,l=t.rect.state.width,s=(0,xo().w0)(o,r-n),a=(0,xo().o$)(k);if(i<xo().XK){const e=-(0,xo().C1)(o,xo().E6);k.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),zp().k3({timelineState:k,environment:A,zoomLevel:o,centerTimestamp:a})}else if(i+l>s-xo().XK){const e=(0,xo().C1)(o,xo().E6);k.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),zp().k3({timelineState:k,environment:A,zoomLevel:o,centerTimestamp:a})}}),[k,A]),B=(0,fr().U)(P,200),V=(0,n.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=k;if(!e)return;const o=e.scrollLeft,n=k.scrollLeftStore.state;A.device.isIOS&&void 0!==n&&0===o&&n>xo().XK?e.scrollLeft=n:(t&&t(),k.scrollLeftStore.setState(o),(0,xo().nS)(A)?B():P())}),[k,A,B,P]),F=(0,n.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=k.currentRangeStore.state;zp().bu({timelineState:k,centerTimestamp:(e+t)/2})}),[k]),E=(0,n.useRef)(null),O=(0,n.useCallback)((e=>{if(e){E.current=e;const{outerSizeObserver:t}=k;t.observe(e);const o=(0,L().T8)(e);o&&(k.horizontalScroller=o,(0,Re().P4)(o,"scroll",V),F())}}),[V,F,k]),z=(0,d().K8)((()=>i.viewIsFlushToTopbar()),[i]),K=(0,n.useRef)(null),H=(0,d().K8)((()=>{const e=k.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=k.currentRangeStore.state;return(0,xo().w0)(e,o-t)}),[k]),W=(0,d().K8)((()=>!f&&(0,xo().Od)({environment:A,isRootChild:y,isFullScreen:h,format:m})?xo().HV:g),[f,y,h,m,g,A]),G=(0,d().K8)((()=>(0,xo().Ho)({environment:A,paddingLeft:W,format:m,isFullScreen:h,isRootChild:y})),[A,m,h,y,W]);(0,Tu().b)(o(297727).A,(()=>({getNode:()=>K.current,customizeEdgeScrollRect(e){const t=G;return nc().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[G]),(0,n.useImperativeHandle)(t,(()=>({addBlockToView(e){let{store:t,transaction:o}=e;const n=t.getAssociatedCollectionStore()??i.collectionStore();if(n)return zp().$N({environment:A,store:t,timelineState:k,query:l,collectionStore:n,collectionContextStore:i,groupFormat:void 0,transaction:o})}})));const N=(0,d().K8)((()=>(0,xo().iw)({environment:A,format:m,isFullScreen:h,isRootChild:y})),[A,m,h,y]),U=(0,d().K8)((()=>i.groupsStore.anyGroupHasResults()),[i]),$=(0,d().O$)(i.isInHomeWidgetStore),q=(0,d().K8)((()=>Boolean(i.viewsModuleContextStore.getViewModuleType())),[i]),Y=(0,fe().Zp)(),X=(0,d().K8)((()=>_().mM(i,h)),[i,h]),Q=(0,d().K8)((()=>{const{timelineSizeObserver:e}=k;return(e.rect.state.height||120)+b+(h?0:72)+(!h&&N?28:0)+(h&&I.isMobile?72:0)}),[k,b,h,N,I.isMobile]),Z=function(e,t){const o=(0,Be().bx)(e,!1);return(0,d().K8)((()=>{const e=t.permissionScopesStore.state;return o&&e.canEditContent&&!e.isSyncedCollection}),[o,t])}(r,i),J=(0,n.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=k;t.observe(e)}}),[k]),ee=(0,n.useCallback)(((e,t,o)=>{if(A.device.isMobile)zo().uK({environment:A,store:e,pageVisitSource:To().y8.Create});else{const{groupFormat:t}=o,n=t?[t]:[],r=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;Ko().VU({environment:A,store:e,peekMode:_().hH(i),showMoveTo:l,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:i,pageVisitSource:To().y8.Create})}}),[A,i]),te=(0,n.useCallback)((e=>{const t=i.isLoadingStore.state,o=i.groupsStore.getGroupState([]);if(!o)return;const n=o.reducerResultStore.state;e<Ke().A.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,$o().H)({collectionContextStore:i,environment:A,incrementLimitArgs:{isFullScreen:h,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[i,A,h]),oe=(0,u().IS)((e=>({container:{position:"relative",float:"left",minWidth:"100%",width:H,...$?{}:{background:x?e.peekTimelineBackground:e.timelineBackground},...!h&&!N&&!$&&{borderBottom:`1px solid ${e.tableDividerColor}`},...(!U||$)&&{minHeight:150},...h&&{paddingBottom:b},height:$?"100%":Q}})),[Q,h,$,x,U,b,H,N]),{timeline_by:ne}=l;if(!ne)return(0,D.jsx)(Om,{collectionContextStore:i,isFullScreen:h,paddingBottom:b});const re=p[ne];return re&&Wo().$L(re)?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{ref:O}),!z&&!f&&(0,D.jsx)("div",{style:{height:4}}),(0,ei().A)((e=>(0,D.jsx)(Pl,{nodeRef:K,width:H,clipLeftExtra:G||(h?0:W),children:(0,D.jsx)("div",{style:oe.container,className:we().dBr,ref:K,...e,children:(0,D.jsxs)(lt().A,{store:r,analyticsName:"timeline",shouldShowHalo:!h&&!$&&!f,canSelect:!h&&!q,disablePointerEvents:null==Y?void 0:Y.disableAllPointerEvents,style:$?{height:"100%"}:{},children:[(0,D.jsx)(zm,{timelineState:k}),(0,D.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:xo().jI},ref:J,children:[(0,D.jsx)(wg,{store:r,schema:p,query:l,showTable:N,collectionContextStore:i,timelineState:k,disabled:v,isFullScreen:h,isRootChild:y,isInPeekRenderer:x,paddingLeft:W,groupsReducerResultStore:M,hiddenGroupsVisibleStore:T,format:m,canEditCollectionTimeline:Z,isReady:U,blockPropertyValueOverlayStore:w,tableStore:R,scrollerLeftOffset:G,onGroupHeaderAddItem:ee}),(0,D.jsx)(im,{timelineState:k,disabled:v,isReady:U,renderEmitter:i.renderEmitter,isFullScreen:h,isRootChild:y})]}),(0,D.jsx)(Am,{isInPeekRenderer:x,timelineState:k,query:l,schema:p,scrollerLeftOffset:G,collectionContextStore:i,showTable:N}),!(null!=Y&&Y.disableAllPointerEvents)&&(0,D.jsx)(pm,{timelineState:k,isInPeekRenderer:x,paddingLeft:W,paddingRight:!h&&y?8:S,format:m,scrollerLeftOffset:G,isFullScreen:h,isRootChild:y,showTable:N,collectionContextStore:i,isReady:U}),N&&(0,D.jsx)(Kg,{store:r,collectionContextStore:i,groupBy:m.collection_group_by,paddingLeft:W,disabled:v,isFullScreen:h,isRootChild:y,format:m,schema:p,query:l,tableStore:R,scrollerLeftOffset:G,isInPeekRenderer:x,paddingRight:S,paddingBottom:b,isInHomeWidget:$,computedOuterHeight:Q,timelineState:k,showHoverActionsStore:C,blockPropertyValueOverlayStore:w,viewIsFlushToTopbar:z,isReady:U,canEditCollectionTimeline:Z,groupsReducerResultStore:M,hiddenGroupsVisibleStore:T,onGroupHeaderAddItem:ee}),(0,D.jsx)("div",{style:{paddingTop:xo().jI,pointerEvents:"none"},children:(0,D.jsx)(tg,{store:r,collectionContextStore:i,disabled:v,isFullScreen:h,paddingLeft:W,isRootChild:y,format:m,groupsReducerResultStore:M,hiddenGroupsVisibleStore:T,canEditCollectionTimeline:Z,onGroupHeaderAddItem:ee,showTable:N})}),!X&&(0,D.jsx)(Xn().A,{onChange:te})]})})})))]}):(0,D.jsx)(Om,{collectionContextStore:i,isFullScreen:h,paddingBottom:b})})));const Wg=new(se().O2)("CollectionChartView",(async()=>await Promise.all([o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(27634),o.e(28721),o.e(55717),o.e(88372),o.e(22)]).then(o.bind(o,673995)))),Gg=(0,se()._h)(Wg,(e=>e.CollectionChartView)),Ng=new(se().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(85864),o.e(92845),o.e(71718),o.e(95794),o.e(63077),o.e(28271),o.e(17254),o.e(90966),o.e(80896),o.e(40186),o.e(61660),o.e(23133)]).then(o.bind(o,766911)))),Ug=(0,se()._h)(Ng,(e=>e.CollectionFormEditorView));const $g={CollectionMapView:new(se().O2)("CollectionMapView",(async()=>await Promise.all([o.e(83700),o.e(16443),o.e(85864),o.e(92845),o.e(71718),o.e(90625),o.e(73594),o.e(51680)]).then(o.bind(o,19537))))},qg=(0,se()._h)($g.CollectionMapView,(e=>e.CollectionMapView)),Yg=n.memo((function(e){let{store:t,collectionViewStore:r,isDisabled:i,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,isRootChild:u,paddingLeft:p,paddingRight:m,paddingBottom:g,headerSizeObserver:S,viewType:h,timelineViewRef:f,showHoverActionsStore:y,isInFrameWhenSidePeekOpen:v,query:x,schema:b,format:C,maxHeight:w,placementStore:k,templatePickerMenuListStore:A,editorContentContainerRef:I}=e;const j=(0,te().ET)(),[R,T]=(0,d().K8)((()=>["collectionSystemView"===j.contextType,j.isInHomeWidgetStore.state]),[j]),M=!(0,Be().bx)(t,R||i),_=(0,d().K8)((()=>to({store:t,collectionViewStore:r,collectionContextStore:j})),[t,r,j]),P=!(0,Be().bx)(_,R);(0,n.useEffect)((()=>{"rendered"!==xt().default.state.renderPhase&&xt().default.setState({...xt().default.state,renderPhase:"rendered"})}),[]);const B=function(e){let{isFullScreen:t,viewType:o,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:a,store:c}=e;const u=(0,s().v3)();return(0,d().K8)((()=>{const{device:e}=u,s=e.isPhone,d=("gallery"===o||("calendar"===o||"list"===o)&&t)&&n,p=(0,Oe().zo)(u,i),m=O().default.state;return r||l?void 0:t||a?s?`calc(100% - ${2*(0,Ce().F8)(u)}px - ${p}px)`:i?`calc(100% - ${2*O().PeekModePadding.horizontal[m.mode]}px - ${p}px)`:n?(0,Oe().Uh)(u)+(d?(0,Oe().Ql)(u):0):t?`calc(100% - ${2*(0,Ce().Ws)(u)}px - ${p}px)`:(0,V().Ck)(c,void 0,u)?`calc(100% - ${2*(0,Ce().F8)(u)}px - ${p}px)`:V().x6-2*(0,Ce().F8)(u)-p:`calc(100% - ${p}px)`}),[u,o,t,n,i,r,l,a,c])}({isFullScreen:l,viewType:h,isInFrameWhenSidePeekOpen:v,isInHomeWidget:T,isInPeekRenderer:a,isPreviewing:c,isRootChild:u,store:t}),F=a?o(77238).A:o(205682).A,L=(0,d().K8)((()=>S.rect.state.width),[S.rect]);return"table"===h?(0,D.jsx)(Lp,{schema:b,format:C,query:x,store:t,collectionContextStore:j,showHoverActionsStore:y,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,paddingLeft:p,paddingRight:m,minWidth:B,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u,placementStore:k,headerWidth:L},r.id):"board"===h?(0,D.jsx)(ec,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,paddingLeft:p,paddingRight:m,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"page"===h?_?(0,D.jsx)(Xg,{targetStore:_,collectionViewStore:r,disabled:P,templatePickerMenuListStore:A,isFullScreen:l,editorContentContainerRef:I}):null:"calendar"===h?(0,D.jsx)(ad,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,paddingLeft:p,paddingRight:m,maxHeight:w,minWidth:B,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"list"===h?(0,D.jsx)(Rd,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,paddingLeft:p,paddingRight:v&&!T?24:m,minWidth:B,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"gallery"===h?(0,D.jsx)(Hs,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isInPeekRenderer:a,isPreviewing:c,paddingLeft:p,paddingRight:m,paddingBottom:g,headerWidth:L,minWidth:B,disabled:M,blockPropertyValueOverlayStore:F,isRootChild:u},r.id):"timeline"===h?(0,D.jsx)(Hg,{schema:b,format:C,query:x,store:t,collectionContextStore:j,isFullScreen:l,isRootChild:u,isInPeekRenderer:a,isPreviewing:c,minWidth:B,paddingBottom:g,disabled:M,blockPropertyValueOverlayStore:F,showHoverActionsStore:y,ref:f,paddingLeft:p,paddingRight:m},r.id):"form_editor"===h?(0,D.jsx)(Qg,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m},r.id):"chart"===h?(0,D.jsx)(Zg,{collectionViewStore:r,isPreviewing:c,paddingLeft:p,paddingRight:m,headerSizeObserver:S,collectionContextStore:j}):"feed"===h?(0,D.jsx)(o(732430).XQ,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):"map"===h?(0,D.jsx)(qg,{collectionContextStore:j,paddingLeft:p,paddingRight:m,query:x,format:C,schema:b,store:t,renderGroupResults:e=>(0,D.jsx)(Wn,{disabled:!1,canDrag:!1,canDrop:!1,direction:Kn.Vertical,collectionContextStore:j,format:C,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",...e})}):"chat"===h?(0,D.jsx)(Qe().Q1,{collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):"custom"===h?(0,D.jsx)(Qe().bl,{store:t,collectionViewStore:r,collectionContextStore:j,paddingLeft:p,paddingRight:m}):null}));function Xg(e){let{targetStore:t,collectionViewStore:o,disabled:n,templatePickerMenuListStore:r,isFullScreen:i,editorContentContainerRef:l}=e;const s=(0,te().ET)(),{collectionStore:a}=(0,d().K8)((()=>({collectionStore:s.collectionStore()})),[s]);return(0,D.jsx)(ho,{canEdit:!n,disabled:n,store:t,collectionViewStore:o,templatePickerMenuListStore:r,collectionStore:a,isFullScreen:i,editorContentContainerRef:l})}function Qg(e){let{collectionViewStore:t,collectionContextStore:n,paddingLeft:r,paddingRight:i}=e;const l=(0,s().Y0)(),a=(0,u().IS)((e=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:104,marginBottom:104,padding:0,paddingLeft:r,paddingRight:i},disabledBuilderTitle:{fontSize:14,fontWeight:Ro().Wy.regular},disabledBuilderIcon:{fill:e.lightIconColor,height:72,margin:"0 auto"}})),[r,i]),c=(0,d().O$)(He().e);return l.isMobile?(0,D.jsx)(ma,{style:a.disabledBuilderWrapper,title:(0,D.jsx)("span",{style:a.disabledBuilderTitle,children:(0,D.jsx)(pt().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:jo(a.disabledBuilderIcon)}):c?(0,D.jsx)(Ug,{collectionContextStore:n,paddingLeft:r,paddingRight:i},t.id):(0,D.jsx)(ma,{style:a.disabledBuilderWrapper,title:(0,D.jsx)(pt().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Please go online to edit your form"}),icon:(0,o(668435).h)(a.disabledBuilderIcon)})}function Zg(e){let{collectionViewStore:t,isPreviewing:o,paddingLeft:n,paddingRight:r,headerSizeObserver:i,collectionContextStore:l}=e;const s=(0,d().K8)((()=>i.rect.state.width),[i]);return(0,D.jsx)(Gg,{collectionContextStore:l,isPreviewing:o,headingWidth:s,paddingLeft:n,paddingRight:r},t.id)}const Jg=n.memo(Yg);const eS=(0,pt().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function tS(e){var t;let{isFullScreen:n,paddingLeft:r,paddingRight:i,paddingBottom:l}=e;const a=(0,s().v3)(),c=(0,u().DP)(),p=(0,pt().tz)(),m=(0,te().ET)(),[g,S,h]=(0,d().K8)((()=>[m.permissionScopesStore.state,m.settingsStore,m.collectionStore()]),[m]),f=(0,d().K8)((()=>S.state.open),[S]),y=(0,d().K8)((()=>{if(h)return h.getIcon()}),[h]),{isMobileBrowser:v}=(0,s().Y0)(),x=(0,d().K8)((()=>{if(h)return h.getFormat().integration_id}),[h]),C=(0,d().K8)((()=>{if(!h)return!1;const e=h.getFormat().integration_id,t=Qc().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,o(572088).jw)(e).length>0}),[h]),w=(0,d().K8)((()=>Qc().A.integrations.state.find((e=>e.id===x))),[x]),k=(0,d().K8)((()=>null==h?void 0:h.getSpaceId()),[h]),A=(0,d().K8)((()=>{var e;return null===(e=xt().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),I=(0,Ku().Ld)({spaceId:k,userId:A}),j=(0,u().IS)((e=>({integrationTitle:{fontSize:17,fontWeight:590,textAlign:"center"},upgradeDescription:{fontSize:17,fontWeight:510,textAlign:"center",color:e.text.tertiary,marginTop:12},upgradeIcon:{width:18,height:18,margin:2,color:e.text.uiBluePrimary}})),[]);if(!w||!x)return null;const R=I[x];if(R&&!(0,o(411387).e2)(R)&&"product"===(null===(t=R.upsell)||void 0===t?void 0:t.type)){var T;const e=null===(T=R.upsell)||void 0===T?void 0:T.product;if("plus"===e||"business"===e||"enterprise"===e)return(0,D.jsx)("div",{style:{paddingLeft:r,paddingRight:i,paddingTop:8,paddingBottom:n?void 0:l,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,D.jsxs)("div",{style:{paddingRight:f?yo().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,D.jsx)(Nr().B,{icon:y,size:48,disabled:!0,isEmptyPage:!1}),(0,D.jsx)("div",{style:j.integrationTitle,children:(0,D.jsx)(pt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.externalCollectionUpsell.title",values:{integrationName:w.name}})}),(0,D.jsx)("div",{style:j.upgradeDescription,children:(0,D.jsx)(pt().sA,{defaultMessage:"You must upgrade to {subscriptionTier} to use this feature. {learnMoreLink}",id:"collectionViewBlock.externalCollectionUpsell.description",values:{subscriptionTier:p.formatMessage(eS[e]),learnMoreLink:(0,D.jsx)(o(412236).V,{})}})}),(0,D.jsx)(ys().A,{size:"md",icon:o(132855).arrowInCircleUpFillIcon,iconStyle:j.upgradeIcon,style:{marginTop:12},onClick:()=>{o(991249).K(a,{from:"collection_synced_database",upsell:{type:"product",product:e,limit:{type:"none"},trialability:"none"}})},children:(0,D.jsx)(pt().sA,{defaultMessage:"Upgrade",id:"collectionViewBlock.externalCollectionUpsell.upgradeButton.label"})})]})})}const M=!(v&&!C);return(0,D.jsx)("div",{style:{paddingLeft:r,paddingRight:i,paddingTop:8,paddingBottom:n?void 0:l,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,D.jsxs)("div",{style:{paddingRight:f?yo().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,D.jsx)(Nr().B,{icon:y,size:48,disabled:!0,isEmptyPage:!1}),(0,D.jsx)("div",{style:{fontSize:17,fontWeight:Ro().Wy.medium,color:c.text.tertiary,textAlign:"center",marginBottom:-2},children:(0,D.jsx)(pt().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:w.name}})}),g.canConfigureBlock&&(0,D.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:c.text.tertiary},children:M&&(0,D.jsx)(pt().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:w.name,button:e=>(0,D.jsx)(At().A,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{b().Ho({collectionSettingsStore:S})},children:e})}})})]})})}const oS=(0,Io().wt)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,D.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});var nS=()=>o(160475);function rS(e){let{viewType:t,isFullScreen:r,paddingLeft:i,paddingRight:l,paddingBottom:a}=e;const c=(0,s().v3)(),p=(0,te().ET)(),m=(0,d().K8)((()=>p.settingsStore),[p]),g=(0,d().K8)((()=>p.collectionViewBlockStore()),[p]),S=(0,d().O$)(p.permissionScopesStore),h=(0,u().DP)(),{value:f}=(0,se().fJ)(o(883388).Z.mergeWithCSV),y=(0,n.useMemo)((()=>({style:{paddingLeft:i,paddingRight:l,paddingBottom:r?void 0:a},icon:oS({height:48,fill:h.lightIconColor,margin:"0 auto"})})),[r,a,i,l,h.lightIconColor]),v=(0,n.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();b().Ow({collectionContextStore:e,collectionSettingsStore:n}),b().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0}}),(0,x().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(p,c)}),[p,c]),C=(0,d().K8)((()=>"database_menu"===Fo().default.getEligibleGroup({experimentId:"adoption_import_contextual_entry_points",defaultGroup:"control"})),[]),w=(0,n.useCallback)((()=>{C&&((0,nS().t)({environment:c,action:"click",from:"linked_database_view"}),null==f||f.createNewCollectionAndMergeCSV({environment:c,collectionContextStore:p,collectionSettingsStore:m,collectionViewBlockStore:g,baseViewType:"table",input:"",from:"linked_database_view"}))}),[C,c,f,p,m,g]);return S.canConfigureBlock?(0,D.jsx)(ma,{title:t?(0,D.jsx)(pt().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:ft().to[t].toLocaleLowerCase()}}):(0,D.jsx)(pt().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,D.jsx)(pt().sA,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:v,secondaryButtonText:lS({environment:c,isImportCSVEntrypointEnabled:C}),secondaryButtonOnClick:w,...y}):(0,D.jsx)(ma,{title:(0,D.jsx)(pt().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,D.jsx)(pt().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...y})}function iS(e){let{environment:t}=e;return(0,a().w)((()=>{(0,nS().t)({environment:t,action:"view",from:"linked_database_view"})})),(0,D.jsx)(pt().sA,{defaultMessage:"Import CSV",id:"collectionViewBlock.importCSVButton.title"})}function lS(e){let{environment:t,isImportCSVEntrypointEnabled:o}=e;if(o)return(0,D.jsx)(iS,{environment:t})}var sS=()=>o(938090);const aS=n.memo((function(e){let{collectionContextStore:t,store:o,collectionStore:n,collectionViewStore:r,showHoverActionsStore:i,viewSettingsPlacementStore:l,templatePickerMenuListStore:a,leftRightPaddingStore:c,leftRightMarginStore:p,headerHeightStore:m,currentViewType:g,query:S,schema:f,format:y,maxHeight:v,fullWidth:x,scrollerLeftPadding:b,contentEditableVoidLeft:C,additionalCollectionViewInnerHorizontalPadding:w,rootRef:k,timelineViewRef:A,editorContentContainerRef:I,headerSizeObserver:j,isDisabled:R,isFullScreen:T,isInPeek:M,isPreviewing:_,isRootOrDirectChild:P,isPlaceholderExternalCollection:B,isMyTasksEmpty:V,isInFrameWhenSidePeekOpen:F,showHomeCustomDbEmptyState:L,showMyTasksEmptyState:O,isInHomeWidget:z,isHomeCustomDbEmpty:K,isUnlistedView:H,isViewModule:W,handleAddItemClick:G,handleEditorClick:N,handleHorizontalScrollerMount:U,handleEditorMouseDown:$,handleContentMount:q}=e;const Y=(0,s().WS)(),X=T?(0,h().Px)(q,k):q,{paddingLeft:Q,paddingRight:Z}=(0,d().K8)((()=>{var e,t;const o=w??0;return{paddingLeft:((null===(e=c.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=c.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[c,w]),J=(0,d().K8)((()=>"collectionSettings"===t.contextType?0:T?"timeline"===g?96:Of:"timeline"===g||"gallery"===g?0:H?16:Wt().A.state),[T,g,H,t]),ee=(0,d().K8)((()=>!("chat"===g||"custom"===g)&&t.hasSingleCollection()),[g,t]),[te,oe,ne]=(0,d().K8)((()=>[null==n?void 0:n.isReady(),null==n?void 0:n.isDefined(),null==n?void 0:n.canRead()]),[n]),re=(0,u().DP)(),ie=(0,d().K8)((()=>({shimmer:{backgroundColor:re.largeShimmerColor,height:48,marginBottom:10,width:"100%"},content:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",...p.state,...!T&&!_&&{...b&&{marginLeft:-b},maxHeight:v?v-m.state:"inherit",...z&&t.isEditableHomeCollectionStore.state?(0,Ee().V$)({isPhone:Y,theme:re}):{},width:x,left:C}},contentInner:T||_?{..."custom"===g&&{height:"100%"}}:{position:"relative",...z?{height:"100%",maxHeight:"inherit"}:{},..."custom"===g&&{height:"100%"}}})),[p,T,_,b,v,m,z,t.isEditableHomeCollectionStore,Y,re,x,C,g]),le=(0,E().X)("collection_page_view_content_editable_root");if(ee){if(!n)return(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(rS,{viewType:g,isFullScreen:T,paddingLeft:Q,paddingRight:Z,paddingBottom:J})});if(!te)return(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)("div",{style:ie.shimmer,children:(0,D.jsx)(eo().A,{emphasized:!1,style:ie.shimmer})})});if(!oe)return ne?(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(rS,{viewType:g,isFullScreen:T,paddingLeft:Q,paddingRight:Z,paddingBottom:J})}):(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(sS().P2,{collectionStore:n,paddingLeft:Q,paddingRight:Z})})}if(B)return(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(tS,{isFullScreen:T,paddingLeft:Q,paddingRight:Z,paddingBottom:J})});if(V&&"calendar"!==g)return(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(Zt,{collectionContextStore:t,onAddTaskClick:G,from:z?"home_tile_tasks":"home_tasks"})});if(L)return(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!1,style:ie.content,children:(0,D.jsx)(Fe().Y8,{collectionContextStore:t,onAddItemClick:G,from:z?"home_tile_custom_db":"home_custom_db"})});const se=(0,D.jsx)(Jg,{store:o,collectionViewStore:r,viewType:g,isDisabled:R,isFullScreen:Boolean(T),isInPeekRenderer:M,isPreviewing:_,isRootChild:P,paddingLeft:Q,paddingRight:Z,paddingBottom:J,headerSizeObserver:j,timelineViewRef:A,showHoverActionsStore:i,isInFrameWhenSidePeekOpen:F,query:S,schema:f,format:y,maxHeight:v,placementStore:l,templatePickerMenuListStore:a,editorContentContainerRef:I}),ae=O?se:(0,D.jsx)(Ao,{store:o,paddingLeft:b,isPreviewing:_,isFullScreen:Boolean(T),currentViewType:g,isInPeek:M,isInHomeWidget:z,isUnlistedView:H,viewSettingsPlacementStore:l,format:y,isMyTasksEmpty:V,isHomeCustomDbEmpty:K,isInFrameWhenSidePeekOpen:F,handleEditorMouseDown:$,isRootOrDirectChild:P,leftRightPaddingStore:c,paddingBottom:J,handleHorizontalScrollerMount:U,handleEditorClick:N,children:se});if("page"===g&&le)return(0,D.jsx)(fo,{store:o,collectionViewStore:r,isFullScreen:Boolean(T),editorContentContainerRef:I,templatePickerMenuListStore:a,isViewsModule:W,style:ie.content});const ce=(0,D.jsx)("div",{style:ie.contentInner,children:ae});return"page"===g&&W?(0,D.jsx)("div",{style:ie.content,children:ce}):"page"===g?(0,D.jsx)(Jt().c,{disabled:!1,displayName:"CollectionViewPageContent",ref:X,style:ie.content,children:ce}):(0,D.jsx)(rt().s,{ref:X,allowSelectionWithin:!0,style:ie.content,children:ce})}));var cS=()=>o(700250);const dS=n.memo((function(e){let{store:t,leftRightPaddingStore:n,viewSettingsPlacementStore:r,headerHeightStore:i,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,currentViewType:c,isInHomeWidget:u,placementToOrigin:p,alignmentToOrigin:m,headerRef:g,handleAddItemClick:S}=e;const h=(0,te().Ks)(),f=(0,d().K8)((()=>(0,F().RX)(t)?{paddingLeft:0,paddingRight:0}:n.state),[n,t]),x=(0,d().K8)((()=>{var e;return void 0!==(null==h||null===(e=h.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==h?void 0:h.viewsModuleContextStore]),b="form_editor"===c,C=(0,d().K8)((()=>{var e;if(p)return p;if(!b)return;return!(null==h||!h.settingsStore.state.open)&&(0,v().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null===(e=(0,y().$1)(null==h?void 0:h.settingsStore.state.stack))||void 0===e?void 0:e.type)?cS().UV.Right:cS().UV.Bottom}),[p,b,null==h?void 0:h.settingsStore]),w=m??(u?cS().MY.End:void 0),k=b?C===cS().UV.Right?24:12:void 0,A=(0,d().K8)((()=>(null==h?void 0:h.isInlineViewStore.state)&&(null==h?void 0:h.isUnlistedViewStore.state)),[null==h?void 0:h.isInlineViewStore,null==h?void 0:h.isUnlistedViewStore]);return x?null:f&&h?(0,D.jsx)(o(517843).A,{collectionContextStore:h,headerSizeObserver:l,contentSizeObserver:s,settingsHeaderSizeObserver:a,headerHeightStore:i,placementStore:r,marginTop:A?-10:void 0,placementToOrigin:C,alignmentToOrigin:w,originGap:k,headerRef:g,...f,handleAddItemClick:S}):null}));var uS=()=>o(430923),pS=()=>o(42425);const mS={ConfigureViewsMainModuleAddViewButton:new(se().O2)("ConfigureViewsMainModuleAddViewButton",(async()=>await Promise.all([o.e(55373),o.e(36192),o.e(44711),o.e(62475),o.e(3151),o.e(53321),o.e(58550),o.e(98629),o.e(22900),o.e(85864),o.e(92845),o.e(71718),o.e(83324),o.e(95794),o.e(38744),o.e(63077),o.e(28271),o.e(17254),o.e(41870),o.e(90966),o.e(7114),o.e(67435),o.e(92012),o.e(22462),o.e(8184),o.e(4422),o.e(28721),o.e(6463),o.e(71993),o.e(94387),o.e(52393),o.e(77692),o.e(26090),o.e(12341),o.e(66984),o.e(90978),o.e(87598),o.e(64598),o.e(86787),o.e(80896),o.e(1440),o.e(20636),o.e(55717),o.e(7005),o.e(22585),o.e(73206),o.e(43020),o.e(88208)]).then(o.bind(o,965731))))},gS=(0,se()._h)(mS.ConfigureViewsMainModuleAddViewButton,(e=>e.ConfigureViewsMainModuleAddViewButton)),SS=(0,pt().YK)({defaultAddViewAriaLabel:{id:"collectionViewTabBar.addView",defaultMessage:"Add view, chart, or form"},defaultAddViewTooltip:{id:"collectionViewTabBar.addViewTooltip",defaultMessage:"Add a new view, chart, or form"},linkedAddViewAriaLabel:{id:"collectionViewTabBar.linkedAddView",defaultMessage:"Add view or chart"},linkedAddViewTooltip:{id:"collectionViewTabBar.linkedAddViewTooltip",defaultMessage:"Add a new view or chart"},viewsModuleAddViewAriaLabel:{id:"collectionViewTabBar.viewsModuleAddView",defaultMessage:"Add tab"},viewsModuleAddViewTooltip:{id:"collectionViewTabBar.viewsModuleAddViewTooltip",defaultMessage:"Add a new tab"}}),hS=n.memo((function(e){const{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r}=e,i=(0,d().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]),l=(0,u().IS)((()=>({flex:{display:"flex"}})),[]);return t.showAddViewButton?(0,D.jsx)(kt().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.flex,onMouseDown:n,children:i?(0,D.jsx)(fS,{variant:r}):(0,D.jsx)(yS,{collectionContextStore:o,variant:r})}):null})),fS=n.memo((function(e){const{variant:t}=e,o=(0,pt().tz)(),r=(0,u().IS)((e=>({button:{..."pills"===t?{height:28,width:28,borderRadius:"100%"}:void 0,background:e.tint.uiBlue},hoveredButton:{color:e.text.uiBluePrimary,background:e.tint.uiBlueHover},pressedButton:{color:e.text.uiBluePrimary,background:e.tint.uiBluePressed},icon:{fill:e.icon.uiBluePrimary,height:Io().Ev.sm,width:Io().Ev.sm}})),[t]),i=(0,n.useCallback)((()=>(0,D.jsx)(pt().sA,{...SS.viewsModuleAddViewTooltip})),[]),l=(0,n.useCallback)(((e,t)=>(0,D.jsx)(It().A,{ariaLabel:o.formatMessage(SS.viewsModuleAddViewAriaLabel),className:we().Tel,icon:or().plusSmallIcon,style:r.button,hoveredStyle:r.hoveredButton,pressedStyle:r.pressedButton,iconStyle:r.icon,...t,...e})),[o,r.button,r.hoveredButton,r.icon,r.pressedButton]),s=(0,n.useCallback)((e=>(0,D.jsx)(jt().A,{renderTooltip:i,render:t=>l(t,e)})),[l,i]);return(0,D.jsx)(gS,{renderOrigin:s})})),yS=n.memo((function(e){const{collectionContextStore:t,variant:o}=e,r=(0,pt().tz)(),i=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isLinkedCollectionView()}),[t]),l=(0,u().IS)((()=>({button:{..."pills"===o?{height:28,width:28,borderRadius:"100%"}:void 0},icon:{height:Io().Ev.sm,width:Io().Ev.sm}})),[o]),s=(0,n.useCallback)((e=>(0,D.jsx)(uS().y7,{collectionContextStore:t,onClose:e.close,showNewViewItems:!0})),[t]),a=(0,n.useCallback)((()=>(0,D.jsx)(pt().sA,{...i?SS.linkedAddViewTooltip:SS.defaultAddViewTooltip})),[i]),c=(0,n.useCallback)(((e,t)=>(0,D.jsx)(It().A,{ariaLabel:r.formatMessage(i?SS.linkedAddViewAriaLabel:SS.defaultAddViewAriaLabel),className:we().Tel,icon:or().plusSmallIcon,style:l.button,iconStyle:l.icon,...t,...e})),[r,i,l.button,l.icon]),p=(0,n.useCallback)((e=>(0,D.jsx)(jt().A,{renderTooltip:a,render:t=>c(t,e)})),[c,a]);return(0,D.jsx)(qi().Ay,{popupType:qi().z7.Popup,alignmentToOrigin:pS().C1.Start,originGap:4,render:s,renderOrigin:p},"suggested-views")}));var vS=()=>o(300089),xS=()=>o(638013);function bS(e){const{origin:t}=e,o=(0,s().v3)();return(0,D.jsx)(td().k,{origin:t,placementToOrigin:"bottom",header:(0,D.jsx)(pt().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,D.jsx)(pt().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Au().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:ju().gO,pointerOffset:ju().Nu,style:{width:ju().Sw}})}function CS(e){const{origin:t}=e,o=(0,s().v3)();return(0,D.jsx)(td().k,{origin:t,placementToOrigin:"right",header:(0,D.jsx)(pt().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,D.jsx)(pt().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,D.jsx)("span",{style:{fontWeight:Ro().Wy.semibold},children:e})}}),onCloseClick:()=>{Au().A6(o)},pointerPosition:"50%",pointerLength:ju().gO,pointerOffset:ju().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:ju().Sw}})}var wS=()=>o(448801);function kS(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:n}=e,r=t.getCollectionViewStores(),{beforeOps:i}=(0,wS().i)(r.map((e=>e.id)).slice(0,o.length),o);y().jJ(i,((e,r)=>{const i=ae().pS.createChildStore(t,{table:f().Gy,id:r,spaceId:t.getSpaceId()});if(e)rn().nc({parentStore:t.getCollectionViewsStore(),insertStore:i,beforeStore:ae().pS.createChildStore(t,{table:f().Gy,id:e,spaceId:t.getSpaceId()}),transaction:n});else{const e=y().HV(o.filter((e=>e!==r)));rn().WH({parentStore:t.getCollectionViewsStore(),insertStore:i,afterStore:e?ae().pS.createChildStore(t,{table:f().Gy,id:e,spaceId:t.getSpaceId()}):void 0,transaction:n})}}))}var AS=()=>o(745266),IS=()=>o(274652),jS=()=>o(180762),RS=()=>o(612740),TS=()=>o(921855),MS=()=>o(31902),_S=()=>o(859384),PS=()=>o(764781),BS=()=>o(167170),VS=()=>o(742852),FS=()=>o(735790),LS=()=>o(313892),ES=()=>o(697650),OS=()=>o(447934),DS=()=>o(400851),zS=()=>o(46986),KS=()=>o(239529);function HS(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;const i=(0,s().v3)(),l=(0,s().Y0)(),a=(0,pt().tz)(),c=(0,fe().Zp)(),u=(0,E().X)("db_ux_chrome"),p=(0,d().K8)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:n,onClose:r,environment:i,intl:l,previewContext:s,isDBUXChromeEnabled:a}=e;const c=n.permissionScopesStore.state,d=n.collectionViewStore(),u=n.collectionViewBlockStore();if(!d||!u)return[];const p=(0,Le().Nh)(u.id),m=(0,Ce().sj)(u.id);if("feed"===o.getType())return[];const g=d.id===o.id,S=o.getAppConfigUri(),h=!S||(0,LS().$h)(S),f=n.collectionStore(),y=Boolean((null==f||null===(t=f.getParentBlockStore())||void 0===t?void 0:t.id)===u.id),v=void 0!==f||"page"===o.getType(),C=y&&n.isFullScreenStore.state,w=o.getType(),k=n.viewsModuleContextStore,A=void 0!==k.state,I=c.canConfigureBlock&&v&&!A,R=!m&&"form_editor"!==w&&"page"!==w&&v&&c.canConfigureBlock,T=u.getCollectionViewIds().length>1,M=n.isEditableHomeCollectionStore.state,_=!m&&(T||M)&&"page"!==w&&c.canConfigureBlock,P=f&&!C&&!A&&!(null!=s&&s.disablePageLinks),B=!A&&v&&!(null!=s&&s.disablePageLinks),V=k.currentPageStore(),F=null==V?void 0:V.getAssociatedCollectionStore(),L=V&&!k.isInLayoutBuilder()&&(0,DS().Y)({environment:i,blockStore:V,from:"viewsModule"}),E=n.isFullScreenStore.state,O=Boolean(u.getCollectionPointerIfSingleSource()),z=!p&&c.canConfigureBlock&&(!E||!O)&&!(null!=s&&s.hideViewBlockSource)&&!("page"===w&&void 0===o.getFormat().page_pointer),K=[];K.push([]),L&&V&&F&&K[0].push({key:"configure_layout",render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,D.jsx)(Er().I,{icon:BS()._})}),action:()=>{F&&V&&(0,OS().nh)({environment:i,blockStore:V,collectionStore:F,from:"collection_view_action_menu",initialSelectedModuleType:"viewsMain"})}});if(I){if(K[0].push({key:"rename",render:e=>(0,D.jsx)(jt().A,{placement:De().W.Left,disableTooltip:h,render:t=>(0,D.jsx)($i().A,{...e,disabled:!h,disabledFeedback:!0,title:(0,D.jsx)(pt().sA,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,D.jsx)(Er().I,{icon:_S().M}),...t}),renderTooltip:()=>(0,D.jsx)(pt().sA,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view canâ€™t be renamed."})}),action:()=>{(0,x().X)({environment:i,collectionContextStore:n,action:"view_action_menu_rename"}),null==r||r(!0),g||(0,jS().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:E,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),b().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore,selectViewNameInitial:!0})}}),"page"===w)return K;K[0].push({key:"edit",render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,D.jsx)(Er().I,{icon:FS().M})}),action:()=>{(0,x().X)({environment:i,collectionContextStore:n,action:"view_action_menu_edit"}),null==r||r(!0),g||(0,jS().t)({environment:i,collectionContextStore:n,collectionViewId:o.id,isFullScreen:n.isFullScreenStore.state,isRootChild:n.isRootChildStore.state,isInPeekRenderer:n.isInPeekRendererStore.state}),b().Ow({collectionContextStore:n,collectionSettingsStore:n.settingsStore})}})}K.push([]),B&&K[1].push({key:"copyLink",render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,D.jsx)(Er().I,{icon:VS().w})}),action:async()=>{(0,x().X)({environment:i,collectionContextStore:n,action:"view_action_menu_copy_link"}),await b().GH({environment:i,collectionContextStore:n,collectionViewStore:o}),null==r||r(!1)}});P&&K[1].push({key:"openSourceDb",render:e=>(0,D.jsx)(jt().A,{placement:De().W.Right,render:t=>(0,D.jsx)($i().A,{title:y?(0,D.jsx)(pt().sA,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,D.jsx)(pt().sA,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,D.jsx)(Er().I,{icon:gr().arrowDiagonalUpRightIcon}),...(0,Hi().A)(e,t)}),renderTooltip:()=>(0,D.jsx)(WS,{collectionStore:f})}),action:e=>{(0,KS().q)({environment:i,collectionContextStore:n,event:e.event})}});if(z){const e=(()=>{if(a){const e=u.getFormatStore().getKeyValue("hide_inline_collection_name");return void 0===e?u.getCollectionViewStores().some((e=>e.getFormatStore().getKeyValue("hide_linked_collection_name"))):e}return n.normalizedFormatStore.state.hide_linked_collection_name})();K[1].push({key:"showDatabaseTitle",render:t=>(0,D.jsx)($i().A,{...t,title:e?(0,D.jsx)(pt().sA,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}):(0,D.jsx)(pt().sA,{defaultMessage:"Hide database title",id:"database.viewSettings.viewActionMenu.hideDatabaseTitle"}),icon:(0,D.jsx)(Er().I,{icon:vi().eyeIcon})}),action:()=>{const t=!e;(0,x().X)({environment:i,collectionContextStore:n,action:t?"click_source_hide_title":"click_source_show_title"}),j().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{Oo().zA({stores:[o],update:{hide_linked_collection_name:t},transaction:e})}}),a&&j().createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:i,canUndo:!0,perform:e=>{Oo().zA({stores:[u],update:{hide_inline_collection_name:t},transaction:e})}}),null==r||r(!1)}})}K.push([]),R&&K[2].push({key:"duplicate",render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,D.jsx)(Er().I,{icon:PS().V})}),action:()=>{(0,x().X)({environment:i,collectionContextStore:n,action:"view_action_menu_duplicate"}),b().vr({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,intl:l,from:"view_action_menu_duplicate"}),null==r||r(!0)}});_&&K[2].push({key:"delete",render:e=>(0,D.jsx)($i().A,{...e,title:(0,D.jsx)(pt().sA,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,D.jsx)(Er().I,{icon:xi().trashIcon}),isRedOnHover:!0}),action:async()=>{(0,x().X)({environment:i,collectionContextStore:n,action:"view_action_menu_delete"});const e="form_editor"===(null==o?void 0:o.getType())?o.getFormBlockStore():void 0;await b().nl({environment:i,collectionContextStore:n,collectionViewStore:o,collectionSettingsStore:n.settingsStore,additionalBlocksToDelete:e?[e]:void 0,from:"view_action_menu"})&&(null==r||r(!1))}});return K}({collectionViewStore:t,collectionContextStore:o,onClose:r,environment:i,intl:a,previewContext:c,isDBUXChromeEnabled:u})),[o,t,i,a,r,c,u]),m=p.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!m)return null;const e=l.isMobile?{menuType:ji().gu.Modal,title:(0,D.jsx)(pt().sA,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:ji().gu.Popup,width:220};return(0,D.jsx)(Ti().A,{...e,children:(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:void 0,sections:y().oE(p.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,D.jsx)(Pi().A,{...e,topBorder:0!==t}),items:e}})))})})}),[m,l.isMobile,p]),hasMenuItems:m}}function WS(e){const{collectionStore:t}=e,o=(0,pt().tz)(),n=(0,s().v3)(),r=(0,d().K8)((()=>{var e,r;const i=t.getNameStore(),l=(0,zS().ei)(n),s=(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({intl:o}))||o.formatMessage(ES().k9.titlePlaceholder),a=(0,ES().nE)({intl:o});return(0,TS().r4)(i.getValue(),i)||(null===(r=t.getModel())||void 0===r?void 0:r.getEmptyTitlePlaceholder({intl:o}))||(l?a:s)}),[t,o,n]);return(0,D.jsx)(pt().sA,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens â€œ{dbName}â€",values:{dbName:r}})}function GS(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:i}=e,{device:l}=(0,s().v3)(),a=(0,u().IS)((e=>({tooltipMessage:{color:e.text.contrastSecondary}})),[]),c=(0,pt().tz)(),p=(0,d().uB)(void 0,ze().A),[m,g,S,h,f,y]=(0,d().K8)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,o.getCollectionStore(),t.permissionScopesStore.state.canConfigureBlock&&"feed"!==o.getType()]),[o,t]),v=(0,d().K8)((()=>null!=f&&f.isDefined()?(0,TS().r4)(f.getName(),f)||f.getModel().getEmptyTitlePlaceholder({intl:c}):(0,RS().L)(c)),[f,c]),x=(0,n.useCallback)((e=>{p.setState({open:!1}),e&&i()}),[p,i]),{renderMenu:b}=HS({collectionViewStore:o,collectionContextStore:t,onClose:x});return void 0===g?null:(0,D.jsx)(jt().A,{renderTooltip:e=>(0,D.jsxs)("div",{...e,style:Eu().Q$,children:[(0,D.jsx)("div",{children:(0,_().OO)({collectionViewName:m,collectionViewType:g})}),void 0!==f&&(0,D.jsx)("div",{style:a.tooltipMessage,children:h||(0,D.jsx)(pt().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:ft().to[g],collection:v}})})]}),placement:De().W.Left,render:e=>(0,D.jsx)($i().A,{title:(0,D.jsx)(MS().A,{collectionViewType:g,collectionViewName:m}),icon:(0,D.jsx)(AS().h,{color:"regular",viewIcon:S,viewType:g}),showDragHandle:!l.isMobile&&y,right:y?(0,D.jsx)(qi().Ay,{popupType:l.isMobile?qi().z7.BottomSheet:qi().z7.Popup,renderOrigin:e=>(0,D.jsx)(It().A,{icon:Lr().Y,iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm},ariaLabel:c.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:b,buttonPopupStore:p}):null,rightStyle:{marginRight:8},...(0,Hi().A)(e,r)})})}function NS(e){const{collectionContextStore:t,onAddViewClick:r,onClose:i,onViewClick:l}=e,a=(0,pt().tz)(),c=(0,s().Y0)(),[u,p]=n.useState(0),[m,g]=n.useState(""),[S,h]=(0,o(857437).$)(),f=(0,d().uB)(void 0,o(970585).A),y=(0,d().K8)((()=>{var e;return!(c.isMobile||null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()||"feed"===t.getViewType())}),[t,c.isMobile]),v=(0,d().K8)((()=>{var e;return((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]).filter((e=>(0,_().As)(e,m)))}),[t,m]),x=(0,d().K8)((()=>!c.isMobile&&t.permissionScopesStore.state.canConfigureBlock&&"feed"!==(null==t?void 0:t.getViewType())),[t,c.isMobile]),b=(0,d().K8)((()=>(0,_().NB)(t,c)),[t,c]),C=n.useCallback((e=>{g(e.target.value),f.setState({...f.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[f]);return n.useEffect((()=>{var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,r=((null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===n));r>=0&&p(r)}),[t]),(0,D.jsx)(it().A,{capture:!0,allowEsc:!0,render:e=>{let n;return n=c.isPhone?{menuType:ji().gu.Modal,title:(0,D.jsx)($S,{collectionContextStore:t}),right:(0,D.jsx)(_i().DoneMenuText,{}),onClickRight:i}:{menuType:ji().gu.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh"},(0,D.jsxs)(Ti().A,{...n,...e,header:y?(0,D.jsx)(Aa().Ay,{value:m,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:C,placeholder:a.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"}),...S}):null,footer:x&&(0,D.jsxs)(Pi().A,{topBorder:!0,children:[(0,D.jsx)(QS,{collectionContextStore:t,onClose:i,onAddViewClick:r}),b?null:(0,D.jsx)(o(94778).A,{collectionContextStore:t,onClose:i,focused:!1,isCompact:!0,compactColor:"secondary"})]}),children:[(0,D.jsx)(qS,{collectionContextStore:t,filteredViewStores:v,isDraggable:x&&""===m,menuListStore:f,initialMenuListFocus:u,onClose:i,onViewClick:l,comboboxProps:h}),m&&0===v.length&&(0,D.jsx)(o(736767).A,{caption:(0,D.jsx)(pt().sA,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),c.isMobile?(0,D.jsx)(QS,{collectionContextStore:t,onClose:i,onAddViewClick:r}):null]})}})}const US=n.memo(NS);function $S(e){let{collectionContextStore:t}=e;const o=(0,d().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}),[t]);return(0,D.jsx)(pt().sA,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function qS(e){const{collectionContextStore:t,onViewClick:o,onClose:r}=e,i=(0,s().v3)(),l=n.useCallback(((e,n)=>{const l=t.collectionViewStore(),s=Re().Vr(e);l&&o({currentCollectionViewStore:l,newCollectionViewStore:n,openInNew:s});const a=t.isFullScreenStore.state,c=t.isRootChildStore.state,d=t.isInPeekRendererStore.state;(0,jS().t)({environment:i,collectionContextStore:t,collectionViewId:n.id,openInNew:s,isFullScreen:a,isRootChild:c,isInPeekRenderer:d}),(0,x().X)({environment:i,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:n.getType(),new_view_id:n.id}),s||r()}),[t,i,o,r]);if(0===e.filteredViewStores.length)return null;const a={key:"views",render:t=>(0,D.jsx)(YS,{menuListSectionProps:t,collectionContextStore:e.collectionContextStore,filteredViewStores:e.filteredViewStores,isDraggable:e.isDraggable,menuListStore:e.menuListStore}),items:e.filteredViewStores.map((t=>({key:t.id,render:o=>(0,D.jsx)(XS,{collectionContextStore:e.collectionContextStore,onClose:e.onClose,collectionViewStore:t,props:o}),action:e=>{let{event:o}=e;l(o,t)}})))};return(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,initialFocus:e.initialMenuListFocus,sections:[a],store:e.menuListStore,comboboxProps:e.comboboxProps})}function YS(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>e.filteredViewStores.map((e=>e.id))),[e.filteredViewStores]),r=n.useCallback(((o,n)=>{const r=e.collectionContextStore.collectionViewBlockStore();r&&(j().createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,canUndo:!0,perform:e=>{kS({collectionViewBlockStore:r,newViewIds:o,transaction:e})}}),e.menuListStore.reset())}),[t,e.collectionContextStore,e.menuListStore]);return e.isDraggable?(0,D.jsx)(Pi().A,{...e.menuListSectionProps,children:(0,D.jsx)(da().Ay,{direction:"vertical",keys:o,renderKey:t=>e.menuListSectionProps.children[o.indexOf(t)],onDrop:r})}):(0,D.jsx)(Pi().A,{...e.menuListSectionProps})}function XS(e){let{collectionViewStore:t,props:o,collectionContextStore:n,onClose:r}=e;return(0,D.jsx)(GS,{collectionContextStore:n,collectionViewStore:t,onClose:r,menuListItemProps:o})}function QS(e){const t=(0,s().v3)(),o=(0,d().K8)((()=>{var t;if(!e.collectionContextStore.permissionScopesStore.state.canConfigureBlock)return!1;return!(0,Ce().sj)((null===(t=e.collectionContextStore)||void 0===t||null===(t=t.collectionViewBlockStore())||void 0===t?void 0:t.id)??"")}),[e.collectionContextStore]),n=(0,d().K8)((()=>"viewsMain"===e.collectionContextStore.viewsModuleContextStore.getViewModuleType()),[e.collectionContextStore]);if(!o)return null;const r=(0,D.jsx)(pt().sA,{defaultMessage:"New view",id:"database.collectionViewSelect.newViewButtonTitle"});return n?(0,D.jsx)(gS,{renderOrigin:e=>(0,D.jsx)(IS().A,{onClick:()=>{e.onClick()},title:r,focused:!1}),onClose:e.onClose}):(0,D.jsx)(qi().Ay,{popupType:t.device.isMobile?ja().nl.SlideUp:ja().nl.Popup,alignmentToOrigin:qi().yP.Center,placementToOrigin:qi().sx.Right,renderOrigin:e=>(0,D.jsx)(IS().A,{...e,title:r,focused:!1}),render:t=>(0,D.jsx)(uS().y7,{collectionContextStore:e.collectionContextStore,onClose:()=>{e.onClose(),t.close()},showNewViewItems:!1})})}var ZS=()=>o(374562),JS=()=>o(522827),eh=()=>o(115512);const th=n.memo((function(e){var t,r;const{collectionViewStore:i,collectionContextStore:l,hideUnderline:a,onViewClick:c,disabled:p,variant:m="default"}=e,g=(0,s().v3)(),S=(0,s().Y0)(),h=(0,u().DP)(),[f,y]=(0,n.useState)(!1),v=(0,o(937199).v$)(),C=(0,fe().Zp)(),[w,k]=(0,d().K8)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),A=(0,n.useCallback)((()=>{y(!1)}),[]),{renderMenu:I,hasMenuItems:j}=HS({collectionViewStore:i,collectionContextStore:l,onClose:A}),R=(0,n.useCallback)((()=>{!j||null!=C&&C.disableAllPointerEvents||y(!0)}),[C,j]),T=(0,n.useCallback)((e=>{e.preventDefault(),(0,Te().SQ)({event:e,context:Te().y$.EditorContextMenu,callback:R})}),[R]),M=(0,n.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const o=l.viewsModuleContextStore.state?void 0:Re().Vr(e);if(c({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:o}),t.id===i.id?R():(0,jS().t)({environment:g,collectionContextStore:l,collectionViewId:i.id,openInNew:o,isFullScreen:l.isFullScreenStore.state,isRootChild:l.isRootChildStore.state,isInPeekRenderer:l.isInPeekRendererStore.state}),w&&v){var n;const e=null===(n=l.viewsModuleContextStore.getViewsModule())||void 0===n?void 0:n.id;e&&(v.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),b().Ow({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}(0,x().X)({environment:g,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id})}),[l,c,R,i,w,v,g]),{currentViewStore:P,collectionViewBlockStore:B}=(0,d().K8)((()=>({currentViewStore:l.collectionViewStore(),collectionViewBlockStore:l.collectionViewBlockStore()})),[l]),{isDefinedCollectionViewStore:V,viewIcon:F,viewType:L}=(0,d().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType()})),[i]),E=(null===(t=(0,_().Oz)(l))||void 0===t?void 0:t.background)??"none",O=(0,n.useRef)(null),z=(0,d().K8)((()=>{var e,t;return!((null==B?void 0:B.getSpaceId())!==(null===(e=xt().default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===at().Lu&&"sprint_board"===(null===(t=xt().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,B]),K=(0,d().K8)((()=>{var e;return!0===(null===(e=xt().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),H=(0,d().K8)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),W=(null==P?void 0:P.id)===i.id,G="pills"!==m&&!a&&W&&H,N=W&&w&&"existing_module"===(null==v||null===(r=v.currentModuleSelection)||void 0===r?void 0:r.type)&&v.currentModuleSelection.moduleId===k;return V&&P&&B?(0,D.jsx)(ja().Ay,{popupType:S.isMobile?ja().nl.BottomSheet:ja().nl.Popup,alignmentToOrigin:De().C.Start,open:f,render:I,onDismiss:A,trapFocus:!0,origin:(0,D.jsxs)("div",{className:we().f_$,style:{display:"flex",alignItems:"center",background:w?void 0:E,height:"100%",...G&&{borderBottom:`2px solid ${h.text.primary}`,paddingTop:2},..."pills"===m?{marginRight:1}:void 0},onContextMenu:T,children:[z&&(0,D.jsx)(br().U7,{origin:O}),K&&(0,D.jsx)(Lu().gO,{origin:O,store:l}),(0,D.jsx)(oh,{collectionViewStore:i,render:e=>(0,D.jsxs)(ur().p,{"aria-selected":W,role:"tab",ref:O,size:"pills"===m?"lg":"md",style:{display:"flex",alignItems:"center",height:32,fontSize:14,fontWeight:Ro().Wy.medium,color:W?h.text.primary:h.text.secondary,maxWidth:ih,..."pills"===m?{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px 6px 10px",whiteSpace:"nowrap"}:{},...w?N?(0,eh().nl)({width:3,color:h.stroke.uiBluePrimary}):(0,eh().nl)({width:1.5,color:h.stroke.uiBlueSecondary}):void 0,...w?{marginRight:4,transition:"box-shadow 0.3s"}:void 0},hovered:w?W&&!N:"pills"===m?f||W:f,hoveredStyle:w?{...(0,eh().nl)({width:3,color:h.stroke.uiBlueSecondary}),background:"none"}:void 0,pressedStyle:w?{...(0,eh().nl)({width:3,color:h.stroke.uiBluePrimary}),background:"none"}:void 0,onClick:M,disabled:p,...e,children:[(0,D.jsx)(AS().h,{color:W?"regular":"light",viewIcon:F,viewType:L,style:{marginRight:6}}),(0,D.jsx)("span",{style:{...Ro().RC,marginTop:1},children:(0,D.jsx)(rh,{collectionContextStore:l,collectionViewStore:i})})]},i.id)})]})}):null}));function oh(e){const t=(0,u().DP)(),{collectionViewStore:o,render:n}=e,r=(0,te().ET)(),i=(0,d().K8)((()=>{var e;const t=null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id;return!!t&&((0,Ce().sj)(t)&&r.isInHomeWidgetStore.state)}),[r.isInHomeWidgetStore,o]),[l,s]=(0,d().K8)((()=>{const e=o.getName(),t=o.getType(),n=(0,_().OO)({collectionViewName:e,collectionViewType:t});if(!t)return[n,void 0];const r=o.getFormat().description;if(r)return[n,r];const i=o.getCollectionStore(),l=null==i?void 0:i.getName();if(i&&l){var s,a;if((null==i||null===(s=i.getParentBlockStore())||void 0===s?void 0:s.id)===(null===(a=o.getParentBlockStore())||void 0===a?void 0:a.id))return[n,(0,D.jsx)(pt().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:ft().to[t],collection:(0,TS().r4)(l,i)}},"viewTab.tooltip.2")]}return[n,(0,D.jsx)(pt().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:ft().to[t]}},"viewTab.tooltip.2")]}),[o]);return l?(0,D.jsx)(jt().A,{placement:i?De().W.Top:De().W.Bottom,originGap:i?0:void 0,alignment:De().C.Start,delayThreshold:500,style:i?{marginBottom:-5,marginLeft:8}:{},render:e=>i?(0,D.jsx)("div",{style:{marginLeft:-8},children:n(e)}):n(e),renderTooltip:e=>i?(0,D.jsx)(pt().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"}):(0,D.jsxs)("div",{...e,style:Eu().Q$,children:[l,(0,D.jsx)("div",{style:{color:t.text.contrastSecondary},children:s})]})}):null}function nh(e,t,o){var n;const r=e.collectionStore();if(!r)return t.getName();const i=r.getPropertyMapping(),l=t.getName(),s=null==i?void 0:i[at().yx.TaskToSprintRelation];if(!o||!s||l!==vt().A.formatMessage(ZS().DZ.tasksCurrentSprintV2ViewName))return t.getName();const a=o[s];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(n=(0,JS().ax)(e,"current",a.collection_pointer,r))||void 0===n?void 0:n.getBlockTitleStore().getValue();return c?`${vt().A.formatMessage(ZS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function rh(e){const{collectionViewStore:t,collectionContextStore:o}=e,[n,r]=(0,d().K8)((()=>{const e=o.settingsStore.state;return[e.open,y().HV(e.stack)]}),[o.settingsStore]),i=(0,d().K8)((()=>o.viewsModuleContextStore.state),[o.viewsModuleContextStore]),l=(0,d().K8)((()=>o.collectionViewStore()),[o]),s=(0,d().K8)((()=>t.getCollectionStore()),[t]),a=(0,d().K8)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===at().Lu&&null!=s&&s.isDefined()?{name:nh(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]),c=n&&r&&("duplicateExistingView"===r.type||"createView"===r.type);return!a||(null==l?void 0:l.id)===t.id&&c&&!i?(0,D.jsx)(pt().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,D.jsx)(MS().A,{collectionViewName:a.name,collectionViewType:a.type})}const ih=220,lh={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:52}},sh=n.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:r,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:a,disabled:c,variant:p="default"}=e,m=(0,s().v3)(),g=(0,s().Y0)(),S=(0,s().WS)(),h=(0,u().DP)(),f=(0,E().X)("db_ux_chrome"),y=(0,n.useRef)(null),v=(0,n.useRef)(null),b=(0,n.useRef)(new(Ye().E)({throttleMs:50})),C=(0,n.useRef)(new Map),w=(0,d().O$)(r),k=(0,fe().Zp)(),A=(0,n.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:I,MORE_BUTTON_MAX_WIDTH:R,ADD_VIEW_BUTTON_MAX_WIDTH:T,VIEW_TAB_PADDING:M}=(0,n.useMemo)((()=>lh[p]),[p]),{permissionScopes:P,isFullScreen:V,isInHomeWidget:F,isEditableHomeCollectionStore:L,isInCollectionViewPageWithContent:O,isEditingViewsModuleInPageBuilder:z}=(0,d().K8)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,isFullScreen:t.isFullScreenStore.state,isInHomeWidget:t.isInHomeWidgetStore.state,isEditableHomeCollectionStore:t.isEditableHomeCollectionStore.state,isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),K=(0,d().K8)((()=>{var e;return l?[]:(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[t,l]),H=(0,d().K8)((()=>Boolean(Ne().Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(739135).gt)(xt().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]);(0,n.useEffect)((()=>{const e=b.current;return()=>{e.destroy()}}),[b]);const W=(0,n.useCallback)((e=>{let t=C.current.get(e.id);t||(t=new(o(773363).k)({style:{fontSize:`${Ro().J.UIRegular.desktop}px`,fontWeight:Ro().Wy.medium}}),C.current.set(e.id,t));const n=(0,_().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),r=t.measure(n);return Math.min(M+r.width,ih)}),[M]),G=(0,d().K8)((()=>ah(t,i,k,l)),[t,i,k,l]),N=(0,d().K8)((()=>{const e=t.collectionViewStore();if(!e)return;if("collectionSettings"===t.contextType)return[];const o=Math.max(R,G?T:0);let n=b.current.rect.state.width-o;const r=[],i=W(e);if(!(i<n))return r;r.push(e),n-=i;for(const t of K){if(t.id===e.id)continue;const o=W(t);if(!(o<n))break;r.push(t),n-=o}const l=r.filter((t=>t.id!==e.id)),s=K.findIndex((t=>t.id===e.id));return l.splice(s,0,e),l}),[t,R,G,T,W,K]),U=(0,d().K8)((()=>"collectionSettings"===t.contextType),[t]),$=(0,n.useMemo)((()=>{const e=(null==N?void 0:N.length)||0,t=K.length-e,o=N&&(0===e||1===e&&K.length>1)||S||O||L,n=U?"allTabsVisible":o?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:G&&"allTabsVisible"===n,addViewButtonAnimatedIn:V||w||z,viewSelectState:n,moreViewsCount:t}}),[N,K,S,O,L,G,V,w,z,U]),q=(0,n.useCallback)((e=>{e&&b.current.observe(e)}),[b]),Y=(0,n.useMemo)((()=>{if(N&&"dropdown"!==$.viewSelectState)return!P.canConfigureBlock||null!=k&&k.disableAllPointerEvents?N.map(((e,o)=>{const r=n.createRef();return 0===o&&H?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{ref:r,style:{boxShadow:xS().p.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,D.jsx)(th,{collectionContextStore:t,collectionViewStore:e,onViewClick:a,disabled:c,hideUnderline:l,variant:p},e.id)}),(0,D.jsx)(B().dM,{origin:r})]}):(0,D.jsx)(th,{collectionContextStore:t,collectionViewStore:e,onViewClick:a,disabled:c,hideUnderline:l,variant:p},e.id)})):(0,D.jsx)(da().Ay,{direction:"horizontal",keys:N.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:(e,o)=>{const r=N.find((t=>t.id===e));if(r){const e=n.createRef();return 0===o&&H?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{ref:e,style:{boxShadow:xS().p.outlineBlueInputBoxShadow.light,borderRadius:6},children:(0,D.jsx)(th,{collectionContextStore:t,collectionViewStore:r,onViewClick:a,disabled:c,hideUnderline:l,variant:p},r.id)}),(0,D.jsx)(B().dM,{origin:e})]}):(0,D.jsx)(th,{collectionContextStore:t,collectionViewStore:r,onViewClick:a,disabled:c,hideUnderline:l,variant:p})}},onDrop:e=>function(e,t,o){const n=o.collectionViewBlockStore();if(!n)return;j().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,canUndo:!0,perform:t=>{kS({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}(e,m,t)})}),[N,$.viewSelectState,P.canConfigureBlock,t,a,c,k,l,m,H,p]),X=(0,n.useCallback)((e=>{const n=t.collectionViewStore();if(null!=n&&n.isDefined()){if("dropdown"===$.viewSelectState){var r;const i=n.getType(),l=n.getFormat().collection_view_icon,s=c||F,a="page"===n.getType()&&(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===at().pW;return(0,D.jsxs)(D.Fragment,{children:[!g.isMobile&&a&&"home"===Au().WH()&&(0,D.jsx)(bS,{origin:y}),(0,D.jsx)(oh,{collectionViewStore:n,render:r=>(0,D.jsxs)(ur().p,{ref:y,style:{display:"flex",alignItems:"center",height:32,fontSize:s?Ro().J.UISmall.desktop:14,fontWeight:s?Ro().Wy.regular:Ro().Wy.medium,color:s?h.text.secondary:h.text.primary,maxWidth:"form_editor"===i&&g.isMobile?I:ih,..."pills"===p?{background:"rgba(55, 53, 47, 0.06)",borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px 6px 10px",whiteSpace:"nowrap"}:{}},hovered:"pills"===p||void 0,size:"pills"===p?"lg":"md",disabled:c,...(0,Hi().A)(e,r),children:[(0,D.jsx)(AS().h,{color:s?"lightGray":"regular",viewType:i,viewIcon:l,style:{marginLeft:s&&"pills"!==p||"pills"===p?0:5,marginRight:6},size:s?Io().Ev.sm:void 0}),(0,D.jsx)("span",{style:{...Ro().RC,marginRight:6},children:(0,D.jsx)(rh,{collectionContextStore:t,collectionViewStore:n})}),c?null:(0,o(324254).arrowChevronSingleDownSmallIcon)({width:Io().Ev.sm,height:Io().Ev.sm,fill:h.lightIconColor})]})})]})}return"someTabsNotVisible"===$.viewSelectState?(0,D.jsx)(ur().p,{style:{display:"flex",alignItems:"center",height:32,fontSize:Ro().J.UIRegular.desktop,color:h.text.secondary,..."pills"===p?{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px 6px 10px",whiteSpace:"nowrap"}:{}},size:"pills"===p?"lg":"md",...e,children:(0,D.jsx)("span",{children:(0,D.jsx)(pt().sA,{defaultMessage:"{moreViewsCount} moreâ€¦",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:$.moreViewsCount}})})}):void 0}}),[I,t,g.isMobile,c,F,$.moreViewsCount,$.viewSelectState,h.lightIconColor,h.text.secondary,h.text.primary,p]),Q=(0,n.useCallback)((e=>{var n;const{device:r}=m,i=(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===at().pW;return(0,D.jsxs)(D.Fragment,{children:[!r.isMobile&&"views"===Au().WH()&&i&&(0,D.jsx)(CS,{origin:v}),(0,D.jsx)("div",{ref:v,children:(0,D.jsx)(US,{collectionContextStore:t,onClose:e.close,onViewClick:a,onAddViewClick:e=>function(e,t,n){j().createAndCommit({userAction:e,environment:t,canUndo:!0,perform:e=>{(0,o(423938).Z)({environment:t,collectionContextStore:n,newViewType:"table",transaction:e})}}),(0,o(154017).b)({environment:t,collectionContextStore:n,view_type:"table",from:"addButton"})}(e,m,t)})})]})}),[t,m,a]),Z=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]);return(0,D.jsx)(Ze().lC,{collectionContextStore:t,step:"views",containerRef:A,children:(0,D.jsx)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",...f?{marginLeft:-4,marginTop:-3}:{},flexGrow:10,overflow:"hidden",...z?{paddingLeft:2}:{}},ref:q,children:(0,D.jsxs)("div",{ref:A,style:{display:"flex",alignItems:"center",flexShrink:1,height:"100%"},children:[Y,$.showMoreViewsButton&&(0,D.jsx)("div",{onMouseDown:Z,children:(0,D.jsx)(qi().Ay,{alignmentToOrigin:pS().C1.Start,originGap:4,popupType:S?ja().nl.SlideUp:ja().nl.Popup,render:e=>Q(e),renderOrigin:X,onClick:()=>function(e,t){(0,x().X)({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(m,t)})}),(0,D.jsx)(hS,{renderState:$,collectionContextStore:t,preventRectangularSelection:Z,variant:p})]})})})}));function ah(e,t,o,n){return"collectionSettings"!==e.contextType&&(!(n||t||null!=o&&o.disableAllPointerEvents)&&(!!e.permissionScopesStore.state.canConfigureBlock&&!e.isMultiSourceView))}var ch=()=>o(10323),dh=()=>o(21140);const uh=n.memo((function(e){const{collectionContextStore:t}=e,o=(0,d().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isParentCollectionDead:r}=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:n}}),[t]);return n&&(!o&&r)?(0,D.jsx)(ph,{parentBlockStore:n}):null})),ph=n.memo((function(e){let{parentBlockStore:t}=e;const r=(0,s().v3)(),{isMobile:i}=(0,s().Y0)(),l=i?dh().wt:dh().Ye,a=(0,u().IS)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:Ro().Wy.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),c=(0,n.useCallback)((()=>{(0,xe().vd)(r,"view_deleted_database_from_deleted_collection_view_banner"),o(867201).Y({environment:r,store:t,pageVisitSource:To().y8.LinkInPage})}),[r,t]);return(0,D.jsxs)(l,{style:a.layoutComponent,alignItems:"center",justifyContent:i?"":"space-between",children:[(0,D.jsxs)(dh().Ye,{alignItems:"center",children:[(0,ut().I)(a.trashIcon),(0,D.jsx)(pt().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,D.jsxs)(ur().p,{style:a.viewCollectionButton,onClick:c,isLightGray:!0,children:[(0,D.jsx)(pt().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,Cd().B)(a.arrowIcon)]})]})}));var mh=()=>o(650829),gh=()=>o(726483),Sh=()=>o(559378),hh=()=>o(99042);function fh(){const e=(0,te().Ks)(),t=(0,d().K8)((()=>Boolean(null==e?void 0:e.shouldShowSpinnerStore.state)),[null==e?void 0:e.shouldShowSpinnerStore]);return(0,Jr().A)(t,500,100)?(0,D.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,D.jsx)(pr().A,{style:{width:14,height:14}})}):null}const yh=n.memo(fh);var vh=()=>o(344417);var xh=()=>o(623580);const bh=(0,pt().YK)({searchLabel:{id:"database.searchButton.tooltip",defaultMessage:"Search"},searchInputPlaceholder:{id:"database.searchInputPlaceholder",defaultMessage:"Type to search..."}}),Ch=n.memo((function(e){const{collectionContextStore:t,isFullScreen:o,currentViewType:r,topbarIconButtonStyle:i}=e,l=(0,s().v3)(),a=(0,d().K8)((()=>0===t.collectionStoresStore.state.length),[t]),c=(0,d().O$)(t.searchOpenStore),p=(0,d().O$)(t.searchQueryStore),m=(0,u().IS)((e=>({iconButton:{width:Io().Ev.sm,height:Io().Ev.sm,fill:e.mediumIconColor},input:{fontSize:14,lineHeight:1,paddingRight:4,color:e.text.primary,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),g=(0,n.useCallback)((()=>{ce().default.reset(),de().default.reset(),Gd().A.reset()}),[]),S=(0,n.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),h=(0,n.useCallback)((()=>{t.searchQueryStore.state||S()}),[t,S]),f=(0,n.useCallback)((e=>{27===e.keyCode&&S()}),[S]),y=(0,n.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),(0,x().X)({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]),v=(0,n.useCallback)((e=>{(0,er().S)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(o)}),function(e,t){xe().vd(e,"collection_search",t)}(l,{view_type:r})}),[t,r,l,o]),b=(0,fr().Y)(v,250),C=(0,n.useCallback)((()=>vt().A.formatMessage(bh.searchLabel)),[]),w=(0,n.useCallback)((e=>(0,D.jsx)("div",{...e,style:m.ignoreArea,children:(0,D.jsx)(xh().A,{style:m.input,right:(0,D.jsx)(mh().LazyAssistantCollectionSearchInputButton,{collectionContextStore:t}),format:xh().C.Transparent,value:p,onChange:b,placeholder:vt().A.formatMessage(bh.searchInputPlaceholder),focusInitial:c,showClearButton:!0,onFocus:g,onBlur:h,onCancel:S,onClick:Te().kV,onClearButtonClick:S,onKeyDown:f})})),[t,S,h,g,f,b,c,p,m.ignoreArea,m.input]),k=(0,n.useCallback)((e=>(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(It().A,{...e,icon:vh().u,iconStyle:m.iconButton,style:i,disabled:a,onClick:y,ariaLabel:vt().A.formatMessage(bh.searchLabel)}),(0,D.jsx)(kt().A,{visible:c,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,D.jsx)(it().A,{capture:c,allowEsc:!0,render:w})})]})),[a,y,w,c,m.iconButton,i]);return(0,D.jsx)(jt().A,{renderTooltip:C,render:k})}),No().A),wh={viewBox:"0 0 16 16",svg:(0,D.jsx)("path",{d:"M9.332 1.38a.575.575 0 0 0-.662.204l-4.936 6.84a.575.575 0 0 0 .466.911h2.398l-.315 4.32a.575.575 0 0 0 1.039.378l4.944-6.832a.575.575 0 0 0-.466-.912H9.401l.309-4.328a.575.575 0 0 0-.378-.582M7.216 8.185H5.324l3.095-4.289-.209 2.927a.575.575 0 0 0 .574.616h1.89l-3.097 4.28.212-2.917a.575.575 0 0 0-.573-.617"})},kh=(0,Io().wt)("lightningSmall",wh);var Ah=()=>o(940371),Ih=()=>o(766558);function jh(){const e=(0,s().v3)(),t=(0,te().ET)(),o=(0,d().K8)((()=>t.settingsStore.state.open&&gh()._T({tab:(0,Ah().S)(t.settingsStore)})),[t]),r=(0,d().O$)(t.isInHomeWidgetStore),i=(0,d().K8)((()=>t.aliveAutomationCountStore.state>0),[t]),l=(0,d().K8)((()=>t.collectionViewBlockStore()),[t]),a=(0,d().K8)((()=>{var e;return null===(e=xt().default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead()}),[]),c=(0,d().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore();return null==o?void 0:o.pathIsDead()}),[t]),p=(0,d().K8)((()=>null==l?void 0:l.isLocked()),[l]),{disabled:m,tooltipCopy:g,ariaLabel:S}=function(e){let{hasAutomations:t,isPageInTrash:o,isParentCollectionInTrash:r}=e;const i=!(0,d().O$)(He().e),l=(0,n.useMemo)((()=>(r||o)&&!t),[t,o,r]);if(i&&!t)return{disabled:!0,tooltipCopy:vt().A.formatMessage(Rh.disableAutomationsSettingsButtonOfflineTooltip),ariaLabel:vt().A.formatMessage(Rh.disableAutomationsSettingsButtonOfflineAriaLabel)};if(l)return{disabled:!0,tooltipCopy:vt().A.formatMessage(Rh.disableAutomationsSettingsButtonTrashTooltip),ariaLabel:vt().A.formatMessage(Rh.disableAutomationsSettingsButtonTrashAriaLabel)};return{disabled:!1,tooltipCopy:vt().A.formatMessage(Rh.openAutomationsSettingsButtonTooltip),ariaLabel:vt().A.formatMessage(Rh.openAutomationsSettingsButtonAriaLabel)}}({hasAutomations:i,isPageInTrash:a,isParentCollectionInTrash:c}),h=(0,u().IS)((e=>({buttonStyle:(0,Ih().j)({theme:e,isInHomeWidget:r}),iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:i?e.icon.uiBluePrimary:e.mediumIconColor}})),[i,r]),f=(0,d().K8)((()=>gh().rc({collectionStore:t.collectionStore()})),[t]),y=(0,n.useCallback)((o=>{(0,Te().SQ)({event:o,context:Te().y$.CollectionAutomationSettingsClick,callback:()=>{const o=t.settingsStore,n=o.state.open,r=(0,Ah().S)(o);n&&"automationSettings"===(null==r?void 0:r.type)?b().os({collectionSettingsStore:o}):i||p||a||c||!f?(b().Ow({collectionContextStore:t,collectionSettingsStore:o}),b().R8({collectionSettingsStore:o,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}})):b().js({environment:e,collectionSettingsStore:o,collectionContextStore:t})}})}),[e,t,i,p,a,c,f]);return(0,D.jsx)(jt().A,{renderTooltip:()=>g,render:e=>(0,D.jsx)(It().A,{ariaLabel:S,className:we().Jnf,icon:kh,style:h.buttonStyle,iconStyle:h.iconStyle,hovered:o,onClick:y,disabled:m,...e})})}const Rh=(0,pt().YK)({openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTrashTooltip:{defaultMessage:"Canâ€™t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.tooltip"},disableAutomationsSettingsButtonTrashAriaLabel:{defaultMessage:"Canâ€™t add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.trash.ariaLabel"},disableAutomationsSettingsButtonOfflineTooltip:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.tooltip"},disableAutomationsSettingsButtonOfflineAriaLabel:{defaultMessage:"Unavailable while offline",id:"database.collectionViewBlock.disableAutomationsSettingsButton.offline.ariaLabel"}}),Th=n.memo(jh);var Mh=()=>o(59400);const _h=(0,pt().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),Ph=n.memo((function(e){const{createFilterSettingsStore:t}=e,r=(0,s().v3)(),{isMobile:i,isPhone:l}=(0,s().Y0)(),a=(0,te().ET)(),c=(0,d().K8)((()=>t.state.open),[t]),p=(0,d().O$)(a.isInHomeWidgetStore),m=(0,d().K8)((()=>(0,Bo().N1)({collectionContextStore:a,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0),[a]),g=(0,d().K8)((()=>(0,Bo().I6)(a)),[a]),S=vt().A.formatMessage(_h.filterLabel),h=(0,n.useCallback)((()=>{var e;const n=null===(e=a.collectionViewStore())||void 0===e?void 0:e.id,i=a.isEphemeralView(),s=(0,o(37489).H)(a)?a.currentCombinatorFilterStore.state:void 0,c=a.currentPropertyFiltersStore.state,d=a.filtersBarOpenStore.state;n&&!l&&((0,tu().E)({userId:r.currentUser.id,collectionViewId:n,isOpen:!d}),a.filtersBarOpenStore.setState(d)),p||i?d||c.length>0||s?b().R8({collectionSettingsStore:a.settingsStore,item:{type:"filters"}}):(b().R8({collectionSettingsStore:a.settingsStore,item:{type:"createFilter"}}),hl().Ms(a)):d||c.length>0||s?a.filtersBarOpenStore.setState(!d):(b().R8({collectionSettingsStore:t,item:{type:"createFilter"}}),hl().Ms(a)),(0,x().X)({environment:r,collectionContextStore:a,action:"click_topbar_filter"})}),[a,t,r,p,l]),f=(0,n.useCallback)((()=>{b().os({collectionSettingsStore:t})}),[t]),y=(0,u().IS)((e=>({buttonStyle:(0,Ih().j)({theme:e,isInHomeWidget:p}),iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:m?e.icon.uiBluePrimary:e.mediumIconColor},tempFilterIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}})),[p,m]),v=(0,n.useCallback)((()=>S),[S]),C=(0,n.useCallback)((()=>(0,D.jsx)(Mh().m$,{context:Ae().Bd.TopbarFilterPopup,collectionContextStore:a,collectionSettingsStore:t,hideDesktopHeader:!0})),[a,t]);return(0,D.jsx)(ja().Ay,{trapFocus:!0,popupType:i?qi().z7.SlideUp:qi().z7.Popup,open:c,placementToOrigin:cS().UV.Bottom,alignmentToOrigin:cS().MY.Start,origin:(0,D.jsx)(jt().A,{renderTooltip:v,render:e=>(0,D.jsxs)("div",{style:y.iconContainer,children:[(0,D.jsx)(It().A,{...e,ariaLabel:S,icon:eu().$,iconStyle:y.iconStyle,style:y.buttonStyle,onClick:h}),g&&(0,D.jsx)("div",{style:y.tempFilterIndicator})]})}),onDismiss:f,originGap:4,render:C})})),Bh={viewBox:"0 0 16 16",svg:(0,D.jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},Vh=(0,Io().wt)("bellSmall",Bh),Fh=(0,pt().YK)({followLabel:{defaultMessage:"Follow",id:"collectionViewBlock.action.follow.title"}});function Lh(e){let{createFollowSettingsStore:t}=e;const{isMobile:o}=(0,s().Y0)(),r=(0,te().ET)(),i=(0,u().IS)((e=>({buttonStyle:(0,Ih().j)({theme:e,isInHomeWidget:!1}),iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:e.mediumIconColor},iconContainer:{position:"relative"}})),[]),l=(0,n.useMemo)((()=>vt().A.formatMessage(Fh.followLabel)),[]),a=(0,d().K8)((()=>t.state.open),[t]),c=(0,n.useCallback)((()=>{b().R8({collectionSettingsStore:t,item:{type:"follow"}})}),[t]),p=(0,n.useCallback)((()=>{b().os({collectionSettingsStore:t})}),[t]),m=(0,n.useCallback)((()=>l),[l]),g=(0,n.useCallback)((()=>(0,D.jsx)(Mh().m$,{context:Ae().Bd.TopbarFollowPopup,collectionContextStore:r,collectionSettingsStore:t,hideDesktopHeader:!0})),[r,t]);return(0,D.jsx)(ja().Ay,{trapFocus:!0,popupType:o?qi().z7.BottomSheet:qi().z7.Popup,open:a,placementToOrigin:cS().UV.Bottom,alignmentToOrigin:cS().MY.Start,origin:(0,D.jsx)(jt().A,{renderTooltip:m,render:e=>(0,D.jsx)("div",{style:i.iconContainer,children:(0,D.jsx)(It().A,{...e,ariaLabel:l,icon:Vh,iconStyle:i.iconStyle,style:i.buttonStyle,onClick:c})})}),onDismiss:p,originGap:4,render:g})}const Eh=(0,pt().YK)({openFullscreenPageButtonTooltip:{id:"database.collectionViewBlock.openFullscreenPageButton.tooltip",defaultMessage:"Open as full page"}});function Oh(e){let{store:t,viewType:r}=e;const i=(0,s().v3)(),l=(0,te().ET)(),a=(0,d().K8)((()=>(0,Ar().Ay)({store:t,fullyQualified:!1,pageVisitSource:To().y8.Expand,demoSettingsStore:Sh().A})),[t]),c=(0,u().DP)(),p=(0,d().K8)((()=>{const e=l.isInHomeWidgetStore.state;return(0,Ih().j)({theme:c,isInHomeWidget:e})}),[l,c]),m=(0,n.useCallback)((()=>function(e,t){xe().vd(e,"open_collection_as_page",t)}(i,{view_type:r})),[i,r]),g=vt().A.formatMessage(Eh.openFullscreenPageButtonTooltip);return(0,D.jsx)(jt().A,{renderTooltip:()=>g,render:e=>(0,D.jsx)(It().A,{ariaLabel:g,href:a,onClick:m,icon:o(662984).arrowExpandDiagonalBottomLeftToTopRightSmallIcon,style:p,iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm},...e})})}const Dh=n.memo(Oh);var zh=()=>o(787626);var Kh=()=>o(415651);class Hh extends p().default{getInitialState(){return{query:"",limit:20}}}const Wh=Hh;var Gh=()=>o(958378);const Nh=(0,pt().YK)({searchPlaceholder:{defaultMessage:"Search for a pageâ€¦",id:"collectionNoDateMenu.searchPlaceholder"}}),Uh=p().default.createClass(void 0,{name:"ResultStore"});function $h(e){let{collectionViewBlockStore:t,collectionViewType:r,property:i,collectionContextStore:l,onClose:a,onAddPage:c}=e;const u=(0,s().v3)(),p=(0,s().Y0)(),m=(0,d().uB)(void 0,Wh),g=(0,d().uB)(void 0,Uh),S=(0,d().K8)((()=>m.state.query),[m]),h=(0,d().O$)(g),f=(0,d().K8)((()=>{const{query:e,limit:t}=m.state;return{type:"results",filter:{operator:"and",filters:[{property:i,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[i,m]),y=(0,n.useCallback)((e=>{m.setState({query:e.target.value,limit:Xh})}),[m]),v=(0,n.useCallback)((e=>{const t=m.state.limit,o=l.isLoadingStore.state;e<Yh&&h&&h.hasMore&&!o&&m.setState({...m.state,limit:t+Xh})}),[l,h,m]),x=(0,n.useCallback)((()=>{let e;return e="calendar"===r?p.isMobile?(0,D.jsx)(pt().sA,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,D.jsx)(pt().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,D.jsx)(pt().sA,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),h?h&&0===h.blockIds.length?(0,D.jsx)(Pi().A,{title:e,children:(0,D.jsx)(Ia().A,{title:(0,D.jsx)(pt().sA,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,D.jsx)(Mi().Ay,{type:Mi().Oh.Vertical,sections:[{key:"results",render:t=>(0,D.jsx)(Pi().A,{...t,title:e}),items:Jh(h.blockIds,l,t,i,c,u,r)}],initialFocus:S?0:void 0}):(0,D.jsx)(Pi().A,{children:(0,D.jsx)(Zh,{})})}),[t,r,h,l,i,c,u,S,p.isMobile]);return(0,D.jsxs)(o(170356).Pq,{title:void 0,onCancel:a,desktopWidth:320,children:[(0,D.jsx)(Pi().A,{isInput:!0,children:(0,D.jsx)(Aa().Ay,{placeholder:vt().A.formatMessage(Nh.searchPlaceholder),focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:S,onChange:y})}),(0,D.jsx)(bn().A,{id:"no_date_results",reducer:f,collectionContextStore:l,render:x,resultStore:g}),(0,D.jsx)(Xn().A,{onChange:v})]})}const qh=n.memo($h,No().A),Yh=200,Xh=20;function Qh(e){let{props:t,store:o,disabled:r,url:i,collectionViewType:l}=e;const a=(0,s().v3)(),c=(0,s().Y0)(),d=n.useRef(null),u=(0,D.jsx)(Gh().A,{...t,ref:d,store:o,hidePath:!0,disabled:r,right:void 0!==i?(0,D.jsx)(ur().p,{size:"sm",href:i,disabled:r,onClick:()=>{!function(e){xe().vd(e,"collection_no_date_menu_view")}(a)},children:(0,D.jsx)(pt().sA,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==l||c.isMobile?u:(0,D.jsx)(lt().A,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[Kh().up(e.current)]}return[]}(d),analyticsName:"calendar_no_date_item",children:u})}function Zh(){return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(eo().A,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,D.jsx)(eo().A,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Jh(e,t,o,n,r,i,l){const s=e.map((e=>ae().Bv.createChildStore(o,{table:K().ev,id:e}))).filter((e=>!(0,zh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=xt().default.state;if(!o)return;const n=(0,_().wy)({environment:i,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),s={key:e.id,render:t=>(0,D.jsx)(Qh,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:l}),action:()=>{e.canEdit()&&(r(e),function(e){xe().vd(e,"collection_no_date_menu_add")}(i))}};return s}));return y().oE(s)}function ef(e){let{noDateTotal:t,noDateProperty:o,collectionViewType:r,timelineViewRef:i}=e;const l=(0,s().v3)(),{isMobile:a}=(0,s().Y0)(),c=(0,te().ET)(),p=(0,d().K8)((()=>c.collectionViewBlockStore()),[c]),m=(0,n.useCallback)((()=>{(0,x().X)({environment:l,collectionContextStore:c,action:"click_topbar_no_date"})}),[c,l]),g=(0,u().IS)((e=>({buttonStyle:(0,Ih().y)({theme:e})})),[]),S=(0,n.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),o=null==i?void 0:i.current;if(!t)return;const{performResult:n}=j().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:l,canUndo:!0,perform:n=>"calendar"===r?(0,mc().$N)({environment:l,store:e,collectionStore:t,collectionContextStore:c,startDayOfWeek:Ce().XX.state,transaction:n}):o?o.addBlockToView({store:e,transaction:n}):void 0});n&&A().td({environment:l,stores:[n]})}),[c,r,l,i]),h=(0,n.useCallback)((e=>p?(0,D.jsx)(qh,{collectionViewBlockStore:p,property:o,onClose:e.close,onAddPage:S,collectionViewType:r,collectionContextStore:c}):null),[c,p,r,o,S]);return(0,D.jsx)(qi().Ay,{popupType:a?Nu().n.SlideUp:Nu().n.Popup,placementToOrigin:qi().sx.Bottom,alignmentToOrigin:qi().yP.Start,originGap:4,render:h,onClick:m,renderOrigin:e=>(0,D.jsx)(ur().p,{isGray:!0,style:g.buttonStyle,...e,children:(0,D.jsx)(pt().sA,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:t>=Di().iY?Di().iY-1+"+":t}})})})}const tf=n.memo(ef),of={viewBox:"0 0 20 20",svg:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("path",{d:"M10.375 6.775c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,D.jsx)("path",{d:"M4.066 8.914a6.477 6.477 0 0 1 12.859 1.029 3.494 3.494 0 0 1-1.725 6.532H5.121a3.855 3.855 0 0 1-1.056-7.56m6.384-4.14a5.226 5.226 0 0 0-5.2 4.716l-.047.482-.48.075a2.605 2.605 0 0 0 .406 5.178H15.2a2.244 2.244 0 0 0 .853-4.32l-.41-.169.024-.443q.008-.146.008-.293a5.225 5.225 0 0 0-5.225-5.225"})]})},nf=(0,Io().wt)("cloudExclamation",of);var rf=()=>o(670631);const lf=(0,pt().YK)({offlineLabelOneView:{defaultMessage:"The top {numPages} pages are available offline",id:"collectionViewBlock.offlineIndicator.labelOneView"},offlineLabelMultipleViews:{defaultMessage:"The top {numPages} pages in the first view are available offline",id:"collectionViewBlock.offlineIndicator.labelMultipleViews"},lastSyncedOn:{defaultMessage:"Last synced on {date}",id:"collectionViewBlock.offlineIndicator.lastSyncedOn"}});function sf(){const e=(0,te().ET)(),t=(0,d().O$)(e.isInHomeWidgetStore),o=(0,u().IS)((e=>({iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm},iconContainer:{position:"relative",...(0,Ih().j)({theme:e,isInHomeWidget:t})},secondaryText:{color:e.text.secondary}})),[t]),r=(0,d().K8)((()=>{var t;return null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.id}),[e]),i=(0,d().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewIds().length)??0}),[e]),l=(0,d().K8)((()=>Fo().default.getConfigKey("offline_query_collection_settings","limit")),[]),s=(0,d().K8)((()=>{var e;return void 0!==r&&"success"===(null===(e=rf().A.state.offlinePages)||void 0===e||null===(e=e[r])||void 0===e?void 0:e.downloadStatus)}),[r]),a=(0,d().K8)((()=>{var e;return s&&void 0!==r?null===(e=rf().A.state.offlinePages)||void 0===e||null===(e=e[r])||void 0===e?void 0:e.lastDownloadedAt:void 0}),[r,s]),c=a?vt().A.formatMessage(lf.lastSyncedOn,{date:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(a)}):void 0,p=vt().A.formatMessage(1===i?lf.offlineLabelOneView:lf.offlineLabelMultipleViews,{numPages:l}),m=(0,n.useCallback)((()=>(0,D.jsxs)("div",{style:{width:200},children:[(0,D.jsx)("div",{children:p}),c&&(0,D.jsx)("div",{style:o.secondaryText,children:c})]})),[p,c,o.secondaryText]);return a?(0,D.jsx)(jt().A,{renderTooltip:m,render:e=>(0,D.jsx)("div",{style:o.iconContainer,...e,children:nf(o.iconStyle)}),textWrap:!0}):null}const af=n.memo(sf);const cf={CollectionViewAddItemButtonTooltip:new(se().O2)("CollectionViewAddItemButtonTooltip",(async()=>o.e(43965).then(o.bind(o,290334))))},df=(0,se()._h)(cf.CollectionViewAddItemButtonTooltip,(e=>e.CollectionViewAddItemButtonTooltip)),uf=n.memo((function(e){let{store:t,settingsHeaderSizeObserver:r,handleAddItemClick:i,isTooltipVisible:l,collectionModel:a}=e;const c=(0,s().v3)(),{isMobile:p}=(0,s().Y0)(),m=(0,n.useRef)(null),g=(0,te().ET)(),S=(0,d().O$)(g.isFullScreenStore),h=(0,d().K8)((()=>g.isMultiSourceView),[g]),f=(0,d().K8)((()=>(0,_().h6)(g)),[g]),y=(0,d().K8)((()=>r.rect.state.width<=Ae().xO),[r]),v=(0,d().K8)((()=>{if(!g.isMultiSourceView)return;const e=g.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:Qt}),[g]),x=(0,E().X)("db_ux_chrome"),C=(0,d().K8)((()=>{if(x)return!!p||!S}),[S,p,y,x]),w=h,k=(0,u().IS)((()=>({buttonWrapper:{...x?{display:"flex",alignItems:"center",justifyContent:"center"}:{},position:"relative",marginLeft:C?4:6,display:"flex"},buttonStyle:{fontSize:14,height:28},mainButtonStyle:C?{width:28}:{},iconStyle:C?{width:15,marginRight:0}:{}})),[x,C]),A=(0,n.useCallback)((()=>{l&&((0,o(51367).Sq)(c,{callout_key:"collection_add_item_button_tooltip",dismiss_type:"tooltip_dismiss",placement_key:"Tooltip"}),(0,Yc().a)(c,"collection_add_item_button_tooltip"))}),[c,l]),I=(0,n.useCallback)((e=>{b().Ub({environment:c,handleAddItemClick:i,buttonRef:m,event:e})}),[c,i,m]),j=(0,n.useCallback)((e=>(0,D.jsx)(o(430102).A,{ref:m,title:C?null:f,icon:C?o(464699).b:void 0,color:"blue",onClick:e=>{h?I(e):i(e),A()},mainButtonTooltip:v===Qt?(0,D.jsx)(pt().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,D.jsx)("br",{})}}):C?f:null,onDropdownClick:e.onClick,style:k.buttonStyle,mainButtonStyle:k.mainButtonStyle,iconStyle:k.iconStyle,className:we().kel,disabled:Boolean(v),disableDropdown:w})),[f,w,A,i,h,v,I,C,k.buttonStyle,k.iconStyle,k.mainButtonStyle]),R=(0,n.useRef)(null),T=(0,n.useCallback)((e=>l?(0,D.jsx)(df,{collectionModel:a,onDismiss:A,children:j(e)}):(0,D.jsx)(Ze().lC,{collectionContextStore:g,containerRef:R,step:"new_page",children:j(e)})),[g,a,A,l,j]);return(0,D.jsx)(o(472765).m,{store:t,popupType:p?Nu().n.SlideUp:Nu().n.Popup,renderOrigin:e=>(0,D.jsx)("div",{style:k.buttonWrapper,ref:R,children:T(e)}),dismissTooltip:A,placementToOrigin:qi().sx.Bottom})})),pf={viewBox:"0 0 16 16",svg:(0,D.jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},mf=(0,Io().wt)("arrowUpDownSmall",pf),gf=(0,pt().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function Sf(e){let{createSortSettingsStore:t}=e;const o=(0,te().ET)(),{isMobile:r}=(0,s().Y0)(),i=(0,s().v3)(),l=(0,d().K8)((()=>t.state.open),[t]),a=(0,d().K8)((()=>o.currentSortsStore.state.length>0),[o]),c=(0,d().K8)((()=>(0,Bo().gv)(o)),[o]),p=(0,d().O$)(o.isInHomeWidgetStore),m=(0,n.useCallback)((()=>{const e=o.permissionScopesStore.state.canConfigureBlock?o.currentCombinatorFilterStore.state:void 0,n=o.currentPropertyFiltersStore.state,r=o.filtersBarOpenStore.state,l=a||r||n.length>0||e;p&&b().R8({collectionSettingsStore:o.settingsStore,item:{type:a?"sort":"createSort"}}),l?p||(o.filtersBarOpenStore.setState(!r),a?b().R8({collectionSettingsStore:o.filterBarSortSettingsStore,item:{type:"sort"}}):b().R8({collectionSettingsStore:t,item:{type:"createSort"}})):p||b().R8({collectionSettingsStore:t,item:{type:"createSort"}}),(0,x().X)({environment:i,collectionContextStore:o,action:"click_topbar_sort"})}),[o,t,i,a,p]),g=(0,n.useCallback)((()=>{b().os({collectionSettingsStore:t})}),[t]),S=vt().A.formatMessage(gf.sortLabel),h=(0,u().IS)((e=>({iconStyle:{width:Io().Ev.sm,height:Io().Ev.sm,fill:a?e.icon.uiBluePrimary:e.mediumIconColor,transform:"rotate(180deg)"},buttonStyle:(0,Ih().j)({theme:e,isInHomeWidget:p}),tempSortIndicator:{position:"absolute",top:3,right:2,background:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[300],border:`1px solid ${e.contentBackground}`,width:9,height:9,borderRadius:9}})),[a,p]);return(0,D.jsx)(ja().Ay,{popupType:r?qi().z7.SlideUp:qi().z7.Popup,placementToOrigin:cS().UV.Bottom,alignmentToOrigin:cS().MY.Start,open:l,origin:(0,D.jsx)(jt().A,{renderTooltip:()=>S,render:e=>(0,D.jsxs)("div",{style:{position:"relative"},children:[(0,D.jsx)(It().A,{...e,ariaLabel:S,icon:mf,iconStyle:h.iconStyle,style:h.buttonStyle,onClick:m}),c&&(0,D.jsx)("div",{style:h.tempSortIndicator})]})}),onDismiss:g,originGap:4,render:()=>(0,D.jsx)(Mh().m$,{context:Ae().Bd.TopbarSortPopup,collectionContextStore:o,collectionSettingsStore:t,hideDesktopHeader:!0}),trapFocus:!0})}const hf=n.memo(Sf);function ff(){const e=(0,s().v3)(),t=(0,te().ET)(),r=(0,d().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,u().IS)((e=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:Ro().Wy.medium,color:e.text.secondary},searchIcon:{width:Io().Ev.sm,height:Io().Ev.sm,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,n.useCallback)((()=>{o(260488).su({environment:e,analyticsFrom:"wiki-home-collection-view"}),r&&o(250484).Ay.updateFilters({ancestors:[r]})}),[e,r]);return r?(0,D.jsxs)(ur().p,{style:i.button,onClick:l,children:[(0,vh().u)(i.searchIcon),(0,D.jsx)(pt().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const yf=n.memo(ff);const vf=(0,pt().YK)({feedbackButtonTooltip:{defaultMessage:"Share feedback on using Posts",id:"collectionViewBlock.action.postsFeedback.tooltip"}});function xf(e){const{theme:t,isInHomeWidget:r}=e,i=(0,s().v3)(),l=vt().A.formatMessage(vf.feedbackButtonTooltip),a=(0,n.useCallback)((()=>l),[l]);return(0,D.jsx)(jt().A,{renderTooltip:a,render:e=>(0,D.jsx)(ur().p,{...e,ariaLabel:l,icon:o(173019).r,isGray:!0,onClick:()=>{o(755636).f({environment:i,url:"https://notion.notion.site/1caefdeead058012a151c3f764a4135b"})},style:(0,Ih().j)({theme:t,isInHomeWidget:Boolean(r),isFeedbackButton:!0}),children:(0,D.jsx)(pt().sA,{defaultMessage:"Feedback",id:"TeamHome.feedback.label"})})})}const bf=new(se().O2)("MinimizableCollectionViewBlockHeaderActions",(async()=>await o.e(94516).then(o.bind(o,538900)))),Cf=(0,se()._h)(bf,(e=>e.MinimizableCollectionViewBlockHeaderActions)),wf=n.memo((function(e){const{allowedActions:t,collectionContextStore:r,createFilterSettingsStore:i,createSortSettingsStore:l,createFollowSettingsStore:a,currentViewType:c,handleAddItemClick:m,headerSizeObserver:g,isFullScreen:S,isInHomeWidget:h,isPlaceholderExternalCollection:f,minimizedActionViewStore:y,settingsHeaderSizeObserver:v,showHoverActionsStore:x,store:b,timelineViewRef:C,containerStyleOverrides:w}=e,k=(0,s().v3)(),{isPhone:A,isMobile:I,isMobileNative:j}=(0,s().Y0)(),R=(0,E().X)("db_ux_chrome"),T=(0,E().X)("db_ux_empty_states"),M=(0,E().X)("download_for_offline"),_=(0,d().K8)((()=>(0,o(578136).D)({isMobileNative:j})),[j]),P=(0,u().DP)(),V=(0,o(792485).S)(),F=(0,d().K8)((()=>r.collectionViewStore()),[r]),L=(0,d().K8)((()=>"view"===o(411671).A.getMode(k,b).permission),[k,b]),O=(0,d().K8)((()=>(0,bo().w6)(k)),[k]),z=(0,d().K8)((()=>({blockId:Sh().A.getCurrentStepBlockId(),subStep:Sh().A.getCurrentStepSubStep()??""})),[]),K=(0,d().K8)((()=>{const e=V&&V.publicEditModeStore.state.hasPublicPermission;return!(!Sh().A.isActiveDemo()||!e)&&(!I&&z.blockId===b.id)}),[z.blockId,I,V,b.id]),H=(0,d().O$)(r.wasCreatedThisSessionStore),W=(0,d().K8)((()=>{const e=r.resultSetStore.state;return((null==e?void 0:e.blockIds.size)??0)<3}),[r.resultSetStore]),G=(0,d().O$)(r.normalizedSchemaStore),[N,U]=(0,n.useState)(!1);(0,n.useEffect)((()=>{H&&W&&Object.keys(G).length<=1||U(!0)}),[N,H,W,G]);const $=(0,d().K8)((()=>(void 0!==r.collectionStore()||"collectionTypedView"===r.contextType)&&!f&&v.rect.state.width>=Ae().xO),[r,f,v]),q=(0,d().K8)((()=>!!K||x.state),[K,x]),Y=(0,d().K8)((()=>{const e=g.rect.state;return!I&&e.width>0&&e.width<400}),[I,g.rect]),{isUnlisted:X,isUnlistedFromSemanticQuery:Q}=(0,d().K8)((()=>{const e=null==F?void 0:F.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[F]),Z=(0,d().K8)((()=>{if(Y||S||A||X||!b.canEditCollection())return null;const e=v.rect.state.width<=Ae().xO;return(0,D.jsx)(o(99600).A,{store:b,isInlineCollection:!0,hideText:e,buttonStyle:{marginLeft:4}})}),[S,A,X,v.rect,Y,b]),J=(0,d().K8)((()=>{const e=v.rect.state.width<=Ae().xO;return(0,D.jsx)(B().GL,{store:b,collectionContextStore:r,v2:!0,hideText:e})}),[v.rect,b,r]),ee=(0,d().K8)((()=>{var e,o;if(!t||t.includes("noDate"))return"timeline"===c?null===(e=r.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by:"calendar"===c?null===(o=r.normalizedQueryStore.state)||void 0===o?void 0:o.calendar_by:void 0}),[t,r.normalizedQueryStore,c]),te=(0,d().uB)(void 0,p().default),oe=(0,d().K8)((()=>{if(ee)return{type:"aggregation",aggregation:{property:ee,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[ee]),ne=(0,d().K8)((()=>{if(oe){const e=te.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[oe,te]),re=(0,d().K8)((()=>{if(!ee||!ne||!$||Y||"calendar"!==c&&"timeline"!==c)return null;const e=r.permissionScopesStore.state,t=r.collectionStore();return"collectionTypedView"===r.contextType||t&&e.canEditContent?(0,D.jsx)(tf,{noDateTotal:ne,noDateProperty:ee,collectionViewType:c,timelineViewRef:C}):null}),[r,c,ee,ne,$,Y,C]),ie=(0,n.useMemo)((()=>T&&!N||!$||"page"===c||"form_editor"===c||t&&!t.includes("filter")?null:K&&"filter"===z.subStep?(0,D.jsx)(hh().F,{subStep:"filter",step:"demo_collection",children:(0,D.jsx)(Ph,{createFilterSettingsStore:i})}):(0,D.jsx)(Ph,{createFilterSettingsStore:i})),[T,N,$,c,t,K,z.subStep,i]),le=(0,d().K8)((()=>{if(T&&!N)return null;if(!$||"page"===c||"form_editor"===c||t&&!t.includes("sort"))return null;if("chart"===c){var e,o;const t=null===(e=r.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==t?void 0:t.type)||"results-advanced"!==(null==t||null===(o=t.chartFormat)||void 0===o?void 0:o.mainSort))return null}return K&&"sort"===z.subStep?(0,D.jsx)(hh().F,{subStep:"sort",step:"demo_collection",children:(0,D.jsx)(hf,{createSortSettingsStore:l})}):(0,D.jsx)(hf,{createSortSettingsStore:l})}),[T,N,$,c,t,K,z.subStep,l,r]),se=(0,d().K8)((()=>T&&!N||!$||"chart"===c||"page"===c||f||!(0,gh().aS)(r)||L||t&&!t.includes("automations")?null:K&&"automations"===z.subStep?(0,D.jsx)(hh().F,{subStep:"automations",step:"demo_collection",children:(0,D.jsx)(Th,{})}):(0,D.jsx)(Th,{})),[T,N,$,c,f,r,L,t,K,z.subStep]),ae=(0,d().K8)((()=>{return T&&!N||!$||"form_editor"===c||"chart"===c||Y||t&&!t.includes("search")||f?null:"page"===c?null!==(e=r.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,D.jsx)(yf,{}):null:(0,D.jsx)(Ch,{collectionContextStore:r,isFullScreen:Boolean(S),currentViewType:c,topbarIconButtonStyle:(0,Ih().j)({theme:P,isInHomeWidget:Boolean(h)})});var e}),[T,N,$,c,Y,t,f,r,S,P,h]),ce=(0,d().K8)((()=>{var e;return!$||t&&!t.includes("ai")||f||null!=r&&null!==(e=r.collectionStore())&&void 0!==e&&e.isSyncedCollection()?null:(0,D.jsx)(mh().LazyAssistantCollectionViewButton,{collectionContextStore:r})}),[r,f,$,t]),de=(0,n.useMemo)((()=>S||L||t&&!t.includes("fullScreen")?null:(0,D.jsx)(Dh,{store:b,viewType:c})),[S,b,c,t,L]),ue=(0,d().K8)((()=>L||t&&!t.includes("viewSettings")||f?null:K&&"settings"===z.subStep?(0,D.jsx)(hh().F,{subStep:"settings",step:"demo_collection",children:(0,D.jsx)(sS().XA,{collectionContextStore:r,settingsHeaderSizeObserver:v,style:(0,Ih().j)({theme:P,isInHomeWidget:Boolean(h)})})}):(0,D.jsx)("div",{style:{position:"relative"},children:(0,D.jsx)(sS().XA,{collectionContextStore:r,settingsHeaderSizeObserver:v,style:(0,Ih().j)({theme:P,isInHomeWidget:Boolean(h)})})})),[r,h,f,v,P,t,K,z,L]),pe=(0,d().K8)((()=>!O&&$&&null!=t&&t.includes("saveOrOpenOverflow")?(0,D.jsx)(sS().fV,{collectionContextStore:r,shouldHideSaveViewOption:Q}):null),[$,t,r,Q,O]),me=(0,d().K8)((()=>{var e;return"page"===c||"form_editor"===c||f||!r.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||t&&!t.includes("addItem")?null:(0,D.jsx)(uf,{store:b,settingsHeaderSizeObserver:v,handleAddItemClick:m,isTooltipVisible:!1,collectionModel:null===(e=r.collectionStore())||void 0===e?void 0:e.getModel()})}),[c,f,r,t,b,v,m]),ge=(0,d().K8)((()=>{var e;return(null===(e=b.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[b]),Se=(0,n.useMemo)((()=>"form_editor"!==c||t&&!t.includes("formActionButtons")||ge?null:(0,D.jsx)(o(171559).Pe,{showCompactDesktopHeader:Y,collectionContextStore:r})),[c,t,Y,r,ge]),he=(0,d().K8)((()=>null!=t&&t.includes("closeCollectionViewInModal")&&r.isUnlistedViewStore.state?(0,D.jsx)(sS().YL,{}):null),[t,r]),fe=(0,d().K8)((()=>{const e=r.collectionViewStore(),t=r.collectionStore();return!(!e||!t)&&t.getSpaceId()!==e.getSpaceId()}),[r]),ye=(0,d().K8)((()=>fe&&Fo().default.checkGate({gateName:"collections_xws"})),[fe]),ve=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),xe=(0,d().O$)(He().e),be=(0,n.useMemo)((()=>xe||!M?null:(0,D.jsx)(af,{})),[xe,M]),Ce=(0,n.useMemo)((()=>"feed"===c&&_?(0,D.jsx)(xf,{theme:P,isInHomeWidget:Boolean(h)}):null),[c,P,h,_]),we=(0,d().K8)((()=>r.databaseType),[r]),ke=(0,n.useMemo)((()=>T&&!N?null:$&&"feed"===c&&_?we?null:(0,D.jsx)(Lh,{createFollowSettingsStore:a}):null),[c,a,_,T,N,$,we]),Ie=(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(yh,{}),Ce,be,ye&&(0,D.jsx)($u,{type:"linkedView"}),Z,J,oe&&(0,D.jsx)(bn().A,{id:"no_date_count",collectionContextStore:r,reducer:oe,resultStore:te}),re,ke,ie,le,se,ce,ae,de,ue,pe,me,Se,he]}),je=(0,u().IS)((()=>({container:R?{height:"100%",flexGrow:1}:{}})),[R]);return A?(0,D.jsxs)(kt().A,{visible:q,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[(0,D.jsx)(yh,{}),be,ye&&(0,D.jsx)($u,{type:"linkedView"}),de,ue,me,Se,pe]}):(0,D.jsx)("div",{style:{...je.container,...w},children:R&&!I?(0,D.jsx)(Cf,{settingsHeaderSizeObserver:v,isFullScreen:S,collectionContextStore:r,viewSettingsButton:ue,minimizedActionViewStore:y,children:Ie}):(0,D.jsx)(kt().A,{visible:q,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},onMouseDown:ve,children:Ie})})}));var kf=function(e){return e[e.TabBar=0]="TabBar",e[e.Source=1]="Source",e[e.None=2]="None",e}(kf||{});function Af(e){const{currentViewType:t,store:o,isFullScreen:r,hideViewTabBar:i,collectionViewHeaderText:l,headerActionsBehavior:a,allowedActions:c,isInHomeWidget:m,isMyTasksPage:g,isHomeCustomDbPage:S,showHoverActionsStore:f,headerSizeObserver:y,isPlaceholderExternalCollection:v,handleEditorMouseDown:x,handleHeaderMouseMove:C,handleHeaderMouseLeave:w,handleHeaderMount:k,handleSettingsHeaderMount:A,leftRightPaddingStore:I,headerHeightStore:j,canEdit:R,contentSizeObserver:T,settingsHeaderSizeObserver:M,viewSettingsPlacementStore:P,showOnlyCurrentView:B,switchViewMetric:V,handleAddItemClick:F,timelineViewRef:L,createFilterSettingsStore:O,filterBarCreateFilterSettingsStore:K,headerWrapStyle:H,headerRef:W,headerStyleOverrides:G,minimizedActionViewStore:N,createFollowSettingsStore:U}=e,$=(0,E().X)("db_ux_chrome"),q=(0,s().v3)(),Y=(0,te().ET)(),X=(0,fe().Zp)(),Q=(0,d().K8)((()=>Y.collectionStore()),[Y]),Z=(0,d().uB)(void 0,p().default),J=(0,d().K8)((()=>{if(g){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[g]),ee=(0,d().uB)(void 0,p().default),oe=(0,d().K8)((()=>{if(S)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[S]),ne=(0,d().uB)(void 0,ze().A),re=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"}));(0,n.useEffect)((()=>{b().d9({environment:q,collectionContextStore:Y})}),[q,Y]);const ie=(0,d().K8)((()=>{const e=Y.viewIsFlushToTopbar();return("timeline"===t||"table"===t)&&e||m||Y.isUnlistedViewStore.state||$}),[Y,t,$,m]),le=(0,d().K8)((()=>I.state),[I]),se=(0,d().K8)((()=>j.state),[j]),ae=(0,d().K8)((()=>{var e;return null===(e=Y.viewsModuleContextStore)||void 0===e?void 0:e.isInLayoutBuilder()}),[Y.viewsModuleContextStore]),ce=(0,d().K8)((()=>o.isNonEditableState()),[o]),de=(0,d().K8)((()=>{var e;return $||"viewsMain"===(null===(e=Y.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())}),[Y.viewsModuleContextStore,$]),ue=Se({collectionContextStore:Y,previewContext:X,isPlaceholderExternalCollection:v}),pe=(0,n.useCallback)((e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:n}=e;if(t.id!==o.id&&!n){const e=t.getType(),n=o.getType();if(e&&n){var r;if(V)V.current={from:e,to:n,metric:Ve().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(r=Y.remoteResultStore.state)||void 0===r?void 0:r.sizeHint};"form_editor"===e&&Y.isClientModeEnabledStore.setState(!1),"form_editor"===n&&b().os({collectionSettingsStore:Y.settingsStore})}}}),[Y.isClientModeEnabledStore,Y.remoteResultStore,Y.settingsStore,V]),me=(0,d().K8)((()=>{var e;return(null===(e=Y.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[Y]),ge=(0,d().K8)((()=>ah(Y,v,X,B)),[Y,v,X,B]),he=(0,n.useMemo)((()=>({showMoreViewsButton:!1,showAddViewButton:ge,addViewButtonAnimatedIn:!0,viewSelectState:"allTabVisible",moreViewsCount:0})),[ge]),ye=(0,n.useCallback)((e=>{(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]),ve=(0,n.useMemo)((()=>(0,D.jsx)(hS,{renderState:he,collectionContextStore:Y,preventRectangularSelection:ye,variant:"default"})),[Y,ye,he]),xe=(0,n.useMemo)((()=>i?kf.None:$&&1===(null==me?void 0:me.length)&&!r&&ue?kf.Source:kf.TabBar),[i,$,me,ue,r]),be=(0,d().K8)((()=>Boolean(null==Q?void 0:Q.isSyncedCollection())),[Q]),Ce=(0,d().K8)((()=>be&&xe===kf.Source),[be,xe]),we=(0,u().IS)((e=>{let t;return t=ie?{}:ae?{boxShadow:`0 0.5px 0 ${e.stroke.uiBlueSecondary}`,marginBottom:.5}:{boxShadow:`0 1px 0 ${e.tableDividerColor}`,marginBottom:1},{headerPositioningStyle:{left:null==le?void 0:le.paddingLeft,paddingLeft:m?Ee().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:Ce?"flex-start":"center",...Ce?{}:{height:se},...t,left:null==le?void 0:le.paddingLeft,paddingLeft:m?Ee().Fq:void 0,width:"100%",...G},selectableStyle:{position:"relative"},headerActionsStyle:{...Ce&&{marginTop:6}}}}),[se,G,ie,m,ae,null==le?void 0:le.paddingLeft,Ce]),ke=(0,n.useMemo)((()=>{switch(xe){case kf.TabBar:return(0,D.jsx)(sh,{collectionContextStore:Y,showHoverActionsStore:f,isPlaceholderExternalCollection:v,showOnlyCurrentView:B??!1,onViewClick:pe,disabled:g,variant:de?"pills":"default"});case kf.Source:return(0,D.jsx)(z,{store:o,collectionContextStore:Y,isFullScreen:r,showHoverActionsStore:f,canEdit:R,addViewButton:ve});case kf.None:return null}}),[xe,ve,Y,f,v,B,pe,g,de,o,r,R]),Ae=(0,n.useMemo)((()=>"hidden"===a?null:(0,D.jsx)(wf,{showHoverActionsStore:f,isFullScreen:r,store:o,currentViewType:t,collectionContextStore:Y,isPlaceholderExternalCollection:v,settingsHeaderSizeObserver:M,createFilterSettingsStore:O,createSortSettingsStore:re,createFollowSettingsStore:U,isInHomeWidget:m,handleAddItemClick:F,headerSizeObserver:y,timelineViewRef:L,allowedActions:c,minimizedActionViewStore:N,containerStyleOverrides:we.headerActionsStyle})),[a,f,r,o,t,Y,v,M,O,re,U,m,F,y,L,c,N,we.headerActionsStyle]);return(0,D.jsxs)(rt().s,{allowSelectionWithin:!0,style:H,onMouseDown:x,onMouseMove:C,onMouseLeave:w,ref:(0,h().Px)(k,W),children:[r&&(0,D.jsx)(dS,{currentViewType:t,headerSizeObserver:y,contentSizeObserver:T,settingsHeaderSizeObserver:M,headerHeightStore:j,viewSettingsPlacementStore:P,store:o,leftRightPaddingStore:I,isInHomeWidget:m,headerRef:W}),le&&(0,D.jsxs)(lt().A,{store:o,shouldShowCopyLinkButton:ce,analyticsName:(0,_().LI)(t),style:we.selectableStyle,shouldShowHalo:!(r||m||null!=X&&X.isPreviewing),children:[(0,D.jsxs)("div",{style:we.headerStyle,ref:A,children:[ke,l,Ae]}),J&&(0,D.jsx)(bn().A,{id:"tasks_results",collectionContextStore:Y,reducer:J,resultStore:Z}),oe&&(0,D.jsx)(bn().A,{id:"custom_db_results",collectionContextStore:Y,reducer:oe,resultStore:ee})]}),(0,D.jsxs)("div",{style:we.headerPositioningStyle,dir:"ltr",children:[ue&&!$&&(0,D.jsx)(z,{store:o,collectionContextStore:Y,isFullScreen:r,showHoverActionsStore:f,canEdit:R}),(0,D.jsx)(uh,{collectionContextStore:Y}),(0,D.jsx)(If,{collectionContextStore:Y,showHoverActionsStore:f,filterBarCreateFilterSettingsStore:K,saveControlMoreActionsButtonPopupStore:ne,currentViewType:t,isInHomeWidget:m})]})]})}function If(e){let{collectionContextStore:t,showHoverActionsStore:o,filterBarCreateFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r,currentViewType:i,isInHomeWidget:l}=e;const a=(0,s().v3)(),c=(0,s().WS)(),u=(0,d().K8)((()=>(0,bo().J9)(a)),[a]),p=(0,d().O$)(t.filtersBarOpenStore),m=(0,d().O$)(t.shouldShowSourceStore),g=(0,d().O$)(t.completeSprintButtonContextStore),S=m?8:12;return"page"===i||"form_editor"===i||"feed"===i&&(u||c)||l?null:p?(0,D.jsx)(vS().N9,{collectionContextStore:t,showHoverActionsStore:o,createFilterSettingsStore:n,saveControlMoreActionsButtonPopupStore:r}):g?(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:c?12:8,paddingTop:S},children:[(0,D.jsx)("div",{style:{flex:1}}),(0,D.jsx)(ch().A,{collectionContextStore:t})]}):null}var jf=()=>o(624919),Rf=()=>o(99895);const Tf={formula:{initialResult:"collections_formula_initial_result_duration",mountToFirstResult:"collections_formula_mount_to_first_result"},relation:{initialResult:"collections_relation_initial_result_duration",mountToFirstResult:"collections_relation_mount_to_first_result"},rollup:{initialResult:"collections_rollup_initial_result_duration",mountToFirstResult:"collections_rollup_mount_to_first_result"}};function Mf(){return{formula:(0,E().X)("formulas_enable_clientside_metrics"),relation:(0,E().X)("relation_enable_clientside_metrics"),rollup:(0,E().X)("rollup_enable_clientside_metrics")}}const _f=Symbol("DONE_WITH_INITIAL_RENDER");function Pf(e){const{collectionContextStore:t}=e,o=function(e){const{collectionContextStore:t,mountedBeforeInitialPageRender:o}=e,r=(0,s().v3)(),i=(0,n.useRef)(new(Rf().G)((()=>({done:!1,didTrackFirstResult:!1,pageIdToStatus:new Map})))),a=Mf();return{trackMount:(0,n.useCallback)((e=>{let{pageId:t,propertyId:o,propertyType:n}=e;if(!a[n])return;const r=i.current;if(r===_f)return;const l=r.get(o);if(l.done)return;const s=performance.now();l.pageIdToStatus.has(t)||l.pageIdToStatus.set(t,{mountTime:s,gotFirstResult:!1}),(0,v().O9)(l.earliestMountTime)||(l.earliestMountTime=s)}),[a]),trackResult:(0,n.useCallback)((e=>{let{pageId:n,propertyId:s,propertyType:c,endTime:d,context:u}=e;if(!a[c])return;const p=i.current;if(p===_f)return;const m=p.get(s);if(m.done)return;const{initialResult:g,mountToFirstResult:S}=Tf[c],h=m.pageIdToStatus.get(n);if(!h)return void(0,jf().NK)(`Property result duration performance entry for ${n}/${s} not found`);const f=y().Bj((()=>({...(0,ke().kz)(t),is_navigation:!o,...u})));m.didTrackFirstResult||(m.didTrackFirstResult=!0,(0,v().O9)(m.earliestMountTime)?Ve().default.measure({metricName:S,startTime:m.earliestMountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:f()}):(0,jf().NK)(`Missing earliestMountTime for property ${s}`)),h.gotFirstResult||(h.gotFirstResult=!0,Ve().default.measure({metricName:g,startTime:h.mountTime,endTime:d},{environment:r,shouldSendIfStatsigNotInitialized:!0,data:f()})),l().default.afterNextFlush((()=>{m.didTrackFirstResult&&[...m.pageIdToStatus.values()].every((e=>e.gotFirstResult))&&p.set(s,{done:!0}),[...p.values()].every((e=>e.done))&&(i.current=_f)}))}),[t,a,r,o])}}(e);return(0,a().w)((()=>{t.propertyResultDurationTracker||(t.propertyResultDurationTracker=o)})),null}function Bf(e){const t=Mf();return n.useMemo((()=>Object.values(t).some((e=>e))),[t])?(0,D.jsx)(Pf,{...e}):null}var Vf=()=>o(736316);class Ff extends p().default{getInitialState(){return{stage:"NOT_TRACKING"}}}function Lf(e,t,o,r,i){const a=(0,s().v3)(),c=(0,d().uB)(void 0,Ff),u=(0,n.useRef)(0),p=(0,n.useRef)(t),m=(0,n.useRef)(),g=(0,n.useRef)(void 0),S=(0,n.useRef)(void 0),h=(0,n.useRef)(!0),f=(0,n.useRef)(!1),y=(0,n.useCallback)((()=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),g.current=performance.now())}),[c]),x=(0,n.useCallback)((e=>{"NOT_TRACKING"===c.state.stage&&(c.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(m.current=e))}),[c]),b=(0,n.useCallback)((()=>{if(o.current)return;const t=c.state.stage;if("COUNTING_VISIBLE_ITEMS"===t){if(u.current++,1===u.current){const e=performance.now();l().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===c.state.stage&&c.setState({stage:"SHOULD_TRACK",endTime:e,source:c.state.source})}))}}else"NOT_TRACKING"===t&&h.current&&(h.current=!1,Ve().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:a,data:ke().ax({environment:a,collectionContextStore:e,visibleItemsCount:1,wasInitialRenderEmpty:f.current,isPrewarmedTab:(0,Me().isPrewarmedTabInitialRender)(a),cvbLoadingStateOnInitialRender:i})}))}),[e,o,a,c,i]),C=(0,n.useCallback)((()=>{S.current||(S.current=performance.now())}),[]),w=(0,n.useCallback)((t=>{t.state&&"COUNTING_VISIBLE_ITEMS"===c.state.stage&&(f.current=!0,e.isEmptyStore.removeListener(w),b())}),[e.isEmptyStore,b,c]),k=(0,n.useCallback)((t=>{if(!o.current&&"SHOULD_TRACK"===t.state.stage){const o=(0,Me().isPrewarmedTabInitialRender)(a),s=o?Ge().A.state.prewarmedTabAppStartTimeOverride:void 0,c=ke().ax({environment:a,collectionContextStore:e,visibleItemsCount:u.current||0,wasInitialRenderEmpty:f.current,isPrewarmedTab:o,cvbLoadingStateOnInitialRender:i});if("INITIAL"===t.state.source){var n,l;const i=(0,Pe().A)(null===(n=e.collectionViewStore())||void 0===n?void 0:n.id),d=null===(l=a.prefetchCache)||void 0===l?void 0:l.getPrefetchAnalytic(i),u={cvbBlockRenderStart:p.current,cvbBlockRenderMount:g.current,itemsStart:S.current,itemsVisible:t.state.endTime},m=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:s}=Ge().A.state.subMetricsStore.state,a=t=>{let{startTime:o,endTime:n}=t;if(e.isPrewarmedTab){if(n<=e.prewarmedTabNavigationStart)return 0;if(o<e.prewarmedTabNavigationStart&&n>e.prewarmedTabNavigationStart)return n-e.prewarmedTabNavigationStart}return n-o};return o&&s&&(l["collections.await_page_chunk_end_to_cvb_start"]=a({startTime:s.endTime,endTime:o}),(0,Vf().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:s.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=a({startTime:o,endTime:n}),(0,Vf().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=a({startTime:n,endTime:r}),(0,Vf().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=a({startTime:r,endTime:i}),(0,Vf().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(o&&"number"==typeof s?{subMetricsTimes:u,isPrewarmedTab:!0,prewarmedTabNavigationStart:s}:{subMetricsTimes:u,isPrewarmedTab:!1}),h={...c,sub_metrics:m,initial_render_timings:e.timingTracker.getMetrics(u),includes_page_origin_to_app_start:!0};r&&Ve().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:a,data:h,shouldSendIfStatsigNotInitialized:!0}),p.current&&(Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:a,data:h,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==d?void 0:d.type)&&void 0!==d.finishedTimeMs&&d.finishedTimeMs>p.current&&Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:p.current,endTime:d.finishedTimeMs},{environment:a,data:c}))}else if("NAVIGATION"===t.state.source){if(m.current){const e={...c,wasm_sqlite_initialized:Ge().A.state.metricDataStore.state.wasm_sqlite_initialized,...$e().A.getDatabaseNavigationMetrics(m.current)};Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:m.current,endTime:t.state.endTime},{environment:a,data:e})}p.current&&Ve().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:p.current,endTime:t.state.endTime},{environment:a,data:c})}else(0,v().ub)(t.state.source);t.setState({stage:"COMPLETED"}),u.current=0}}),[e,o,a,r,i]);return(0,n.useEffect)((()=>(c.addListener(k),()=>{c.removeListener(k)})),[k,c]),(0,n.useEffect)((()=>(e.isEmptyStore.addListener(w),()=>{e.isEmptyStore.removeListener(w)})),[e.isEmptyStore,w]),{handleInitialDatabaseRender:y,handleNavigationDatabaseRender:x,handleItemMount:b,handleItemsRenderStart:C}}function Ef(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,mountedBeforeInitialPageRender:r,cvbLoadingStateOnInitialRender:i}=e,{handleInitialDatabaseRender:l,handleNavigationDatabaseRender:s,handleItemMount:a,handleItemsRenderStart:c}=Lf(t,o,n,r,i);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:l,handleNavigationDatabaseRender:s,handleItemMount:a,handleItemsRenderStart:c}),null}const Of=180,Df=n.memo(n.forwardRef((function(e,t){const{store:B,isFullScreen:K,productUseCase:H,viewsModuleContext:W,overrideViewType:G,headerActionsBehavior:N="default",overridePaddingLeft:U,overridePaddingRight:$,fullWidth:q,headerText:Y,hideViewTabBar:X,headerAllowedActions:Q,maxHeight:Z,disabled:J,forceLocalQueryCollection:ee=!1,isUnlistedView:oe,viewId:ne,onMount:re,setCollectionContextStore:ie,showOnlyCurrentView:le,additionalCollectionViewInnerHorizontalPadding:ce,templatePickerMenuListStore:de,mountedBeforeInitialPageRender:pe,cvbLoadingStateOnInitialRender:me,editorContentContainerRef:Je}=e,et=(0,u().DP)(),tt=(0,s().WS)(),ot=(0,n.useRef)(null),at=(0,s().v3)(),ct=(0,fe().Zp)(),dt=(null==ct?void 0:ct.isPreviewing)??!1,ut=(0,n.useMemo)((()=>new(Ke().A)(at)),[at]),pt=(0,n.useContext)(ye().R),{didDelayOffscreenRenderRef:mt}=function(e){let{collectionContextStore:t,isFullScreen:r,rootRef:i}=e;const l=(0,n.useRef)(r),s=(0,n.useRef)(!1),a=(0,d().K8)((()=>o(735372).Ay.isOpen()),[]);return(0,n.useEffect)((()=>{if(!i.current)return;if(l.current)return;if(a)return l.current=!0,void t.shouldDelayRenderStore.setState(!1);if(!i.current.parentElement)return;const e=new IntersectionObserver((o=>{const n=!o.reduce(((e,t)=>t.time>e.time?t:e),o[0]).isIntersecting;n?s.current=!0:(l.current=!0,e.disconnect()),t.shouldDelayRenderStore.setState(n)}));return e.observe(i.current.parentElement),()=>e.disconnect()}),[t,a,i]),{didDelayOffscreenRenderRef:s}}({collectionContextStore:ut,isFullScreen:K,rootRef:ot}),gt=(0,d().uB)(void 0,o(505776).A),St=(0,n.useMemo)((()=>new(Ye().E)),[]),ht=(0,n.useMemo)((()=>new(Ye().E)),[]),ft=(0,n.useMemo)((()=>new(Ye().E)),[]),yt=(0,n.useRef)(null),vt=(0,n.useRef)(),xt=(0,n.useRef)(null),[bt]=(0,n.useState)((()=>performance.now())),Ct=(0,n.useRef)(new Map),wt=(0,n.useRef)(),kt=(0,E().X)("query_collection_schema_change"),At=(0,n.useRef)(null);At.current||(At.current=new nt(ut,at)),(0,n.useEffect)((()=>{ut.previewContextStore.setState(ct)}),[ct,ut]),(0,n.useEffect)((()=>{const e=At.current;return async function(){const{createHasSchemaChangedForQueryStore:t}=await ge.load();ut.hasSchemaChangedForQueryStore=t(ut),kt&&(null==e||e.subscribeToSchemaChanges(ut.hasSchemaChangedForQueryStore))}(),()=>{null==e||e.unsubscribeFromSchemaChanges()}}),[At,ut,kt]);const It=(0,n.useRef)(),jt=(0,n.useRef)(),Rt=(0,d().K8)((()=>ut.collectionStore()),[ut]),[Tt,Mt]=(0,n.useState)(!1),[_t,Pt]=(0,n.useState)(!1),[Bt,Vt]=(0,n.useState)(!1),Ft=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),Lt=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createFollowSettingsStore"})),Et=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Ot=(0,d().uB)(void 0,p().default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),Dt=(0,d().uB)(void 0,p().default.createClass(void 0,{name:"viewSettingsPlacementStore"})),zt=(0,d().uB)(void 0,ze().A);(0,o(265793).b)(ut);const Kt=(0,n.useCallback)((()=>{var e;return G??(null===(e=ut.collectionViewStore())||void 0===e?void 0:e.getType())}),[G,ut]),Wt=(0,d().r6)((()=>(0,F().cq)(B)),[B]),Gt=(0,d().O$)(Wt),Nt=(0,d().O$)(ut.isInHomeWidgetStore),{isViewModule:Ut}=(0,d().K8)((()=>{const e=ut.viewsModuleContextStore;return{isViewModule:Boolean(e.getViewModuleType())}}),[ut]),$t=(0,d().K8)((()=>(0,F().RX)(B)),[B]),qt=(0,d().r6)((()=>{const e=(0,Oe().Uh)(at)-V().x6;if($t&&!K&&!(0,V().Ck)(B,void 0,at)&&e>0&&!Nt)return e/2}),[at,$t,K,B,Nt]),Yt=(0,d().O$)(qt),Xt=(0,d().K8)((()=>{var e;return(null===(e=yt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[yt]),Qt=(0,n.useCallback)((e=>{var t,o;if(ut.isInHomeWidgetStore.state)return;const n=ut.normalizedFormatStore.state,r=null===(t=Xt.current)||void 0===t?void 0:t.clientWidth;ut.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==yt||null===(o=yt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:qt.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[ut,Xt,qt]),Zt=(0,d().K8)((()=>B.isRootOrDirectChild()),[B]),Jt=(0,d().K8)((()=>(0,he().dC)(at,B)),[at,B]),eo=(0,d().r6)((()=>{const e=Kt(),t=(0,_().l0)({environment:at,store:B,isFullScreen:K,sizeObserver:St,viewType:e,collectionContextStore:ut});return t&&void 0!==U&&(t.paddingLeft=U),t&&void 0!==$&&(t.paddingRight=$),t&&Zt&&Jt&&(0,V().Ck)(B,void 0,at)&&"page"!==e&&(t.paddingRight+=he().Qb),t}),[at,B,K,St,Kt,ut,U,$,Zt,Jt]);(0,d().O$)(eo);const to=(0,n.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&Vt(!0)}),[Vt]),oo=(0,n.useCallback)((()=>{Vt(!1)}),[Vt]),no=(0,n.useCallback)((()=>{We().A.state||Mt(!0)}),[Mt]),ro=(0,n.useCallback)((()=>{Mt(!1)}),[Mt]),io=(0,n.useCallback)((()=>{var e,t;if(Nt)return;const o=null===(e=yt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=ut.frozoneStore.state.scrollerWidth,r=null===(t=yt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=ut.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=ut.collectionViewStore(),s=ut.normalizedFormatStore.state;ut.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:qt.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,s),tryShowHiddenFrozenColumn:!1})))}),[ut,yt,qt,Nt]),lo=(0,n.useCallback)((()=>{var e,t;const o=null===(e=yt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=eo.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==ut.frozoneStore.state.isScrolled&&(ut.frozoneStore.setState({...ut.frozoneStore.state,isScrolled:r}),io())}),[ut,io,eo]),so=(0,n.useRef)(!1);!function(e){let{environment:t,collectionContextStore:o}=e;const r=(0,n.useCallback)((e=>{e.state.online||(0,T().M)(t,o,{src:"initial_load"})}),[t,o]);(0,a().l)((()=>{He().A.state.online&&He().A.addListener(r)})),(0,c().X)((()=>{He().A.removeListener(r)}))}({environment:at,collectionContextStore:ut}),(0,d().K8)((()=>{var e;const t=ut.collectionViewStore(),n=ut.collectionStore(),r=at.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,s=B.getCollectionViewStores(),a=s.map((e=>e.id)),c=null!==(e=s[0])&&void 0!==e&&e.isDefined()?s[0]:void 0,d=B.id,u=g().K.get({userId:r,key:(0,je().H6)(d)});let p;const m=e=>!!oe||(!!a.includes(e)||"collectionSettings"===ut.contextType);if(ne&&m(ne)?p=ne:t&&m(t.id)?p=t.id:u&&m(u)?p=u:c&&m(c.id)&&(p=c.id),p){const e=ae().pS.createChildStore(t??B,{table:f().Gy,id:p});if(e.isDefined()){p!==u&&g().K.set({userId:r,key:(0,je().H6)(d),value:p});const t=e.getCollectionStore();e&&(!so.current||p!==i||t&&t.id!==l)&&(so.current=!0,ut.forceLocalQueryCollection=ee,(0,o(559102).d)({environment:at,collectionViewBlockStore:B,collectionViewStore:e,collectionStore:t,collectionContextStore:ut,isFullScreen:K??!1,productUseCase:H,isRootChild:B.isRootOrDirectChild(),isInPeekRenderer:Gt,viewsModuleContext:W}))}}}),[B,ut,at,K,H,Gt,W,ee,oe,ne]),(0,d().K8)((()=>{void 0===ut.frozoneStore.state.frozenIndex&&ut.collectionViewStore()&&Qt(ut.collectionViewStore())}),[ut,Qt]);const ao=(0,n.useRef)(!1);(0,n.useEffect)((()=>(ao.current=!0,()=>{ao.current=!1})),[]);const co=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(co.current){const e=Kt();e&&(i().A.withListenerIgnored((()=>{const t=ut.collectionStore(),o=ut.collectionViewStore(),n=null==o?void 0:o.getChartType(),r=null==o?void 0:o.getChartPlaceholderType();(0,xe().vd)(at,"database_visit",{collection_id:null==t?void 0:t.id,collection_view_id:null==o?void 0:o.id,collection_view_block_id:B.id,type:e,is_full_screen:K,is_peek:Wt.state,peek_mode:O().default.state.mode,database_visit_id:ut.visitSessionId,chart_type:"placeholder"===n?r:n,is_chart_placeholder:"placeholder"===n})})),co.current=!1)}}),[]);const{value:uo}=(0,se().fJ)(ve().T.formulas);(0,n.useEffect)((()=>{(0,v().O9)(uo)&&ut.formulasCodeStore.setState(uo)}),[uo,ut.formulasCodeStore]),(0,n.useEffect)((()=>{be(at)}),[at]),(0,n.useEffect)((()=>{i().A.withListenerIgnored((()=>{const e=ut.collectionViewStore();if(e&&"collectionTypedView"===ut.contextType){const t=ut.databaseType,o=Kt();t&&o&&(0,xe().WU)(at,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:B.id,type:o,databaseType:t,is_my_tasks:(0,Le().NY)("myTasks")===B.id})}}))}),[]),(0,n.useEffect)((()=>{const e=Ve().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:at,getData:()=>({...(0,ke().kz)(ut),is_first_render:co.current})})})),jt.current&&i().A.withListenerIgnored((()=>{if(!jt.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=jt.current;Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:at,getData:()=>{const o=(0,ke().kz)(ut),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:ut.isLoadingStore.state,row_count_category:(0,ke().Cu)(n),...l}}}),jt.current=void 0})),(0,n.useEffect)((()=>{const e=()=>{if(!ut.isLoadedStore.state||!ao.current||ut.wasCreatedThisSessionStore.state||ut.didFireLoadEventsStore.state)return;ut.didFireLoadEventsStore.setState(!0);const e=at.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const n=ut.isFullScreenStore.state;if(n){var i;const e=null===(i=ut.collectionViewStore())||void 0===i?void 0:i.getType();if(!Ge().A.state.initialRenderCompleted&&pe){var l;o(915086).setInitialRenderCompleted(),r().oh.hackyOffsetParsesCorrectly()||(0,xe().vd)(at,"luxon_hacky_offset_parses_correctly_false");const i=()=>{var n,r;const i=(0,ke().kz)(ut),l=ut.collectionViewStore(),s=null==l?void 0:l.id,a=(0,Pe().A)(s),c=ut.requestBackend;return{...i,is_push:(null===(n=t)||void 0===n?void 0:n.isPush)??!1,collectionViewType:e,initial_route:at.RouterStore.state.initialRoute.name,prefetchCache:null===(r=at.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic(a))||void 0===r?void 0:r.type,cvb_loading_state:me,wasm_sqlite_initialized:Ge().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(248566).A)(),collection_request_backend:c,sub_metrics:Me().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};Ve().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:at,getData:i,shouldSendIfStatsigNotInitialized:!0});const c=sS().H6.CollectionViewBlock.getLoadingMetrics();var s,a;if(null!=c&&c.startedAt)Ve().default.DO_NOT_USE_measureLegacy({metricName:"collection_view_block_bundle_load_and_parse",startTime:c.startedAt,endTime:c.resolvedAt},{environment:at,data:{did_prefetch:"hit-match"===(null===(s=at.prefetchCache)||void 0===s||null===(s=s.getPrefetchAnalytic((0,Pe().A)(null===(a=ut.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===s?void 0:s.type),is_full_screen:n}});null===(l=ut.databaseItemsVisibleTracker)||void 0===l||l.handleInitialDatabaseRender()}else{var c;const t=$e().A.popTimings(),o=()=>({...(0,ke().kz)(ut),wasm_sqlite_initialized:Ge().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:e,...$e().A.getDatabaseNavigationMetrics(null==t?void 0:t.navigationStart)});t&&Ve().default.DO_NOT_USE_measureAfterNextFlushLegacy({metricName:"navigation_database_render",startTime:t.navigationStart},{environment:at,getData:o}),Ue().A.state.isMeasuring&&Ue().A.update((e=>({...e,isMeasuring:!1}))),null===(c=ut.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(null==t?void 0:t.navigationStart)}}else{var d,u;if(pe)null===(d=ut.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender();else null===(u=ut.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender()}};return ut.isLoadedStore.addListener(e),e(),()=>{ut.isLoadedStore.removeListener(e)}}),[ut,at,pe,me]),(0,d().K8)((()=>{for(const t of B.getCollectionViewStores())t.getValue();const e=ut.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[B,ut]),(0,n.useEffect)((()=>{const e=()=>!O().default.isCenterPeekOpen()&&qe().A.state.isVisible,t=()=>{var t;e()&&(null===(t=At.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("page_show"))},o=()=>{var t;e()&&(null===(t=At.current)||void 0===t||t.maybeProcessQueuedCollectionEmit("exit_peek"))};return qe().A.addListener(t),O().default.addListener(o),()=>{qe().A.removeListener(t),O().default.removeListener(o)}}),[At]),(0,n.useEffect)((()=>{const e=e=>{o(42120).bE({environment:at,sprintSettingsContext:e.state})};return ut.sprintSettingsContextStore.addListener(e),()=>{ut.sprintSettingsContextStore.removeListener(e)}}),[ut,at]),(0,n.useEffect)((()=>{const e=async e=>{if(e.state){const e=ut.collectionViewBlockStore(),t=ut.collectionViewStore(),o=ut.collectionStore();if(!e||!t||!o)return;await(0,T().M)(at,ut,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return ut.relativeVariablesAreStaleStore.addListener(e),()=>{ut.relativeVariablesAreStaleStore.removeListener(e)}}),[ut,at,ee]);const{contextType:po,databaseType:mo,remoteCollectionIds:go}=(0,d().K8)((()=>({contextType:ut.contextType,databaseType:ut.databaseType,remoteCollectionIds:ut.remoteCollectionIdsStore.state})),[ut]);(0,n.useEffect)((()=>{if(wt.current)return;if("collectionTypedView"!==po||!mo)return;const e=new(st().C)(at,(0,S().aW)({spaceId:B.getSpaceId(),databaseType:mo}),((e,t)=>{var o;null===(o=At.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:zf(B),isCollectionTypeChange:!0})}));e.subscribe(),wt.current=e;const t=wt.current;return()=>{t.unsubscribe()}}),[ut,at,At,B,po,mo]),(0,n.useEffect)((()=>{null==ie||ie(ut)}),[ie,ut]),(0,n.useEffect)((()=>{null==re||re(Kt())}),[]),(0,d().K8)((()=>{var e;const t=ut.frozoneStore.state.scrollerWidth,o=null===(e=ut.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(t,ut.normalizedFormatStore.state);void 0===o||ut.isInHomeWidgetStore.state||ut.frozoneStore.setState({...ut.frozoneStore.state,frozenIndex:o})}),[ut]),(0,n.useEffect)((()=>{const e=e=>{const t=Array.from(Ct.current.keys()??[]),o=y().R9(t,e),n=y().R9(e,t);for(const i of o){var r;null===(r=Ct.current.get(i))||void 0===r||r.unsubscribe(),Ct.current.delete(i)}for(const i of n){const e=new(st().C)(at,(0,S().eG)(i),((e,t)=>{var o;null===(o=At.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:zf(B),isCollectionTypeChange:!1})}));e.subscribe(),Ct.current.set(i,e)}};if(Rt)e([Rt.id]);else if("collectionTypedView"===po){e(go??[]);const t=t=>{e(t.state)};return ut.remoteCollectionIdsStore.addListener(t),()=>{ut.remoteCollectionIdsStore.removeListener(t)}}}),[ut.remoteCollectionIdsStore,At,Rt,po,at,go,B]),(0,n.useEffect)((()=>{const e=Ct.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const So=(0,n.useMemo)((()=>({onFocus:to,onBlur:oo,onMouseMove:no,onMouseLeave:ro})),[to,oo,no,ro]);(0,n.useEffect)((()=>{var e;const t=null===(e=yt.current)||void 0===e?void 0:e.getNode();return t&&(0,Re().P4)(t,"scroll",lo),()=>{t&&(0,Re().Ol)(t,"scroll",lo)}}),[lo]),(0,n.useEffect)((()=>()=>{(0,o(436371).u)({collectionContextStore:ut})}),[ut]),(0,n.useEffect)((()=>()=>{St.destroy(),ht.destroy(),ft.destroy()}),[St,ht,ft]),(0,n.useEffect)((()=>()=>{var e;null==vt||null===(e=vt.current)||void 0===e||e.disconnect()}),[]),(0,o(892008).L)({collectionContextStore:ut,isFullScreen:Boolean(K),wasCreatedThisSessionStore:ut.wasCreatedThisSessionStore,environment:at,didDelayOffscreenRenderRef:mt}),(0,n.useEffect)((()=>{var e;const t=null===(e=ut.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=ut.settingsStore;t.external_collection_type&&t.synced_collection_external_url&&Ne().Ay.state.defaultExternalCollectionSetting&&(b().eM({collectionSettingsStore:o,source:Ne().Ay.state.defaultExternalCollectionSetting}),Ne().Ay.setState({...Ne().Ay.state,open:!1,defaultExternalCollectionSetting:void 0}))}),[ut]);const ho=(0,d().r6)((()=>{var e;const t=null==Rt?void 0:Rt.isSyncedCollection(),o=!0===(null==Rt||null===(e=Rt.getFormat().sync_state)||void 0===e?void 0:e.syncing),n=at.device.isMobile;return Boolean(t&&o&&!n)}),[Rt,at]);(0,d().O$)(ho),(0,n.useEffect)((()=>{const e=async t=>{const n=await o(449506).callApi({eventName:"getExternalCollectionSyncState",environment:at,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=ut.numberChildrenReceivedStore,i=ut.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(It.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(ho){const t=ut.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return ho.addListener(t),()=>{ho.removeListener(t),clearTimeout(It.current)}}),[ho,ut,at]);const fo=(0,d().K8)((()=>ut.collectionViewStore()),[ut]),yo=J||Boolean(null==ct?void 0:ct.disableAllPointerEvents),vo=(0,Be().bx)(B,yo),xo=(0,d().K8)((()=>!!Rt&&(0,m().Qu)(Rt.getValue())),[Rt]),bo=(0,d().K8)((()=>(0,Ce().sj)(B.id)),[B]),Co=(0,d().K8)((()=>(0,Ce().Wu)(B.id)),[B]),wo=(0,d().K8)((()=>!!bo&&ut.isEmptyStore.state),[bo,ut]),ko=(0,d().K8)((()=>!!Co&&ut.isEmptyStore.state),[Co,ut]),Ao=(0,d().K8)((()=>Nt&&bo&&0===ut.collectionStoresStore.state.length&&ut.isLoadedStore.state),[Nt,bo,ut]),Io=(0,d().K8)((()=>Nt&&Co&&0===ut.collectionStoresStore.state.length&&B.getCollectionViewStores().length<=1),[Nt,Co,ut,B]),jo=(0,E().X)("workflow_container"),Ro=(0,d().K8)((()=>jo&&B.isReady()&&0===B.getCollectionViewStores().length&&"collectionSettings"!==ut.contextType),[jo,B,ut]),To=(0,d().r6)((()=>{if(!Zt||!Jt||!(0,V().Ck)(B,void 0,at)||B.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(he().Qb/2)}}),[at,Zt,Jt,B]);(0,d().O$)(To);const Mo=(0,d().r6)((()=>{var e;if(Ao||Io)return 0;const t="viewsMain"===(null===(e=ut.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType());return Y||"hidden"!==N||!X?t?Ie().WK:oe||ut.isInHomeWidgetStore.state?Ie().nh:Ie().Lq:0}),[Ao,Io,ut,Y,N,X,oe]);(0,d().O$)(Mo);const _o=(0,E().X)("db_ux_chrome"),Po=Se({collectionContextStore:ut,previewContext:ct,isPlaceholderExternalCollection:xo}),Bo=(0,d().K8)((()=>{var e;return(null===(e=ut.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[ut]),Vo=(0,n.useMemo)((()=>{const e=1===(null==Bo?void 0:Bo.length);return _o&&Po&&(K||!e)}),[_o,Po,Bo,K]),Fo=(0,d().K8)((()=>{if(Tt||_t||Bt||K)return!0;if("always_show"===N)return!0;if(at.device.isMobile)return!0;if("form_editor"===Kt())return!0;if(ut.settingsStore.state.open)return!0;if(ut.searchOpenStore.state)return!0;if(Ot.state.open)return!0;if(Lt.state.open)return!0;if(Ft.state.open)return!0;if(Et.state.open)return!0;if(ut.filterBarSortSettingsStore.state.open)return!0;if(Array.from(ut.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!zt.state.open}),[at.device,Tt,_t,Bt,K,N,Kt,ut,Ot,Ft,Et,zt,Lt]),Lo=(0,d().r6)((()=>!(!_o||ut.isInHomeWidgetStore.state)||Fo),[Fo,_o,ut]);(0,d().O$)(Lo);const Eo=(0,d().r6)((()=>ut.collectionActionsMinimizedStore.state&&!K?_().xE.Collapsed:_().xE.Expanded),[ut.collectionActionsMinimizedStore,K]);(0,d().O$)(Eo);const Oo=(0,d().K8)((()=>{const e=Kt();return!!e&&(0,Ae().II)({currentViewType:e,isPlaceholderExternalCollection:xo,collectionContextStore:ut,allowedActions:Q,settingsHeaderSizeObserver:ht})}),[Kt,ut,Q,xo,ht]);(0,d().K8)((()=>{Oo&&b().IW({collectionSettingsStore:ut.settingsStore,showAddItemButton:!0})}),[Oo,ut]);const Do=(0,n.useCallback)((e=>{if(!ut.collectionViewBlockStore()||!(0,Xe().EF)(at))return;const t=ut.isMultiSourceView;C().Ur({userAction:"CollectionViewBlock.handleAddItemClick",environment:at,collectionContextStore:ut,collectionViewBlockStore:B,shouldCoerce:!0,templateStore:ut.defaultPageTemplateStore.state,useCrdt:!0,showMoveTo:t,peekModeOverride:Nt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,x().X)({environment:at,collectionContextStore:ut,action:"click_topbar_new_item"})}),[ut,at,B,Nt]),zo=(0,n.useCallback)((e=>{const{device:t}=at,{target:o}=e;if(!fo||t.isMobile||!(o instanceof HTMLElement))return;const n=Kt();n&&0===e.button&&"form_editor"!==n&&(0,Te().SQ)({event:e,context:Te().y$.EditorMouseDown,callback:()=>{e.preventDefault(),k().jD({environment:at,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===n||"table"===n})}})}),[at,fo,Kt]),Ko=(0,n.useCallback)(((e,t)=>{(0,Te().SQ)({event:e,context:Te().y$.EditorClick,callback:()=>{if(Wt.state||w().Cx(at),"page"===t&&!(0,_e().Zm)()){const{clientX:t,clientY:o,target:n}=e;l().default.afterNextFlush((()=>{j().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:at,canUndo:!0,perform:e=>{I().editNearestBlockOrInsertIfAtBottomOfPage(at,{x:t,y:o,target:n instanceof Element?n:void 0},e)}})}))}}})}),[at,Wt]),Ho=(0,n.useMemo)((()=>y().sg(io,100)),[io]),Wo=(0,n.useCallback)((()=>{We().A.state||Pt(!0)}),[Pt]),Go=(0,n.useCallback)((()=>{Pt(!1)}),[Pt]),No=(0,n.useCallback)((e=>{e&&St.observe(e)}),[St]),Uo=(0,n.useCallback)((e=>{e&&ft.observe(e)}),[ft]),$o=(0,n.useCallback)((e=>{e&&ht.observe(e)}),[ht]),qo=(0,n.useCallback)((e=>{var t,o;const n=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(we().Dkd);yt.current=n?e:(null==pt?void 0:pt.horizontalScroller)||null;const r=ut.collectionViewStore();Qt(r);const i=null===(o=yt.current)||void 0===o?void 0:o.getNode();"undefined"!=typeof ResizeObserver&&i&&(vt.current=new ResizeObserver(Ho),vt.current.observe(i))}),[ut,Ho,Qt,pt]),Yo=(0,d().K8)((()=>{if("form_editor"!==Kt()&&ut.settingsStore.state.open&&"sidebar"===Dt.state&&!0!==o(184701).b.state.visible)return(0,D.jsx)("div",{style:{...eo.state,...To.state,borderTop:`1px solid ${et.tableDividerColor}`,height:12}})}),[ut,To,eo,et,Dt,Kt]),Xo=(0,d().K8)((()=>{const e=null==Rt?void 0:Rt.getValue();return Boolean(e&&(0,m().SJ)(e))}),[Rt]),Qo=(0,d().K8)((()=>{var e;if(Kt())return(0,R().B2)({blockStore:B,isFullScreen:Boolean(K),environment:at,collectionContextStore:ut})?0:-((null===(e=eo.state)||void 0===e?void 0:e.paddingLeft)??0)}),[Kt,B,K,eo,at,ut]),[Zo,Jo,en]=(0,d().K8)((()=>[ut.normalizedSchemaStore.state,ut.normalizedQueryStore.state,ut.normalizedFormatStore.state]),[ut]),tn=(0,d().K8)((()=>{if("collectionTypedView"===ut.contextType)return N;if("collectionSystemView"===ut.contextType){const e=ut.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,o(737658).TR)(t)?"default":"hidden"}return!Rt||Rt&&!1===Rt.canRead()||!Rt.isDefined()?"hidden":N??"default"}),[ut,Rt,N]),on=(0,n.useRef)(null),nn=(0,d().K8)((()=>{var e,t;const o=$t&&!O().default.isSidePeekOpeningStore.state&&!oe,n=o?K?{paddingLeft:(null==eo||null===(e=eo.state)||void 0===e?void 0:e.paddingLeft)??0,paddingRight:16}:{paddingLeft:0,paddingRight:((null==eo||null===(t=eo.state)||void 0===t?void 0:t.paddingRight)??0)+16}:null==eo?void 0:eo.state,r=(0,Oe().Uh)(at),i=(0,V().Ck)(B,void 0,at)||K?r:Math.min(V().x6,r);return{headerWrapper:{minHeight:Mo.state,paddingLeft:null==n?void 0:n.paddingLeft,paddingRight:null==n?void 0:n.paddingRight,width:q,position:"relative",left:-((null==n?void 0:n.paddingLeft)??0),flexShrink:0,...(K||dt||o)&&{position:"sticky",zIndex:86,left:0,width:!$t||!n||K||dt||oe?void 0:i-n.paddingLeft/2},...B.isNonEditableState()&&{cursor:"default"},...To.state}}}),[at,q,Mo,dt,K,$t,oe,To,eo,B]),rn=(0,d().K8)((()=>{var e,t;if(Ro)return(0,D.jsx)(Qe().Vh,{store:B});const n=Kt();if(!(fo&&Zo&&Jo&&en&&n))return null;if(Xo)return(0,D.jsx)(te().RI,{value:ut,children:(0,D.jsx)(rt().s,{allowSelectionWithin:!0,style:nn.headerWrapper,onMouseDown:zo,onMouseMove:Wo,onMouseLeave:Go,onClick:Ko,ref:(0,h().Px)(No,ot),children:(0,D.jsx)(lt().A,{store:B,shouldShowHoverMenu:!0,analyticsName:(0,_().LI)(n),shouldShowHalo:!K&&!dt&&!Nt,canSelect:!(K||dt||Nt||Ut),children:(0,D.jsx)(o(361873).A,{store:B,style:{width:"auto"},disabled:!1})})})});if(Io)return(0,D.jsx)(te().RI,{value:ut,children:(0,D.jsx)("div",{ref:ot,...So,style:{display:"contents"},children:(0,D.jsxs)("div",{style:(0,Ee().V$)({isPhone:tt,theme:et}),ref:on,children:[(0,D.jsx)("div",{style:{position:"relative"},children:(0,D.jsx)(dS,{currentViewType:n,headerSizeObserver:St,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,headerHeightStore:Mo,viewSettingsPlacementStore:Dt,store:B,leftRightPaddingStore:eo,isInHomeWidget:Nt,placementToOrigin:De().W.Right,alignmentToOrigin:De().C.Center,headerRef:on})}),(0,D.jsx)(Fe().Ww,{feature:"custom_db",onSetup:e=>{b().Ow({collectionContextStore:ut,collectionSettingsStore:ut.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:Rt}]})}})]})})});const r=(0,D.jsx)(aS,{collectionContextStore:ut,store:B,collectionStore:Rt,collectionViewStore:fo,currentViewType:n,isDisabled:yo,isFullScreen:Boolean(K),isInPeek:Gt,isPreviewing:dt,isRootOrDirectChild:Zt,headerSizeObserver:St,timelineViewRef:xt,showHoverActionsStore:Lo,handleAddItemClick:Do,isPlaceholderExternalCollection:xo,isMyTasksEmpty:wo,isInFrameWhenSidePeekOpen:$t,query:Jo,schema:Zo,format:en,showHomeCustomDbEmptyState:Io,maxHeight:Z,viewSettingsPlacementStore:Dt,templatePickerMenuListStore:de,editorContentContainerRef:Je,showMyTasksEmptyState:Ao,isInHomeWidget:Nt,isUnlistedView:oe,isHomeCustomDbEmpty:ko,handleHorizontalScrollerMount:qo,handleEditorMouseDown:zo,handleEditorClick:Ko,leftRightPaddingStore:eo,handleContentMount:Uo,rootRef:ot,isViewModule:Ut,additionalCollectionViewInnerHorizontalPadding:ce,scrollerLeftPadding:Yt,headerHeightStore:Mo,fullWidth:q,contentEditableVoidLeft:Qo,leftRightMarginStore:To});return(0,D.jsx)(te().RI,{value:ut,children:(0,D.jsx)(o(532564).Z,{value:gt,children:(0,D.jsxs)("div",{ref:ot,...So,style:{display:"contents"},children:[K?void 0:(0,D.jsx)("div",{style:{position:"relative"},children:(0,D.jsx)(dS,{currentViewType:n,headerSizeObserver:St,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,headerHeightStore:Mo,viewSettingsPlacementStore:Dt,store:B,leftRightPaddingStore:eo,isInHomeWidget:Nt,headerRef:on,handleAddItemClick:Do})}),(0,D.jsx)(ue,{}),(0,D.jsx)(Ht,{isFullScreen:Boolean(K),leftRightPaddingStore:eo,leftRightMarginStore:To,overrideViewType:G}),Vo&&(0,D.jsx)(rt().s,{allowSelectionWithin:!0,onMouseDown:zo,onMouseMove:Wo,onMouseLeave:Go,ref:(0,h().Px)(No,on),children:(0,D.jsx)("div",{style:{marginBottom:6},children:(0,D.jsx)(z,{store:B,collectionContextStore:ut,showHoverActionsStore:Lo,isFullScreen:Boolean(K),canEdit:vo,paddingLeft:null===(e=eo.state)||void 0===e?void 0:e.paddingLeft})})}),(0,D.jsx)(Af,{currentViewType:n,store:B,headerWrapStyle:nn.headerWrapper,headerActionsBehavior:tn,allowedActions:Q,hideViewTabBar:X??!1,showHoverActionsStore:Lo,headerSizeObserver:St,isFullScreen:Boolean(K),isInHomeWidget:Nt,isMyTasksPage:bo,isHomeCustomDbPage:Co,isPlaceholderExternalCollection:xo,collectionViewHeaderText:Y,handleEditorMouseDown:zo,handleHeaderMouseMove:Wo,handleHeaderMouseLeave:Go,handleHeaderMount:No,handleSettingsHeaderMount:$o,leftRightPaddingStore:eo,headerHeightStore:Mo,canEdit:vo,viewSettingsPlacementStore:Dt,contentSizeObserver:ft,settingsHeaderSizeObserver:ht,handleAddItemClick:Do,timelineViewRef:xt,filterBarCreateFilterSettingsStore:Et,createFilterSettingsStore:Ft,createFollowSettingsStore:Lt,switchViewMetric:jt,showOnlyCurrentView:Boolean(le),headerRef:on,headerStyleOverrides:{...oe&&{paddingLeft:24,paddingRight:24,paddingTop:12}},minimizedActionViewStore:Eo}),"form_editor"===n?(0,D.jsx)(it().A,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,render:e=>(0,D.jsx)("div",{...e,children:r})}):r,Yo,(0,D.jsx)(Ze().DG,{collectionContextStore:ut,paddingLeft:null===(t=eo.state)||void 0===t?void 0:t.paddingLeft}),(0,D.jsx)(Ef,{collectionContextStore:ut,collectionViewBlockRenderStartTime:bt,didDelayOffscreenRenderRef:mt,mountedBeforeInitialPageRender:pe,cvbLoadingStateOnInitialRender:me}),(0,D.jsx)(Bf,{collectionContextStore:ut,mountedBeforeInitialPageRender:Boolean(pe)})]})})})}),[nn,Kt,fo,Zo,Jo,en,Xo,Io,B,Rt,yo,K,Gt,dt,Zt,ce,St,Lo,Do,xo,wo,$t,Z,Dt,de,Ao,Yt,Nt,oe,ko,zo,eo,qo,Ko,To,Uo,Mo,ut,tt,et,gt,So,ft,ht,G,tn,Q,X,bo,Co,Y,Wo,Go,No,$o,vo,Et,Ft,Lt,le,Yo,bt,mt,pe,Ut,Ro,Je,me,Eo,Vo,Qo,q]);return(0,Be().NW)(B,t,(0,d().K8)((()=>({renderedType:"collection_view_page"===B.getType()?"collection_view_page":"collection_view",getBlockStore:()=>B,getNode:()=>ot.current,collectionContextStore:ut,resetLeftScrollAfterFlush:()=>{l().default.afterNextFlush((()=>{var e;const t=null===(e=yt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,L().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>function(e,t){A().IU({environment:e}),l().default.afterNextFlush((()=>{const n=t.collectionStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionStoreIfSingleSource();if(n&&(0,m().Qu)(n.getValue()))b().Ho({collectionSettingsStore:i});else if(l){(0,o(359454).P)({environment:e,collectionContextStore:t});const n=t.collectionViewStore();"form_editor"!==(null==n?void 0:n.getType())&&(b().Ow({collectionContextStore:t,collectionSettingsStore:i}),b().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0}}),"chart"===(null==n?void 0:n.getType())&&t.isCreatingNewChartCollectionStore.setState(!0))}else if(n){const l=null==t?void 0:t.collectionViewStore();l?(!function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:n,collectionContextStore:r,environment:i}=e,l=null==o?void 0:o.id,s=l?(0,M().v)(l):void 0,a=_().Mf({collectionStore:t,sourceCollectionViewBlockStore:n,currentCollectionViewBlockStore:n,currentCollectionViewStore:o,constraints:(0,M().v)(o.id)}).find((e=>{var t;return e.id===(null==s||null===(t=s.viewPointer)||void 0===t?void 0:t.id)}));a&&(0,P().U)({viewToDuplicateStore:a,collectionContextStore:r,collectionViewStore:o,environment:i})}({collectionStore:n,collectionViewStore:l,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),b().Ow({collectionContextStore:t,collectionSettingsStore:i}),b().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,o(424599).M)({environment:e,collectionStore:n,collectionContextStore:t,collectionSettingsStore:i})}else{const e=null==t?void 0:t.collectionViewStore();let o;var s;if(e)o=null===(s=(0,M().v)(e.id))||void 0===s?void 0:s.viewSettingsStack;b().Ow({collectionContextStore:t,collectionSettingsStore:i,initialStack:o})}}))}(at,ut)})),[B,ut,at]),rn)})));function zf(e){var t;return!qe().A.state.isVisible||!(!O().default.isCenterPeekOpen()||null!==(t=O().default.peekTargetStore.state)&&void 0!==t&&t.uiContains(e))}const Kf=Df;class Hf extends n.Component{componentDidCatch(e){throw o(449412).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,D.jsx)(Kf,{...t,ref:e})}}const Wf=n.forwardRef(((e,t)=>(0,D.jsx)(Hf,{...e,collectionViewBlockRef:t})))},911706:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(401497),r=()=>o(30626),i=()=>o(704152),l=o(474848);function s(e){let{onClick:t,className:o,isMobile:s,style:a,onFocus:c,onBlur:d,onMouseDown:u,onMouseEnter:p,onMouseLeave:m}=e;const{buttonStyle:g,iconStyle:S}=(0,n().IS)((e=>({buttonStyle:{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,borderRadius:6,width:s?45:24,height:s?45:24,marginRight:s?-8:-6,...a},iconStyle:{width:s?18:14,height:s?18:14,fill:e.mediumIconColor}})),[s,a]);return(0,l.jsx)(i().A,{onClick:t,style:g,className:o,mobileFeedback:s,onFocus:c,onBlur:d,onMouseDown:u,onMouseEnter:p,onMouseLeave:m,children:(0,r()._)(S)})}},996624:(e,t,o)=>{o.d(t,{a:()=>r});o(296540);var n=o(474848);const r=(0,o(340498).wt)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})}}]);