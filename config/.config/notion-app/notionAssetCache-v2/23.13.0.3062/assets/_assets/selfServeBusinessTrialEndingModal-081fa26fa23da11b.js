"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[31388],{585312:(e,t,n)=>{n.d(t,{q:()=>v});var r=()=>n(624119),i=(r(),n(296540),()=>n(484714)),a=()=>n(852507),s=()=>n(847249),o=()=>n(959013),l=()=>n(252105),d=()=>n(84817),c=()=>n(710149),u=()=>n(351360),m=()=>n(506090),p=()=>n(34699),g=()=>n(414402),h=()=>n(471725),y=n(474848);function v(e){const{modalId:t}=e,n=(0,s().O$)(h().D),d=(0,i().v3)();(0,a().w)((()=>{h().D.setState(!0)}));const c={defaultValues:{billingDetails:(0,s().K8)((()=>{const e=u().default.state.currentUserStore;return{email:null==e?void 0:e.getEmail(),name:null==e?void 0:e.getName()}}),[])},terms:{card:"never"}};return(0,y.jsxs)(p().iy,{title:n?(0,y.jsx)(g().y,{labelOnly:!0}):(0,y.jsx)(o().sA,{id:"subscriptions.checkout.paymentMethod.title",defaultMessage:"Payment method"}),children:[n?(0,y.jsx)(f,{}):null,(0,y.jsx)(r().PaymentElement,{options:c,onChange:e=>{l().C3(d,{event:e,modal_id:t}),m().A.update((e=>{if(!e.open)return e;const{paymentData:t,...n}=e;return n}))},onReady:()=>h().D.setState(!1)})]})}function f(){return(0,y.jsxs)(d().Y1,{gap:12,children:[(0,y.jsxs)(d().Y1,{direction:"horizontal",gap:12,children:[(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}}),(0,y.jsx)(c().A,{style:{width:"50%",height:60,borderRadius:6}})]}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{}),(0,y.jsx)(g().y,{})]})}},692100:(e,t,n)=>{n.r(t),n.d(t,{SelfServeBusinessTrialEndingModal:()=>oe});n(581454);var r=()=>n(624119),i=n(296540),a=()=>n(484714),s=()=>n(852507),o=()=>n(847249),l=()=>n(401497),d=()=>n(206267),c=()=>n(959013),u=()=>n(496603),m=()=>n(755199),p=()=>n(604018),g=()=>n(84817),h=()=>n(554509),y=()=>n(107683),v=()=>n(828634),f=()=>n(989423),x=()=>n(876853),S=()=>n(497799),b=()=>n(6208),j=()=>n(351360),M=()=>n(287351),B=()=>n(922442),_=()=>n(34699),I=()=>n(137826),P=()=>n(997929),E=()=>n(585312),C=()=>n(324561),w=()=>n(112527),D=()=>n(985315),k=()=>n(86089),A=()=>n(449506);var T=()=>n(281303),U=()=>n(624199),N=()=>n(610710),F=()=>n(125521),L=()=>n(404588),R=()=>n(9267),z=()=>n(669096),K=()=>n(35957),$=(n(898992),n(354520),n(672577),()=>n(244641)),O=()=>n(762433),q=()=>n(323063),V=()=>n(643819),X=()=>n(534177),H=()=>n(240865),Y=()=>n(601203),J=()=>n(815418),W=()=>n(651390),G=()=>n(931783),Z=()=>n(981046);var Q=()=>n(857639),ee=()=>n(252105),te=()=>n(613240),ne=()=>n(23954),re=()=>n(411341);var ie=n(474848);const ae=4,se=[];function oe(e){let{spaceStore:t,spaceViewStore:n,userSettingsStore:i}=e;const a=(0,w().useElementsOptions)({type:"setup",currency:"USD"}),s=(0,k().o)();return s.length?(0,ie.jsx)(r().Elements,{stripe:(0,w().getStripe)(),options:a,children:(0,ie.jsx)(le,{spaceStore:t,spaceViewStore:n,userSettingsStore:i,prices:s})}):null}function le(e){let{spaceStore:t,spaceViewStore:n,prices:w}=e;const k=(0,a().v3)(),oe=d().JW(),le=(0,b().L)(),de=(0,c().tz)(),[ce,ue]=(0,i.useState)({name:le??"",businessName:""}),[me,pe]=(0,i.useState)({}),[ge,he]=(0,i.useState)("month"),[ye,ve]=(0,i.useState)(),[fe,xe]=i.useState(!1),[Se,be]=i.useState(0),[je,Me]=i.useState(0),Be=L().XX-Se;i.useEffect((()=>{Se&&je&&xe((e=>Be<je-(e?L().ej:0)))}),[Se,je,Be]);const _e=e=>{ve(void 0),e.name&&pe((e=>({...e,name:void 0}))),ue((t=>({...t,...e})))},Ie=i.useCallback((()=>{const e={};return(0,x().r)(ce.name)||(e.name=de.formatMessage({id:"selfServeBusinessTrialEndingModal.name.required.error",defaultMessage:"Please enter a valid name."})),pe((t=>({...t,...e}))),e}),[ce.name,de]),Pe=(0,o().K8)((()=>{var e;return null===(e=j().default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),Ee=(0,l().IS)((e=>({paymentFieldsContainer:{height:480,width:480,position:"relative",border:`1px solid ${e.stroke.secondary}`,borderRadius:10,display:"flex",justifyContent:"center",padding:20,overflow:"auto"},rightPanel:{padding:20,flex:1,position:"relative"},iconBackground:{backgroundColor:"dark"===e.mode?"#1A2027":e.marketplaceEditorial.border.blue},billingIntervalContainer:{marginBottom:20,width:"100%"},footerContainer:{display:"flex",width:"100%",padding:"20px 0px 24px 0px",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",gap:24,position:"absolute",bottom:0,background:e.surface.elevated,transition:"all 200ms ease-in-out",...fe?{borderTop:`1px solid ${e.stroke.primary}`,boxShadow:"0px 0px 16px 0px rgba(0, 0, 0, 0.08)"}:{}},billingDetailsContainer:{display:"flex",paddingBottom:`${fe?L().ej:0}px`,flexDirection:"column",gap:24}})),[fe]),{open:Ce,openedFrom:we,recentPageStores:De,verifiedPageStores:ke,teamStores:Ae,workspaceUserStores:Te,connectedApps:Ue,trialEndData:Ne,modalState:Fe}=(0,o().O$)(U().L3),Le=(0,o().K8)((()=>{var e;return Boolean(null===(e=n.getSettings())||void 0===e?void 0:e.business_trial_ending_modal_last_shown_at)}),[n]),Re=(0,C()._3)({spaceId:t.id}),ze=(0,r().useElements)(),{hasPaymentMethod:Ke,accountBalance:$e,immediate:Oe,recurring:qe,nextBillingDate:Ve,subscriptionItems:Xe,monthlyUnitPrice:He,yearlyUnitPrice:Ye}=function(e){var t,n;let{billingData:r,environment:a,spaceId:s,selectedBillingInterval:o,prices:l}=e;const d=(0,O().Ry)(r)??"USD",c=(0,H().V)()??1,u=o??(0,O().q8)(r)??"month",m=(0,i.useMemo)((()=>[{price:(0,q().vk)(l,{product:"business",interval:u,currency:d}),quantity:c}]),[l,u,d,c]),p=(0,i.useMemo)((()=>(0,J().Dd)(d,{items:m,trialEnd:void 0})),[d,m]),g=(0,i.useMemo)((()=>m.map((e=>(0,Y().Kz)(e))).filter(X().O9)),[m]),{tax:h,isLoading:y}=(0,J().Fy)({environment:a,currencyCode:d,address:null==r?void 0:r.address,lineItems:g,taxableAmount:p,billingData:r}),v="admin"===(null==r?void 0:r.type)&&Boolean(r.paymentMethod),f=null==r||null===(t=r.accountBalances)||void 0===t?void 0:t.find((e=>e.currencyCode===d)),x=new(V().W)(d,(null==f?void 0:f.amount)??0),S={subtotal:p,tax:h,isLoading:y},b={subtotal:p,tax:h,isLoading:y},j="business",M={month:(0,W().H)({billingInterval:"month",priceStore:Z().A,products:[j]}),year:(0,W().H)({billingInterval:"year",priceStore:Z().A,products:[j]})},B=(0,G()._)({asyncPrice:M.month[j]}),_=(0,G()._)({asyncPrice:M.year[j]}),I=(null==r||null===(n=r.subscription)||void 0===n?void 0:n.currentPeriodEnd)??$().c9.now().plus({months:1});return{currencyCode:d,subtotal:p,lineItems:g,tax:h,isTaxLoading:y,hasPaymentMethod:v,accountBalance:x,immediate:S,recurring:b,nextBillingDate:I,subscriptionItems:m,monthlyUnitPrice:B,yearlyUnitPrice:_}}({billingData:Re,environment:k,spaceId:t.id,selectedBillingInterval:ge,prices:w}),Je=(0,r().useStripe)(),{handleUpgrade:We,error:Ge}=function(e){let{stripe:t,elements:n,environment:r,spaceStore:a,subscriptionItems:s,hasPaymentMethod:o}=e;const[l,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(),p=(0,c().tz)();return{handleUpgrade:async()=>{if(d(!0),ee().wD(r,{modalId:"trial_ending_modal"}),!t||!n)return(0,Q().log)({level:"error",from:"MidtermCheckoutModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}}),m(p.formatMessage({id:"spaceSubscriptionUpgradeModal.stripeNotLoaded",defaultMessage:"We could not reach our payment processor. Please reload the page or try again later."})),d(!1),{success:!1,error:u};let e;if(!o){const{error:i}=await n.submit();if(i)return ee().$X(r,{error:"could not submit form",error_type:"payment_method"}),{success:!1,error:i};const a=await t.createPaymentMethod({elements:n});if(a.error)return ee().$X(r,{error:a.error.message,error_type:"payment_method"}),{success:!1,error:a.error.message};if(!a.paymentMethod)return ee().$X(r,{error:"could not create token",error_type:"payment_method"}),{success:!1,error:"could not create token"};e={type:"paymentMethodId",value:a.paymentMethod.id}}try{const n=await(0,re().updateSubscription)({environment:r,from:"business_trial_ending_modal",spaceStore:a,desiredState:{items:s,trialEnd:void 0},paymentData:e});return await(0,re().handlePaymentIntentNextActions)({paymentIntentData:n,stripe:t,onSuccess:()=>{(0,re().refreshBillingHistory)(r,ne().w)}}),await te().A.awaitData(r,{spaceId:a.id}),{success:!0}}catch{return{success:!1,error:p.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})}}finally{d(!1)}},isSubmitting:l,error:u}}({stripe:Je,elements:ze,environment:k,spaceStore:t,subscriptionItems:Xe,hasPaymentMethod:Ke});(0,s().l)((()=>(0,f().u4)({environment:k,event:{eventName:"self_serve_business_trial_ending_modal_viewed",eventProperties:{from:we}}}))),(0,i.useEffect)((()=>{"trial_ended_notification"!==we||Le||m().Z1(k)}),[k,Le,we]);const Ze=(0,o().K8)((()=>(0,p().wd)()),[]),Qe=(0,M().U)(),et=(0,T().a)(n),tt=(0,S().H)({spaceStore:t}),nt=(0,i.useMemo)((()=>tt.loading?[]:tt.members),[tt]),rt=se,it=function(e){let{spaceId:t,userId:n}=e;const r=(0,a().v3)(),[s,o]=(0,i.useState)(null);return(0,i.useEffect)((()=>{(async()=>{if(!n)return;const e=await A().callApi({environment:r,eventName:"getSpaceBusinessTrialEndData",data:{spaceId:t,userId:n}});"failed"!==e.type&&o(e.data)})()}),[r,t,n]),s}({spaceId:t.id,userId:Pe}),at=(0,i.useMemo)((()=>({connectedApps:Ue??Ze,teamStores:Ae??Qe,userStores:Te??nt,newPageStores:De??rt,verifiedPageStores:ke??et,trialEndData:Ne??it})),[Ue,Ze,Ae,Qe,Te,nt,De,rt,ke,et,Ne,it]),st=(0,z().so)(at),ot=(0,o().K8)((()=>(0,z().is)(st,at)),[at,st]),lt=(0,o().K8)((()=>{const e=["top-left","top-right","bottom-left","bottom-right"];return ot.map(((t,n)=>{const{component:r,getCount:i}=R().j[t],{trialEndData:a,...s}=at;return(0,ie.jsx)(r,{placement:e[n],countFromUsageData:i(at),...s},t)}))}),[at,ot]),dt=(0,D().g)({spaceId:t.id}),ct=lt.length<ae,{title:ut,highlightIndex:mt,timelineItems:pt}=(0,z().PA)(dt,Re),gt=async()=>{if("initial"===Fe)U().L3.update((e=>({...e,modalState:"clickedPrimaryButton"})));else{ve(void 0);const e=Ie();if(!(0,u().Im)(e))return;const{success:t}=await We();t&&(0,B().closeSelfServeBusinessTrialEndingModal)()}},ht=()=>{(0,B().closeSelfServeBusinessTrialEndingModal)(),"clickedPrimaryButton"===Fe&&(0,B().openSelfServeBusinessTrialLossAversionModal)({openedFrom:"business_trial_ending_modal",onSecondaryButtonClick:()=>(0,B().openSelfServeBusinessTrialEndingModal)({openedFrom:"self_serve_business_trial_loss_aversion_modal",modalState:"clickedPrimaryButton"})})},[yt,vt]=(0,i.useState)(!1);return(0,ie.jsx)(y().s,{isOpen:Ce,onClosed:B().closeSelfServeBusinessTrialEndingModal,areaConstraint:{width:{type:"min",length:L().c4}},render:()=>(0,ie.jsx)("div",{style:{overflow:"auto",position:"relative"},children:(0,ie.jsx)(N().P,{handleClose:B().closeSelfServeBusinessTrialEndingModal,primaryButtons:[{label:"clickedPrimaryButton"===Fe?(0,ie.jsx)(c().sA,{id:"selfServeBusinessTrialEndingModal.button.confirm",defaultMessage:"Confirm upgrade"}):(0,ie.jsx)(c().sA,{id:"selfServeBusinessTrialEndingModal.button.submit",defaultMessage:"Keep using Business"}),onClick:gt}],secondaryButtons:[{label:"clickedPrimaryButton"===Fe?(0,ie.jsx)(c().sA,{id:"selfServeBusinessTrialEndingModal.button.nevermind",defaultMessage:"Never mind"}):(0,ie.jsx)(c().sA,{id:"selfServeBusinessTrialEndingModal.button.close",defaultMessage:"Go back to Plus"}),onClick:ht}],title:(0,ie.jsx)(c().sA,{...ut}),timeline:{highlight:{index:mt,color:"uiBluePrimary",backgroundColor:Ee.iconBackground.backgroundColor},timelineItems:pt},leftPanel:Re&&"clickedPrimaryButton"===Fe?(0,ie.jsx)("div",{style:{flex:1,position:"relative",height:Be},children:Ke?(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(v().EE,{onSizeChange:e=>{let{height:t}=e;return Me(t)},children:(0,ie.jsx)("div",{style:Ee.billingDetailsContainer,children:(0,ie.jsx)(I().I,{billingData:Re})})}),(0,ie.jsx)(v().EE,{onSizeChange:e=>{let{height:t}=e;return be(t)},children:(0,ie.jsx)("div",{style:Ee.footerContainer,children:(0,ie.jsx)(P().J,{immediate:Oe,recurring:qe,accountBalance:$e,items:Xe,nextBillingDate:Ve,chargeType:{chargeType:"immediate"},modalId:"trial_ending_modal",isExpanded:yt,setIsExpanded:vt})})})]}):(0,ie.jsx)(h().D,{styleName:"UIRegular-14px/Regular",children:(0,ie.jsx)(c().sA,{id:"selfServeBusinessTrialEndingModal.noPaymentMethod",defaultMessage:"Add a payment method to continue using the Business plan"})})}):null,rightPanel:(0,ie.jsx)("div",{style:Ee.rightPanel,children:Ke||"initial"===Fe?ct?(0,ie.jsx)(K().O,{}):(0,ie.jsx)(F().a,{gridTemplateAreas:'\n\t\t\t\t\t\t\t\t\t\t\t"top-left top-right"\n\t\t\t\t\t\t\t\t\t\t\t"bottom-left bottom-right"\n\t\t\t\t\t\t\t\t\t\t',children:lt}):(0,ie.jsx)("div",{style:Ee.paymentFieldsContainer,children:(0,ie.jsxs)(g().Y1,{gap:24,direction:"vertical",width:"fill",children:[(0,ie.jsx)("div",{style:Ee.billingIntervalContainer,children:(0,ie.jsx)(_().TJ,{selectedBillingInterval:ge,onChange:he,monthlyUnitPrice:He,yearlyUnitPrice:Ye,direction:"horizontal"})}),(0,ie.jsx)(_().ck,{formData:ce,onChangeFormData:_e,errors:me,modalId:oe}),(0,ie.jsx)(E().q,{modalId:oe}),Ge?(0,ie.jsx)(h().D,{styleName:"Caption-12px/Regular",colorName:"uiRedPrimary",children:Ge}):null]})})})})})})}}}]);