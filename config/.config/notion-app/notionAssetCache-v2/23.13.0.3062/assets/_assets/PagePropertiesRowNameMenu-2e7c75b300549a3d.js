"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[1423,90871],{26517:(e,t,o)=>{o.d(t,{Wf:()=>g,YB:()=>y,aj:()=>f,f3:()=>h,qg:()=>v});o(898992),o(354520),o(581454),o(296540);var n=()=>o(401497),i=()=>o(651124),a=()=>o(959013),r=()=>o(449195),l=()=>o(722872),s=()=>o(760217),c=()=>o(928600),u=()=>o(939740),d=()=>o(89924),p=()=>o(74263),m=o(474848);function y(e){const{currentVisibility:t,propertySchema:o,onSelect:n,onClose:l}=e;let s=[...i().vj];s=s.filter((e=>"section"!==e)),(0,r()._f)({propertySchema:o})||(s=s.filter((e=>"hide_if_empty"!==e)));const c=s.map((e=>({visibility:e,label:(0,m.jsx)(a().sA,{...p().gY[e]})})));return(0,m.jsx)(_,{currentVisibility:t,visibilityLevelsWithLabels:c,onSelect:n,onClose:l})}function f(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,i=(0,r().SB)(t),l=["always_show","section_collapsed","section_hide"].map((e=>({visibility:e,label:(0,m.jsx)(a().sA,{...p().vG[e]})})));return(0,m.jsx)(_,{currentVisibility:i,visibilityLevelsWithLabels:l,onSelect:o,onClose:n})}function g(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,r=i().OA.filter((e=>"section_hide"!==e)).map((e=>({visibility:e,label:(0,m.jsx)(a().sA,{...p().wV[e]})}))),l="section_hide"===t?void 0:t;return(0,m.jsx)(_,{currentVisibility:l,visibilityLevelsWithLabels:r,onSelect:o,onClose:n})}function v(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,r=i().qG.filter((e=>"section_collapsed"!==e)).map((e=>({visibility:e,label:(0,m.jsx)(a().sA,{...p().Bb[e]})}))),l="section_collapsed"===t?"section_show":t;return(0,m.jsx)(_,{currentVisibility:l,visibilityLevelsWithLabels:r,onSelect:o,onClose:n})}function h(e){const{currentVisibility:t,onSelect:o,onClose:n}=e,r=i().RL.map((e=>({visibility:e,label:(0,m.jsx)(a().sA,{...p().PP[e]})})));return(0,m.jsx)(_,{currentVisibility:t,visibilityLevelsWithLabels:r,onSelect:o,onClose:n})}function _(e){const{currentVisibility:t,visibilityLevelsWithLabels:o,onSelect:n,onClose:i}=e,a=o.map((e=>{let{visibility:o,label:a}=e;return{key:o,render:e=>(0,m.jsx)(M,{buttonMenuItemProps:e,isChecked:o===t,label:a}),action:()=>{n(o),i&&i()}}})),r=[{key:"visibilityLevels",render:e=>(0,m.jsx)(d().A,{...e,topBorder:0!==e.index}),items:a}],s={menuType:l().gu.Popup,width:"auto",maxWidth:360};return(0,m.jsx)(c().A,{...s,children:(0,m.jsx)(u().Ay,{type:u().Oh.Vertical,initialFocus:void 0,sections:r})})}function M(e){const{buttonMenuItemProps:t,label:o,isChecked:i}=e,a=(0,n().IS)((()=>({title:{display:"flex",alignItems:"center",width:150}})),[]),r=(0,m.jsx)("div",{style:a.title,children:o});return(0,m.jsx)(s().A,{...t,textWrapperStyle:{marginRight:0},title:r,isChecked:i})}},74263:(e,t,o)=>{o.d(t,{Bb:()=>a,PP:()=>l,gY:()=>m,vG:()=>c,wV:()=>d});var n=()=>o(959013);const i=(0,n().YK)({expanded:{id:"customizePageMenuVisibilitySelect.expanded.label",defaultMessage:"Expanded"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),a={section_show:i.expanded,section_collapsed:i.expanded,section_hide:i.off},r=(0,n().YK)({default:{id:"customizePageMenuVisibilitySelect.default.label",defaultMessage:"Default"},minimal:{id:"customizePageMenuVisibilitySelect.minimal.label",defaultMessage:"Minimal"}}),l={inline:r.default,minimal:r.minimal},s=(0,n().YK)({showOnHover:{id:"visibilityLevelMessages.backlinksPageSection.showOnHover",defaultMessage:"Show on hover"},alwaysShow:{id:"visibilityLevelMessages.backlinksPageSection.alwaysShow",defaultMessage:"Always show"},off:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"}}),c={always_show:s.alwaysShow,section_show:s.showOnHover,section_collapsed:s.showOnHover,section_hide:s.off,inline:s.off,minimal:s.off},u=(0,n().YK)({asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"},minimal:{id:"visibilityLevelMessages.propertyPageSection.minimal",defaultMessage:"Minimal"}}),d={inline:u.asPageSection,minimal:u.minimal},p=(0,n().YK)({alwaysShow:{id:"customizePageMenuVisibilitySelect.show.label",defaultMessage:"Always show"},alwaysHide:{id:"customizePageMenuVisibilitySelect.hide.label",defaultMessage:"Always hide"},hideWhenEmpty:{id:"customizePageMenuVisibilitySelect.hideIfEmpty.label",defaultMessage:"Hide when empty"},asPageSection:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"}}),m={show:p.alwaysShow,hide:p.alwaysHide,hide_if_empty:p.hideWhenEmpty,section:p.asPageSection}},89849:(e,t,o)=>{o.r(t),o.d(t,{eyeIcon:()=>a,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_9098_13290)",children:[(0,n.jsx)("path",{d:"M10 13.504a3.5 3.5 0 1 0-.001-7.002A3.5 3.5 0 0 0 10 13.504m1.167-3.502a1.168 1.168 0 1 1-2.335.002 1.168 1.168 0 0 1 2.335-.002"}),(0,n.jsx)("path",{d:"M10 3.895c-4.093 0-7.662 2.189-9.351 5.408-.231.44-.231.964 0 1.404 1.689 3.22 5.258 5.408 9.351 5.408s7.662-2.189 9.351-5.408c.231-.44.231-.964 0-1.404-1.689-3.22-5.258-5.408-9.351-5.408m-8.245 5.99C3.218 7.096 6.347 5.144 10 5.144s6.782 1.952 8.245 4.74a.26.26 0 0 1 0 .24c-1.463 2.788-4.592 4.74-8.245 4.74s-6.782-1.952-8.245-4.74a.26.26 0 0 1 0-.24"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_9098_13290",children:(0,n.jsx)("path",{d:"M0 0h20v20H0z"})})})]})},a=(0,o(340498).wt)("eye",i)},167170:(e,t,o)=>{o.d(t,{_:()=>i});o(296540);const n={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},i=(0,o(340498).wt)("layout",n)},175213:(e,t,o)=>{o.d(t,{G:()=>a});var n=()=>o(989423),i=()=>o(508496);function a(e,t){n().vd(e,"delete_property",t),i().default.logEvent("delete_property")}},241319:(e,t,o)=>{o.d(t,{y:()=>a});o(898992),o(672577);var n=()=>o(534177),i=()=>o(977345);function a(e){var t;const{actionModels:o,id:a}=e,r=(0,i().y5)(a),l="action"===r.source?o.find((e=>e.id===r.action_id)):void 0,s=(0,n().O9)(l)&&l.isType("create_page")?null===(t=l.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:r,collectionPointer:s,actionModel:l}}},299177:(e,t,o)=>{o.d(t,{A:()=>a});class n extends(()=>o(757695))().default{getInitialState(){return{}}}const i=new n;o(604341).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const a=i},301782:(e,t,o)=>{o.d(t,{CM:()=>p,UB:()=>d,zc:()=>u});o(898992),o(354520),o(581454);var n=()=>o(890409),i=()=>o(973647),a=()=>o(534177),r=()=>o(862292),l=()=>o(989423),s=()=>o(909470),c=()=>o(546461);function u(e){const{automationActionStore:t,automationStore:o,formulaAnalyticsModule:r,formulasModule:l,simpleFormulasModule:u}=e,d=t.getModel(),p=o??t.getParentStore();if(!d||!p)return;const m=p.getActionStores().map((e=>e.getModel())).filter(a().O9),y=(0,c().To)(p);let f=[];return y&&i().Q.isSuccess(y)&&(f=y.value.valueTypes),(0,n()._f)({automationActionModel:d,automationActionModels:m,formulaAnalyticsModule:r,formulasModule:l,simpleFormulasModule:u,formulaTypecheckContextValues:f,getRecordModel:t.getRecordModel,featureGates:(0,s().i)()})}function d(e,t){const{automationStore:o,automationActionStore:n}=t;o.isTriggerType("event")||p(((t,i,a)=>{const r=u({automationActionStore:n,automationStore:o,formulaAnalyticsModule:i,formulasModule:t,simpleFormulasModule:a});r&&(0,l().pM)(e,"automation_action_update",n.id,1,{automation_action:r,automation_action_id:n.id,automation_id:o.id})}))}function p(e){return Promise.all([r().T.formulas.load(),r().T.formulaAnalytics.load(),r().T.simpleFormulas.load()]).then((t=>{let[o,n,i]=t;e(o,n,i)})).catch((e=>{console.error("Error sending analytics for automations",e)}))}},324587:(e,t,o)=>{o.r(t),o.d(t,{addAutomationAction:()=>U,clearInvalidVariables:()=>K,createAutomation:()=>B,deleteAutomation:()=>J,disableAutomation:()=>Z,duplicateAutomation:()=>L,duplicateAutomationAction:()=>z,enableAutomation:()=>Q,insertEmptyTextInDuplicateBlockAction:()=>Y,messages:()=>F,removeAutomationAction:()=>G,reorderAutomationActions:()=>H,restartAutomation:()=>W});o(16280),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454);var n=o.n(o(794148)),i=()=>o(244641),a=()=>o(908006),r=()=>o(422540),l=()=>o(890409),s=()=>o(192845),c=()=>o(390527),u=()=>o(522328),d=()=>o(433519),p=()=>o(247331),m=()=>o(134025),y=()=>o(696706),f=()=>o(912720),g=()=>o(199378),v=()=>o(161479),h=()=>o(919709),_=()=>o(496603),M=()=>o(183558),b=()=>o(973647),S=()=>o(534177),A=()=>o(722101),C=()=>o(44729),x=()=>o(246826),T=()=>o(725614),w=()=>o(751156),k=()=>o(780054),P=()=>o(183324),I=()=>o(989423),R=()=>o(909470),E=()=>o(594794),O=()=>o(695625),V=()=>o(546461),D=()=>o(301782),j=()=>o(770586),N=()=>o(190019);const F=(0,o(959013).YK)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function B(e){const{actionIds:t,automationId:o,automationName:i,environment:a,inMemoryRecordCache:r,parentPointer:l,transaction:s,trigger:c}=e,u=o??(0,E().Z1)({environment:a,table:f().yB,spaceId:l.spaceId}),d=x().eC({environment:a,inMemoryRecordCache:r??a.defaultRecordCache.inMemoryRecordCache,table:f().yB,transaction:s,value:{action_ids:t,alive:!0,id:u,parent_id:l.id,parent_table:l.table,properties:{name:i},space_id:l.spaceId,status:"active",trigger:c}});return n()(d.isTriggerType(c.type),"Trigger type mismatch"),d}function U(e){const{actionId:t,environment:o,intl:i,automationStore:r,actionType:s,transaction:c,insertionPoint:u,config:d,createDuplicateBlocksContainer:p=!0,builderType:m="sidebar"}=e,v=r.getSpaceId();if(!v)return;let _;if("duplicate_blocks"===s&&p){_=x().Wv({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,transaction:c,type:"text"});const e=Y({environment:o,contentStore:_.getContentStore(),transaction:c});a().default.afterNextFlush((()=>{const t=O().T.find((t=>y().L3.isEqual(t.props.store.pointer,e.pointer)));t&&T().setSelectionAtStart({store:t.props.store.getBlockTitleStore()})}))}const b=d??function(e){const{actionType:t,automationStore:o,intl:n}=e;if("modal_confirmation"===t)return{continue_button:{text:n.formatMessage(F.defaultContinueWorkflowMessage)},cancel_button:{text:n.formatMessage(F.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,h().x9d)(n.formatMessage(F.defaultConfirmationWorkflowText))}};if("define_variables"===t){const e=(0,M().Ay)();return{values:{[e]:{name:(0,j().v)(o.getActionStores(),n.formatMessage(g().xC)),value:{type:"simple",value:[[""]]}}},variableIds:[e]}}}({actionType:s,automationStore:r,intl:i})??{},C=x().eC({environment:o,inMemoryRecordCache:r.inMemoryRecordCache,table:g().SC,transaction:c,value:{id:t,type:s,parent_id:r.id,parent_table:f().yB,alive:!0,space_id:v,config:b,blocks:_?[_.id]:[]}});return _&&A().BC({transaction:c,parentStore:C.getKeyStore("blocks"),appendStore:_}),!u||"afterActionId"in u?A().BC({transaction:c,parentStore:r.getActionIdsStore(),appendStore:C,after:null==u?void 0:u.afterActionId}):"beforeActionId"in u?A().Hs({transaction:c,parentStore:r.getActionIdsStore(),prependStore:C,before:u.beforeActionId}):(0,S().HB)(u),q({transaction:c,automationStore:r}),(0,D().CM)(((e,t,n)=>{const i=(0,I().ik)(o),a=(0,D().zc)({automationActionStore:C,formulaAnalyticsModule:t,formulasModule:e,simpleFormulasModule:n});(0,S().O9)(a)&&(0,l().dW)(i,{automation_action:a,automation_action_id:C.id,automation_id:C.getParentId(),builder_type:m}),C.isDefined()&&(0,l().c_)(i,{automation_action_id:C.id,automation_action_type:C.getType(),automation_id:r.id,builder_type:m})})),n()(C.isType(s),"Action type mismatch"),C}function W(e){var t,o;const{automationStore:n,transaction:a}=e,r=n.getRecurrence();if(!r)return;const l=i().c9.now().plus({day:1}).startOf("day"),s={...r,start_date:l.toMillis(),end_condition:"date"===(null===(t=r.end_condition)||void 0===t?void 0:t.type)?{type:"date",end_at:(0,c().getNewEndTimestamp)(l,r.start_date,null===(o=r.end_condition)||void 0===o?void 0:o.end_at).toMillis()}:r.end_condition};x().zv({store:n,transaction:a,data:{status:"active"}}),x().zv({store:n.getKeyStore("trigger"),transaction:a,data:{recurrence:(0,c().convertFromUnpersistedRecurrenceConfig)(s)}})}function L(e){const{actorPointer:t,environment:o,includeParenting:n,sourceAutomationStore:i,targetAutomationId:a,transaction:r}=e,l=i.getParentStore();if(!l||!l.isReady())throw new Error("Automation parent store not ready");const s=i.getValue(),c=i.getSpaceId();if(!(0,S().O9)(s)||!(0,S().O9)(c))throw new Error("Undefined automation value or space id");const u={},p={...(0,_().mg)(s),id:a??(0,E().Z1)({environment:o,table:f().yB,spaceId:(0,v().e)(c)})};u[i.id]=p.id,(0,S().O9)(p.action_ids)&&(0,S().EI)(p.action_ids)&&p.action_ids.forEach((e=>u[e]=(0,E().Z1)({environment:o,table:g().SC,spaceId:(0,v().e)(c)})));const m=e=>{let{requested:t}=e;const o=u[t.id];return(0,S().O9)(o)?{...t,id:o}:t};(0,d().i)({actor:t,duplicateRecord:p,options:{},mapper:m,originalRecord:s});const y=x().eC({environment:o,inMemoryRecordCache:i.inMemoryRecordCache,table:f().yB,transaction:r,value:p});n&&C().NI({childStore:y,parentStore:l,transaction:r});const h=i.getActionStores(),M=Promise.all(h.map((e=>{const t=u[e.id],{automationActionStore:n,onComplete:i}=z({environment:o,includeParenting:!1,mapper:m,sourceActionStore:e,targetAutomationActionId:t,transaction:r});return C().NI({childStore:n,parentStore:y,transaction:r}),i}))),b=M.then((e=>e.flat()));return{automationStore:y,onComplete:b}}function z(e){const{environment:t,includeParenting:o,insertionPoint:n,mapper:i,sourceActionStore:a,targetAutomationActionId:r,transaction:s}=e,c=a.getParentStore();if(!c||!c.isReady())throw new Error("Automation store is not ready");const d=a.getValue(),p=a.getSpaceId();if(!(0,S().O9)(d)||!(0,S().O9)(p))throw new Error("Undefined action value or space id");const m={...(0,_().mg)(d),id:r??(0,E().Z1)({environment:t,table:g().SC,spaceId:(0,v().e)(p)})},y=t.currentUser.id,f=a.inMemoryRecordCache.makeGetRecordRoleFn(y);(0,u().I)({duplicateRecord:m,getRecordRole:f,originalRecord:d,mapper:e=>(null==i?void 0:i(e))??e.requested,options:{},originOptions:{baseUrl:k().A.domainBaseUrl,publicDomainName:k().A.publicDomainName},duplicateBlocks:!1});const h=x().eC({environment:t,inMemoryRecordCache:a.inMemoryRecordCache,table:g().SC,transaction:s,value:m});o&&(!n||"afterActionId"in n?C().NI({after:null==n?void 0:n.afterActionId,childStore:h,parentStore:c,transaction:s}):"beforeActionId"in n?C().Ti({before:null==n?void 0:n.beforeActionId,childStore:h,parentStore:c,transaction:s}):(0,S().HB)(n),q({transaction:s,automationStore:c}));const M=Promise.all(a.getBlockStores().map((e=>{const{blockStores:o,onComplete:n}=P().duplicateBlock({environment:t,preferDuplicateLocation:"local",stores:[e],targetSpaceId:(0,v().e)(e.pointer.spaceId),transaction:s,options:{addCopyName:!1,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1}}),i=o[0];return C().NI({childStore:i,parentStore:h,transaction:s}),n}))),b=h.getModel();return(0,S().O9)(b)&&(0,D().CM)(((e,o,n)=>{const i=(0,I().ik)(t),a=(0,D().zc)({automationActionStore:h,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:n});(0,S().O9)(a)&&(0,l().dW)(i,{automation_action:a,automation_action_id:b.id,automation_id:b.parent_id,from:"duplicate"}),(0,l().c_)(i,{automation_action_id:b.id,automation_action_type:b.type,automation_id:c.id,from:"duplicate"})})),{automationActionStore:h,onComplete:M}}function H(e){const{automationStore:t,automationTypecheckModule:o,contextType:n,environment:i,formulasModule:a,from:r,intl:l,isSubscribed:s,movedActionId:c,newActionIds:u,transaction:d}=e;x().zv({store:t,transaction:d,data:{action_ids:u}}),q({automationStore:t,transaction:d});$({automationStore:t,transaction:d,typecheckResult:(0,N().Z)({environment:i,automationStore:t,automationTypecheckModule:o,contextType:n,formulasModule:a,intl:l,isSubscribed:s})}),(0,I().u4)({environment:i,event:{eventName:"automation_action_move",eventProperties:{automation_id:t.id,automation_action_id:c,from:r}}})}function G(e){const{actionStore:t,automationStore:o,automationTypecheckModule:n,contextType:i,environment:a,formulasModule:r,intl:s,isSubscribed:c,transaction:u}=e,d=(0,N().Z)({environment:a,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:r,intl:s,isSubscribed:c});!function(e){const{automationActionStore:t,automationStore:o,environment:n,transaction:i,hasError:a=!1}=e;let r=t.getParentStore();if((0,S().O9)(o)){const e=t.getParentPointer();if(!(0,S().O9)(e))throw new Error("Automation action does not have a parent pointer");if(!y().L3.isEqual(e,o.pointer))throw new Error(`Automation action parent pointer does not match argument: ${y().L3.toKey(e)}, ${y().L3.toKey(o.pointer)}`);r=o}else if(!(0,S().O9)(r))throw new Error("Automation store is undefined");C().zz({childStore:t,parentStore:r,transaction:i});const s=t.getModel();(0,S().O9)(s)&&(0,D().CM)(((e,o,i)=>{const c=(0,I().ik)(n),u=(0,D().zc)({automationActionStore:t,formulaAnalyticsModule:o,formulasModule:e,simpleFormulasModule:i});(0,S().O9)(u)&&(0,l().YO)(c,{automation_action:u,automation_action_id:s.id,automation_id:s.parent_id,has_error:a}),(0,l().gW)(c,{automation_action_id:s.id,automation_action_type:s.type,automation_id:r.id,has_error:a})}))}({automationActionStore:t,environment:a,transaction:u,hasError:(b().Q.isSuccess(d)&&d.value.actionValidationFailures[t.id]||[]).length>0}),$({automationStore:o,transaction:u,typecheckResult:d})}function K(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,isSubscribed:l,transaction:s}=e;$({automationStore:o,transaction:s,typecheckResult:(0,N().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:r,isSubscribed:l})})}function q(e){const{automationStore:t,transaction:o}=e;t.getSpaceId()&&t.getActionStores().forEach(((e,t)=>{var n;if(!e.isDefined())return;const i=e.getModel();i.isType("open_page")&&"url"===(null===(n=i.getConfig())||void 0===n||null===(n=n.target)||void 0===n?void 0:n.type)&&!(0,r().cQ)(t)&&x().zv({store:e.getConfigStore(),transaction:o,data:{target:null}})}))}function $(e){const{automationStore:t,transaction:o,typecheckResult:n}=e,i=t.getSpaceId(),a=t.getModel();if(i&&a&&!b().Q.isFail(n))for(const r of a.getActionIds()){const e=t.getRecordStore(t,{table:g().SC,id:r,spaceId:i});if(!e.isDefined())continue;const a=e.getModel(),l=new Set(n.value.actionInputValueTypes[r].map((e=>{if(e.kind===p().FormulaContextValueKind.Binding||e.kind===p().FormulaContextValueKind.ContextValue)return e.id;e.kind!==p().FormulaContextValueKind.ThisRow&&(0,S().HB)(e)})).filter(S().O9)),{value:c}=(0,s().G)({automationActionModel:a,baseUrl:k().A.domainBaseUrl,preventClearingConfig:!0,publicDomainName:k().A.publicDomainName,sourceSpaceId:i,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:void 0,visitFormulaContextValue:e=>l.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormulaPageProperty:void 0,visitRecordPointer:void 0}}),u=m().op.update({pointer:e.pointer,path:["config"],args:c.getConfig()??{}});w().applyOperation({store:e,operation:u,transaction:o})}}function Y(e){const{environment:t,contentStore:o,transaction:n}=e,i=x().Wv({environment:t,type:"text",inMemoryRecordCache:o.inMemoryRecordCache,transaction:n,spaceId:o.pointer.spaceId});return A().BC({parentStore:o,appendStore:i,transaction:n}).childStore}function Q(e){const{automationStore:t,environment:o,transaction:n}=e;x().zv({store:t,data:{status:"active"},transaction:n});const i=t.getModel();(0,S().O9)(i)&&(0,D().CM)(((e,n,a)=>{const r=(0,V().To)(t);let s=[];r&&b().Q.isSuccess(r)&&(s=r.value.valueTypes);const c=(0,I().ik)(o),u=(0,l().sp)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:a});(0,l().Ah)(c,u)}))}function Z(e){const{automationStore:t,environment:o,status:n,transaction:i}=e,a=n??"disabled";x().zv({store:t,data:{status:a},transaction:i}),t.isTriggerType("recurrence")&&x().zv({store:t,data:{run_at:void 0},transaction:i});const r=t.getModel();(0,S().O9)(r)&&(0,D().CM)(((e,n,i)=>{const a=(0,V().To)(t);let s=[];a&&b().Q.isSuccess(a)&&(s=a.value.valueTypes);const c=(0,I().ik)(o),u=(0,l().sp)({automationModel:r,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:i});(0,l().vN)(c,u)}))}function J(e){const{automationStore:t,environment:o,transaction:n}=e;x().zv({store:t,data:{alive:!1},transaction:n});const i=t.getModel();(0,S().O9)(i)&&(0,D().CM)(((e,n,a)=>{const r=(0,V().To)(t);let s=[];r&&b().Q.isSuccess(r)&&(s=r.value.valueTypes);const c=(0,I().ik)(o),u=(0,l().sp)({automationModel:i,formulaAnalyticsModule:n,formulasModule:e,formulaTypecheckContextValues:s,getRecordModel:t.getRecordModel,featureGates:(0,R().i)(),simpleFormulasModule:a});(0,l().Iv)(c,u)}))}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>R,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>A,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>S,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>h,RRULE_WEEKDAYS_MAP:()=>g,adjustedStartDateIfPossible:()=>x,areRecurrenceSchedulesEqual:()=>j,convertFromUnpersistedRecurrenceConfig:()=>D,convertToUnpersistedRecurrenceConfig:()=>E,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>P,getNewEndTimestamp:()=>O,getNextDateUtc:()=>k,getRecurrenceAfter:()=>T,isRunningBetweenMidnightAnd3AM:()=>w,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>M,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>C});o(898992),o(354520),o(581454);var n=()=>o(244641);o(944114);function i(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(0===o.length)return e.map((e=>[e]));const a=[];for(const r of e)a.push(...i(o[0],...o.slice(1)).map((e=>[r,...e])));return a}var a=()=>o(496603),r=()=>o(534177),l=()=>o(720665),s=()=>o(597777),c=()=>o(869190),u=()=>o(416504),d=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const y=(0,o(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),f={day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},g={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},v=99,h=999;function _(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function M(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=h}function b(e){const{start_date:t,frequency:o,interval:n,weekdays:a,timezone:l,hour:c,minute:u}=e,d="week"===o&&a?a.map((e=>g[e])):void 0,m={};return(0,r().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,s().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,r().HB)(e.end_condition)),"month"===e.frequency&&(0,r().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=i(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,o]=e;return g[t].nth(o)})):(0,r().HB)(e.monthly_restriction)),new p({freq:f[o],dtstart:(0,s().eU)(t),interval:n,byweekday:d,tzid:l,byhour:c??0,byminute:u??0,bysecond:0,...m})}const S=1,A=1;function C(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=n>S,r=o.length>=A;return{violatesConstraint:a||r,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:r,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:i}}function x(e){var t;const{recurrence:o,afterDate:i}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=i)return o;let a=n().c9.fromMillis(o.start_date,{zone:"utc"});const r=n().c9.fromMillis(i,{zone:"utc"});switch(o.frequency){case"year":{const e=Math.floor(r.diff(a,"years").years/o.interval);a=a.plus({years:e*o.interval});break}case"month":{const e=Math.floor(r.diff(a,"months").months/o.interval);a=a.plus({months:e*o.interval});break}case"week":{const e=Math.floor(r.diff(a,"weeks").weeks/o.interval);a=a.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(r.diff(a,"days").days/o.interval);a=a.plus({days:e*o.interval});break}}return{...o,start_date:(0,s().DH)(a.toMillis())}}function T(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,s().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(x({recurrence:t,afterDate:o})).after((0,s().eU)(o));if(!e)return;return(0,s().h1)(e)}}function w(e){return 0===e.hour||1===e.hour||2===e.hour}function k(e){return b(e).after((0,s().eU)((0,s().Rz)()))||void 0}function P(e){const{recurrence:t,intl:o}=e,i=k(D(t));if(!i)return;const a=w(t),r=n().c9.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(o)).setZone(t.timezone),l=(0,c().Yq)({date:r,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(a)return o.formatMessage(y.dateBetweenMidnightAnd3AM,{date:l});{let e=r.toLocaleString(n().c9.TIME_SIMPLE);return t.timezone!==(0,u().P)()&&(e+=` ${r.toFormat("ZZZZ")}`),o.formatMessage(y.dateAtTime,{date:l,time:e})}}function I(e,t){return(0,r().O9)(e)?"number"===e.type?t.formatMessage(y.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,c().Yq)({date:n().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,r().HB)(e):t.formatMessage(y.noEndCondition)}const R=100;function E(e){return{...e,start_date:(0,s().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().l1)(e.end_condition.end_at)}:(0,r().HB)(e.end_condition):void 0}}function O(e,t,o){return e.plus(o-t)}function V(e,t){const o=n().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Rz)(o.toJSDate())}}function D(e){return{...e,start_date:(0,s().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?V(e,e.end_condition):(0,r().HB)(e.end_condition):void 0}}function j(e,t){const o=a().fN(e,(e=>void 0!==e)),n=a().fN(t,(e=>void 0!==e));return a().n4(o,n)}},422540:(e,t,o)=>{o.d(t,{$0:()=>g,Fx:()=>A,Ge:()=>m,I3:()=>d,Kj:()=>b,PP:()=>C,TK:()=>x,Yy:()=>u,aE:()=>T,cQ:()=>S,kH:()=>y,m7:()=>p,nq:()=>_,nv:()=>v,tj:()=>f});o(898992),o(354520),o(737550);var n=()=>o(496603),i=()=>o(534177),a=()=>o(970013),r=()=>o(651124),l=()=>o(349835),s=()=>o(390066);(0,i().u0)((e=>(0,i().O9)(e)&&(0,i().O9)(e.target)&&(0,i().O9)(e.external_bot_id)?{true:{external_bot_id:e.external_bot_id,target:e.target,custom_message:e.custom_message}}:{false:e}));const c={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1},u={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function d(e){return Boolean(c[e.type]&&!(0,a().UU)(e)&&(!(0,a().$M)(e)||void 0===(0,a().om)(e)))}function p(e){const{collectionFormat:t,collectionSchema:o,filter:l,sort:c,sourcePropertyIds:u}=e,p=(u??(0,i().uv)(o)).filter(((t,n,i)=>{const r=o[t];return!(!r||!d(r))&&(("relation"!==r.type||!e.restrictCrossSpace||!(0,a().o2)(e.spaceId,r))&&(!l||l([t,r],n,o)))}));if(0===p.length)return[];if(!t||!1===c)return p;const m=(0,s().L)(t,o,void 0,r().jf.Page).collection_page_properties||[];return n().Ul(p,(e=>m.findIndex((t=>t.property===e))))}function m(e){const{collectionFormat:t,collectionSchema:o,sort:l}=e,c=(0,i().uv)(o).filter(((e,t,n)=>{const i=o[e];return!(!i||!(0,a().JY)(i))}));if(0===c.length)return[];if(!t||!1===l)return c;const u=(0,s().L)(t,o,void 0,r().jf.Page).collection_page_properties||[];return n().Ul(c,(e=>u.findIndex((t=>t.property===e))))}function y(e){return e.type===l().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===l().M9.TokenExpected?{type:e.type,token:e.token}:e.type===l().uW.MissingSchemaPropertyOnThisRow||e.type===l().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection}:e.type===l().uW.MissingContextVariable?{type:e.type,valueId:e.valueId}:e.type===l().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments}:e.type===l().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex}:e.type===l().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex}:e.type===l().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node}:e.type===l().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer}:e.type===l().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection}:e.type===l().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property}:e.type===l().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType}:e.type===l().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes}:e.type===l().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name}:{type:e.type}}const f={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,geo_point:!1};function g(e){return Boolean(f[e.type])}function v(e){const{collectionFormat:t,collectionSchema:o,filter:l,sort:c}=e,u=(0,i().uv)(o).filter(((e,t,n)=>{var i;const r=o[e];return!(!r||!f[r.type])&&((!(0,a().$M)(r)||null===(i=(0,a().om)(r))||void 0===i||!i.auto_update_on_edit)&&(!l||l([e,r],t,o)))}));if(0===u.length)return[];if(!t||!1===c)return u;const d=(0,s().L)(t,o,void 0,r().jf.Page).collection_page_properties||[];return n().Ul(u,(e=>d.findIndex((t=>t.property===e))))}const h={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function _(e){return h[e.type]}const M={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,geo_point:!1};function b(e){return M[e.type]}function S(e){return 0===e}function A(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function C(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function x(e){const{collectionSchema:t,property:o,type:n}=e,i=null==t?void 0:t[o];return!i||("action"===n?!d(i):!f[i.type])}function T(e){let{automationTrigger:t,collectionSchema:o}=e;if("event"===(null==t?void 0:t.type)){const{pagesAdded:e,pagePropertiesEdited:n,source:a,relativeDate:r}=t.event;if(void 0===a)return!1;const l="some"===n.type&&n.some,s="all"===n.type&&n.all;if((l||s||[]).some((e=>C({collectionSchema:o,property:e.property})||x({collectionSchema:o,property:e.property,type:"trigger"}))))return!1;const c="some"===n.type&&(!(0,i().O9)(n.some)||0===n.some.length),u="all"===n.type&&(!(0,i().O9)(n.all)||0===n.all.length);if(!e&&("none"===n.type||c||u)&&!r)return!1}else{if("recurrence"!==(null==t?void 0:t.type))return!1;if(!t.recurrence)return!1}return!0}},546461:(e,t,o)=>{o.d(t,{EC:()=>S,To:()=>b,YC:()=>A,or:()=>M,u:()=>_});o(16280);var n=o(296540),i=()=>o(484714),a=()=>o(847249),r=()=>o(496506),l=()=>o(322867),s=()=>o(959013),c=()=>o(534177),u=()=>o(813297),d=()=>o(862292),p=()=>o(698331),m=()=>o(645873),y=()=>o(190019),f=()=>o(76190),g=o(474848);const v=new WeakMap,h=(0,n.createContext)({automationStore:void 0,contextType:void 0,defined:!1,typecheckResult:void 0});h.displayName="AutomationContext";function _(e){const{automationStore:t,children:o,contextType:n}=e,_=(0,i().v3)(),M=(0,s().tz)(),{value:b}=(0,m().fJ)(d().T.formulas),{value:S}=(0,m().fJ)(u().QV.automationTypecheck),A=(0,f().n)(t),C=(0,a().K8)((()=>{if(!b)return{error:new(l().N9)("Missing formulas dependency")};if(!S)return{error:new(l().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:i,formulasModule:a,intl:l,isSubscribed:s}=e,u=v.get(o);if(u)return u;{const e=new(r().default)((()=>{const e=o.getTriggerType();let r=i;return(0,c().O9)(e)&&(0,p().x2)(e)&&(r=(0,p().H8)(e)),(0,y().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:a,intl:l,isSubscribed:s})}),{debugName:"automationContextTypecheckResultCachedStore"});return v.set(o,e),e}}({environment:_,automationStore:t,automationTypecheckModule:S,contextType:n,formulasModule:b,intl:M,isSubscribed:A});return e.state}),[_,t,S,n,b,M,A]);return(0,g.jsx)(h.Provider,{value:{automationStore:t,typecheckResult:C,contextType:n,defined:!0},children:o})}function M(e){const{automationStore:t,children:o}=e,n=(0,a().K8)((()=>{var e;return null===(e=t.getTrigger())||void 0===e?void 0:e.type}),[t]);return(0,g.jsx)(_,{automationStore:t,contextType:(0,p().H8)(n??"event"),children:o})}function b(e){var t;return null===(t=v.get(e))||void 0===t?void 0:t.state}function S(){const e=n.useContext(h);if(!1===e.defined)throw new Error("No automation context found!");return e}function A(){return n.useContext(h)}},566910:(e,t,o)=>{o.d(t,{e:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"m4.897 3.086-.122-.143a.625.625 0 0 0-.95.814l1.347 1.57c-1.762.91-3.195 2.304-4.083 3.997a1.47 1.47 0 0 0 0 1.362c1.61 3.07 5.011 5.155 8.911 5.155 1.282 0 2.51-.225 3.637-.637l1.588 1.853a.625.625 0 0 0 1.042-.67L4.989 3.229a.6.6 0 0 1-.093-.143M2.194 9.905c.807-1.538 2.15-2.807 3.816-3.599L7.4 7.928a3.326 3.326 0 0 0 4.252 4.961l1.107 1.292a9.4 9.4 0 0 1-2.76.41c-3.459 0-6.42-1.848-7.805-4.486a.22.22 0 0 1 0-.2m6.696.097q0-.151.039-.29l1.194 1.393q-.06.007-.124.007a1.11 1.11 0 0 1-1.109-1.11m7.012 4.038a9.4 9.4 0 0 0 3.01-3.354 1.47 1.47 0 0 0 0-1.362C17.302 6.254 13.9 4.169 10 4.169c-.805 0-1.588.089-2.339.257l.94 1.096a9.5 9.5 0 0 1 1.4-.103c3.458 0 6.42 1.848 7.804 4.486a.22.22 0 0 1 0 .2 8.14 8.14 0 0 1-2.722 2.98z"}),(0,n.jsx)("path",{d:"M13.205 10.893a3.33 3.33 0 0 0-3.596-4.194z"})]})},a=(0,o(340498).wt)("eyeSlash",i)},603815:(e,t,o)=>{o.d(t,{A$:()=>x,JQ:()=>T,Vn:()=>A,s4:()=>C});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949),o(581454);var n=()=>o(857639),i=()=>o(585515),a=()=>o(577449),r=()=>o(388821),l=()=>o(179034),s=()=>o(545285),c=()=>o(534177),u=()=>o(449506),d=()=>o(780054),p=()=>o(989423),m=()=>o(870618),y=()=>o(303626),f=()=>o(14307),g=()=>o(245865),v=()=>o(540758),h=()=>o(670631),_=()=>o(508496),M=()=>o(571963),b=()=>o(603815),S=()=>o(108944);async function A(e){const{environment:t,request:o,abortSignal:n,prefetchCacheKey:i,headers:a}=e;return(0,M().updateLoadCachedPageChunkCalledAt)(),f().isConnected()||f().isConnecting()?u().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:i,headers:a}):u().callApi({eventName:"loadPageChunkV2",environment:t,data:o,abortSignal:n,prefetchCacheKey:i,headers:a})}async function C(e){const{mode:t,environment:o,request:c,isFirstChunk:u,abortSignal:f}=e,g={...c,limit:30,cursor:c.cursor||{stack:[]},baseUrl:d().A.domainBaseUrl,publicDomainName:d().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await b().A$(o,{id:c.page.id,table:l().ev}),null!=f&&f.aborted))throw new Error("Abort signal received");const _=r().RecordMapWithRole.create(),M=[];let S=!1;const A=new Set,C=await i().T(g,a().h.fromMonomorphicFunctionUnsafe((async e=>{const n=await m().h7({environment:o,pointer:e,abortSignal:f,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=f&&f.aborted)throw new Error("Abort signal received");if(n)return _.setModelAndRole(e,n.model,n.role),n.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,s().u)(e)&&!A.has(e.id)&&u){if(void 0===h().A.state.offlinePages)return M.push(e),void(S=!0);if(void 0===h().A.state.offlinePages||!v().Bd(c.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);M.push(e)}})),((e,t,o,n)=>{y().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${o})`),null!=n&&n.suppressErrorOnClient&&A.add(t.id)}));if(S&&(await h().A.waitUntil((()=>void 0!==h().A.state.offlinePages)),!v().Bd(c.page.id))){const[e]=M;throw new Error(`Record not found: ${e.table},${e.id}`)}if(M.length>0&&(0,p().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,p().u4)({environment:o,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&n().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:c.page.id,missingRecords:M}})})),null!=f&&f.aborted)throw new Error("Abort signal received");return{recordMap:_.toJson(),cursor:C.cursorValue}}async function x(e,t){const o=e.currentUser.id;if(!o||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:o})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),g().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function T(e){if(!_().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=r().RecordMapPolymorphic.create();let o=0;const n=()=>o>=50,i=e=>{"space"!==(null==e?void 0:e.table)&&(n()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),o++))};if(e.isReady())for(const r of(0,S().E)(e))i(r);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);i(t.getModel({table:"notion_user",id:e.userId}));let o=0;for(const e of t.getPointersByTable("notion_user")){if(n()||o>=10)break;o++,i(t.getModel(e))}}const a=Array.from(t).map((e=>{let{pointer:t,value:o}=e;if(void 0!==o)return{pointer:t,version:o}})).filter(c().O9);return a.length?a:void 0}},698331:(e,t,o)=>{o.d(t,{$X:()=>a,H8:()=>r,x2:()=>i});var n=()=>o(534177);function i(e){return"event"===e||"recurrence"===e}function a(e){const t=e.getTrigger();return(0,n().O9)(t)&&i(t.type)}function r(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},716547:(e,t,o)=>{o.r(t),o.d(t,{PagePropertiesRowNameMenu:()=>te});o(16280),o(944114),o(898992),o(354520),o(672577),o(581454);var n=o(296540),i=()=>o(484714),a=()=>o(847249),r=()=>o(443239),l=()=>o(970013),s=()=>o(487929),c=()=>o(713998),u=()=>o(49621),d=()=>o(859384),p=()=>o(764781),m=()=>o(89849),y=()=>o(566910),f=()=>o(167170),g=()=>o(735790),v=()=>o(236262),h=()=>o(564262),_=()=>o(778781),M=()=>o(798880),b=()=>o(959013),S=()=>o(100622),A=()=>o(183558),C=()=>o(534177),x=()=>o(966759),T=()=>o(235191),w=()=>o(686526),k=()=>o(334261),P=()=>o(854593),I=()=>o(751156),R=()=>o(324587),E=()=>o(797535),O=()=>o(519839),V=()=>o(730307),D=()=>o(175116),j=()=>o(722872),N=()=>o(553965),F=()=>o(978846),B=()=>o(712287),U=()=>o(447934),W=()=>o(937199),L=()=>o(154807),z=()=>o(57618),H=()=>o(962730),G=()=>o(712505),K=()=>o(575143),q=()=>o(760217),$=()=>o(939740),Y=()=>o(8980),Q=()=>o(859428),Z=()=>o(662971),J=()=>o(26517),X=o(474848);function ee(e){const t=(0,D().ET)(),k=(0,i().v3)(),J=(0,o(401497).DP)(),{permissionScopes:ee,collectionSettingsStore:te,collectionStore:ae,layoutStore:re}=(0,a().K8)((()=>{var e;return{permissionScopes:t.permissionScopesStore.state,collectionSettingsStore:t.settingsStore,collectionStore:t.collectionStore(),layoutStore:null===(e=t.collectionStore())||void 0===e?void 0:e.getLayoutStore()}}),[t]),{databaseType:le,collectionSchema:se}=(0,a().K8)((()=>({databaseType:null==ae?void 0:ae.getDatabaseType(),collectionSchema:null==ae?void 0:ae.getSchema()})),[ae]),{property:ce,schema:ue,blockStore:de}=e,pe=(0,c()._g)({schema:ue,property:ce}),me=(0,a().K8)((()=>o(685889).pg(t,pe)),[t,pe]);(0,n.useEffect)((()=>{const e=ue[ce];t&&"relation"===(null==e?void 0:e.type)&&(null==me||me.load())}),[t,ce,ue,me]);const ye=(0,a().K8)((()=>!!ae&&Boolean(le&&o(313892).jP((0,o(617254).appConfigs)(),le,ce,ae))),[ce,le,ae]),fe=(0,o(234359).dm)(de,se,ce,pe);let ge;const{device:ve}=k;ge=ve.isMobile?{menuType:j().gu.ActionSheet}:{menuType:j().gu.Popup,width:220};const he=Boolean((0,n.useContext)(W().sf)),{sessionId:_e,setModuleSelection:Me}=(0,n.useContext)(W().Op)||{},be=(0,a().K8)((()=>!he&&!fe),[he,fe]),Se=(0,a().K8)((()=>(0,o(400851).Y)({environment:k,blockStore:de,from:"pagePropertiesRowNameMenu"})),[de,k]),Ae=function(e){let{property:t,schema:o,format:n,blockStore:i,pagePropertiesStore:a,popupContainerRef:k,collectionContextStore:D,permissionScopes:j,collectionStore:W,collectionSettingsStore:$,isTypedProperty:J,environment:ee,theme:te,layoutModule:ae,isInPageLayoutEditor:re,layoutSessionId:le,layoutStore:se,isPropertyCommentsEnabled:ce,canShowLayoutBuilderEntryPoint:ue,hideDuplicatePropertyOption:de,setModuleSelection:pe}=e;const{device:me}=ee,ye=(0,c()._g)({schema:o,property:t});if(!(D&&$&&ye&&W))return[];const fe=[],ge=re&&(0,_().V_)(ae),ve=j.canConfigureCollection||j.canConfigureBlock;if(ve&&!(0,r().u)(t)&&!j.isExternallyImportedAndSyncedCollection){const e=re&&(ge||(0,_().i_)(ae)||(0,_()._Q)(ae));if(ge){const e=[{key:"Show As Property Or Section",action:()=>{},render:(e,i)=>(0,X.jsx)(Z().A,{...e,renderOrigin:e=>(0,X.jsx)(K().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Show as",id:"database.configureProperty.showAsAction"}),svg:m().eyeIcon}),onFocus:i.onFocus,renderExtension:(e,i)=>(0,X.jsx)(ie,{popupEvents:e,extParent:i,property:t,schema:o,format:n,collectionStore:W,pagePropertiesStore:a})})}];fe.push(e)}const r=[];if(fe.push(r),r.push({key:"rename",render:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Rename",id:"database.tableHeaderCell.rename"}),icon:(0,X.jsx)(Y().I,{icon:d().M})}),action:()=>{w().Ow({collectionContextStore:D,collectionSettingsStore:$,fromBlockStore:i}),w().dP({collectionSettingsStore:$,item:{type:"property",formatKey:"collection_page_properties",property:t,selectNameInitial:!me.isMobile}})}}),r.push({key:"edit_property",render:e=>(0,X.jsx)(Q().A,{placement:H().W.Left,render:t=>(0,X.jsx)(q().A,{title:(0,X.jsx)(b().sA,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,X.jsx)(Y().I,{icon:g().M}),...(0,N().A)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,X.jsx)(b().sA,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{w().Ow({collectionContextStore:D,collectionSettingsStore:$,fromBlockStore:i,hideDuplicatePropertyOption:de}),w().dP({collectionSettingsStore:$,item:{type:"property",formatKey:"collection_page_properties",property:t}})}}),se&&e){const e=[{key:"Move to layout",action:()=>{if(!le)throw new Error("could not find session id for layouts logging");const e=(0,A().Ay)(),o=(0,h().W)(se.getModules());(0,F().UQ)({position:{type:"area_relative",location:"end_moveable",..."views_main_tab_modules"===o.area?{area:o.area,viewId:o.viewsMainTabId}:{area:o.area}},layoutStore:se,environment:ee,module:{type:"property_relation",id:e,propertyId:t},sessionId:le,isPropertyCreation:!1}),null==pe||pe({type:"existing_module",moduleId:e,isDragging:!1}),oe(a,D)},render:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Add to layout",id:"database.configureProperty.moveToLayout"}),icon:(0,X.jsx)(Y().I,{icon:f()._})})}];fe.push(e)}ce&&"formula"!==ye.type&&"rollup"!==ye.type&&"button"!==ye.type&&"auto_increment_id"!==ye.type&&"verification"!==ye.type&&!(0,l().F_)(ye.type)&&r.push({key:"comment",render:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Comment",id:"database.tableHeaderCell.comment"}),icon:(0,X.jsx)(Y().I,{icon:u().h})}),action:async()=>{await(0,V().l)({environment:ee,blockStore:i,rect:z().A.getRect(i,t),property_id:t}),oe(a,D)}})}const he=[];fe.push(he);let _e=!0;if("relation"===ye.type){var Me;const e=n.collection_page_sections||[],o=e.findIndex((e=>e.section===t)),i=null===(Me=e[o])||void 0===Me?void 0:Me.visibility;!i||"inline"!==i&&"minimal"!==i||(_e=!1)}if("title"!==ye.type&&j.canConfigureBlock&&_e&&!((0,_().gx)(ae)||(0,_()._Q)(ae)||(0,_().V_)(ae))){const e=n.property_visibility;if(e){const i=e.find((e=>e.property===t));he.push({key:"Property Visibility",action:()=>{},render:(e,r)=>(0,X.jsx)(Z().A,{...e,renderOrigin:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Property visibility",id:"database.configureProperty.propertyVisibilityAction"}),icon:"show"===(null==i?void 0:i.visibility)?(0,X.jsx)(Y().I,{icon:y().e}):(0,X.jsx)(Y().I,{icon:m().eyeIcon})}),onFocus:r.onFocus,renderExtension:()=>(0,X.jsx)(ne,{property:t,schema:o,format:n,collectionStore:W,pagePropertiesStore:a})})})}}l().cN.includes(ye.type)&&j.canConfigureCollection&&!(0,r().u)(t)&&!j.isExternallyImportedAndSyncedCollection&&((0,l().vB)(ye)&&!de&&he.push({key:"Duplicate Property",render:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Duplicate property",id:"database.configureProperty.duplicateAction"}),icon:(0,X.jsx)(Y().I,{icon:p().V})}),action:async()=>{oe(a,D),await async function(e,t,o,n,i){const a=o.collection_page_properties||[],r=null==t?void 0:t.getSpaceId();if(!t||!r)return;const l=t.getNormalizedPropertyGroups(),s=await O().W4({environment:i,schema:n,properties:a,property:e,propertyGroups:l,parentStore:t,spaceId:r});if(s){const e=i.currentUser.id,a=e?{id:e,table:M().oo}:void 0;I().createAndCommit({userAction:"PagePropertiesRowName.handleDuplicate",environment:i,canUndo:!0,perform:e=>{(0,C().O9)(s.automationUpdate)&&R().duplicateAutomation({actorPointer:a,environment:i,sourceAutomationStore:s.automationUpdate.sourceAutomationStore,targetAutomationId:s.automationUpdate.targetAutomationId,transaction:e});const r={...n,[s.newProperty]:s.newPropertySchema},l={...o,collection_page_properties:s.newProperties,property_groups:s.newPropertyGroups};(0,E().I)({environment:i,collectionStore:t,update:{schema:r,format:l},transaction:e})}})}}(t,W,n,o,ee)}}),J||he.push({key:"delete",render:e=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),icon:(0,X.jsx)(Y().I,{icon:v().trashIcon}),hoveredStyle:{color:S().Ay.red,fill:S().Ay.red}}),action:async()=>{const e=()=>{var e;if(!ge)return;const o=D.collectionStore(),n=null==o?void 0:o.getSchema(),i=null==o?void 0:o.getFormat();if(!(0===(n&&i?(0,s().T)({format:i,schema:n,visibilityLevels:["inline","minimal"]}):[]).filter((e=>e.section!==t)).length))return;const a=null==o||null===(e=o.getLayoutStore())||void 0===e?void 0:e.getModules().page_main.find((e=>"normalizedTitleWithIcon"===e.type));a&&(null==pe||pe({type:"existing_module",moduleId:a.id,isDragging:!1}))};oe(a,D),await async function(e){let{environment:t,theme:o,property:n,schema:i,collectionStore:a,collectionContextStore:r,onAccept:l}=e;if(!r)return;await P().q({environment:t,collectionContextStore:r,property:n,handleDeleteAccept:()=>(l(),function(e,t,o,n,i){if(!i)return;I().createAndCommitAsync({environment:e,userAction:"PagePropertiesRowName.handleDeleteAccept",waitForServerCommit:!1,perform:i=>T().PF({environment:e,collectionStore:n,schema:o,property:t,transaction:i})});const a=n.getSchema()[t];a&&(0,x().i)({environment:e,collectionContextStore:i,property_type:a.type,from:"table_column",property:t});const r=n.getLayoutStore(),l=(0,L().SR)(n);G().default.state.open||!r||l||(0,B().F)({environment:e,from:"details_sidebar_empty",layoutStore:r,panelLocation:"mainPage",preventPeekWidthResize:!1})}(t,n,i,a,r)),theme:o,from:"table_column"})}({environment:ee,theme:te,property:t,schema:o,collectionStore:W,onAccept:e,collectionContextStore:D})}}));const be=[];ue&&be.push({key:"customizeLayout",action:()=>{oe(a,D);const e=D.collectionStore();e&&(0,U().nh)({environment:ee,blockStore:i,collectionStore:e,from:"page_property_menu"})},render:(e,t)=>(0,X.jsx)(q().A,{...e,title:(0,X.jsx)(b().sA,{defaultMessage:"Customize layout",id:"pageProperties.editProperty.customizeLayout.label"}),icon:(0,X.jsx)(Y().I,{icon:f()._})})});re||fe.push(be);return fe}({property:e.property,schema:e.schema,format:e.format,blockStore:e.blockStore,pagePropertiesStore:e.pagePropertiesStore,popupContainerRef:e.popupContainerRef,collectionContextStore:t,permissionScopes:ee,collectionStore:ae,collectionSettingsStore:te,isTypedProperty:ye,environment:k,theme:J,layoutModule:e.layoutModule,layoutSessionId:_e,isInPageLayoutEditor:he,layoutStore:re,isPropertyCommentsEnabled:be,hideDuplicatePropertyOption:Boolean(e.hideDuplicatePropertyOption),canShowLayoutBuilderEntryPoint:Se,setModuleSelection:Me});return(0,X.jsx)(o(928600).A,{...ge,children:(0,X.jsx)($().Ay,{type:$().Oh.Vertical,initialFocus:void 0,sections:o(496603).oE(null==Ae?void 0:Ae.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,X.jsx)(o(89924).A,{...e,topBorder:0!==t}),items:e}})))})})}const te=n.memo(ee);function oe(e,t){e.setState({...e.state,openProperty:void 0});const o=null==t?void 0:t.settingsStore;o&&w().os({collectionSettingsStore:o})}function ne(e){let{property:t,schema:o,format:a,collectionStore:r,pagePropertiesStore:l}=e;const s=(0,i().v3)(),c=(0,n.useContext)(D().p2),u=a.property_visibility;if(!u)return null;const d=o[t];if(!d)return null;const p=u.find((e=>e.property===t));return(0,X.jsx)(J().YB,{propertySchema:d,currentVisibility:(null==p?void 0:p.visibility)||"show",onSelect:e=>function(e,t,o,n,i){I().createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:i,canUndo:!0,perform:i=>{k().D7({property:t,visibility:e,format:o,store:n,transaction:i})}})}(e,t,a,r,s),onClose:()=>{oe(l,c)}})}function ie(e){let{popupEvents:t,extParent:o,property:a,schema:r,format:l,collectionStore:s,pagePropertiesStore:c}=e;const u=(0,i().v3)(),d=(0,n.useContext)(D().p2),p=l.collection_page_sections||[];if(!r[a])return null;const m=p.findIndex((e=>e.section===a)),y=p[m];return(0,X.jsx)(J().Wf,{currentVisibility:(null==y?void 0:y.visibility)||"section_hide",onSelect:e=>{T().Z7({visibility:e,property:a,schema:r,collectionStore:s,format:l,environment:u}),oe(c,d)},onClose:()=>{o.close()}})}},725649:(e,t,o)=>{function n(e){return!(!e||"askUserToPick"in e)}function i(e){if(!e||!("askUserToPick"in e))return e}function a(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}o.d(t,{DK:()=>i,K$:()=>n,j6:()=>a})},735790:(e,t,o)=>{o.d(t,{M:()=>a});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3 7.375h6.829a2.501 2.501 0 0 0 4.842 0H17a.625.625 0 1 0 0-1.25h-2.329a2.501 2.501 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25M12.25 5.5a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5"}),(0,n.jsx)("path",{fillRule:"evenodd",d:"M7.75 15.75a2.5 2.5 0 0 0 2.421-1.875H17a.625.625 0 1 0 0-1.25h-6.829a2.5 2.5 0 0 0-4.842 0H3a.625.625 0 1 0 0 1.25h2.329A2.5 2.5 0 0 0 7.75 15.75m0-1.25a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5",clipRule:"evenodd"})]})},a=(0,o(340498).wt)("sliders",i)},770586:(e,t,o)=>{o.d(t,{v:()=>n});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(908872);function n(e,t){const o=e.reduce(((e,t)=>{if(t.isType("define_variables")){var o;const n=null===(o=t.getModel())||void 0===o?void 0:o.getVariables();if(n)for(const t of Object.values(n))e.add(t.name)}return e}),new Set),n=t.replace(/\s*\d+$/,"");let i=1,a=`${n} ${i}`;for(;o.has(a);)a=`${n} ${i}`,i++;return a}},854593:(e,t,o)=>{o.d(t,{q:()=>f});o(944114),o(296540);var n=()=>o(959013),i=()=>o(284371),a=()=>o(521358),r=()=>o(16006),l=()=>o(685889),s=()=>o(470928),c=()=>o(290966),u=()=>o(204067),d=()=>o(27732),p=()=>o(901389),m=()=>o(751156),y=o(474848);async function f(e){const{environment:t,collectionContextStore:o,property:f,handleDeleteAccept:g}=e,v=o.collectionStore();if(!v)return;if(v.isTypedProperty(f)){if(await a().nD({environment:t,property:f,collectionContextStore:o,theme:e.theme,from:e.from}))return}const h=(0,u().R5)({environment:t,collectionStore:v,propertyId:f});if(h.length>0){if((0,c().E_)({environment:t,collectionStore:v,propertyId:f,compoundTemplateInstancesToDelete:h,collectionContextStore:o,from:e.from}))return}else if(((0,s().k$)(f)||(0,s().Do)({collectionStore:v,propertyId:f}))&&(0,s().aF)(v)&&(0,s().Io)()){if((0,c().I5)({environment:t,collectionStore:v,propertyId:f,collectionContextStore:o,from:e.from}))return}const _=o.normalizedSchemaStore.state,M=_[f],b=l().pg(o,M);await(null==b?void 0:b.load());const S=b&&l().D5(o,f,b),A=b&&l().uf(b),C=b&&v.id===b.id,x=[{label:(0,y.jsx)(n().sA,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:g}];let T;if(S&&v&&A&&!C&&x.push({label:(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteProperty.modal.inverseConfirmButton",defaultMessage:"Delete, but keep related property"}),color:"red",onAccept:()=>{m().createAndCommit({userAction:"collectionPropertyActions.showDeletePropertyDialog",environment:t,canUndo:!0,perform:e=>{if(M&&"relation"===M.type&&M.property&&b){const o=M.property,n=b.getSchema();d().C4({environment:t,collectionStore:b,propertySchema:n[o],property:o,targetPropertyID:void 0,autoRelate:v.isSyncedCollection()&&!b.isSyncedCollection()?{enabled:!1}:M.autoRelate,transaction:e})}d().t$({environment:t,collectionStore:v,property:f,transaction:e})}})}}),"auto_increment_id"===(null==M?void 0:M.type))T=l().me(_)?(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteUniqueIdWithGithubProperty.modal.prompt",defaultMessage:"You will no longer be able to link new GitHub PRs and status automations will stop working."}):(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteUniqueIdProperty.modal.prompt",defaultMessage:"The ID property will be permanently deleted."});else if("status"===(null==M?void 0:M.type)){const e=l().AX(_);if(e){const t=e.connectedRelation.automation;t&&t[f]&&(T=(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteStatusProperty.modal.prompt",defaultMessage:"Deleting this status property will stop the GitHub Pull Requests status automation."}))}}else b&&A&&!C&&S&&(T=(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteRelatedProperty.modal.prompt",defaultMessage:"This property has a related property on {relationTargetName} which will also be deleted.",values:{relationTargetName:(0,y.jsx)(r().A,{style:{display:"inline",fontWeight:i().Wy.medium},store:b})}}));p().ui({message:(0,y.jsx)("span",{children:(0,y.jsx)(n().sA,{id:"database.tableHeaderCell.deleteProperty.modal.prompt",defaultMessage:"Delete this property from {databaseName}? It will be removed from all views.",values:{databaseName:(0,y.jsx)(r().A,{style:{display:"inline",fontWeight:i().Wy.bold},shouldWrap:!0,store:v})}})}),description:T,showCancel:!0,keepFocus:!0,items:x,mode:"wide"})}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},890409:(e,t,o)=>{o.d(t,{Ah:()=>g,Dk:()=>m,Iv:()=>f,SF:()=>y,YO:()=>_,_f:()=>b,c_:()=>d,dW:()=>h,gW:()=>p,sp:()=>S,vN:()=>v});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var n=()=>o(496603),i=()=>o(973647),a=()=>o(534177),r=()=>o(842599),l=()=>o(977345),s=()=>o(798880),c=()=>o(919709),u=()=>o(241319);function d(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function M(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:n,getRecordModel:r,spaceId:s,value:c,featureGates:u}=e;if("formula"===c.type){if(!(0,a().O9)(c.value))return;const e=i().Q.unwrapOr(o.parseFormulaInputToAst(c.value),void 0);if(e){const i=o.addTypesToFormulaAST(e,{handleDataRequest:(0,l().zg)(r),spaceId:s,valueTypes:n,featureGates:u});return{...t.getFormulaAnalytics(e,{getRecordModel:r,typecheckContextValues:n}),formula_return_type:i.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:r,typecheckContextValues:n})}}}else{if("simple"===c.type){if(!(0,a().O9)(c.value))return;return t.getSimpleFormulaAnalytics(c.value,{getRecordModel:r,typecheckContextValues:n})}(0,a().HB)(c.type)}}function b(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y,simpleFormulasModule:f}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:l}=e,s=t.getConfig();let c,u=[];const d=null==s?void 0:s.collection,p=null==s?void 0:s.properties;if((0,a().O9)(d)&&(0,a().O9)(p)&&p.length>0){const e=r(d),y=null==e?void 0:e.getNormalizedSchema();(0,a().O9)(y)&&(u=p.map((e=>{var t;return(null===(t=y[e])||void 0===t?void 0:t.type)??"unknown"})));const f=null==s?void 0:s.values;if(n&&(0,a().O9)(f)){c=[];for(const e of p){var m;const a=null===(m=f[e])||void 0===m?void 0:m.value;if(!a)continue;const s=M({formulaAnalyticsModule:o,formulasModule:n,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:a,featureGates:l});s&&c.push(s)}}}return{automation_action_id:t.pointer.id,property_formula_stats:c,property_types:u,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:l}=e,s=t.getConfig(),c=[];if(n&&(0,a().O9)(s)&&s.text){const e=M({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:s.text,featureGates:l});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:l,featureGates:s,simpleFormulasModule:u}=e,d={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,a().O9)(p))return d;if((0,a().O9)(p.target))if("formula"===p.target.type&&(0,a().O9)(p.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,c().Fbh)(p.target.value.value).length,numFormulaContextTargets:u.getReferencedContextValueIds(p.target.value).length},i){const e=M({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:r,spaceId:o.spaceId,value:p.target.value,featureGates:s});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===p.target.type&&(0,a().O9)(p.target.propertyId)&&(0,a().O9)(p.target.collectionPointer)){const e=l(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,a().O9)(t)&&(d.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,a().O9)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(d.messageCharacterCount=(0,c().FAw)(p.notification_message.value),i)){const e=M({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:r,spaceId:o.spaceId,value:p.notification_message,featureGates:s});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y,simpleFormulasModule:f}):t.isType("send_gmail_notification")?function(e){var t,o,i,l,u,d,p;const{automationActionModel:m,formulaAnalyticsModule:y,formulasModule:f,formulaTypecheckContextValues:g,getRecordModel:v,featureGates:h}=e,_=m.getConfig();if(!(0,a().O9)(_))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const b=Object.fromEntries(Object.entries(_||{}).map((e=>{let[t,o]=e;var n;return"formula"===(null==o?void 0:o.type)?[t,Boolean(null==o||null===(n=o.value)||void 0===n?void 0:n.value)]:"simple"===(null==o?void 0:o.type)?[t,Boolean(null==o?void 0:o.value)]:[t,Boolean(o)]}))),{to:S,cc:A,bcc:C}=_,x=[...(null==S||null===(t=S.value)||void 0===t?void 0:t.value)||[],...(null==A||null===(o=A.value)||void 0===o?void 0:o.value)||[],...(null==C||null===(i=C.value)||void 0===i?void 0:i.value)||[]],T=[...(0,c().Fbh)(x).map((e=>v({table:s().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(a().O9),...(0,r().C3)((0,c().k4p)(x))],w=n().Tr(T.map((e=>e.split("@")[1]))),k=[null===(l=_.to)||void 0===l?void 0:l.value,null===(u=_.cc)||void 0===u?void 0:u.value,null===(d=_.bcc)||void 0===d?void 0:d.value,null===(p=_.reply_to)||void 0===p?void 0:p.value,_.from_name,_.email_subject,_.email_body].map((e=>{if(f&&(0,a().O9)(e))return M({formulaAnalyticsModule:y,formulasModule:f,getRecordModel:v,formulaTypecheckContextValues:g,spaceId:m.spaceId,value:e,featureGates:h})})).filter(a().O9);return{automation_action_id:m.pointer.id,fields:b,formula_stats:k,recipient_domains:w,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:s,featureGates:c}=e,d=t.getConfig(),p=[],m=[],y=[];if((0,a().O9)(d)&&(0,a().O9)(d.target)&&(0,a().O9)(d.properties)&&d.properties.length>0){let e;if("variable"===d.target.type){const t=(0,l().y5)(d.target.id);if("action"===t.source){const t=(0,u().y)({actionModels:o,id:d.target.id}).collectionPointer;if((0,a().O9)(t)){const o=s(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,l().IV)(r,d.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,a().O9)(t.type.collection)){const o=s(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===d.target.type){const t=s(d.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,a().O9)(e)&&d.properties.forEach((o=>{const l=e[o];if((0,a().O9)(l)&&(p.push(l.type),i&&(0,a().O9)(d.values))){const e=d.values[o];if((0,a().O9)(e)&&(m.push({type:l.type,operator:e.action}),e.value)){const o=M({formulasModule:i,formulaAnalyticsModule:n,getRecordModel:s,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:e.value,featureGates:c});o&&y.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:y,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:i,getRecordModel:r,featureGates:l}=e,s=t.getConfig(),c=[];if(n&&(0,a().O9)(s)&&s.values)for(const a of Object.values(s.values))if(a.value){const e=M({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:r,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:a.value,featureGates:l});e&&c.push(e)}return{automation_action_id:t.pointer.id,formula_stats:c,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:i,formulasModule:d,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:y}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:void(0,a().HB)(t)}function S(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:l,featureGates:s,simpleFormulasModule:c,source:u}=e,d=[],p=t.getActionPointers().map((e=>l(e))).filter(a().O9);for(const _ of t.getActionPointers()){const e=l(_);(0,a().O9)(e)&&d.push(b({automationActionModel:e,automationActionModels:p,formulaAnalyticsModule:n,formulasModule:i,formulaTypecheckContextValues:r,getRecordModel:l,featureGates:s,simpleFormulasModule:c}))}const m=[];let y,f,g;if(t.isEventType()){var v;const e=t.getEventConfiguration(),o=l(t.getParentPointer());y=t.getParentId();const n=t.getEventConfiguration();if("collection_view"===(null===(v=n.source)||void 0===v?void 0:v.type)){const e=l(n.source.pointer);g=null==e?void 0:e.parent_id,f=null==n?void 0:n.source.pointer.id}const i=null==o?void 0:o.getNormalizedSchema();if((0,a().O9)(i)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&m.push({type:"page"}),"any"===o.type)m.push({condition:"any",type:"property"});else if("none"===o.type)m.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],n=[];e.forEach((e=>{var o;const r=null===(o=i[e.property])||void 0===o?void 0:o.type;(0,a().O9)(r)&&(t.push({type:r,operator:e.filter.operator}),n.push(r))})),m.push({condition:o.type,property_configs:t,property_types:n,type:"property"})}}}else if(t.isButtonType())m.push({type:"button"});else if(t.isRecurrenceType()){var h;m.push({type:"recurrence",frequency:null===(h=t.getTrigger().recurrence)||void 0===h?void 0:h.frequency})}else(0,a().HB)(t);return{automation_actions:d,automation_id:t.id,automation_triggers:m,collection_id:y,collection_view_id:f,collection_view_block_id:g,builder_type:o,source:u}}},966759:(e,t,o)=>{o.d(t,{i:()=>a});var n=()=>o(476492),i=()=>o(175213);function a(e){const{environment:t,collectionContextStore:o,property_type:a,from:r,property:l,...s}=e,c=(0,n().sl)(o)||{};(0,i().G)(t,{property:l,property_type:a,from:r,...s,...c})}}}]);