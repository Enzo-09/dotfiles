"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[73206],{346:(e,t,o)=>{o.d(t,{MG:()=>h,T1:()=>m,a1:()=>S,dt:()=>y,kg:()=>g,lC:()=>v,n_:()=>f});var r=o(296540),a=()=>o(484714),n=()=>o(847249),i=()=>o(187174),l=()=>o(645873),s=()=>o(941463),d=()=>o(441199),c=()=>o(749687),p=()=>o(737230),u=()=>o(756114);const m=new(l().O2)("PerformanceToolbar",(()=>Promise.all([o.e(96346),o.e(16471),o.e(85864),o.e(92845),o.e(71718),o.e(21194),o.e(17989),o.e(90625),o.e(37580),o.e(45624)]).then(o.bind(o,140401)))),h=(0,l()._h)(m,(e=>e.PerformanceToolbar)),y=(0,l()._h)(m,(e=>e.PerformanceToolbarSettings));function g(){const e=(0,a().v3)();return(0,n().K8)((()=>(0,u().D)(e,e.RouterStore.state)),[e])}function f(){const e=(0,a().v3)(),t=x("PerformanceToolbarStore"),o=x("isPerformanceToolbarVisible");return(0,n().K8)((()=>!(!t||!o)&&o(e,e.RouterStore.state,t.state)),[o,e,t])}function v(){const e=x("PerformanceToolbarStore");return(0,n().K8)((()=>!!e&&e.state.isPerformanceToolbarMounted),[e])}function S(){const e=(0,a().v3)(),t=x("createPerformanceToolbarMouseListeners"),o=x("PerformanceToolbarStore"),{sidebarExpanded:i,sidebarWidth:l,secondarySidebarExpanded:u,secondarySidebarWidth:m,updateSidebarExpanded:h,updateSidebarWidth:y}=(0,n().K8)((()=>({sidebarExpanded:c().sidebarExpandedStore.state,sidebarWidth:c().sidebarWidthStore.state,secondarySidebarExpanded:d().default.isOpen(),secondarySidebarWidth:s().Ay.getWidth(),updateSidebarExpanded:p().Ay.state.expanded,updateSidebarWidth:p().Ay.state.width})),[]);return(0,r.useEffect)((()=>{if(o&&t)return t(e,(e=>o.update((t=>({...t,isMouseNearPerformanceToolbar:e})))),i,l,u,m,h,y)}),[t,e,o,i,l,u,m,h,y])}function x(e){const t=g(),[{value:o}]=(0,i().Yb)((()=>t?m.load().then((t=>t[e])):Promise.resolve(void 0)),[e,t]);return o}},237843:(e,t,o)=>{o.d(t,{z:()=>a});o(296540);var r=o(474848);const a=(0,o(340498).wt)("bookClosed",{viewBox:"0 0 16 16",svg:(0,r.jsx)("path",{d:"M4.59766 14.8662C3.2583 14.8662 2.55371 14.1616 2.55371 12.8096L2.55371 3.21191C2.55371 1.84082 3.2583 1.12988 4.6167 1.12988L11.377 1.12988C12.7354 1.12988 13.4399 1.84717 13.4399 3.21191L13.4399 10.2642C13.4399 10.9053 13.186 11.2163 12.875 11.502C12.0752 12.2573 12.2339 13.3364 13.0146 13.6792C13.2495 13.7871 13.4399 13.9966 13.4399 14.2759C13.4399 14.6123 13.186 14.8662 12.856 14.8662L4.59766 14.8662ZM11.269 2.37402L5.43555 2.37402L5.43555 10.5562L11.7007 10.5562C12.0181 10.5562 12.1958 10.3848 12.1958 10.0737L12.1958 3.28809C12.1958 2.69775 11.8848 2.37402 11.269 2.37402ZM3.79785 10.7783C4.01367 10.6641 4.25488 10.5879 4.54053 10.5625L4.54053 2.38672C4.04541 2.44385 3.79785 2.75488 3.79785 3.28809L3.79785 10.7783ZM4.75635 13.6855L11.4214 13.6855C11.085 13.1079 11.0469 12.3843 11.3579 11.7178C11.2944 11.7241 11.231 11.7305 11.1611 11.7305L4.80713 11.7305C4.14062 11.7305 3.73437 12.1367 3.73437 12.7017C3.73437 13.3047 4.0835 13.6855 4.75635 13.6855Z"})})},396350:(e,t,o)=>{o.d(t,{i:()=>n});o(296540);var r=o(474848);const a={viewBox:"0 0 20 20",svg:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{d:"M12.876 7.982a.625.625 0 1 0-1.072-.644L9.25 11.595 7.815 9.92a.625.625 0 1 0-.95.813l2 2.334a.625.625 0 0 0 1.01-.085z"}),(0,r.jsx)("path",{d:"M5.25 3.125A2.125 2.125 0 0 0 3.125 5.25v9.5c0 1.174.951 2.125 2.125 2.125h9.5a2.125 2.125 0 0 0 2.125-2.125v-9.5a2.125 2.125 0 0 0-2.125-2.125zM4.375 5.25c0-.483.392-.875.875-.875h9.5c.483 0 .875.392.875.875v9.5a.875.875 0 0 1-.875.875h-9.5a.875.875 0 0 1-.875-.875z"})]})},n=(0,o(340498).wt)("checkmarkSquare",a)},490044:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var r=()=>o(484714),a=()=>o(847249),n=()=>o(401497),i=()=>o(500066),l=()=>o(159588),s=()=>o(963589),d=()=>o(644914),c=o(474848);function p(){const e=(0,n().IS)((e=>({icon:{position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===e.mode?e.text.primary:"#3E3C38",stroke:"dark"===e.mode?e.surface.wash:"white",strokeWidth:"dark"===e.mode?"1.85px":"1.5px"}})),[]);return(0,c.jsx)("div",{children:(0,i().G)(e.icon)})}function u(e){var t;const o=(0,r().v3)(),i=o.device.isMobile,{isTablet:u}=(0,r().Y0)(),m=(0,s().X)("tablet_refresh_gate"),h=(0,a().K8)((()=>{var t,r;if(i)return o.WindowSizeStore.getSafePaddingLeftCSS("number"==typeof(null===(t=e.style)||void 0===t?void 0:t.paddingLeft)?null===(r=e.style)||void 0===r?void 0:r.paddingLeft:10)}),[o.WindowSizeStore,i,null===(t=e.style)||void 0===t?void 0:t.paddingLeft]),y=(0,n().IS)((t=>({wrapper:{...i?{display:"flex",alignItems:"center",width:"100%",minHeight:26,fontSize:16,paddingTop:u&&m?4:8,paddingBottom:u&&m?4:8,paddingLeft:h,paddingRight:10,userSelect:"none",WebkitUserSelect:"none",boxShadow:void 0,marginBottom:e.shouldShowMobileMarginBottom?12:1}:{display:"flex",alignItems:"center",width:"100%",fontSize:14,minHeight:e.isBottomItem?24:27,height:d().Zr,paddingTop:4,paddingBottom:4,...(0,l().ic)()},...e.style},icon:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:i?28:22,height:i?24:18,marginRight:8,position:"relative"},right:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,height:"100%",...e.rightStyle},left:{flexShrink:0,flexGrow:0,borderRadius:4,color:t.text.secondary,width:i?24:d().ry,height:i?24:d().ry,display:"flex",alignItems:"center",justifyContent:"center",marginRight:e.icon?0:8},children:{flexGrow:1,flexShrink:1,flexBasis:"auto",whiteSpace:"nowrap",minWidth:0,overflow:"hidden",textOverflow:e.right&&!i?"clip":"ellipsis",...e.childrenStyle}})),[i,u,m,h,e.shouldShowMobileMarginBottom,e.isBottomItem,e.style,e.rightStyle,e.icon,e.right,e.childrenStyle]);return(0,c.jsxs)("div",{role:e.role,dir:"ltr","aria-current":e["aria-current"],"aria-expanded":e["aria-expanded"],"aria-owns":e["aria-owns"],"aria-labelledby":e["aria-labelledby"],style:y.wrapper,onFocus:e.onFocus,onBlur:e.onBlur,onMouseMove:e.onMouseMove,onMouseLeave:e.onMouseLeave,onClick:e.onClick,className:e.className,children:[e.left&&(0,c.jsx)("div",{style:y.left,children:e.left}),e.icon&&(0,c.jsxs)("div",{style:y.icon,children:[e.icon,e.isAlias&&(0,c.jsx)(p,{})]}),(0,c.jsx)("div",{style:y.children,children:e.children}),e.right&&(0,c.jsx)("div",{style:y.right,children:e.right})]})}},490696:(e,t,o)=>{o.d(t,{A:()=>K});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(581454);var r=o(296540),a=()=>o(17022),n=()=>o(484714),i=()=>o(847249),l=()=>o(401497),s=()=>o(708685),d=()=>o(502856),c=()=>o(784892),p=()=>o(247331),u=()=>o(563015),m=()=>o(977345),h=()=>o(416504),y=()=>o(591779),g=()=>o(792071),f=()=>o(959013),v=()=>o(973647),S=()=>o(284371),x=()=>o(193722),b=()=>o(175116),j=()=>o(862292),C=()=>o(921855),A=()=>o(476492),M=()=>o(909470),w=()=>o(847743),P=()=>o(972435),k=()=>o(722872),T=()=>o(991114),_=()=>o(47170),R=()=>o(645873),O=()=>o(963589),I=()=>o(962730),F=()=>o(792415),L=()=>o(508496),B=()=>o(942504),E=()=>o(928600),V=()=>o(833682),D=o(474848);const W=200;function K(e){var t,o,l,c;const{property:f,disabled:S,formulas:I,getRecordModel:B,propertySchema:K,collectionStore:z,handleSave:U,handleClose:N,blockStore:Y,analyticsFrom:J}=e,H=(0,n().v3)(),q=(0,b().ET)(),{value:$}=(0,R().fJ)(j().T.formulas),[X,Q]=(0,r.useState)(null==K||null===(t=K.formula2)||void 0===t?void 0:t.code),ee=(0,y().lW)(X,W,Object.is),[te,oe]=(0,r.useState)(),re=(0,r.useRef)(null===(o=K.formula2)||void 0===o?void 0:o.code),ae=(0,r.useRef)(X),ne=(0,r.useRef)(null==K||null===(l=K.formula2)||void 0===l?void 0:l.result_type),ie=(0,r.useCallback)((e=>{ae.current=e,Q(e)}),[]),le=(0,r.useCallback)((e=>{ne.current=e}),[]),[se,de]=(0,r.useState)((()=>a().A.withListenerIgnored((()=>Z.state??!1)))),[ce,pe]=(0,r.useState)([]),ue=(0,n().Y0)();(0,r.useEffect)((()=>()=>{const e=re.current,t=ae.current,o=ne.current;if(t!==e||void 0!==xe){U({newValue:t,newType:(0,s().removeFunctionsFromType)(o??{type:"unknown"}),propertySchema:K,collectionStore:z,property:f});const e=(0,C().r4)(t,z);(0,x().L)(H,{...(0,A().sl)(q),property_type:K.type,action:"formula_v2_edit",from:J,formula_char_count:e.length})}}),[]);const me=(0,i().K8)((()=>z.pointer),[z.pointer]),he=(0,r.useMemo)((()=>{const e={type:"block",collection:me};return{kind:p().FormulaContextValueKind.ThisRow,type:e}}),[me]),ye=(0,i().K8)((()=>F().A.state.publicPageData),[]),ge=(0,_().O)(),fe=(0,i().K8)((()=>(0,M().i)()),[]),ve=(0,O().X)("collections_xws"),Se=(0,r.useMemo)((()=>{if(!ge)return;const e=g().h0Y.fromGetRecordModelFn(B);return{sourceProperty:f,valueTypes:[he],handleDataRequest:(0,d().MC)({collectionFeatureGates:fe,experimentService:L().default,getRecordModel:B,loadRecordModel:e}),formulaPropertyNames:X&&(0,m().o2)(X),publicPageDataCollection:{id:null==ye?void 0:ye.collectionId,schema:null==ye?void 0:ye.collectionSchema},spaceId:ge,restrictUnaccessibleProperties:ve?"cross_space_only":void 0,featureGates:fe}}),[ge,B,f,he,X,null==ye?void 0:ye.collectionId,null==ye?void 0:ye.collectionSchema,fe,ve]),xe=(0,i().K8)((()=>{if("v2"!==K.version&&K.formula)return I.convertCollectionFormulaToFormula2(K.formula,me,z.getSchema())}),[me,z,I,K.formula,K.version]),be=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!xe||be.current||!Se)return;const e=await I.analyzeFormula(xe,Se);let t;t=v().Q.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},be.current=!0,ie(xe),le(t)}()}),[z,I,ie,le,f,K,xe,Se]);const je=(0,r.useMemo)((()=>{var e;const t="v2"===K.version?null===(e=K.formula2)||void 0===e?void 0:e.code:xe;return re.current=t,t}),[null===(c=K.formula2)||void 0===c?void 0:c.code,K.version,xe]),Ce=(0,T().C)(),Ae=(0,i().K8)((()=>{pe([]);const e=null==Y?void 0:Y.getModel(),t=null==Y?void 0:Y.getRecordModel;if(!e||!ee||!t||w().Pe||!$)return;const o=se?$.evaluateRawCollectionFormula2({block:e,property:f,formulaCode:ee,getRecordModel:t,intl:P().A.getIntl(),userTimeZone:(0,h().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+Ce,resultCache:new Map,regExpCache:new Map,publicPageDataCollection:{id:null==ye?void 0:ye.collectionId,schema:null==ye?void 0:ye.collectionSchema},experimentService:L().default,collectionFeatureGates:(0,M().i)()}):$.evaluateCollectionFormula2WithoutCache({block:e,property:f,formulaCode:ee,getRecordModel:t,intl:P().A.getIntl(),userTimeZone:(0,h().P)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+Ce,resultCache:new Map,regExpCache:new Map,publicPageDataCollection:{id:null==ye?void 0:ye.collectionId,schema:null==ye?void 0:ye.collectionSchema},experimentService:L().default,collectionFeatureGates:(0,M().i)()});if(o){if(!v().Q.isFail(o))return oe(ne.current),o.value;(0,u().eJ)(o.error)&&pe([o.error])}}),[Y,ee,se,f,Ce,ye,$]);return Se&&ge?(0,D.jsx)(E().A,{menuType:ue.isMobile?k().gu.Modal:k().gu.Popup,hideMobileTopbar:!0,width:ue.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,D.jsx)(V().v,{initialCode:je,outputFooter:void 0!==Y&&(0,D.jsx)(G,{formulaResult:Ae,isAdvancedMode:se,setIsAdvancedMode:de,formulaType:te,blockStore:Y,formulaSchema:K}),formulas:I,getRecordModel:B,focus:!0,disabled:S,parentSpaceId:ge,typecheckContext:Se,onCodeChange:ie,onTypeChange:le,handleClose:N,parentCollectionStore:z,evaluationErrors:ce})}):null}const G=r.memo((function(e){let{formulaResult:t,formulaType:a,blockStore:n,formulaSchema:i,isAdvancedMode:d,setIsAdvancedMode:p}=e;const u=(0,l().IS)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:S().J.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:S().J.UIRegular.desktop,color:e.text.secondary,marginRight:6,marginLeft:2},type:{fontSize:S().J.UISmall.desktop,color:e.text.secondary,marginLeft:6},iconStyle:{height:16,width:16},iconButtonStyle:{marginLeft:"auto"}})),[]),m=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:c().NY.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...o(828180).Cn[c().NY.Medium]}},store:n,isEmptyStore:o(757695).default.createValue(!1),canEdit:!1,disabled:!1,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:d?void 0:i,trackEditBlockProperty:()=>{},format:0,containerRef:null})),[n,i,d]),h=(0,r.useMemo)((()=>a?(0,s().getHumanReadableType)(a):o(145076).qY.unknown),[a]),y=(0,f().tz)(),g=d?y.formatMessage({id:"formulas.editor.toggleAdvancedModeOff",defaultMessage:"Hide details"}):y.formatMessage({id:"formulas.editor.toggleAdvancedModeOn",defaultMessage:"Show details"});return(0,D.jsx)(o(234359).L8.Provider,{value:m,children:(0,D.jsxs)("div",{style:u.output,children:[(0,D.jsx)("span",{style:u.equals,children:"="}),t&&(0,D.jsx)(z,{value:t,withComma:!1,blockStore:n,formulaSchema:i,isAdvancedMode:d,renderWrapper:!0}),d&&Boolean(t)&&(0,D.jsx)("span",{style:u.type,children:(0,D.jsx)(f().sA,{...h})}),(0,D.jsx)(o(859428).A,{renderTooltip:()=>g,placement:I().W.Top,alignment:I().C.Center,render:e=>(0,D.jsx)(o(285790).A,{icon:d?o(207583).F:o(305961).d,onClick:()=>{const e=!d;p(e),Z.setState(e)},iconStyle:u.iconStyle,style:u.iconButtonStyle,ariaLabel:g,...e})})]})})})),z=r.memo((function e(t){let{value:a,withComma:n,blockStore:s,formulaSchema:d,isAdvancedMode:c,renderWrapper:p}=t;const[u,m]=(0,i().K8)((()=>{var e;if(!a)return[[],"text"];if("undefined"===a.type&&c)return[[B().Or],"empty"];const t=(0,o(886578).O)(a,s.getRecordModel,(0,h().P)());return[t,(null===(e=t[0])||void 0===e?void 0:e.type)??"text"]}),[s.getRecordModel,c,a]),y=(0,l().IS)((e=>({rightBracket:{color:e.text.secondary,fontSize:S().J.UISmall.desktop,marginLeft:2},leftBracket:{color:e.text.secondary,fontSize:S().J.UISmall.desktop,marginRight:2},comma:{color:e.text.secondary,fontSize:S().J.UISmall.desktop,marginRight:2}})),[]);let g;if("array"===a.type)g=(0,D.jsxs)(r.Fragment,{children:[c?(0,D.jsx)("span",{style:y.leftBracket,children:"["}):null,a.values.map(((t,o)=>(0,D.jsx)(e,{value:t,withComma:o<a.values.length-1,blockStore:s,formulaSchema:d,isAdvancedMode:c,renderWrapper:!1},o))),c?(0,D.jsx)("span",{style:y.rightBracket,children:"]"}):null,n?(0,D.jsx)("span",{style:y.comma,children:", "}):""]});else{const e=n&&!c&&(0,B().GL)(m,d);g=null==u?void 0:u.map(((t,o)=>(0,D.jsxs)(r.Fragment,{children:[(0,D.jsx)(B().yZ,{token:t,targetPropertySchema:d,blockStore:s,withComma:e,numberRightAlign:!1,shouldTruncate:!1,disableLinks:!1}),c&&n?(0,D.jsx)("span",{style:y.comma,children:", "}):null]},`${t.id}-${o}`)))}return p&&!c?(0,D.jsx)(B().Ye,{propertyType:m,rootPropertySchema:d,numberRightAlign:!1,children:g}):(0,D.jsx)(r.Fragment,{children:g})})),Z=new(o(178624).R)({key:"formulas_show_details",namespace:o(419494).Bq,important:!0,trackingType:"preference"})},578194:(e,t,o)=>{o.d(t,{r:()=>r});const r=(0,o(583835).Dv)("importEvernote")},633961:(e,t,o)=>{o.d(t,{F:()=>a});o(296540);var r=o(474848);const a=(0,o(340498).wt)("people",{viewBox:"0 0 64 64",svg:(0,r.jsx)("path",{d:"m11,12c0-3.09,1.91-5,5-5s5,1.91,5,5-1.91,5-5,5-5-1.91-5-5Zm37,5c3.09,0,5-1.91,5-5s-1.91-5-5-5-5,1.91-5,5,1.91,5,5,5Zm4.75,14.5l1.76-3.53,4.01,8.03,4.47-2.24-3.57-7.13c-2.27-4.54-5.1-6.63-11.43-6.63s-9.16,2.09-11.43,6.63l-3.57,7.13,4.47,2.24,4.01-8.03,1.76,3.53-6.25,12.5h7v12h8v-12h7l-6.25-12.5Zm-30.17-3.39l3.95,7.89,4.47-2.24-3.57-7.13c-2.27-4.54-5.1-6.63-11.43-6.63s-9.16,2.09-11.43,6.63l-3.57,7.13,4.47,2.24,3.95-7.89c.38-.76.82-1.11,1.58-1.11v8l-7,21h6.32l5.68-17.03,5.68,17.03h6.32l-7-21v-8c.76,0,1.2.35,1.58,1.11Z"})})},756114:(e,t,o)=>{o.d(t,{D:()=>r});function r(e,t){t.route.name;return!1}},762447:(e,t,o)=>{o.d(t,{R:()=>a});o(296540);var r=o(474848);const a=(0,o(340498).wt)("target",{viewBox:"0 0 64 64",svg:(0,r.jsx)("path",{d:"m36,32c0,2.21-1.79,4-4,4s-4-1.79-4-4,1.79-4,4-4,4,1.79,4,4Zm20,0c0,13.25-10.75,24-24,24s-24-10.75-24-24,10.75-24,24-24,24,10.75,24,24Zm-6,0c0-9.94-8.06-18-18-18s-18,8.06-18,18,8.06,18,18,18,18-8.06,18-18Zm-4,0c0,7.73-6.27,14-14,14s-14-6.27-14-14,6.27-14,14-14,14,6.27,14,14Zm-6,0c0-4.42-3.58-8-8-8s-8,3.58-8,8,3.58,8,8,8,8-3.58,8-8Z"})})},798174:(e,t,o)=>{o.d(t,{C:()=>_,A:()=>R});var r=o(296540),a=()=>o(484714),n=()=>o(847249),i=()=>o(67657),l=()=>o(970013),s=()=>o(668725),d=()=>o(959013),c=()=>o(989423);var p=()=>o(497222),u=()=>o(175116),m=()=>o(722372),h=()=>o(476492),y=()=>o(722872),g=()=>o(553965),f=()=>o(463830),v=()=>o(630116),S=()=>o(760217),x=()=>o(406699),b=()=>o(939740),j=()=>o(897119),C=()=>o(89924),A=()=>o(859428),M=()=>o(398842),w=()=>o(195071),P=()=>o(250202),k=()=>o(150987),T=o(474848);let _=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});const R=function(e){let{context:t,schema:r,property:i,parentStore:l,onDismiss:s,disabled:c,analyticsFrom:u,onChange:m}=e;const h=(0,o(401497).DP)(),v=(0,a().v3)(),S=(0,n().uB)(void 0,f().A),C=(0,n().uB)(void 0,f().A),w=(0,n().uB)(void 0,f().A),P=(0,a().Y0)(),k=(0,n().K8)((()=>O(r,i,l)),[r,i,l]),R=Boolean(null==k?void 0:k.propertySchema.relation_property),B=Boolean((null==k?void 0:k.propertySchema.relation_property)&&(null==k?void 0:k.propertySchema.target_property)),E=(0,n().K8)((()=>o(496603).oE([U(v,h,c,r,i,l,u,w,m),N(R,v,h,c,r,i,l,u,C,m),Y(B,v,h,c,r,i,l,u,S,m)])),[R,B,v,h,c,r,i,l,u,m,S,w,C]),V=(0,n().K8)((()=>S.state.open),[S]),D=(0,n().K8)((()=>w.state.open),[w]),W=(0,n().K8)((()=>C.state.open),[C]);if(!k)return null;if(t===_.BlockPropertyOverlay){let e;return e=P.isMobile?{menuType:y().gu.Modal,title:k.propertySchema.name,right:(0,T.jsx)(o(480095).DoneMenuText,{}),onClickRight:s}:{menuType:y().gu.Popup},(0,T.jsx)(o(928600).A,{...e,children:(0,T.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:E})})}return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(x().Ay,{popupType:P.isMobile?j().nl.SlideUp:j().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:e=>(0,T.jsx)(p().A,{title:(0,T.jsx)(d().sA,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:c,showChevron:!0,rotateChevron:D,right:k.relationPropertySchema?(0,T.jsx)(M().mA,{propertySchema:k.relationPropertySchema,showIcon:!0}):(0,T.jsx)(d().sA,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,T.jsx)(G,{parent:e,analyticsFrom:u,schema:r,property:i,parentStore:l,onChange:m}),buttonPopupStore:w}),(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(F,{}),disableTooltip:R,render:e=>(0,T.jsx)(x().Ay,{popupType:P.isMobile?j().nl.SlideUp:j().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:t=>(0,T.jsx)(p().A,{title:(0,T.jsx)("span",{style:{...!B&&{color:h.text.secondary}},children:(0,T.jsx)(d().sA,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})}),disabled:!R||c,showChevron:!0,rotateChevron:W,right:R&&(k.targetPropertySchema?(0,T.jsx)(M().mA,{propertySchema:k.targetPropertySchema,showIcon:!0}):(0,T.jsx)(d().sA,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"})),...(0,g().A)(e,t)}),render:e=>(0,T.jsx)(z,{parent:e,analyticsFrom:u,schema:r,property:i,parentStore:l,onChange:m}),buttonPopupStore:C})}),(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(L,{}),disableTooltip:B,render:e=>(0,T.jsx)(x().Ay,{popupType:P.isMobile?j().nl.SlideUp:j().nl.Popup,alignmentToOrigin:x().yP.End,renderOrigin:t=>(0,T.jsx)(p().A,{disabled:!B||c,title:(0,T.jsx)("span",{style:{...!B&&{color:h.text.secondary}},children:(0,T.jsx)(d().sA,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:V,right:B&&(0,T.jsx)(I,{schema:r,property:i,parentStore:l}),...(0,g().A)(e,t)}),render:e=>(0,T.jsx)(Z,{parent:e,analyticsFrom:u,schema:r,property:i,parentStore:l,onChange:m}),buttonPopupStore:S})})]})};function O(e,t,o){var r;const a=e[t];if(!a)return;let n,i;if(a.relation_property){const t=e[a.relation_property];t&&"relation"===t.type&&(n=t)}if(n){const e=l().Nv(n);i=e?v().md.createChildStore(o,e):void 0}const s=null===(r=i)||void 0===r?void 0:r.getValue(),d=s?l().Dp(s):{};let c;if(s&&a.target_property){var p;c=d[(null===(p=i)||void 0===p?void 0:p.getMappedProperty(a.target_property))??a.target_property]}return{propertySchema:a,relationPropertySchema:n,relatedCollectionValue:s,relatedCollectionSchema:d,targetPropertySchema:c}}function I(e){let{schema:t,property:o,parentStore:r}=e;const a=(0,n().K8)((()=>O(t,o,r)),[r,o,t]);return a?a.propertySchema.aggregation?(0,T.jsx)(T.Fragment,{children:m().zY[(0,i().ZP)(a.propertySchema.aggregation)]}):(0,T.jsx)(d().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function F(){return(0,T.jsx)(d().sA,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function L(){return(0,T.jsx)(d().sA,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function B(e,t){return e?void 0:(0,s().b)({width:11,fill:t.mediumIconColor})}function E(e){return"relation"===e.type}function V(e){return"rollup"!==e.type&&!(0,l().rK)(e.type)}function D(e,t,o,r,a,n,i,l){const s=O(r,a,n);if(!s)return;const d={...s.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==i||i({propertySchema:d}),function(e,t){c().vd(e,"configure_rollup_relation",t)}(t,{...(0,h().sl)(l),from:o})}function W(e,t,o,r,a,n,i,l){const s=O(r,a,n);if(!s||!s.relatedCollectionValue||!s.relatedCollectionSchema)return;const d=s.relatedCollectionSchema[e];if(!d)return;const p={...s.propertySchema,target_property:e,target_property_type:d.type,aggregation:void 0};null==i||i({propertySchema:p}),function(e,t){c().vd(e,"configure_rollup_target_property",t)}(t,{...(0,h().sl)(l),from:o,property_type:d.type})}function K(e,t,o,r,a,n,l,s){const d=O(r,a,n);if(!d)return;const p={...d.propertySchema,aggregation:e,show_as:void 0};null==l||l({propertySchema:p});const u=e?(0,i().ZP)(e):void 0;!function(e,t){c().vd(e,"configure_rollup_aggregation",t)}(t,{...(0,h().sl)(s),from:o,aggregation:u})}function G(e){let{parent:t,analyticsFrom:o,schema:n,property:i,parentStore:l,onChange:s}=e;const d=(0,a().v3)(),c=(0,u().ET)(),p=(0,r.useCallback)((e=>D(e,d,o,n,i,l,s,c)),[d,o,n,i,l,s,c]);return(0,T.jsx)(k().A,{schema:n,isRelationProperty:!0,onAccept:p,onClose:t.close,allowProperty:E})}function z(e){let{parent:t,analyticsFrom:o,schema:i,property:l,parentStore:s,onChange:d}=e;const c=(0,a().v3)(),p=(0,u().ET)(),m=(0,r.useCallback)((e=>W(e,c,o,i,l,s,d,p)),[c,o,i,l,s,d,p]),h=(0,n().K8)((()=>O(i,l,s)),[s,l,i]);return h?(0,T.jsx)(k().A,{isRelationProperty:!1,schema:h.relatedCollectionSchema,onAccept:m,allowProperty:V,onClose:t.close}):null}function Z(e){let{parent:t,analyticsFrom:o,schema:i,property:l,parentStore:s,onChange:c}=e;const p=(0,a().v3)(),m=(0,u().ET)(),h=(0,r.useCallback)((e=>K(e,p,o,i,l,s,c,m)),[p,o,i,l,s,c,m]),y=(0,n().K8)((()=>O(i,l,s)),[s,l,i]);return y&&y.propertySchema.target_property?(0,T.jsx)(w().A,{property:y.propertySchema.target_property,schema:y.relatedCollectionSchema,currentAggregation:y.propertySchema.aggregation?{aggregator:y.propertySchema.aggregation,property:y.propertySchema.target_property}:void 0,onChange:h,onClose:t.close,noneText:(0,T.jsx)(d().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"}):null}function U(e,t,o,r,a,n,i,l,s){const{device:c}=e,p=O(r,a,n);if(p)return{key:0,render:e=>(0,T.jsx)(C().A,{...e,title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"})}),items:[{key:0,render:e=>(0,T.jsx)(x().Ay,{popupType:c.isMobile?j().nl.SlideUp:j().nl.Popup,renderOrigin:r=>p.relationPropertySchema?(0,T.jsx)(P().G,{...(0,g().A)(e,r),propertySchema:p.relationPropertySchema,format:P().e.Name,right:B(o,t),disabled:o}):(0,T.jsx)(S().A,{...(0,g().A)(e,r),title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:B(o,t),style:{color:t.text.secondary},disabled:o}),render:e=>(0,T.jsx)(G,{parent:e,analyticsFrom:i,schema:r,property:a,parentStore:n,onChange:s}),buttonPopupStore:l},e.key),action:()=>{l.setState({open:!0})}}]}}function N(e,t,o,r,a,n,i,l,s,c){const{device:p}=t,u=O(a,n,i);if(u)return{key:1,render:e=>(0,T.jsx)(C().A,{...e,title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0}),items:[{key:0,render:t=>(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(F,{}),disableTooltip:e,render:m=>(0,T.jsx)(x().Ay,{popupType:p.isMobile?j().nl.SlideUp:j().nl.Popup,renderOrigin:a=>u.targetPropertySchema?(0,T.jsx)(P().G,{...(0,g().A)(t,a),propertySchema:u.targetPropertySchema,format:P().e.Name,right:B(r,o),disabled:r}):(0,T.jsx)(S().A,{...(0,g().A)(t,m),title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to display…"}),right:B(!e||r,o),disabled:!e||r,disabledFeedback:!0}),render:e=>(0,T.jsx)(z,{parent:e,analyticsFrom:l,schema:a,property:n,parentStore:i,onChange:c}),buttonPopupStore:s})},t.key),action:()=>{s.setState({open:!0})}}]}}function Y(e,t,o,r,a,n,i,l,s,c){const{device:p}=t;if(O(a,n,i))return{key:2,render:e=>(0,T.jsx)(C().A,{...e,title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0}),items:[{key:0,render:t=>(0,T.jsx)(A().A,{renderTooltip:()=>(0,T.jsx)(L,{}),disableTooltip:e,render:u=>e?(0,T.jsx)(x().Ay,{popupType:p.isMobile?j().nl.SlideUp:j().nl.Popup,renderOrigin:e=>(0,T.jsx)(S().A,{...(0,g().A)(t,e),title:(0,T.jsx)(I,{schema:a,property:n,parentStore:i}),right:B(r,o),disabled:r}),render:e=>(0,T.jsx)(Z,{parent:e,analyticsFrom:l,schema:a,property:n,parentStore:i,onChange:c}),buttonPopupStore:s}):(0,T.jsx)(S().A,{...(0,g().A)(t,u),title:(0,T.jsx)(d().sA,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:B(r,o),disabled:!0,disabledFeedback:!0})},t.key),action:()=>{s.setState({open:!0})}}]}}},814777:(e,t,o)=>{o.d(t,{h:()=>D});o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var r=o(296540),a=()=>o(484714),n=()=>o(847249),i=()=>o(784892),l=()=>o(396350),s=()=>o(748054),d=()=>o(236262),c=()=>o(519831),p=()=>o(959013),u=()=>o(100622),m=()=>o(496603),h=()=>o(284371),y=()=>o(901952),g=()=>o(193722),f=()=>o(596359),v=()=>o(901389),S=()=>o(539148),x=()=>o(705602),b=()=>o(828973),j=()=>o(175116),C=()=>o(476492),A=()=>o(722872),M=()=>o(963589),w=()=>o(377586),P=()=>o(831194),k=()=>o(575143),T=()=>o(419357),_=()=>o(928600),R=()=>o(939740),O=()=>o(480095),I=()=>o(897119),F=()=>o(89924),L=()=>o(893952),B=()=>o(399762),E=o(474848);const V=o(757695).default.createClass(!1,{name:"ShowSelectDescriptionStore"});function D(e){let{onClose:t,collectionId:o,propertySchema:i,property:l,onChange:s,option:d,analyticsFrom:c,statusGroup:p,origin:u,open:m,alignmentToOrigin:h}=e;const y=(0,a().v3)(),g=(0,j().ET)(),f=(0,n().uB)(void 0,V),[v,S]=(0,r.useState)(""),x=(0,r.useRef)(m);(0,r.useEffect)((()=>{!x.current&&m&&S(d.value),x.current=m}),[m,d.value]);const b=(0,r.useCallback)((()=>(0,E.jsx)(W,{collectionContextStore:g,onClose:t,collectionId:o,propertySchema:i,property:l,onChange:s,option:d,analyticsFrom:c,statusGroup:p,renameInputValue:v,setRenameInputValue:S,showSelectDescriptionStore:f})),[g,t,o,i,l,s,d,c,p,v,S,f]),C=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i,l,s){o(),K(e,t,r,a,n,i,l,s)}(y,g,t,o,i,l,s,d,v)),[y,g,t,o,i,l,s,d,v]),{device:A}=y,P=(0,M().X)("db_ux_mobile");return(0,E.jsx)(I().Ay,{popupType:A.isMobile?P?w().n.BottomSheet:w().n.SlideUp:w().n.Popup,open:m,onDismiss:C,origin:u,render:b,alignmentToOrigin:h})}function W(e){let{collectionContextStore:t,onClose:o,collectionId:m,propertySchema:y,property:j,onChange:w,option:I,analyticsFrom:V,statusGroup:D,renameInputValue:W,setRenameInputValue:G,showSelectDescriptionStore:z}=e;const Z=(0,p().tz)(),U=(0,a().v3)(),N=(0,M().X)("db_ux_mobile"),Y=(0,n().K8)((()=>t.collectionStore()),[t]),J=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t(o)}(e,G)),[G]),H=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i,l,s){o(),K(e,t,r,a,n,i,l,s)}(U,t,o,m,y,j,w,I,W)),[U,t,o,m,y,j,w,I,W]),q=(0,r.useCallback)((()=>{if(Y)return function(e,t,o,r,a,n,i,l,s){f().r$({environment:e,option:t,property:a,propertySchema:r,collectionStore:i,statusGroup:l}),n(),(0,g().L)(e,{...(0,C().sl)(s),property_type:r.type,action:"select_delete_option",from:o})}(U,I,V,y,j,o,Y,D,t)}),[U,I,Y,V,y,j,o,D,t]),{device:$}=U,X=(0,n().O$)(z),Q=[];X&&Q.push({key:"description",render:e=>(0,E.jsx)(F().A,{...e,desktopStyle:{paddingTop:0},title:$.isMobile?Z.formatMessage(x().s.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,E.jsx)(x().y,{...e,initialDescription:I.description,handleSaveDescription:e=>function(e,t,o,r,a,n,i,l){if(e===(l.description??""))return;const s={...l,description:e},d={pointer:{table:c().Vl,id:r},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:s}};o([d]),(0,g().L)(t,{property_type:n.type,action:"select_set_description",from:i})}(e,U,w,m,j,y,V,I),disableAutoSection:!0}),action:()=>{}}]});const ee={key:"action",render:e=>(0,E.jsx)(F().A,{...e}),items:[]};Q.push(ee),ee.items.push({key:"delete",render:e=>(0,E.jsx)(k().A,{...e,title:(0,E.jsx)(p().sA,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:d().trashIcon}),action:q}),D&&"status"===y.type&&(ee.items.push({key:"setAsDefault",render:e=>(0,E.jsx)(k().A,{...e,title:(0,E.jsx)(p().sA,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:s().M}),action:()=>async function(e,t,o,r,a,n,i,l,s){if("status"!==o.type||!s)return;if(n.value===o.defaultOption)return;if(void 0!==o.defaultOption){const{accept:e}=await v().Gh({mode:"wide",message:(0,E.jsx)(p().sA,{defaultMessage:'Change default to "{defaultValue}"?',id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:n.value}}),description:(0,E.jsx)(p().sA,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:n.value,b:e=>(0,E.jsx)("span",{style:{fontWeight:h().Wy.semibold},children:e})}}),acceptLabel:(0,E.jsx)(p().sA,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})});if(!e)return}const d={table:c().Vl,id:e},u=[],m={pointer:d,command:"update",path:["schema",t],args:{defaultOption:n.value}};u.push(m),r(u),i(),(0,g().L)(l,{property_type:o.type,action:"status_set_default",from:a,collection_id:e})}(m,j,y,w,V,I,o,U,D)}),ee.items.push({key:"Group",render:e=>(0,E.jsx)("div",{...e,children:(0,E.jsx)(b().A,{...e,title:(0,E.jsx)(p().sA,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:D.name,options:(y.groups??[]).map((e=>({key:e.name,type:"button",title:P().OR[e.name]??e.name}))),icon:l().i,onChange:e=>{!function(e,t,o,r,a,n,i,l,s){if("status"!==i.type||!s)return;const d={table:c().Vl,id:t},p=[],u=i.groups??[],m=u.findIndex((e=>e.id===s.id)),h=u.findIndex((t=>t.name===e));if(m===h)return;const y={pointer:d,command:"listRemove",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}},f={pointer:d,command:"listAfter",path:["schema",r,"groups",h,"optionIds"],args:{id:o.id}};p.push(y,f);const v=i.options??[],S=u.flatMap((e=>{const t=e.optionIds??[],o=v.filter((e=>t.includes(e.id)));return o})),x={pointer:d,command:"set",path:["schema",r,"options"],args:S};p.push(x),a(p),(0,g().L)(l,{property_type:i.type,action:"status_set_default",from:n,collection_id:t})}(e,m,I,j,w,V,y,U,D)}})}),action:()=>{}}));const te=u().tS.map((e=>{const t={key:e,render:t=>(0,E.jsx)(L().A,{...t,color:e,isChecked:I.color===e}),action:()=>{!function(e,t,o,r,a,n,i,l){const s={...t,color:e},d={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:s}};n([d]),(0,g().L)(l,{property_type:a.type,action:"select_change_color",from:i,collection_id:o})}(e,I,m,j,y,w,V,U)}};return t})),oe={key:"color",render:e=>(0,E.jsx)(F().A,{...e,title:(0,E.jsx)(p().sA,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),topBorder:!0}),items:te};let re;return Q.push(oe),re=$.isMobile?{menuType:A().gu.Modal,title:(0,E.jsx)(B().O,{format:i().NY.Large,value:I.value,color:I.color,showRemoveButton:!1,isSingle:!0}),...!N&&{right:(0,E.jsx)(O().DoneMenuText,{}),onClickRight:H}}:{menuType:A().gu.Popup,width:220},(0,E.jsxs)(_().A,{...re,children:[(0,E.jsx)(F().A,{isInput:!0,children:(0,E.jsx)(T().Ay,{focusInitial:!0,selectAll:!$.isMobile,value:W,maxlength:180,onChange:J,onSubmit:H,showClearButton:!1,inputRight:(0,E.jsx)(S().S,{onClick:()=>z.setState(!X),description:I.description,showTooltip:!X})})}),(0,E.jsx)(R().Ay,{type:R().Oh.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:Q})]})}function K(e,t,o,r,a,n,i,l){const s=l,d=r.options||[],u=d.find((e=>e.id!==i.id&&e.value.trim().toLowerCase()===s.trim().toLowerCase()));if(i.value!==s)if(s)if(u)v().f1((0,E.jsx)(p().sA,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const l=d.find((e=>e.id===i.id));if(!l)return;const p=s.trim(),u={...l,value:p},h={pointer:{table:c().Vl,id:o},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:u}},g="status"===r.type&&i.value===r.defaultOption?{pointer:{table:c().Vl,id:o},command:"update",path:["schema",a],args:{defaultOption:p}}:void 0;n(m().oE([h,g])),(0,y().V)({environment:e,collectionContextStore:t,property:a,from:"view_settings",action:"select_rename_option",option_value_char_count:p.length})}else v().f1((0,E.jsx)(p().sA,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}}}]);