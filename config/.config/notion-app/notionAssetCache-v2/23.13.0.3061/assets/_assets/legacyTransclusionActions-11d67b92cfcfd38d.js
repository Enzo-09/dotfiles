"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[90871,99314],{390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>D,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>A,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>C,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>v,RRULE_WEEKDAYS_MAP:()=>g,adjustedStartDateIfPossible:()=>E,areRecurrenceSchedulesEqual:()=>L,convertFromUnpersistedRecurrenceConfig:()=>B,convertToUnpersistedRecurrenceConfig:()=>U,getFormattedEndCondition:()=>I,getFormattedNextRecurrenceTime:()=>S,getNewEndTimestamp:()=>P,getNextDateUtc:()=>T,getRecurrenceAfter:()=>w,isRunningBetweenMidnightAnd3AM:()=>k,isValidRecurrenceInterval:()=>_,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>R,templateAncestorsViolateRecurrenceNesting:()=>M});n(898992),n(354520),n(581454);var r=()=>n(244641);n(944114);function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...o(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),s=()=>n(720665),c=()=>n(597777),d=()=>n(869190),l=()=>n(416504),u=()=>n(402390);class f extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>n(912720);const p=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),h={day:f.DAILY,week:f.WEEKLY,month:f.MONTHLY,year:f.YEARLY},g={MO:f.MO,TU:f.TU,WE:f.WE,TH:f.TH,FR:f.FR,SA:f.SA,SU:f.SU},y=99,v=999;function _(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function b(e){return(0,s().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function R(e){const{start_date:t,frequency:n,interval:r,weekdays:i,timezone:s,hour:d,minute:l}=e,u="week"===n&&i?i.map((e=>g[e])):void 0,m={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?m.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?m.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?m.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?m.byweekday=o(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return g[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new f({freq:h[n],dtstart:(0,c().eU)(t),interval:r,byweekday:u,tzid:s,byhour:d??0,byminute:l??0,bysecond:0,...m})}const C=1,A=1;function M(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,o=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>C,a=n.length>=A;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:o}}function E(e){var t;const{recurrence:n,afterDate:o}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=o)return n;let i=r().c9.fromMillis(n.start_date,{zone:"utc"});const a=r().c9.fromMillis(o,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,c().DH)(i.toMillis())}}function w(e){const{recurrence:t,afterDate:n}=e;if((0,m().wt)(t)){const e=(0,c().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=R(E({recurrence:t,afterDate:n})).after((0,c().eU)(n));if(!e)return;return(0,c().h1)(e)}}function k(e){return 0===e.hour||1===e.hour||2===e.hour}function T(e){return R(e).after((0,c().eU)((0,c().Rz)()))||void 0}function S(e){const{recurrence:t,intl:n}=e,o=T(B(t));if(!o)return;const i=k(t),a=r().c9.fromJSDate(o).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),s=(0,d().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:s});{let e=a.toLocaleString(r().c9.TIME_SIMPLE);return t.timezone!==(0,l().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:s,time:e})}}function I(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,d().Yq)({date:r().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(p.noEndCondition)}const D=100;function U(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function P(e,t,n){return e.plus(n-t)}function N(e,t){const n=r().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(n.toJSDate())}}function B(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?N(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function L(e,t){const n=i().fN(e,(e=>void 0!==e)),r=i().fN(t,(e=>void 0!==e));return i().n4(n,r)}},456116:(e,t,n)=>{n.r(t),n.d(t,{fixLegacyTransclusion:()=>R,maybeAutofixLegacyTransclusionProperty:()=>b});n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var r=()=>n(857639),o=()=>n(179034),i=()=>n(161479),a=()=>n(502800),s=()=>n(183324),c=()=>n(59110),d=()=>n(594794),l=()=>n(611191),u=()=>n(299545),f=()=>n(589994),m=()=>n(630116),p=()=>n(679156),h=()=>n(722101),g=()=>n(797265),y=()=>n(778417),v=()=>n(751156);const _=new Set(["text","table_row","header","sub_header","sub_sub_header","to_do","bulleted_list","numbered_list","toggle"]);function b(e){const{parentStore:t,transaction:n,store:i,environment:u}=e,g=i.path[1];if(2!==i.path.length||"properties"!==i.path[0]||"string"!=typeof g)return;const y=i.getRecordStoreAtRootPath();if(!(y instanceof m().Bv))return;const v=y.getType();if(!v||!_.has(v))return;const b=function(e){var t;const{environment:n,store:r,parentStore:i,transaction:a}=e;if(r.getSpaceId()!==i.getSpaceId())return;const u=null===(t=i.getModel())||void 0===t?void 0:t.getContentIds();if(null==u||!u.includes(r.id))return;if(f().transactionQueue.isPendingTransactionForRecord(i.pointer)||f().transactionQueue.isPendingTransactionForRecord(r.pointer))return;const m=(0,l().$J)(),p=(0,c().loadLocalSubtree)(n,{blockId:r.id,inMemoryRecordCache:r.inMemoryRecordCache,allowCopyCollections:!1,requireFullSubtree:!0,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0,includeLegacyTransclusionBlockValues:m}).recordMap;if(!p)return;const g=s().localDuplicate({environment:n,sourceBlockId:r.id,targetBlockPointer:(0,d().zP)({environment:n,table:o().ev,spaceId:r.pointer.spaceId}),sourceBlockSubtree:p,targetInMemoryRecordCache:r.inMemoryRecordCache,transaction:a,options:{deepCopyTransclusionContainers:!1,resolveTemplateVariables:!1,preventLegacyTransclusions:m}});return h().Br({parentStore:i.getContentStore(),oldChildStore:r,newChildStore:g.targetBlockStore,transaction:a}),g.targetBlockStore}({environment:u,store:y,parentStore:t,transaction:n});if(!b)return;const R=b.getPropertyStore(g);if(R)return n.postSubmitCallbacks.push((e=>{e&&r().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{miscErrorString:(0,a().WS)(e)}}),p().Yr(u,{block_type:v,successful:!e})})),R;r().log({from:"legacyTransclusionActions",level:"error",type:"maybeAutofixLegacyTransclusionProperty",error:{message:"copied transclusion block does not have expected property"}})}function R(e){const{environment:t,store:n}=e,r=n.getRecordStoreUIParent();r&&(0,u().iU)(r)&&v().createAndCommit({userAction:"legacyTransclusionActions.fixLegacyTransclusion",environment:t,canUndo:!0,perform:e=>{const{blockStores:o}=s().duplicateBlock({environment:t,stores:[n],transaction:e,targetSpaceId:(0,i().e)(n.pointer.spaceId),preferDuplicateLocation:"local",options:{addCopyName:!1,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!1}}),a=o[0],{childStore:c}=h().WH({parentStore:r,insertStore:a,afterStore:n,transaction:e});g().TF({store:n,transaction:e}),y().td({environment:t,stores:[c]})}})}},603815:(e,t,n)=>{n.d(t,{A$:()=>E,JQ:()=>w,Vn:()=>A,s4:()=>M});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454);var r=()=>n(857639),o=()=>n(585515),i=()=>n(577449),a=()=>n(388821),s=()=>n(179034),c=()=>n(545285),d=()=>n(534177),l=()=>n(449506),u=()=>n(780054),f=()=>n(989423),m=()=>n(870618),p=()=>n(303626),h=()=>n(14307),g=()=>n(245865),y=()=>n(540758),v=()=>n(670631),_=()=>n(508496),b=()=>n(571963),R=()=>n(603815),C=()=>n(108944);async function A(e){const{environment:t,request:n,abortSignal:r,prefetchCacheKey:o,headers:i}=e;return(0,b().updateLoadCachedPageChunkCalledAt)(),h().isConnected()||h().isConnecting()?l().callApi({eventName:"loadCachedPageChunkV2",environment:t,data:n,abortSignal:r,prefetchCacheKey:o,headers:i}):l().callApi({eventName:"loadPageChunkV2",environment:t,data:n,abortSignal:r,prefetchCacheKey:o,headers:i})}async function M(e){const{mode:t,environment:n,request:d,isFirstChunk:l,abortSignal:h}=e,g={...d,limit:30,cursor:d.cursor||{stack:[]},baseUrl:u().A.domainBaseUrl,publicDomainName:u().A.publicDomainName};if("inMemoryAndDiskCacheWithInexactPreload"===t&&(await R().A$(n,{id:d.page.id,table:s().ev}),null!=h&&h.aborted))throw new Error("Abort signal received");const _=a().RecordMapWithRole.create(),b=[];let C=!1;const A=new Set,M=await o().T(g,i().h.fromMonomorphicFunctionUnsafe((async e=>{const r=await m().h7({environment:n,pointer:e,abortSignal:h,useInMemoryCacheOnly:"inMemoryOnly"===t});if(null!=h&&h.aborted)throw new Error("Abort signal received");if(r)return _.setModelAndRole(e,r.model,r.role),r.model;if("inMemoryOnly"===t)throw new Error(`Record not found: ${e.table},${e.id}`);if((0,c().u)(e)&&!A.has(e.id)&&l){if(void 0===v().A.state.offlinePages)return b.push(e),void(C=!0);if(void 0===v().A.state.offlinePages||!y().Bd(d.page.id))throw new Error(`Record not found: ${e.table},${e.id}`);b.push(e)}})),((e,t,n,r)=>{p().N.enableLogging&&console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${n})`),null!=r&&r.suppressErrorOnClient&&A.add(t.id)}));if(C&&(await v().A.waitUntil((()=>void 0!==v().A.state.offlinePages)),!y().Bd(d.page.id))){const[e]=b;throw new Error(`Record not found: ${e.table},${e.id}`)}if(b.length>0&&(0,f().LM)({eventName:"offline_page_was_missing_records_in_cache",sampling:{behavior:"statsig",fallbackBehavior:"statsig",statsigNotAvailableBehavior:"drop"}}).then((e=>{(0,f().u4)({environment:n,event:{eventName:"offline_page_was_missing_records_in_cache",eventProperties:{}},opts:{sampling:{behavior:"decided",sampleDecision:e}}}),e&&r().log({level:"error",from:"loadingHelpers",type:"offlinePageWasMissingRecordsInCache",data:{pageId:d.page.id,missingRecords:b}})})),null!=h&&h.aborted)throw new Error("Abort signal received");return{recordMap:_.toJson(),cursor:M.cursorValue}}async function E(e,t){const n=e.currentUser.id;if(!n||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:n})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),g().unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}function w(e){if(!_().default.checkGate({gateName:"load_page_chunk_omit_existing_record_versions"}))return;const t=a().RecordMapPolymorphic.create();let n=0;const r=()=>n>=50,o=e=>{"space"!==(null==e?void 0:e.table)&&(r()||e&&void 0===t.get(e.pointer)&&(t.set(e.pointer,e.getVersion()),n++))};if(e.isReady())for(const a of(0,C().E)(e))o(a);if(e.userId){const t=e.environment.defaultRecordCache.inMemoryRecordCache.data.getUserRecordMap(e.userId);o(t.getModel({table:"notion_user",id:e.userId}));let n=0;for(const e of t.getPointersByTable("notion_user")){if(r()||n>=10)break;n++,o(t.getModel(e))}}const i=Array.from(t).map((e=>{let{pointer:t,value:n}=e;if(void 0!==n)return{pointer:t,version:n}})).filter(d().O9);return i.length?i:void 0}},725649:(e,t,n)=>{function r(e){return!(!e||"askUserToPick"in e)}function o(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>o,K$:()=>r,j6:()=>i})}}]);