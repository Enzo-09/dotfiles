"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53638],{75544:(e,t,r)=>{r.d(t,{A:()=>m});r(517642),r(658004),r(733853),r(845876),r(432475),r(515024),r(731698),r(898992),r(354520);var o=r(296540),n=()=>r(908006),l=()=>r(847249),s=()=>r(737658),a=()=>r(336811),i=()=>r(496603),c=()=>r(183558),u=()=>r(921598);function d(e){const{reducerId:t,instanceId:r,reducer:o,collectionContextStore:n,groupsPointer:l}=e,s=n.reducersStore.state,a=s[t];let c,d;if(l&&l.length>0&&(c=(0,u().Hm)(l)),o){if(d={instanceIds:i().sb([...(null==a?void 0:a.instanceIds)||[],r]),reducer:o},c){n.reducerDependencies.has(c)||n.reducerDependencies.set(c,new Set);const e=n.reducerDependencies.get(c);null==e||e.add(t)}}else{if(c){const e=n.reducerDependencies.get(c);e&&(e.delete(t),0===e.size&&n.reducerDependencies.delete(c))}const e=i().FF((null==a?void 0:a.instanceIds)||[],r);d=a&&e.length>0?{instanceIds:e,reducer:a.reducer}:void 0}i().n4(a,d)||n.reducersStore.setState({...s,[t]:d})}function m(e){const{id:t,reducer:r,collectionContextStore:u,groupsPointer:m,debounceWait:p}=e,f=(0,l().K8)((()=>m),[m],{useDeepEqual:!0}),y=(0,l().K8)((()=>r),[r],{useDeepEqual:!0}),g=(0,l().K8)((()=>u.collectionViewStore()),[u]),v=(0,l().K8)((()=>u.normalizedFormatStore.state.collection_pointer),[u.normalizedFormatStore]),S=(0,l().K8)((()=>{var e;return null==g||null===(e=g.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_view_source").getValue()}),[g]),h=(0,o.useRef)(!1),b=(0,a().O)(),[x,C]=(0,o.useReducer)(((e,t)=>i().n4(e,t)?e:t),void 0),R=(0,o.useCallback)((()=>{const e=u.localResultStore.state,r=u.remoteResultStore.state,o=e&&"reducer"===e.type?e.reducerResults[t]:void 0,n=r&&"reducer"===r.type?r.reducerResults[t]:void 0;return function(e){const{reducerId:t,localReducerResult:r,remoteReducerResult:o,collectionContextStore:n,reducer:l}=e,a=n.reducersStore.state,c=n.remoteResultStore.state,u=n.isClientModeEnabledStore.state;if(u)return r;const d=n.isCreatingNewChartCollectionStore.state,m=n.wasCreatedThisSessionStore.state;if("aggregation"===l.type){if(d&&m){return Boolean(o&&"aggregation"===o.type&&"number"===o.aggregationResult.type&&0!==o.aggregationResult.value)&&n.isCreatingNewChartCollectionStore.setState(!1),r}if(o)return o;const e=Boolean(c&&"reducer"===c.type&&i().I6(c.reducerResults,((e,t)=>{const r=a[t];return!!r&&Boolean("results"===r.reducer.type&&!r.reducer.searchQuery&&"results"===e.type&&e.hasMore&&i().n4(l.filter,r.reducer.filter))})));return e?r:o}if("groups"===l.type){if(d&&m){return Boolean(o&&"groups"===o.type&&("v2"===o.version?o.hasMore:0!==o.total))&&n.isCreatingNewChartCollectionStore.setState(!1),r}if("v2"===l.version){var p;let e,t,a;if(l.aggregation&&(o&&"groups"===o.type&&"v2"===o.version?e=o.aggregationResults:r&&"groups"===r.type&&"v2"===r.version&&(e=r.aggregationResults)),l.blockResults){var f;const e=Boolean(o&&"groups"===o.type&&"v2"===o.version&&o.blockResults),l=null===(f=n.collectionViewStore())||void 0===f?void 0:f.getCollectionSource(),a=(0,s().TR)(l)||(0,s().hJ)(l);if((e||m)&&!a&&r&&"groups"===r.type&&"v2"===r.version&&r.blockResults){const e=r.blockResults,n="groups"===(null==o?void 0:o.type)&&"v2"===o.version&&o.blockResults?o.blockResults:{},l=new Set([...Object.keys(e),...Object.keys(n)]),s={};for(const t of l){const r=e[t],o=n[t];let l=[];r?l=r.blockIds:o&&(l=o.blockIds);let a=!1;o?a=o.hasMore:r&&(a=r.hasMore),s[t]={blockIds:l,hasMore:a}}t=s}}r&&"groups"===r.type&&"v2"===r.version&&r.pinnedResults&&(a=r.pinnedResults),o&&"groups"===o.type&&"v2"===o.version&&o.pinnedResults&&(a={groupResults:o.pinnedResults.groupResults,...a,aggregationResults:o.pinnedResults.aggregationResults});let i,c=!1;o&&"groups"===o.type&&"v2"===o.version?(c=o.hasMore,i=o.hasMoreSubGroups):r&&"groups"===r.type&&"v2"===r.version&&(c=r.hasMore,i=r.hasMoreSubGroups);let u=r??o;return n.forceLocalQueryCollection&&(u=o??r),"groups"===(null===(p=u)||void 0===p?void 0:p.type)&&"v2"===u.version?{...u,pinnedResults:a,hasMore:c,hasMoreSubGroups:i,blockResults:t??u.blockResults,aggregationResults:e}:void 0}return o||r}if("results"===l.type){var y;const e=n.wasCreatedThisSessionStore.state,l=Boolean(c&&"reducer"===c.type&&c.reducerResults[t]),a=null===(y=n.collectionViewStore())||void 0===y?void 0:y.getCollectionSource(),i=(0,s().TR)(a)||(0,s().hJ)(a);if((l||e)&&!i&&r&&"results"===r.type){return{...r,hasMore:o&&"results"===o.type?o.hasMore:r.hasMore}}return o}}({reducerId:t,collectionContextStore:u,reducer:y,localReducerResult:o,remoteReducerResult:n})}),[u,y,t]),k=(0,o.useCallback)((()=>{h.current=!1,b.current||C(R())}),[R,b]),j=(0,o.useCallback)((()=>{h.current||(h.current=!0,n().default.afterNextFlush(k))}),[k]),[M]=(0,o.useState)((()=>(0,c().Ay)()));return(0,o.useEffect)((()=>{const e=p?(0,i().sg)(j,p,{leading:!0}):j;return u.remoteResultStore.addListener(j),u.localResultStore.addListener(e),()=>{u.remoteResultStore.removeListener(j),u.localResultStore.removeListener(e)}}),[u,j,p]),(0,o.useEffect)((()=>(d({reducerId:t,instanceId:M,reducer:y,collectionContextStore:u,groupsPointer:f}),()=>{d({reducerId:t,instanceId:M,reducer:void 0,collectionContextStore:u,groupsPointer:f})})),[u,g,v,S,f,y,t,M]),(0,o.useEffect)((()=>{j()}),[]),(0,o.useEffect)((()=>(u.timingTracker.mountCollectionReducerRequest(t,y.type),()=>{u.timingTracker.unmountCollectionReducerRequest(t)})),[u,t,y]),x}},101981:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(296540),n=()=>r(847249),l=r(474848);function s(e){const{resultStore:t,render:s,...a}=e,i=(0,r(75544).A)(a),c=(0,n().uB)(t,r(757695).default.createClass(void 0));(0,o.useEffect)((()=>{c.setState(i);const t=e.reducer;"groups"===t.type&&"v2"===t.version&&"groups"===(null==i?void 0:i.type)&&"v2"===i.version&&e.collectionContextStore.groupsStore.setGroupBlockResults(t,i)}),[e.collectionContextStore.groupsStore,e.reducer,i,c]);const u=(0,n().K8)((()=>s?s(c):null),[s,c]);return(0,l.jsx)(l.Fragment,{children:u})}const a=o.memo(s)},320865:(e,t,r)=>{r.d(t,{A:()=>n});r(296540);var o=r(474848);const n=function(){return(0,o.jsx)(r(678553).Ay,{title:(0,o.jsx)(r(331542).A,{})})}},381451:(e,t,r)=>{r.d(t,{MobileCalendarDayMenu:()=>oe});r(581454);var o=()=>r(244641),n=r(296540),l=()=>r(484714),s=()=>r(847249),a=()=>r(401497),i=()=>r(757695),c=()=>r(584262),u=()=>r(597777),d=()=>r(869190),m=()=>r(604995),p=()=>r(416504),f=()=>r(955363),y=()=>r(380048),g=()=>r(742117),v=()=>r(179034),S=()=>r(959013),h=()=>r(496603),b=()=>r(612008),x=()=>r(435009),C=()=>r(751156),R=()=>r(319357),k=()=>r(101981),j=()=>r(519839),M=()=>r(274652),O=()=>r(760217),D=()=>r(285790),I=()=>r(928600),A=()=>r(64e3),B=()=>r(480095),_=()=>r(8980),w=()=>r(89924),P=()=>r(320865),V=()=>r(484792),E=()=>r(862292),K=()=>r(492414),T=()=>r(722872),L=()=>r(645873);class F extends i().default{getInitialState(){return{}}}const z=F;var N=()=>r(630116),Q=()=>r(465364),Z=()=>r(833880),G=(r(898992),r(354520),r(672577),()=>r(860118)),U=()=>r(29247),q=()=>r(41459),J=()=>r(909470),W=()=>r(972435),H=()=>r(351360),X=()=>r(508496),Y=r(474848);const $=function(e){let{time:t,store:o,format:l,schema:i,blockPropertyValueOverlayStore:u,collectionStore:d}=e;const m=(0,a().DP)(),p=(0,s().K8)((()=>o.getIcon()),[o]),f=(0,s().K8)((()=>Boolean(o.getIcon())||!o.isEmptyPage()),[o]),y=(0,s().K8)((()=>o.hasError()),[o]),g=(0,s().K8)((()=>o.isEmptyPage()),[o]),v=(0,s().K8)((()=>(0,K().Ay)({store:o,fullyQualified:!1,pageVisitSource:c().y8.LinkInPage})),[o]),S=(0,s().K8)((()=>r(299545).oC(o,{recursivelyLoadAllDiscussions:!1})),[o]),h=(0,s().K8)((()=>{var e;return(null==l?void 0:l.table_wrap)||!0===(null==l||null===(e=l.calendar_properties)||void 0===e||null===(e=e.find((e=>"title"===(null==e?void 0:e.property))))||void 0===e?void 0:e.wrap)}),[null==l?void 0:l.calendar_properties,null==l?void 0:l.table_wrap]);return(0,Y.jsx)(r(187485).A,{href:v,children:(0,Y.jsx)(O().A,{focused:!1,title:(0,Y.jsxs)(n.Fragment,{children:[t&&(0,Y.jsx)("div",{style:{display:"flex",color:m.text.secondary,fontSize:14,marginTop:8,marginBottom:6},children:t}),(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",...t&&{marginBottom:8}},children:[f&&!y&&(0,Y.jsx)(r(614505).B,{disabled:!0,icon:p,isEmptyPage:g,size:24,style:{flexShrink:0,marginRight:8,alignSelf:"baseline"}}),y&&(0,r(693954).Q)({marginLeft:2,marginRight:10,width:20,fill:m.accentColors.orange[500]}),(0,Y.jsx)(r(16006).A,{store:o,style:{fontWeight:r(284371).Wy.semibold,whiteSpace:h?"pre-wrap":void 0}}),S>0&&(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",color:m.text.secondary,fontSize:12,marginLeft:4,flexShrink:0,alignSelf:"baseline"},children:[(0,r(965998).M)({width:12,height:12,marginRight:4,fill:m.mediumIconColor}),S]})]})]}),caption:(0,Y.jsx)(te,{format:l,schema:i,store:o,blockPropertyValueOverlayStore:u,collectionStore:d})})})};function ee(e){let{property:t,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:l}=e;return r[t]?(0,Y.jsx)(U().m,{store:o,property:t,disabled:!0,locked:!1,format:q().j.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:l},t):null}function te(e){let{format:t,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:l}=e;const{value:a}=(0,L().fJ)(E().T.formulas),i=(0,s().K8)((()=>(t.calendar_properties?t.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).filter((e=>{var t;return(0,G().T)({block:o.getModel(),property:e,schema:r,getRecordModel:o.getRecordModel,userId:null===(t=H().default.state.currentUserStore)||void 0===t?void 0:t.id,userTimeZone:(0,p().P)(),intl:W().A.getIntl(),experimentService:X().default,collectionFeatureGates:(0,J().i)(),formulasModule:a})}))),[t.calendar_properties,r,o,a]);return i.length>0?(0,Y.jsx)("div",{style:{marginTop:8},children:i.map((e=>(0,Y.jsx)(ee,{property:e,schema:r,store:o,blockPropertyValueOverlayStore:n,collectionStore:l},e)))}):null}const re=i().default.createClass(void 0,{name:"ResultStore"});function oe(e){const{collectionContextStore:t,initialStartOfDay:r,calendarBy:o,disabled:l,onDismiss:a,blockPropertyValueOverlayStore:i,schema:c,format:u}=e,d=(0,s().uB)(void 0,re),m=(0,s().uB)(void 0,z),p=(0,s().K8)((()=>(0,Z().Sn)({collectionContextStore:t,startOfDay:se(r,m).valueOf()})),[t,r,m]),f=(0,n.useCallback)((()=>(0,Y.jsx)(ie,{collectionContextStore:t,calendarBy:o,initialStartOfDay:r,disabled:l,onDismiss:a,blockPropertyValueOverlayStore:i,schema:c,format:u,store:m,resultStore:d})),[t,o,r,l,a,i,c,u,m,d]);return p?(0,Y.jsx)(k().A,{id:"calendar_day_results",reducer:p,collectionContextStore:t,render:f,resultStore:d}):null}function ne(e){let{item:t,currentStartOfDay:r,currentEndOfDay:o,schema:n,calendarBy:l,intl:s}=e;const a=n[l];if(!a||"date"!==a.type)return;const i=a.date_format||u().vz,c=a.time_format||u().CE,f=t.start,y=t.end,g=Boolean(!(r<=f&&f<=o)||y&&!(r<=y&&y<=o));if(t.end){const e=m().NC(t.start.valueOf(),t.end?t.end.valueOf():t.start.valueOf(),t.timeZone??(0,p().P)());return g?(0,d().ZF)({value:e,date_format:i,time_format:c,userTimeZone:t.timeZone,allowRelativeDates:!0,intl:s}):(0,d().sH)({start_time:e.start_time,end_time:e.end_time,time_format:c,humanReadable:!0,intl:s})}return(0,d().fU)({start_time:m().KQ(t.start.valueOf(),t.timeZone??(0,p().P)()).start_time,time_format:c,humanReadable:!0,intl:s})}function le(e){let{blockStore:t,item:r,currentStartOfDay:o,currentEndOfDay:n,disabled:l,blockPropertyValueOverlayStore:a,collectionContextStore:i,schema:c,calendarBy:u,format:d}=e;const m=(0,S().tz)(),p=(0,s().K8)((()=>i.collectionStore()),[i]);return p?(0,Y.jsx)($,{store:t,time:r.includeTime?ne({schema:c,calendarBy:u,intl:m,item:r,currentStartOfDay:o,currentEndOfDay:n}):void 0,disabled:l,format:d,schema:c,blockPropertyValueOverlayStore:a,collectionStore:p},r.id):null}function se(e,t){const{currentStartOfDay:r}=t.state;return r?o().c9.fromMillis(r):o().c9.fromMillis(e)}function ae(e,t,r,o,n,l){const s=se(o,n),a=C().createAndCommit({userAction:"MobileCalendarDayMenu.newStore",environment:e,canUndo:!0,perform:o=>{const n=(0,b().Q)({environment:e,collectionContextStore:t,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"mobile_calendar_day_menu"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(n)return Q().D5({type:"timestamp",environment:e,store:n.newStore,propertyId:r,timestampMs:s.valueOf(),transaction:o}),n.newStore}});if(!a.performResult)return;!function(e,t,r){r?r(e):x().oo({environment:t,url:e})}((0,K().Ay)({store:a.performResult,pageVisitSource:c().y8.Create}),e,l)}function ie(e){let{collectionContextStore:t,calendarBy:r,initialStartOfDay:o,disabled:i,onDismiss:c,blockPropertyValueOverlayStore:u,schema:m,format:p,store:b,resultStore:x}=e;const C=(0,l().v3)(),k=(0,S().tz)(),{value:K}=(0,L().fJ)(E().T.formulas),F=(0,n.useContext)(V().n),z=(0,s().K8)((()=>t.collectionStore()),[t]),G=(0,s().K8)((()=>se(o,b)),[o,b]),U=G.endOf("day"),q=(0,n.useCallback)((()=>ae(C,t,r,o,b,F)),[C,t,r,o,b,F]),J=(0,n.useCallback)(((e,t)=>{Q().D5({type:"timestamp",environment:C,store:t,propertyId:r,timestampMs:G.valueOf(),transaction:e})}),[r,G,C]),W=(0,n.useCallback)((()=>function(e,t){const r=se(e,t);t.setState({...t.state,currentStartOfDay:r.plus({day:1}).valueOf()})}(o,b)),[o,b]),H=(0,n.useCallback)((()=>function(e,t){const r=se(e,t);t.setState({...t.state,currentStartOfDay:r.minus({day:1}).valueOf()})}(o,b)),[o,b]),X=(0,s().K8)((()=>function(e,t,r,o,n){const l=t.collectionStore();if(!l)return;const s=o.state,a=t.normalizedQueryStore.state,i=t.normalizedSchemaStore.state,c=a?a.calendar_by:void 0;if(!(s&&a&&c&&i))return;const u=new Map,d=new Map;let m=h().oE(s.blockIds.map((t=>{const o=N().Bv.createChildStore(l,{id:t,table:v().ev});return(0,Z().S4)({blockStore:o,calendarBy:c,schema:i,getRecordValue:l.getRecordValue,userId:e.currentUser.id,intl:r,resultCache:u,regExpCache:d,formulasModule:n})})));return a.sort||(m=h().Ul(m,(e=>e.start))),m}(C,t,k,x,K)),[C,t,k,x,K]),$=(0,s().K8)((()=>j().fG({collectionContextStore:t,environment:C,intl:k})),[t,C,k]),ee=(0,a().IS)((e=>({headerStyle:{display:"flex",alignItems:"center",height:"100%"},linkExistingButton:{color:e.text.secondary,fill:e.text.secondary}})),[]);return z?(0,Y.jsxs)(I().A,{menuType:T().gu.Modal,title:(0,Y.jsxs)("div",{style:ee.headerStyle,children:[(0,Y.jsx)(D().A,{onClick:H,icon:y().I,style:{marginRight:8,marginTop:2},mobileFeedback:!0}),(0,Y.jsx)("div",{children:(0,d().eV)({value:G,preset:"month_day_long"})}),(0,Y.jsx)(D().A,{onClick:W,icon:g().V,style:{marginLeft:8,marginTop:2},mobileFeedback:!0})]}),right:(0,Y.jsx)(B().DoneMenuText,{}),onClickRight:c,children:[!X&&(0,Y.jsx)(w().A,{children:(0,Y.jsx)(P().A,{})}),X&&0===X.length&&(0,Y.jsx)(w().A,{children:(0,Y.jsx)(A().A,{title:(0,Y.jsx)(S().sA,{defaultMessage:"No items",id:"mobileCalendarDayMenu.noResults.message"})})}),X&&X.length>0&&(0,Y.jsx)(w().A,{children:X.map((e=>{const o=N().Bv.createChildStore(z,{id:e.id,table:v().ev});return(0,Y.jsx)(le,{disabled:i,blockPropertyValueOverlayStore:u,collectionContextStore:t,schema:m,calendarBy:r,format:p,blockStore:o,item:e,currentStartOfDay:G,currentEndOfDay:U},e.id)}))}),!i&&(0,Y.jsxs)(w().A,{topBorder:!0,children:[(0,Y.jsx)(M().A,{focused:!1,onClick:q,title:(0,Y.jsx)(S().sA,{defaultMessage:"New item",id:"mobileCalendarDayMenu.newItemButton.label"})}),$&&(0,Y.jsx)(R().O,{collectionContextStore:t,renderLinkButton:e=>(0,Y.jsx)(O().A,{...e,focused:!1,title:(0,Y.jsx)(S().sA,{id:"mobileCalendarDayMenu.linkExistingButton.label",defaultMessage:"Link existing"}),icon:(0,Y.jsx)(_().I,{icon:f().arrowDiagonalUpRightIcon}),style:ee.linkExistingButton}),onAddOrLink:J})]})]}):null}},742117:(e,t,r)=>{r.d(t,{V:()=>n});r(296540);var o=r(474848);const n=(0,r(340498).wt)("chevronRight",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M12.375 8.06445C12.375 7.83203 12.2861 7.63379 12.1084 7.45605L6.77637 2.24023C6.62598 2.08984 6.44141 2.01465 6.22266 2.01465C5.77832 2.01465 5.42285 2.35645 5.42285 2.80078C5.42285 3.01953 5.51172 3.21777 5.66211 3.375L10.4746 8.06445L5.66211 12.7539C5.51855 12.9043 5.42285 13.1025 5.42285 13.3213C5.42285 13.7725 5.77832 14.1143 6.22266 14.1143C6.44141 14.1143 6.62598 14.0391 6.77637 13.8887L12.1084 8.67285C12.293 8.49512 12.375 8.29688 12.375 8.06445Z"})})}}]);