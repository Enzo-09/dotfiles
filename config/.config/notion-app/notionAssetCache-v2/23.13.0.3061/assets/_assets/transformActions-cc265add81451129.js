"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[5834,99171],{87017:(e,t,n)=>{n.r(t),n.d(t,{duplicateBlocks:()=>T,duplicateBlocksWithMaybeConfirmation:()=>M,insertBlockAbove:()=>E,insertBlockAndEdit:()=>w,insertBlockBelow:()=>A,insertTextAbove:()=>B,insertTextBelow:()=>U});n(18107),n(944114),n(967357);var o=()=>n(908006),r=()=>n(206267),i=()=>n(161479),a=()=>n(496603),c=()=>n(855801),s=()=>n(466614),l=()=>n(60867),d=()=>n(171718),u=()=>n(901389),m=()=>n(620689),f=()=>n(797265),p=()=>n(751156),v=()=>n(838256),y=()=>n(521358),k=()=>n(799832),S=()=>n(413962),h=()=>n(405417),_=()=>n(328732),b=()=>n(53664),g=()=>n(393255),C=()=>n(77246),R=()=>n(502438),I=()=>n(611371);async function M(e){const{environment:t,blocks:n,duplicateOnlyCollectionSchema:r,callback:i}=e;if(!(0,I().EF)(t))return;const a=await c().VI.duplicateActions.load();let s=n;if(1===n.length){const e=await y().rW({environment:t,block:n[0],action:"duplicate"});if("user_canceled"===e)return void(null==i||i());s=e}const d=s.at(0);if(!d)return;const u=(0,k().U)(d);if(u&&(0,h().ls)(d,u))await l().un({blocks:s,environment:t,analyticsFrom:"subitem_duplication",callback:i,collectionContextStore:u});else{const{serverCommitResult:e}=p().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{T({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"local",duplicateOnlyCollectionSchema:r,duplicateActions:a})},transactionTooBigFallback:e=>{T({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"server",duplicateOnlyCollectionSchema:r,duplicateActions:a})}});e.then(i)}o().default.afterNextFlush((()=>{m().BM({environment:t})}))}function T(e){const{environment:t,blocks:n,transaction:o,preferDuplicateLocation:r,lastTopLevelBlockStore:c,preventSetSelection:l,duplicateOnlyCollectionSchema:d,duplicateActions:m}=e,p=a().$z(n,(e=>e.getFormat().app_id??e.id)),v=[];return a().jJ(p,(e=>{const n=e[0],a=!n.isTransclusionType(),{blockStores:c,onComplete:l}=m.duplicateBlock({environment:t,stores:e,transaction:o,targetSpaceId:(0,i().e)(n.pointer.spaceId),preferDuplicateLocation:r,options:{addCopyName:(0,b().A)(n),deepCopyTransclusionContainers:a,resolveTemplateVariables:!(n.isInsideTemplate()||n.isInsideFactoryOrDuplicateBlocksAction()),duplicateOnlyCollectionSchema:d}});v.push(...c),l.then((e=>{if("error"===e.status){const n=e.error;s().Rk(n)?s().UK(t,{product:n.clientData.metadata.product}):u().f1(e.errorMessage)}}))})),f().LE({blocksToInsert:v,target:c?[c]:n,environment:t,transaction:o,replaceEmptyTextBlock:!1,preventSetSelection:l}),v}function A(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,c=R().default.getCurrentRecordCache(),s=new(v().UF)({environment:t,userFlow:"page"===(null==n?void 0:n.blockType)?"user_flow_create_page":"user_flow_create_block",succeedOnEnqueue:!0});let l;if((0,I().EF)(t)&&n&&c){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:c,from:i,selection:o});s.track(e.pointer,r),l=f().LE({environment:t,blocksToInsert:[e],target:o,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:a})[0]}else s.fail("invalid_state");return l}function E(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,c=R().default.getCurrentRecordCache();let s;if((0,I().EF)(t)&&n&&c){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:c,from:i,selection:o});s=f().t1({environment:t,blocks:[e],selection:o,transaction:r,preventSetSelection:a})[0]}return s}function w(e){const{environment:t,selection:n,transaction:o}=e,i=A({...e,preventSetSelection:!0});if(i){var a;f().x5({environment:t,insertedStores:[i],isCreated:!0});const e=C().Uv.getMode(i);if("suggest"===e){const e=S().RR(t,o,i);S().tM(o,i,{id:r().JW(),type:"insert",discussionId:e.id}),S().c3({environment:t,transaction:o,discussionStore:e,addModifiedBlockIdsAfter:[i.id]})}"suggest"===e&&null!==(a=i.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==a&&a.isCommentOnly()||f().um({transaction:o,blocks:n})}return i}function U(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",c=A({environment:r,selection:t,createBlockItem:_().ry.text,analyticsFrom:a,transaction:n});return c&&o().default.afterNextFlush((()=>{g().zz({environment:r,blockStore:c,insertedTextBlockLocation:"below"})})),c}function B(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",c=E({environment:r,selection:t,createBlockItem:_().ry.text,analyticsFrom:a,transaction:n});return c&&o().default.afterNextFlush((()=>{g().zz({environment:r,blockStore:c,insertedTextBlockLocation:"above"})})),c}},375078:(e,t,n)=>{n.r(t),n.d(t,{maybeTurnCollectionViewIntoCollectionViewPage:()=>C,transformBlocks:()=>g,transformIntoColumnList:()=>R});n(581454);var o=()=>n(908006),r=()=>n(700500),i=()=>n(179034),a=()=>n(496603),c=()=>n(722101),s=()=>n(44729),l=()=>n(915457),d=()=>n(246826),u=()=>n(797265),m=()=>n(778417),f=()=>n(725614),p=()=>n(751156),v=()=>n(62287),y=()=>n(87017),k=()=>n(594794),S=()=>n(299545),h=()=>n(508496),_=()=>n(630116),b=()=>n(65269);function g(e){const{environment:t,blocks:n,blockType:b,transaction:g}=e;if(b!==r().xd.transclusionContainer)if(b===r().xd.callout&&h().default.checkGate({gateName:"create_v2_callouts"}))!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const c=a.getRecordStoreUIParent();if(!c||!(0,S().iU)(c))return;const u=c.getRecordStoreUIParent();if(!(u&&u instanceof _().Bv))return;const p=(0,k().Z1)({environment:t,table:i().ev,spaceId:u.getSpaceId()}),v=d().Wv({environment:t,id:p,type:r().xd.callout,inMemoryRecordCache:c.inMemoryRecordCache,transaction:o,spaceId:u.getSpaceId(),format:{callout_version:2}});s().NI({parentStore:c,childStore:v,after:a.id,transaction:o});I({newParentStore:v.getContentStore(),blocks:n,transaction:o}),l().s4({store:v,transaction:o}),f().clear({environment:t}),m().IU({environment:t}),m().td({environment:t,stores:[v]})}({environment:t,blocks:n,transaction:g});else if(b!==r().xd.columnList)if(b!==r().xd.slide)if((0,r().ZK)(b)){const e=parseInt(b.replace("column","").replace("block","")),r=a().oE(a().Hn(e-1,(()=>y().insertTextBelow({environment:t,blocks:n,transaction:g})))),i=[...n,...r],c=R({environment:t,blocks:i,transaction:g});o().default.afterNextFlush((()=>{f().setSelectionAtStart({store:c[0].getBlockTitleStore()})}))}else for(const r of n)if(r.isCalloutV2()){const e=r.getParentBlockStore();if(e){const i=r.getContentStores();p().applyOperation({store:e,operation:{pointer:e.pointer,path:["content"],command:"insertChildrenAfter",args:{ids:i.map((e=>e.id)),after:r.id}},transaction:g}),s().zz({parentStore:e.getContentStore(),childStore:r,transaction:g});for(const e of i)v().pd({environment:t,block:e,blockType:b,transaction:g,isMultiBlockTransformation:n.length>1});o().default.afterNextFlush((()=>{u().dL(t,i.map((e=>e.id)))}))}}else v().pd({environment:t,block:r,blockType:b,transaction:g,isMultiBlockTransformation:n.length>1});else!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const c=a.getRecordStoreUIParent();if(!c||!(0,S().iU)(c))return;const l=c.getRecordStoreUIParent();if(!(l&&l instanceof _().Bv))return;const u=(0,k().Z1)({environment:t,table:i().ev,spaceId:l.getSpaceId()}),p=d().Wv({environment:t,id:u,type:r().xd.slide,inMemoryRecordCache:c.inMemoryRecordCache,transaction:o,spaceId:l.getSpaceId()});s().NI({parentStore:c,childStore:p,after:a.id,transaction:o});I({newParentStore:p.getContentStore(),blocks:n,transaction:o}),f().clear({environment:t}),m().IU({environment:t}),m().td({environment:t,stores:[p]})}({environment:t,blocks:n,transaction:g});else R({environment:t,blocks:n,transaction:g});else!function(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return;const s=a.getRecordStoreUIParent();if(!s||!(0,S().iU)(s))return;const l=s.getRecordStoreUIParent();if(!l||!(0,S()._p)(l))return;if(!l.isDefined())return;const u=(0,k().Z1)({environment:t,table:i().ev,spaceId:l.getSpaceId()}),p=d().Wv({environment:t,id:u,type:r().xd.transclusionContainer,inMemoryRecordCache:s.inMemoryRecordCache,transaction:o,spaceId:l.getSpaceId()});c().WH({parentStore:s,insertStore:p,afterStore:a,transaction:o});I({newParentStore:p.getContentStore(),blocks:n,transaction:o}),f().clear({environment:t}),m().IU({environment:t}),m().td({environment:t,stores:[p]})}({environment:t,blocks:n,transaction:g})}function C(e){let{environment:t,blocks:n,transaction:o}=e;(function(e){return 1===e.length&&"collection_view"===e[0].getType()})(n)&&g({environment:t,blocks:n,blockType:"collection_view_page",transaction:o})}function R(e){const{environment:t,blocks:n,transaction:o}=e,a=n[0];if(!a)return[];const s=a.recordStoreUIParentStore;if(null==s||!s.valueIs(b()._))return[];const l=(0,k().Z1)({environment:t,table:i().ev,spaceId:a.getSpaceId()}),u=d().Wv({environment:t,id:l,type:r().xd.columnList,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:a.getSpaceId()}),{childStore:m}=c().nc({parentStore:s,insertStore:u,beforeStore:a,transaction:o});return n.map((e=>{const n=(0,k().Z1)({environment:t,table:i().ev,spaceId:a.getSpaceId()}),l=d().Wv({environment:t,id:n,type:r().xd.column,inMemoryRecordCache:a.inMemoryRecordCache,transaction:o,spaceId:a.getSpaceId()}),{childStore:u}=c().TF({parentStore:s,childToRemoveStore:e,transaction:o}),{childStore:f}=c().WH({parentStore:m.getContentStore(),insertStore:l,transaction:o}),{childStore:p}=c().WH({parentStore:f.getContentStore(),insertStore:u,transaction:o});return p}))}function I(e){const{newParentStore:t,blocks:n,transaction:o}=e;for(const r of n){const e=r.getRecordStoreUIParent();null!=e&&e.valueIs(b()._)&&(c().TF({parentStore:e,childToRemoveStore:r,transaction:o}),c().BC({parentStore:t,appendStore:r,transaction:o}))}}},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>U,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>C,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>g,MAX_RECURRENCE_INTERVAL:()=>k,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>S,RRULE_WEEKDAYS_MAP:()=>y,adjustedStartDateIfPossible:()=>I,areRecurrenceSchedulesEqual:()=>F,convertFromUnpersistedRecurrenceConfig:()=>N,convertToUnpersistedRecurrenceConfig:()=>B,getFormattedEndCondition:()=>w,getFormattedNextRecurrenceTime:()=>E,getNewEndTimestamp:()=>D,getNextDateUtc:()=>A,getRecurrenceAfter:()=>M,isRunningBetweenMidnightAnd3AM:()=>T,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>_,rruleFromRecurrence:()=>b,templateAncestorsViolateRecurrenceNesting:()=>R});n(898992),n(354520),n(581454);var o=()=>n(244641);n(944114);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),c=()=>n(720665),s=()=>n(597777),l=()=>n(869190),d=()=>n(416504),u=()=>n(402390);class m extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var f=()=>n(912720);const p=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12–3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),v={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},y={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},k=99,S=999;function h(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=k}function _(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=S}function b(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:c,hour:l,minute:d}=e,u="week"===n&&i?i.map((e=>y[e])):void 0,f={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,s().eU)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return y[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new m({freq:v[n],dtstart:(0,s().eU)(t),interval:o,byweekday:u,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...f})}const g=1,C=1;function R(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>g,a=n.length>=C;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function I(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let i=o().c9.fromMillis(n.start_date,{zone:"utc"});const a=o().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,s().DH)(i.toMillis())}}function M(e){const{recurrence:t,afterDate:n}=e;if((0,f().wt)(t)){const e=(0,s().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=b(I({recurrence:t,afterDate:n})).after((0,s().eU)(n));if(!e)return;return(0,s().h1)(e)}}function T(e){return 0===e.hour||1===e.hour||2===e.hour}function A(e){return b(e).after((0,s().eU)((0,s().Rz)()))||void 0}function E(e){const{recurrence:t,intl:n}=e,r=A(N(t));if(!r)return;const i=T(t),a=o().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),c=(0,l().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:c});{let e=a.toLocaleString(o().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:c,time:e})}}function w(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().Yq)({date:o().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(p.noEndCondition)}const U=100;function B(e){return{...e,start_date:(0,s().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function D(e,t,n){return e.plus(n-t)}function x(e,t){const n=o().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Rz)(n.toJSDate())}}function N(e){return{...e,start_date:(0,s().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?x(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function F(e,t){const n=i().fN(e,(e=>void 0!==e)),o=i().fN(t,(e=>void 0!==e));return i().n4(n,o)}},725649:(e,t,n)=>{function o(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>o,j6:()=>i})}}]);