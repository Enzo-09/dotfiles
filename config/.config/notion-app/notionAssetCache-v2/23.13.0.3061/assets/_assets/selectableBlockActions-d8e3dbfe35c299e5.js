"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[99171],{87017:(e,t,n)=>{n.r(t),n.d(t,{duplicateBlocks:()=>T,duplicateBlocksWithMaybeConfirmation:()=>C,insertBlockAbove:()=>w,insertBlockAndEdit:()=>D,insertBlockBelow:()=>S,insertTextAbove:()=>U,insertTextBelow:()=>B});n(18107),n(944114),n(967357);var o=()=>n(908006),r=()=>n(206267),i=()=>n(161479),a=()=>n(496603),c=()=>n(855801),s=()=>n(466614),l=()=>n(60867),d=()=>n(171718),u=()=>n(901389),m=()=>n(620689),f=()=>n(797265),p=()=>n(751156),v=()=>n(838256),_=()=>n(521358),y=()=>n(799832),k=()=>n(413962),h=()=>n(405417),b=()=>n(328732),E=()=>n(53664),g=()=>n(393255),A=()=>n(77246),R=()=>n(502438),M=()=>n(611371);async function C(e){const{environment:t,blocks:n,duplicateOnlyCollectionSchema:r,callback:i}=e;if(!(0,M().EF)(t))return;const a=await c().VI.duplicateActions.load();let s=n;if(1===n.length){const e=await _().rW({environment:t,block:n[0],action:"duplicate"});if("user_canceled"===e)return void(null==i||i());s=e}const d=s.at(0);if(!d)return;const u=(0,y().U)(d);if(u&&(0,h().ls)(d,u))await l().un({blocks:s,environment:t,analyticsFrom:"subitem_duplication",callback:i,collectionContextStore:u});else{const{serverCommitResult:e}=p().createAndCommit({userAction:"actionRegistry.duplicateToSelection",environment:t,canUndo:!0,perform:e=>{T({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"local",duplicateOnlyCollectionSchema:r,duplicateActions:a})},transactionTooBigFallback:e=>{T({environment:t,blocks:s,transaction:e,preferDuplicateLocation:"server",duplicateOnlyCollectionSchema:r,duplicateActions:a})}});e.then(i)}o().default.afterNextFlush((()=>{m().BM({environment:t})}))}function T(e){const{environment:t,blocks:n,transaction:o,preferDuplicateLocation:r,lastTopLevelBlockStore:c,preventSetSelection:l,duplicateOnlyCollectionSchema:d,duplicateActions:m}=e,p=a().$z(n,(e=>e.getFormat().app_id??e.id)),v=[];return a().jJ(p,(e=>{const n=e[0],a=!n.isTransclusionType(),{blockStores:c,onComplete:l}=m.duplicateBlock({environment:t,stores:e,transaction:o,targetSpaceId:(0,i().e)(n.pointer.spaceId),preferDuplicateLocation:r,options:{addCopyName:(0,E().A)(n),deepCopyTransclusionContainers:a,resolveTemplateVariables:!(n.isInsideTemplate()||n.isInsideFactoryOrDuplicateBlocksAction()),duplicateOnlyCollectionSchema:d}});v.push(...c),l.then((e=>{if("error"===e.status){const n=e.error;s().Rk(n)?s().UK(t,{product:n.clientData.metadata.product}):u().f1(e.errorMessage)}}))})),f().LE({blocksToInsert:v,target:c?[c]:n,environment:t,transaction:o,replaceEmptyTextBlock:!1,preventSetSelection:l}),v}function S(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,c=R().default.getCurrentRecordCache(),s=new(v().UF)({environment:t,userFlow:"page"===(null==n?void 0:n.blockType)?"user_flow_create_page":"user_flow_create_block",succeedOnEnqueue:!0});let l;if((0,M().EF)(t)&&n&&c){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:c,from:i,selection:o});s.track(e.pointer,r),l=f().LE({environment:t,blocksToInsert:[e],target:o,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:a})[0]}else s.fail("invalid_state");return l}function w(e){const{environment:t,createBlockItem:n,selection:o,transaction:r,analyticsFrom:i,preventSetSelection:a}=e,c=R().default.getCurrentRecordCache();let s;if((0,M().EF)(t)&&n&&c){const e=d().w({environment:t,createBlockItem:n,transaction:r,inMemoryRecordCache:c,from:i,selection:o});s=f().t1({environment:t,blocks:[e],selection:o,transaction:r,preventSetSelection:a})[0]}return s}function D(e){const{environment:t,selection:n,transaction:o}=e,i=S({...e,preventSetSelection:!0});if(i){var a;f().x5({environment:t,insertedStores:[i],isCreated:!0});const e=A().Uv.getMode(i);if("suggest"===e){const e=k().RR(t,o,i);k().tM(o,i,{id:r().JW(),type:"insert",discussionId:e.id}),k().c3({environment:t,transaction:o,discussionStore:e,addModifiedBlockIdsAfter:[i.id]})}"suggest"===e&&null!==(a=i.getNavigableBlockStore({skipCurrent:!0}))&&void 0!==a&&a.isCommentOnly()||f().um({transaction:o,blocks:n})}return i}function B(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",c=S({environment:r,selection:t,createBlockItem:b().ry.text,analyticsFrom:a,transaction:n});return c&&o().default.afterNextFlush((()=>{g().zz({environment:r,blockStore:c,insertedTextBlockLocation:"below"})})),c}function U(e){const{blocks:t,transaction:n,environment:r,skipAnalytics:i}=e,a=i?void 0:"text_insert_below",c=w({environment:r,selection:t,createBlockItem:b().ry.text,analyticsFrom:a,transaction:n});return c&&o().default.afterNextFlush((()=>{g().zz({environment:r,blockStore:c,insertedTextBlockLocation:"above"})})),c}},390527:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>B,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>A,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>g,MAX_RECURRENCE_INTERVAL:()=>y,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>k,RRULE_WEEKDAYS_MAP:()=>_,adjustedStartDateIfPossible:()=>M,areRecurrenceSchedulesEqual:()=>x,convertFromUnpersistedRecurrenceConfig:()=>F,convertToUnpersistedRecurrenceConfig:()=>U,getFormattedEndCondition:()=>D,getFormattedNextRecurrenceTime:()=>w,getNewEndTimestamp:()=>I,getNextDateUtc:()=>S,getRecurrenceAfter:()=>C,isRunningBetweenMidnightAnd3AM:()=>T,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>b,rruleFromRecurrence:()=>E,templateAncestorsViolateRecurrenceNesting:()=>R});n(898992),n(354520),n(581454);var o=()=>n(244641);n(944114);function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(0===n.length)return e.map((e=>[e]));const i=[];for(const a of e)i.push(...r(n[0],...n.slice(1)).map((e=>[a,...e])));return i}var i=()=>n(496603),a=()=>n(534177),c=()=>n(720665),s=()=>n(597777),l=()=>n(869190),d=()=>n(416504),u=()=>n(402390);class m extends(()=>n(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var f=()=>n(912720);const p=(0,n(959013).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),v={day:m.DAILY,week:m.WEEKLY,month:m.MONTHLY,year:m.YEARLY},_={MO:m.MO,TU:m.TU,WE:m.WE,TH:m.TH,FR:m.FR,SA:m.SA,SU:m.SU},y=99,k=999;function h(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=y}function b(e){return(0,c().Et)(e)&&Number.isInteger(e)&&e>0&&e<=k}function E(e){const{start_date:t,frequency:n,interval:o,weekdays:i,timezone:c,hour:l,minute:d}=e,u="week"===n&&i?i.map((e=>_[e])):void 0,f={};return(0,a().O9)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,s().eU)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,a().HB)(e.end_condition)),"month"===e.frequency&&(0,a().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((e=>{let[t,n]=e;return _[t].nth(n)})):(0,a().HB)(e.monthly_restriction)),new m({freq:v[n],dtstart:(0,s().eU)(t),interval:o,byweekday:u,tzid:c,byhour:l??0,byminute:d??0,bysecond:0,...f})}const g=1,A=1;function R(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const n=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),o=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=o>g,a=n.length>=A;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:o,immediateAncestorRecurrenceType:r}}function M(e){var t;const{recurrence:n,afterDate:r}=e;if("number"===(null===(t=n.end_condition)||void 0===t?void 0:t.type)||n.start_date>=r)return n;let i=o().c9.fromMillis(n.start_date,{zone:"utc"});const a=o().c9.fromMillis(r,{zone:"utc"});switch(n.frequency){case"year":{const e=Math.floor(a.diff(i,"years").years/n.interval);i=i.plus({years:e*n.interval});break}case"month":{const e=Math.floor(a.diff(i,"months").months/n.interval);i=i.plus({months:e*n.interval});break}case"week":{const e=Math.floor(a.diff(i,"weeks").weeks/n.interval);i=i.plus({weeks:e*n.interval});break}case"day":{const e=Math.floor(a.diff(i,"days").days/n.interval);i=i.plus({days:e*n.interval});break}}return{...n,start_date:(0,s().DH)(i.toMillis())}}function C(e){const{recurrence:t,afterDate:n}=e;if((0,f().wt)(t)){const e=(0,s().l1)(n);return t.start_date>=e?new Date(t.start_date):void 0}{const e=E(M({recurrence:t,afterDate:n})).after((0,s().eU)(n));if(!e)return;return(0,s().h1)(e)}}function T(e){return 0===e.hour||1===e.hour||2===e.hour}function S(e){return E(e).after((0,s().eU)((0,s().Rz)()))||void 0}function w(e){const{recurrence:t,intl:n}=e,r=S(F(t));if(!r)return;const i=T(t),a=o().c9.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,u().H)(n)).setZone(t.timezone),c=(0,l().Yq)({date:a,dateFormat:"relative",allowRelativeDates:!0,intl:n,shortenDate:!0});if(i)return n.formatMessage(p.dateBetweenMidnightAnd3AM,{date:c});{let e=a.toLocaleString(o().c9.TIME_SIMPLE);return t.timezone!==(0,d().P)()&&(e+=` ${a.toFormat("ZZZZ")}`),n.formatMessage(p.dateAtTime,{date:c,time:e})}}function D(e,t){return(0,a().O9)(e)?"number"===e.type?t.formatMessage(p.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,l().Yq)({date:o().c9.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,a().HB)(e):t.formatMessage(p.noEndCondition)}const B=100;function U(e){return{...e,start_date:(0,s().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,s().l1)(e.end_condition.end_at)}:(0,a().HB)(e.end_condition):void 0}}function I(e,t,n){return e.plus(n-t)}function N(e,t){const n=o().c9.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,s().Rz)(n.toJSDate())}}function F(e){return{...e,start_date:(0,s().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?N(e,e.end_condition):(0,a().HB)(e.end_condition):void 0}}function x(e,t){const n=i().fN(e,(e=>void 0!==e)),o=i().fN(t,(e=>void 0!==e));return i().n4(n,o)}},725649:(e,t,n)=>{function o(e){return!(!e||"askUserToPick"in e)}function r(e){if(!e||!("askUserToPick"in e))return e}function i(e){return!(!e||!("askUserToPick"in e))&&e.askUserToPick}n.d(t,{DK:()=>r,K$:()=>o,j6:()=>i})}}]);