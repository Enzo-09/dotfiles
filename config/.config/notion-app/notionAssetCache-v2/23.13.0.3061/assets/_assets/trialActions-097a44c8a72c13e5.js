"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77970],{47273:(e,t,r)=>{r.d(t,{DS:()=>a,Fe:()=>u,GB:()=>s,Gf:()=>p,V_:()=>l,j1:()=>c,j8:()=>i,yp:()=>d,yw:()=>o});var n=()=>r(762433);function a(e){return(0,n().Fq)({subscription:e})}function i(e){return(0,n().Ry)({subscription:e,trial:void 0})}function s(e){let{subscriptionState:t,logFunction:r,spaceId:a}=e;const i=f(t);return(0,n().yB)({billingData:{subscription:i,trial:void 0},logFunction:r,spaceId:a})}function o(e){return(0,n().q8)({subscription:e})}function c(e){return(0,n().V9)({subscription:f(e),trial:void 0})}function u(e){return(0,n().d$)({subscription:f(e),trial:void 0})}function l(e){return(0,n().ji)({subscription:f(e),trial:void 0})}function p(e){return(0,n().AI)({subscription:f(e),trial:void 0})}function d(e,t){return(0,n().KH)({subscription:f(e),trial:void 0},t)}function f(e){return e?{...e,trialEnd:void 0}:void 0}},66460:(e,t,r)=>{r.d(t,{V_:()=>M,WR:()=>T,eu:()=>D,xE:()=>P,xX:()=>O});r(16280);var n=()=>r(244641),a=(r(296540),()=>r(857639)),i=()=>r(762433),s=()=>r(323063),o=()=>r(959013),c=()=>r(502800),u=()=>r(498212),l=()=>r(252105),p=()=>r(449506),d=()=>r(901389),f=()=>r(496414),m=()=>r(989423),v=()=>r(351360),y=()=>r(57605),g=()=>r(508496),_=()=>r(613240),b=()=>r(128265),w=()=>r(224701),I=()=>r(749356),h=()=>r(779795),C=()=>r(807778),S=()=>r(134217),A=()=>r(981046),E=()=>r(151168),N=r(474848);const k=(0,o().YK)({applyingBusinessTrial:{id:"trialUpsellActions.applyingBusinessTrial",defaultMessage:"Setting up your Business trialâ€¦"}});async function D(e){var t,r;const{environment:c,stripe:u,elements:p,trialData:f,trialDays:m,sessionId:g,customerName:_,businessName:b}=e;if(!p||!u)return void a().log({level:"error",from:"trialUpsellActions",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});const{error:I}=await p.submit();if(I)return void l().$X(c,{error:"could not submit form",error_type:"payment_method"});const k=await u.createPaymentMethod({elements:p});if(k.error)return void l().$X(c,{error:k.error.message,error_type:"payment_method"});if(!k.paymentMethod)return void l().$X(c,{error:"could not create token",error_type:"payment_method"});const D={type:"paymentMethodId",value:k.paymentMethod.id},T=v().default.state.currentSpaceStore;if(!T)return;const M=T.id,O=await h().p_({environment:c,spaceId:M}),P=await y().A.awaitData(c,{spaceId:M});if(!P)throw new Error("Billing data not loaded");const R=(0,i().lQ)(P),x=A().A.state.selectedCurrencyCode??"USD",B=(0,E().Zr)(),V=(0,s().vk)(O,{interval:"month",product:B,currency:x}),F=(0,C().Le)(),L=(0,s().vH)(R,{price:V,quantity:1},{isMay13PackagingChangesEnabled:F}),U=n().c9.now().plus({days:m});return await async function(e){const{environment:t,spaceStore:r,paymentData:n,desiredState:a,stripe:i,trialData:s,customerName:c,businessName:u,addressZip:p,addressCountry:f,sessionId:m}=e,v=await y().A.awaitData(t,{spaceId:r.id});try{const e=await w().nV({environment:t,sessionId:m,spaceStore:r,desiredState:a,paymentData:n,from:"onboarding",trialData:s,billingEmail:(0,S().cs)(v),customerName:c,businessName:u,addressZip:p,addressCountry:f}),l=e.paymentIntentClientSecret,y=e.paymentIntentStatus;if(l&&"requires_action"===y){const{error:e}=await i.handleNextAction({clientSecret:l});e&&(await w().M2({environment:t,spaceStore:r,from:"subscription_upgrade_onboarding_failed_payment"}),d().f1((0,N.jsx)(o().sA,{id:"subscription.upgrade.payment_failed",defaultMessage:"Your payment could not be processed. Please provide an alternate payment method or you will lose access to Notion."})))}return"success"}catch{return void l().AF(t)}}({environment:c,spaceStore:T,desiredState:{...L,trialEnd:U},paymentData:D,stripe:u,trialData:f,customerName:_,businessName:b,addressZip:(null===(t=k.paymentMethod.billing_details.address)||void 0===t?void 0:t.postal_code)||"",addressCountry:(null===(r=k.paymentMethod.billing_details.address)||void 0===r?void 0:r.country)||"",sessionId:g})}const T=(0,r(496603).sg)(D,1e3,{leading:!0,trailing:!1});async function M(e){let{spaceId:t,environment:r}=e;if(await(0,I().L6)({environment:r,spaceId:t,offerCampaign:"reverse"})&&(0,C().s)(r)){await P(t,r,"going_multiplayer")&&await _().A.resetData(r,{spaceId:t})}}async function O(e,t,r){try{f().m({message:k.applyingBusinessTrial});const n=await p().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:"business_reverse",from:r}}});return"success"===n.type?((0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:"business_reverse",success:"success"===n.data.status}}}),await w().Ow(t),f().V(),"success"===n.data.status):(R("business_reverse",t,n.error),f().V(),!1)}catch(n){return R("business_reverse",t,n),f().V(),!1}}async function P(e,t,r){let n="reverse";try{const a=await(0,b().G)(t),i=Boolean(g().default.checkGate({gateName:"apply_reverse_trial_key"}));a&&(n="reverse_mm_ent");const s=`${e}_timed_trial`,o=i?(0,u().gB)(s):void 0,c=await p().callApi({eventName:"applyReverseTrial",environment:t,data:{spaceId:e,trialData:{id:n,from:r},idempotencyKey:o}});return"success"===c.type?((0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:n,success:"success"===c.data.status}}}),await w().Ow(t),"success"===c.data.status):(R(n,t,c.error),!1)}catch(a){return R(n,t,a),!1}}function R(e,t,r){(0,m().u4)({environment:t,event:{eventName:"trial_apply_attempt",eventProperties:{trial_id:e,success:!1}}}),a().log({level:"error",from:"trialUpsellActions",type:"applyReverseTrialError",error:(0,c().convertErrorToLog)(r)})}},323063:(e,t,r)=>{r.d(t,{HO:()=>f,V5:()=>c,Vr:()=>u,ef:()=>d,gL:()=>l,ng:()=>y,vH:()=>p,vk:()=>v,z2:()=>m});r(16280),r(269479),r(898992),r(354520),r(672577),r(581454),r(737550);var n=()=>r(720665),a=()=>r(762433),i=()=>r(47273),s=()=>r(622963),o=()=>r(979340);function c(e,t){return f(e.items,t.items).some((e=>{let[t,r]=e;return function(e,t){if(!e)return!1;if(!t)return!0;const r=a().xp(e),n=a().xp(t);if(!r||!n)return!1;return o().o3[r]>o().o3[n]}(t,r)}))}function u(e,t,r){let{trialEnd:n,items:a}=t;return{trialEnd:n,items:a.map((t=>{const n=t.price.product,a=t.price.unitAmount.currencyCode,i=v(e,{interval:r,product:n,currency:a});return{...t,price:i}}))}}function l(e,t){const r=e.items.filter((e=>a().IE(e)!==t));return{...e,items:r}}function p(e,t,r){const{isMay13PackagingChangesEnabled:n}=r,i=a().IE(t),s=t.price.product,o=e.items.filter((e=>{const t=e.price.product,r=a().IE(e);return!(i===r)&&!(n&&"ai"===t&&("business"===s||"enterprise"===s))}));return{...e,items:o.concat([t])}}function d(e){const{state:t,prices:r,quantities:n,params:{interval:i,currency:s},products:o,flags:{isMay13PackagingChangesEnabled:c}}=e,u=o.map((e=>function(e){if("personal_free"===e||"team_free"===e)return"free";return e}(e))),l=u.map((e=>a().Mr(e))),p=t.items.filter((e=>{const t=e.price.product,r=a().IE(e),n=l.includes(r),i=c&&"ai"===t&&(u.includes("business")||u.includes("enterprise"));return!n&&!i})),d=u.map((e=>y(v(r,{interval:i,currency:s,product:e}),n)));return{...t,items:p.concat(d)}}function f(e,t){return(0,n().Z4)(e,(e=>a().IE(e)),t,(e=>a().IE(e)))}function m(e){const{prices:t,billingData:r,product:n}=e,s=a().Ry(r),o=a().lQ(r),c=i().yw(o),u=a().q8(r),l=c??u;return t.find((e=>e.product===n&&e.billingInterval===l&&e.unitAmount.currencyCode===s))}function v(e,t){let{interval:r,product:n,currency:a}=t;return function(e,t){if(null==e)throw new Error(t);return e}(e.find((e=>e.product===n&&e.billingInterval===r&&e.unitAmount.currencyCode===a)),`Unable to find price with interval: ${r}, product: ${n}, currency: ${a}`)}function y(e,t){const{numSeats:r,numCustomHostnames:n}=t;return"public_domain_custom_hostnames"===(0,s().vK)(e.product)?{price:e,quantity:n}:{price:e,quantity:r}}},655765:(e,t,r)=>{r.r(t),r.d(t,{applyMultiplayerReverseTrialIfEligible:()=>u().V_,applyReverseBusinessTrial:()=>u().xX,applyReversePlusTrial:()=>u().xE,handleTrialUpgradeFromOnboarding:()=>u().WR,handleTrialUpgradeFromOnboardingImpl:()=>u().eu,isEligibleForBlockLimitTimedTrial:()=>c});var n=()=>r(130382),a=()=>r(762433),i=()=>r(57605),s=()=>r(128265),o=()=>r(749356);async function c(e,t){const r=await i().A.awaitData(e,{spaceId:null==t?void 0:t.id});if("free"!==(0,a().AI)(r))return!1;const c=null==t?void 0:t.getSetting("reach_block_limit_time");if(!c||(0,n().Mn)(c)<3)return!1;if(await(0,s().G)(e))return!1;const u=t.getSpaceId();return!!(await(0,o().L6)({environment:e,spaceId:u,offerCampaign:"default"}))}var u=()=>r(66460)},749356:(e,t,r)=>{r.d(t,{VY:()=>d,Qm:()=>f,z6:()=>p,OC:()=>y,L6:()=>m,Zc:()=>g,x3:()=>v});var n=()=>r(857639),a=()=>r(386164);const i={plans_page:["lic_25","lic_50","resurrection_offer","ai_fifty_percent_upgrade"],sidebar_upsell:["lic_25","lic_50"]};var s=()=>r(502800),o=()=>r(449506),c=()=>r(901389),u=()=>r(989423),l=()=>r(351360);async function p(e,t){var r;const{spaceId:n,offerCampaign:a}=t;if(!n||!a||null===(r=l().default.state.currentSpaceStore)||void 0===r||!r.canAdmin())return;const i=await o().callApi({eventName:"getCustomerOffer",environment:e,data:{spaceId:n,offerCampaign:a}});return"failed"!==i.type&&"offer"in i.data&&i.data.offer?i.data.offer:void 0}async function d(e){const{environment:t,spaceId:r,offerCampaign:n,entrypoint:a}=e,i=await o().callApi({eventName:"applyCustomerOffer",environment:t,data:{spaceId:r,offerCampaign:n,entrypoint:a??"unknown"}});if("failed"!==i.type)return i;c().Qg(i)}async function f(e,t){const r=await o().callApi({eventName:"applyCustomerOffer",environment:e,data:{...t}});if("failed"!==r.type)return r;c().Qg(r)}async function m(e){const{environment:t,spaceId:r,offerCampaign:n}=e;return void 0!==await p(t,{spaceId:r,offerCampaign:n})}async function v(e){var t;const{environment:r,hasReceived:i,offerType:c,newPlan:u,coupon:p}=e,d=null===(t=l().default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId();if(!d)return;const f=await o().callApi({eventName:"updateCustomerOffer",environment:r,data:{spaceId:d,hasReceived:i,offerType:c,newPlan:u,coupon:p},headers:(0,a().WS)({cellId:void 0,spaceId:d})});"failed"===f.type&&n().log({level:"error",from:"offerActions",type:"updateLegacyCustomerOfferFailed",error:(0,s().convertErrorToLog)(f.error)})}async function y(e,t,r){const n=function(e){if(i.hasOwnProperty(e))return i[e]}(r);if(n)for(const a of n){const r=await p(e,{spaceId:t,offerCampaign:a});if((null==r?void 0:r.campaign)===a)return r}}function g(e){let{environment:t,spaceName:r,offerCampaign:n}=e;if(r)switch(n){case"lic_25":case"lic_50":(0,u().WU)(t,"lic_offer_eligible","lic_offer_eligible",3600,{workspace_name:r,lic_25:"lic_25"===n,lic_50:"lic_50"===n});break;case"resurrection_offer":(0,u().WU)(t,"resurrection_offer_eligible","resurrection_offer_eligible",3600,{workspace_name:r});break;default:return}}}}]);