"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[67333],{397693:(e,t,n)=>{n.r(t),n.d(t,{AIChatInput:()=>$});var a=n(296540),o=()=>n(908006),i=()=>n(484714),r=()=>n(847249),s=()=>n(401497),l=()=>n(383286),c=()=>n(102777),d=()=>n(528782),p=()=>n(919709),u=()=>n(959013),f=()=>n(534177),h=()=>n(277942),g=()=>n(829300),m=()=>n(319975),x=()=>n(725614),S=()=>n(751156),I=()=>n(220331),b=()=>n(285790),C=()=>n(524702),A=()=>n(549500),w=()=>n(989423),y=()=>n(38337),k=()=>n(792540),M=()=>n(231722),v=()=>n(963589),j=()=>n(301421),T=()=>n(351360),K=()=>n(24157),_=()=>n(298182),G=()=>n(46986),E=()=>n(182865),P=()=>n(717375),R=()=>n(70128),B=()=>n(412039),F=()=>n(756219),O=()=>n(308903),D=n(474848);const N=(0,u().YK)({placeholder:{id:"aiInferenceTranscript.placeholder",defaultMessage:"Ask AI anything..."}});function $(e){const t=(0,u().tz)(),{store:n,onSubmit:$,clientStore:q,threadStore:H,showInitialModePicker:U,aiChatFeatureController:Y,config:z,onLoaded:X}=e,J=(0,i().v3)(),[Q,Z]=a.useState(!1);(0,a.useEffect)((()=>{null==X||X()}),[X]);const ee=(0,r().K8)((()=>0===(0,p().AhH)(n.getValue()||[])),[n]),te=(0,r().K8)((()=>n.getValue()),[n]),ne=(0,r().K8)((()=>Boolean(void 0!==(null==H?void 0:H.getCurrentInferenceId())||(null==H?void 0:H.id)&&q.getClientAIChatThreadStore(H.id).state.loading)),[H,q]),ae=(0,a.useCallback)((()=>{if(!H)return;const{serverCommitResult:e}=S().createAndCommit({userAction:"AIChatTranscript.StopInferenceButton.handleClick",environment:J,canUndo:!0,perform:e=>{(0,E().GS)({threadStore:H,transaction:e,clientStore:q})}}),t=q.getClientAIChatThreadStore(H.id);t.setState({...t.state,stopInferencePromise:e})}),[J,H,q]),oe=(0,a.useCallback)((async()=>{const{dictationActions:e}=await A().$O.load(),t=(0,p().q4_)(n.getValue()||[]);await e.StreamingDictationManager.start({environment:J,onTranscription:e=>{const a=t?`${t}\n${e}`:e;S().createAndCommit({userAction:"AIChatInput.handleDictation",environment:J,canUndo:!0,perform:e=>{m().R9({environment:J,store:n,value:(0,p().x9d)(a),transaction:e})}})}}),Z(!0)}),[J,n]),ie=(0,a.useCallback)((async()=>{const{dictationActions:e}=await A().$O.load();await e.StreamingDictationManager.stop(),Z(!1)}),[]);(0,a.useEffect)((()=>()=>{ie()}),[ie]);const re=(0,r().O$)(T().AppStoreCurrentSpaceStore),se=(0,r().K8)((()=>null==re?void 0:re.id),[re]),le=(0,r().K8)((()=>{var e;return null===(e=J.currentUser)||void 0===e?void 0:e.id}),[J.currentUser]),ce=(0,r().K8)((()=>(0,P().ak)({spaceStore:re})),[re]),de=U&&Y.supportsModePicker,pe=(0,v().X)("workflows_use_agent")&&z&&"workflow"===z.type;(0,R().M)({textValue:te,isEnabled:Y.supportsAutoRouting,clientStore:q,configs:ce});const ue=(0,s().IS)((e=>({stagingAndInputWrap:{overflow:"inherit",flexGrow:1,flexShrink:1,borderRadius:12},wrap:{display:"flex",fontSize:12,alignItems:"center",flexWrap:"wrap",boxShadow:`0px 0px 0px 0.5px ${e.stroke.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===e.mode?e.surface.elevated:e.contentBackground,borderRadius:12,overflow:"inherit",position:"relative"},textContainer:{flexGrow:1,padding:"8px 12px 12px 12px",minHeight:56,maxHeight:240,overflow:"auto",fontSize:16},placeholder:{opacity:1,cursor:"text",minHeight:56},rightGutter:{display:"flex",alignItems:"center",justifyContent:"center",padding:"6px 10px",gap:4},leftGutter:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",padding:"0 0 6px 6px"},sendButtonIcon:{width:28,height:28,padding:"0 0 0 4px"},microphoneIcon:{width:28},stopIcon:{width:28,height:28},inputActionsRow:{display:"flex",width:"100%",justifyContent:"space-between",overflow:"hidden",height:40}})),[]),fe=(0,a.useCallback)((async()=>{const e=K().default.state;"editing"===e.mode&&(0,M().KP)(e.multiSelection)&&e.multiSelection.start.store===n||(x().setSelectionAtEnd({store:n}),await o().default.afterNextFlush())}),[n]),he=(0,r().K8)((()=>!H||H.canEdit()),[H]),ge=(0,a.useCallback)((()=>{he&&!ne&&(null==$||$(n.getValue()),requestAnimationFrame((()=>{const e=j().n.findNodeFromStore(n);e&&e.focus()})))}),[$,n,ne,he]),me=(0,r().K8)((()=>q.state.configForNewTranscripts),[q]),xe=(0,a.useMemo)((()=>function(e){const{config:t,threadStore:n,intl:a}=e;if(n){const e=W[t.type];return e?a.formatMessage(e):a.formatMessage(N.placeholder)}if("markdown-chat"===t.type){const e=t.model;if(e){const t=(0,f().O)(L,e)?L[e]:void 0;if(t)return a.formatMessage(t)}}const o=V[t.type];if(o)return a.formatMessage(o);return a.formatMessage(N.placeholder)}({config:me,threadStore:H,intl:t})),[me,H,t]),Se=(0,r().K8)((()=>(0,G().aj)()),[]),Ie=Y.supportsTranscription;return(0,D.jsxs)("div",{style:ue.stagingAndInputWrap,tabIndex:0,className:y().CCX,children:[Se&&(0,D.jsx)(B()._,{clientStore:q}),(0,D.jsxs)("div",{style:ue.wrap,onClick:e=>{if(e.target===e.currentTarget){const t=j().n.findEditableWithStore(n);t&&t.handleClick(e)}},children:[(0,D.jsx)(C().A,{style:ue.textContainer,placeholder:xe,disabled:!1,store:n,placeholderStyle:ue.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEnter:!1,onEnter:ge,disableMobileActionBar:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestEdit:!0,inPageFind:k().Os.none,usePopupForMentionOnMobile:!0,disableMentions:!Y.shouldAllowMentions,disabledMentionTypes:_().md}),(0,D.jsxs)("div",{style:ue.inputActionsRow,children:[de&&(0,D.jsx)("div",{style:ue.leftGutter,children:(0,D.jsx)(h()._,{clientStore:q,configs:ce,spaceId:se,userId:le})}),pe&&(0,D.jsx)("div",{style:ue.leftGutter,children:(0,D.jsx)(h().rm,{clientStore:q})}),(0,D.jsx)("div",{style:{flexGrow:1}}),(0,D.jsxs)("div",{style:ue.rightGutter,children:[Y.supportsWebSearch(me.type)&&(0,D.jsx)(O().l,{clientStore:q}),Y.supportsSearchScopePopup(me.type)&&(0,D.jsx)(F().d,{clientStore:q,threadStore:H}),Y.shouldAllowMentions&&(0,D.jsx)(I().q,{onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){await fe(),await o().default.afterNextFlush(),g().Gf({environment:J,mentionTypes:_().Ap,usePopupOnMobile:!0}),(0,w().u4)({environment:J,event:{eventName:"clicked_ai_chat_at_mention_button",eventProperties:{mode:me.type}}})}()}}),Q?(0,D.jsx)(b().A,{icon:d().m,onClick:ie,iconStyle:ue.stopIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"})},"stop-recording"):ne?(0,D.jsx)(b().A,{icon:d().m,onClick:ae,iconStyle:ue.stopIcon,disabled:!Y.supportsStopInference(me.type),ariaLabel:t.formatMessage({id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"})},"stop-inference"):(0,D.jsxs)(D.Fragment,{children:[!Q&&Ie&&(0,D.jsx)(b().A,{icon:l().E,onClick:oe,iconStyle:ue.microphoneIcon,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"})},"start-recording"),(0,D.jsx)(b().A,{icon:c().b,onClick:ge,iconStyle:ue.sendButtonIcon,isBlue:!ee,disabled:ee,ariaLabel:t.formatMessage({id:"aiInferenceTranscript.submitAiMessage",defaultMessage:"Submit AI message"})},"send-message")]})]})]})]})]})}const L=(0,u().YK)({"anthropic-sonnet-3.7":{id:"AIChatInput.placeholder.anthropicSonnet3Point7",defaultMessage:"Ask Claude…"},"openai-gpt-4.1":{id:"AIChatInput.placeholder.openaiGpt4o",defaultMessage:"Ask ChatGPT…"}}),V=(0,u().YK)({search:{id:"AIChatInput.placeholder.search",defaultMessage:"Ask or find anything from your workspace…"},researcher:{id:"AIChatInput.placeholder.researcher",defaultMessage:"Research a topic from your workspace…"},workflow:{id:"AIChatInput.placeholder.workflow",defaultMessage:"Ask for anything…"},"setup-generator":{id:"AIChatInput.placeholder.setupGenerator",defaultMessage:"Create a custom database…"}}),W=(0,u().YK)({researcher:{id:"aiInferenceTranscript.research_mode_placeholder",defaultMessage:"Ask a follow up question..."}})}}]);