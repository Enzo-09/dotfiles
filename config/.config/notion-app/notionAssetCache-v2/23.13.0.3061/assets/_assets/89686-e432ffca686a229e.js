"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[89686],{119987:(e,t,o)=>{o.d(t,{z:()=>f});var s=o(296540),i=()=>o(484714),n=()=>o(401497),r=()=>o(959013),a=()=>o(284371),l=()=>o(760217),d=()=>o(939740),c=()=>o(8980),u=()=>o(171347),m=()=>o(722872),p=()=>o(737230),g=()=>o(750420),y=o(474848);const f=s.memo((function(e){const{navigableBlockStore:t,inPeekView:u,noTopMargin:f}=e,h=(0,i().v3)(),S=(0,i().Y0)(),b=(0,r().tz)(),A=(0,o(847249).K8)((()=>p().Ay.getTabForNewCommentsSidebar()),[]),j=(0,s.useCallback)((e=>p().Ay.update((t=>({...t,...p().Ay.createUpdateForNewCommentsSidebar(e)})))),[]),C=(0,o(419123).P)({navigableBlockStore:t}),[M,k]=(0,s.useState)(!0);(0,s.useEffect)((()=>{const e=M&&!C.length;k(e),e&&A===p().UL.ForYou&&j(p().UL.Comments)}),[M,A,j,C.length]);const w=(0,s.useCallback)((()=>{o(265201).A.setState({open:!1})}),[]),I=(0,n().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:f?0:o(175947).ek(h.device.isElectronMac),paddingTop:4,width:"100%",background:u?e.popoverBackground:e.contentBackground,paddingRight:8,borderBottom:`1px solid ${e.regularDividerColor}`},label:{fontSize:14,color:e.text.primary,fontWeight:a().Wy.medium,padding:0,boxShadow:"none",paddingLeft:M?0:16,gap:16},tabStyle:{padding:"12px 0"},tabBorderStyle:{left:0,right:0}})),[f,h.device.isElectronMac,u,M]),B=(0,n().IS)((e=>({tabSwitcherButton:{display:"flex",alignItems:"center",gap:4,fontWeight:a().Wy.semibold,borderRadius:6,paddingLeft:6,paddingRight:6,paddingTop:4,paddingBottom:4,marginTop:7,marginBottom:7},titleWrapper:{display:"flex",justifyContent:"center",alignItems:"center"},closeButton:{position:"absolute",right:10,borderRadius:"50%",background:e.tint.primaryHover}})),[]);return S.isPhone?(0,y.jsx)(o(406699).Ay,{bottomSheetInitialState:"half",renderOrigin:e=>(0,y.jsxs)("div",{style:B.titleWrapper,children:[(0,y.jsxs)(o(704152).A,{style:B.tabSwitcherButton,...e,children:[[(0,y.jsx)(v,{count:C.length},"forYou"),(0,y.jsx)(x,{},"comments"),(0,y.jsx)(g().HX,{},"updates"),(0,y.jsx)(g().f2,{},"analytics")][A],(0,y.jsx)(c().I,{icon:o(324254).arrowChevronSingleDownSmallIcon,color:"secondary",size:"sm"})]}),(0,y.jsx)(o(285790).A,{icon:o(297813).xMarkFillIcon,onClick:w,style:B.closeButton,ariaLabel:b.formatMessage({id:"updateSidebar.header.closeLabel",defaultMessage:"Close"})})]}),render:e=>{const t=[{key:0,render:e=>(0,y.jsx)(l().A,{...e,icon:(0,y.jsx)(c().I,{icon:o(104077).r}),title:(0,y.jsx)(r().sA,{id:"updateSidebar.header.forYouLabel",defaultMessage:"For You"})}),action:()=>j(p().UL.ForYou)},{key:1,render:e=>(0,y.jsx)(l().A,{...e,icon:(0,y.jsx)(c().I,{icon:o(49621).h}),title:(0,y.jsx)(r().sA,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}),action:()=>j(p().UL.Comments)},{key:2,render:e=>(0,y.jsx)(l().A,{...e,icon:(0,y.jsx)(c().I,{icon:o(202017).n}),title:(0,y.jsx)(r().sA,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}),action:()=>j(p().UL.Updates)}],s=[{key:0,render:e=>(0,y.jsx)(o(89924).A,{...e}),items:t}];return(0,y.jsx)(o(928600).A,{title:(0,y.jsx)(r().sA,{id:"updateSidebar.header.switchViewLabel",defaultMessage:"Switch view"}),menuType:S.isPhone?m().gu.Modal:m().gu.Popup,children:(0,y.jsx)(d().Ay,{type:d().Oh.Vertical,initialFocus:void 0,onAccept:e.close,sections:s})})},popupType:o(377586).n.BottomSheet}):(0,y.jsx)("div",{style:I.updatesHeaderStyle,className:o(38337).Kbf,children:(0,y.jsx)(o(987017).Ay,{tabs:[(0,y.jsx)(v,{count:C.length},"forYou"),(0,y.jsx)(x,{},"comments"),(0,y.jsx)(g().HX,{},"updates"),(0,y.jsx)(g().f2,{},"analytics")],selectedIndex:A,onChange:j,style:I.label,tabStyle:I.tabStyle,tabBorderStyle:I.tabBorderStyle,idPrefix:g().Oi,hideTabIndexes:M?[0]:void 0})})}));function v(e){const{count:t}=e;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(r().sA,{id:"updateSidebar.header.forYouLabel",defaultMessage:"For You"}),(0,y.jsx)(u().A,{count:t,color:u().g.Red})]})}function x(){return(0,y.jsx)(r().sA,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})}},123021:(e,t,o)=>{o.d(t,{O:()=>A});o(898992),o(672577),o(581454);var s=o(296540),i=()=>o(484714),n=()=>o(847249),r=()=>o(401497),a=()=>o(709687),l=()=>o(668725),d=()=>o(284371),c=()=>o(416726),u=()=>o(848259),m=()=>o(452558),p=()=>o(493823),g=()=>o(406699),y=()=>o(928600),f=()=>o(89924),v=()=>o(722872),x=()=>o(553965),h=()=>o(538075),S=()=>o(518773),b=o(474848);function A(e){var t;const{blockStore:o,from:A,buttonPopupStore:j}=e,C=e.moreProminentStyling??!1,M=(0,i().v3)(),k=(0,n().K8)((()=>o.isPageBlock()),[o]),w=(0,n().K8)((()=>o.getFollowSettingsKey()),[o]),I=(0,s.useCallback)((()=>{u().zP({environment:M,pageId:o.pointer.id,isCurrentlyFollowing:(0,S().A)(w).following,from:A})}),[o.pointer.id,M,w,A]),B=(0,n().K8)((()=>h().H8({followSettingsKey:w,environment:M,blockStore:o,from:A})),[w,M,o,A]),F=(0,r().IS)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.text.secondary,padding:C?"4px 10px":4,borderRadius:4,marginRight:C?0:4,fontSize:d().J.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1}})),[C]),T=null===(t=B.find((e=>h().I7({key:e.action.analyticsName,userSelectedKey:w}))))||void 0===t?void 0:t.title;return k?(0,b.jsx)(g().Ay,{popupType:g().z7.Popup,alignmentToOrigin:g().yP.End,placementToOrigin:g().sx.Bottom,sameWidthAsOrigin:C,buttonPopupStore:j,render:e=>(0,b.jsx)(y().A,{menuType:v().gu.Popup,minWidth:290,maxHeight:"50vh",children:(0,b.jsx)(m().A,{context:{blocks:[],environment:M,publicEditMode:void 0},sections:[(0,c().gy)({key:"in-app-notifications-section",render:e=>(0,b.jsx)(f().A,{...e}),actions:B.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})}),renderOrigin:e=>(0,b.jsxs)(p().p,{...(0,x().A)(e,{onClick:I}),style:F.buttonContainer,children:[(0,a().r)(F.bellIcon),T,C&&(0,b.jsx)("div",{style:F.spacer}),(0,l().b)(F.chevronIcon)]})}):null}},128973:(e,t,o)=>{o.d(t,{P:()=>m});o(898992),o(737550),o(296540);var s=()=>o(484714),i=()=>o(847249),n=()=>o(401497),r=()=>o(284371),a=()=>o(94953),l=()=>o(89924),d=()=>o(963589),c=()=>o(372154),u=o(474848);function m(e){const{firstItemId:t,ignoreFirstItemState:o}=e,m=(0,s().Y0)(),p=(0,d().X)("comment_sidebar_for_you"),g=(0,i().K8)((()=>{var e;return!o&&(Boolean(t)&&(null===(e=a().A.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))))}),[t,o]),y=(0,i().K8)((()=>!o&&(c().A.state.open&&c().A.state.discussionIds&&c().A.state.discussionIds.some((e=>e===t)))),[t,o]),f=(0,n().IS)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:r().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:m.isPhone&&p?0:-12}})),[e.location,p,m.isPhone]);return(0,u.jsx)(l().A,{desktopTitleStyle:{...f.basicDesktopTitleStyle,...g?f.hoveredStyle:{},...y?f.pressedStyle:{}},mobileTitleStyle:f.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}},146594:(e,t,o)=>{o.d(t,{H:()=>n});var s=()=>o(645873);const i=new(s().O2)("UpdateSidebarTabInfo",(async()=>await Promise.all([o.e(75134),o.e(43380),o.e(9304),o.e(85515),o.e(1213),o.e(78846),o.e(43741),o.e(93282),o.e(67780),o.e(96933),o.e(49157),o.e(21377)]).then(o.bind(o,722143)))),n=(0,s()._h)(i,(e=>e.UpdateSidebarTabInfo))},273321:(e,t,o)=>{o.d(t,{A:()=>B});var s=o(296540),i=()=>o(790748),n=()=>o(847249),r=()=>o(401497),a=()=>o(713998),l=()=>o(797809),d=()=>o(959013),c=()=>o(284371),u=()=>o(710648),m=()=>o(678553),p=()=>o(125565),g=()=>o(862292),y=()=>o(186445),f=()=>o(972435),v=()=>o(480289),x=()=>o(351360),h=()=>o(441467),S=()=>o(848565),b=()=>o(493319),A=()=>o(555776),j=()=>o(116008),C=()=>o(811879),M=()=>o(846583),k=()=>o(640753),w=()=>o(105157),I=o(474848);function B(e){const{environment:t,menuListItemProps:o,shouldShowTopDividerLine:B,shouldShowBottomDividerLine:F,shouldExpandDiscussionWidth:T,noBackgroundColors:D,onMouseEnter:_,onMouseLeave:L,onFocus:P,onBlur:E}=e,K=(0,n().O$)(x().AppStoreMainEditorCurrentBlockStore),R=(0,n().K8)((()=>(0,y()._m)(t)),[t]),U=S().eQ,O=(0,n().K8)((()=>A().A.state.isActivelyComposing),[]),N=(0,n().K8)((()=>A().A.state.isHovered),[]),W=(0,s.useCallback)((()=>{null==_||_()}),[_]),H=(0,s.useCallback)((()=>{null==L||L()}),[L]),V=(0,s.useCallback)((()=>{null==P||P()}),[P]),z=(0,s.useCallback)((()=>{j().A.hasContent()?A().A.resetAllActiveSources():(j().A.reset(),A().A.reset()),null==E||E()}),[E]),$=(0,d().tz)(),Y=(0,s.useRef)(null);(0,i().b)(v().A,(()=>({getNode:()=>Y.current})),[]);const q=(0,r().IS)((e=>({menuDiscussionItem:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)"},discussionContainer:{paddingTop:t.device.isMobile?4:6,borderTop:!t.device.isMobile&&B?`1px solid ${e.regularDividerColor}`:void 0,borderBottom:!t.device.isMobile&&F?`1px solid ${e.regularDividerColor}`:void 0,transition:"background 300ms ease",background:D?void 0:O?e.focusDiscussionBackground:N?e.hoveredDiscussionBackground:void 0},comment:{position:"relative",fontSize:14},commentElementsBelowUserRow:{paddingLeft:S().FB},avatar:{marginTop:0,marginRight:8,userSelect:"none",WebkitUserSelect:"none"},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none"},placeholder:{height:8,width:81,borderRadius:6,background:e.lightDividerColor},draftLabel:{margin:"0 6px",flexBasis:140,whiteSpace:"normal",flexGrow:void 0,display:"inline",color:e.text.tertiary},commentAuthorPlaceholder:{marginRight:8,marginTop:2,height:U,width:U,borderRadius:20,flexShrink:0},container:{paddingTop:S().e4,paddingRight:16,paddingBottom:S().Wv,paddingLeft:16},noOverflow:{overflow:"hidden"},commentContext:{display:"flex",width:"100%",marginTop:6,marginBottom:22,fontSize:13,color:e.text.secondary},displayName:{fontWeight:c().Wy.medium,whiteSpace:"normal"},fullWidthFlex:{display:"flex",width:"100%"},smallTopPadding:{marginTop:1}})),[U,t.device.isMobile,N,O,D,F,B]),Z=(0,s.useCallback)((async()=>{const e=await g().T.formulas.load();h().i5({environment:t,allowActionsWhileCommenting:!0,formulasModule:e})}),[t]),G=(0,n().K8)((()=>!j().A.state.open||"reaction"===j().A.state.content),[]),X=(0,n().K8)((()=>{var e;return j().A.getBlockStore()??(null===(e=j().A.getClosestBlockStore())||void 0===e?void 0:e.parentBlockStore)}),[]),J=(0,n().K8)((()=>j().A.getPropertyId()),[]),Q=(0,n().K8)((()=>{if(J){var e;const t=null===(e=j().A.getBlockStore())||void 0===e?void 0:e.getAssociatedCollectionStore();if(!t||"collection"!==t.table)return;const o=t.getSchema();return(0,a()._g)({schema:o,property:J})}}),[J]),ee=(0,n().K8)((()=>(0,l().RX)(f().A.getIntl()).title),[]),te=(0,n().O$)(j().f),oe=(0,n().K8)((()=>null==R?void 0:R.getDisplayName($)),[R,$]),se=(0,n().K8)((()=>null==X?void 0:X.getSpaceId()),[X]),ie=(0,n().K8)((()=>h().Ek({environment:t})),[t]),ne=(0,n().K8)((()=>j().A.getType()),[]),re=(0,n().K8)((()=>null==X?void 0:X.getValue()),[X]);if(G||!ee||!R||!X||!K||!te||!se||!re&&"block"===ne||!ie&&"inline"===ne)return null;const ae="inline"===ne||J,le="block"===ne&&!J?(0,I.jsx)(u().Ay,{blockValue:re,rootStore:X,blockPreviewLocation:"comments_sidebar"}):ae?(0,I.jsx)(u().vY,{value:{value:(null==ie?void 0:ie.context)??[],spaceId:se},propertySchema:ee,labeled:!1,rootStore:X,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}):null;return(0,I.jsx)("div",{style:q.discussionContainer,ref:Y,onClick:null==o?void 0:o.onClick,onMouseEnter:W,onMouseLeave:H,children:(0,I.jsx)(m().Ay,{allowTextSelection:!0,style:q.menuDiscussionItem,title:(0,I.jsx)("div",{style:q.container,children:(0,I.jsxs)("div",{style:q.comment,children:[(0,I.jsxs)("div",{style:q.userRow,children:[(0,I.jsx)(C().E,{authorStore:R,avatarSize:U,avatarStyle:q.avatar,placeholderStyle:q.commentAuthorPlaceholder}),(0,I.jsxs)("div",{style:q.noOverflow,children:[(0,I.jsx)("span",{style:q.displayName,children:oe||(0,I.jsx)("span",{style:q.placeholder})}),(0,I.jsx)(p().A,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:q.draftLabel,children:(0,I.jsx)(d().sA,{defaultMessage:"Draft",id:"DraftCommentInputWithContext.draftLabel"})})]})]}),(0,I.jsxs)("div",{style:q.commentElementsBelowUserRow,children:[(0,I.jsx)("div",{style:q.commentContext,children:(0,I.jsxs)("div",{style:q.fullWidthFlex,children:[(0,I.jsx)(M().T,{}),Q&&(0,I.jsx)(w().A,{propertySchema:Q}),(0,I.jsx)("div",{style:q.smallTopPadding,children:le})]})}),(0,I.jsx)(k().A,{showAvatar:!1,parentStore:K,blockStore:X,onSubmit:Z,discussionInputStore:te,isNewComment:!0,isEditingExistingComment:!1,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:b().DiscussionFormat.Sidebar,canDrop:!0,disableFocusRing:!0,adjustWidthForDraftDiscussions:T,dontMoveCursorToInputEndOnFocus:!0,onBlur:z,onFocus:V},"draft-comment-sidebar")]})]})})})},"draft-comment-discussion-updates")}},297813:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>s,xMarkFillIcon:()=>i});o(296540);const s={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M15.869 5.369A.875.875 0 0 0 14.63 4.13L10 8.763 5.369 4.13A.875.875 0 1 0 4.13 5.37L8.763 10 4.13 14.631a.875.875 0 1 0 1.24 1.239L10 11.237l4.631 4.632a.875.875 0 1 0 1.238-1.238L11.237 10z"})},i=(0,o(340498).wt)("xMarkFill",s)},310830:(e,t,o)=>{o.d(t,{f:()=>ve});var s=()=>o(244641),i=o(296540),n=()=>o(847249),r=()=>o(401497),a=()=>o(959013),l=()=>o(60499),d=()=>o(2143),c=(o(898992),o(823215),o(354520),o(430670),o(581454),o(908872),()=>o(968526)),u=()=>o(662303),m=()=>o(484714),p=()=>o(869190),g=()=>o(604995),y=()=>o(73514),f=()=>o(883234),v=()=>o(535845),x=()=>o(133033),h=()=>o(738418),S=()=>o(846899),b=()=>o(72135),A=()=>o(310442),j=()=>o(824862),C=()=>o(798880),M=()=>o(496603),k=()=>o(821062),w=()=>o(534177),I=()=>o(129546),B=()=>o(449506),F=()=>o(466721),T=()=>o(59976),D=()=>o(777092),_=()=>o(722872),L=()=>o(680026),P=()=>o(299545),E=()=>o(836251),K=()=>o(997583),R=()=>o(962730),U=()=>o(224239),O=()=>o(351360),N=()=>o(630116),W=()=>o(406699),H=()=>o(364280),V=()=>o(331542),z=()=>o(928600),$=()=>o(864943),Y=()=>o(859428),q=()=>o(256863),Z=()=>o(125565),G=()=>o(453697),X=()=>o(733815),J=()=>o(687110),Q=o(474848);const ee=Date.now();function te(e){let{store:t,spaceId:o,isDisabledForWorkspace:s}=e;const[l,d]=(0,i.useState)("last_28_days"),[c,u]=(0,i.useState)({state:s?"disabled-for-workspace":"loading"}),p=(0,m().v3)(),y=(0,r().DP)(),f=(0,n().K8)((()=>{const{currentSpaceStore:e}=O().default.state;return null==e?void 0:e.getName()}),[]),v=(0,n().K8)((()=>{switch(l){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[l]);(0,i.useEffect)((()=>{s||async function(){const e=await B().callApi({eventName:"getPageAnalytics",environment:p,data:{pageId:t.id,spaceId:o,days:v}});if("failed"===e.type)return void u({state:"empty"});const s=e.data.map((e=>{let{ds:t,total_views:o,unique_views:s}=e;return{ds:t,values:{total_views:o,unique_views:s}}}));s.filter((e=>{let{ds:t}=e;return g().C6.isoToUnixMs(t,"UTC")??ee<=ee})).every((e=>{let{values:t}=e;return 0===t.total_views}))?u({state:"empty"}):u({state:"loaded",data:s})}()}),[p,t.id,s,o,v]);const h=(0,r().IS)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}})),[]);return"loading"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(V().A,{legacySize:32})}):"empty"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:(0,Q.jsx)(a().sA,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})}):"disabled-for-workspace"===c.state?(0,Q.jsx)("div",{style:h.fullHeight,children:(0,Q.jsx)(pe,{heading:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16},children:[f?(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:f}}):(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),(0,Q.jsxs)("a",{href:(0,E().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:y.text.primary,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(Z().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"})})]})]})})}):(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"},children:[(0,Q.jsxs)(H().VP,{grow:1,gap:16,children:[(0,Q.jsx)(ie,{store:t,data:c.data,currentFilter:l,onChangeFilter:d}),(0,Q.jsx)(re,{store:t}),(0,Q.jsx)(me,{spaceId:o,store:t})]}),(0,Q.jsxs)("div",{style:{borderTop:`1px solid ${y.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Q.jsx)(W().Ay,{renderOrigin:e=>{let{onClick:t}=e;return(0,Q.jsx)($().A,{size:"lg",onClick:t,icon:S().B,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"})})},popupType:p.device.isMobile?W().z7.SlideUp:W().z7.Popup,render:()=>(0,Q.jsx)(z().A,{menuType:_().gu.Popup,width:460,children:(0,Q.jsx)("div",{style:se,children:(0,Q.jsx)(J().PageAnalyticsPageOptOut,{store:t})})})}),(0,Q.jsxs)("a",{href:(0,E().xS)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:y.text.primary,alignItems:"center",textDecoration:"none",cursor:"pointer"},children:[(0,x().$)({width:14,height:14}),(0,Q.jsx)(Z().A,{isSmall:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})})]})]})]})}const oe=175,se={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function ie(e){const[t,o]=(0,K().z)(),{blueLayer:s,yellowLayer:n}=(0,c().useTimeSeriesPalette)(),r=(0,i.useMemo)((()=>{if(0===e.data.length)return ee;const t=g().C6.isoToUnixMs(e.data[0].ds,"UTC")??ee;return Math.min(t,ee)}),[e.data]);return(0,Q.jsxs)("div",{children:[(0,Q.jsx)(ne,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),(0,Q.jsx)("div",{ref:t,style:{...se,marginBottom:0},children:(0,Q.jsx)(T().b,{startDate:(0,p().aD)(r,!0),endDate:(0,p().aD)(ee,!0),width:o,height:oe,data:e.data,layers:[{key:"total_views",...s,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})})]})}function ne(e){const t=(0,a().tz)(),o=(0,i.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:o}=t;return e+o.total_views}),0)),[e.data]);return(0,Q.jsx)("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,Q.jsxs)(H().fI,{justifyContent:"space-between",alignItems:"center",grow:1,children:[(0,Q.jsxs)(H().fI,{gap:4,children:[(0,Q.jsx)(Z().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})}),(0,Q.jsx)(Z().A,{isSecondaryColor:!0,children:(0,Q.jsx)(a().sA,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,b().ZV)(o,"number_with_commas",t)}})})]}),(0,Q.jsx)(X().Z,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})]})})}function re(e){const{store:t}=e,{pageVisitStore:o,presenceStore:s}=(0,n().O$)(O().default),r=(0,m().v3)();(0,i.useEffect)((()=>{F().Ds(r,{blockStore:t,pageVisitStore:o,incremental:!1,limit:F().FD})}),[r,t,o]);const l=(0,n().K8)((()=>(0,L().PZ)({pageVisitStore:o,presenceStore:s})),[o,s]);if(0===l.length)return null;const d=l.map((e=>{let{userId:o,activityTimestampNearestMinuteMs:s,onTrustedDomain:i}=e;return{actorStore:N().LU.createChildStore(t,{id:o,table:C().oo}),timestamp:s,onTrustedDomain:i}}));return(0,Q.jsxs)("div",{style:{...se,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(Z().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})}),(0,Q.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:(0,Q.jsx)(le,{store:t,actorStores:d,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})})]})}const ae=5;function le(e){const{store:t,actorStores:o,collapsedLabel:s,expandedLabel:n}=e,[r,a]=(0,i.useState)(!0),l=r?o.slice(0,ae):o;return(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[l.map((e=>{let{actorStore:o,timestamp:s,onTrustedDomain:i}=e;return(0,Q.jsx)(de,{store:t,actorStore:o,timestamp:s,onTrustedDomain:i},o.id)})),o.length>ae&&(0,Q.jsx)("button",{onClick:e=>{e.preventDefault(),a(!r)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4},children:(0,Q.jsxs)(Z().A,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"},children:[r?s:n,r?(0,f()._)({width:12}):(0,v().B)({width:12})]})},"toggle")]})}function de(e){const{actorStore:t,timestamp:o,onTrustedDomain:s}=e,l=(0,a().tz)(),d=(0,i.useMemo)((()=>{const e=Date.now();return(0,p().v9)(Math.min(o??e,e),u().locale)}),[o]),c=(0,n().K8)((()=>t.getDisplayName(l)),[t,l]),m=(0,r().IS)((e=>({icon:{width:14,height:14,position:"relative",top:1,color:e.text.secondary},tooltip:{marginTop:2}})),[]);return(0,Q.jsxs)(H().fI,{alignItems:"center",justifyContent:"space-between",children:[(0,Q.jsxs)(H().fI,{gap:4,children:[(0,Q.jsx)(ce,{actorStore:t}),(0,Q.jsx)(Z().A,{style:{fontWeight:500},children:c})]}),(0,Q.jsx)(Z().A,{isSecondaryColor:!0,children:o?(0,Q.jsx)("span",{title:(0,p().W_)(o,"medium_with_time",u().locale),children:d}):d}),s&&(0,Q.jsx)("div",{style:m.tooltip,children:(0,Q.jsx)(Y().A,{renderTooltip:()=>(0,Q.jsx)(a().sA,{id:"page_analytics.viewers.sharedEmailDomainUser.tooltip.message",defaultMessage:"Shared email domain user"}),render:e=>(0,Q.jsx)("div",{...e,style:m.icon,children:(0,h().G)()}),placement:R().W.Bottom})})]})}function ce(e){const{actorStore:t}=e;return t.table===j().GP?(0,Q.jsx)(q().A,{botStore:t,size:18}):t.table===C().oo?(0,Q.jsx)(G().A,{userStore:t,size:18}):t.table===A().yj?(0,Q.jsx)(G().A,{userStore:void 0,size:18}):void(0,w().HB)(t)}function ue(e){const{environment:t,store:o,spaceId:s}=e,[,,r]=(0,n().$y)(void 0,U().L),[a,l]=(0,i.useState)([]);(0,i.useEffect)((()=>{I().rL(t,{store:r,activityIds:a,spaceId:s,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:o.id})}),[a,r,s,o.id,t]);return(0,n().K8)((()=>{const e=r.state.activityIds;(0,k().A)(a,e)||l(e);const{currentSpaceStore:t}=O().default.state;if(!t)return[];const s=a.map((e=>(0,P().jA)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var o;return M().oE(null===(o=e.edits)||void 0===o?void 0:o.flatMap((e=>{var o;return null===(o=e.authors)||void 0===o?void 0:o.map((o=>({actorStore:(0,D().JQ)({parentStore:t,pointer:o}),timestamp:e.timestamp})))})))}(t,o):[]})),i=M().Ul(s,"timestamp").reverse();return M().hS(i,(e=>e.actorStore.id))}),[a,r,o])}function me(e){const{spaceId:t,store:o}=e,s=ue({environment:(0,m().v3)(),spaceId:t,store:o}),i=(0,n().K8)((()=>{const e=o.getCreatedByPointer(),t=o.getCreatedTime();if(e&&t)return{actorStore:(0,D().JQ)({parentStore:o,pointer:e}),createdTime:t}}),[o]);return(0,Q.jsxs)("div",{style:{...se,display:"flex",flexDirection:"column",gap:12},children:[(0,Q.jsx)(Z().A,{style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.title",defaultMessage:"Editors"})}),i&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6},children:[(0,Q.jsx)(Z().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})}),(0,Q.jsx)(de,{store:o,actorStore:i.actorStore,timestamp:i.createdTime})]}),s.length>0&&(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[(0,Q.jsx)(Z().A,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500},children:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})}),(0,Q.jsx)(le,{actorStores:s,store:o,collapsedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:(0,Q.jsx)(a().sA,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})]})]})}function pe(e){const t=(0,r().IS)((e=>({column:{display:"flex",flexDirection:"column"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.text.secondary}})),[]);return(0,Q.jsx)("div",{style:{...t.column,gap:24},children:(0,Q.jsxs)("div",{style:{...t.column,...t.centered,gap:4},children:[(0,y().C)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),(0,Q.jsx)(Z().A,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500},children:e.heading}),(0,Q.jsx)(Z().A,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"},children:e.description})]})})}var ge=()=>o(347199),ye=()=>o(737230),fe=()=>o(756279);function ve(e){let{enablePageAnalytics:t}=e;const o=(0,n().O$)(O().AppStoreMainEditorCurrentBlockStore),i=(0,n().K8)((()=>{const e=s().c9.now().minus({years:1}).valueOf();return!!o&&o.getCreatedTime()<e}),[o]),c=(0,n().O$)(O().AppStoreCurrentSpaceStore),u=(0,n().K8)((()=>!(null!=o&&o.canRead())),[o]),m=(0,n().K8)((()=>{var e;const t=null==o?void 0:o.getModel();return o&&null!=t&&t.isCollectionView()?null===(e=o.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[o]),p=(0,n().K8)((()=>Boolean(null==c?void 0:c.getSettings().disable_page_analytics)),[c]),g=(0,r().IS)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.text.secondary,fontSize:14,background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[]),y=(0,n().K8)((()=>ye().Ay.state.updatesSubTab),[]);return u?(0,Q.jsx)(d().H,{type:fe().A.Y,style:g.updatesEmptyStyle,children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:(0,Q.jsx)(a().sA,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})})}):c&&o?(0,Q.jsxs)(d().H,{type:fe().A.Y,ref:e=>{ge().A.UpdateSidebarScroller=e},style:g.updatesNotEmptyStyle,children:[t&&(0,Q.jsx)("div",{style:{display:y===ye().VE.Analytics?"block":"none",height:"100%"},children:(0,Q.jsx)(te,{spaceId:c.id,store:o,isDisabledForWorkspace:p})}),(0,Q.jsx)("div",{style:{display:y===ye().VE.Updates?"block":"none"},children:(0,Q.jsx)(l().A,{collectionId:m,navigableBlockStore:o,spaceId:c.id,source:"updates_sidebar",empty:e=>(0,Q.jsx)(d().H,{type:fe().A.Y,style:g.updatesEmptyStyle,ref:e=>{ge().A.UpdateSidebarScroller=e},children:(0,Q.jsx)("div",{style:{width:200,alignSelf:"center"},children:e.hasFiltersOn?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):i?(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}):(0,Q.jsx)(a().sA,{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})})})},o.id)})]}):null}},569866:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var s=()=>o(401497),i=()=>o(829548),n=o(474848);function r(e){const{message:t,title:o}=e,r=(0,s().IS)((e=>({wrapper:{textAlign:"center",paddingLeft:20,paddingRight:20,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",minHeight:220},icon:{width:48,fill:e.icon.tertiary},message:{fontSize:14,color:e.text.tertiary,marginTop:2,marginBottom:4,maxWidth:380,textWrap:"balance"},title:{fontSize:14,fontWeight:500,color:e.text.secondary,maxWidth:380,textWrap:"balance"}})),[]),a=e.icon||i().y;return(0,n.jsxs)("div",{style:r.wrapper,children:[(0,n.jsx)("div",{style:{paddingBottom:12},children:a(r.icon)}),(0,n.jsx)("div",{style:r.title,children:o}),(0,n.jsx)("div",{style:r.message,children:t})]})}},687110:(e,t,o)=>{o.r(t),o.d(t,{PageAnalyticsPageOptOut:()=>x,TopbarPageAnalyticsOptOutMenu:()=>v,TopbarPageAnalyticsOptOutMenuStore:()=>f});o(296540);var s=()=>o(484714),i=()=>o(847249),n=()=>o(959013),r=()=>o(72234),a=()=>o(836251),l=()=>o(962730),d=()=>o(377586),c=()=>o(351360),u=()=>o(364280),m=()=>o(897119),p=()=>o(719147),g=()=>o(702723),y=o(474848);const f=o(757695).default.createValue({isOpen:!1,rect:void 0},{name:"TopbarPageAnalyticsOptOutMenuStore"});function v(){const e=(0,s().v3)(),t=(0,i().K8)((()=>f.state.isOpen),[]),o=(0,i().K8)((()=>f.state.rect),[]),r=(0,i().O$)(c().AppStoreMainEditorCurrentBlockStore);return r?(0,y.jsx)(m().Ay,{popupType:e.device.isMobile?d().n.SlideUp:d().n.Popup,alignmentToOrigin:l().C.Center,open:t,render:()=>(0,y.jsx)("div",{style:{minWidth:360,padding:16},children:(0,y.jsxs)(u().VP,{gap:16,children:[(0,y.jsx)("div",{style:{fontSize:16,fontWeight:500},children:(0,y.jsx)(n().sA,{id:"TopbarPageAnalyticsOptOutMenu.heading",defaultMessage:"Privacy settings"})}),(0,y.jsx)(x,{store:r})]})}),originRect:o,onDismiss:()=>f.setState({isOpen:!1,rect:void 0})}):null}function x(e){const t=(0,s().v3)(),o=(0,i().K8)((()=>{const e=c().default.state.currentSpaceViewStore;return null==e?void 0:e.getSettings()}),[]),l=(0,i().K8)((()=>{const t=null==o?void 0:o.page_analytics_opt_out_list;return null==t?void 0:t.includes(e.store.id)}),[o,e.store.id]);return(0,y.jsx)(g().A,{type:"dropdown",currentOption:l?"do_not_record":"record",options:[{key:"record",label:(0,y.jsx)(n().sA,{id:"page_analytics.opt_out.record",defaultMessage:"Record"})},{key:"do_not_record",label:(0,y.jsx)(n().sA,{id:"page_analytics.opt_out.do_not_record",defaultMessage:"Don't record"})}],onSelectOption:o=>{"do_not_record"===o?r().Oy(t,e.store.id):r().F3(t,e.store.id)},isMobile:t.device.isMobile,title:(0,y.jsx)(n().sA,{id:"page_analytics.opt_out.title",defaultMessage:"My view history"}),caption:(0,y.jsx)(n().sA,{id:"page_analytics.opt_out.caption",defaultMessage:"Page editors can see my view history for this page. <inlinelink>Learn more</inlinelink>.",values:{inlinelink:e=>(0,y.jsx)(p().A,{external:!0,href:(0,a().xS)("guides.pageAnalytics"),children:e})}}),captionStyle:{maxWidth:270}})}},704495:(e,t,o)=>{o.d(t,{F:()=>d});var s=o(296540),i=()=>o(847249),n=()=>o(774733),r=()=>o(94953),a=()=>o(372154),l=o(474848);const d=s.forwardRef((function(e,t){const{currentBlockStore:d,discussionStore:c,showAllRepliesAfterTimestamp:u,focused:m,isLast:p,location:g}=e,y=(0,i().K8)((()=>a().A.state.open&&a().A.state.discussionIds||[]),[]),f=(0,o(484714).v3)();(0,s.useEffect)((()=>{var e;if(m){r().A.setState({source:"update_sidebar",discussionIds:[c.id]});const e=setTimeout((()=>{var e;(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&o(546574).A.markDiscussionsInteractedWith([c.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=r().A.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===c.id&&r().A.setState({discussionIds:[]})}),[m,c,f]);const v=(0,i().K8)((()=>{var e;return(null===(e=r().A.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),x=c.id,{parentId:h,currentSpaceId:S}=(0,i().K8)((()=>({parentId:c.getParentId(),currentSpaceId:c.getSpaceId()})),[c]),b=h?o(630116).Bv.createChildStore(c,{table:o(179034).ev,id:h}):void 0,A=y.includes(x),j=v.includes(x),C=(0,o(401497).IS)((e=>({discussionContainer:{paddingTop:f.device.isMobile?4:6,borderBottom:p||f.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},hoveredStyle:{background:"sidebar"===g?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===g?e.focusDiscussionBackground:void 0},menuStyle:{marginLeft:-12,marginRight:-12,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})),[f.device.isMobile,p,g]),{value:M}=(0,o(645873).fJ)(n().commentsDependency);if(!M)return null;if(!b||!S)return null;const k=(0,l.jsx)("div",{className:`sidebar-discussion-${x} ${o(38337)._57}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...C.discussionContainer,...j?C.hoveredStyle:{},...A?C.pressedStyle:{}},children:(0,l.jsx)(n().PW,{store:c,blockStore:d,format:M.discussionHelpers.DiscussionFormat.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:u})});return(0,l.jsx)(o(678553).Ay,{allowTextSelection:!0,title:k,style:C.menuStyle})}))},745591:(e,t,o)=>{o.d(t,{x:()=>F});o(898992),o(672577);var s=o(296540),i=()=>o(908006),n=()=>o(847249),r=()=>o(401497),a=()=>o(764880),l=()=>o(700500),d=o(474848);const c=(0,o(340498).wt)("commentSidebarZero",{viewBox:"0 0 56 56",svg:(0,d.jsx)("path",{d:"M13.1289 47.6641C13.9297 47.6641 14.4961 47.3516 15.4141 46.5508L21.8984 40.5938C23.0703 42.4297 25.1602 43.4258 27.9922 43.4258H36.3516L42.6602 48.8164C43.5195 49.5586 44.0273 49.9492 44.7305 49.9492C45.7461 49.9492 46.332 49.2266 46.332 48.0938V43.4258H47.4453C51.8398 43.4258 54.6328 40.8281 54.6328 36.2969V24.1289C54.6328 19.5977 51.8398 17 47.4453 17H43.9688V14.793C43.9688 9.83203 41.0781 7 36.0977 7H8.87109C4.00781 7 1 9.83203 1 14.793V32.4297C1 37.4102 4.00781 40.2422 8.87109 40.2422H11.4492V45.7695C11.4492 46.9609 12.0742 47.6641 13.1289 47.6641ZM13.7539 39.2461C13.7539 38.3867 13.2266 37.9766 12.543 37.9766H9.08594C5.43359 37.9766 3.42188 36.043 3.42188 32.293V14.9492C3.42188 11.2188 5.45312 9.26562 9.08594 9.26562H35.8828C39.5156 9.26562 41.5469 11.2188 41.5469 14.9492V17H27.9922C23.4414 17 20.8047 19.5977 20.8047 24.1289V36.3164C20.8047 36.9805 20.8438 37.6055 20.9609 38.1719L13.7539 44.9883V39.2461ZM44.0859 47.2148L38.1289 41.9023C37.4844 41.3359 37.0938 41.1602 36.2344 41.1602H28.168C25.0039 41.1602 23.207 39.4805 23.207 36.1797V24.2656C23.207 20.9648 25.0039 19.2656 28.168 19.2656H47.25C50.4336 19.2656 52.2305 20.9648 52.2305 24.2656V36.1602C52.2305 39.4609 50.4336 41.1602 47.25 41.1602H45.2383C44.5938 41.1602 44.0859 41.5312 44.0859 42.3711V47.2148Z"})});var u=()=>o(959013),m=()=>o(534177),p=()=>o(284371),g=()=>o(878523),y=()=>o(620689),f=()=>o(725614),v=()=>o(441467),x=()=>o(116008),h=()=>o(864943),S=()=>o(862292),b=()=>o(449195),A=()=>o(231722),j=()=>o(347199),C=()=>o(792002),M=()=>o(129522),k=()=>o(77126),w=()=>o(489348),I=()=>o(737230),B=()=>o(24157);function F(e){const{environment:t,device:o,navigableBlockStore:a,actorForFilter:F,currentCommentsMode:D,currentCommentsType:_}=e,L=(0,n().K8)((()=>{if(o.isMobile)return!1;if(!t.currentUser.isLoggedIn())return!1;if("suggestions"===_||"resolved"===D)return!1;if(null==a||!a.canComment())return!1;const e=B().default.getRootBlockStoreOfSelection();return!!(e&&"page"!==e.getType()||"section_hide"!==(0,b().Rn)())}),[o.isMobile,_,D,a,t.currentUser]),P=(0,s.useCallback)((async()=>{const e=B().default.getRootBlockStoreOfSelection(),o=e&&"page"!==e.getType()&&!e.isEmptyTitle()?"block":"page";switch(g().Bi(t,{target:o}),o){case"block":y().BM({environment:t,animate:!0}),await i().default.afterNextFlush();const s=await S().T.formulas.load();return void(e&&function(e){const{environment:t,blockStore:o,formulasModule:s}=e,i=o.getModel();if(!o.isDefined()||null==i||!i.isType(l().uP))return;const n=o.getTitleStore(),r=n&&(0,C().s6)(n);if(!(n&&r&&r.endIndex>0))return;(0,v().hN)({environment:t,blockStore:o,multiSelection:(0,A().$U)({store:n,selection:{startIndex:0,endIndex:r.endIndex}}),rect:M().K.getRect(o),from:"updates_sidebar",formulasModule:s})}({environment:t,blockStore:e,formulasModule:s}));case"page":if(await i().default.afterNextFlush(),!1===x().A.state.open&&x().A.setState({open:!1,rect:new DOMRect,from:"updates_sidebar"}),!a)return;return w().A.openNewPageDiscussionInput(a),await i().default.afterNextFlush(),void function(e){const{blockStore:t,environment:o}=e;if(!t)return;const s=k().j.find((e=>e.getBlockStore().id===t.id));if(!s)return;const n=s.getNode(),r=s.getInputStore();if(!n||n.nodeType!==Node.ELEMENT_NODE)return;y().hT({element:n,environment:o,scrollerContext:{verticalScroller:j().A.PageScroller,horizontalScroller:void 0},animate:!0,vertical:{reveal:"closest"},horizontal:void 0}),I().Ay.setState({...I().Ay.state,expanded:!1}),i().default.afterNextFlush((()=>{f().setSelectionAtEnd({store:r.state.textStore})}))}({blockStore:a,environment:t});default:(0,m().HB)(o)}}),[t,a]),E=(0,r().IS)((e=>({commentsEmptyStyle:{flex:1,display:"flex",gap:11,alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",fontSize:14,position:"relative",background:e.contentBackground,marginRight:0,pointerEvents:"auto",paddingTop:10},commentsContainerMessage:{fontWeight:p().Wy.semibold,color:e.text.secondary},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,fill:e.mediumIconColor},addCommentButton:{borderRadius:6}})),[]);return(0,d.jsx)("div",{style:E.commentsContentStyle,children:(0,d.jsxs)("div",{style:E.commentsEmptyStyle,children:[c(E.commentsIconStyle),(0,d.jsx)("div",{style:E.commentsContainerMessage,children:(0,d.jsx)(T,{commentsMode:D,commentsType:_,actorForFilter:F})}),L?(0,d.jsx)(h().A,{size:"lg",onClick:P,style:E.addCommentButton,children:(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyCommentsButton",defaultMessage:"Add comment"})}):null]})})}function T(e){let{commentsMode:t,commentsType:o,actorForFilter:s}=e;const i=(0,u().tz)(),r=(0,n().K8)((()=>(0,a().lR)(i,s)),[i,s]);return(0,d.jsx)(d.Fragment,{children:((e,t)=>{if("unresolved"===e){if("commentsAndSuggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestionsForUser",defaultMessage:"No open comments or suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsAndSuggestions",defaultMessage:"No open comments or suggestions"});if("comments"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedCommentsForUser",defaultMessage:"No open comments from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedComments",defaultMessage:"No open comments"});if("suggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestionsForUser",defaultMessage:"No open suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyUnresolvedSuggestions",defaultMessage:"No open suggestions"})}else{if("commentsAndSuggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestionsForUser",defaultMessage:"No resolved comments or suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsAndSuggestions",defaultMessage:"No resolved comments or suggestions"});if("comments"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedCommentsForUser",defaultMessage:"No resolved comments from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedComments",defaultMessage:"No resolved comments"});if("suggestions"===t)return s?(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestionsForUser",defaultMessage:"No resolved suggestions from {userName}",values:{userName:r}}):(0,d.jsx)(u().sA,{id:"updateSidebar.commentContainer.emptyResolvedSuggestions",defaultMessage:"No resolved suggestions"})}})(t,o)})}},750420:(e,t,o)=>{o.d(t,{f2:()=>x,Oi:()=>h,HX:()=>v,Ay:()=>S});o(296540);var s=()=>o(484714),i=()=>o(847249),n=()=>o(401497),r=()=>o(175947),a=()=>o(959013),l=()=>o(284371),d=()=>o(987017),c=()=>o(38337),u=()=>o(737230),m=()=>o(508496),p=()=>o(187959);const g=new(o(463830).A);var y=()=>o(577009),f=o(474848);function v(){return(0,f.jsx)(a().sA,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function x(){return(0,f.jsx)(a().sA,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")}const h="UpdateSidebar";function S(e){const t=(0,s().v3)(),{enablePageAnalytics:o,navigableBlockStore:a,inPeekView:S,noTopMargin:b}=e,A=(0,n().IS)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:b?0:r().ek(t.device.isElectronMac),paddingTop:4,width:"100%",background:S?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},getNotifiedFor:{...o?{padding:8}:{paddingBottom:14}},label:{fontSize:14,color:e.text.primary,fontWeight:l().Wy.medium,margin:0,padding:0}})),[b,t.device.isElectronMac,S,o]),j=(0,i().K8)((()=>u().Ay.state.updatesSubTab),[]),C=S?g:p().A,M=(0,i().K8)((()=>"on"===m().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]);return(0,f.jsxs)("div",{style:{...A.updatesHeaderStyle,...o?{padding:"0 6px"}:{}},className:c().Kbf,children:[!M&&(0,f.jsx)(y().QB,{navigableBlockStore:a,from:"page_updates",buttonPopupStore:C,style:A.getNotifiedFor}),o?(0,f.jsx)(d().Ay,{tabs:[(0,f.jsx)(v,{},"updates"),(0,f.jsx)(x,{},"analytics")],selectedIndex:j,onChange:e.onTabChange,style:{...A.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"},idPrefix:h}):(0,f.jsx)("h2",{style:A.label,children:(0,f.jsx)(v,{})})]})}},829548:(e,t,o)=>{o.d(t,{y:()=>i});o(296540);const s={viewBox:"0 0 20 20",svg:(0,o(474848).jsx)("path",{d:"M6.303 3.625c-.71 0-1.374.355-1.768.946L2.232 8.025c-.233.35-.357.76-.357 1.18v5.045c0 1.174.951 2.125 2.125 2.125h12a2.125 2.125 0 0 0 2.125-2.125V9.204c0-.42-.124-.83-.357-1.179l-2.303-3.454a2.13 2.13 0 0 0-1.768-.946zm-.728 1.64a.88.88 0 0 1 .728-.39h7.394c.293 0 .566.146.728.39l2.303 3.454a1 1 0 0 1 .083.156h-4.702a.625.625 0 0 0-.625.625v.476a1.484 1.484 0 0 1-2.968 0V9.5a.625.625 0 0 0-.625-.625H3.189a1 1 0 0 1 .083-.156zm-2.45 4.86H7.27a2.734 2.734 0 0 0 5.46 0h4.145v4.125a.875.875 0 0 1-.875.875H4a.875.875 0 0 1-.875-.875z"})},i=(0,o(340498).wt)("inbox",s)},831272:(e,t,o)=>{o.d(t,{R:()=>je});o(944114),o(898992),o(354520),o(430670),o(581454),o(737550);var s=o(296540),i=()=>o(484714),n=()=>o(847249),r=()=>o(401497),a=()=>o(869190),l=()=>o(416504),d=()=>o(175947),c=()=>o(959013),u=()=>o(496603),m=()=>o(774733),p=()=>o(789557),g=()=>o(938045),y=()=>o(273321),f=()=>o(493319),v=()=>o(94953),x=()=>o(555776),h=()=>o(116008),S=()=>o(928600),b=()=>o(939740),A=()=>o(480095),j=()=>o(2143),C=()=>o(284371),M=()=>o(38337),k=()=>o(123021),w=(o(672577),()=>o(764880)),I=()=>o(30626),B=()=>o(516672),F=()=>o(835607),T=()=>o(534177),D=()=>o(493823),_=()=>o(760217),L=()=>o(406699),P=()=>o(678553),E=()=>o(8980),K=()=>o(89924),R=()=>o(859428),U=()=>o(457688),O=()=>o(972435),N=()=>o(722872),W=()=>o(869562),H=()=>o(737230),V=()=>o(265201),z=()=>o(962730),$=()=>o(377586),Y=o(474848);const q=["commentsAndSuggestions","comments","suggestions"],Z=["unresolved","resolved"],G={unresolved:M().jc0,resolved:M().tXX},X=(0,c().YK)({unresolved:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open"},resolved:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved"},commentsAndSuggestions:{id:"updateSidebar.comments.typeMode.commentsAndSuggestions",defaultMessage:"Any"},comments:{id:"updateSidebar.comments.typeMode.comments",defaultMessage:"Comments only"},suggestions:{id:"updateSidebar.comments.typeMode.suggestions",defaultMessage:"Suggestions only"}}),J=(0,c().YK)({filterLabel:{id:"updateSidebar.comments.filter.label",defaultMessage:"Filter"}});function Q(e,t,o,s,i){if(t)return e;const{items:n}=e;if(n.length<=6)return e;const r=[...n.slice(0,5),{key:"show more",render:e=>(0,Y.jsx)(_().A,{...e,icon:(0,I()._)(i.showMoreResultsButton),title:(0,Y.jsx)("span",{style:i.showMoreResultsButtonTitle,children:(0,Y.jsx)(c().sA,{defaultMessage:"{numberMore} more results",id:"updateSidebar.comments.filter.byPerson.showMoreResultsButton.title",values:{numberMore:n.length-5}})})}),action:()=>{o(!0)}}];return{...e,items:r}}function ee(e){let{numCommenters:t,userActorsForDisplay:o,actorForFilter:s,setActorForFilter:n,onMobileClose:a,currentCommentsMode:l,currentTypeMode:d,popupOpen:u,setPopupOpen:m,peopleFilterExpanded:p,setPeopleFilterExpanded:g}=e;const y=(0,i().v3)(),f=y.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By type",id:"commentFilterMenu.typeSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by type",id:"commentFilterMenu.typeSectionDesktop.title"}),v=y.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By status",id:"commentFilterMenu.statusSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by status",id:"commentFilterMenu.statusSectionDesktop.title"}),x=y.device.isMobile?(0,Y.jsx)(c().sA,{defaultMessage:"By person",id:"commentFilterMenu.personFilterSectionMobile.title"}):(0,Y.jsx)(c().sA,{defaultMessage:"Filter by person",id:"commentFilterMenu.personFilterSectionDesktop.title"}),h=(0,r().IS)((e=>({anyoneMenuItemMobileIconStyles:{width:P().nd,fill:e.mediumIconColor},showMoreResultsButton:{width:16,fill:e.text.secondary},showMoreResultsButtonTitle:{color:e.text.secondary}})),[]),j={key:"typeMode",render:e=>(0,Y.jsx)(K().A,{...e,title:f}),items:q.map((e=>({key:e,render:t=>(0,Y.jsx)(_().A,{...t,title:O().A.formatMessage(X[e]),isChecked:d===e}),action:()=>{W().setUpdateSidebarCommentsTypeMode(e),y.device.isMobile||m(!1)}})))},C={key:"commentFilter",render:e=>(0,Y.jsx)(K().A,{...e,topBorder:!0,title:v}),items:Z.map((e=>({key:e,render:t=>(0,Y.jsx)(_().A,{...t,className:G[e],title:O().A.formatMessage(X[e]),isChecked:l===e}),action:()=>{W().setUpdateSidebarCommentsMode(e),y.device.isMobile||m(!1)}})))},M={key:"anyone",render:e=>(0,Y.jsx)(_().A,{...e,title:(0,Y.jsx)(c().sA,{defaultMessage:"Anyone",id:"commentFilterMenu.anyoneItem.title"}),mobileIconStyle:h.anyoneMenuItemMobileIconStyles,icon:(0,Y.jsx)(E().I,{icon:F().peopleIcon,color:"graySecondary"}),isChecked:void 0===s}),action:()=>{n(void 0),y.device.isMobile||m(!1)}},k=o.map((e=>{const t=e.getActorUserId();if(t){return{key:t,render:o=>(0,Y.jsx)(U().A,{...o,actor:e,useEmailAsTooltip:!0,isChecked:(null==s?void 0:s.getActorUserId())===t,right:(0,Y.jsx)(P().w4,{visible:(null==s?void 0:s.getActorUserId())===t})}),action:()=>{n(e),y.device.isMobile||m(!1)}}}})).filter(T().O9),w={key:"personFilter",render:e=>(0,Y.jsx)(K().A,{topBorder:!0,...e,title:x}),items:y.device.isMobile?[M,...k]:1===t?k:[M,...k]},I=(0,Y.jsx)(b().Ay,{type:b().Oh.Vertical,initialFocus:void 0,sections:[j,C,y.device.isMobile?w:Q(w,p,g,0,h)]});return y.device.isMobile?(0,Y.jsx)(S().A,{menuType:N().gu.Modal,scrollerStyle:{paddingBottom:0},title:(0,Y.jsx)(c().sA,{defaultMessage:"Filter",id:"commentFilterMenu.title"}),right:(0,Y.jsx)(A().DoneMenuText,{}),onClickRight:()=>{a(),m(!1)},children:I}):I}function te(e){let{userActors:t,actorForFilter:o,setActorForFilter:a}=e;const l=(0,i().v3)(),d=(0,c().tz)(),u=(0,n().K8)((()=>H().Ay.state.expanded),[]),m=(0,n().K8)((()=>V().A.state.open),[]),p=(0,n().K8)((()=>{let e=[...t];return o&&!e.find((e=>e.getActorUserId()===o.getActorUserId()))&&(l.device.isMobile?a(void 0):e=[o,...e]),e.sort(((e,t)=>{const o=(0,w().lR)(d,e),s=(0,w().lR)(d,t);return o&&s?o.localeCompare(s):0})),e}),[d,o,t,l.device.isMobile,a]),[g,y]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1),[x,h]=(0,n().K8)((()=>[H().Ay.state.commentsMode,H().Ay.state.commentsTypeMode]),[]),S=(0,r().IS)((e=>({toggleButton:{justifyContent:"center",display:"flex",color:e.text.secondary},toggleButtonContainer:{paddingRight:l.device.isMobile?0:8,display:"flex"},filterIcon:{width:l.device.isMobile?18:16,fill:o||"resolved"===x?e.icon.uiBluePrimary:e.mediumIconColor}})),[o,x,l.device.isMobile]),b=O().A.formatMessage(J.filterLabel);return(0,n().K8)((()=>{l.device.isMobile||u?l.device.isMobile&&!m&&(W().setUpdateSidebarCommentsMode("unresolved"),a(void 0)):(W().setUpdateSidebarCommentsMode("unresolved"),a(void 0),v(!1))}),[m,l.device.isMobile,a,u]),(0,Y.jsx)(L().Ay,{open:g,originGap:0,popupType:l.device.isMobile?$().n.SlideUp:$().n.Popup,renderOrigin:e=>(0,Y.jsx)(R().A,{...e,placement:z().W.Bottom,renderTooltip:()=>b,render:e=>(0,Y.jsx)("div",{style:S.toggleButtonContainer,className:M().kJD,children:(0,Y.jsx)(D().p,{...e,style:S.toggleButton,onClick:()=>{y(!0)},children:(0,B().S)(S.filterIcon)})})}),placementToOrigin:z().W.Bottom,alignmentToOrigin:z().C.Center,render:e=>(0,Y.jsx)(ee,{userActorsForDisplay:p,actorForFilter:o,setActorForFilter:a,onMobileClose:()=>e.close(),currentCommentsMode:x,currentTypeMode:h,popupOpen:g,setPopupOpen:y,peopleFilterExpanded:f,setPeopleFilterExpanded:v,numCommenters:t.length}),onClose:()=>{y(!1)}})}var oe=()=>o(351360),se=()=>o(463830),ie=()=>o(508496);function ne(e){let{userActors:t,actorForFilter:o,setActorForFilter:s}=e;const i=(0,r().IS)((e=>({container:{display:"flex",flexDirection:"column",borderBottom:`1px solid ${e.regularDividerColor}`},commentsHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto"},label:{lineHeight:"inherit",fontSize:14,color:e.text.primary,fontWeight:C().Wy.medium,display:"flex",alignItems:"center",margin:0,padding:"12px 12px 12px 16px"},notificationsLabel:{fontSize:C().J.UISmall.desktop,color:e.text.secondary,fontWeight:C().Wy.medium},notificationsBorder:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:4,marginTop:4},notificationsContainer:{padding:"0 16px 14px"}})),[]),a=(0,n().K8)((()=>"on"===ie().default.getEligibleGroup({experimentId:"remove_updates_topbar_button_v2",defaultGroup:"control",disableExposureLogging:!0})),[]),l=(0,n().O$)(oe().AppStoreMainEditorCurrentBlockStore),d=(0,n().uB)(void 0,se().A);return(0,Y.jsxs)("div",{style:i.container,children:[(0,Y.jsxs)("div",{style:i.commentsHeader,className:M().S4C,children:[(0,Y.jsx)("h2",{style:i.label,children:(0,Y.jsx)(c().sA,{id:"updateSidebar.header.commentsAndSuggestionsLabel",defaultMessage:"Comments & suggestions"})}),(0,Y.jsx)(te,{userActors:t,actorForFilter:o,setActorForFilter:s})]}),a&&l&&(0,Y.jsxs)("div",{style:i.notificationsContainer,children:[(0,Y.jsx)("div",{style:i.notificationsLabel,children:(0,Y.jsx)(c().sA,{defaultMessage:"Notify me for",id:"topbarCommentsDesktop.notifications.label"})}),(0,Y.jsx)("div",{style:i.notificationsBorder,children:(0,Y.jsx)(k().O,{blockStore:l,moreProminentStyling:!0,from:"comments_sidebar",buttonPopupStore:d})})]})]})}var re=()=>o(299545),ae=()=>o(347199),le=()=>o(953418),de=()=>o(645873),ce=()=>o(963589),ue=()=>o(644914),me=()=>o(756279),pe=()=>o(372154),ge=()=>o(546574),ye=()=>o(745591),fe=()=>o(704495),ve=()=>o(128973);function xe(e){const t=(0,n().K8)((()=>x().A.state.isHovered),[]),o=(0,n().K8)((()=>x().A.state.isActivelyComposing),[]),s=(0,r().IS)((e=>({hoveredStyle:{background:e.hoveredDiscussionBackground},pressedStyle:{background:e.focusDiscussionBackground},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:C().Wy.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[]);return(0,Y.jsx)(K().A,{desktopTitleStyle:{...s.basicDesktopTitleStyle,...t?s.hoveredStyle:{},...o?s.pressedStyle:{}},mobileTitleStyle:s.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0,...e})}var he=()=>o(423817);const Se=new(o(970585).A),be=50;function Ae(e){ae().A.UpdateSidebarCommentScroller=e}function je(e){const{timeViewed:t,location:o}=e,C=(0,i().v3)(),k=(0,i().Y0)(),[w,I]=(0,s.useState)(!1),[B,F]=(0,s.useState)(void 0),T=(0,n().O$)(oe().AppStoreMainEditorCurrentBlockStore),D=(0,n().K8)((()=>C.currentUser.id),[C]),_=(0,ce().X)("comment_sidebar_for_you"),{value:L}=(0,de().fJ)(m().commentsDependency),P=(0,n().K8)((()=>L?L.discussionHelpers.getDiscussionsForSidebar({blockStore:T,currentUserId:D,ignoreAfterTime:t}):[]),[L,T,t,D]),E=(0,n().K8)((()=>H().Ay.state.commentsMode),[]),K=(0,n().K8)((()=>H().Ay.state.commentsTypeMode),[]),R=(0,n().K8)((()=>(0,ue().me)(C)),[C]),U=(0,n().K8)((()=>{const e=("comments"===K||"commentsAndSuggestions"===K)&&"unresolved"===E,t=(h().A.hasContent()||x().A.state.isActivelyComposing)&&h().A.isDraftCommentOnValidSelection();return(R||k.isMobile)&&t&&e&&h().A.ifPropertyCommentShouldDisplay()}),[E,K,k.isMobile,R]),W=(0,n().K8)((()=>pe().A.getOpenDiscussionIds()),[]),V=(0,n().K8)((()=>{const e="commentsAndSuggestions"===K?P:P.filter((e=>e.getType()===H().zX[K])),{resolved:t,unresolved:o}=(0,re().uy)(e);return"unresolved"===E?o:t}),[P,K,E]),z=V.map((e=>e.id)),$=(0,n().K8)((()=>B?V.filter((e=>(0,re().wc)(e).map((e=>e.getCreatedById())).some((e=>e===B.getActorUserId())))):V),[V,B]),q=(0,n().K8)((()=>(0,f().getSetOfUsersInDiscussions)(V)),[V]);(0,s.useEffect)((()=>{if("popup"===o&&w)return()=>{ge().A.markDiscussionsInteractedWith(z)}}),[o,z,w]);const Z=(0,r().IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},filterControlStyle:{position:"absolute",top:-37,right:40}})),[]),G=(0,s.useRef)(null),X=(0,n().K8)((()=>{if(!L)return{};const e=u().$z($,(e=>{const o=L.discussionHelpers.getLatestRelevantComment({recordStore:e,currentUserId:D,timestamp:t});return o?(0,a().aD)(o.getCreatedTime()):""}));return delete e[""],e}),[L,$,t,D]),J=(0,n().K8)((()=>!L||L.discussionHelpers.anyDiscussionCommentsLoading($)),[L,$]);(0,s.useEffect)((()=>{w||J||I(!0)}),[w,J]);const Q=(0,s.useCallback)((()=>{x().A.setHoverWithSource("comments_pane"),v().A.reset()}),[]),ee=(0,s.useCallback)((()=>{x().A.resetHoverSource("comments_pane")}),[]),se=(0,n().K8)((()=>x().A.state.isActivelyComposing),[]);if(!T||!X||!w)return(0,Y.jsx)(he().J,{areaHeight:window.innerHeight});const ie=(0,a().aD)(Date.now()),ae=Object.keys(X).sort().reverse();!U||0!==ae.length&&ae.includes(ie)||ae.unshift(ie);const je=ae.map(((e,s)=>{const i=(0,a().ZF)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,l().P)(),intl:O().A.getIntl(),allowRelativeDates:!0}),n=X[e],r=U&&e===ie,d=[];r&&d.push({key:"draft-discussion-in-comments-pane",render:e=>(0,Y.jsx)(y().A,{environment:C,shouldShowBottomDividerLine:!(1===ae.length&&0===(null==n?void 0:n.length)),menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:Q,onMouseLeave:ee}),action:()=>{const e=h().A.getDiscussionInputStore();e&&(x().A.setActiveWithSource("comments_pane"),pe().A.reset(),(0,g().x)({currentBlockStore:T,discussionInputStore:e,environment:C,dontAffectCursor:se,animateScroll:!0}))}});const c=n?n.map(((e,i)=>{const a=e.getRecordStoreUIParent()??T,l={key:e.id,render:l=>(0,Y.jsx)(fe().F,{...l,currentBlockStore:a,discussionStore:e,isFirstInSection:0===i&&!r,location:o,isLast:i===n.length-1&&s===ae.length-1,showAllRepliesAfterTimestamp:t}),action:()=>{se&&x().A.resetAllActiveSources(),p().DZ({discussionStore:e,currentBlockStore:T,environment:C,analyticsFrom:"updates_sidebar",currentEl:G.current})}};return l})):[];return d.push(...c),{key:e,render:e=>r?(0,Y.jsx)(xe,{title:i,...e}):(0,Y.jsx)(ve().P,{title:i,firstItemId:n[0].id,location:o,ignoreFirstItemState:r,...e}),items:d}})),Ce=je.flatMap((e=>e.items)).findIndex((e=>W.includes(e.key.toString()))),Me=0!==$.length||U?(0,Y.jsx)(j().H,{type:me().A.Y,style:Z.scrollerStyle,className:M().bzV,ref:Ae,children:(0,Y.jsx)(b().Ay,{disableKeyboard:!0,store:Se,type:b().Oh.Vertical,initialFocus:Ce>=0?Ce:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),o=d().ek(C.device.isElectronMac),s=window.innerHeight,i=o+be,n=s-i;if(t.height>=n)return;const r=t.top>=i&&t.top<=s,a=r&&t.bottom>=s,l=t.bottom>=i&&t.bottom<=s,c=l&&t.top-i<0,u=r||l,m=.4*t.height;a&&Math.abs(t.top-s)<m?(0,le().vq)(e,{edgeDist:s-t.height-i,animate:!0}):c&&Math.abs(t.bottom-i)<m?(0,le().vq)(e,{edgeDist:0,animate:!0}):u||(0,le().vq)(e,{edgeDist:0,animate:!0})}},sections:je})}):(0,Y.jsx)(ye().x,{environment:C,device:k,navigableBlockStore:T,actorForFilter:B,currentCommentsMode:E,currentCommentsType:K});return C.device.isMobile?_?(0,Y.jsxs)("div",{style:Z.commentsContentStyle,children:[k.isPhone&&(0,Y.jsx)("div",{style:Z.filterControlStyle,children:(0,Y.jsx)(te,{userActors:q,actorForFilter:B,setActorForFilter:F})}),Me]}):(0,Y.jsx)(S().A,{menuType:N().gu.Modal,title:(0,Y.jsx)(c().sA,{defaultMessage:"Comments & suggestions",id:"topbarMobile.commentsAndSuggestionsMenu.title"}),left:(0,Y.jsx)(te,{userActors:q,actorForFilter:B,setActorForFilter:F}),leftOuterStyle:{position:"relative",marginLeft:-4,paddingRight:4},right:(0,Y.jsx)(A().DoneMenuText,{}),onClickRight:e.onMobileClose,children:Me}):(0,Y.jsxs)("div",{style:Z.commentsContentStyle,ref:G,children:[(0,Y.jsx)(ne,{userActors:q,actorForFilter:B,setActorForFilter:F}),Me]})}},913139:(e,t,o)=>{o.d(t,{B:()=>C});var s=o(296540),i=()=>o(847249),n=()=>o(737230),r=(o(57145),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(672577),o(581454),()=>o(484714)),a=()=>o(938045),l=()=>o(273321),d=()=>o(94953),c=()=>o(555776),u=()=>o(116008),m=()=>o(939740),p=()=>o(347199),g=()=>o(372154),y=o(474848);function f(e){const{navigableBlockStore:t}=e,d=(0,r().v3)(),p=(0,r().Y0)(),[f,j]=(0,s.useState)(new Set),C=function(e){const[t,o]=(0,s.useState)(new Map),n=(0,i().K8)((()=>{const t=new Map;for(const o of e)if(b(o)){const e=A(o);e&&t.set(o.id,e)}return t}),[e]);(0,s.useEffect)((()=>o((e=>{const t=new Map;for(const[o,s]of n.entries())e.has(o)||t.set(o,s);if(t.size){for(const[o,s]of e.entries())t.set(o,s);return t}return e}))),[n]);const r=(0,s.useCallback)((e=>(null==t?void 0:t.get(e.id))??A(e)),[t]);return(0,i().K8)((()=>e.toSorted(((e,t)=>r(t)-r(e)))),[e,r])}((0,o(419123).P)({navigableBlockStore:t,forceIncludeDiscussionIds:f})),M=function(e){const{environment:t,navigableBlockStore:o}=e,n=(0,i().K8)((()=>{const e=(u().A.hasContent()||c().A.state.isActivelyComposing)&&u().A.isDraftCommentOnValidSelection();return Boolean(e&&u().A.ifPropertyCommentShouldDisplay())}),[]),r=(0,i().K8)((()=>c().A.state.isActivelyComposing),[]),d=(0,s.useMemo)((()=>({key:"draft-discussion-in-comments-pane",render:e=>(0,y.jsx)(l().A,{environment:t,shouldShowBottomDividerLine:!0,menuListItemProps:e,shouldExpandDiscussionWidth:!0,onMouseEnter:h,onMouseLeave:S}),action:()=>{const e=u().A.getDiscussionInputStore();e&&(c().A.setActiveWithSource("comments_pane"),g().A.reset(),(0,a().x)({currentBlockStore:o,discussionInputStore:e,environment:t,dontAffectCursor:r,animateScroll:!0}))}})),[t,o,r]);return n?d:void 0}({environment:d,navigableBlockStore:t}),k=(0,s.useRef)(null),w=[...M?[M]:[],...C.map((e=>({key:e.id,render:o=>{let{ref:i,...n}=o;return(0,s.createElement)(v,{...n,key:e.id,discussionStore:e,navigableBlockStore:t})},action:()=>o(789557).DZ({discussionStore:e,currentBlockStore:t,environment:d,analyticsFrom:"updates_sidebar",currentEl:k.current})})))];(0,s.useEffect)((()=>{j((e=>{const t=C.map((e=>e.id)).filter((t=>!e.has(t)));return t?new Set([...e,...t]):e}))}),[C]);const I=(0,i().K8)((()=>g().A.getOpenDiscussionIds()),[]),B=w.findIndex((e=>I.includes(e.key.toString()))),F=(0,s.useCallback)((e=>{const t=e.getOpenDiscussionIds(),o=C.find((e=>t.includes(e.id)));t.length&&!o&&n().Ay.update((e=>({...e,...n().Ay.createUpdateForNewCommentsSidebar(n().UL.Comments)})))}),[C]),T=(0,o(725252).L)({value:!0,waitTimeInMs:1e3}).value;(0,s.useEffect)((()=>{if(T)return g().A.addListener(F),()=>g().A.removeListener(F)}),[T,F]);const D=(0,o(401497).IS)((e=>({commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:0,pointerEvents:"auto",height:"100%"},scrollerStyle:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0}})),[]);return(0,y.jsx)("div",{style:D.commentsContentStyle,ref:k,children:w.length?(0,y.jsx)(o(2143).H,{type:o(756279).A.Y,style:D.scrollerStyle,className:o(38337).bzV,ref:x,children:t&&(0,y.jsx)(m().Ay,{initialFocus:B??0,type:m().Oh.Vertical,sections:[{key:0,render:e=>(0,y.jsx)(o(128973).P,{location:"sidebar",...e}),items:w}]})}):(0,y.jsx)(o(745591).x,{environment:d,device:p,navigableBlockStore:t})})}const v=s.memo(s.forwardRef((function(e,t){const{discussionStore:s,navigableBlockStore:n,...r}=e,a=(0,i().K8)((()=>s.getRecordStoreUIParent()),[s]),l=a instanceof o(630116).Bv?a:n;return(0,y.jsx)("div",{children:(0,y.jsx)(o(704495).F,{...r,ref:t,currentBlockStore:l,discussionStore:s,isFirstInSection:!0,isLast:!0,location:"sidebar",showAllRepliesAfterTimestamp:void 0})})})));function x(e){p().A.UpdateSidebarCommentScroller=e}function h(){c().A.setHoverWithSource("comments_pane"),d().A.reset()}function S(){c().A.resetHoverSource("comments_pane")}function b(e){return e.isDefined()&&e.getCommentStores().every((e=>e.isDefined()))}function A(e){return Math.max(...e.getCommentStores().map((e=>e.getCreatedTime())))}var j=()=>o(310830);const C=s.memo((function(e){const{navigableBlockStore:t,timeViewed:s}=e,r=(0,i().K8)((()=>n().Ay.getTabForNewCommentsSidebar()),[]);switch(r){case n().UL.ForYou:return(0,y.jsx)(f,{navigableBlockStore:t});case n().UL.Comments:return(0,y.jsx)(o(831272).R,{timeViewed:s,location:"sidebar"});case n().UL.Updates:case n().UL.Analytics:return(0,y.jsx)(j().f,{enablePageAnalytics:!0});case n().UL.Info:return(0,y.jsx)(o(146594).H,{store:t,context:o(548821).Rr.Frame,disabled:!1,shownAs:"sidebar"});default:return(0,o(534177).ub)(r),null}}))}}]);