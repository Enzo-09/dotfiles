"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[91325],{247324:(e,t,i)=>{i.r(t),i.d(t,{PublicPagesSection:()=>ne});var s=i(296540),n=()=>i(484714),a=()=>i(847249),o=()=>i(187174),r=()=>i(963589),l=(i(16280),i(944114),()=>i(388821)),c=()=>i(179034),d=()=>i(763824),u=()=>i(449506),p=()=>i(630116),g=()=>i(757695);class h extends g().default{getInitialState(){return{forms:{},sortAscending:!0,sortColumn:void 0,type:"forms"}}initializeResultsForSpace(e,t){this.state.forms[e]=t,this.emit()}resetSpace(e){this.state.forms[e]=void 0}}const b=new h;class m extends g().default{getInitialState(){return{publicShareLinks:{},sortAscending:!0,sortColumn:void 0,type:"publicShareLinks"}}initializeResultsForSpace(e,t){this.state.publicShareLinks[e]=t,this.emit()}resetSpace(e){this.state.publicShareLinks[e]=void 0}}const x=new m;class f extends g().default{getInitialState(){return{sites:{},sortAscending:!0,sortColumn:void 0,type:"sites"}}initializeResultsForSpace(e,t){this.state.sites[e]=t,this.emit()}resetSpace(e){this.state.sites[e]=void 0}}const j=new f,v=50;async function S(e){const{environment:t,spaceStore:i,store:s,limit:n}=e;if(!i.id)return;const[a]=await Promise.all([u().callApi({eventName:"getPublicBlocksForUser",environment:t,data:{spaceId:i.id,limit:n||v,fetchPublishedMetadata:!0,type:s.state.type}}),(0,d().wR)(1500)]);if("failed"===a.type)throw new Error("Failed to fetch published pages.");if(a.data.recordMap){const e=[],t=l().RecordMapWithRole.create(a.data.recordMap),n=a.data.publishedEdits;for(const{model:s}of t)if(s&&s.table===c().ev){var o;const t=p().Bv.createChildStore(i,{table:c().ev,id:s.id}),a=n[t.id],r=null==a||null===(o=a.authors)||void 0===o?void 0:o[0],l={publishedTime:null==a?void 0:a.timestamp,publishedBy:r};e.push({store:t,publishedMetadata:l})}return s.initializeResultsForSpace(i.id,e),e}}class y extends g().default{getInitialState(){return{view:"landing"}}setTabView(e){this.state.view=e,this.emit()}}const C=new y;var P=()=>i(401497),w=()=>i(959013),T=()=>i(84817),I=()=>i(383716),k=i(474848);function A(e){const t=(0,P().IS)((e=>({container:{minWidth:750},headerContainer:{marginTop:32}})),[]);return(0,k.jsx)(T().Y1,{direction:"vertical",padding:"36px 60px",style:t.container,children:(0,k.jsx)(T().Y1,{direction:"vertical",gap:16,children:(0,k.jsx)(I().n,{title:(0,k.jsx)(w().sA,{id:"publicPagesTab.forms.title",defaultMessage:"Public forms"}),goBack:()=>{C.setTabView("landing")}})})})}i(581454);var M=()=>i(534177),_=()=>i(721672),B=()=>i(710149);function L(){const e=(0,P().IS)((e=>({shimmerHeader:{height:12,width:120,borderRadius:6},shimmerMain:{height:25,width:140,borderRadius:6},shimmerBottom:{height:24,width:120,borderRadius:6}})),[]);return(0,k.jsx)(_().W,{headerText:(0,k.jsx)(B().A,{style:e.shimmerHeader}),mainText:(0,k.jsx)(B().A,{style:e.shimmerMain}),bottom:(0,k.jsx)(B().A,{style:e.shimmerBottom}),onClick:()=>{},isLoading:!0})}var R=()=>i(614505),W=()=>i(554509);function O(){return(0,k.jsx)(W().D,{styleName:"UISmall-12px/Regular",colorName:"tertiary",children:(0,k.jsx)(w().sA,{id:"publicPages.tile.noPages",defaultMessage:"No public pages"})})}const D=3;function F(e){const{pageIcons:t}=e,i=(0,P().IS)((e=>({bottomContainer:{minHeight:24,display:"flex",alignItems:"flex-end"},iconsContainer:{display:"flex",gap:4,alignItems:"center"}})),[]);if(!(0,r().X)("public_pages_settings_tab"))return null;const s=t.slice(0,D).map(((e,t)=>(0,k.jsx)(R().B,{icon:e,size:20,disabled:!0,isEmptyPage:!0},t)));return(0,k.jsx)("div",{style:i.bottomContainer,children:0===t.length?(0,k.jsx)(O,{}):(0,k.jsx)("div",{style:i.iconsContainer,children:s})})}function Y(e){const{spaceStore:t}=e,{formsCount:i,pageIcons:s}=(0,a().K8)((()=>{const e=b.state.forms[t.id];return e?{formsCount:e.length,pageIcons:e.map((e=>e.store.getIcon()))}:{formsCount:void 0,pageIcons:void 0}}),[t.id]);return(0,r().X)("public_pages_settings_tab")?(0,M().O9)(i)&&(0,M().O9)(s)?(0,k.jsx)(_().W,{headerText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publicForms.header",defaultMessage:"Public forms"}),mainText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publicForms.count",defaultMessage:"{count}",values:{count:i}}),bottom:(0,k.jsx)(F,{pageIcons:s}),onClick:()=>{C.setTabView("forms")}}):(0,k.jsx)(L,{}):null}var N=()=>i(12193),V=()=>i(979340),X=()=>i(284371),z=()=>i(946548),E=()=>i(459401),U=()=>i(573660),H=()=>i(508490),K=()=>i(351360);function $(){const e=(0,P().IS)((e=>({headerContainer:{marginTop:32},settingsTitle:{fontWeight:"normal",color:e.text.primary},settingsByline:{color:e.text.secondary}})),[]),[t,i]=(0,s.useState)(!0),{currentSpaceStore:n}=(0,a().O$)(K().default),o=(0,a().K8)((()=>(0,V().OX)(null==n?void 0:n.getSubscriptionTier())),[n]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{style:e.headerContainer,children:(0,k.jsx)(W().D,{children:(0,k.jsx)(w().sA,{id:"publicPages.settings.title",defaultMessage:"Permissions"})})}),o&&(0,k.jsx)(H().A,{icon:N().globeIcon,title:(0,k.jsx)(w().sA,{id:"publicPages.settings.disablePublishing.title",defaultMessage:"Disable publishing public pages in the <bold>Security</bold> tab",values:{bold:e=>(0,k.jsx)("span",{style:{fontWeight:X().Wy.semibold},children:e})}}),deeplinkTab:{currentTab:"security",defaultSubtab:"security"}}),(0,k.jsx)(E().L,{children:(0,k.jsx)(U().y,{title:(0,k.jsx)("div",{style:e.settingsTitle,children:(0,k.jsx)(w().sA,{id:"publicPages.settings.showBanner.title",defaultMessage:"Always show published banner on sites"})}),byline:(0,k.jsx)("div",{style:e.settingsByline,children:(0,k.jsx)(w().sA,{id:"publicPages.settings.showBanner.description",defaultMessage:"Published pages will display a blue banner at the top"})}),item:(0,k.jsx)(z().A,{on:t,onClick:()=>i(!t)})})})]})}function G(e){const{spaceStore:t}=e,{publicShareLinksCount:i,pageIcons:s}=(0,a().K8)((()=>{const e=x.state.publicShareLinks[t.id];return e?{publicShareLinksCount:e.length,pageIcons:e.map((e=>e.store.getIcon()))}:{publicShareLinksCount:void 0,pageIcons:void 0}}),[t.id]);return(0,r().X)("public_pages_settings_tab")?(0,M().O9)(i)&&(0,M().O9)(s)?(0,k.jsx)(_().W,{headerText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publicLinks.header",defaultMessage:"Anyone with a link"}),mainText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publicLinks.count",defaultMessage:"{count}",values:{count:i}}),bottom:(0,k.jsx)(F,{pageIcons:s}),onClick:()=>{C.setTabView("publicShareLinks")}}):(0,k.jsx)(L,{}):null}i(517642),i(658004),i(733853),i(845876),i(432475),i(515024),i(731698),i(898992),i(354520);var q=()=>i(578872),J=(i(672577),()=>i(449418)),Q=()=>i(496603);function Z(e,t){var i;if(e)return null===(i=function(e){if(!e)return[];return(0,Q().oE)(e.getPublicDomainIds().map((t=>e.getRecordModel({id:t,table:J()._6,spaceId:e.id}))))}(e))||void 0===i?void 0:i.find((e=>e.id===t))}function ee(e){const{spaceStore:t}=e,i=(0,P().IS)((e=>({bottomContainer:{minHeight:24,display:"flex",justifyContent:"flex-end",alignItems:"flex-end",gap:4},domainText:{backgroundColor:e.lightGrayButtonBackground,padding:4,borderRadius:4},domainPlus:{paddingBottom:4,color:e.text.tertiary}})),[]),{sitesCount:s,sitesDomains:n}=(0,a().K8)((()=>{const e=j.state.sites[t.id];if(!e)return{sitesCount:void 0,sitesDomains:void 0};const i=new Set(e.map((e=>q().UP(e.store)))),s=Array.from(i).map((e=>{const i=Z(t,e);return null==i?void 0:i.getDomainName()})).filter((e=>(0,M().O9)(e)));return{sitesCount:e.length,sitesDomains:s}}),[t]);if(!(0,r().X)("public_pages_settings_tab"))return null;return(0,M().O9)(s)?(0,k.jsx)(_().W,{headerText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publishedSites.header",defaultMessage:"Published sites"}),mainText:(0,k.jsx)(w().sA,{id:"publicPages.tile.publishedSites.count",defaultMessage:"{sitesCount}",values:{sitesCount:s}}),bottom:(0,M().O9)(s)?(0,k.jsx)("div",{style:i.bottomContainer,children:s>0?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(W().D,{styleName:"UIMini-10px/Regular",colorName:"primary",style:i.domainText,children:null==n?void 0:n[0]}),(0,M().O9)(n)&&n.length>1&&(0,k.jsx)(W().D,{styleName:"UIMini-10px/Regular",style:i.domainPlus,children:"+"+(n.length-1)})]}):(0,k.jsx)(O,{})}):null,onClick:()=>{C.setTabView("sites")}}):(0,k.jsx)(L,{})}function te(e){const{spaceStore:t}=e,i=(0,P().IS)((e=>({container:{minWidth:750},headerContainer:{marginTop:32}})),[]);return(0,r().X)("public_pages_settings_tab")?(0,k.jsxs)(T().Y1,{direction:"vertical",padding:"36px 60px",style:i.container,children:[(0,k.jsxs)(T().Y1,{direction:"vertical",gap:16,children:[(0,k.jsx)(I().n,{title:(0,k.jsx)(w().sA,{id:"publicPages.header.title",defaultMessage:"Public Pages"})}),(0,k.jsxs)(T().Y1,{direction:"horizontal",gap:14,children:[(0,k.jsx)(ee,{spaceStore:t}),(0,k.jsx)(Y,{spaceStore:t}),(0,k.jsx)(G,{spaceStore:t})]})]}),(0,k.jsx)($,{})]}):null}function ie(e){const t=(0,P().IS)((e=>({container:{minWidth:750},headerContainer:{marginTop:32}})),[]);return(0,k.jsx)(T().Y1,{direction:"vertical",padding:"36px 60px",style:t.container,children:(0,k.jsx)(T().Y1,{direction:"vertical",gap:16,children:(0,k.jsx)(I().n,{title:(0,k.jsx)(w().sA,{id:"publicPagesTab.publicShareLinks.title",defaultMessage:"Anyone with a link"}),goBack:()=>{C.setTabView("landing")}})})})}function se(e){const t=(0,P().IS)((e=>({container:{minWidth:750},headerContainer:{marginTop:32}})),[]);return(0,k.jsx)(T().Y1,{direction:"vertical",padding:"36px 60px",style:t.container,children:(0,k.jsx)(T().Y1,{direction:"vertical",gap:16,children:(0,k.jsx)(I().n,{title:(0,k.jsx)(w().sA,{id:"publicPagesTab.sites.title",defaultMessage:"Published sites"}),goBack:()=>{C.setTabView("landing")}})})})}function ne(e){const{spaceStore:t}=e,i=(0,n().v3)();(0,o().Yb)((async()=>{await async function(e){const{environment:t,spaceStore:i}=e;await Promise.all([S({environment:t,spaceStore:i,store:b}),S({environment:t,spaceStore:i,store:j}),S({environment:t,spaceStore:i,store:x})])}({environment:i,spaceStore:t})}),[i,t]),(0,s.useEffect)((()=>()=>{C.setTabView("landing")}),[]);const l=(0,a().O$)(C).view;if(!(0,r().X)("public_pages_settings_tab"))return null;switch(l){case"landing":return(0,k.jsx)(te,{spaceStore:t});case"sites":return(0,k.jsx)(se,{spaceStore:t});case"forms":return(0,k.jsx)(A,{spaceStore:t});case"publicShareLinks":return(0,k.jsx)(ie,{spaceStore:t})}}}}]);