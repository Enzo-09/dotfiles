"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[8418],{627090:(t,e,n)=>{n.d(e,{AL:()=>p,Cg:()=>v,u7:()=>f});n(16280),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(672577),n(581454),n(737550);var i=()=>n(244641),r=()=>n(496603),a=()=>n(498212),o=()=>n(534177),s=()=>n(720665),u=()=>n(762433),l=()=>n(47273),c=()=>n(952539),d=()=>n(622963),m=()=>n(979340);function p(t){return"trial"!==t.type&&"prorate_without_invoice"!==t.type&&"update_without_proration"!==t.type&&t.immediate.items.some((t=>t.price.unitAmount.amount>0))}function f(t){return"reset_and_invoice"===t.type}function v(t,e,n,o,s,l){const c=function(t,e,n,r,o,s){var l;const c=!e.trial&&(0,u().TB)(e);if(!(0,u().Fq)(e)||c)return;const d=e.trial;if(d&&!n.trialEnd)return;const m=(0,u().KH)({subscription:n,trial:void 0},"plan"),p=(0,u().KH)({subscription:void 0,trial:d},"plan"),f=h(p,m)?m:p,v=(0,u().i5)(e)??n.trialEnd,g=(null===(l=e.trial)||void 0===l?void 0:l.startDate)??i().c9.now();return v&&f?{externalId:(null==d?void 0:d.externalId)??(0,a().Ay)(),endDate:v,startDate:g,items:[f]}:void 0}(0,e,n),d=function(t,e,n){if(!e.trial&&t){var i;const a=(null===(i=e.subscription)||void 0===i?void 0:i.items)||[],o=(0,r().$z)(n.items,u().IE),s=(0,r().$z)(a,u().IE),l=new Set([...Object.keys(o),...Object.keys(s)]),c=[];for(const e of l)null!=t&&t.items.some((t=>(0,u().IE)(t)===e))?s[e]&&c.push(...s[e]):o[e]&&c.push(...o[e]);return{items:c,trialEnd:void 0}}return t?{...n,trialEnd:void 0}:n}(c,e,n);return{trial:c,subscription:g(t,e,d,o,s,l)}}function g(t,e,n,i,a,s){const m=(0,u().PP)(e),p=(0,c().qX)(e),f=s??function(t,e){const n=y(t,e),i=function(t,e){const n=Boolean(t.trialEnd),i=y(t,e);if(n&&!i)return!0;const r=(0,l().yw)(t),a=(0,l().yw)(e);if("month"===r&&"year"===a)return!0;if("year"===r&&"month"===a)return!1;const o=t.items.find((t=>(0,u().xp)(t))),s=e.items.find((t=>(0,u().xp)(t))),c=h(o,s),d=s&&0===s.price.unitAmount.amount;if(c&&!d)return!0;if(t.trialEnd&&x(t,e))return!0;return!1}(t,e),r=function(t,e){const n=(0,l().yw)(t),i=(0,l().yw)(e);if("month"===n&&"year"===i)return!0;const r=(0,u().HO)(t.items,e.items);return r.some((t=>{let[e,n]=t;const i=!e&&n,r=h(e,n),a=b(e,n)>0,o=n&&n.price.unitAmount.amount>0;return(i||r||a)&&o}))}(t,e);return n?"trial":i?"reset_and_invoice":r?"prorate_and_invoice":"prorate_without_invoice"}(m,n);if("reset_and_invoice"===f)return{type:"reset_and_invoice",immediate:{items:n.items.filter((t=>w(n,t)))},dunningCancellationTime:p};const v=function(t,e,n,i,r,a){const s=(0,l().yw)(n),c=(0,l().yw)(i);let m;m="trial"!==e&&"year"===s?"year":c??s;const p=E(n.items,"seats"),f=E(n.items,"public_domain_custom_hostnames"),v=(0,u().HO)(n.items,i.items),g={seats:{actual:r.numSeats,billed:p},public_domain_custom_hostnames:{actual:r.numCustomHostnames,billed:f}};return v.map((e=>{const n=function(t,e){let[n,i]=t;const r=(0,d().vK)((n??i).price.product),{actual:a,billed:o}=e[r];return Math.max(a,o??0)}(e,g),s=function(t,e,n,i){let r,[a,o]=i;r=o&&h(a,o)?o.price:(a??o).price;return function(t,e,n){if(e.billingInterval===n)return e;const i=t.find((t=>t.product===e.product&&t.unitAmount.currencyCode===e.unitAmount.currencyCode&&t.billingInterval===n));if(!i)throw new Error(`Cannot find PriceData for stripe price id: ${e.externalId} at interval ${n}`);return i}(t,r,n)}(t,0,m,e),[u,l]=e,c=function(t,e){let[n,i]=t;const r=(0,d().vK)((n??i).price.product);return function(t,e){switch(e){case"seats":return t.numSeats;case"public_domain_custom_hostnames":return t.numCustomHostnames;default:(0,o().HB)(e)}}(e,r)}(e,r),p=function(t,e,n,i){let{}=i;if(!n)return;if(!w(e,n))return;const r=n.price;if(d().As.includes(r.externalId))return function(t,e){const n=t.find((t=>t.product===e.product&&t.unitAmount.currencyCode===e.unitAmount.currencyCode&&t.billingInterval===e.billingInterval));if(!n)throw new Error(`Cannot find current PriceData for stripe price id: ${e.externalId}`);return n}(t,r);return r}(t,i,l,a);return{immediate:{price:s,quantity:n},pending:(0,o().O9)(p)&&(0,o().O9)(c)&&c>0?{price:p,quantity:c}:void 0}}))}(t,f,m,n,i,a),g={items:(0,r().oE)(v.map((t=>t.immediate)))},_={items:(0,r().oE)(v.map((t=>t.pending)))},I=n.trialEnd??m.trialEnd;if("trial"===f){if(!I)throw new Error("cannot have trial without trialEnd");return{type:"trial",trialEnd:I,immediate:g,pending:_,dunningCancellationTime:p}}return{type:f,immediate:g,pending:_,dunningCancellationTime:p}}function y(t,e){const n=t.items.find((t=>(0,u().xp)(t))),i=h(n,e.items.find((t=>(0,u().xp)(t)))),r=n&&i||x(t,e);return Boolean(e.trialEnd||t.trialEnd)&&!r}function h(t,e){const n=(0,u().xp)(t)??"free",i=(0,u().xp)(e);return!!i&&m().o3[n]<m().o3[i]}function x(t,e){var n;const i=t.items.find((t=>"sites_custom_hostnames"===(0,u().IE)(t))),r=e.items.find((t=>"sites_custom_hostnames"===(0,u().IE)(t))),a=null===(n=r??i)||void 0===n?void 0:n.price;return!(!a||0===a.unitAmount.amount)&&b(i,r)>0}function b(t,e){return null!=t&&t.price.product&&"seats"===(0,d().vK)(null==t?void 0:t.price.product)||null!=e&&e.price.product&&"seats"===(0,d().vK)(null==e?void 0:e.price.product)?0:((null==e?void 0:e.quantity)??0)-((null==t?void 0:t.quantity)??0)}function E(t,e){return(0,s().Z$)(t.filter((t=>(0,d().vK)(t.price.product)===e)).map((t=>t.quantity)),"A subscription should have a consistent quantity across all its items.")}function w(t,e){if("sites_custom_hostnames"!==(0,u().IE)(e))return!0;const n=t.items.find((t=>(0,u().xp)(t)));return(0,m().y4)((0,u().xp)(n))}},815418:(t,e,n)=>{n.d(e,{Dd:()=>I,F3:()=>C,Fy:()=>A,Vq:()=>S,cP:()=>w,eO:()=>j,vF:()=>_});n(898992),n(581454),n(908872);var i=n(296540),r=()=>n(662303),a=()=>n(484714),o=()=>n(847249),s=()=>n(869190),u=()=>n(762433),l=()=>n(323063),c=()=>n(627090),d=()=>n(643819),m=()=>n(959013),p=()=>n(496603),f=()=>n(449506),v=()=>n(240865),g=()=>n(23954),y=()=>n(224701),h=()=>n(601203),x=()=>n(807778),b=()=>n(644837),E=n(474848);function w(t){var e;let{desiredProducts:n,desiredInterval:r,billingData:a,prices:s}=t;const c=(0,u().Ry)(a)??"USD",d=(0,i.useMemo)((()=>(0,u().lQ)(a)),[a]),m=(0,v().V)()??1,f=(null===(e=(0,u().KH)(a,"sites_custom_hostnames"))||void 0===e?void 0:e.quantity)??0,g=(0,i.useMemo)((()=>({numSeats:m,numCustomHostnames:f})),[m,f]),y=(0,o().K8)((()=>(0,x().Le)()),[]),h=(0,i.useMemo)((()=>(0,l().ef)({state:d,prices:s,quantities:g,params:{currency:c,interval:r},products:n,flags:{isMay13PackagingChangesEnabled:y}})),[d,s,g,c,r,n,y]),b=(0,i.useMemo)((()=>(0,p().Lc)(h.items,d.items,"price.externalId")),[h.items,d]);return{desiredState:h,quantities:g,newItems:b}}function _(t){const{spaceStore:e,quantities:n,desiredState:r,currencyCode:s}=t,u=(0,o().K8)((()=>e.id),[e]),l=(0,a().v3)(),[c,m]=(0,i.useState)(),[p,v]=(0,i.useState)(),[g,y]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{!async function(){var t;y(!0);const e=await f().callApi({eventName:"getImmediateUpdateCost",environment:l,data:{spaceId:u,quantities:n,desiredState:{items:(null==r?void 0:r.items.map((t=>({id:t.id,quantity:t.quantity,priceData:{external_id:t.price.externalId,product:t.price.product,billing_interval:t.price.billingInterval,currency:t.price.unitAmount.currencyCode,unit_amount:t.price.unitAmount.amount,state:t.price.state}}))))||[],trialEnd:null===(t=r.trialEnd)||void 0===t?void 0:t.toString()}}});y(!1),"success"===e.type&&(m(d().W.fromValue(e.data.total)),v(e.data.lineItems))}()}),[l,null==r?void 0:r.items,n,u,null==r?void 0:r.trialEnd]),{subtotal:c??new(d().W)(s,0),lineItems:p,isLoading:g}}function I(t,e){return((null==e?void 0:e.items)??[]).reduce(((t,e)=>{const n=(0,u().q5)(e.price);return t.plus(n.getCostPerBillingInterval({quantity:e.quantity}))}),new(d().W)(t,0))}function S(t){let{change:e,interval:n,currentPeriodEnd:i,now:r}=t;return(0,c().u7)(e)&&n?r.plus({months:"month"===n?1:12}):i}function A(t){let{environment:e,currencyCode:n,address:r,lineItems:a,taxableAmount:o,billingData:s}=t;const[u,l]=(0,i.useState)(0),[c,m]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{!async function(){if(!r||0===a.length||0===o.amount)return;m(!0);const t=await(0,h().qu)({environment:e,taxableAmount:o,lineItems:a,address:r,billingData:s});l(t??0),m(!1)}()}),[e,o,a,r,s]),{tax:new(d().W)(n,u),isLoading:c}}async function C(t){let{environment:e,spaceStore:n,desiredState:i,stripe:r,coupon:a,intl:o}=t;try{const t=await y().nV({environment:e,from:b().A.state.open?b().A.state.analyticsArgs.from:"midterm_checkout_modal",spaceStore:n,desiredState:i,inAppOffer:a});await y().XO({paymentIntentData:t,stripe:r,onSuccess:()=>{(0,y().L1)(e,g().w)}})}catch{return{error:o.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})}}}function j(t){let{interval:e,effectiveDate:n}=t;return{title:(0,E.jsx)(m().sA,{id:"midtermIntervalChange.title",defaultMessage:"Switch to {interval, select, month {monthly} other {annual}} billing",values:{interval:e}}),subtitle:n?(0,E.jsx)(m().sA,{id:"midtermIntervalChange.subtitle.nextPeriod",defaultMessage:"Effective {periodEnd}",values:{periodEnd:(0,s().eV)({value:n,preset:"medium",locale:r().locale})}}):(0,E.jsx)(m().sA,{id:"spaceSubscriptionUpgradeModal.effectiveToday.header",defaultMessage:"Effective today"})}}},997929:(t,e,n)=>{n.d(e,{J:()=>x});n(296540);var i=()=>n(662303),r=()=>n(484714),a=()=>n(401497),o=()=>n(869190),s=()=>n(643819),u=()=>n(959013),l=()=>n(252105),c=()=>n(84817),d=()=>n(802790),m=()=>n(710149),p=()=>n(554509),f=()=>n(208993),v=()=>n(517492),g=()=>n(34699),y=()=>n(161165),h=n(474848);function x(t){let{immediate:e,recurring:n,nextBillingDate:i,accountBalance:o,items:m,chargeType:f={chargeType:"immediate"},modalId:v,isExpanded:x,setIsExpanded:E}=t;const w=(0,r().v3)(),_=(0,a().IS)((t=>({summaryContainer:{background:t.surface.wash,padding:16,borderRadius:8}})),[]),I=e.subtotal.plus(e.tax),S=new(s().W)(n.subtotal.currencyCode,0),A=(0,y().Bq)({subtotal:n.subtotal,discount:S,balance:o},n.tax),C=0!==A.amount&&0!==I.amount&&A.amount!==I.amount,[j,q,D]="immediate"===f.chargeType?[I,e.subtotal,e.tax]:[A,n.subtotal,n.tax];return(0,h.jsxs)(c().Y1,{gap:8,children:[(0,h.jsx)(g().BB,{useNewStyle:!0,isTotalLoading:e.isLoading,total:j,handleToggleExpanded:()=>{x?l().CK(w,{modalId:v}):l().wJ(w,{modalId:v}),E(!x)},isExpanded:x,discount:S,accountBalance:o,subtitle:"immediate"===f.chargeType?(0,h.jsx)(b,{recurringTotal:A,periodEnd:i,isNextBillDifferent:C,isLoading:n.isLoading||e.isLoading}):null,...f}),(0,h.jsx)(g()._z,{isExpanded:x,children:(0,h.jsxs)(c().Y1,{gap:8,style:_.summaryContainer,children:[C?(0,h.jsx)(p().D,{styleName:"UISmall-12px/Medium",colorName:"secondary",children:(0,h.jsx)(u().sA,{id:"checkout.orderSummary.title",defaultMessage:"Prorated charge"})}):null,(0,h.jsxs)(c().Y1,{gap:12,children:[(0,h.jsx)(g().f5,{items:m,showMonthlyPricing:!1}),(0,h.jsx)(d().A,{size:1}),(0,h.jsx)(g().Qs,{subtotal:q,subtotalText:C?(0,h.jsx)(u().sA,{id:"checkout.orderSummary.subtotalProrated",defaultMessage:"Subtotal (prorated)"}):void 0,discount:S,showDiscountLine:!1,accountBalance:o,tax:D})]})]})})]})}function b(t){let{recurringTotal:e,periodEnd:n,isLoading:r,isNextBillDifferent:a}=t;return r?(0,h.jsx)(m().A,{style:{width:180,height:16,borderRadius:4}}):a?(0,h.jsxs)(c().Y1,{direction:"horizontal",gap:4,align:"center-left",children:[(0,h.jsx)(u().sA,{id:"checkout.orderSummary.estimatedBill",defaultMessage:"Estimated next bill: {price}",values:{price:(0,h.jsx)(v().v,{cost:e,trailingZeroDisplay:"stripIfInteger"})}}),(0,h.jsx)(f().W,{tooltipTitle:(0,h.jsx)(u().sA,{id:"checkout.orderSummary.estimatedBillTooltip",defaultMessage:"This is an estimate of your next charge on {date}. If you add/remove members, this amount might change",values:{date:(0,o().eV)({value:n,preset:"medium",locale:i().locale})}}),tooltipDescription:(0,h.jsx)(u().sA,{id:"checkout.orderSummary.estimatedBillTooltipDescription",defaultMessage:"Click to learn more about billing"}),buttonProps:{href:"https://www.notion.com/help/billing-and-payment-info",external:!0},tooltipWidth:240})]}):null}}}]);